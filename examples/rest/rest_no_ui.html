<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="HandheldFriendly" content="true"/>
  <title>REST no UI</title>
  <link rel="stylesheet" href="../examples.css" />
  <script type="text/javascript" src="../../dist/iink.min.js"></script>

  <style>
    body {
      display: flex;
      flex-direction: row;
    }
    #rawStrokesT, #result {
      min-height: 95vh;
      max-height: 95vh;
      min-width: 49vw;
      max-width: 49vw;
    }

    #recognize {
      position: absolute;
      top: 2%;
      left: calc(50% - 75px);
      width: 125px;
      height: 35px;
    }
    #result {
      display: flex;
      flex-direction: column;
      justify-content: space-evenly;
    }

    #interpretatedTextContent {
      max-height: 50%;
    }

    #interpretatedImageContent {
      max-width: 100%;
      max-height: 50%;
    }

    #interpretatedImageContent > img {
      max-width: 100%;
    }
  </style>
</head>

<body>
<div id="rawStrokes">
  <textarea id="rawStrokesT">
    [{
      "penStyle": {},
      "strokes": [
        {
          "color": "#000000",
          "-myscript-pen-width": 1,
          "-myscript-pen-fill-style": "none",
          "-myscript-pen-fill-color": "#FFFFFF00",
          "pointerType":"mouse",
          "x":[397,391,377,362,352,346,340,337,333,330,327,324,322,321,320,319,319,319,320,322,323,325,327,330,333,335,337,341,345,349,352,355,359,362,365,370,374,377,380,383,387,391,396,401,405,408,412,419,425,428,430,434,435,437,439,439,439,439,438,438,438,437,436,436,433,428,424,420,418,415,412,409,406,402,399,395,390,387,384],
          "y":[170,170,172,174,175,177,180,184,186,189,192,196,200,204,207,211,214,218,221,225,229,234,239,241,245,248,251,256,258,261,263,264,265,266,266,266,265,265,265,265,265,264,264,264,263,262,259,255,253,252,249,245,242,239,236,232,227,224,220,215,212,208,204,200,197,193,189,186,182,179,176,173,172,170,170,170,171,171,171],
          "t":[1688993793427,1688993793570,1688993793587,1688993793603,1688993793620,1688993793637,1688993793670,1688993793687,1688993793764,1688993793786,1688993793804,1688993793820,1688993793837,1688993793853,1688993793869,1688993793903,1688993793920,1688993793953,1688993793987,1688993794020,1688993794037,1688993794070,1688993794087,1688993794121,1688993794153,1688993794187,1688993794236,1688993794270,1688993794303,1688993794352,1688993794370,1688993794386,1688993794419,1688993794436,1688993794486,1688993794519,1688993794536,1688993794553,1688993794569,1688993794603,1688993794620,1688993794636,1688993794653,1688993794669,1688993794686,1688993794719,1688993794804,1688993794836,1688993794852,1688993794869,1688993794902,1688993794936,1688993794952,1688993794986,1688993795019,1688993795052,1688993795085,1688993795102,1688993795136,1688993795169,1688993795185,1688993795218,1688993795252,1688993795285,1688993795369,1688993795402,1688993795435,1688993795469,1688993795501,1688993795535,1688993795585,1688993795635,1688993795768,1688993795819,1688993796068,1688993796084,1688993796102,1688993796118,1688993796151],
          "p":[0.5,0.76,0.63,0.61,0.68,0.77,0.78,0.74,0.73,0.72,0.72,0.74,0.73,0.72,0.68,0.72,0.68,0.71,0.68,0.73,0.72,0.75,0.75,0.7,0.74,0.7,0.7,0.77,0.73,0.74,0.7,0.68,0.72,0.68,0.68,0.74,0.72,0.68,0.68,0.68,0.71,0.72,0.74,0.74,0.72,0.68,0.74,0.8,0.77,0.68,0.7,0.76,0.68,0.7,0.7,0.71,0.74,0.68,0.72,0.74,0.68,0.72,0.72,0.71,0.72,0.77,0.76,0.74,0.73,0.72,0.72,0.72,0.68,0.73,0.68,0.71,0.75,0.68,0.68]
        },
        {
          "color": "#000000",
          "-myscript-pen-width": 1,
          "-myscript-pen-fill-style": "none",
          "-myscript-pen-fill-color": "#FFFFFF00",
          "pointerType":"mouse",
          "x":[356,359,360,363,365,368,371,375,378,387,392,395,400,402,405,406,406],
          "y":[233,235,238,242,245,247,249,250,250,246,244,242,240,237,235,232,229],
          "t":[1688993797935,1688993798070,1688993798099,1688993798133,1688993798210,1688993798232,1688993798249,1688993798282,1688993798316,1688993798416,1688993798432,1688993798449,1688993798483,1688993798533,1688993798599,1688993798633,1688993798699],
          "p":[0.5,0.81,0.68,0.74,0.7,0.7,0.7,0.72,0.68,0.82,0.75,0.7,0.75,0.7,0.7,0.68,0.68]
        },
        {
          "color": "#000000",
          "-myscript-pen-width": 1,
          "-myscript-pen-fill-style": "none",
          "-myscript-pen-fill-color": "#FFFFFF00",
          "pointerType":"mouse",
          "x":[380],
          "y":[216],
          "t":[1688993799595],
          "p":[0.5]
        },
        {
          "color": "#000000",
          "-myscript-pen-width": 1,
          "-myscript-pen-fill-style": "none",
          "-myscript-pen-fill-color": "#3262a800",
          "pointerType":"mouse",
          "x":[359],
          "y":[196],
          "t":[1688993800389],
          "p":[0.5]
        },
        {
          "color": "#000000",
          "-myscript-pen-width": 1,
          "-myscript-pen-fill-style": "none",
          "-myscript-pen-fill-color": "#3262a800",
          "pointerType":"mouse",
          "x":[401],
          "y":[198],
          "t":[1688993801322],
          "p":[0.5]
        }
      ]
    }]
  </textarea>

</div>
<div id="result">
  <div id='interpretatedTextContent'></div>
  <div id='interpretatedImageContent'></div>

</div>
<button id="recognize" class="btn">Recognize</button>
<script>
  const convertBlobToBase64 = (blob) => new Promise((resolve, reject) => {
    const reader = new FileReader;
    reader.onerror = reject;
    reader.onload = () => {
      resolve(reader.result);
    };
    reader.readAsDataURL(blob);
  });
  document.querySelector('#recognize')
    .addEventListener('click', async () => {
      const res = await fetch('../server-configuration.json');
      const serverConfiguration = await res.json();
      // Creating a configuration
      const configuration = new iink.Configuration({ server: serverConfiguration })
      // Creating a recognizer
      const iinkRecognizer = new iink.RestRecognizer(configuration.server, configuration.recognition);
      // Creating a empty model
      const model = new iink.Model();
      // Filling the model with the stroke groups
      model.strokeGroups = JSON.parse(document.querySelector('#rawStrokesT').value);
      // Define exported mimeTypes
      const requestedMimeType = ['text/plain', 'image/png'];
      // Triggering the recognition
      const newModel = await iinkRecognizer.export(model, requestedMimeType)

      Object.entries(newModel.exports)
      .forEach(([mimeType, exportValue]) => {
        if (mimeType.startsWith('image/')) {
          convertBlobToBase64(exportValue)
            .then(b64 => {
              document.querySelector('#interpretatedImageContent').innerHTML = "<img>";
              document.querySelector('#interpretatedImageContent > img').src = b64;
            })
            .catch((error) => {
              console.log("Unable to convert to base 64")
            });
        } else {
          document.querySelector('#interpretatedTextContent').innerHTML = JSON.stringify(newModel.exports[mimeType]);
        }
      });

    });

</script>
</body>

</html>
