{
  "version": 3,
  "sources": ["../../../../src/lib/editor/derivations/notVisibleShapes.ts"],
  "sourcesContent": ["import { computed, isUninitialized } from '@tldraw/state'\nimport { TLShapeId } from '@tldraw/tlschema'\nimport { Box } from '../../primitives/Box'\nimport { Editor } from '../Editor'\n\nfunction isShapeNotVisible(editor: Editor, id: TLShapeId, viewportPageBounds: Box): boolean {\n\tconst maskedPageBounds = editor.getShapeMaskedPageBounds(id)\n\t// if the shape is fully outside of its parent's clipping bounds...\n\tif (maskedPageBounds === undefined) return true\n\n\t// if the shape is fully outside of the viewport page bounds...\n\treturn !viewportPageBounds.includes(maskedPageBounds)\n}\n\n/**\n * Incremental derivation of not visible shapes.\n * Non visible shapes are shapes outside of the viewport page bounds and shapes outside of parent's clipping bounds.\n *\n * @param editor - Instance of the tldraw Editor.\n * @returns Incremental derivation of non visible shapes.\n */\nexport const notVisibleShapes = (editor: Editor) => {\n\tfunction fromScratch(editor: Editor): Set<TLShapeId> {\n\t\tconst shapes = editor.getCurrentPageShapeIds()\n\t\tconst viewportPageBounds = editor.getViewportPageBounds()\n\t\tconst notVisibleShapes = new Set<TLShapeId>()\n\t\tshapes.forEach((id) => {\n\t\t\tif (isShapeNotVisible(editor, id, viewportPageBounds)) {\n\t\t\t\tnotVisibleShapes.add(id)\n\t\t\t}\n\t\t})\n\t\treturn notVisibleShapes\n\t}\n\treturn computed<Set<TLShapeId>>('getCulledShapes', (prevValue) => {\n\t\tif (isUninitialized(prevValue)) {\n\t\t\treturn fromScratch(editor)\n\t\t}\n\n\t\tconst nextValue = fromScratch(editor)\n\n\t\tif (prevValue.size !== nextValue.size) return nextValue\n\t\tfor (const prev of prevValue) {\n\t\t\tif (!nextValue.has(prev)) {\n\t\t\t\treturn nextValue\n\t\t\t}\n\t\t}\n\t\treturn prevValue\n\t})\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAA0C;AAK1C,SAAS,kBAAkB,QAAgB,IAAe,oBAAkC;AAC3F,QAAM,mBAAmB,OAAO,yBAAyB,EAAE;AAE3D,MAAI,qBAAqB,OAAW,QAAO;AAG3C,SAAO,CAAC,mBAAmB,SAAS,gBAAgB;AACrD;AASO,MAAM,mBAAmB,CAAC,WAAmB;AACnD,WAAS,YAAYA,SAAgC;AACpD,UAAM,SAASA,QAAO,uBAAuB;AAC7C,UAAM,qBAAqBA,QAAO,sBAAsB;AACxD,UAAMC,oBAAmB,oBAAI,IAAe;AAC5C,WAAO,QAAQ,CAAC,OAAO;AACtB,UAAI,kBAAkBD,SAAQ,IAAI,kBAAkB,GAAG;AACtD,QAAAC,kBAAiB,IAAI,EAAE;AAAA,MACxB;AAAA,IACD,CAAC;AACD,WAAOA;AAAA,EACR;AACA,aAAO,uBAAyB,mBAAmB,CAAC,cAAc;AACjE,YAAI,8BAAgB,SAAS,GAAG;AAC/B,aAAO,YAAY,MAAM;AAAA,IAC1B;AAEA,UAAM,YAAY,YAAY,MAAM;AAEpC,QAAI,UAAU,SAAS,UAAU,KAAM,QAAO;AAC9C,eAAW,QAAQ,WAAW;AAC7B,UAAI,CAAC,UAAU,IAAI,IAAI,GAAG;AACzB,eAAO;AAAA,MACR;AAAA,IACD;AACA,WAAO;AAAA,EACR,CAAC;AACF;",
  "names": ["editor", "notVisibleShapes"]
}
