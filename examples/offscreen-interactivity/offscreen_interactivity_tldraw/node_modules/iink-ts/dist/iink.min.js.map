{"version":3,"file":"iink.min.js","sources":["../src/Constants.ts","../src/utils/DeferredPromise.ts","../src/utils/math.ts","../src/utils/geometry.ts","../src/utils/version.ts","../src/utils/crypto.ts","../src/utils/units.ts","../src/utils/uuid.ts","../src/utils/object.ts","../src/utils/language.ts","../src/utils/quadratics.ts","../src/utils/infos.ts","../src/logger/logger.ts","../src/logger/LoggerManager.ts","../src/logger/LoggerConfiguration.ts","../src/editor/EditorEvent.ts","../src/model/Export.ts","../src/model/ExportV2.ts","../src/editor/EditorLayer.ts","../src/editor/AbstractEditor.ts","../src/symbol/Box.ts","../src/style/Style.ts","../src/style/PenStyle.ts","../src/style/Theme.ts","../node_modules/json-css/lib/jsoncss.min.js","../src/style/StyleHelper.ts","../src/style/StyleManager.ts","../src/symbol/IIDecorator.ts","../src/symbol/Symbol.ts","../src/symbol/geometry/IIEdge.ts","../src/symbol/geometry/IIShape.ts","../src/symbol/recognized/IIRecognizedBase.ts","../src/transform/Matrix.ts","../src/symbol/IISymbolBase.ts","../src/symbol/Point.ts","../src/symbol/geometry/IIEdgeArc.ts","../src/symbol/geometry/IIEdgeLine.ts","../src/symbol/geometry/IIEdgePolyLine.ts","../src/symbol/geometry/IIShapeCircle.ts","../src/symbol/geometry/IIShapeEllipse.ts","../src/symbol/geometry/IIShapePolygon.ts","../src/symbol/IIStroke.ts","../src/symbol/recognized/IIRecognizedArc.ts","../src/symbol/recognized/IIRecognizedCircle.ts","../src/symbol/recognized/IIRecognizedEllipse.ts","../src/symbol/recognized/IIRecognizedLine.ts","../src/symbol/recognized/IIRecognizedPolyLine.ts","../src/symbol/recognized/IIRecognizedPolygon.ts","../src/symbol/recognized/IIRecognizedText.ts","../src/symbol/IISymbolGroup.ts","../src/symbol/IIText.ts","../src/symbol/IIEraser.ts","../src/symbol/Stroke.ts","../src/model/Model.ts","../src/model/IIModel.ts","../src/model/IModel.ts","../src/recognizer/ServerConfiguration.ts","../src/recognizer/recognition/EraserConfiguration.ts","../src/recognizer/recognition/DiagramConfiguration.ts","../src/recognizer/recognition/ExportConfiguration.ts","../src/recognizer/recognition/MarginConfiguration.ts","../src/recognizer/recognition/MathConfiguration.ts","../src/recognizer/recognition/RawContentConfiguration.ts","../src/recognizer/recognition/RecognitionRendererConfiguration.ts","../src/recognizer/recognition/TextConfiguration.ts","../src/recognizer/recognition/TextConfigurationV2.ts","../src/recognizer/recognition/ShapeConfiguration.ts","../src/recognizer/recognition/MathV2Configuration.ts","../src/recognizer/recognition/RawContentV2Configuration.ts","../src/recognizer/RecognizerEvent.ts","../src/recognizer/RecognizerError.ts","../src/recognizer/RecognizerHTTPV1Configuration.ts","../src/recognizer/RecognizerHTTPV1.ts","../src/recognizer/RecognizerHTTPV2Configuration.ts","../src/recognizer/RecognizerHTTPV2.ts","../src/recognizer/RecognizerWebSocketMessage.ts","../src/recognizer/RecognizerWebSocketConfiguration.ts","../src/recognizer/RecognizerWebSocket.ts","../src/recognizer/RecognizerWebSocketSSRConfiguration.ts","../src/recognizer/RecognizerWebSocketSSR.ts","../src/renderer/canvas/CanvasRendererShape.ts","../src/renderer/canvas/CanvasRendererStroke.ts","../src/renderer/canvas/CanvasRendererText.ts","../src/renderer/canvas/CanvasRenderer.ts","../src/renderer/svg/SVGRendererConst.ts","../src/renderer/svg/SVGBuilder.ts","../src/renderer/svg/SVGRendererEdgeUtil.ts","../src/renderer/svg/SVGRendererEraserUtil.ts","../src/renderer/svg/SVGRendererDecoratorUtil.ts","../src/renderer/svg/SVGRendererShapeUtil.ts","../src/renderer/svg/SVGRendererStrokeUtil.ts","../src/renderer/svg/SVGRendererTextUtil.ts","../src/renderer/svg/SVGRendererRecognizedUtil.ts","../src/renderer/svg/SVGRendererGroupUtil.ts","../src/renderer/svg/SVGRenderer.ts","../src/renderer/svg/SVGStroker.ts","../src/renderer/svg/SVGSSRenderer.ts","../src/renderer/RendererConfiguration.ts","../src/grabber/GrabberConfiguration.ts","../src/grabber/PointerEventGrabber.ts","../src/manager/AbstractWriterManager.ts","../src/manager/IIConversionManager.ts","../src/manager/IIResizeManager.ts","../src/manager/IIRotationManager.ts","../src/manager/IISelectionManager.ts","../src/manager/IITextManager.ts","../src/manager/IITranslateManager.ts","../src/manager/IIWriterManager.ts","../src/manager/IIDebugSVGManager.ts","../src/manager/IIMoveManager.ts","../src/manager/IDebugSVGManager.ts","../src/manager/EraseManager.ts","../src/history/HistoryContext.ts","../src/history/HistoryManager.ts","../src/history/IIHistoryManager.ts","../src/history/IHistoryManager.ts","../src/history/HistoryConfiguration.ts","../src/menu/IIMenu.ts","../src/gesture/Gesture.ts","../src/gesture/GestureConfiguration.ts","../src/gesture/IIGestureManager.ts","../src/menu/IIMenuSub.ts","../src/menu/IIMenuAction.ts","../src/menu/IIMenuTool.ts","../src/menu/IIMenuStyle.ts","../src/menu/IIMenuContext.ts","../src/menu/MenuConfiguration.ts","../src/menu/IIMenuManager.ts","../src/snap/IISnapConfiguration.ts","../src/snap/IISnapManager.ts","../src/editor/InteractiveInkEditorConfiguration.ts","../src/editor/InteractiveInkEditor.ts","../src/editor/EditorTriggerConfiguration.ts","../src/editor/InkEditorDeprecatedConfiguration.ts","../src/editor/InkEditorDeprecated.ts","../src/smartguide/InteractiveInkSSRSmartGuide.ts","../src/editor/InteractiveInkSSREditorConfiguration.ts","../src/editor/InteractiveInkSSREditor.ts","../src/editor/InkEditorConfiguration.ts","../src/manager/IWriterManager.ts","../src/editor/InkEditor.ts","../src/editor/Editor.ts","../src/recognizer/recognition/ConvertionConfiguration.ts","../src/utils/font.ts"],"sourcesContent":["/**\n * @group Editor\n * @summary\n * List the possibilities of interactions\n */\nexport enum EditorTool\n{\n  Write = \"write\",\n  Erase = \"erase\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Select = \"select\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Move = \"move\"\n}\n\n/**\n * @group Editor\n * @summary\n * List all the shapes that can be drawn\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum EditorWriteTool\n{\n  Pencil = \"pencil\",\n  Rectangle = \"rectangle\",\n  Rhombus = \"rhombus\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Line = \"line\",\n  Arrow = \"arrow\",\n  DoubleArrow = \"double-arrow\",\n}\n\n/**\n * @group Renderer\n * @summary\n * List all svg elements roles\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum SvgElementRole\n{\n  Guide = \"guide\",\n  InteractElementsGroup = \"interact-elements-group\",\n  Translate = \"translate\",\n  Resize = \"resize\",\n  Rotate = \"rotate\",\n}\n\n/**\n * @group Renderer\n * @summary\n * List all svg elements resize direction\n * @remarks\n * only usable in the case of offscreen\n */\nexport const enum ResizeDirection\n{\n  North = \"n-resize\",\n  East = \"e-resize\",\n  South = \"s-resize\",\n  West = \"w-resize\",\n  NorthEast = \"ne-resize\",\n  NorthWest = \"nw-resize\",\n  SouthEast = \"se-resize\",\n  SouthWest = \"sw-resize\"\n}\n\n/**\n * @group Renderer\n */\nexport const SELECTION_MARGIN = 10 as const\n","\n/**\n * @group Utils\n */\nexport class DeferredPromise<T> {\n  promise: Promise<T>\n  resolve!: (value: T) => void\n  reject!: (value: Error | string) => void\n\n  isFullFilled: boolean\n  isPending: boolean\n\n\n  constructor()\n  {\n    this.isFullFilled = false\n    this.isPending = true\n\n    this.promise = new Promise((resolve, reject) =>\n    {\n      this.reject = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return reject(v)\n      }\n      this.resolve = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return resolve(v as T)\n      }\n    })\n  }\n}\n","/**\n * @group Utils\n */\nexport function isValidNumber(x: unknown): boolean\n{\n  if (x === undefined || x === null) return false\n  return !isNaN(parseFloat(x.toString())) && isFinite(+x)\n}\n/**\n * @group Utils\n */\nexport function isBetween(val: number, min: number, max: number): boolean\n{\n  return val >= min && val <= max\n}\n\n/**\n * @group Utils\n */\nexport function computeAverage(arr: number[]): number\n{\n  return arr.reduce((p, c) => p + c, 0) / (arr.length || 1)\n}\n","import { TBox, TPoint, TSegment } from \"../symbol\"\nimport { isBetween } from \"./math\"\n\n/**\n * @group Utils\n */\nexport function computeDistance(p1: TPoint, p2: TPoint): number\n{\n  const distance = Math.hypot(p2.y - p1.y, p2.x - p1.x)\n  return isNaN(distance) ? 0 : distance\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleAxeRadian(begin: TPoint, end: TPoint): number\n{\n  return Math.atan2(end.y - begin.y, end.x - begin.x)\n}\n\n/**\n * @group Utils\n */\nexport function createPointsOnSegment(p1: TPoint, p2: TPoint, spaceBetweenPoint = 1): TPoint[]\n{\n  const points: TPoint[] = []\n  const globalDistance = computeDistance(p1, p2)\n  let spaceWithP1 = spaceBetweenPoint\n  while (spaceWithP1 < globalDistance) {\n    const p = {\n      x: p1.x + (spaceWithP1 * (p2.x - p1.x)) / globalDistance,\n      y: p1.y + (spaceWithP1 * (p2.y - p1.y)) / globalDistance\n    }\n    points.push(p)\n    spaceWithP1 += spaceBetweenPoint\n  }\n  return points\n}\n\n/**\n * @group Utils\n */\nexport function scalaire(v1: TPoint, v2: TPoint): number\n{\n  return v1.x * v2.x + v1.y * v2.y\n}\n\n/**\n * @group Utils\n */\nexport function computeNearestPointOnSegment(p: TPoint, seg: TSegment): TPoint\n{\n  const vectP1P = { x: p.x - seg.p1.x, y: p.y - seg.p1.y }\n  const vectP1P2 = { x: seg.p2.x - seg.p1.x, y: seg.p2.y - seg.p1.y }\n  if (vectP1P2.x === 0 && vectP1P2.y === 0) {\n    return seg.p1\n  }\n  const scalaireP1P_P1P2 = scalaire(vectP1P, vectP1P2)\n  const scalaireP1P2_P1P2 = scalaire(vectP1P2, vectP1P2)\n\n  const t = Math.min(1, Math.max(0, scalaireP1P_P1P2 / scalaireP1P2_P1P2))\n  return { x: seg.p1.x + (vectP1P2.x * t), y: seg.p1.y + (vectP1P2.y * t) }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsideBox(point: TPoint, box: TBox): boolean\n{\n  return isBetween(point.x, box.x, box.x + box.width) && isBetween(point.y, box.y, box.y + box.height)\n}\n\n/**\n * @group Utils\n */\nexport function convertRadianToDegree(radian: number): number\n{\n  return +((radian % (2 * Math.PI)) / Math.PI * 180).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function convertDegreeToRadian(degree: number): number\n{\n  return +((degree % 360) / 180 * Math.PI).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function computeRotatedPoint(point: TPoint, center: TPoint, radian: number): TPoint\n{\n  const dx = point.x - center.x\n  const dy = point.y - center.y\n  const cos = Math.cos(radian)\n  const sin = Math.sin(radian)\n  return {\n    x: +(center.x + cos * dx - sin * dy).toFixed(3),\n    y: +(center.y + sin * dx + cos * dy).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computePointOnEllipse(center: TPoint, radiusX: number, radiusY: number, phi: number, theta: number): TPoint\n{\n  const cosPhi = Math.cos(phi)\n  const sinPhi = Math.sin(phi)\n\n  const M = Math.abs(radiusX) * Math.cos(theta)\n  const N = Math.abs(radiusY) * Math.sin(theta)\n\n  return {\n    x: +(center.x + cosPhi * M - sinPhi * N).toFixed(3),\n    y: +(center.y + sinPhi * M + cosPhi * N).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computeDistanceBetweenPointAndSegment(p: TPoint, seg: TSegment): number\n{\n  return computeDistance(p, computeNearestPointOnSegment(p, seg))\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectionBetween2Segment(seg1: TSegment, seg2: TSegment): TPoint | undefined\n{\n\n  if (seg1.p1.x === seg2.p1.x && seg1.p1.y === seg2.p1.y) return seg1.p1\n  if (seg1.p1.x === seg2.p2.x && seg1.p1.y === seg2.p2.y) return seg1.p1\n\n  if (seg1.p2.x === seg2.p1.x && seg1.p2.y === seg2.p1.y) return seg1.p2\n  if (seg1.p2.x === seg2.p2.x && seg1.p2.y === seg2.p2.y) return seg1.p2\n\n  const S1dx = seg1.p2.x - seg1.p1.x\n  const S1dy = seg1.p2.y - seg1.p1.y\n\n  const S2dx = seg2.p2.x - seg2.p1.x\n  const S2dy = seg2.p2.y - seg2.p1.y\n\n  const S1S2dx = seg1.p1.x - seg2.p1.x\n  const S1S2dy = seg1.p1.y - seg2.p1.y\n\n  const ua_t = S2dx * S1S2dy - S2dy * S1S2dx\n  const ub_t = S1dx * S1S2dy - S1dy * S1S2dx\n  const u_b = S2dy * S1dx - S2dx * S1dy\n\n  if (ua_t === 0 || ub_t === 0 || u_b === 0) return\n\n  const ua = ua_t / u_b\n  const ub = ub_t / u_b\n  if (isBetween(ua, 0, 1) && isBetween(ub, 0, 1)) {\n    return {\n      x: seg1.p1.x + ua * S1dx,\n      y: seg1.p1.y + ua * S1dy\n    }\n  }\n  return\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectBetweenSegmentAndCircle(seg: TSegment, c: TPoint, r: number): TPoint[]\n{\n  const result: TPoint[] = []\n\n  const a = Math.pow(seg.p2.x - seg.p1.x, 2) + Math.pow(seg.p2.y - seg.p1.y, 2)\n  const b = 2 * ((seg.p2.x - seg.p1.x) * (seg.p1.x - c.x) + (seg.p2.y - seg.p1.y) * (seg.p1.y - c.y))\n  const cc = Math.pow(c.x, 2) + Math.pow(c.y, 2) + Math.pow(seg.p1.x, 2) + Math.pow(seg.p1.y, 2) - 2 * (c.x * seg.p1.x + c.y * seg.p1.y) - Math.pow(r, 2)\n  const deter = Math.pow(b, 2) - 4 * a * cc\n\n  if (deter <= 0) return []\n\n  const e = Math.sqrt(deter)\n  const u1 = (-b + e) / (2 * a)\n  const u2 = (-b - e) / (2 * a)\n\n  if ((u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1)) {\n    return result\n  }\n\n  if (isBetween(u1, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u1 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u1 + seg.p1.y\n    })\n  }\n\n  if (isBetween(u2, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u2 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u2 + seg.p1.y\n    })\n  }\n\n  return result\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleRadian(p1: TPoint, center: TPoint, p2: TPoint): number\n{\n  const p1c = Math.sqrt(Math.pow(center.x - p1.x, 2) + Math.pow(center.y - p1.y, 2))\n  const p2c = Math.sqrt(Math.pow(center.x - p2.x, 2) + Math.pow(center.y - p2.y, 2))\n  const p1p2 = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2))\n  return Math.acos((p2c * p2c + p1c * p1c - p1p2 * p1p2) / (2 * p2c * p1c))\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoints(points1: TPoint[], points2: TPoint[]): { p1: TPoint, p2: TPoint }\n{\n  let p1 = points1[0]\n  let p2 = points2[0]\n  let minDistance = Number.MAX_SAFE_INTEGER\n  points1.forEach(_p1 =>\n  {\n    points2.forEach(_p2 =>\n    {\n      const d = computeDistance(_p1, _p2)\n      if (minDistance > d) {\n        minDistance = d\n        p1 = _p1\n        p2 = _p2\n      }\n    })\n  })\n  return { p1, p2 }\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoint(points: TPoint[], point: TPoint): { point?: TPoint, index: number }\n{\n  let minDistance = Number.MAX_SAFE_INTEGER\n  let closest: TPoint | undefined\n  let index = -1\n  points.forEach((p, i) =>\n  {\n    const d = computeDistance(p, point)\n    if (minDistance > d) {\n      minDistance = d\n      closest = p\n      index = i\n    }\n  })\n  return {\n    point: closest,\n    index\n  }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsidePolygon(point: TPoint, points: TPoint[])\n{\n  let inside = false\n  for (let i = 0, j = points.length - 1; i < points.length; j = i++) {\n    const p1 = points[i]\n    const p2 = points[j]\n    const intersect = ((p1.y > point.y) != (p2.y > point.y))\n      && (point.x < (p2.x - p1.x) * (point.y - p1.y) / (p2.y - p1.y) + p1.x)\n    if (intersect) inside = !inside\n  }\n\n  return inside\n}\n","\n/**\n * @group Utils\n */\nexport const isVersionSuperiorOrEqual = (source: string, target: string): boolean =>\n{\n  const sourceParts = source.split(\".\")\n  const targetParts = target.split(\".\")\n\n  for (let i = 0; i < targetParts.length; i++) {\n    const a = Number(targetParts[i])\n    const b = Number(sourceParts[i])\n    if (a > b) return false\n    if (a < b) return true\n  }\n  return true\n}\n","/**\n * @group Utils\n */\nexport async function computeHmac(message: string, applicationKey: string, hmacKey: string): Promise<string>\n{\n  const enc = new TextEncoder()\n  const messageEncoded = enc.encode(message)\n  const keyEncoded = enc.encode(applicationKey + hmacKey)\n\n  const key = await crypto.subtle.importKey(\n    \"raw\",\n    keyEncoded,\n    {\n      name: \"HMAC\",\n      hash: { name: \"SHA-512\" }\n    },\n    false,\n    [\"sign\"]\n  )\n\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    key,\n    messageEncoded\n  )\n\n  const buffer = new Uint8Array(signature)\n  return Array.prototype.map.call(buffer, x => x.toString(16).padStart(2, \"0\")).join(\"\")\n}\n","import { TBox } from \"../symbol\"\n\n/**\n * @group Utils\n */\nexport function convertMillimeterToPixel(mm: number): number\n{\n  return +(mm * 96 / 25.4).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertPixelToMillimeter(px: number): number\n{\n  return +(px / 96 * 25.4).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertBoundingBoxMillimeterToPixel(box?: TBox): TBox\n{\n  if (!box) {\n    return { height: 0, width: 0, x: 0, y: 0}\n  }\n  return {\n    x: convertMillimeterToPixel(box.x),\n    y: convertMillimeterToPixel(box.y),\n    width: convertMillimeterToPixel(box.width),\n    height: convertMillimeterToPixel(box.height),\n  }\n}\n","\n/**\n * @group Utils\n */\nexport function createUUID(): string\n{\n  let dt = Date.now()\n  const uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c)\n  {\n    const r = (dt + Math.random() * 16) % 16 | 0\n    dt = Math.floor(dt / 16)\n    return (c == \"x\" ? r : (r & 0x3 | 0x8)).toString(16)\n  })\n  return uuid\n}\n","\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const mergeDeep = (target: any, ...sources: any[]): any =>\n{\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const isObject = (item: any) =>\n  {\n    return (item && typeof item === \"object\" && !Array.isArray(item))\n  }\n  if (!sources.length) return target\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, { [key]: {} })\n        }\n        mergeDeep(target[key], source[key])\n      }\n      else if (Array.isArray(target[key]) && Array.isArray(source[key])) {\n        target[key] = target[key].concat(source[key])\n      }\n      else {\n        Object.assign(target, { [key]: source[key] })\n      }\n    }\n  }\n  else if (Array.isArray(target) && Array.isArray(source)) {\n    target = target.concat(source)\n  }\n  else if (source) {\n    target = source\n  }\n\n  return mergeDeep(target, ...sources)\n}\n\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isDeepEqual = (object1: any, object2: any) =>\n{\n  const objKeys1 = Object.keys(object1)\n  const objKeys2 = Object.keys(object2)\n\n  if (objKeys1.length !== objKeys2.length) return false\n\n  for (const key of objKeys1) {\n    const value1 = object1[key]\n    const value2 = object2[key]\n\n    const isObjects = isObject(value1) && isObject(value2)\n\n    if (\n      (isObjects && !isDeepEqual(value1, value2)) ||\n      (!isObjects && value1 !== value2)\n    ) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst isObject = (object: any) =>\n{\n  return object && typeof object === \"object\"\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableLanguageList(configuration: PartialDeep<{ server: TServerHTTPConfiguration }>): Promise<{ result: { [key: string]: string } }>\n{\n  if (configuration?.server?.scheme && configuration?.server?.host) {\n    const serverConfig = configuration.server\n    const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/availableLanguageList`)\n    return response.json()\n  } else {\n    return Promise.reject(\"Failed to get languages: configuration.server.scheme & configuration.server.host are required!\")\n  }\n}\n","import { TPoint, TPointer } from \"../symbol\"\n\n/**\n * @group Utils\n */\nexport function computeLinksPointers(point: TPointer, angle: number, width: number): TPoint[]\n{\n  const radius = point.p * width\n  return [\n    {\n      x: +(point.x - (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y + (Math.cos(angle) * radius)).toFixed(3)\n    },\n    {\n      x: +(point.x + (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y - (Math.cos(angle) * radius)).toFixed(3),\n    }\n  ]\n}\n\n/**\n * @group Utils\n */\nexport function computeMiddlePointer(point1: TPointer, point2: TPointer): TPointer\n{\n  return {\n    x: +((point2.x + point1.x) / 2).toFixed(3),\n    y: +((point2.y + point1.y) / 2).toFixed(3),\n    p: +((point2.p + point1.p) / 2).toFixed(3),\n    t: +((point2.t + point1.t) / 2).toFixed(3),\n  }\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport type TApiInfos = {\n  version: string,\n  gitCommit: string,\n  nativeVersion: string\n}\n\n/**\n * @group Utils\n */\nexport async function getApiInfos(configuration?: PartialDeep<{ server: TServerHTTPConfiguration }>): Promise<TApiInfos>\n{\n  try {\n    if (!configuration?.server?.scheme && !configuration?.server?.host) {\n      return Promise.reject(\"Failed to get infos: configuration.server.scheme & configuration.server.host are required!\")\n    }\n    const response = await fetch(`${ configuration.server.scheme }://${ configuration.server.host }/api/v4.0/iink/version`)\n    if (response.ok) {\n      const version = await response.json() as TApiInfos\n      return version\n    }\n    else {\n      //latest version published before this endpoint\n      return { version: \"3.1.3\", gitCommit: \"unknown\", nativeVersion: \"<=3.1.1\" }\n    }\n\n  } catch {\n    //latest version published before this endpoint\n    return { version: \"3.1.3\", gitCommit: \"7e148bd566438ca77dc83cb4edcc6ed0f51a8a15\", nativeVersion: \"<=3.1.1\" }\n   }\n\n}\n","/**\n * @group Logger\n */\nexport enum LoggerLevel\n{\n  DEBUG = \"1\",\n  INFO = \"2\",\n  WARN = \"3\",\n  ERROR = \"4\"\n}\n\n/**\n * @group Logger\n */\nexport enum LoggerCategory\n{\n  EDITOR = \"EDITOR\",\n  RECOGNIZER = \"RECOGNIZER\",\n  GRABBER = \"GRABBER\",\n  GESTURE = \"GESTURE\",\n  EDITOR_EVENT = \"EDITOR_EVENT\",\n  MODEL = \"MODEL\",\n  RENDERER = \"RENDERER\",\n  SMARTGUIDE = \"SMARTGUIDE\",\n  STYLE = \"STYLE\",\n  HISTORY = \"HISTORY\",\n  SYMBOL = \"SYMBOL\",\n  WRITE = \"WRITE\",\n  TRANSFORMER = \"TRANSFORMER\",\n  CONVERTER = \"CONVERTER\",\n  SELECTION = \"SELECTION\",\n  SVGDEBUG = \"SVGDEBUG\",\n  MENU = \"MENU\"\n}\n\n/**\n * @group Logger\n */\nexport class Logger\n{\n  category: LoggerCategory\n  level: LoggerLevel\n\n  constructor(category: LoggerCategory, level: LoggerLevel)\n  {\n    this.category = category\n    this.level = level\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  debug(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.DEBUG >= this.level) {\n      const dataLog = {\n        level: \"debug\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.debug(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  info(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.INFO >= this.level) {\n      const dataLog = {\n        level: \"info\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.info(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  warn(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.WARN >= this.level) {\n      const dataLog = {\n        level: \"warn\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.warn(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  error(functionName: string, ...error: any)\n  {\n    const dataLog = {\n      level: \"error\",\n      from: `${ this.category }.${ functionName }`,\n      message: error,\n    }\n    console.error(dataLog)\n  }\n}\n","import { TLoggerConfiguration } from \"./LoggerConfiguration\"\nimport { Logger, LoggerCategory, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport class LoggerManager\n{\n  static #loggerMap: Map<LoggerCategory, Logger> = new Map()\n\n  static getLogger(name: LoggerCategory): Logger\n  {\n    if (!this.#loggerMap.has(name)) {\n      this.#loggerMap.set(name, new Logger(name, LoggerLevel.ERROR))\n    }\n    return this.#loggerMap.get(name) as Logger\n  }\n\n  static setLoggerLevel(config: TLoggerConfiguration)\n  {\n    Object.keys(config).forEach((lc) =>\n    {\n      LoggerManager.getLogger(lc as LoggerCategory).level = config[lc as LoggerCategory]\n    })\n  }\n}\n","import { LoggerCategory, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport type TLoggerConfiguration = {\n  [key in keyof typeof LoggerCategory]: LoggerLevel\n}\n\n/**\n * @group Logger\n * @source\n */\nexport const DefaultLoggerConfiguration: TLoggerConfiguration = {\n  [LoggerCategory.EDITOR]: LoggerLevel.ERROR,\n  [LoggerCategory.RECOGNIZER]: LoggerLevel.ERROR,\n  [LoggerCategory.GRABBER]: LoggerLevel.ERROR,\n  [LoggerCategory.RENDERER]: LoggerLevel.ERROR,\n  [LoggerCategory.EDITOR_EVENT]: LoggerLevel.ERROR,\n  [LoggerCategory.MODEL]: LoggerLevel.ERROR,\n  [LoggerCategory.SYMBOL]: LoggerLevel.ERROR,\n  [LoggerCategory.SMARTGUIDE]: LoggerLevel.ERROR,\n  [LoggerCategory.GESTURE]: LoggerLevel.ERROR,\n  [LoggerCategory.STYLE]: LoggerLevel.ERROR,\n  [LoggerCategory.HISTORY]: LoggerLevel.ERROR,\n  [LoggerCategory.TRANSFORMER]: LoggerLevel.ERROR,\n  [LoggerCategory.CONVERTER]: LoggerLevel.ERROR,\n  [LoggerCategory.WRITE]: LoggerLevel.ERROR,\n  [LoggerCategory.SELECTION]: LoggerLevel.ERROR,\n  [LoggerCategory.SVGDEBUG]: LoggerLevel.ERROR,\n  [LoggerCategory.MENU]: LoggerLevel.ERROR,\n}\n","import { EditorTool } from \"../Constants\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport { TExport, TExportV2 } from \"../model\"\nimport { IIStroke, TIISymbol, TSymbol } from \"../symbol\"\nimport { THistoryContext } from \"../history\"\nimport { TGestureType } from \"../gesture\"\n\n/**\n * @group Editor\n * @remarks Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"EditorEventName\" raised by using\n * ```ts\n * editor.event.addEventListener(EditorEventName.CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum EditorEventName\n{\n  /**\n   * @remarks event emitted when history has changed i.e. the context of undo-redo\n   */\n  CHANGED = \"changed\",\n  /**\n   * @remarks event emitted when clearing is complete\n   */\n  CLEARED = \"cleared\",\n  /**\n   * @remarks event emitted after the conversion is complete\n   */\n  CONVERTED = \"converted\",\n  /**\n   * @remarks event emitted when the editor encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @remarks event emitted on click on pointer events\n   */\n  POINTEREVENTS = \"pointer_events\",\n  /**\n   * @remarks event emitted after\n   */\n  NOTIF = \"notif\",\n  /**\n   * @remarks event emitted after the end of the export\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @remarks event emitted after the end of the import\n   */\n  IMPORTED = \"imported\",\n  /**\n   * @remarks event emitted when the server is idle after a job\n   */\n  IDLE = \"idle\",\n  /**\n   * @remarks event emitted after full editor initialization\n   */\n  LOADED = \"loaded\",\n  /**\n   * @remarks event emitted session opened\n   */\n  SESSION_OPENED = \"session-opened\",\n  /**\n   * @remarks event emitted after selection change\n   */\n  SELECTED = \"selected\",\n  /**\n   * @remarks event emitted after tool change\n   */\n  TOOL_CHANGED = \"tool-changed\",\n  /**\n   * @remarks event emitted after mode change\n   */\n  UI_UPDATED = \"ui-updated\",\n  /**\n   * @remarks event emitted after stroke synchronized with jiix\n   */\n  SYNCHRONIZED = \"synchronized\",\n  /**\n   * @remarks event emitted after applying a gesture\n   */\n  GESTURED = \"gestured\"\n}\n\n/**\n * @group Editor\n */\nexport class EditorEvent extends EventTarget\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.EDITOR_EVENT);\n  protected abortController: AbortController\n  element: Element\n\n  constructor(element: Element)\n  {\n    super()\n    this.#logger.info(\"constructor\", { element })\n    this.abortController = new AbortController()\n    this.element = element\n  }\n\n  removeAllListeners(): void\n  {\n    this.#logger.info(\"removeAllListeners\")\n    this.abortController.abort()\n    this.abortController = new AbortController()\n  }\n\n  protected emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n    this.element?.dispatchEvent(evt)\n  }\n\n  emitSessionOpened(sessionId: string): void\n  {\n    this.#logger.info(\"emitSessionOpened\")\n    this.emit(EditorEventName.SESSION_OPENED, sessionId)\n  }\n  addSessionOpenedListener(callback: (sessionId: string) => void): void\n  {\n    this.#logger.info(\"addSessionOpenedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SESSION_OPENED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as string),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitLoaded(): void\n  {\n    this.#logger.info(\"emitLoaded\")\n    this.emit(EditorEventName.LOADED)\n  }\n  addLoadedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addLoadedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.LOADED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitNotif(notif: { message: string; timeout?: number }): void\n  {\n    this.#logger.info(\"emitNotif\", { notif })\n    this.emit(EditorEventName.NOTIF, notif)\n  }\n  addNotifListener(callback: (notif: { message: string; timeout?: number }) => void): void\n  {\n    this.#logger.info(\"addNotifListener\", { callback })\n    this.addEventListener(\n      EditorEventName.NOTIF,\n      (evt: unknown) => callback((evt as CustomEvent).detail as { message: string; timeout?: number }),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitError(err: Error): void\n  {\n    this.#logger.info(\"emitError\", { err })\n    this.emit(EditorEventName.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.#logger.info(\"addErrorListener\", { callback })\n    this.addEventListener(\n      EditorEventName.ERROR,\n      (evt: unknown) => callback((evt as CustomEvent).detail as Error),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitExported(exports: TExport | TExportV2): void\n  {\n    this.#logger.info(\"emitExported\", { exports })\n    this.emit(EditorEventName.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport | TExportV2) => void): void\n  {\n    this.#logger.info(\"addExportedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.EXPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport | TExportV2),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitChanged(undoRedoContext: THistoryContext): void\n  {\n    this.#logger.info(\"emitChanged\", { undoRedoContext })\n    this.emit(EditorEventName.CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n  addChangedListener(callback: (context: THistoryContext) => void): void\n  {\n    this.#logger.info(\"addChangedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as THistoryContext),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.#logger.info(\"emitIdle\", { idle })\n    this.emit(EditorEventName.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.#logger.info(\"addIdleListener\", { callback })\n    this.addEventListener(\n      EditorEventName.IDLE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as boolean),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitCleared(): void\n  {\n    this.#logger.info(\"emitCleared\")\n    this.emit(EditorEventName.CLEARED)\n  }\n  addClearedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addClearedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CLEARED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitConverted(exports: TExport): void\n  {\n    this.#logger.info(\"emitConverted\", { exports })\n    this.emit(EditorEventName.CONVERTED, exports)\n  }\n  addConvertedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addConvertedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CONVERTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitImported(exports: TExport): void\n  {\n    this.#logger.info(\"emitImported\", { exports })\n    this.emit(EditorEventName.IMPORTED, exports)\n  }\n  addImportedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addImportedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.IMPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSelected(symbols: TSymbol[]): void\n  {\n    this.#logger.info(\"emitSelected\")\n    this.emit(EditorEventName.SELECTED, symbols)\n  }\n  addSelectedListener(callback: (symbols: TIISymbol[]) => void): void\n  {\n    this.#logger.info(\"addSelectedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SELECTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TIISymbol[]),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitToolChanged(mode: EditorTool): void\n  {\n    this.#logger.info(\"emitToolChanged\")\n    this.emit(EditorEventName.TOOL_CHANGED, mode)\n  }\n  addToolChangedListener(callback: (mode: EditorTool) => void): void\n  {\n    this.#logger.info(\"addToolChangedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.TOOL_CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as EditorTool),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitUIpdated(): void\n  {\n    this.#logger.info(\"emitUIpdated\")\n    this.emit(EditorEventName.UI_UPDATED)\n  }\n  addUIpdatedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addUIpdatedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.UI_UPDATED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSynchronized(): void\n  {\n    this.#logger.info(\"emitSynchronized\")\n    this.emit(EditorEventName.SYNCHRONIZED)\n  }\n  addSynchronizedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addSynchronizedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SYNCHRONIZED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitGestured(gesture: { gestureType: TGestureType, stroke: IIStroke }): void\n  {\n    this.#logger.info(\"emitSynchronized\")\n    this.emit(EditorEventName.GESTURED, gesture)\n  }\n  addGesturedListener(callback: (gesture: { gestureType: TGestureType, stroke: IIStroke }) => void): void\n  {\n    this.#logger.info(\"addSynchronizedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.GESTURED,\n      (evt) => callback((evt as CustomEvent).detail as { gestureType: TGestureType, stroke: IIStroke }),\n      { signal: this.abortController.signal }\n    )\n  }\n}\n","import { EdgeDecoration, TBox, TPoint } from \"../symbol\"\n\n/**\n * @group Exports\n * @remarks List all supported MIME types for export. Please note, the MIME types supported depend on the recognition type configured\n */\nexport enum ExportType\n{\n  JIIX = \"application/vnd.myscript.jiix\",\n  TEXT = \"text/plain\",\n  LATEX = \"application/x-latex\",\n  MATHML = \"application/mathml+xml\",\n  SVG = \"image/svg+xml\",\n  OFFICE_DOCUMENT = \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix  Element type}\n */\nexport enum JIIXELementType\n{\n  Text = \"Text\",\n  Node = \"Node\",\n  Edge = \"Edge\",\n  RawContent = \"Raw Content\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#diagram-item-blocks | Element node kind}\n */\nexport enum JIIXNodeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Rectangle = \"rectangle\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Polygon = \"polygon\",\n  Rhombus = \"rhombus\",\n}\n\n/**\n * @group Exports\n */\nexport enum JIIXEdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#stroke-item | Stroke item}\n */\nexport type TJIIXStrokeItem = {\n  type: \"stroke\"\n  id: string\n  \"full-id\"?: string\n  timestamp?: string\n  X?: number[]\n  Y?: number[]\n  F?: number[]\n  T?: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXBase = {\n  \"bounding-box\"?: TBox\n  items?: TJIIXStrokeItem[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXElementBase<T = string> = TJIIXBase & {\n  id: string\n  type: T\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#word-object | Word object}\n */\nexport type TJIIXWord = TJIIXBase & {\n  id?: string\n  label: string\n  candidates?: string[]\n  \"first-char\"?: number\n  \"last-char\"?: number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#character-object | Character object}\n */\nexport type TJIIXChar = TJIIXBase & {\n  label: string\n  candidates?: string[]\n  word: number\n  grid: TPoint[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXLine = {\n  \"baseline-y\": number\n  \"first-char\"?: number\n  \"last-char\"?: number\n  \"x-height\": number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXTextElement = TJIIXElementBase<JIIXELementType.Text> & {\n  id: string\n  \"bounding-box\"?: TBox\n  label: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n  lines?: TJIIXLine[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Node> & {\n  id: string\n  kind: K\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeCircle = TJIIXNodeElementBase<JIIXNodeKind.Circle> & {\n  id: string\n  cx: number\n  cy: number\n  r: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeEllipse = TJIIXNodeElementBase<JIIXNodeKind.Ellipse> & {\n  id: string\n  cx: number\n  cy: number\n  rx: number\n  ry: number\n  orientation: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRectangle = TJIIXNodeElementBase<JIIXNodeKind.Rectangle> & {\n  id: string\n  height: number\n  width: number\n  x: number\n  y: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeTriangle = TJIIXNodeElementBase<JIIXNodeKind.Triangle> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeParrallelogram = TJIIXNodeElementBase<JIIXNodeKind.Parallelogram> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodePolygon = TJIIXNodeElementBase<JIIXNodeKind.Polygon> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRhombus = TJIIXNodeElementBase<JIIXNodeKind.Rhombus> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElement =\n  TJIIXNodeCircle |\n  TJIIXNodeEllipse |\n  TJIIXNodeRectangle |\n  TJIIXNodeTriangle |\n  TJIIXNodeParrallelogram |\n  TJIIXNodePolygon |\n  TJIIXNodeRhombus\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Edge> & {\n  kind: K\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#line-item | Element line}\n */\nexport type TJIIXEdgeLine = TJIIXEdgeElementBase<JIIXEdgeKind.Line> & {\n  x1: number\n  x2: number\n  y1: number\n  y2: number\n  p1Decoration?: EdgeDecoration\n  p2Decoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgePolyEdge = TJIIXEdgeElementBase<JIIXEdgeKind.PolyEdge> & {\n  edges: TJIIXEdgeLine[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#arc-item | Element arc}\n */\nexport type TJIIXEdgeArc = TJIIXEdgeElementBase<JIIXEdgeKind.Arc> & {\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  startAngle: number,\n  sweepAngle: number\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElement =\n  TJIIXEdgeLine |\n  TJIIXEdgePolyEdge |\n  TJIIXEdgeArc\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/web/jiix | Exports}\n */\nexport type TJIIXElement =\n  TJIIXTextElement |\n  TJIIXNodeElement |\n  TJIIXEdgeElement\n\n/**\n * @group Exports\n */\nexport type TJIIXExport = {\n  type: string\n  id: string\n  \"bounding-box\"?: TBox\n  version: string\n  elements?: TJIIXElement[]\n  label?: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n}\n\n/**\n * @group Exports\n * @remarks\n * List all supported MIME types for export.\n *\n * Attention the MIME types supported depend on the {@link TRecognitionType | type of recognition}\n *\n * {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix | Documentation}\n */\nexport type TExport = {\n  /** @hidden */\n  [key: string]: unknown\n  /**\n   * @remarks vnd.myscript.jiix is used for text and raw-content exports\n   */\n  \"application/vnd.myscript.jiix\"?: TJIIXExport\n  /**\n   * @remarks text/plain is only use for text export\n   */\n  \"text/plain\"?: string\n  /**\n   * @remarks x-latex is only use for math export\n   * @see {@link https://katex.org/docs/browser.html | katex} to render\n   */\n  \"application/x-latex\"?: string\n  /**\n   * @remarks mathml+xml is only use for math export\n   * @see {@link https://www.w3.org/Math/whatIsMathML.html | Mathematical Markup Language}\n   */\n  \"application/mathml+xml\"?: string\n  /**\n   * @remarks svg+xml is only use for diagram export\n   */\n  \"image/svg+xml\"?: string\n  /**\n   * @remarks vnd.openxmlformats-officedocument.presentationml.presentation is only use for diagram export\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Blob | Blob}\n   */\n  \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"?: Blob\n}\n","import { TRecognitionV2Type } from \"../recognizer\"\nimport { TJIIXBase, TJIIXWord } from \"./Export\"\n\n/**\n * @group Exports\n * @remarks List all supported MIME types for export in RecognizersV2. Please note, the MIME types supported depend on the recognition type configured\n */\nexport enum ExportV2Type {\n  JIIX = \"application/vnd.myscript.jiix\",\n  TEXT = \"text/plain\",\n  LATEX = \"application/x-latex\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix  Element type}\n */\n\n\n/**\n * @group Exports\n*/\nexport type JIIXV2RangeItem = {\n  from: { stroke: number }\n  to: { stroke: number }\n}\n\n/**\n * @group Exports\n * @remarks Only in InkRecognizer () activated with recognition.export.JIIXV2.range = true\n */\nexport type JIIXV2Range = JIIXV2RangeItem[]\n\n/**\n * @group Exports\n */\nexport type JIIXV2Base = TJIIXBase & {\n  range?: JIIXV2Range\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ElementBase<T = TRecognitionV2Type> = JIIXV2Base & {\n  id: string\n  type: T\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2LineSpan = {\n  type: string\n  range: JIIXV2RangeItem[]\n  label: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2Line = {\n  type: string\n  range: JIIXV2RangeItem[]\n  label: string\n  spans: JIIXV2LineSpan[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#word-object | Word object}\n */\nexport type JIIXV2Expression = JIIXV2Base & TJIIXWord & {\n  lines: JIIXV2Line[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix#text-interpretation | Text Element }\n */\nexport type JIIXV2TextElement = JIIXV2ElementBase<\"Text\"> & JIIXV2Expression\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix#text-interpretation | Math Element }\n */\nexport type JIIXV2MathElement = JIIXV2ElementBase<\"Math\"> & JIIXV2Expression\n\n/** @group Exports\n */\nexport type JIIXV2DrawingElement = JIIXV2ElementBase<\"Drawing\"> & JIIXV2Expression\n\n/**\n * @group Exports\n */\nexport enum JIIXV2ShapeKind {\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Rectangle = \"rectangle\",\n  Triangle = \"triangle\",\n  IsoscelesTriangle = \"isosceles triangle\",\n  RightTriangle = \"right triangle\",\n  RightIsoscelesTriangle = \"right isosceles triangle\",\n  EquilateralTriangle = \"equilateral triangle\",\n  Quadrilateral = \"quadrilateral\",\n  Trapezoid = \"trapezoid\",\n  Square = \"square\",\n  Parallelogram = \"parallelogram\",\n  Polygon = \"polygon\",\n  Rhombus = \"rhombus\",\n  Line = \"line\",\n  ArcOfEllipse = \"arc of ellipse\",\n  ArcOfCircle = \"arc of circle\",\n  PolyLine = \"polyline\",\n  Arrow = \"arrow\",\n  CurvedDoubleArrow = \"curved double arrow\",\n  CurvedArrow = \"curved arrow\",\n  PolylineArrow = \"polyline arrow\",\n  PolylineDoubleArrow = \"polyline double arrow\",\n  DoubleArrow = \"double arrow\",\n}\n\n/**\n   * @group Exports\n   */\nexport type JIIXV2PolygonType = \"triangle\" | \"isosceles triangle\" | \"right triangle\" | \"right isosceles triangle\" | \"equilateral triangle\" | \"quadrilateral\" | \"trapezoid\" | \"parallelogram\" | \"rhombus\" | \"rectangle\" | \"square\"\n\n/**\n   * @group Exports\n   */\nexport type JIIXV2ShapeItemBase<K = JIIXV2ShapeKind> = JIIXV2ElementBase<K> & {\n  kind: K\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2EllipseBase<K = JIIXV2ShapeKind.Ellipse | JIIXV2ShapeKind.Circle> = JIIXV2ShapeItemBase<JIIXV2ShapeKind.Ellipse | JIIXV2ShapeKind.Circle> & {\n  kind: K\n  id: string\n  cx: number\n  cy: number\n  rx: number\n  ry: number\n  orientation: number\n  type: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2Circle = JIIXV2EllipseBase<JIIXV2ShapeKind.Circle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2Ellipse = JIIXV2EllipseBase<JIIXV2ShapeKind.Ellipse>\n\n/**\n * @group Exports\n */\nexport type JIIXV2PrimitiveArc = {\n  type: \"arc\"\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  startAngle: number,\n  sweepAngle: number\n  startDecoration?: string\n  endDecoration?: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2PrimitiveLine = {\n  type: \"line\"\n  x1: number\n  y1: number\n  x2: number\n  y2: number\n  startDecoration?: string\n  endDecoration?: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2PolygonBase<K = JIIXV2PolygonType> = JIIXV2ShapeItemBase<K> & {\n  kind: K\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygon = JIIXV2PolygonBase<JIIXV2ShapeKind.Polygon>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.Triangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonIsoscelesTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.IsoscelesTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRightTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.RightTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRightIsoscelesTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.RightIsoscelesTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonEquilateralTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.EquilateralTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonQuadrilateral = JIIXV2PolygonBase<JIIXV2ShapeKind.Quadrilateral>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonTrapezoid = JIIXV2PolygonBase<JIIXV2ShapeKind.Trapezoid>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonParallelogram = JIIXV2PolygonBase<JIIXV2ShapeKind.Parallelogram>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRhombus = JIIXV2PolygonBase<JIIXV2ShapeKind.Rhombus>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRectangle = JIIXV2PolygonBase<JIIXV2ShapeKind.Rectangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonSquare = JIIXV2PolygonBase<JIIXV2ShapeKind.Square>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLine = JIIXV2ShapeItemBase<JIIXV2ShapeKind.Line> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLineArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.Arrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLineDoubleArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.DoubleArrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLinePolyline = JIIXV2ShapeItemBase<JIIXV2ShapeKind.PolyLine> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLinePolylineArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.PolylineArrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLinePolylineDoubleArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.PolylineDoubleArrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeCurvedDoubleArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.CurvedDoubleArrow> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeCurvedArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.CurvedArrow> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeArcOfEllipse = JIIXV2ShapeItemBase<JIIXV2ShapeKind.ArcOfEllipse> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeArcOfCircle = JIIXV2ShapeItemBase<JIIXV2ShapeKind.ArcOfCircle> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeElement = JIIXV2Circle | JIIXV2Ellipse | JIIXV2ShapePolygon | JIIXV2ShapePolygonTriangle | JIIXV2ShapePolygonIsoscelesTriangle | JIIXV2ShapePolygonRightTriangle | JIIXV2ShapePolygonRightIsoscelesTriangle | JIIXV2ShapePolygonEquilateralTriangle | JIIXV2ShapePolygonQuadrilateral | JIIXV2ShapePolygonTrapezoid | JIIXV2ShapePolygonParallelogram | JIIXV2ShapePolygonRhombus | JIIXV2ShapePolygonRectangle | JIIXV2ShapePolygonSquare | JIIXV2ShapeLineArrow | JIIXV2ShapeLineDoubleArrow | JIIXV2ShapeLinePolyline | JIIXV2ShapeLinePolylineArrow | JIIXV2ShapeLinePolylineDoubleArrow | JIIXV2ShapeCurvedDoubleArrow | JIIXV2ShapeCurvedArrow | JIIXV2ShapeArcOfEllipse | JIIXV2ShapeArcOfCircle | JIIXV2ShapeLine\n\n/**\n * @group Exports\n * @remarks Only in InkRecognizer () activated with recognition.export.JIIXV2.range = true\n */\nexport type JIIXV2RawContentBase<T = TRecognitionV2Type> = {\n  type: T\n  range?: JIIXV2Range\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentItemText = JIIXV2RawContentBase<\"Text\"> & JIIXV2Expression\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentTextLine = {\n  type: \"Line\"\n  label: string\n  range?: JIIXV2RangeItem\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentShape = JIIXV2RawContentBase<\"Shape\"> & {\n  label: string\n  shape: JIIXV2RawContentItemShape[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentItemShape = JIIXV2RawContentBase<\"Shape\"> & {\n  range: JIIXV2RangeItem[]\n  elements: JIIXV2ShapeElement[]\n}\n\nexport type JIIXV2RawContentElement = JIIXV2RawContentItemText | JIIXV2RawContentItemShape\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/web/JIIXV2 | Exports}\n */\nexport type JIIXV2Element =\n  JIIXV2TextElement |\n  JIIXV2ShapeElement |\n  JIIXV2MathElement |\n  JIIXV2DrawingElement |\n  JIIXV2RawContentElement\n\n/**\n * @group Exports\n */\nexport type JIIXV2Export = JIIXV2Base & {\n  type: string\n  id: string\n  version: string\n  elements?: JIIXV2Element[]\n  label?: string\n  words?: JIIXV2Expression[]\n}\n\n/**\n * @group Exports\n * @remarks\n * List all supported MIME types for export.\n *\n * Attention the MIME types supported depend on the {@link TRecognitionType | type of recognition}\n *\n * {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/JIIXV2 | Documentation}\n */\nexport type TExportV2 = {\n  /** @hidden */\n  [key: string]: unknown\n  /**\n   * @remarks vnd.myscript.jiix is used for text and raw-content exports\n   */\n  \"application/vnd.myscript.jiix\"?: JIIXV2Export\n  /**\n   * @remarks text/plain is only use for text export\n   */\n  \"text/plain\"?: string\n  /**\n   * @remarks x-latex is only use for math export\n   * @see {@link https://katex.org/docs/browser.html | katex} to render\n   */\n  \"application/x-latex\"?: string\n}\n","\nimport style from \"../iink.css\"\n/**\n * @group Editor\n */\nexport type EditorLayerUIInfoModal = {\n  root: HTMLDivElement,\n  text: HTMLParagraphElement\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUIMessage = {\n  root: HTMLDivElement\n  overlay: HTMLDivElement\n  modal: EditorLayerUIInfoModal\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUIState = {\n  root: HTMLDivElement\n  busy: HTMLDivElement\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUI = {\n  root: HTMLDivElement\n  loader: HTMLDivElement\n  message: EditorLayerUIMessage\n  state: EditorLayerUIState\n}\n\n/**\n * @group Editor\n */\nexport class EditorLayer\n{\n  root: HTMLElement\n  ui: EditorLayerUI\n  rendering: HTMLElement\n\n  onCloseModal?: (inError?: boolean) => void\n\n  constructor(root: HTMLElement, rootClassCss: string = \"ms-editor\")\n  {\n    this.root = root\n    this.root.classList.add(rootClassCss)\n    this.rendering = this.createLayerRender()\n    this.ui = this.createLayerUI()\n  }\n\n  render(): void\n  {\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    this.root.prepend(styleElement)\n\n    this.root.appendChild(this.rendering)\n    this.root.appendChild(this.ui.root)\n  }\n\n  createLoader(): HTMLDivElement\n  {\n    const loaderHTML = document.createElement(\"div\")\n    loaderHTML.classList.add(\"loader\")\n    loaderHTML.style.display = \"none\"\n    return loaderHTML\n  }\n  showLoader(): void\n  {\n    this.ui.loader.style.display = \"block\"\n  }\n  hideLoader(): void\n  {\n    this.ui.loader.style.display = \"none\"\n  }\n\n  createMessageOverlay(): HTMLDivElement\n  {\n    const overlay = document.createElement(\"div\")\n    overlay.classList.add(\"message-overlay\")\n    return overlay\n  }\n  closeMessageModal(): void\n  {\n    this.onCloseModal?.(this.ui.message.modal.root.classList.contains(\"error-msg\"))\n    this.hideMessageModal()\n  }\n\n  hideMessageModal(): void\n  {\n    this.ui.message.root.style.display = \"none\"\n    this.ui.message.modal.text.innerText = \"\"\n    this.ui.message.modal.root.classList.remove(\"error-msg\")\n    this.ui.message.modal.root.classList.remove(\"info-msg\")\n  }\n  createMessageModal(): EditorLayerUIInfoModal\n  {\n    const element = document.createElement(\"div\")\n    element.classList.add(\"message-modal\")\n\n    const closeBtn = document.createElement(\"button\")\n    closeBtn.classList.add(\"ms-button\", \"close\")\n    closeBtn.addEventListener(\"pointerup\", this.closeMessageModal.bind(this))\n    element.appendChild(closeBtn)\n\n    const text = document.createElement(\"p\")\n    element.appendChild(text)\n    return { root: element, text }\n  }\n  createMessage(): EditorLayerUIMessage\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"message-container\")\n    root.style.display = \"none\"\n\n    const overlay = this.createMessageOverlay()\n    root.appendChild(overlay)\n\n    const modal = this.createMessageModal()\n    root.appendChild(modal.root)\n\n    return {\n      root,\n      overlay,\n      modal\n    }\n  }\n  showMessageInfo(notif: { message: string, timeout?: number })\n  {\n    this.ui.message.modal.root.classList.add(\"info-msg\")\n    this.ui.message.modal.root.classList.remove(\"error-msg\")\n    this.ui.message.root.style.display = \"block\"\n    this.ui.message.modal.text.innerText = notif.message\n    setTimeout(() =>\n    {\n      this.closeMessageModal()\n    }, notif.timeout || 2500)\n  }\n  showMessageError(err: Error | string)\n  {\n    this.ui.message.modal.root.classList.add(\"error-msg\")\n    this.ui.message.modal.root.classList.remove(\"info-msg\")\n    this.ui.message.root.style.display = \"block\"\n    this.ui.message.modal.text.innerText = typeof err === \"string\" ? err : err.message\n  }\n\n  createBusy(): HTMLDivElement\n  {\n    const busy = document.createElement(\"div\")\n    busy.classList.add(\"busy\")\n    return busy\n  }\n  createState(): EditorLayerUIState\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"state\")\n    root.style.display = \"none\"\n\n    const busy = this.createBusy()\n    root.appendChild(busy)\n\n    return {\n      root,\n      busy\n    }\n  }\n  showState(): void\n  {\n    this.ui.state.root.style.display = \"block\"\n  }\n  hideState(): void\n  {\n    this.ui.state.root.style.display = \"none\"\n  }\n  updateState(idle: boolean): void\n  {\n    if (idle) {\n      this.hideState()\n    }\n    else {\n      this.showState()\n    }\n  }\n\n  createLayerUI(): EditorLayerUI\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"ms-layer-ui\")\n\n    const loader = this.createLoader()\n    root.appendChild(loader)\n\n    const message = this.createMessage()\n    root.appendChild(message.root)\n\n    const state = this.createState()\n    root.appendChild(state.root)\n\n    return {\n      root,\n      loader,\n      message,\n      state\n    }\n  }\n\n  createLayerRender(): HTMLDivElement\n  {\n    const render = document.createElement(\"div\")\n    render.classList.add(\"ms-layer-rendering\")\n    return render\n  }\n\n  destroy(): void\n  {\n    while (this.root.lastChild) {\n      this.root.removeChild(this.root.lastChild)\n    }\n  }\n}\n","import { getApiInfos, PartialDeep, TApiInfos } from \"../utils\"\nimport {\n  LoggerCategory,\n  LoggerManager,\n  DefaultLoggerConfiguration,\n  TLoggerConfiguration\n} from \"../logger\"\nimport { TServerHTTPConfiguration } from \"../recognizer\"\nimport { EditorEvent } from \"./EditorEvent\"\nimport { EditorLayer } from \"./EditorLayer\"\n\n/**\n * @hidden\n * @group Editor\n */\nexport type TEditorConfiguration = {\n  logger: TLoggerConfiguration\n}\n\n/**\n * @group Editor\n * @remarks \"INKV1\" is deprecated use \"INKV2\" instead.\n */\nexport type EditorType = \"INTERACTIVEINK\" | \"INKV1\" | \"INTERACTIVEINKSSR\" | \"INKV2\"\n\n/**\n * @hidden\n * @group Editor\n */\nexport type EditorOptionsBase = {\n  configuration: TEditorConfiguration\n  override?: {\n    cssClass?: string\n  }\n}\n\n/**\n * @hidden\n * @group Editor\n */\nexport abstract class AbstractEditor\n{\n  logger = LoggerManager.getLogger(LoggerCategory.EDITOR)\n  layers: EditorLayer\n  event: EditorEvent\n  info?: TApiInfos\n\n  #loggerConfiguration!: TLoggerConfiguration\n\n  constructor(rootElement: HTMLElement, options?: PartialDeep<EditorOptionsBase>)\n  {\n    this.loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, options?.configuration?.logger)\n    this.logger.info(\"constructor\", { rootElement, options })\n\n    this.event = new EditorEvent(rootElement)\n    this.layers = new EditorLayer(rootElement, options?.override?.cssClass || \"ms-editor\")\n\n    //@ts-ignore\n    rootElement.editor = this\n  }\n\n  get loggerConfiguration(): TLoggerConfiguration\n  {\n    return this.#loggerConfiguration\n  }\n\n  set loggerConfiguration(loggerConfig: TLoggerConfiguration)\n  {\n    this.#loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, loggerConfig)\n    LoggerManager.setLoggerLevel(this.#loggerConfiguration)\n  }\n\n  abstract initialize(): Promise<void>\n\n  abstract clear(): Promise<void>\n\n  abstract destroy(): Promise<void>\n\n  async loadInfo(server: TServerHTTPConfiguration): Promise<TApiInfos>\n  {\n    if (!this.info) {\n      this.info = await getApiInfos({ server })\n    }\n    return this.info\n  }\n}\n","import { isBetween } from \"../utils\"\nimport { TPoint, TSegment } from \"./Point\"\n\n/**\n * @group Symbol\n */\nexport type TBox = {\n  x: number,\n  y: number,\n  width: number,\n  height: number\n}\n\n/**\n * @group Symbol\n */\nexport class Box implements TBox\n{\n  x: number\n  y: number\n  width: number\n  height: number\n\n  constructor(boundindBox: TBox)\n  {\n    if (boundindBox.width < 0) throw new Error(\"width must be positive\")\n    if (boundindBox.height < 0) throw new Error(\"height must be positive\")\n    this.height = boundindBox.height\n    this.width = boundindBox.width\n    this.x = boundindBox.x\n    this.y = boundindBox.y\n  }\n\n  static createFromBoxes(boxes: TBox[]): Box\n  {\n    if (!boxes?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    const x = Math.min(...boxes.map(b => b.x))\n    const width = Math.max(...boxes.map(b => b.x + b.width)) - x\n    const y = Math.min(...boxes.map(b => b.y))\n    const height = Math.max(...boxes.map(b => b.y + b.height)) - y\n    return new Box({ x, y, width, height })\n  }\n\n  static createFromPoints(points: TPoint[]): Box\n  {\n    if (!points?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    const x = Math.min(...points.map(p => p.x))\n    const width = Math.max(...points.map(p => p.x)) - x\n    const y = Math.min(...points.map(p => p.y))\n    const height = Math.max(...points.map(p => p.y)) - y\n    return new Box({ x, y, width, height })\n  }\n\n  static getCorners(box: TBox): TPoint[]\n  {\n    return [\n      { x: box.x, y: box.y },\n      { x: box.x + box.width, y: box.y },\n      { x: box.x + box.width, y: box.y + box.height },\n      { x: box.x, y: box.y + box.height }\n    ]\n  }\n\n  static getSide(box: TBox): TPoint[]\n  {\n    return [\n      { x: box.x + box.width / 2, y: box.y },\n      { x: box.x + box.width, y: box.y + box.height / 2 },\n      { x: box.x + box.width / 2, y: box.y + box.height },\n      { x: box.x, y: box.y + box.height / 2 }\n    ];\n\n  }\n\n  static getCenter(box: TBox): TPoint\n  {\n    return { x: box.x + box.width / 2, y: box.y + box.height / 2 }\n  }\n\n  static getSides(box: TBox): TSegment[]\n  {\n    const vertices = Box.getCorners(box)\n    return vertices.map((p, i) =>\n    {\n      if (i === 3) {\n        return { p1: vertices[0], p2: p }\n      }\n      else {\n        return { p1: p, p2: vertices[i + 1] }\n      }\n    })\n  }\n\n  static isContained(box: TBox, wrapper: TBox): boolean\n  {\n    return isBetween(box.x, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.x + box.width, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.y, wrapper.y, wrapper.y + wrapper.height) &&\n      isBetween(box.y + box.height, wrapper.y, wrapper.y + wrapper.height)\n  }\n\n  static containsPoint(box: TBox, point: TPoint): boolean\n  {\n    return isBetween(point.x, box.x, box.x + box.width) &&\n      isBetween(point.y, box.y, box.y + box.height)\n  }\n\n  static contains(box: TBox, child: TBox): boolean\n  {\n    return isBetween(child.x, box.x, box.x + box.width) &&\n      isBetween(child.x + child.width, box.x, box.x + box.width) &&\n      isBetween(child.y, box.y, box.y + box.height) &&\n      isBetween(child.y + child.height, box.y, box.y + box.height)\n  }\n\n  static overlaps(box1: TBox, box2: TBox): boolean\n  {\n    if (box1.x > box2.x + box2.width) return false\n    if (box1.x + box1.width < box2.x) return false\n    if (box1.y > box2.y + box2.height) return false\n    if (box1.y + box1.height < box2.y) return false\n\n    return true\n  }\n\n  get xMin(): number\n  {\n    return this.x\n  }\n\n  get xMid(): number\n  {\n    return this.x + this.width / 2\n  }\n\n  get xMax(): number\n  {\n    return this.x + this.width\n  }\n\n  get yMin(): number\n  {\n    return this.y\n  }\n\n  get yMid(): number\n  {\n    return this.y + this.height / 2\n  }\n\n  get yMax(): number\n  {\n    return this.y + this.height\n  }\n\n  get corners(): TPoint[]\n  {\n    return Box.getCorners(this)\n  }\n\n  get center(): TPoint\n  {\n    return Box.getCenter(this)\n  }\n\n  get side(): TPoint[]\n  {\n    return Box.getSide(this)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      ...this.corners,\n      this.center\n    ]\n  }\n\n  isContained(wrapper: TBox): boolean\n  {\n    return Box.isContained(this, wrapper)\n  }\n\n  contains(child: TBox): boolean\n  {\n    return Box.contains(this, child)\n  }\n\n  containsPoint(point: TPoint): boolean\n  {\n    return Box.containsPoint(this, point)\n  }\n\n  overlaps(boundaries: TBox): boolean\n  {\n    return Box.overlaps(this, boundaries)\n  }\n}\n","/**\n * @group Style\n * @property {String} color=#000000 Color (supported formats rgb() rgba() hsl() hsla() #rgb #rgba #rrggbb #rrggbbaa)\n * @property {String} width in px\n\n */\nexport type TStyle = {\n  [key: string]: string | number | undefined\n  width: number\n  color: string\n  opacity?: number\n  fill?: string\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultStyle: TStyle = {\n  width: 2,\n  color: \"#000000\",\n//   opacity: 1,\n//   fill: \"transparent\",\n} as const\n","import { PartialDeep } from \"../utils\"\nimport { TStyle } from \"./Style\"\n\n/**\n * @group Style\n * @property {String} -myscript-pen-width=1 Width of strokes and primitives in mm (no other unit is supported yet)\n * @property {String} -myscript-pen-fill-style=none\n * @property {String} -myscript-pen-fill-color=#FFFFFF00 Color filled inside the area delimited by strokes and primitives\n */\nexport type TPenStyle = PartialDeep<TStyle> & {\n  \"-myscript-pen-width\"?: number\n  \"-myscript-pen-fill-style\"?: string\n  \"-myscript-pen-fill-color\"?: string\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultPenStyle: TPenStyle = {\n}\n","import { TPenStyle } from \"./PenStyle\"\n\n/**\n * @group Style\n */\nexport type TThemeMath = {\n  \"font-family\": string\n}\n\n/**\n * @group Style\n */\nexport type TThemeMathSolved = {\n  \"font-family\": string\n  color: string\n}\n\n/**\n * @group Style\n */\nexport type TThemeText = {\n  \"font-family\": string,\n  \"font-size\": number\n}\n\n/**\n * @group Style\n */\nexport type TTheme = {\n  ink: TPenStyle\n  \".math\": TThemeMath\n  \".math-solved\": TThemeMathSolved\n  \".text\": TThemeText\n  [key: string]: unknown\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultTheme: TTheme = {\n  ink: {\n    color: \"#000000\",\n    width: 1,\n    \"-myscript-pen-width\": 1,\n    \"-myscript-pen-fill-style\": \"none\",\n    \"-myscript-pen-fill-color\": \"#FFFFFF00\"\n  },\n  \".math\": {\n    \"font-family\": \"STIXGeneral\"\n  },\n  \".math-solved\": {\n    \"font-family\": \"STIXGeneral\",\n    color: \"#A8A8A8FF\"\n  },\n  \".text\": {\n    \"font-family\": \"MyScriptInter\",\n    \"font-size\": 10\n  }\n}\n","!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.JsonCSS=e():t.JsonCSS=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,\"a\",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p=\"\",e(e.s=1)}([function(t,e,n){\"use strict\";function o(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(e,\"__esModule\",{value:!0});var r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},i=function t(e){var n=this;o(this,t),this.toJSON=function(t){if(\"string\"!=typeof t)return console.error(\"Need a CSS string but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid CSS..!\";var e={},o=void 0,i=void 0,u=void 0;try{t.split(\"{\").forEach(function(t){if(i=t.trim())if(-1===i.indexOf(\"}\"))e[i]={},o=i;else{i.substring(0,i.indexOf(\"}\")).split(\";\").forEach(function(t){(u=t.split(\":\"))&&2===u.length&&(e[o][u[0].trim().replace(/^\\\"|\\\"$/g,\"\")]=n._trimSemiColon(u[1].trim().replace(/^\\\"|\\\"$/g,\"\")))});try{o=i.split(\"}\")[1].trim(),o&&(e[o]={})}catch(t){}}})}catch(t){return\"Not a valid CSS..!\"}return e},this.toCSS=function(t){if(\"object\"!==(void 0===t?\"undefined\":r(t)))return console.error(\"Need a JSON object but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid JSON..!\";var e=\"\";try{for(var n in t)if(t.hasOwnProperty(n)){e+=n+\" {\\n\";for(var o in t[n])t[n].hasOwnProperty(o)&&(e+=o+\": \"+t[n][o]+\";\\n\");e+=\"}\\n\"}}catch(t){return\"Not a valid JSON..!\"}return e},this._trimSemiColon=function(t){return\";\"===t.slice(-1)?t.slice(0,n.length-1):t}};e.default=i},function(t,e,n){\"use strict\";t.exports=n(0).default}])});","import JsonCSS from \"json-css\"\nimport { TTheme } from \"./Theme\"\nimport { TPenStyle } from \"./PenStyle\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst parser: any = new JsonCSS()\n\n/**\n * @group Style\n */\nexport const StyleHelper = {\n  themeToCSS(json: TTheme): string\n  {\n    return parser.toCSS(json) as string\n    // css = css.replace( /[\\r\\n]+/gm, \"\" )\n    // return css\n  },\n  themeToJSON(style: string): TTheme\n  {\n    const theme = parser.toJSON(style) as TTheme\n    theme[\".text\"][\"font-size\"] = Number(theme[\".text\"][\"font-size\"])\n    theme.ink[\"-myscript-pen-width\"] = Number(theme.ink[\"-myscript-pen-width\"])\n    theme.ink.width = Number(theme.ink.width)\n    return theme\n  },\n  penStyleToCSS (penStyle: TPenStyle): string {\n    let css = parser.toCSS({ css: penStyle }) as string\n    css = css.substring(6, css.length - 3)\n    return css\n  },\n  penStyleToJSON (penStyleString: string): TPenStyle {\n    const penStyle = parser.toJSON(`css {${penStyleString}}`).css as TPenStyle\n    if (penStyle.width) {\n      penStyle.width = Number(penStyle.width)\n    } else {\n      delete penStyle.width\n    }\n    if (penStyle[\"-myscript-pen-width\"]) {\n      penStyle[\"-myscript-pen-width\"] = Number(penStyle[\"-myscript-pen-width\"])\n    } else {\n      delete penStyle[\"-myscript-pen-width\"]\n    }\n    return penStyle\n  },\n\n  stringToJSON(style: string): {[key: string]: string}\n  {\n    return parser.toJSON(`css {${style}}`).css\n  },\n  JSONToString(style: {[key: string]: string}): string\n  {\n    return Object.entries(style).map(([k, v]) => `${k}:${v}`).join(\";\")\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { DefaultPenStyle, TPenStyle } from \"./PenStyle\"\nimport { DefaultTheme, TTheme } from \"./Theme\"\n\n/**\n * @group Style\n */\nexport class StyleManager\n{\n  #penStyle!: TPenStyle\n  #theme!: TTheme\n  #penStyleClasses!: string\n  #currentPenStyle!: TPenStyle\n  #logger =  LoggerManager.getLogger(LoggerCategory.STYLE)\n\n  constructor(penStyle?: PartialDeep<TPenStyle>, theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"constructor\", { penStyle, theme })\n    this.setTheme(theme)\n    this.setPenStyleClasses()\n    this.setPenStyle(penStyle)\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.#currentPenStyle || this.#penStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.#penStyle\n  }\n  setPenStyle(style?: PartialDeep<TPenStyle>)\n  {\n    this.#logger.info(\"setPenStyle\", { style })\n    this.#penStyle = mergeDeep(structuredClone(DefaultPenStyle), style || {}) as TPenStyle\n    this.#currentPenStyle = style || (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyle\", this.#currentPenStyle)\n  }\n\n  get theme(): TTheme\n  {\n    return this.#theme\n  }\n  setTheme(theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.#theme = mergeDeep(structuredClone(DefaultTheme), theme || {}) as TTheme\n    this.#logger.debug(\"setTheme\", this.#theme)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.#penStyleClasses\n  }\n  setPenStyleClasses(penStyleClass = \"\")\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClass })\n    this.#penStyleClasses = penStyleClass\n    this.#currentPenStyle = (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyleClasses\", this.#currentPenStyle)\n  }\n\n}\n","import { createUUID, mergeDeep, PartialDeep } from \"../utils\"\nimport { DefaultStyle, TStyle } from \"../style\"\n\n/**\n * @group Symbol\n */\nexport enum DecoratorKind\n{\n  Highlight = \"highlight\",\n  Surround = \"surround\",\n  Underline = \"underline\",\n  Strikethrough = \"strikethrough\",\n}\n\n/**\n * @group Symbol\n */\nexport class IIDecorator\n{\n  id: string\n  kind: DecoratorKind\n  style: TStyle\n\n  constructor(kind: DecoratorKind, style: PartialDeep<TStyle>)\n  {\n    this.id = `${ kind }-${ createUUID() }`\n    this.style = structuredClone(mergeDeep({}, DefaultStyle ,style))\n    this.kind = kind\n  }\n\n  clone(): IIDecorator\n  {\n    const clone = new IIDecorator(this.kind, structuredClone(this.style))\n    clone.id = this.id\n    return clone\n  }\n\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\n\n/**\n * @group Symbol\n */\nexport enum SymbolType\n{\n  Stroke = \"stroke\",\n  Group = \"group\",\n  Shape = \"shape\",\n  Edge = \"edge\",\n  Text = \"text\",\n  Eraser = \"eraser\",\n  Recognized = \"recognized\"\n}\n\n/**\n * @group Symbol\n */\nexport interface TSymbol {\n  id: string\n  creationTime: number\n  modificationDate: number\n  type: string\n  style: PartialDeep<TStyle>\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum EdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Symbol\n */\nexport enum EdgeDecoration\n{\n  Arrow = \"arrow-head\"\n}\n\n/**\n * @group Symbol\n */\nexport abstract class OIEdgeBase<K = EdgeKind> extends IISymbolBase<SymbolType.Edge>\n{\n  readonly kind: K\n  readonly isClosed = false\n\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n\n  constructor(\n    kind: K,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Edge, style)\n    this.kind = kind\n\n    this.startDecoration = startDecoration\n    this.endDecoration = endDecoration\n  }\n\n  abstract get vertices(): TPoint[]\n\n  get bounds(): Box\n  {\n    const bb = Box.createFromPoints(this.vertices)\n    bb.x -= SELECTION_MARGIN / 2\n    bb.y -= SELECTION_MARGIN / 2\n    bb.height += SELECTION_MARGIN\n    bb.width += SELECTION_MARGIN\n    if (this.startDecoration || this.endDecoration) {\n      bb.x -= ((this.style.width || 1) * 2.5)\n      bb.y -= ((this.style.width || 1) * 2.5)\n      bb.height += ((this.style.width || 1) * 5)\n      bb.width += ((this.style.width || 1) * 5)\n    }\n    return bb\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.vertices\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  abstract clone(): OIEdgeBase\n}\n","import { TStyle } from \"../../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum ShapeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygon = \"polygon\",\n  Table = \"table\"\n}\n\n/**\n * @group Symbol\n */\nexport abstract class OIShapeBase<K = ShapeKind> extends IISymbolBase<SymbolType.Shape>\n{\n  readonly kind: K\n  readonly isClosed = true\n\n  constructor(kind: K, style?: PartialDeep<TStyle>)\n  {\n    super(SymbolType.Shape, style)\n    this.kind = kind\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IIStroke } from \"../IIStroke\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum RecognizedKind\n{\n  Text = \"text\",\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygone = \"polygone\",\n}\n\n/**\n * @group Symbol\n */\nexport abstract class IIRecognizedBase<K = RecognizedKind> extends IISymbolBase<SymbolType.Recognized>\n{\n  readonly kind: K\n\n  strokes: IIStroke[]\n\n  constructor(\n    kind: K,\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Recognized, style)\n    this.kind = kind\n    this.strokes = strokes\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.strokes.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.strokes.map(c => c.bounds))\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.strokes.forEach(child => child.style = Object.assign({}, child.style, this.style))\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.strokes.some(s => s.overlaps(box))\n  }\n\n  containsStroke(strokeId: string): boolean\n  {\n    return this.strokes.some(s => s.id === strokeId)\n  }\n\n  removeStrokes(strokeIds: string[]): IIStroke[]\n  {\n    const strokeRemoved = this.strokes.filter(s => strokeIds.includes(s.id))\n    this.strokes = this.strokes.filter(s => !strokeIds.includes(s.id))\n    return strokeRemoved\n  }\n}\n","import { TPoint } from \"../symbol\"\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport type TMatrixTransform = {\n  /**\n   * @remarks scaling x\n   */\n  xx: number,\n  /**\n   * @remarks shearing x\n   */\n  yx: number,\n  /**\n   * @remarks translation x\n   */\n  tx: number,\n  /**\n   * @remarks shearing y\n   */\n  xy: number,\n  /**\n   * @remarks scaling y\n   */\n  yy: number,\n  /**\n   * @remarks translation y\n   */\n  ty: number,\n}\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport class MatrixTransform implements TMatrixTransform\n{\n  xx: number\n  yx: number\n  xy: number\n  yy: number\n  tx: number\n  ty: number\n\n  constructor(xx: number, yx: number, xy: number, yy: number, tx: number, ty: number)\n  {\n    this.xx = xx\n    this.yx = yx\n    this.xy = xy\n    this.yy = yy\n    this.tx = tx\n    this.ty = ty\n  }\n\n  static identity(): MatrixTransform\n  {\n    return new MatrixTransform(1, 0, 0, 1, 0, 0)\n  }\n\n  static applyToPoint(mat: TMatrixTransform, point: TPoint): TPoint\n  {\n    return {\n      x: mat.xx * point.x + mat.xy * point.y + mat.tx,\n      y: mat.yx * point.x + mat.yy * point.y + mat.ty,\n    }\n  }\n\n  static rotation(mat: TMatrixTransform): number\n  {\n    let rotation\n\n    if (mat.xx !== 0 || mat.xy !== 0) {\n      const hypotAc = Math.hypot(mat.xx, mat.xy)\n      rotation = Math.acos(mat.xx / hypotAc) * (mat.xy > 0 ? -1 : 1)\n    } else if (mat.yx !== 0 || mat.yy !== 0) {\n      const hypotBd = Math.hypot(mat.yx, mat.yy)\n      rotation = Math.PI / 2 + Math.acos(mat.yx / hypotBd) * (mat.yy > 0 ? -1 : 1)\n    } else {\n      rotation = 0\n    }\n\n    return rotation\n  }\n\n  static toCssString(matrix: TMatrixTransform): string\n  {\n    return `matrix(${ matrix.xx }, ${ matrix.yx }, ${ matrix.xy }, ${ matrix.yy }, ${ matrix.tx }, ${ matrix.ty })`\n  }\n\n\tinvert() {\n\t\tconst { xx, yx, xy, yy, tx, ty } = this\n\t\tconst denom = xx * yy - yx * xy\n\t\tthis.xx = yy / denom\n\t\tthis.yx = yx / -denom\n\t\tthis.xy = xy / -denom\n\t\tthis.yy = xx / denom\n\t\tthis.tx = (yy * tx - xy * ty) / -denom\n\t\tthis.ty = (yx * tx - xx * ty) / denom\n\t\treturn this\n\t}\n\n  multiply(m: TMatrixTransform): MatrixTransform\n  {\n    const { xx, yx, xy, yy, tx, ty } = this\n    this.xx = xx * m.xx + xy * m.yx\n    this.yx = yx * m.xx + yy * m.yx\n    this.xy = xx * m.xy + xy * m.yy\n    this.yy = yx * m.xy + yy * m.yy\n    this.tx = xx * m.tx + xy * m.ty + tx\n    this.ty = yx * m.tx + yy * m.ty + ty\n    return this\n  }\n\n  translate(tx: number, ty: number): MatrixTransform\n  {\n    return this.multiply({ xx: 1, yx: 0, xy: 0, yy: 1, tx, ty })\n  }\n\n  rotate(radian: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    const cosAngle = Math.round(Math.cos(radian) * 1000) / 1000\n    const sinAngle = Math.round(Math.sin(radian) * 1000) / 1000\n    this.multiply({\n      xx: cosAngle,\n      yx: sinAngle,\n      xy: -sinAngle,\n      yy: cosAngle,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  scale(x: number, y: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    this.multiply({\n      xx: x,\n      yx: 0,\n      xy: 0,\n      yy: y,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  applyToPoint(point: TPoint): TPoint\n  {\n    return MatrixTransform.applyToPoint(this, point)\n  }\n\n  clone(): MatrixTransform\n  {\n    return new MatrixTransform(this.xx, this.yx, this.xy, this.yy, this.tx, this.ty)\n  }\n\n  toCssString(): string\n  {\n    return MatrixTransform.toCssString(this)\n  }\n\n}\n","import { PartialDeep, createUUID, findIntersectionBetween2Segment } from \"../utils\"\nimport { TBox } from \"./Box\"\nimport { TPoint, TSegment } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { MatrixTransform } from \"../transform\"\n\n/**\n * @group Symbol\n */\nexport abstract class IISymbolBase<T extends string = SymbolType> implements TSymbol\n{\n  readonly type: T\n  abstract readonly isClosed: boolean\n  style: TStyle\n\n  id: string\n  creationTime: number\n  modificationDate: number\n  selected: boolean\n  deleting: boolean\n  transform: MatrixTransform\n\n  constructor(type: T, style?: PartialDeep<TStyle>)\n  {\n    this.type = type\n    this.id = `${ this.type }-${ createUUID() }`\n\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.selected = false\n    this.deleting = false\n\n    this.transform = MatrixTransform.identity()\n\n    this.style = Object.assign({}, DefaultStyle, style)\n    if (this.style.opacity) {\n      this.style.opacity = +this.style.opacity\n    }\n    this.style.width = +this.style.width\n  }\n\n  abstract get vertices(): TPoint[]\n\n  abstract get snapPoints(): TPoint[]\n\n  get edges(): TSegment[]\n  {\n    if (this.isClosed) {\n      return this.vertices.map((p, i) =>\n      {\n        if (i === this.vertices.length - 1) {\n          return { p1: p, p2: this.vertices[0] }\n        }\n        else {\n          return { p1: p, p2: this.vertices[i + 1] }\n        }\n      })\n    }\n    else {\n      return this.vertices.slice(0, -1).map((p, i) =>\n      {\n        return { p1: p, p2: this.vertices[i + 1] }\n      })\n    }\n  }\n\n  abstract overlaps(box: TBox): boolean\n\n  abstract clone(): IISymbolBase\n\n  abstract toJSON(): PartialDeep<IISymbolBase>\n\n  isIntersected(seg: TSegment): boolean\n  {\n    return this.edges.some(edge =>\n    {\n      return findIntersectionBetween2Segment(edge, seg)\n    })\n  }\n}\n","import { PartialDeep, isValidNumber } from \"../utils\"\n\n/**\n * @group Symbol\n */\nexport type TPoint = {\n  x: number\n  y: number\n}\n\n/**\n * @group Symbol\n */\nexport type TPointer = TPoint & {\n  t: number\n  p: number\n}\n\n/**\n * @group Symbol\n */\nexport type TSegment = {\n  p1: TPoint\n  p2: TPoint\n}\n\n/**\n * @group Symbol\n */\nexport function isValidPoint(p?: PartialDeep<TPoint>): boolean\n{\n  if (!p) return false\n  if (!isValidNumber(p.x)) return false\n  if (!isValidNumber(p.y)) return false\n  return true\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, computePointOnEllipse, isValidNumber } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgeArc extends OIEdgeBase<EdgeKind.Arc>\n{\n  center: TPoint\n  startAngle: number\n  sweepAngle: number\n  radiusX: number\n  radiusY: number\n  phi: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    startAngle: number,\n    sweepAngle: number,\n    radiusX: number,\n    radiusY: number,\n    phi: number,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>,\n  )\n  {\n    super(EdgeKind.Arc, startDecoration, endDecoration, style)\n    this.center = center\n    this.startAngle = startAngle\n    this.sweepAngle = sweepAngle\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.phi = phi\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.startAngle }-${ this.sweepAngle }-${ this.radiusX }-${ this.radiusY }-${ this.phi }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const length = Math.abs(this.sweepAngle) * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbVertices = Math.max(8, Math.round(length / SELECTION_MARGIN))\n    const angleStep = this.sweepAngle / nbVertices\n    const v: TPoint[] = []\n    const endAngle = this.startAngle + this.sweepAngle\n    if (this.sweepAngle > 0) {\n      for (let angle = this.startAngle; angle < endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    } else {\n      for (let angle = this.startAngle; angle > endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    }\n    v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, endAngle))\n    return v\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      this.vertices[0],\n      this.vertices.at(-1)!\n    ]\n  }\n\n  clone(): IIEdgeArc\n  {\n    const clone = new IIEdgeArc(\n      structuredClone(this.center),\n      this.startAngle,\n      this.sweepAngle,\n      this.radiusX,\n      this.radiusY,\n      this.phi,\n      this.startDecoration,\n      this.endDecoration,\n      structuredClone(this.style)\n    )\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgeArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      startAngle: this.startAngle,\n      sweepAngle: this.sweepAngle,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      phi: this.phi,\n      startDecoration: this.startDecoration,\n      style: this.style,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgeArc>): IIEdgeArc\n  {\n    if (!isValidPoint(partial?.center)) throw new Error(`Unable to create a arc, center point is invalid`)\n    if (!isValidNumber(partial?.startAngle)) throw new Error(`Unable to create a arc, startAngle is invalid`)\n    if (!isValidNumber(partial?.sweepAngle)) throw new Error(`Unable to create a arc, sweepAngle is invalid`)\n    if (!isValidNumber(partial?.radiusX)) throw new Error(`Unable to create a arc, radiusX is invalid`)\n    if (!isValidNumber(partial?.radiusY)) throw new Error(`Unable to create a arc, radiusY is invalid`)\n    const arc = new IIEdgeArc(\n      partial?.center as TPoint,\n      partial.startAngle!,\n      partial.sweepAngle!,\n      partial.radiusX!,\n      partial.radiusY!,\n      partial.phi || 0,\n      partial.startDecoration,\n      partial.endDecoration,\n      partial.style\n    )\n    if (partial.id) {\n      arc.id = partial.id\n    }\n    return arc\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgeLine extends OIEdgeBase<EdgeKind.Line>\n{\n  start: TPoint\n  end: TPoint\n\n  constructor(\n    start: TPoint,\n    end: TPoint,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.Line, startDecoration, endDecoration, style)\n    this.start = start\n    this.end = end\n  }\n\n  get vertices(): TPoint[]\n  {\n    return [\n      this.start,\n      this.end\n    ]\n  }\n\n  clone(): IIEdgeLine\n  {\n    const clone = new IIEdgeLine(structuredClone(this.start), structuredClone(this.end), this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgeLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      start: this.start,\n      end: this.end,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgeLine>): IIEdgeLine\n  {\n    if (!isValidPoint(partial?.start)) throw new Error(`Unable to create a arc, start point is invalid`)\n    if (!isValidPoint(partial?.end)) throw new Error(`Unable to create a arc, end point is invalid`)\n    const line = new IIEdgeLine(partial?.start as TPoint, partial?.end as TPoint, partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      line.id = partial.id\n    }\n    return line\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgePolyLine extends OIEdgeBase<EdgeKind.PolyEdge>\n{\n  points: TPoint[]\n\n  constructor(\n    points: TPoint[],\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.PolyEdge, startDecoration, endDecoration, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  clone(): IIEdgePolyLine\n  {\n    const clone = new IIEdgePolyLine(structuredClone(this.points),this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgePolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgePolyLine>): IIEdgePolyLine\n  {\n    if (!partial?.points?.map(p => isValidPoint(p))) throw new Error(`Unable to create a PolyLine, points are invalid`)\n    const polyline = new IIEdgePolyLine(partial?.points as TPoint[], partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      polyline.id = partial.id\n    }\n    return polyline\n  }\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, findIntersectBetweenSegmentAndCircle, isValidNumber, computeRotatedPoint } from \"../../utils\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box, TBox } from \"../Box\"\n\n/**\n * @group Symbol\n */\nexport class IIShapeCircle extends OIShapeBase<ShapeKind.Circle>\n{\n  center: TPoint\n  radius: number\n  protected _vertices: Map<string, TPoint[]>\n  protected _bounds: Map<string, Box>\n\n  constructor(\n    center: TPoint,\n    radius: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Circle, style)\n    this.center = center\n    this.radius = radius\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n    this._bounds = new Map<string, Box>()\n    this._bounds.set(this.verticesId, this.computedBondingBox())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radius }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const firstPoint: TPoint = {\n      x: this.center.x,\n      y: this.radius + this.center.y\n    }\n    const perimeter = 2 * Math.PI * this.radius\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    const points: TPoint[] = []\n    for (let i = 0; i < nbPoint; i++) {\n      const rad = 2 * Math.PI * (i / nbPoint)\n      points.push(computeRotatedPoint(firstPoint, this.center, rad))\n    }\n    return points\n  }\n\n  protected computedBondingBox(): Box\n  {\n    const boundingBox: TBox = {\n      x: this.center.x - this.radius,\n      y: this.center.y - this.radius,\n      height: this.radius * 2,\n      width: this.radius * 2\n    }\n    return new Box(boundingBox)\n  }\n\n  get bounds(): Box\n  {\n    if (!this._bounds.has(this.verticesId)) {\n      this._bounds.set(this.verticesId, this.computedBondingBox())\n    }\n    return this._bounds.get(this.verticesId)!\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      Box.getSides(box).some(seg => findIntersectBetweenSegmentAndCircle(seg, this.center, this.radius).length)\n  }\n\n  clone(): IIShapeCircle\n  {\n    const clone = new IIShapeCircle(structuredClone(this.center), this.radius, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapeCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      radius: this.radius,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapeCircle\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    const radius = Math.min(width, height) / 2\n    return new IIShapeCircle(center, radius, style)\n  }\n\n  static updateBetweenPoints(circle: IIShapeCircle, origin: TPoint, target: TPoint): IIShapeCircle\n  {\n    circle.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    circle.radius = Math.min(width, height) / 2\n    return circle\n  }\n\n  static create(partial: PartialDeep<IIShapeCircle>): IIShapeCircle\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create circle, center is invalid`)\n    if (!isValidNumber(partial.radius)) throw new Error(`Unable to create circle, radius is undefined`)\n    const circle = new IIShapeCircle(partial.center as TPoint, partial.radius!, partial.style)\n    if (partial.id) {\n      circle.id = partial.id\n    }\n    return circle\n  }\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, computePointOnEllipse, findIntersectionBetween2Segment, isValidNumber, } from \"../../utils\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box, TBox } from \"../Box\"\n\n/**\n * @group Symbol\n */\nexport class IIShapeEllipse extends OIShapeBase<ShapeKind.Ellipse>\n{\n  center: TPoint\n  radiusX: number\n  radiusY: number\n  orientation: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    radiusX: number,\n    radiusY: number,\n    orientation: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Ellipse, style)\n    this.center = center\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.orientation = orientation\n    this._vertices = new Map<string, TPoint[]>()\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radiusX }-${ this.radiusY }-${ this.orientation }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const points: TPoint[] = []\n    const perimeter = 2 * Math.PI * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    for (let i = 0; i < nbPoint; i++) {\n      const theta = 2 * Math.PI * (i / nbPoint)\n      points.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.orientation, theta))\n    }\n\n    return points\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBox): boolean\n  {\n\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): IIShapeEllipse\n  {\n    const clone = new IIShapeEllipse(structuredClone(this.center), this.radiusX, this.radiusY, this.orientation, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapeEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      orientation: this.orientation,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapeEllipse\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const radiusX = Math.abs(origin.x - target.x) / 2\n    const radiusY = Math.abs(origin.y - target.y) / 2\n    return new IIShapeEllipse(center, radiusX, radiusY, 0, style)\n  }\n\n  static updateBetweenPoints(ellipse: IIShapeEllipse, origin: TPoint, target: TPoint): IIShapeEllipse\n  {\n    ellipse.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    ellipse.radiusX = Math.abs(origin.x - target.x) / 2\n    ellipse.radiusY = Math.abs(origin.y - target.y) / 2\n    return ellipse\n  }\n\n  static create(partial: PartialDeep<IIShapeEllipse>): IIShapeEllipse\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create ellipse, center is undefined`)\n    if (!isValidNumber(partial.radiusX)) throw new Error(`Unable to create ellipse, radiusX is undefined`)\n    if (!isValidNumber(partial.radiusY)) throw new Error(`Unable to create ellipse, radiusY is undefined`)\n    const ellipse = new IIShapeEllipse(partial.center as TPoint, partial.radiusX!, partial.radiusY!, partial.orientation || 0, partial.style)\n    if (partial.id) {\n      ellipse.id = partial.id\n    }\n    return ellipse\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box } from \"../Box\"\nimport { PartialDeep } from \"../../utils\"\n\n/**\n * @group Symbol\n */\nexport class IIShapePolygon extends OIShapeBase<ShapeKind.Polygon>\n{\n  points: TPoint[]\n\n  constructor(points: TPoint[], style?: PartialDeep<TStyle>)\n  {\n    super(ShapeKind.Polygon, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  clone(): IIShapePolygon\n  {\n    const clone = new IIShapePolygon(structuredClone(this.points), structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapePolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n    }\n  }\n\n  static create(partial: PartialDeep<IIShapePolygon>): IIShapePolygon\n  {\n    if (!partial?.points || partial?.points?.length < 3) throw new Error(`Unable to create polygon at least 3 points required`)\n    if (partial?.points?.some(p => !isValidPoint(p))) throw new Error(`Unable to create a polygon, one or more points are invalid`)\n    const polygon = new IIShapePolygon(partial.points as TPoint[], partial.style)\n    if (partial.id) {\n      polygon.id = partial.id\n    }\n    return polygon\n  }\n\n  static createTriangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateTriangleBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    poly.points = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createParallelogramBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateParallelogramBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRectangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateRectangleBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRhombusBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n\n  static updateRhombusBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, computeDistance, getClosestPoint } from \"../utils\"\nimport { TStroke, TStrokeToSend } from \"./Stroke\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\n\n/**\n * @group Symbol\n */\nexport class IIStroke extends IISymbolBase<SymbolType.Stroke>\n{\n  readonly isClosed = false\n\n  pointerType: string\n  length: number\n  decorators: IIDecorator[]\n  pointers: Array<TPointer>\n\n  constructor(style?: PartialDeep<TStyle>, pointerType = \"pen\")\n  {\n    super(SymbolType.Stroke, style)\n\n    this.pointerType = pointerType\n    this.pointers = []\n    this.decorators = []\n    this.length = 0\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  static split(strokeToSplit: IIStroke, i: number): { before: IIStroke, after: IIStroke }\n  {\n    const before = new IIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    before.pointers = strokeToSplit.pointers.slice(0, i)\n\n    const after = new IIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    after.pointers = strokeToSplit.pointers.slice(i)\n\n    return { before, after }\n  }\n\n  static substract(stroke: IIStroke, partStroke: IIStroke): { before?: IIStroke, after?: IIStroke }\n  {\n    if (!partStroke.length) return { before: stroke }\n    const result: { before?: IIStroke, after?: IIStroke } = {}\n    const lastPointBeforeStroke = {\n      x: partStroke.pointers[0].x as number,\n      y: partStroke.pointers[0].y as number\n    }\n    const closestLastPointBeforeStroke = getClosestPoint(stroke.pointers, lastPointBeforeStroke)\n    if (closestLastPointBeforeStroke.index > -1) {\n      const newStrokes = IIStroke.split(stroke, closestLastPointBeforeStroke.index)\n      result.before = newStrokes.before\n      result.after = newStrokes.after\n    }\n    const strokeAfter = result.after || stroke\n    const firstPointAfterStroke = {\n      x: partStroke.pointers.at(-1)!.x as number,\n      y: partStroke.pointers.at(-1)!.y as number\n    }\n    const closestFirstPointStrokeAfter = getClosestPoint(strokeAfter.pointers, firstPointAfterStroke)\n    if (closestFirstPointStrokeAfter.index > -1) {\n      const newStrokes = IIStroke.split(strokeAfter, closestFirstPointStrokeAfter.index)\n      result.after = newStrokes.after\n    }\n    if (!result.before?.pointers.length) result.before = undefined\n    if (!result.after?.pointers.length) result.after = undefined\n    return result\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  protected computePressure(distance: number): number\n  {\n    let ratio = 1.0\n    if (distance === this.length) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > this.length - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (this.length - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(point: TPointer): boolean\n  {\n    const lastPointer = this.pointers.at(-1)\n    const delta: number = (2 + ((this.style.width || 1) / 4))\n    return !lastPointer ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  addPointer(pointer: TPointer): void\n  {\n    if (this.filterPointByAcquisitionDelta(pointer)) {\n      const lastPointer = this.pointers.at(-1)\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      this.length += distance\n      pointer.p = this.computePressure(distance)\n      this.pointers.push(pointer)\n      this.modificationDate = Date.now()\n    }\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  clone(): IIStroke\n  {\n    const clone = new IIStroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p =>\n    {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n\n  toJSON(): PartialDeep<IIStroke>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      pointers: this.pointers,\n      style: this.style,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIStroke>): IIStroke\n  {\n    if (!partial.pointers?.length) {\n      throw new Error(`not pointers`)\n    }\n    const stroke = new IIStroke(partial.style, partial.pointerType)\n    if (partial.id) {\n      stroke.id = partial.id\n    }\n    const errors: string[] = []\n    let flag = true\n    partial.pointers?.forEach((pp, pIndex) =>\n    {\n      if (!pp) {\n        errors.push(`no pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`no x at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`no y at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.addPointer(pointer)\n      }\n    })\n\n    if (errors.length) {\n      throw new Error(errors.join(\" and \"))\n    }\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          stroke.decorators.push(new IIDecorator(d.kind, Object.assign({}, stroke.style, d.style)))\n        }\n      })\n    }\n    return stroke\n  }\n}\n\n/**\n * @group Symbol\n * @group Utils\n */\nexport function convertPartialStrokesToOIStrokes(json: PartialDeep<TStroke>[]): IIStroke[]\n{\n  const errors: string[] = []\n  const strokes: IIStroke[] = []\n  json.forEach((j, i) =>\n  {\n    try {\n      strokes.push(IIStroke.create(j as PartialDeep<IIStroke>))\n    } catch (e) {\n      errors.push(`stroke ${ i + 1 } has ${ (e as Error).message }`)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedArc extends IIRecognizedBase<RecognizedKind.Arc>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Arc, strokes, style)\n  }\n\n  clone(): IIRecognizedArc\n  {\n    const clone = new IIRecognizedArc(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedArc>): IIRecognizedArc\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n    const ws = new IIRecognizedArc(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedCircle extends IIRecognizedBase<RecognizedKind.Circle>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Circle, strokes, style)\n  }\n\n  clone(): IIRecognizedCircle\n  {\n    const clone = new IIRecognizedCircle(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedCircle>): IIRecognizedCircle\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedCircle(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedEllipse extends IIRecognizedBase<RecognizedKind.Ellipse>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Ellipse, strokes, style)\n  }\n\n  clone(): IIRecognizedEllipse\n  {\n    const clone = new IIRecognizedEllipse(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedEllipse>): IIRecognizedEllipse\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedEllipse(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedLine extends IIRecognizedBase<RecognizedKind.Line>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Line, strokes, style)\n  }\n\n  clone(): IIRecognizedLine\n  {\n    const clone = new IIRecognizedLine(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedLine>): IIRecognizedLine\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedLine(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedPolyLine extends IIRecognizedBase<RecognizedKind.PolyEdge>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.PolyEdge, strokes, style)\n  }\n\n  clone(): IIRecognizedPolyLine\n  {\n    const clone = new IIRecognizedPolyLine(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedPolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedPolyLine>): IIRecognizedPolyLine\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedPolyLine(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedPolygon extends IIRecognizedBase<RecognizedKind.Polygone>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Polygone, strokes, style)\n  }\n\n  clone(): IIRecognizedPolygon\n  {\n    const clone = new IIRecognizedPolygon(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedPolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedPolygon>): IIRecognizedPolygon\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedPolygon(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIDecorator } from \"../IIDecorator\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedText extends IIRecognizedBase<RecognizedKind.Text>\n{\n  readonly isClosed = false\n\n  decorators: IIDecorator[]\n\n  baseline: number\n  xHeight: number\n  label?: string\n\n  constructor(\n    strokes: IIStroke[],\n    lines: { baseline: number, xHeight: number },\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Text, strokes, style)\n    this.baseline = lines.baseline\n    this.xHeight = lines.xHeight\n    this.decorators = []\n  }\n\n  clone(): IIRecognizedText\n  {\n    const clone = new IIRecognizedText(this.strokes.map(s => s.clone()), { baseline: this.baseline, xHeight: this.xHeight }, structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.label = this.label\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      label: this.label,\n      baseline: this.baseline,\n      xHeight: this.xHeight,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n      decorators: this.decorators.length ? JSON.parse(JSON.stringify(this.decorators)) : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedText>): IIRecognizedText\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n    const line = {\n      baseline: partial.baseline || 0,\n      xHeight: partial.xHeight || 0\n    }\n    const ws = new IIRecognizedText(strokes, line, partial.style)\n\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d =>\n      {\n        if (d?.kind) {\n          ws.decorators.push(new IIDecorator(d.kind, Object.assign({}, ws.style, d.style)))\n        }\n      })\n    }\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { TPoint } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\nimport { IIStroke } from \"./IIStroke\"\nimport { IIText } from \"./IIText\"\nimport { TIISymbol } from \".\"\n\n/**\n * @group Symbol\n */\nexport class IISymbolGroup extends IISymbolBase<SymbolType.Group>\n{\n  readonly isClosed = false\n\n  children: TIISymbol[]\n  decorators: IIDecorator[]\n\n  constructor(\n    children: TIISymbol[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Group, style)\n    this.children = children\n    this.decorators = []\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.children.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.children.map(c => c.bounds))\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.children.forEach(child => {\n      child.style = Object.assign({}, child.style, this.style)\n      switch (child.type) {\n        case SymbolType.Group:\n          child.updateChildrenStyle()\n          break\n        case SymbolType.Text:\n          child.chars.forEach(c =>\n          {\n            if (child.style.color) {\n              c.color = child.style.color\n            }\n          })\n          break\n        case SymbolType.Recognized:\n          child.updateChildrenStyle()\n          break\n      }\n\n    })\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.children.some(s => s.overlaps(box))\n  }\n\n  containsSymbol(strokeId: string): boolean\n  {\n    return IISymbolGroup.containsSymbol(this, strokeId)\n  }\n\n  containsOnlyStroke(): boolean\n  {\n    return IISymbolGroup.containsOnlyStroke(this)\n  }\n\n  extractText(): IIText[]\n  {\n    return IISymbolGroup.extractText(this)\n  }\n\n  extractStrokes(): IIStroke[]\n  {\n    return IISymbolGroup.extractStrokes(this)\n  }\n\n  removeChilds(symbolIds: string[]): IISymbolGroup\n  {\n    return IISymbolGroup.removeChilds(this, symbolIds)\n  }\n\n  static containsOnlyStroke(group: IISymbolGroup): boolean\n  {\n    return group.children.every(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        return IISymbolGroup.containsOnlyStroke(s as IISymbolGroup)\n      }\n      if (s.type === SymbolType.Stroke) {\n        return true\n      }\n      return false\n    })\n  }\n\n  static extractText(group: IISymbolGroup): IIText[]\n  {\n    const texts: IIText[] = []\n    group.children.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Text:\n          texts.push(s)\n          break;\n        case SymbolType.Group:\n          texts.push(...IISymbolGroup.extractText(s))\n          break;\n      }\n    })\n    return texts\n  }\n\n  static extractStrokes(group: IISymbolGroup): IIStroke[]\n  {\n    const strokes: IIStroke[] = []\n    group.children.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break;\n        case SymbolType.Recognized:\n          strokes.push(...s.strokes)\n          break;\n        case SymbolType.Group:\n          strokes.push(...IISymbolGroup.extractStrokes(s))\n          break;\n      }\n    })\n    return strokes\n  }\n\n  static containsSymbol(group: IISymbolGroup, symbolId: string): boolean\n  {\n    return group.children.some(symbol =>\n    {\n      if (symbol.id === symbolId) return true\n      if (symbol.type === SymbolType.Group) {\n        return IISymbolGroup.containsSymbol(symbol, symbolId)\n      }\n      else if (symbol.type === SymbolType.Recognized) {\n        return symbol.containsStroke(symbolId)\n      }\n      return false\n    })\n  }\n\n  static removeChilds(group: IISymbolGroup, symbolIds: string[]): IISymbolGroup\n  {\n    group.children = group.children.filter(s => !symbolIds.includes(s.id))\n    const symbolsToRemove = group.children.slice()\n    symbolsToRemove.forEach(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        if (!s.removeChilds(symbolIds).children.length) {\n          group.children = group.children.filter(s1 => s1.id !== s.id)\n        }\n      }\n      else if (s.type === SymbolType.Recognized) {\n        s.removeStrokes(symbolIds)\n        if (!s.strokes.length) {\n          group.removeChilds([s.id])\n        }\n      }\n    })\n    return group\n  }\n\n  clone(): IISymbolGroup\n  {\n    const clone = new IISymbolGroup(this.children.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<IISymbolGroup>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      children: JSON.parse(JSON.stringify(this.children)),\n      decorators: this.decorators.length ? JSON.parse(JSON.stringify(this.decorators)) : undefined\n    }\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, convertDegreeToRadian, findIntersectionBetween2Segment, isPointInsidePolygon, computeRotatedPoint } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\nimport { Box, TBox } from \"./Box\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\n\n/**\n * @group Symbol\n */\nexport type TIISymbolChar = {\n  id: string\n  label: string\n  fontSize: number\n  fontWeight: \"normal\" | \"bold\"\n  color: string\n  bounds: TBox\n}\n\n/**\n * @group Symbol\n */\nexport class IIText extends IISymbolBase<SymbolType.Text>\n{\n  readonly isClosed = true\n\n  point: TPoint\n  chars: TIISymbolChar[]\n  decorators: IIDecorator[]\n  bounds: Box\n  rotation?: {\n    degree: number,\n    center: TPoint\n  }\n\n  constructor(\n    chars: TIISymbolChar[],\n    point: TPoint,\n    bounds: TBox,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Text, style)\n    this.point = point\n    this.bounds = new Box(bounds)\n    this.chars = chars\n    this.decorators = []\n  }\n\n  get label(): string\n  {\n    return this.chars.map(c => c.label).join(\"\")\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return this.bounds.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    else {\n      return this.bounds.corners\n    }\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    const offsetY = this.bounds.yMax - this.point.y\n    const points = [\n      { x: this.bounds.x, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMax - offsetY },\n      { x: this.bounds.x, y: this.bounds.yMax - offsetY },\n      this.bounds.center\n    ]\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return points\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return points\n  }\n\n  protected getCharCorners(char: TIISymbolChar): TPoint[]\n  {\n    const boxBox = new Box(char.bounds)\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return boxBox.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return boxBox.corners\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.chars.forEach(c => {\n      if (this.style.color) {\n        c.color = this.style.color\n      }\n    })\n    this.modificationDate = Date.now()\n  }\n\n  updateChildrenFont( { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" }): void\n  {\n    this.chars.forEach(c => {\n      if (fontSize) {\n        c.fontSize = fontSize\n      }\n      if (fontWeight) {\n        c.fontWeight = fontWeight\n      }\n    })\n    this.modificationDate = Date.now()\n  }\n\n  getCharsOverlaps(points: TPoint[]): TIISymbolChar[]\n  {\n    return this.chars.filter(c =>\n    {\n      const charCorners = this.getCharCorners(c)\n      return points.some(p => isPointInsidePolygon(p, charCorners))\n    })\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.vertices.some(p => Box.containsPoint(box, p)) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): IIText\n  {\n    const clone = new IIText(structuredClone(this.chars), structuredClone(this.point), this.bounds, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.rotation = this.rotation ? structuredClone(this.rotation) : undefined\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      point: this.point,\n      chars: this.chars,\n      style: this.style,\n      rotation: this.rotation,\n      bounds: this.bounds,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIText>): IIText\n  {\n    if (!isValidPoint(partial?.point)) throw new Error(`Unable to create a IIText, point are invalid`)\n    if (!partial.chars?.length) throw new Error(`Unable to create a IIText, no chars`)\n    if (!partial.bounds) throw new Error(`Unable to create a IIText, no boundingBox`)\n    const text = new IIText(partial.chars as TIISymbolChar[], partial.point as TPoint, partial.bounds as TBox, partial.style)\n    if (partial.id) text.id = partial.id\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          text.decorators.push(new IIDecorator(d.kind, Object.assign({}, text.style, d.style)))\n        }\n      })\n    }\n    return text\n  }\n}\n","import { createUUID, PartialDeep } from \"../utils\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IISymbolBase } from \"./IISymbolBase\"\nimport { TStyle } from \"../style\"\n\nconst style: TStyle = {\n  color: \"grey\",\n  fill: \"none\",\n  width: 12,\n  opacity: 0.2\n}\n\n/**\n * @group Symbol\n */\nexport class IIEraser extends IISymbolBase<SymbolType.Eraser>\n{\n  readonly isClosed = false\n  pointers: TPointer[]\n\n  constructor()\n  {\n    super(SymbolType.Eraser, style)\n    this.id = `${ this.type }-${ createUUID() }`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.pointers = []\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return []\n  }\n\n  clone(): IISymbolBase\n  {\n    const clone = new IIEraser()\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    return clone\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  toJSON(): PartialDeep<IIEraser>\n  {\n    return {\n      id: this.id,\n      pointers: this.pointers,\n      style: this.style\n    }\n  }\n}\n","import { DefaultPenStyle, TPenStyle } from \"../style\"\nimport { PartialDeep, createUUID } from \"../utils\"\nimport { TPointer } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\n\n/**\n * @group Symbol\n */\nexport type TStrokeToSend = {\n  id: string\n  pointerType: string\n  x: number[]\n  y: number[]\n  t: number[]\n  p: number[]\n}\n\n/**\n * @group Symbol\n */\nexport type TStrokeGroupToSend = {\n  penStyle?: string\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Symbol\n */\nexport type TStroke = TSymbol & {\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n}\n\n/**\n * @group Symbol\n */\nexport type TStrokeGroup = {\n  penStyle: TPenStyle\n  strokes: Stroke[]\n}\n\n/**\n * @group Symbol\n */\nexport class Stroke implements TStroke\n{\n  type = SymbolType.Stroke\n  id: string\n  creationTime: number\n  modificationDate: number\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n\n  constructor(style: TPenStyle, pointerType = \"pen\")\n  {\n    this.id = `${this.type}-${createUUID()}`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.style = style\n    this.pointerType = pointerType\n    this.pointers = []\n    this.length = 0\n  }\n\n  clone(): Stroke\n  {\n    const clone = new Stroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p => {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n}\n\n/**\n * @group Symbol\n * @group Utils\n */\nexport function convertPartialStrokesToStrokes(json: PartialDeep<TStroke>[]): Stroke[]\n{\n  const errors: string[] = []\n  const strokes: Stroke[] = []\n  json.forEach((j, ji) => {\n    let flag = true\n    const stroke = new Stroke(j.style || DefaultPenStyle, j.pointerType)\n    if (j.id) stroke.id = j.id\n    if (!j.pointers?.length) {\n      errors.push(`stroke ${ji + 1} has not pointers`)\n      flag = false\n      return\n    }\n    j.pointers?.forEach((pp, pIndex) => {\n      if (!pp) {\n        errors.push(`stroke ${ji + 1} has no pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`stroke ${ji + 1} has no x at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`stroke ${ji + 1} has no y at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.pointers.push(pointer)\n      }\n    })\n    if (flag) {\n      strokes.push(stroke)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TPenStyle } from \"../style\"\nimport { computeDistance } from \"../utils\"\nimport { TExport } from \"./Export\"\nimport { Stroke, TPoint, TPointer } from \"../symbol\"\n\n/**\n * @group Model\n */\nexport type TRecognitionPositions = {\n  lastSentPosition: number\n  lastReceivedPosition: number\n}\n\n/**\n * @group Model\n */\nexport class Model\n{\n  readonly creationTime: number\n  modificationDate: number\n  positions: TRecognitionPositions\n  currentSymbol?: Stroke\n  symbols: Stroke[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.#logger.info(\"constructor\", { width, height, creationDate })\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.positions = {\n      lastSentPosition: 0,\n      lastReceivedPosition: 0\n    }\n    this.idle = true\n  }\n\n  protected computePressure(distance: number, globalDistance: number): number\n  {\n    let ratio = 1.0\n    if (distance === globalDistance) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > globalDistance - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (globalDistance - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(stroke: Stroke, point: TPointer, lastPointer?: TPointer): boolean\n  {\n    const delta: number = (2 + ((stroke.style[\"-myscript-pen-width\"] || 0) / 4))\n    return !lastPointer ||\n      stroke.pointers.length === 0 ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  getStrokeFromPoint(point: TPoint): Stroke[]\n  {\n    this.#logger.info(\"getStrokeFromPoint\", { point })\n    const isBetween = (val: number, min: number, max: number): boolean => (val >= min && val <= max)\n\n    const _strokeList: Stroke[] = []\n    this.symbols.forEach((stroke) =>\n    {\n      for (let i = 0; i < stroke.pointers.length; i++) {\n        const strokePointer = stroke.pointers[i]\n        if (\n          isBetween(strokePointer.x, point.x - 5, point.x + 5) &&\n          isBetween(strokePointer.y, point.y - 5, point.y + 5)\n        ) {\n          _strokeList.push(stroke)\n          break\n        }\n        else {\n          if (computeDistance(point, strokePointer) < 10) {\n            _strokeList.push(stroke)\n            break\n          }\n        }\n      }\n    })\n    this.#logger.debug(\"getStrokeFromPoint\", { strokes: _strokeList })\n    return _strokeList\n  }\n\n  addPoint(stroke: Stroke, pointer: TPointer): void\n  {\n    this.#logger.debug(\"addPoint\", { stroke, pointer })\n    const lastPointer = stroke.pointers.at(-1)\n    if (this.filterPointByAcquisitionDelta(stroke, pointer, lastPointer)) {\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      stroke.length += distance\n      pointer.p = this.computePressure(distance, stroke.length)\n      stroke.pointers.push(pointer)\n      stroke.modificationDate = Date.now()\n    }\n  }\n\n  addStroke(stroke: Stroke): void\n  {\n    this.#logger.info(\"addStroke\", { stroke })\n    this.symbols.push(stroke)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n  }\n\n  updateStroke(updatedStroke: Stroke): void\n  {\n    this.#logger.info(\"updateStroke\", { updatedStroke })\n    const strokeIndex = this.symbols.findIndex((s: Stroke): boolean => s.id === updatedStroke.id)\n    if (strokeIndex !== -1) {\n      updatedStroke.modificationDate = Date.now()\n      this.symbols.splice(strokeIndex, 1, updatedStroke)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateStroke\", this.symbols)\n  }\n\n  removeStroke(id: string): void\n  {\n    this.#logger.info(\"removeStroke\", { id })\n    const strokeIndex = this.symbols.findIndex(s => s.id === id)\n    if (strokeIndex !== -1) {\n      this.positions.lastSentPosition--\n      this.positions.lastReceivedPosition--\n      this.symbols.splice(strokeIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeStroke\", this.symbols)\n  }\n\n  removeStrokesFromPoint(point: TPoint): string[]\n  {\n    this.#logger.info(\"removeStrokesFromPoint\", { point })\n    const strokes = this.getStrokeFromPoint(point)\n    strokes.forEach(strokeToRemove =>\n    {\n      this.removeStroke(strokeToRemove.id)\n    })\n    this.#logger.debug(\"removeStrokesFromPoint\", strokes.map(s => s.id))\n    return strokes.map(s => s.id)\n  }\n\n  extractUnsentStrokes(): Stroke[]\n  {\n    return this.symbols.slice(this.positions.lastSentPosition)\n  }\n\n  initCurrentStroke(point: TPointer, pointerType: string, style: TPenStyle, dpi = 96): void\n  {\n    this.#logger.info(\"initCurrentStroke\", { point, pointerType, style, dpi })\n    if (style[\"-myscript-pen-width\"]) {\n      const pxWidth = (style[\"-myscript-pen-width\"] * dpi) / 25.4\n      style.width = pxWidth / 2\n    }\n    this.modificationDate = Date.now()\n    this.exports = undefined\n    this.currentSymbol = new Stroke(style, pointerType)\n    this.#logger.debug(\"initCurrentStroke\", this.currentSymbol)\n    this.addPoint(this.currentSymbol, point)\n  }\n\n  appendToCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"appendToCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n    }\n    this.#logger.debug(\"appendToCurrentStroke\", this.currentSymbol)\n  }\n\n  endCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"endCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n      this.addStroke(this.currentSymbol)\n      this.currentSymbol = undefined\n    }\n    this.#logger.debug(\"endCurrentStroke\", this.currentSymbol)\n  }\n\n  updatePositionSent(position: number = this.symbols.length): void\n  {\n    this.#logger.info(\"updatePositionSent\", { position })\n    this.positions.lastSentPosition = position\n    this.#logger.debug(\"updatePositionSent\", this.positions.lastSentPosition)\n  }\n\n  updatePositionReceived(): void\n  {\n    this.#logger.info(\"updatePositionReceived\")\n    this.positions.lastReceivedPosition = this.positions.lastSentPosition\n    this.#logger.debug(\"updatePositionReceived\", this.positions.lastReceivedPosition)\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  mergeConvert(converts: TExport)\n  {\n    this.#logger.info(\"mergeConvert\", { converts })\n    if (this.converts) {\n      Object.assign(this.converts, converts)\n    } else {\n      this.converts = converts\n    }\n    this.#logger.debug(\"mergeConvert\", this.converts)\n  }\n\n  clone(): Model\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new Model(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = JSON.parse(JSON.stringify(this.modificationDate))\n    clonedModel.currentSymbol = this.currentSymbol ? this.currentSymbol.clone() : undefined\n    clonedModel.symbols = this.symbols.map(s => s.clone())\n    clonedModel.positions = JSON.parse(JSON.stringify(this.positions))\n    clonedModel.exports = this.exports ? JSON.parse(JSON.stringify(this.exports)) : undefined\n    clonedModel.converts = this.converts ? JSON.parse(JSON.stringify(this.converts)) : undefined\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.currentSymbol = undefined\n    this.symbols = []\n    this.positions.lastSentPosition = 0\n    this.positions.lastReceivedPosition = 0\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport\n{\n  RecognizedKind,\n  SymbolType,\n  TIISymbol,\n} from \"../symbol\"\nimport { TExport } from \"./Export\"\n\n/**\n * @group Model\n */\nexport class IIModel\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n  readonly creationTime: number\n  modificationDate: number\n  currentSymbol?: TIISymbol\n  symbols: TIISymbol[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.symbols.filter(s => s.selected)\n  }\n\n  get symbolsToDelete(): TIISymbol[]\n  {\n    return this.symbols.filter(s => s.deleting)\n  }\n\n  selectSymbol(id: string): void\n  {\n    const symbol = this.symbols.find(s => s.id === id || (s.type === SymbolType.Group && s.containsSymbol(id)))\n    if (symbol) {\n      symbol.selected = true\n    }\n  }\n\n  unselectSymbol(id: string): void\n  {\n    const symbol = this.symbols.find(s => s.id === id)\n    if (symbol) {\n      symbol.selected = false\n    }\n  }\n\n  resetSelection(): void\n  {\n    this.symbols.forEach(s => s.selected = false)\n  }\n\n  getRootSymbol(id: string): TIISymbol | undefined\n  {\n    return this.symbols.find(s =>\n    {\n      if (s.id === id) return s\n      if (s.type === SymbolType.Group && s.containsSymbol(id)) {\n        return s\n      }\n      if (s.type === SymbolType.Recognized && s.containsStroke(id)) {\n        return s\n      }\n      return\n    })\n  }\n\n  getSymbolRowIndex(symbol: TIISymbol): number\n  {\n    return Math.round((symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text ? symbol.baseline : symbol.bounds.yMid) / this.rowHeight)\n  }\n\n  getSymbolsByRowOrdered(): { rowIndex: number, symbols: TIISymbol[] }[]\n  {\n    const rows: { rowIndex: number, symbols: TIISymbol[] }[] = []\n    this.symbols.forEach(s =>\n    {\n      const rowIndex = this.getSymbolRowIndex(s)\n      const row = rows.find(r => r.rowIndex === rowIndex)\n      if (row) {\n        row.symbols.push(s)\n      }\n      else {\n        rows.push({ rowIndex, symbols: [s] })\n      }\n    })\n    rows.forEach(r =>\n    {\n      r.symbols.sort((s1, s2) => s1.bounds.xMid - s2.bounds.xMid)\n    })\n    return rows.sort((r1, r2) => r1.rowIndex - r2.rowIndex)\n  }\n\n  roundToLineGuide(y: number): number\n  {\n    return Math.round(y / this.rowHeight) * this.rowHeight\n  }\n\n  isSymbolAbove(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) > this.getSymbolRowIndex(target)\n  }\n\n  isSymbolInRow(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) === this.getSymbolRowIndex(target)\n  }\n\n  isSymbolBelow(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) < this.getSymbolRowIndex(target)\n  }\n\n  getFirstSymbol(symbols: TIISymbol[]): TIISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (this.getSymbolRowIndex(previous) < this.getSymbolRowIndex(current)) {\n          return previous\n        }\n        else if (this.getSymbolRowIndex(previous) == this.getSymbolRowIndex(current) && previous.bounds.xMid < current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  getLastSymbol(symbols: TIISymbol[]): TIISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (this.getSymbolRowIndex(previous) > this.getSymbolRowIndex(current)) {\n          return previous\n        }\n        if (this.getSymbolRowIndex(previous) < this.getSymbolRowIndex(current)) {\n          return current\n        }\n        else if (previous.bounds.xMid > current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  addSymbol(symbol: TIISymbol): void\n  {\n    this.#logger.info(\"addSymbol\", { symbol })\n    const sIndex = this.symbols.findIndex(s => s.id === symbol.id)\n    if (sIndex > -1) {\n      throw new Error(`Symbol id already exist: ${ symbol.id }`)\n    }\n    this.symbols.push(symbol)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n    this.#logger.debug(\"addSymbol\", this.symbols)\n  }\n\n  updateSymbol(updatedSymbol: TIISymbol): void\n  {\n    this.#logger.info(\"updateSymbol\", { updatedSymbol })\n    const sIndex = this.symbols.findIndex(s => s.id === updatedSymbol.id)\n    if (sIndex !== -1) {\n      updatedSymbol.modificationDate = Date.now()\n      this.symbols.splice(sIndex, 1, updatedSymbol)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateSymbol\", this.symbols)\n  }\n\n  replaceSymbol(id: string, symbols: TIISymbol[]): void\n  {\n    const sIndex = this.symbols.findIndex(s => s.id === id)\n    if (sIndex !== -1) {\n      this.symbols.splice(sIndex, 1, ...symbols)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n  }\n\n  changeOrderSymbol(id: string, position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    const fromIndex = this.symbols.findIndex(s => s.id === id)\n    if (fromIndex > -1) {\n      let toIndex = fromIndex\n      switch (position) {\n        case \"first\":\n          toIndex = 0\n          break\n        case \"last\":\n          toIndex = this.symbols.length - 1\n          break\n        case \"forward\":\n          toIndex = Math.min(toIndex + 1, this.symbols.length - 1)\n          break\n        case \"backward\":\n          toIndex = Math.max(toIndex - 1, 0)\n          break\n      }\n      const sym = this.symbols.splice(fromIndex, 1)[0]\n      this.symbols.splice(toIndex, 0, sym)\n    }\n  }\n\n  removeSymbol(id: string): void\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    const symbolIndex = this.symbols.findIndex(s => s.id === id)\n    if (symbolIndex !== -1) {\n      this.symbols.splice(symbolIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeSymbol\", this.symbols)\n  }\n\n  extractDifferenceSymbols(model: IIModel): { added: TIISymbol[], removed: TIISymbol[] }\n  {\n    return {\n      added: this.symbols.filter(s1 => model.symbols.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1),\n      removed: model.symbols.filter(s1 => this.symbols.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1)\n    }\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  clone(): IIModel\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new IIModel(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = this.modificationDate\n    clonedModel.symbols = this.symbols.map(s =>\n    {\n      const c = s.clone()\n      c.selected = false\n      return c\n    })\n    clonedModel.exports = structuredClone(this.exports)\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.symbols = []\n    this.currentSymbol = undefined\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIStroke } from \"../symbol\"\nimport { TExportV2 } from \"./ExportV2\"\n\n/**\n * @group Model\n */\nexport class IModel\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n  readonly creationTime: number\n  modificationDate: number\n  currentStroke?: IIStroke\n  strokes: IIStroke[]\n  exports?: TExportV2\n  converts?: TExportV2\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.strokes = []\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n\n  get strokesToDelete(): IIStroke[]\n  {\n    return this.strokes.filter(s => s.deleting)\n  }\n\n  addStroke(stroke: IIStroke): void\n  {\n    this.#logger.info(\"addStroke\", { stroke })\n    const sIndex = this.strokes.findIndex(s => s.id === stroke.id)\n    if (sIndex > -1) {\n      throw new Error(`Stroke id already exist: ${ stroke.id }`)\n    }\n    this.strokes.push(stroke)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n    this.#logger.debug(\"addStroke\", this.strokes)\n  }\n\n  updateStroke(updatedStroke: IIStroke): void\n  {\n    this.#logger.info(\"updateStroke\", { updatedStroke })\n    const sIndex = this.strokes.findIndex(s => s.id === updatedStroke.id)\n    if (sIndex !== -1) {\n      updatedStroke.modificationDate = Date.now()\n      this.strokes.splice(sIndex, 1, updatedStroke)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateStroke\", this.strokes)\n  }\n\n  removeStroke(id: string): void\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    const strokeIndex = this.strokes.findIndex(s => s.id === id)\n    if (strokeIndex !== -1) {\n      this.strokes.splice(strokeIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeSymbol\", this.strokes)\n  }\n\n  extractDifferenceStrokes(model: IModel): { added: IIStroke[], removed: IIStroke[] }\n  {\n    return {\n      added: this.strokes.filter(s1 => model.strokes.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1),\n      removed: model.strokes.filter(s1 => this.strokes.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1)\n    }\n  }\n\n  mergeExport(exports: TExportV2)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  clone(): IModel\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new IModel(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = this.modificationDate\n    clonedModel.strokes = this.strokes.map(s =>\n    {\n      const c = s.clone()\n      c.selected = false\n      return c\n    })\n    clonedModel.exports = structuredClone(this.exports)\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.strokes = []\n    this.exports = undefined\n    this.converts = undefined\n    this.currentStroke = undefined\n    this.idle = true\n\n  }\n}\n","/**\n * @group Recognizer\n */\nexport type TScheme = \"https\" | \"http\"\n\n/**\n * @group Recognizer\n */\nexport type TServerHTTPConfiguration = {\n  scheme: TScheme,\n  host: string\n  applicationKey: string\n  hmacKey: string | ((applicationKey: string) => Promise<string>)\n  version?: string\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultServerHTTPConfiguration: TServerHTTPConfiguration = {\n  scheme: \"https\",\n  host: \"cloud.myscript.com\",\n  applicationKey: \"\",\n  hmacKey: \"\",\n  version: \"\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TServerWebsocketConfiguration = TServerHTTPConfiguration & {\n  websocket: {\n    pingEnabled: boolean\n    pingDelay: number\n    maxPingLostCount: number\n    autoReconnect: boolean\n    maxRetryCount: number\n    fileChunkSize: number\n  }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultServerWebsocketConfiguration: TServerWebsocketConfiguration = {\n  ...DefaultServerHTTPConfiguration,\n  websocket: {\n    pingEnabled: true,\n    pingDelay: 15000,\n    maxPingLostCount: 20,\n    autoReconnect: true,\n    maxRetryCount: 2,\n    fileChunkSize: 300000\n  }\n}\n","\n/**\n * @group Recognizer\n */\nexport type TEraserConfiguration = {\n  \"erase-precisely\": boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultEraserConfiguration: TEraserConfiguration = {\n  \"erase-precisely\": false\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TDiagramConvertConfiguration = {\n  types?: (\"text\" | \"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TDiagramConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  text?: TTextConfConfiguration\n  convert?: TDiagramConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDiagramConvertConfiguration: TDiagramConvertConfiguration = {\n  types: [\"text\", \"shape\"],\n  \"match-text-size\": true\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDiagramConfiguration: TDiagramConfiguration = {\n  convert: DefaultDiagramConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\n/**\n * @group Recognizer\n */\nexport type TImageViewportConfiguration = {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TImageConfiguration = {\n  guides: boolean\n  viewport: TImageViewportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TJiixConfiguration = {\n  \"bounding-box\": boolean\n  strokes: boolean\n  ids: boolean\n  \"full-stroke-ids\": boolean\n  text: {\n    chars: boolean\n    words: boolean\n    lines?: boolean\n  }\n  style?: boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultJiixConfiguration: TJiixConfiguration = {\n  \"bounding-box\": false,\n  strokes: false,\n  ids: false,\n  \"full-stroke-ids\": false,\n  text: {\n    chars: false,\n    words: true,\n    lines: false\n  },\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathMLFlavor = {\n  name: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathMLExport = {\n  flavor: TMathMLFlavor\n}\n\n/**\n * @group Recognizer\n */\nexport type TExportConfiguration = {\n  \"image-resolution\"?: number\n  image?: TImageConfiguration\n  jiix: TJiixConfiguration\n  mathml?: TMathMLExport\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultExportConfiguration: TExportConfiguration = {\n  \"image-resolution\": 300,\n  jiix: DefaultJiixConfiguration\n}\n","\n/**\n * @group Recognizer\n */\nexport type TMarginConfiguration = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMarginConfiguration: TMarginConfiguration = {\n  top: 20,\n  left: 10,\n  right: 10,\n  bottom: 10\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRoundingMode = \"half up\" | \"truncate\"\n\n/**\n * @group Recognizer\n */\nexport type TAngleUnit = \"deg\" | \"rad\"\n\n/**\n * @group Recognizer\n */\nexport type TSolverOptions = \"algebraic\" | \"numeric\"\n\n/**\n * @group Recognizer\n */\nexport type TSolverConfiguration = {\n  enable?: boolean\n  \"fractional-part-digits\"?: number\n  \"decimal-separator\"?: string\n  \"rounding-mode\"?: TRoundingMode\n  \"angle-unit\"?: TAngleUnit\n  options?: TSolverOptions\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultSolverConfiguration: TSolverConfiguration = {\n  enable: true,\n  \"fractional-part-digits\": 3,\n  \"decimal-separator\": \".\",\n  \"rounding-mode\": \"half up\",\n  \"angle-unit\": \"deg\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TUndoRedoMode = \"stroke\" | \"session\"\n\n/**\n * @group Recognizer\n */\nexport type TMathUndoRedoConfiguration = {\n  mode: TUndoRedoMode\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMathUndoRedoConfiguration: TMathUndoRedoConfiguration = {\n  mode: \"stroke\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathConfiguration = {\n  mimeTypes: (\"application/x-latex\" | \"application/mathml+xml\" | \"application/vnd.myscript.jiix\")[]\n  solver?: TSolverConfiguration\n  margin: TMarginConfiguration\n  \"undo-redo\"?: TMathUndoRedoConfiguration\n  customGrammar?: string\n  customGrammarId?: string\n  customGrammarContent?: string\n  eraser?: TEraserConfiguration\n  \"session-time\"?: number\n  \"recognition-timeout\"?: number\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMathConfiguration: TMathConfiguration = {\n  solver: DefaultSolverConfiguration,\n  margin: DefaultMarginConfiguration,\n  eraser: DefaultEraserConfiguration,\n  \"undo-redo\": DefaultMathUndoRedoConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRawContentConfiguration = {\n  text?: TTextConfConfiguration\n  \"session-time\"?: number\n  recognition: {\n    types: (\"text\" | \"shape\" | \"math\" | \"decoration\")[]\n  }\n  classification: {\n    types: (\"text\" | \"shape\" | \"math\" | \"decoration\" | \"drawing\")[]\n  }\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRawContentConfiguration: TRawContentConfiguration = {\n  recognition: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\"]\n  },\n  classification: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\", \"drawing\"]\n  },\n  eraser: DefaultEraserConfiguration,\n}\n","\n/**\n * @group Recognizer\n */\nexport type TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": boolean\n  \"draw-image-boxes\": boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDebugConfiguration: TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": false,\n  \"draw-image-boxes\": false\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionRendererConfiguration = {\n  debug: TRecognitionRendererDebugConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognitionRendererConfiguration: TRecognitionRendererConfiguration = {\n  debug: DefaultDebugConfiguration\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TTextGuidesConfiguration = {\n  enable: boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextGuidesConfiguration: TTextGuidesConfiguration = {\n  enable: true\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextConfiguration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides?: TTextGuidesConfiguration\n  configuration?: TTextConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextConfiguration: TTextConfiguration = {\n  guides: DefaultTextGuidesConfiguration,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TTextGuidesConfigurationV2 = {\n  enable: boolean,\n  \"line-gap-mm\"?: number,\n  \"origin-y-mm\"?: number,\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextGuidesConfigurationV2: TTextGuidesConfigurationV2 = {\n  enable: true,\n  \"line-gap-mm\": 100,\n  \"origin-y-mm\": 0,\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextRecognizerHTTPV2ConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextRecognizerHTTPV2Configuration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides: TTextGuidesConfigurationV2\n  configuration?: TTextRecognizerHTTPV2ConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTexConfigurationV2: TTextRecognizerHTTPV2Configuration = {\n  guides: DefaultTextGuidesConfigurationV2,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TShapeConvertConfiguration = {\n  types?: (\"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\nexport type TShapeBeautificationConfiguration = {\n    enable?: true\n}\n/**\n * @group Recognizer\n */\nexport type TShapeConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  convert?: TShapeConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n  beautification?: TShapeBeautificationConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultShapeConvertConfiguration: TShapeConvertConfiguration = {\n  types: [\"shape\"],\n  \"match-text-size\": true\n}\n\nexport const DefaultShapeBeautificationConfiguration: TShapeBeautificationConfiguration = {\n    enable: true\n  }\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultShapeConfiguration: TShapeConfiguration = {\n  convert: DefaultShapeConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n  beautification: DefaultShapeBeautificationConfiguration\n}\n","import { DefaultEraserConfiguration } from \"./EraserConfiguration\";\nimport { DefaultMarginConfiguration } from \"./MarginConfiguration\";\nimport { DefaultMathUndoRedoConfiguration, DefaultSolverConfiguration, TMathConfiguration } from \"./MathConfiguration\";\n\nexport const DefaultMathV2Configuration: TMathConfiguration = {\n  solver: DefaultSolverConfiguration,\n  margin: DefaultMarginConfiguration,\n  eraser: DefaultEraserConfiguration,\n  \"undo-redo\": DefaultMathUndoRedoConfiguration,\n  mimeTypes: [\"application/x-latex\"],\n}","import { DefaultEraserConfiguration } from \"./EraserConfiguration\";\nimport { TRawContentConfiguration } from \"./RawContentConfiguration\";\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRawContentV2Configuration: TRawContentConfiguration = {\n  recognition: {\n    types: [ \"text\", \"math\", \"shape\"]\n  },\n  classification: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\", \"drawing\"]\n  },\n  eraser: DefaultEraserConfiguration,\n}\n","import { THistoryContext } from \"../history\"\nimport { TExport } from \"../model\"\nimport { TRecognizerWebSocketSSRMessageSVGPatch } from \"./RecognizerWebSocketSSRMessage\"\n\n/**\n * @group Recognizer\n * @summary\n * Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"RecognizerEventName\" raised by using\n * ```ts\n * recognizer.events.addEventListener(RecognizerEventName.CONTENT_CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum RecognizerEventName\n{\n  /**\n   * @summary event emitted at the start of connection initialization\n   */\n  START_INITIALIZATION = \"start-initialization\",\n  /**\n   * @summary event emitted after full recognizer initialization\n   */\n  END_INITIALIZATION = \"end-initialization\",\n  /**\n   * @summary event emitted after receiving an \"contentChanged\" message\n   */\n  CONTENT_CHANGED = \"content-changed\",\n  /**\n   * @summary event emitted after receiving an \"idle\" message\n   */\n  IDLE = \"idle\",\n  /**\n   * @summary event emitted after receiving an \"exported\" message\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @summary event emitted when the recognizer encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @remarks event emitted after connection closed\n   */\n  CONNECTION_CLOSE = \"connection-close\",\n  /**\n   * @summary\n   * event emitted after receiving an \"svgPatch\" message\n   * @remarks\n   * only usable in the case of websocket\n   */\n  SVG_PATCH = \"svg-patch\",\n  /**\n   * @summary event emitted session opened\n   */\n  SESSION_OPENED = \"session-opened\",\n\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerEvent extends EventTarget\n{\n  protected abortController: AbortController\n\n  constructor()\n  {\n    super()\n    this.abortController = new AbortController()\n  }\n\n  removeAllListeners(): void\n  {\n    this.abortController.abort()\n    this.abortController = new AbortController()\n  }\n\n  protected emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n  }\n\n  emitStartInitialization(): void\n  {\n    this.emit(RecognizerEventName.START_INITIALIZATION)\n  }\n  addStartInitialization(callback: () => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.START_INITIALIZATION,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitEndtInitialization(): void\n  {\n    this.emit(RecognizerEventName.END_INITIALIZATION)\n  }\n  addEndInitialization(callback: () => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.END_INITIALIZATION,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSessionOpened(sessionId: string): void\n  {\n    this.emit(RecognizerEventName.SESSION_OPENED, sessionId)\n  }\n  addSessionOpenedListener(callback: (sessionId: string) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.SESSION_OPENED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as string),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitContentChanged(undoRedoContext: THistoryContext): void\n  {\n    this.emit(RecognizerEventName.CONTENT_CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n  addContentChangedListener(callback: (context: THistoryContext) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.CONTENT_CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as THistoryContext),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.emit(RecognizerEventName.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.IDLE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as boolean),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitExported(exports: TExport): void\n  {\n    this.emit(RecognizerEventName.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.EXPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitError(err: Error): void\n  {\n    this.emit(RecognizerEventName.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.ERROR,\n      (evt: unknown) => callback((evt as CustomEvent).detail as Error),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitConnectionClose({ code, message }: { code: number, message?: string }): void\n  {\n    this.emit(RecognizerEventName.CONNECTION_CLOSE, { code, message })\n  }\n  addConnectionCloseListener(callback: ({ code, message }: { code: number, message?: string }) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.CONNECTION_CLOSE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as { code: number, message?: string }),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  /**\n   * @remarks only use in the case of websocket\n   */\n  emitSVGPatch(svgPatch: TRecognizerWebSocketSSRMessageSVGPatch): void\n  {\n    this.emit(RecognizerEventName.SVG_PATCH, svgPatch)\n  }\n  /**\n   * @remarks only usable in the case of websocket\n   */\n  addSVGPatchListener(callback:  (svgPatch: TRecognizerWebSocketSSRMessageSVGPatch) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.SVG_PATCH,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TRecognizerWebSocketSSRMessageSVGPatch),\n      { signal: this.abortController.signal }\n    )\n  }\n}\n","/**\n * @group Recognizer\n * @remarks List all errors generated by the backend with their descriptions\n */\nexport enum RecognizerError {\n  NO_ACTIVITY = \"Session closed due to no activity. Without a connection on your part, it will be permanently lost after an hour.\",\n  WRONG_CREDENTIALS = \"Application credentials are invalid. Please check or regenerate your application key and hmackey.\",\n  TOO_OLD = \"Session is too old. Max Session Duration Reached.\",\n  NO_SESSION_FOUND = \"No sessions found. Without activation for 1 hour, sessions are deleted from the server. To avoid losing your work, use the json export, then import it this will create a new session.\",\n  UNKNOW = \"An unknown error has occurred.\",\n  ABNORMAL_CLOSURE = \"MyScript recognition server is not reachable.\",\n  CANT_ESTABLISH = \"Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.\",\n  GOING_AWAY = \"MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.\",\n  PROTOCOL_ERROR = \"MyScript recognition server terminated the connection due to a protocol error.\",\n  UNSUPPORTED_DATA = \"MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)\",\n  INVALID_FRAME_PAYLOAD = \"MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).\",\n  POLICY_VIOLATION = \"MyScript recognition server terminated the connection because it received a message that violates its policy.\",\n  MESSAGE_TOO_BIG = \"MyScript recognition server terminated the connection because a data frame was received that is too large.\",\n  INTERNAL_ERROR = \"MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.\",\n  SERVICE_RESTART = \"MyScript recognition server terminated the connection because it is restarting.\",\n  TRY_AGAIN = \"MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.\",\n  BAD_GATEWAY = \"MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.\",\n  TLS_HANDSHAKE = \"MyScript recognition server connection was closed due to a failure to perform a TLS handshake\",\n}\n","import { isVersionSuperiorOrEqual, mergeDeep, PartialDeep } from \"../utils\"\nimport {\n  DefaultDiagramConfiguration,\n  DefaultExportConfiguration,\n  DefaultMathConfiguration,\n  DefaultRawContentConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultTextConfiguration,\n  TConvertionConfiguration,\n  TDiagramConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration\n} from \"./recognition\"\nimport { TRecognitionType } from \"./RecognitionConfiguration\"\nimport { DefaultServerHTTPConfiguration, TServerHTTPConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionHTTPV1Configuration = {\n  type: TRecognitionType\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  diagram: TDiagramConfiguration\n  \"raw-content\": TRawContentConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaulRecognitionHTTPV1ConfigurationConfiguration: TRecognitionHTTPV1Configuration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  diagram: DefaultDiagramConfiguration,\n  \"raw-content\": DefaultRawContentConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1Configuration = {\n  server: TServerHTTPConfiguration\n  recognition: TRecognitionHTTPV1Configuration\n}\n\n/**\n * @group Recognizer\n */\nexport const DefaultRecognizerHTTPV1Configuration: TRecognizerHTTPV1Configuration =\n{\n  server: DefaultServerHTTPConfiguration,\n  recognition: DefaulRecognitionHTTPV1ConfigurationConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport class RecognizerHTTPV1Configuration implements TRecognizerHTTPV1Configuration {\n  recognition: TRecognitionHTTPV1Configuration\n  server: TServerHTTPConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerHTTPV1Configuration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerHTTPV1Configuration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerHTTPV1Configuration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (configuration?.recognition?.diagram?.mimeTypes) {\n      this.recognition.diagram.mimeTypes = configuration.recognition.diagram.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    this.recognition.diagram.mimeTypes = [...new Set(this.recognition.diagram.mimeTypes)]\n\n    if (configuration?.recognition?.diagram?.convert?.types) {\n      this.recognition.diagram.convert!.types = configuration.recognition.diagram.convert.types as (\"text\" | \"shape\")[]\n    }\n\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration?.recognition?.[\"raw-content\"]?.recognition?.types as (\"text\" | \"shape\")[]\n    }\n    this.recognition[\"raw-content\"].recognition.types = [...new Set(this.recognition[\"raw-content\"].recognition.types.filter((type) => type !== \"decoration\"))]\n\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration?.recognition?.[\"raw-content\"]?.classification?.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TStrokeGroup, TStrokeGroupToSend } from \"../symbol\"\nimport { StyleHelper, TPenStyle } from \"../style\"\nimport { computeHmac, getApiInfos, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerHTTPV1Configuration, TRecognizerHTTPV1Configuration } from \"./RecognizerHTTPV1Configuration\"\nimport { TConverstionState } from \"./RecognitionConfiguration\"\nimport { TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TTextConfiguration } from \"./recognition\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1PostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1PostData = {\n  configuration: TRecognizerHTTPV1PostConfiguration,\n  xDPI: number,\n  yDPI: number,\n  contentType: string,\n  conversionState?: TConverstionState\n  height: number,\n  width: number,\n  strokeGroups: TStrokeGroupToSend[]\n}\n\n/**\n * @deprecated Use {@link RecognizerHTTPV2} instead.\n * @group Recognizer\n */\nexport class RecognizerHTTPV1\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  configuration: RecognizerHTTPV1Configuration\n\n  constructor(config: PartialDeep<TRecognizerHTTPV1Configuration>)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerHTTPV1Configuration(config)\n  }\n\n  get url()\n  {\n    return `${ this.configuration.server.scheme }://${ this.configuration.server.host }/api/v4.0/iink/batch`\n  }\n\n  get postConfig(): TRecognizerHTTPV1PostConfiguration\n  {\n    switch (this.configuration.recognition.type) {\n      case \"DIAGRAM\":\n        return {\n          lang: this.configuration.recognition.lang,\n          diagram: this.configuration.recognition.diagram,\n          export: this.configuration.recognition.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.configuration.recognition.lang,\n          math: this.configuration.recognition.math,\n          export: this.configuration.recognition.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.configuration.recognition.lang,\n          \"raw-content\": this.configuration.recognition[\"raw-content\"],\n          export: this.configuration.recognition.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.configuration.recognition.lang,\n          text: this.configuration.recognition.text,\n          export: this.configuration.recognition.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${ this.configuration.recognition.type }\"`)\n        break\n    }\n  }\n\n  protected buildData(model: Model): TRecognizerHTTPV1PostData\n  {\n    this.#logger.info(\"buildData\", { model })\n    const isPenStyleEqual = (ps1: TPenStyle, ps2: TPenStyle) =>\n    {\n      return ps1 && ps2 && ps1[\"-myscript-pen-fill-color\"] === ps2[\"-myscript-pen-fill-color\"] &&\n        ps1[\"-myscript-pen-fill-style\"] === ps2[\"-myscript-pen-fill-style\"] &&\n        ps1[\"-myscript-pen-width\"] === ps2[\"-myscript-pen-width\"] &&\n        ps1.color === ps2.color &&\n        ps1.width === ps2.width\n    }\n\n    const strokeGroupByPenStyle: TStrokeGroup[] = []\n    model.symbols.forEach((s) =>\n    {\n      const groupIndex = strokeGroupByPenStyle.findIndex(sg => isPenStyleEqual(sg.penStyle, s.style))\n      if (groupIndex > -1) {\n        strokeGroupByPenStyle[groupIndex].strokes.push(s)\n      } else {\n        strokeGroupByPenStyle.push({\n          penStyle: s.style,\n          strokes: [s]\n        })\n      }\n    })\n\n    const strokeGroupsToSend: TStrokeGroupToSend[] = []\n    strokeGroupByPenStyle.forEach((group: TStrokeGroup) =>\n    {\n      const newPenStyle = JSON.stringify(group.penStyle) === \"{}\" ? undefined : StyleHelper.penStyleToCSS(group.penStyle as TPenStyle)\n      const newGroup = {\n        penStyle: newPenStyle,\n        strokes: group.strokes.map(s => s.formatToSend())\n      }\n      strokeGroupsToSend.push(newGroup)\n    })\n\n    const contentType: string = this.configuration.recognition.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.configuration.recognition.type.charAt(0).toUpperCase() + this.configuration.recognition.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      xDPI: 96,\n      yDPI: 96,\n      contentType,\n      height: model.height,\n      width: model.width,\n      strokeGroups: strokeGroupsToSend\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown>\n  {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", \"application/json,\" + mimeType)\n    headers.append(\"applicationKey\", this.configuration.server.applicationKey)\n    try {\n      let hmacKey: string\n      if (typeof this.configuration.server.hmacKey == \"string\") {\n        hmacKey = this.configuration.server.hmacKey\n      } else if (typeof this.configuration.server.hmacKey == \"function\") {\n        hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n      }\n      else {\n        throw new Error(\"HMAC key is not a string nor a function\")\n      }\n      if (hmacKey) {\n        const hmac = await computeHmac(JSON.stringify(data), this.configuration.server.applicationKey, hmacKey)\n        headers.append(\"hmac\", hmac)\n      }\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n    if (isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"3.2.1\")\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.3.0\")) {\n      delete this.configuration.recognition.convert\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data),\n      credentials: \"omit\"\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRecognizerHTTPV1PostData, mimeType: string): Promise<TExport | never>\n  {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) =>\n      {\n        const exports: TExport = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) =>\n      {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[]\n  {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"DIAGRAM\":\n          mimeTypes = this.configuration.recognition.diagram.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.configuration.recognition.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState, requestedMimeTypes })\n    const myModel = model.clone()\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    const dataToConcert = this.buildData(myModel)\n    dataToConcert.conversionState = conversionState\n    const promises = mimeTypes.map(mt => this.tryFetch(dataToConcert, mt))\n    const exports: TExport[] = await Promise.all(promises)\n    exports.forEach(e =>\n    {\n      myModel.mergeConvert(e)\n    })\n    this.#logger.debug(\"convert\", { model: myModel })\n    return myModel\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    const myModel = model.clone()\n    if (myModel.symbols.length === 0) {\n      return Promise.resolve(myModel)\n    }\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    if (!mimeTypes.length) {\n      this.#logger.error(\"export\", { model, requestedMimeTypes, \"Export failed, no mimeTypes define in recognition configuration\": String })\n      return Promise.reject(new Error(\"Export failed, no mimeTypes define in recognition configuration\"))\n    }\n    const mimeTypesRequiringExport: string[] = mimeTypes.filter(m => !myModel.exports || !myModel.exports[m])\n    const data = this.buildData(model)\n    const exports: TExport[] = await Promise.all(mimeTypesRequiringExport.map(mimeType => this.tryFetch(data, mimeType)))\n    exports.forEach(e =>\n    {\n      myModel.mergeExport(e)\n    })\n    this.#logger.debug(\"export\", { model: myModel })\n    return myModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    return this.export(model)\n  }\n\n}\n","import { mergeDeep, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport {\n  DefaultShapeConfiguration,\n  DefaultExportConfiguration,\n  DefaultMathV2Configuration,\n  DefaultRawContentV2Configuration,\n  DefaultTexConfigurationV2,\n  TConvertionConfiguration,\n  TShapeConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TTextRecognizerHTTPV2Configuration\n} from \"./recognition\"\nimport { TRecognitionV2Type } from \"./RecognitionConfiguration\"\nimport { DefaultServerHTTPConfiguration, TServerHTTPConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2RecognitionConfiguration = {\n  type: TRecognitionV2Type\n  lang: string\n  math: TMathConfiguration\n  text: TTextRecognizerHTTPV2Configuration\n  shape: TShapeConfiguration\n  \"raw-content\": TRawContentConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerHTTPV2RecognitionConfiguration: TRecognizerHTTPV2RecognitionConfiguration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathV2Configuration,\n  shape: DefaultShapeConfiguration,\n  \"raw-content\": DefaultRawContentV2Configuration,\n  text: DefaultTexConfigurationV2,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2Configuration = {\n  server: TServerHTTPConfiguration\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport const DefaultRecognizerHTTPV2Configuration: TRecognizerHTTPV2Configuration =\n{\n  server: DefaultServerHTTPConfiguration,\n  recognition: DefaultRecognizerHTTPV2RecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport class RecognizerHTTPV2Configuration implements TRecognizerHTTPV2Configuration {\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n  server: TServerHTTPConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerHTTPV2Configuration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerHTTPV2Configuration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerHTTPV2Configuration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (configuration?.recognition?.shape?.mimeTypes) {\n      this.recognition.shape.mimeTypes = configuration.recognition.shape.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    this.recognition.shape.mimeTypes = [...new Set(this.recognition.shape.mimeTypes)]\n\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration?.recognition?.[\"raw-content\"]?.recognition?.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration?.recognition?.[\"raw-content\"]?.classification?.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TExportV2, TJIIXExport } from \"../model\"\nimport { TStroke, TStrokeToSend } from \"../symbol\"\nimport { computeHmac, getApiInfos, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerHTTPV2Configuration, TRecognizerHTTPV2Configuration } from \"./RecognizerHTTPV2Configuration\"\nimport { TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TTextConfiguration } from \"./recognition\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2PostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2PostData = {\n  scaleX: number,\n  scaleY: number,\n  configuration: TRecognizerHTTPV2PostConfiguration,\n  contentType: string,\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerHTTPV2 {\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  configuration: RecognizerHTTPV2Configuration\n\n  constructor(config: PartialDeep<TRecognizerHTTPV2Configuration>) {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerHTTPV2Configuration(config)\n  }\n\n  get url() {\n    return `${this.configuration.server.scheme}://${this.configuration.server.host}/api/v4.0/iink/recognize`\n  }\n\n  get postConfig(): TRecognizerHTTPV2PostConfiguration {\n    switch (this.configuration.recognition.type) {\n      case \"SHAPE\":\n        return {\n          lang: this.configuration.recognition.lang,\n          diagram: this.configuration.recognition.shape,\n          export: this.configuration.recognition.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.configuration.recognition.lang,\n          math: this.configuration.recognition.math,\n          export: this.configuration.recognition.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.configuration.recognition.lang,\n          \"raw-content\": this.configuration.recognition[\"raw-content\"],\n          export: this.configuration.recognition.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.configuration.recognition.lang,\n          text: this.configuration.recognition.text,\n          export: this.configuration.recognition.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${this.configuration.recognition.type}\"`)\n        break\n    }\n  }\n\n  protected formatStrokes(strokes: TStroke[]): TStrokeToSend[] {\n    return strokes.map(s => {\n      return {\n        id: s.id,\n        pointerType: s.pointerType,\n        p: s.pointers.map(p => p.p),\n        t: s.pointers.map(p => p.t),\n        x: s.pointers.map(p => p.x),\n        y: s.pointers.map(p => p.y)\n      }\n    })\n  }\n\n  protected buildData(strokes: TStroke[]): TRecognizerHTTPV2PostData {\n    this.#logger.info(\"buildData\", { strokes })\n\n    const contentType: string = this.configuration.recognition.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.configuration.recognition.type.charAt(0).toUpperCase() + this.configuration.recognition.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      scaleX: 0.265,\n      scaleY: 0.265,\n      contentType,\n      strokes: this.formatStrokes(strokes)\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown> {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", mimeType)\n    headers.append(\"applicationKey\", this.configuration.server.applicationKey)\n    try {\n      let hmacKey: string\n      if (typeof this.configuration.server.hmacKey == \"string\") {\n        hmacKey = this.configuration.server.hmacKey\n      } else if (typeof this.configuration.server.hmacKey == \"function\") {\n        hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n      }\n      else {\n        throw new Error(\"HMAC key is not a string nor a function\")\n      }\n      if (hmacKey) {\n        const hmac = await computeHmac(JSON.stringify(data), this.configuration.server.applicationKey, hmacKey)\n        headers.append(\"hmac\", hmac)\n      }\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n\n    if (this.configuration.server.version && isVersionSuperiorOrEqual(this.configuration.server.version, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"3.2.1\")\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data),\n      credentials: \"omit\"\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRecognizerHTTPV2PostData, mimeType: string): Promise<TExportV2 | never> {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) => {\n        const exports: TExportV2 = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) => {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[] {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"SHAPE\":\n          mimeTypes = this.configuration.recognition.shape.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${this.configuration.recognition.type}\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT\\n -SHAPE`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async send(strokes: TStroke[], requestedMimeTypes?: string[]): Promise<TExportV2> {\n    this.#logger.info(\"send\", strokes)\n\n    const recognition: TExportV2 = {}\n    if (strokes.length === 0) {\n      return Promise.resolve(recognition)\n    }\n    const mimeTypes = requestedMimeTypes || this.getMimeTypes()\n\n    const data = this.buildData(strokes)\n    const exports: TExportV2[] = await Promise.all(mimeTypes.map(mimeType => this.tryFetch(data, mimeType)))\n      exports.forEach(e => {\n        Object.assign(recognition, e)\n      })\n\n    this.#logger.debug(\"send\", recognition)\n    return recognition\n  }\n}\n","import { TGesture } from \"../gesture\"\nimport { TExport } from \"../model\"\n\n/**\n * @group Recognizer\n */\nexport enum TRecognizerWebSocketMessageType\n{\n  HMAC_Challenge = \"hmacChallenge\",\n  Authenticated = \"authenticated\",\n  SessionDescription = \"sessionDescription\",\n  NewPart = \"newPart\",\n  PartChanged = \"partChanged\",\n  ContentChanged = \"contentChanged\",\n  Idle = \"idle\",\n  Pong = \"pong\",\n  Exported = \"exported\",\n  GestureDetected = \"gestureDetected\",\n  ContextlessGesture = \"contextlessGesture\",\n  Error = \"error\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessage<T = string> = {\n  type: T\n  [key: string]: unknown\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageAuthenticated = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Authenticated>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageHMACChallenge = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.HMAC_Challenge> & {\n  hmacChallenge: string\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TInteractiveInkSessionDescriptionMessage = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.SessionDescription> & {\n  contentPartCount: number\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageNewPart = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.NewPart> & {\n  id: string\n  idx: null\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessagePartChange = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.PartChanged> & {\n  partIdx: number\n  partId: string\n  partCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageContentChange = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.ContentChanged> & {\n  partId: string\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  undoStackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageExport = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Exported> & {\n  partId: string\n  exports: TExport\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageGesture = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.GestureDetected> & TGesture\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageContextlessGesture = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.ContextlessGesture> & {\n  gestureType: \"none\" | \"scratch\" | \"left-right\" | \"right-left\" | \"bottom-top\" | \"top-bottom\" | \"surround\",\n  strokeId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessagePong = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Pong>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageIdle = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Idle>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageError = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Error> & {\n  code?: number | string\n  message?: string\n  data?: {\n    code: number | string\n    message: string\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageReceived =\n  TRecognizerWebSocketMessageAuthenticated |\n  TRecognizerWebSocketMessageHMACChallenge |\n  TInteractiveInkSessionDescriptionMessage |\n  TRecognizerWebSocketMessageNewPart |\n  TRecognizerWebSocketMessagePartChange |\n  TRecognizerWebSocketMessageContentChange |\n  TRecognizerWebSocketMessageExport |\n  TRecognizerWebSocketMessageGesture |\n  TRecognizerWebSocketMessageContextlessGesture |\n  TRecognizerWebSocketMessagePong |\n  TRecognizerWebSocketMessageIdle |\n  TRecognizerWebSocketMessageError\n","import { mergeDeep, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { TExportConfiguration, TTextConfConfiguration } from \"./recognition\"\nimport { DefaultServerWebsocketConfiguration, TServerWebsocketConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionWebSocketConfiguration = {\n  lang: string\n  export: TExportConfiguration\n  \"raw-content\": {\n    text?: TTextConfConfiguration\n    \"session-time\"?: number\n    recognition?: {\n      types: (\"text\" | \"shape\")[]\n    }\n    classification?: {\n      types: (\"text\" | \"shape\")[]\n    }\n    gestures?: (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n  }\n  gesture: {\n    enable: boolean,\n    ignoreGestureStrokes: boolean\n  }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognitionWebSocketConfiguration: TRecognitionWebSocketConfiguration = {\n  export: {\n    jiix: {\n      \"bounding-box\": true,\n      \"full-stroke-ids\": true,\n      ids: true,\n      strokes: false,\n      text: {\n        chars: true,\n        words: true,\n        lines: true\n      }\n    }\n  },\n  \"raw-content\": {\n    recognition: {\n      types: [\"text\", \"shape\"]\n    },\n    classification: {\n      types: [\"text\", \"shape\"]\n    },\n    gestures: [\"underline\", \"scratch-out\", \"join\", \"insert\", \"strike-through\", \"surround\"]\n  },\n  lang: \"en_US\",\n  gesture: {\n    enable: true,\n    ignoreGestureStrokes: false,\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketConfiguration = {\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketConfiguration: TRecognizerWebSocketConfiguration =\n{\n  server: DefaultServerWebsocketConfiguration,\n  recognition: DefaultRecognitionWebSocketConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketConfiguration implements TRecognizerWebSocketConfiguration\n{\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerWebSocketConfiguration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerWebSocketConfiguration.server, configuration?.server)\n\n    this.recognition = mergeDeep({}, DefaultRecognizerWebSocketConfiguration.recognition, configuration?.recognition)\n    this.recognition.export.jiix[\"full-stroke-ids\"] = true\n    this.recognition.export.jiix.ids = true\n    this.recognition.export.jiix.text.words = true\n    this.recognition.export.jiix.text.chars = true\n    this.recognition.export.jiix.text.lines = true\n    this.recognition.export.jiix[\"bounding-box\"] = true\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration.recognition[\"raw-content\"].recognition.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration.recognition[\"raw-content\"].classification.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.gestures) {\n      this.recognition[\"raw-content\"].gestures = configuration.recognition[\"raw-content\"].gestures as (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n    }\n    if (this.server.version && !isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n      delete this.recognition.export.jiix.text.lines\n      delete this.recognition[\"raw-content\"].classification\n    }\n  }\n}\n","import { TIIHistoryBackendChanges, THistoryContext } from \"../history\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TExport, TJIIXExport } from \"../model\"\nimport { IIStroke } from \"../symbol\"\nimport { TMatrixTransform } from \"../transform\"\nimport { computeHmac, mergeDeep, DeferredPromise, PartialDeep, isVersionSuperiorOrEqual, getApiInfos } from \"../utils\"\nimport\n{\n  TRecognizerWebSocketMessage,\n  TRecognizerWebSocketMessageContentChange,\n  TRecognizerWebSocketMessageContextlessGesture,\n  TRecognizerWebSocketMessageError,\n  TRecognizerWebSocketMessageExport,\n  TRecognizerWebSocketMessageGesture,\n  TRecognizerWebSocketMessageHMACChallenge,\n  TRecognizerWebSocketMessageNewPart,\n  TRecognizerWebSocketMessagePartChange,\n  TRecognizerWebSocketMessageReceived,\n  TRecognizerWebSocketMessageType,\n  TInteractiveInkSessionDescriptionMessage\n} from \"./RecognizerWebSocketMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport PingWorker from \"web-worker:../worker/ping.worker.ts\"\nimport { RecognizerEvent } from \"./RecognizerEvent\"\nimport { RecognizerWebSocketConfiguration, TRecognizerWebSocketConfiguration } from \"./RecognizerWebSocketConfiguration\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------- Client --------------------------------------------------------------- Server ---------------\n * { type: \"authenticate\" }                           ==================>\n *                                                    <==================       { type: \"hmacChallenge\" }\n * { type: \"hmac\" }                                   ==================>\n *                                                    <==================       { type: \"authenticated\" }\n * { type: \"initSession\" | \"restoreSession\" }         ==================>\n *                                                    <==================       { type: \"sessionDescription\" }\n * { type: \"newContentPart\" | \"openContentPart\" }     ==================>\n *                                                    <==================       { type: \"partChanged\" }\n * { type: \"addStrokes\" }                             ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"transform\" }                              ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"eraseStrokes\" }                           ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n */\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocket\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  protected socket!: WebSocket\n  protected pingWorker?: Worker\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected sessionId?: string\n  protected currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected addStrokeDeferred?: DeferredPromise<TRecognizerWebSocketMessageGesture | undefined>\n  protected contextlessGestureDeferred: Map<string, DeferredPromise<TRecognizerWebSocketMessageContextlessGesture>>\n  protected transformStrokeDeferred?: DeferredPromise<void>\n  protected eraseStrokeDeferred?: DeferredPromise<void>\n  protected replaceStrokeDeferred?: DeferredPromise<void>\n  protected exportDeferredMap: Map<string, DeferredPromise<TExport>>\n  protected closeDeferred?: DeferredPromise<void>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<void>\n  protected redoDeferred?: DeferredPromise<void>\n  protected clearDeferred?: DeferredPromise<void>\n\n  configuration: RecognizerWebSocketConfiguration\n  initialized: DeferredPromise<void>\n  url: string\n  event: RecognizerEvent\n\n  constructor(config: PartialDeep<TRecognizerWebSocketConfiguration>, event?: RecognizerEvent)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerWebSocketConfiguration(config)\n    const scheme = (this.configuration.server.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.configuration.server.host }/api/v4.0/iink/offscreen?applicationKey=${ this.configuration.server.applicationKey }`\n\n    this.event = event || new RecognizerEvent()\n    this.initialized = new DeferredPromise<void>()\n    this.exportDeferredMap = new Map()\n    this.contextlessGestureDeferred = new Map()\n  }\n\n  get mimeTypes(): string[]\n  {\n    return [\"application/vnd.myscript.jiix\"]\n  }\n\n  async #send(message: TRecognizerWebSocketMessage): Promise<void>\n  {\n    if (!this.socket) {\n      throw new Error(\"Recognizer must be initilized\")\n    }\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.socket.send(JSON.stringify(message))\n    }\n    else {\n      throw new Error(`Can not send message: ${message.type}, connection not ready, state: ${ this.socket.readyState }`)\n    }\n  }\n\n  protected rejectDeferredPending(error: Error | string): void\n  {\n    this.initialized.reject(error)\n    this.addStrokeDeferred?.reject(error)\n    this.transformStrokeDeferred?.reject(error)\n    this.eraseStrokeDeferred?.reject(error)\n    this.replaceStrokeDeferred?.reject(error)\n    this.undoDeferred?.reject(error)\n    this.redoDeferred?.reject(error)\n    this.clearDeferred?.reject(error)\n    Array.from(this.contextlessGestureDeferred.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    Array.from(this.exportDeferredMap.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    this.waitForIdleDeferred?.reject(error)\n  }\n\n  protected resetAllDeferred(): void\n  {\n    this.initialized = new DeferredPromise<void>()\n    this.addStrokeDeferred = undefined\n    this.contextlessGestureDeferred.clear()\n    this.transformStrokeDeferred = undefined\n    this.eraseStrokeDeferred = undefined\n    this.replaceStrokeDeferred = undefined\n    this.exportDeferredMap.clear()\n    this.waitForIdleDeferred = undefined\n    this.closeDeferred = undefined\n  }\n\n  protected clearSocketListener(): void\n  {\n    this.socket.removeEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.removeEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.removeEventListener(\"message\", this.messageCallback.bind(this))\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    this.#logger.info(\"closeCallback\", { evt })\n    let message = evt.reason\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    this.clearSocketListener()\n    this.closeDeferred?.resolve()\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message)\n      this.event.emitError(error)\n      this.rejectDeferredPending(message)\n    }\n    this.pingWorker?.terminate()\n    this.resetAllDeferred()\n  }\n\n  protected openCallback(): void\n  {\n    this.reconnectionCount = 0\n    this.#send({\n      type: \"authenticate\",\n      \"myscript-client-name\": \"iink-ts\",\n      \"myscript-client-version\": \"3.2.1\",\n    })\n  }\n\n  protected async manageHMACChallenge(hmacChallengeMessage: TRecognizerWebSocketMessageHMACChallenge): Promise<void>\n  {\n    let hmacKey: string\n    if (typeof this.configuration.server.hmacKey == \"string\") {\n      hmacKey = this.configuration.server.hmacKey\n    } else if (typeof this.configuration.server.hmacKey == \"function\") {\n      hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n    }\n    else {\n      return this.initialized.reject(new Error(\"HMAC key is not a string nor a function\"))\n    }\n    if (!hmacKey) {\n      return this.initialized.reject(new Error(\"HMAC key is required\"))\n    }\n    this.#send({\n      type: \"hmac\",\n      hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.configuration.server.applicationKey, hmacKey)\n    })\n  }\n\n  protected initPing(): void\n  {\n    this.pingWorker = new PingWorker()\n    this.pingWorker.postMessage({\n      pingDelay: this.configuration.server.websocket.pingDelay,\n    })\n    this.pingWorker.onmessage = () =>\n    {\n      if (this.socket.readyState <= 1) {\n        if (this.pingCount < this.configuration.server.websocket.maxPingLostCount) {\n          this.send({ type: \"ping\" })\n        }\n        else {\n          this.close(1000, \"MAXIMUM_PING_REACHED\")\n          this.pingWorker?.terminate()\n        }\n        this.pingCount++\n      }\n    }\n  }\n\n  protected manageAuthenticated(): void\n  {\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n      delete this.configuration.recognition[\"raw-content\"].classification\n    }\n    const pixelTomm = 25.4 / 96\n    this.#send({\n      type: this.sessionId ? \"restoreSession\" : \"initSession\",\n      iinkSessionId: this.sessionId,\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      configuration: this.configuration.recognition\n    })\n  }\n\n  protected manageSessionDescriptionMessage(sessionDescriptionMessage: TInteractiveInkSessionDescriptionMessage): void\n  {\n    if (sessionDescriptionMessage.iinkSessionId) {\n      this.sessionId = sessionDescriptionMessage.iinkSessionId\n      this.event.emitSessionOpened(this.sessionId)\n    }\n    if (this.currentPartId) {\n      this.#send({ type: \"openContentPart\", id: this.currentPartId })\n    }\n    else {\n      this.#send({ type: \"newContentPart\", contentType: \"Raw Content\", mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected manageNewPartMessage(newPartMessage: TRecognizerWebSocketMessageNewPart): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = newPartMessage.id\n  }\n\n  protected managePartChangeMessage(partChangeMessage: TRecognizerWebSocketMessagePartChange): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = partChangeMessage.partId\n  }\n\n  protected manageContentChangedMessage(contentChangeMessage: TRecognizerWebSocketMessageContentChange): void\n  {\n    this.initialized.resolve()\n    this.replaceStrokeDeferred?.resolve()\n    this.transformStrokeDeferred?.resolve()\n    this.eraseStrokeDeferred?.resolve()\n    this.undoDeferred?.resolve()\n    this.redoDeferred?.resolve()\n    this.clearDeferred?.resolve()\n    this.event.emitContentChanged({\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canRedo,\n    } as THistoryContext)\n  }\n\n  protected manageExportMessage(exportMessage: TRecognizerWebSocketMessageExport): void\n  {\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n\n    Object.keys(exportMessage.exports)\n      .forEach(key =>\n      {\n        if (this.exportDeferredMap.has(key)) {\n          this.exportDeferredMap.get(key)!.resolve(exportMessage.exports)\n        }\n      })\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected manageWaitForIdle(): void\n  {\n    this.waitForIdleDeferred?.resolve()\n    this.event.emitIdle(true)\n  }\n\n  protected manageErrorMessage(errorMessage: TRecognizerWebSocketMessageError): void\n  {\n    this.currentErrorCode = errorMessage.data?.code || errorMessage.code\n    let message = errorMessage.data?.message || errorMessage.message || RecognizerError.UNKNOW\n\n    if (this.currentErrorCode === \"no.activity\") {\n      this.rejectDeferredPending(message)\n      this.event.emitConnectionClose({ code: 1000,  message: RecognizerError.NO_ACTIVITY })\n    }\n    else {\n      switch (this.currentErrorCode) {\n        case \"access.not.granted\":\n          message = RecognizerError.WRONG_CREDENTIALS\n          break\n        case \"session.too.old\":\n          message = RecognizerError.TOO_OLD\n          break\n        case \"restore.session.not.found\":\n          message = RecognizerError.NO_SESSION_FOUND\n          break\n      }\n      this.rejectDeferredPending(message)\n      this.event.emitError(new Error(message))\n    }\n  }\n\n  protected manageGestureDetected(gestureMessage: TRecognizerWebSocketMessageGesture): void\n  {\n    this.addStrokeDeferred?.resolve(gestureMessage)\n  }\n\n  protected manageContextlessGesture(gestureMessage: TRecognizerWebSocketMessageContextlessGesture): void\n  {\n    this.contextlessGestureDeferred.get(gestureMessage.strokeId)?.resolve(gestureMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.currentErrorCode = undefined\n    try {\n      const websocketMessage: TRecognizerWebSocketMessageReceived = JSON.parse(message.data)\n      if (websocketMessage.type === TRecognizerWebSocketMessageType.Pong) {\n        return\n      }\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case TRecognizerWebSocketMessageType.HMAC_Challenge:\n          this.manageHMACChallenge(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Authenticated:\n          this.manageAuthenticated()\n          break\n        case TRecognizerWebSocketMessageType.SessionDescription:\n          this.manageSessionDescriptionMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.NewPart:\n          this.manageNewPartMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.PartChanged:\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.ContentChanged:\n          this.manageContentChangedMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Exported:\n          this.manageExportMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.GestureDetected:\n          this.manageGestureDetected(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.ContextlessGesture:\n          this.manageContextlessGesture(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Error:\n          this.manageErrorMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Idle:\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage }\".`)\n          break\n      }\n    }\n    catch {\n      this.event.emitError(new Error(message.data))\n    }\n  }\n\n  async newSession(config: PartialDeep<TRecognizerWebSocketConfiguration>): Promise<void>\n  {\n    await this.close(1000, \"new-session\")\n    this.configuration = mergeDeep({}, this.configuration, config)\n    this.sessionId = undefined\n    this.currentPartId = undefined\n    await this.init()\n  }\n\n  async init(): Promise<void>\n  {\n    this.event.emitStartInitialization()\n    if (this.currentErrorCode === \"restore.session.not.found\") {\n      this.currentErrorCode = undefined\n      this.sessionId = undefined\n      this.currentPartId = undefined\n    }\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n    this.socket = new WebSocket(this.url)\n    this.clearSocketListener()\n    this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n    await this.initialized.promise\n    if (this.configuration.server.websocket.pingEnabled) {\n      this.pingCount = 0\n      this.initPing()\n    }\n    this.event.emitEndtInitialization()\n    return this.initialized.promise\n  }\n\n  async send(message: TRecognizerWebSocketMessage): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n\n    switch (this.socket.readyState) {\n      case this.socket.CONNECTING:\n      case this.socket.OPEN:\n        await this.initialized.promise\n        this.#send(message)\n        return Promise.resolve()\n      case this.socket.CLOSING:\n      case this.socket.CLOSED:\n        if (this.configuration.server.websocket.autoReconnect) {\n          this.reconnectionCount++\n          if (this.configuration.server.websocket.maxRetryCount > this.reconnectionCount) {\n            await this.init()\n            await this.waitForIdle()\n            return this.#send(message)\n          }\n          else {\n            return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n          }\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. Connection closed and automatic reconnection disabled\"))\n        }\n        break\n    }\n  }\n\n  protected buildAddStrokesMessage(strokes: IIStroke[], processGestures = true): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"addStrokes\",\n      processGestures,\n      strokes: strokes.map(s => s.formatToSend())\n    }\n  }\n  async addStrokes(strokes: IIStroke[], processGestures = true): Promise<TRecognizerWebSocketMessageGesture | undefined>\n  {\n    this.addStrokeDeferred = new DeferredPromise<TRecognizerWebSocketMessageGesture | undefined>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve(undefined)\n      return this.addStrokeDeferred?.promise\n    }\n    await this.send(this.buildAddStrokesMessage(strokes, processGestures))\n    return this.addStrokeDeferred?.promise\n  }\n\n  protected buildReplaceStrokesMessage(oldStrokeIds: string[], newStrokes: IIStroke[]): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"replaceStrokes\",\n      oldStrokeIds,\n      newStrokes: newStrokes.map(s => s.formatToSend())\n    }\n  }\n  async replaceStrokes(oldStrokeIds: string[], newStrokes: IIStroke[]): Promise<void>\n  {\n    this.replaceStrokeDeferred = new DeferredPromise<void>()\n    if (oldStrokeIds.length === 0) {\n      this.replaceStrokeDeferred.resolve()\n      return this.replaceStrokeDeferred?.promise\n    }\n    await this.send(this.buildReplaceStrokesMessage(oldStrokeIds, newStrokes))\n    return this.replaceStrokeDeferred?.promise\n  }\n\n  protected buildTransformTranslateMessage(strokeIds: string[], tx: number, ty: number): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"TRANSLATE\",\n      strokeIds,\n      tx,\n      ty\n    }\n  }\n  async transformTranslate(strokeIds: string[], tx: number, ty: number): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformTranslateMessage(strokeIds, tx, ty))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformRotateMessage(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"ROTATE\",\n      strokeIds,\n      angle,\n      x0,\n      y0\n    }\n  }\n  async transformRotate(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformRotateMessage(strokeIds, angle, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformScaleMessage(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"SCALE\",\n      strokeIds,\n      scaleX,\n      scaleY,\n      x0,\n      y0\n    }\n  }\n  async transformScale(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformScaleMessage(strokeIds, scaleX, scaleY, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformMatrixMessage(strokeIds: string[], matrix: TMatrixTransform): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"MATRIX\",\n      strokeIds,\n      ...matrix\n    }\n  }\n  async transformMatrix(strokeIds: string[], matrix: TMatrixTransform): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformMatrixMessage(strokeIds, matrix))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildEraseStrokesMessage(strokeIds: string[]): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"eraseStrokes\",\n      strokeIds\n    }\n  }\n  async eraseStrokes(strokeIds: string[]): Promise<void>\n  {\n    this.eraseStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.eraseStrokeDeferred.resolve()\n      return this.eraseStrokeDeferred?.promise\n    }\n    await this.send(this.buildEraseStrokesMessage(strokeIds))\n    return this.eraseStrokeDeferred?.promise\n  }\n\n  async recognizeGesture(stroke: IIStroke): Promise<TRecognizerWebSocketMessageContextlessGesture | undefined>\n  {\n    if (!stroke) {\n      return\n    }\n    this.contextlessGestureDeferred.set(stroke.id, new DeferredPromise<TRecognizerWebSocketMessageContextlessGesture>())\n    const pixelTomm = 25.4 / 96\n    await this.send({\n      type: \"contextlessGesture\",\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      stroke: stroke.formatToSend()\n    })\n    return this.contextlessGestureDeferred.get(stroke.id)!.promise\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    if (!this.waitForIdleDeferred || this.waitForIdleDeferred.isFullFilled) {\n      this.waitForIdleDeferred = new DeferredPromise<void>()\n    }\n    const message: TRecognizerWebSocketMessage = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  protected buildUndoRedoChanges(changes: TIIHistoryBackendChanges): TRecognizerWebSocketMessage[]\n  {\n    const changesMessages: TRecognizerWebSocketMessage[] = []\n    if (changes.added?.length) {\n      changesMessages.push(this.buildAddStrokesMessage(changes.added, false))\n    }\n    if (changes.erased?.length) {\n      changesMessages.push(this.buildEraseStrokesMessage(changes.erased.map(s => s.id)))\n    }\n    if (changes.replaced?.newStrokes.length) {\n      changesMessages.push(this.buildReplaceStrokesMessage(changes.replaced.oldStrokes.map(s => s.id), changes.replaced.newStrokes))\n    }\n    if (changes.matrix?.strokes.length) {\n      changesMessages.push(this.buildTransformMatrixMessage(changes.matrix.strokes.map(s => s.id), changes.matrix.matrix))\n    }\n    if (changes.translate?.length) {\n      changes.translate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformTranslateMessage(tr.strokes.map(s => s.id), tr.tx, tr.ty))\n      })\n    }\n    if (changes.rotate?.length) {\n      changes.rotate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformRotateMessage(tr.strokes.map(s => s.id), tr.angle, tr.center.x, tr.center.y))\n      })\n    }\n    if (changes.scale?.length) {\n      changes.scale.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformScaleMessage(tr.strokes.map(s => s.id), tr.scaleX, tr.scaleY, tr.origin.x, tr.origin.y))\n      })\n    }\n    return changesMessages\n  }\n\n  async undo(actions: TIIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.undoDeferred = new DeferredPromise<void>()\n    const message: TRecognizerWebSocketMessage = {\n      type: \"undo\",\n      changes\n    }\n    await this.send(message)\n    return this.undoDeferred?.promise\n  }\n\n  async redo(actions: TIIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.redoDeferred = new DeferredPromise<void>()\n\n    const message: TRecognizerWebSocketMessage = {\n      type: \"redo\",\n      changes\n    }\n    await this.send(message)\n    return this.redoDeferred?.promise\n  }\n\n  async export(requestedMimeTypes?: string[]): Promise<TExport>\n  {\n    const mimeTypes: string[] = requestedMimeTypes || this.mimeTypes.slice()\n    await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)?.promise))\n    mimeTypes.forEach(mt =>\n    {\n      this.exportDeferredMap.set(mt, new DeferredPromise<TExport>())\n    })\n\n    const message: TRecognizerWebSocketMessage = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports = await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)!.promise))\n    return Object.assign({}, ...exports)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.clearDeferred = new DeferredPromise<void>()\n    await this.send({\n      type: \"clear\"\n    })\n    return this.clearDeferred?.promise\n  }\n\n  async close(code: number, reason: string): Promise<void>\n  {\n    this.resetAllDeferred()\n    this.closeDeferred = new DeferredPromise<void>()\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.socket.close(code, reason)\n    }\n    else {\n      this.closeDeferred.resolve()\n    }\n    await this.closeDeferred.promise\n  }\n\n  async destroy(): Promise<void>\n  {\n    if (this.socket) {\n      await this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { isVersionSuperiorOrEqual, mergeDeep, PartialDeep } from \"../utils\"\nimport {\n  DefaultExportConfiguration,\n  DefaultMathConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultTextConfiguration,\n  TConvertionConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration\n} from \"./recognition\"\nimport { TRecognitionType } from \"./RecognitionConfiguration\"\nimport { DefaultServerWebsocketConfiguration, TServerWebsocketConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketSSRRecognitionConfiguration = {\n  type: Omit<TRecognitionType, \"DIAGRAM\" | \"Raw Content\">\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketSSRRecognitionConfiguration: TRecognizerWebSocketSSRRecognitionConfiguration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketSSRConfiguration = {\n  server: TServerWebsocketConfiguration\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketSSRConfiguration: TRecognizerWebSocketSSRConfiguration =\n{\n  server: DefaultServerWebsocketConfiguration,\n  recognition: DefaultRecognizerWebSocketSSRRecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketSSRConfiguration implements TRecognizerWebSocketSSRConfiguration\n{\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n  server: TServerWebsocketConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerWebSocketSSRConfiguration>) {\n    this.server = mergeDeep({}, DefaultRecognizerWebSocketSSRConfiguration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerWebSocketSSRConfiguration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { Stroke } from \"../symbol\"\nimport { StyleHelper, TPenStyle, TTheme } from \"../style\"\nimport { THistoryContext } from \"../history\"\nimport { DeferredPromise, PartialDeep, computeHmac, getApiInfos, isVersionSuperiorOrEqual } from \"../utils\"\nimport\n{\n  TRecognizerWebSocketSSRMessage,\n  TRecognizerWebSocketSSRMessageContentChange,\n  TRecognizerWebSocketSSRMessageError,\n  TRecognizerWebSocketSSRMessageExport,\n  TRecognizerWebSocketSSRMessageHMACChallenge,\n  TRecognizerWebSocketSSRMessagePartChange,\n  TRecognizerWebSocketSSRMessageSVGPatch\n} from \"./RecognizerWebSocketSSRMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerEvent } from \"./RecognizerEvent\"\nimport { TRecognizerWebSocketSSRConfiguration, RecognizerWebSocketSSRConfiguration } from \"./RecognizerWebSocketSSRConfiguration\"\nimport { TConverstionState } from \"./RecognitionConfiguration\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------------------- Client --------------------------------------------------- Server ----------------------------------\n * init: send newContentPackage or restoreIInkSession           ==================>\n *                                                              <==================       ack\n * answer ack:\n *  send the hmac (if enable)                                   ==================>\n *  send the configuration                                      ==================>\n *                                                              <==================       contentPackageDescription\n * answer contentPackageDescription:\n *  send newContentPart or openContentPart                      ==================>\n *                                                              <==================        partChanged\n *                                                              <==================        contentChanged\n *                                                              <==================        newPart\n *                                                              <==================        svgPatch\n *\n * setPenStyle (send the parameters)                            ==================>\n * setTheme (send the parameters)                               ==================>\n * setPenStyleClasses (send the parameters)                     ==================>\n *                                                              <==================        svgPatch\n * addStrokes (send the strokes ) ============>\n *                                                              <==================        update\n */\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketSSR\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  protected socket!: WebSocket\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected viewSizeHeight!: number\n  protected viewSizeWidth!: number\n  protected sessionId?: string\n  // contentPartCount = 0\n  currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected penStyle?: TPenStyle\n  protected penStyleClasses?: string\n  protected theme?: TTheme\n\n  protected connected?: DeferredPromise<void>\n  protected ackDeferred?: DeferredPromise<void>\n  protected addStrokeDeferred?: DeferredPromise<TExport>\n  protected exportDeferred?: DeferredPromise<TExport>\n  protected convertDeferred?: DeferredPromise<TExport>\n  protected importDeferred?: DeferredPromise<TExport>\n  protected resizeDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<TExport>\n  protected redoDeferred?: DeferredPromise<TExport>\n  protected clearDeferred?: DeferredPromise<TExport>\n  protected importPointEventsDeferred?: DeferredPromise<TExport>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n\n  configuration: TRecognizerWebSocketSSRConfiguration\n  initialized: DeferredPromise<void>\n  url: string\n  event: RecognizerEvent\n\n  constructor(config?: PartialDeep<TRecognizerWebSocketSSRConfiguration>)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerWebSocketSSRConfiguration(config)\n    const scheme = (this.configuration.server.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.configuration.server.host }/api/v4.0/iink/document?applicationKey=${ this.configuration.server.applicationKey }`\n    this.event = new RecognizerEvent()\n    this.initialized = new DeferredPromise<void>()\n  }\n\n  get mimeTypes(): string[]\n  {\n    switch (this.configuration.recognition.type.toLocaleLowerCase()) {\n      case \"text\":\n        return this.configuration.recognition.text.mimeTypes\n      case \"math\":\n        return this.configuration.recognition.math.mimeTypes\n      default:\n        throw new Error(`Unauthorized recognition type: \"${ this.configuration.recognition.type }\"`)\n    }\n  }\n\n  protected infinitePing(): void\n  {\n    this.pingCount++\n    if (this.configuration.server.websocket.maxPingLostCount < this.pingCount) {\n      this.socket.close(1000, \"MAXIMUM_PING_REACHED\")\n    } else if (this.socket.readyState <= 1) {\n      setTimeout(() =>\n      {\n        if (this.socket.readyState <= 1) {\n          this.socket.send(JSON.stringify({ type: \"ping\" }))\n          this.infinitePing()\n        }\n      }, this.configuration.server.websocket.pingDelay)\n    }\n  }\n\n  protected openCallback(): void\n  {\n    this.connected?.resolve()\n    const params: TRecognizerWebSocketSSRMessage = {\n      type: this.sessionId ? \"restoreIInkSession\" : \"newContentPackage\",\n      iinkSessionId: this.sessionId,\n      applicationKey: this.configuration.server.applicationKey,\n      xDpi: 96,\n      yDpi: 96,\n      viewSizeHeight: this.viewSizeHeight,\n      viewSizeWidth: this.viewSizeWidth\n    }\n    if (isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.0.4\")) {\n      params[\"myscript-client-name\"] = \"iink-ts\"\n      params[\"myscript-client-version\"] = \"3.2.1\"\n    }\n    this.send(params)\n  }\n\n  protected rejectDeferredPending(error: Error): void\n  {\n    if (this.connected?.isPending) {\n      this.connected?.reject(error)\n    }\n    if (this.initialized.isPending) {\n      this.initialized.reject(error)\n    }\n    if (this.addStrokeDeferred?.isPending) {\n      this.addStrokeDeferred?.reject(error)\n    }\n    if (this.exportDeferred?.isPending) {\n      this.exportDeferred?.reject(error)\n    }\n    if (this.importPointEventsDeferred?.isPending) {\n      this.importPointEventsDeferred?.reject(error)\n    }\n    if (this.convertDeferred?.isPending) {\n      this.convertDeferred?.reject(error)\n    }\n    if (this.importDeferred?.isPending) {\n      this.importDeferred?.reject(error)\n    }\n    if (this.resizeDeferred?.isPending) {\n      this.resizeDeferred?.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred?.reject(error)\n    }\n    if (this.undoDeferred?.isPending) {\n      this.undoDeferred?.reject(error)\n    }\n    if (this.redoDeferred?.isPending) {\n      this.redoDeferred?.reject(error)\n    }\n    if (this.clearDeferred?.isPending) {\n      this.clearDeferred.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred.reject(error)\n    }\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    let message = \"\"\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          this.#logger.warn(\"closeCallback\", \"unknow CloseEvent.code\", { evt })\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message || evt.reason)\n      this.rejectDeferredPending(error)\n      this.event.emitError(error)\n    }\n  }\n\n  protected async manageAckMessage(websocketMessage: TRecognizerWebSocketSSRMessage): Promise<void>\n  {\n    this.#logger.info(\"manageAckMessage\", { websocketMessage })\n    const hmacChallengeMessage = websocketMessage as TRecognizerWebSocketSSRMessageHMACChallenge\n    if (hmacChallengeMessage.hmacChallenge) {\n      let hmacKey: string\n      if (typeof this.configuration.server.hmacKey == \"string\") {\n        if (this.configuration.server.hmacKey.length === 0) {\n          return this.ackDeferred?.reject(\"HMAC key is empty\")\n        }\n        hmacKey = this.configuration.server.hmacKey\n      } else if (typeof this.configuration.server.hmacKey == \"function\") {\n        hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n      }\n      else {\n        this.ackDeferred?.reject(\"HMAC key is not a string nor a function\")\n        return this.initialized.reject(new Error(\"HMAC key is not a string nor a function\"))\n      }\n      if (!hmacKey) {\n        this.ackDeferred?.reject(\"HMAC key is undefined\")\n        return this.initialized.reject(new Error(\"HMAC key is undefined\"))\n      }\n      this.send({\n        type: \"hmac\",\n        hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.configuration.server.applicationKey, hmacKey)\n      })\n    }\n    if (hmacChallengeMessage.iinkSessionId) {\n      this.sessionId = hmacChallengeMessage.iinkSessionId\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.3.0\")) {\n      delete this.configuration.recognition.convert\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n    }\n    this.send({ ...this.configuration.recognition, type: \"configuration\" })\n    this.ackDeferred?.resolve()\n  }\n\n  protected async manageContentPackageDescriptionMessage(): Promise<void>\n  {\n    this.reconnectionCount = 0\n    await this.ackDeferred?.promise\n    this.#logger.info(\"manageContentPackageDescriptionMessage\")\n    if (this.currentPartId) {\n      this.send({ type: \"openContentPart\", id: this.currentPartId, mimeTypes: this.mimeTypes })\n    }\n    else {\n      this.send({ type: \"newContentPart\", contentType: this.configuration.recognition.type, mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected managePartChangeMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"managePartChangeMessage\", { websocketMessage })\n    const partChangeMessage = websocketMessage as TRecognizerWebSocketSSRMessagePartChange\n    this.currentPartId = partChangeMessage.partId\n    this.initialized.resolve()\n  }\n\n  protected manageExportMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageExportMessage\", { websocketMessage })\n    const exportMessage = websocketMessage as TRecognizerWebSocketSSRMessageExport\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n    this.initialized.resolve()\n    this.addStrokeDeferred?.resolve(exportMessage.exports)\n    this.exportDeferred?.resolve(exportMessage.exports)\n    this.convertDeferred?.resolve(exportMessage.exports)\n    this.importDeferred?.resolve(exportMessage.exports)\n    this.undoDeferred?.resolve(exportMessage.exports)\n    this.redoDeferred?.resolve(exportMessage.exports)\n    this.clearDeferred?.resolve(exportMessage.exports)\n    this.importPointEventsDeferred?.resolve(exportMessage.exports)\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected async manageWaitForIdle(): Promise<void>\n  {\n    this.event.emitIdle(true)\n    this.waitForIdleDeferred?.resolve()\n  }\n\n  protected manageErrorMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    const err = websocketMessage as TRecognizerWebSocketSSRMessageError\n    this.currentErrorCode = err.data?.code || err.code\n    let message = err.data?.message || err.message || RecognizerError.UNKNOW\n\n    switch (this.currentErrorCode) {\n      case \"no.activity\":\n        message = RecognizerError.NO_ACTIVITY\n        break\n      case \"access.not.granted\":\n        message = RecognizerError.WRONG_CREDENTIALS\n        break\n      case \"session.too.old\":\n        message = RecognizerError.TOO_OLD\n        break\n    }\n    const error = new Error(message)\n    this.rejectDeferredPending(error)\n    this.event.emitError(error)\n  }\n\n  protected manageContentChangeMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageContentChangeMessage\", { websocketMessage })\n    const contentChangeMessage = websocketMessage as TRecognizerWebSocketSSRMessageContentChange\n    const context: THistoryContext = {\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canUndo,\n      empty: contentChangeMessage.empty,\n      stackIndex: contentChangeMessage.undoStackIndex,\n      possibleUndoCount: contentChangeMessage.possibleUndoCount,\n    }\n    this.event.emitContentChanged(context)\n  }\n\n  protected manageSVGPatchMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageSVGPatchMessage\", { websocketMessage })\n    this.resizeDeferred?.resolve()\n    const svgPatchMessage = websocketMessage as TRecognizerWebSocketSSRMessageSVGPatch\n    this.event.emitSVGPatch(svgPatchMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.#logger.debug(\"messageCallback\", { message })\n    this.currentErrorCode = undefined\n    const websocketMessage: TRecognizerWebSocketSSRMessage = JSON.parse(message.data)\n    if (websocketMessage.type !== \"pong\") {\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case \"ack\":\n          this.manageAckMessage(websocketMessage)\n          break\n        case \"contentPackageDescription\":\n          this.manageContentPackageDescriptionMessage()\n          break\n        case \"partChanged\":\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case \"newPart\":\n          this.initialized.resolve()\n          break\n        case \"contentChanged\":\n          this.manageContentChangeMessage(websocketMessage)\n          break\n        case \"exported\":\n          this.manageExportMessage(websocketMessage)\n          break\n        case \"svgPatch\":\n          this.manageSVGPatchMessage(websocketMessage)\n          break\n        case \"error\":\n          this.manageErrorMessage(websocketMessage)\n          break\n        case \"idle\":\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage.type }\".`)\n      }\n    }\n  }\n\n  async init(height: number, width: number): Promise<void>\n  {\n    try {\n      this.event.emitStartInitialization()\n      this.#logger.info(\"init\", { height, width })\n      this.destroy()\n\n      if (!this.configuration.server.version) {\n        this.configuration.server.version = (await getApiInfos(this.configuration)).version\n      }\n      this.connected = new DeferredPromise<void>()\n      this.initialized = new DeferredPromise<void>()\n      this.ackDeferred = new DeferredPromise<void>()\n      this.viewSizeHeight = height\n      this.viewSizeWidth = width\n      this.pingCount = 0\n      this.socket = new WebSocket(this.url)\n\n      if (this.configuration.server.websocket.pingEnabled) {\n        this.infinitePing()\n      }\n\n      this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n      this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n      this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n      this.event.emitEndtInitialization()\n      await this.connected.promise\n      await this.initialized.promise\n    } catch (err: unknown) {\n      this.rejectDeferredPending(err as Error)\n      return this.initialized.promise\n    }\n  }\n\n  async send(message: TRecognizerWebSocketSSRMessage): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n    await this.connected?.promise\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.#logger.debug(\"send\", { message })\n      this.socket.send(JSON.stringify(message))\n      return Promise.resolve()\n    } else {\n      if (this.socket.readyState != this.socket.CONNECTING && this.configuration.server.websocket.autoReconnect) {\n        this.reconnectionCount++\n        if (this.configuration.server.websocket.maxRetryCount >= this.reconnectionCount) {\n          this.#logger.debug(\"send\", `try to reconnect number: ${ this.reconnectionCount }.`)\n          await this.init(this.viewSizeHeight, this.viewSizeWidth)\n          await this.setPenStyle(this.penStyle as TPenStyle)\n          await this.setPenStyleClasses(this.penStyleClasses as string)\n          await this.setTheme(this.theme as TTheme)\n          return this.send(message)\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n        }\n      }\n    }\n  }\n\n  async addStrokes(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"addStrokes\", { strokes })\n    await this.initialized.promise\n    this.addStrokeDeferred = new DeferredPromise<TExport>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve({} as TExport)\n    }\n    else {\n      await this.send({\n        type: \"addStrokes\",\n        strokes: strokes.map(s => s.formatToSend())\n      })\n    }\n    return this.addStrokeDeferred?.promise\n  }\n\n  async setPenStyle(penStyle: TPenStyle): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    await this.initialized.promise\n    this.penStyle = penStyle\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setPenStyle\",\n      style: StyleHelper.penStyleToCSS(penStyle)\n    }\n    return this.send(message)\n  }\n\n  async setPenStyleClasses(penStyleClasses: string): Promise<void>\n  {\n    await this.initialized.promise\n    this.penStyleClasses = penStyleClasses\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setPenStyleClasses\",\n      styleClasses: penStyleClasses\n    }\n    return this.send(message)\n  }\n\n  async setTheme(theme: TTheme): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    await this.initialized.promise\n    this.theme = theme\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setTheme\",\n      theme: StyleHelper.themeToCSS(theme)\n    }\n    return this.send(message)\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    await this.initialized.promise\n    this.exportDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.configuration.recognition.type }\" is unknown.\\n Possible types are:\\n -MATH\\n -TEXT`)\n      }\n    }\n\n    if (!mimeTypes.length) {\n      return Promise.reject(new Error(`Export failed, no mimeTypes define in recognition ${ this.configuration.recognition.type } configuration`))\n    }\n\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports: TExport = await this.exportDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(exports)\n    this.#logger.debug(\"export\", { model: localModel })\n    return localModel\n  }\n\n  async import(model: Model, data: Blob, mimeType?: string): Promise<Model>\n  {\n    this.#logger.info(\"import\", { data, mimeType })\n    await this.initialized.promise\n    const localModel = model.clone()\n    const chunkSize = this.configuration.server.websocket.fileChunkSize\n    const importFileId = Math.random().toString(10).substring(2, 6)\n    this.importDeferred = new DeferredPromise<TExport>()\n    const readBlob = (blob: Blob): Promise<string | never> =>\n    {\n      const fileReader = new FileReader()\n      return new Promise((resolve, reject) =>\n      {\n        fileReader.onloadend = (ev) => resolve(ev.target?.result as string)\n        fileReader.onerror = () => reject()\n        fileReader.readAsText(blob)\n      })\n    }\n\n    const importFileMessage: TRecognizerWebSocketSSRMessage = {\n      type: \"importFile\",\n      importFileId,\n      mimeType\n    }\n    await this.send(importFileMessage)\n    for (let i = 0; i < data.size; i += chunkSize) {\n      const blobPart = data.slice(i, i + chunkSize, data.type)\n      const partFileString = await readBlob(blobPart)\n      const fileChuckMessage: TRecognizerWebSocketSSRMessage = {\n        type: \"fileChunk\",\n        importFileId,\n        data: partFileString,\n        lastChunk: i + chunkSize > data.size\n      }\n      await this.send(fileChuckMessage)\n    }\n    const exports = await this.importDeferred?.promise\n    this.importDeferred = undefined\n    localModel.mergeExport(exports)\n    return localModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    await this.initialized.promise\n    this.resizeDeferred = new DeferredPromise<void>()\n    const localModel = model.clone()\n    this.viewSizeHeight = localModel.height\n    this.viewSizeWidth = localModel.width\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"changeViewSize\",\n      height: this.viewSizeHeight,\n      width: this.viewSizeWidth,\n    }\n    await this.send(message)\n    await this.resizeDeferred?.promise\n    return localModel\n  }\n\n  async importPointEvents(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"importPointsEvents\", { strokes })\n    await this.initialized.promise\n    this.importPointEventsDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"pointerEvents\",\n      events: strokes.map(s => s.formatToSend())\n    }\n    await this.send(message)\n    return this.importPointEventsDeferred?.promise\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState })\n    await this.initialized.promise\n    this.convertDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"convert\",\n      conversionState\n    }\n    await this.send(message)\n    const myExportConverted: TExport = await this.convertDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeConvert(myExportConverted)\n    this.#logger.debug(\"convert\", { model: localModel })\n    return localModel\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    await this.initialized.promise\n    this.waitForIdleDeferred = new DeferredPromise<void>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  async undo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"undo\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    this.undoDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"undo\",\n    }\n    await this.send(message)\n    const undoExports = await this.undoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(undoExports)\n    this.#logger.debug(\"undo\", { model: localModel })\n    this.undoDeferred = undefined\n    return localModel\n  }\n\n  async redo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"redo\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    this.redoDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"redo\",\n    }\n    await this.send(message)\n    const redoExports = await this.redoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(redoExports)\n    this.#logger.debug(\"redo\", { model: redoExports })\n    this.redoDeferred = undefined\n    return localModel\n  }\n\n  async clear(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"clear\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    localModel.modificationDate = Date.now()\n    this.clearDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"clear\",\n    }\n    await this.send(message)\n    const clearExports = await this.clearDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(clearExports)\n    this.clearDeferred = undefined\n    this.#logger.info(\"clear\", { model: localModel })\n    return localModel\n  }\n\n  close(code: number, reason: string): void\n  {\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.#logger.info(\"close\", { code, reason })\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.socket.close(code, reason)\n    }\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.connected = undefined\n    this.ackDeferred = undefined\n    this.addStrokeDeferred = undefined\n    this.exportDeferred = undefined\n    this.convertDeferred = undefined\n    this.importDeferred = undefined\n    this.importPointEventsDeferred = undefined\n    this.waitForIdleDeferred = undefined\n    this.resizeDeferred = undefined\n    this.undoDeferred = undefined\n    this.redoDeferred = undefined\n    this.clearDeferred = undefined\n    if (this.socket) {\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TPoint, TCanvasShapeEllipseSymbol, TCanvasShapeLineSymbol, TCanvasShapeTableSymbol, TSymbol } from \"../../symbol\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererShape\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  symbols = {\n    table: \"table\",\n    ellipse: \"ellipse\",\n    line: \"line\"\n  }\n\n  protected phi(angle: number): number\n  {\n    let returnedAngle = ((angle + Math.PI) % (Math.PI * 2)) - Math.PI\n    if (returnedAngle < -Math.PI) {\n      returnedAngle += Math.PI * 2\n    }\n    this.#logger.debug(\"phi\", { angle, returnedAngle })\n    return returnedAngle\n  }\n\n  protected drawEllipseArc(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol): TPoint[]\n  {\n    this.#logger.debug(\"drawEllipseArc\", { context2D, shapeEllipse })\n    const { centerPoint, maxRadius, minRadius, orientation, startAngle, sweepAngle } = shapeEllipse\n    const angleStep = 0.02\n    const z1 = Math.cos(orientation) * maxRadius\n    const z2 = Math.cos(orientation) * minRadius\n    const z3 = Math.sin(orientation) * maxRadius\n    const z4 = Math.sin(orientation) * minRadius\n    const n = Math.floor(Math.abs(sweepAngle) / angleStep)\n    const boundariesPoints = []\n    context2D.save()\n    try {\n      context2D.beginPath()\n      for (let i = 0; i <= n; i++) {\n        const angle = startAngle + ((i / n) * sweepAngle)\n        const alpha = Math.atan2(Math.sin(angle) / minRadius, Math.cos(angle) / maxRadius)\n        const cosAlpha = Math.cos(alpha)\n        const sinAlpha = Math.sin(alpha)\n        const x = (centerPoint.x + (z1 * cosAlpha)) - (z4 * sinAlpha)\n        const y = (centerPoint.y + (z2 * sinAlpha)) + (z3 * cosAlpha)\n        if (i === 0) {\n          context2D.moveTo(x, y)\n        } else {\n          context2D.lineTo(x, y)\n        }\n        if (i === 0 || i === n) {\n          boundariesPoints.push({ x, y })\n        }\n      }\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawEllipseArc\", { error })\n    } finally {\n      context2D.restore()\n    }\n    return boundariesPoints\n  }\n\n  protected drawLine(context2D: CanvasRenderingContext2D, p1: TPoint, p2: TPoint)\n  {\n    this.#logger.debug(\"drawLine\", { context2D, p1, p2 })\n    context2D.save()\n    try {\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawLine\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawArrowHead(context2D: CanvasRenderingContext2D, headPoint: TPoint, angle: number, length: number)\n  {\n    this.#logger.debug(\"drawArrowHead\", { context2D, headPoint, angle, length })\n    const alpha = this.phi(angle + (Math.PI * (7 / 8)))\n    const beta = this.phi(angle - (Math.PI * (7 / 8)))\n    context2D.save()\n    try {\n      context2D.fillStyle = context2D.strokeStyle\n\n      context2D.moveTo(headPoint.x, headPoint.y)\n      context2D.beginPath()\n      context2D.lineTo(headPoint.x + (length * Math.cos(alpha)), headPoint.y + (length * Math.sin(alpha)))\n      context2D.lineTo(headPoint.x + (length * Math.cos(beta)), headPoint.y + (length * Math.sin(beta)))\n      context2D.lineTo(headPoint.x, headPoint.y)\n      context2D.fill()\n    } catch(error) {\n      this.#logger.error(\"drawArrowHead\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawShapeEllipse(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol)\n  {\n    this.#logger.debug(\"drawShapeEllipse\", { context2D, shapeEllipse })\n    const points = this.drawEllipseArc(context2D, shapeEllipse)\n\n    if (shapeEllipse?.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[0], shapeEllipse.beginTangentAngle, 12.0)\n    }\n    if (shapeEllipse?.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[1], shapeEllipse.endTangentAngle, 12.0)\n    }\n  }\n\n  protected drawShapeLine(context2D: CanvasRenderingContext2D, shapeLine: TCanvasShapeLineSymbol)\n  {\n    this.#logger.debug(\"drawShapeLine\", { context2D, shapeLine })\n    this.drawLine(context2D, shapeLine.firstPoint, shapeLine.lastPoint)\n    if (shapeLine.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.firstPoint, shapeLine.beginTangentAngle, 12.0)\n    }\n    if (shapeLine.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.lastPoint, shapeLine.endTangentAngle, 12.0)\n    }\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.save()\n    context2D.lineWidth = symbol.style.width as number\n    context2D.strokeStyle = symbol.style.color as string\n\n    switch (symbol.type) {\n      case this.symbols.table: {\n        const tableSymbols = symbol as TCanvasShapeTableSymbol\n        tableSymbols.lines.forEach(line => this.drawLine(context2D, line.p1, line.p2))\n        break\n      }\n      case this.symbols.ellipse: {\n        this.drawShapeEllipse(context2D, symbol as TCanvasShapeEllipseSymbol)\n        break\n      }\n      case this.symbols.line: {\n        this.drawShapeLine(context2D, symbol as TCanvasShapeLineSymbol)\n        break\n      }\n      default:\n        this.#logger.warn(\"draw\", `${ symbol.type } not implemented`)\n        break\n    }\n  }\n\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Stroke, TPointer } from \"../../symbol\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererStroke\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  protected renderArc(context2d: CanvasRenderingContext2D, center: TPointer, radius: number): void\n  {\n    this.#logger.debug(\"renderArc\", { context2d, center, radius })\n    context2d.arc(center.x, center.y, radius, 0, Math.PI * 2, true)\n  }\n\n  protected renderLine(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderLine\", { context2d, begin, end, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.lineTo(linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.lineTo(linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  protected renderFinal(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderFinal\", { context2d, begin, end, width })\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    context2d.moveTo(linkPoints[0].x, linkPoints[0].y)\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - ((i * Math.PI) / ARCSPLIT)\n      context2d.lineTo(end.x - ((end.p * width) * Math.sin(newAngle)), end.y + (end.p * width * Math.cos(newAngle)))\n    }\n  }\n\n  protected renderQuadratic(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, ctrl: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderQuadratic\", { context2d, begin, end, ctrl, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, ctrl), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(ctrl, end), width)\n    const linkPoints3 = computeLinksPointers(ctrl, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.quadraticCurveTo(linkPoints3[0].x, linkPoints3[0].y, linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.quadraticCurveTo(linkPoints3[1].x, linkPoints3[1].y, linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  draw(context2d: CanvasRenderingContext2D, stroke: Stroke): void\n  {\n    this.#logger.info(\"draw\", { context2d, stroke })\n    const NUMBER_POINTS = stroke.pointers.length\n    const NUMBER_QUADRATICS = NUMBER_POINTS - 2\n    const width = (stroke.style.width as number) > 0 ? (stroke.style.width as number) : context2d.lineWidth\n    const color = (stroke.style.color as string) ? (stroke.style.color as string) : context2d.strokeStyle\n    const firstPoint = stroke.pointers[0] as TPointer\n\n    context2d.save()\n    try {\n      context2d.beginPath()\n      if (NUMBER_POINTS < 3) {\n        this.renderArc(context2d, firstPoint, width * 0.6)\n      } else {\n        this.renderArc(context2d, firstPoint, width * firstPoint.p)\n        const secondPoint: TPointer = computeMiddlePointer(firstPoint, stroke.pointers[1])\n        this.renderLine(context2d, firstPoint, secondPoint, width)\n\n        // Possibility to try this (the start looks better when the ink is large)\n        // var first = computeMiddlePoint(stroke.pointers[0], stroke.pointers[1]);\n        // context2d.arc(first.x, first.y, width * first.p, 0, Math.PI * 2, true);\n\n        for (let i = 0; i < NUMBER_QUADRATICS; i++) {\n          const begin: TPointer = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n          const end: TPointer = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n          const ctrl: TPointer = stroke.pointers[i + 1]\n          this.renderQuadratic(context2d, begin, end, ctrl, width)\n        }\n        const beginLine: TPointer = computeMiddlePointer(stroke.pointers[NUMBER_POINTS - 2], stroke.pointers[NUMBER_POINTS - 1])\n        const endLine: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderLine(context2d, beginLine, endLine, width)\n\n        const beginFinal: TPointer = stroke.pointers[NUMBER_POINTS - 2]\n        const endFinal: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderFinal(context2d, beginFinal, endFinal, width)\n      }\n      context2d.closePath()\n      if (color !== undefined) {\n        context2d.fillStyle = color\n        context2d.fill()\n      }\n      context2d.save()\n    }\n    catch (error) {\n      this.#logger.error(\"draw\", { error })\n    }\n    finally {\n      context2d.restore()\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TSymbol, TCanvasTextSymbol, TCanvasTextUnderlineSymbol, TCanvasUnderLineSymbol, TPoint } from \"../../symbol\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererText\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  symbols = {\n    char: \"char\",\n    string: \"string\",\n    textLine: \"textLine\"\n  }\n\n  protected drawUnderline(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol, underline: TCanvasUnderLineSymbol)\n  {\n    this.#logger.debug(\"#drawUnderline\", { context2D, textUnderline, underline })\n    context2D.save()\n    try {\n      const delta = textUnderline.data.width / textUnderline.label.length\n      const p1: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.firstCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      const p2: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.lastCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"#drawUnderline\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawText(context2D: CanvasRenderingContext2D, text: TCanvasTextSymbol)\n  {\n    this.#logger.debug(\"#drawText\", { context2D, text })\n    context2D.save()\n    try {\n      context2D.font = `${ text.data.textHeight }px serif`\n      context2D.textAlign = (text.data.justificationType === \"CENTER\") ? \"center\" : \"left\"\n      context2D.textBaseline = \"bottom\"\n      context2D.fillStyle = context2D.strokeStyle\n      context2D.fillText(text.label, text.data.topLeftPoint.x, (text.data.topLeftPoint.y + text.data.height))\n    } catch(error) {\n      this.#logger.error(\"#drawText\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawTextLine(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol)\n  {\n    this.#logger.debug(\"#drawTextLine\", { context2D, textUnderline })\n    this.drawText(context2D, textUnderline)\n    textUnderline.underlineList.forEach((underline) =>\n    {\n      this.drawUnderline(context2D, textUnderline, underline)\n    })\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.lineWidth = (symbol.style.width as number)\n    context2D.strokeStyle = (symbol.style.color as string)\n    switch (symbol.type) {\n      case this.symbols.char:\n      case this.symbols.string:\n        this.drawText(context2D, symbol as TCanvasTextSymbol)\n        break\n      case this.symbols.textLine:\n        this.drawTextLine(context2D, symbol as TCanvasTextUnderlineSymbol)\n        break\n      default:\n        this.#logger.warn(\"draw\", `${symbol.type} not implemented`)\n        break\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Model } from \"../../model\"\nimport { Stroke, TSymbol } from \"../../symbol\"\nimport { TRendererConfiguration } from \"../RendererConfiguration\"\nimport { CanvasRendererShape } from \"./CanvasRendererShape\"\nimport { CanvasRendererStroke } from \"./CanvasRendererStroke\"\nimport { CanvasRendererText } from \"./CanvasRendererText\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n  configuration: Omit<TRendererConfiguration, \"guides\">\n  strokeRenderer: CanvasRendererStroke\n  shapeRenderer: CanvasRendererShape\n  textRenderer: CanvasRendererText\n  context!: {\n    parent: HTMLElement\n    renderingCanvas: HTMLCanvasElement\n    renderingCanvasContext: CanvasRenderingContext2D\n    capturingCanvas: HTMLCanvasElement\n    capturingCanvasContext: CanvasRenderingContext2D\n  }\n\n  constructor(config: Omit<TRendererConfiguration, \"guides\">)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = config\n    this.strokeRenderer = new CanvasRendererStroke()\n    this.shapeRenderer = new CanvasRendererShape()\n    this.textRenderer = new CanvasRendererText()\n  }\n\n  protected createCanvas(type: string): HTMLCanvasElement\n  {\n    this.#logger.debug(\"createCanvas\", { type })\n    const canvas: HTMLCanvasElement = document.createElement(\"canvas\")\n    canvas.id = type\n    canvas.classList.add(type)\n    canvas.classList.add(\"ms-canvas\")\n    return canvas\n  }\n\n  protected resizeContent(): void\n  {\n    const pixelRatio: number = window.devicePixelRatio\n    const elements: HTMLCanvasElement[] = [this.context.renderingCanvas, this.context.capturingCanvas]\n    elements.forEach((canvas) =>\n    {\n      const domElement = canvas.parentNode as HTMLElement\n      const width = Math.max(this.configuration.minWidth, domElement.clientWidth)\n      const height = Math.max(this.configuration.minHeight, domElement.clientHeight)\n      canvas.width = width * pixelRatio\n      canvas.height = height * pixelRatio\n      canvas.getContext(\"2d\")?.scale(pixelRatio, pixelRatio)\n      canvas.style.width = `${ width }px`\n      canvas.style.height = `${ height }px`\n    })\n  }\n\n  protected drawSymbol(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    if (symbol.type === \"stroke\") {\n      const stroke = symbol as Stroke\n      if (stroke.pointerType !== \"eraser\") {\n        this.strokeRenderer.draw(context2D, stroke)\n      }\n    } else if (Object.keys(this.textRenderer.symbols).includes(symbol.type)) {\n      this.textRenderer.draw(context2D, symbol)\n    } else if (Object.keys(this.shapeRenderer.symbols).includes(symbol.type)) {\n      this.shapeRenderer.draw(context2D, symbol)\n    } else {\n      this.#logger.warn(\"drawSymbol\", `symbol type unknow: ${symbol.type}`)\n    }\n  }\n\n  init(element: HTMLElement, guide?: { x?: number, y?: number } ): void\n  {\n    this.#logger.info(\"init\", { element })\n    const renderingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-rendering-canvas\")\n    renderingCanvas.setAttribute(\"data-layer\", \"MODEL\")\n    if (guide) {\n      renderingCanvas.style.backgroundSize = `${guide.x || 1}px ${guide.y || 1}px`\n    }\n    element.appendChild(renderingCanvas)\n\n    const capturingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-capture-canvas\")\n    capturingCanvas.setAttribute(\"data-layer\", \"CAPTURE\")\n    element.appendChild(capturingCanvas)\n\n    this.context = {\n      parent: element,\n      renderingCanvas,\n      renderingCanvasContext: renderingCanvas.getContext(\"2d\") as CanvasRenderingContext2D,\n      capturingCanvas,\n      capturingCanvasContext: capturingCanvas.getContext(\"2d\") as CanvasRenderingContext2D\n    }\n\n    this.resizeContent()\n  }\n\n  drawModel(model: Model): void\n  {\n    this.#logger.info(\"drawModel\", { model })\n    this.context.renderingCanvasContext?.clearRect(0, 0, this.context.renderingCanvas.width, this.context.renderingCanvas.height)\n    model.symbols.forEach(symbol => this.drawSymbol(this.context.renderingCanvasContext, symbol))\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n  }\n\n  drawPendingStroke(stroke: Stroke | undefined): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n    if (stroke && stroke?.pointerType !== \"eraser\") {\n      this.strokeRenderer.draw(this.context.capturingCanvasContext, stroke)\n    }\n  }\n\n  resize(model: Model): void\n  {\n    this.#logger.info(\"resize\", { model })\n    this.resizeContent()\n    this.drawModel(model)\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    if (this.context.parent) {\n      this.context.parent.innerHTML = \"\"\n    }\n  }\n}\n","\n/**\n * @group Renderer\n */\nexport const SVGRendererConst =\n{\n  arrowHeadStartMarker: \"arrow-head-start\",\n  arrowHeadEndMaker: \"arrow-head-end\",\n  selectionFilterId: \"selection-filter\",\n  removalFilterId: \"removal-filter\",\n  crossMarker: \"cross-marker\",\n  noSelection: \"pointer-events: none; -webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;\",\n}","import { TBox, TPoint } from \"../../symbol\"\n\nconst XMLNS = \"http://www.w3.org/2000/svg\"\n/**\n * @group Renderer\n */\nexport class SVGBuilder\n{\n  static createLayer(boundingBox: TBox, attrs: { [key: string]: string } = {}): SVGSVGElement\n  {\n    const svgEl = document.createElementNS(XMLNS, \"svg\")\n    svgEl.setAttribute(\"width\", `${ boundingBox.width }px`)\n    svgEl.setAttribute(\"height\", `${ boundingBox.height }px`)\n    svgEl.setAttribute(\"viewBox\", `${boundingBox.x}, ${boundingBox.y}, ${boundingBox. width }, ${ boundingBox.height }`)\n    Object.keys(attrs).forEach(k =>\n    {\n      svgEl.setAttribute(k, attrs[k])\n    })\n    return svgEl\n  }\n\n  static createFilter(id: string, attrs: { [key: string]: string } = {}): SVGFilterElement\n  {\n    const filter = document.createElementNS(XMLNS, \"filter\")\n    filter.id = id\n    Object.keys(attrs).forEach(k =>\n    {\n      filter.setAttribute(k, attrs[k])\n    })\n    return filter\n  }\n\n  static createDefs(): SVGDefsElement\n  {\n    return document.createElementNS(XMLNS, \"defs\")\n  }\n\n  static createMarker(id: string, attrs: { [key: string]: string } = {}): SVGMarkerElement\n  {\n    const marker = document.createElementNS(XMLNS, \"marker\")\n    marker.setAttribute(\"id\", id)\n    Object.keys(attrs).forEach(k =>\n    {\n      marker.setAttribute(k, attrs[k])\n    })\n    return marker\n  }\n\n  static createComponentTransfert(): SVGFEComponentTransferElement\n  {\n    return document.createElementNS(XMLNS, \"feComponentTransfer\")\n  }\n\n  static createDropShadow({ dx = 0, dy = 0, deviation = 0, color = \"#3e68ff\", opacity = 1 }): SVGFEDropShadowElement\n  {\n    const shadow = document.createElementNS(XMLNS, \"feDropShadow\")\n    shadow.setAttribute(\"dx\", dx.toString())\n    shadow.setAttribute(\"dy\", dy.toString())\n    shadow.setAttribute(\"stdDeviation\", deviation.toString())\n    shadow.setAttribute(\"flood-color\", color)\n    shadow.setAttribute(\"flood-opacity\", opacity.toString())\n    return shadow\n  }\n\n  static createTransfertFunctionTable(type: \"feFuncA\" | \"feFuncB\" | \"feFuncG\" | \"feFuncR\", values: string): SVGFEFuncAElement\n  {\n    const feFunc = document.createElementNS(XMLNS, type)\n    feFunc.setAttribute(\"type\", \"table\")\n    feFunc.setAttribute(\"tableValues\", values)\n    return feFunc\n  }\n\n  static createGroup(attrs: { [key: string]: string } = {}): SVGGElement\n  {\n    const groupEl = document.createElementNS(XMLNS, \"g\")\n    Object.keys(attrs).forEach(k =>\n    {\n      groupEl.setAttribute(k, attrs[k])\n    })\n    return groupEl\n  }\n\n  static createLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): SVGLineElement\n  {\n    const lineEl = document.createElementNS(XMLNS, \"line\")\n    lineEl.setAttribute(\"x1\", p1.x.toString())\n    lineEl.setAttribute(\"y1\", p1.y.toString())\n    lineEl.setAttribute(\"x2\", p2.x.toString())\n    lineEl.setAttribute(\"y2\", p2.y.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      lineEl.setAttribute(k, attrs[k])\n    })\n    return lineEl\n  }\n\n  static createCircle(p: TPoint, r: number, attrs: { [key: string]: string } = {}): SVGCircleElement\n  {\n    const circleEl = document.createElementNS(XMLNS, \"circle\")\n    circleEl.setAttribute(\"cx\", p.x.toString())\n    circleEl.setAttribute(\"cy\", p.y.toString())\n    circleEl.setAttribute(\"r\", r.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      circleEl.setAttribute(k, attrs[k])\n    })\n    return circleEl\n  }\n\n  static createPath(attrs: { [key: string]: string } = {}): SVGPathElement\n  {\n    const pathEl = document.createElementNS(XMLNS, \"path\")\n    Object.keys(attrs).forEach(k =>\n    {\n      pathEl.setAttribute(k, attrs[k])\n    })\n    return pathEl\n  }\n\n  static createPolygon(points: number[], attrs: { [key: string]: string } = {}): SVGPolylineElement\n  {\n    const polygonEl = document.createElementNS(XMLNS, \"polygon\")\n    polygonEl.setAttribute(\"points\", points.join(\",\"))\n    Object.keys(attrs).forEach(k =>\n    {\n      polygonEl.setAttribute(k, attrs[k])\n    })\n    return polygonEl\n  }\n\n  static createRect(box: TBox, attrs: { [key: string]: string } = {}): SVGRectElement\n  {\n    const rectEl = document.createElementNS(XMLNS, \"rect\")\n    rectEl.setAttribute(\"x\", box.x.toString())\n    rectEl.setAttribute(\"y\", box.y.toString())\n    rectEl.setAttribute(\"width\", box.width.toString())\n    rectEl.setAttribute(\"height\", box.height.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      rectEl.setAttribute(k, attrs[k])\n    })\n    return rectEl\n  }\n\n  static createTSpan(text: string, attrs: { [key: string]: string } = {}): SVGTSpanElement\n  {\n    const tSpanEl = document.createElementNS(XMLNS, \"tspan\")\n    tSpanEl.textContent = text\n    Object.keys(attrs).forEach(k =>\n    {\n      tSpanEl.setAttribute(k, attrs[k])\n    })\n    return tSpanEl\n  }\n\n  static createForeignObject(box: TBox, node: HTMLElement, attrs: { [key: string]: string } = {}): SVGForeignObjectElement\n  {\n    const objEl = document.createElementNS(XMLNS, \"foreignObject\")\n    objEl.setAttribute(\"x\", box.x.toString())\n    objEl.setAttribute(\"y\", box.y.toString())\n    objEl.setAttribute(\"width\", box.width.toString())\n    objEl.setAttribute(\"height\", box.height.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      objEl.setAttribute(k, attrs[k])\n    })\n    objEl.appendChild(node)\n    return objEl\n  }\n\n  static createText(p: TPoint, text: string, attrs: { [key: string]: string } = {}): SVGTextElement\n  {\n    const textEl = document.createElementNS(XMLNS, \"text\")\n    textEl.textContent = text\n    textEl.setAttribute(\"x\", p.x.toString())\n    textEl.setAttribute(\"y\", p.y.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      textEl.setAttribute(k, attrs[k])\n    })\n    return textEl\n  }\n}\n","import { EdgeDecoration, EdgeKind, IIEdgeArc, IIEdgeLine, IIEdgePolyLine, TIIEdge } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererEdgeUtil\n{\n  static getLinePath(line: IIEdgeLine): string\n  {\n    return `M ${ line.start.x } ${ line.start.y } L ${ line.end.x } ${ line.end.y }`\n  }\n\n  static getPolyLinePath(line: IIEdgePolyLine): string\n  {\n    return `M ${ line.vertices[0].x } ${ line.vertices[0].y } ${ line.vertices.map(p => `L ${ p.x } ${ p.y }`).join(\" \") }`\n  }\n\n  static getArcPath(arc: IIEdgeArc): string\n  {\n    return `M ${ arc.vertices[0].x } ${ arc.vertices[0].y } Q ${ arc.vertices.map(p => `${ p.x } ${ p.y }`).join(\" \") }`\n  }\n\n  static getSVGPath(edge: TIIEdge): string\n  {\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        return SVGRendererEdgeUtil.getLinePath(edge)\n      case EdgeKind.PolyEdge:\n        return SVGRendererEdgeUtil.getPolyLinePath(edge)\n      case EdgeKind.Arc:\n        return SVGRendererEdgeUtil.getArcPath(edge)\n      default:\n        throw new Error(`Can't getSVGPath for edge cause kind is unknow: \"${ JSON.stringify(edge) }\"`)\n    }\n  }\n\n  static getSVGElement(edge: TIIEdge): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": edge.id,\n      \"type\": edge.type,\n      \"kind\": edge.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (edge.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (edge.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": \"transparent\",\n      \"stroke\": edge.style.color || DefaultStyle.color!,\n      \"stroke-width\": (edge.style.width || DefaultStyle.width).toString(),\n      \"d\": SVGRendererEdgeUtil.getSVGPath(edge),\n    }\n    if (edge.style.opacity) {\n      pathAttrs[\"opacity\"] = edge.style.opacity.toString()\n    }\n\n    if (edge.startDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-start\"] = `url(#${ SVGRendererConst.arrowHeadStartMarker })`\n    }\n    if (edge.endDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-end\"] = `url(#${ SVGRendererConst.arrowHeadEndMaker })`\n    }\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n    return group\n  }\n\n\n}","import { IIEraser, TPointer } from \"../../symbol\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererEraserUtil\n{\n  static getSVGPath(eraser: IIEraser): string\n  {\n    if (eraser.pointers.length < 1) return \"\"\n\n    const firstPoint = eraser.pointers.at(0) as TPointer\n\n    const startPath = `M ${ firstPoint.x } ${ firstPoint.y }`\n\n    if (eraser.pointers.length === 1) {\n      const strokeWith = eraser.style.width || 4\n      return `${startPath} L ${ firstPoint.x  + strokeWith / 2 } ${ firstPoint.y }`\n    }\n\n    const middlePoints = eraser.pointers.slice(1)\n\n    return middlePoints.reduce((acc, point) => {\n      return `${ acc } L ${ point.x } ${ point.y }`\n    }, startPath)\n  }\n\n  static getSVGElement(eraser: IIEraser): SVGPathElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": eraser.id,\n      \"type\": \"eraser\",\n      \"stroke-width\": \"12\",\n      \"stroke\": \"grey\",\n      \"opacity\": \"0.2\",\n      \"shadowBlur\": \"5\",\n      \"stroke-linecap\": \"round\",\n      \"fill\": \"transparent\",\n      \"d\": SVGRendererEraserUtil.getSVGPath(eraser)\n    }\n    return SVGBuilder.createPath(attrs)\n  }\n\n}","import { DecoratorKind, IIDecorator, RecognizedKind, SymbolType, TBox, TIISymbol } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererDecoratorUtil\n{\n  static getSVGElement(decorator: IIDecorator, symbol: TIISymbol): SVGGeometryElement | undefined\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": decorator.id,\n      \"type\": \"decorator\",\n      \"kind\": decorator.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (decorator.style.opacity) {\n      attrs[\"opacity\"] = decorator.style.opacity.toString()\n    }\n    if (symbol.deleting) {\n      attrs[\"opacity\"] = ((decorator.style.opacity || 1) * 0.5).toString()\n    }\n\n    let element: SVGGeometryElement | undefined\n\n    switch (decorator.kind) {\n      case DecoratorKind.Highlight: {\n        attrs[\"opacity\"] = symbol.deleting ? \"0.25\" : \"0.5\"\n        attrs[\"stroke\"] = \"transparent\"\n        attrs[\"fill\"] = decorator.style.color || DefaultStyle.color!\n        const boundingBox: TBox = {\n          x: symbol.bounds.x - +(symbol.style.width || DefaultStyle.width),\n          y: symbol.bounds.y - +(symbol.style.width || DefaultStyle.width),\n          height: symbol.bounds.height + +(symbol.style.width || DefaultStyle.width) * 2,\n          width: symbol.bounds.width + +(symbol.style.width || DefaultStyle.width) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Surround: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const boundingBox: TBox = {\n          x: symbol.bounds.x - +(symbol.style.width || DefaultStyle.width),\n          y: symbol.bounds.y - +(symbol.style.width || DefaultStyle.width),\n          height: symbol.bounds.height + +(symbol.style.width || DefaultStyle.width) * 2,\n          width: symbol.bounds.width + +(symbol.style.width || DefaultStyle.width) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Strikethrough: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const p1 = {\n          x: symbol.bounds.xMin,\n          y: symbol.bounds.yMid\n        }\n        const p2 = {\n          x: symbol.bounds.xMax,\n          y: symbol.bounds.yMid\n        }\n        if (symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text) {\n          p1.y = symbol.baseline - symbol.xHeight / 2\n          p2.y = symbol.baseline - symbol.xHeight / 2\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n      case DecoratorKind.Underline: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const p1 = {\n          x: symbol.bounds.xMin,\n          y: symbol.bounds.yMax + +(symbol.style.width || DefaultStyle.width)\n        }\n        const p2 = {\n          x: symbol.bounds.xMax,\n          y: symbol.bounds.yMax + +(symbol.style.width || DefaultStyle.width)\n        }\n        if (symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text) {\n          p1.y = symbol.baseline + symbol.xHeight / 2\n          p2.y = symbol.baseline + symbol.xHeight / 2\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n    }\n\n    return element\n  }\n}","import { IIShapeCircle, IIShapeEllipse, IIShapePolygon, ShapeKind, TIIShape } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { convertRadianToDegree } from \"../../utils\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererShapeUtil\n{\n  static getPolygonePath(polygon: IIShapePolygon): string\n  {\n    return `M ${polygon.points[0].x} ${polygon.points[0].y} ${polygon.points.slice(1).map(p => `L ${p.x} ${p.y}`).join(\" \")} Z`\n  }\n\n  static getCirclePath(circle: IIShapeCircle): string\n  {\n    return `M ${circle.center.x - circle.radius} ${circle.center.y} a ${circle.radius} ${circle.radius} 0 1 1 ${circle.radius * 2} 0 a ${circle.radius} ${circle.radius} 0 1 1 -${circle.radius * 2} 0 Z`\n  }\n\n  static getEllipsePath(ellipse: IIShapeEllipse): string\n  {\n    return `M ${ellipse.center.x - ellipse.radiusX} ${ellipse.center.y} a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 ${ellipse.radiusX * 2} 0 a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 -${ellipse.radiusX * 2} 0 Z`\n  }\n\n  static getSVGPath(shape: TIIShape): string\n  {\n    switch(shape.kind) {\n      case ShapeKind.Polygon:\n        return SVGRendererShapeUtil.getPolygonePath(shape as IIShapePolygon)\n      case ShapeKind.Circle:\n        return SVGRendererShapeUtil.getCirclePath(shape as IIShapeCircle)\n      case ShapeKind.Ellipse:\n        return SVGRendererShapeUtil.getEllipsePath(shape as IIShapeEllipse)\n      default:\n        throw new Error(`Can't getSVGPath for shape cause kind is unknow: \"${ JSON.stringify(shape) }\"`)\n    }\n  }\n\n  static getSVGElement(shape: TIIShape): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": shape.id,\n      \"type\": shape.type,\n      \"kind\": shape.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (shape.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (shape.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": shape.style.fill || \"transparent\",\n      \"stroke\": shape.style.color || DefaultStyle.color!,\n      \"stroke-width\": (shape.style.width || DefaultStyle.width).toString(),\n      \"d\": SVGRendererShapeUtil.getSVGPath(shape),\n    }\n    if (shape.style.opacity) {\n      pathAttrs[\"opacity\"] = shape.style.opacity.toString()\n    }\n    if (shape.kind === ShapeKind.Ellipse) {\n      pathAttrs.transform = `rotate(${ convertRadianToDegree(shape.orientation) }, ${shape.center.x}, ${shape.center.y})`\n    }\n\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n\n    return group\n  }\n}","import { DecoratorKind, IIStroke, TPointer } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererStrokeUtil\n{\n\n  protected static getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x } ${ center.y }`,\n      `m ${ -radius } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ radius * 2 } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ -(radius * 2) } 0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x } ${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      const x = +(end.x - (end.p * width * Math.sin(newAngle))).toFixed(3)\n      const y = +(end.y + (end.p * width * Math.cos(newAngle))).toFixed(3)\n      parts.push(`L ${ x } ${ y }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected static getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x } ${ linkPoints3[0].y } ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x } ${ linkPoints3[1].y } ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  static getSVGPath(stroke: IIStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    if (!STROKE_LENGTH) return \"\"\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  static getSVGElement(stroke: IIStroke): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": stroke.id,\n      \"type\": \"stroke\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (stroke.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (stroke.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const strokeGroup = SVGBuilder.createGroup(attrs)\n\n    const strokeAttrs: { [key: string]: string } = {\n      \"fill\": stroke.style.color || DefaultStyle.color!,\n      \"stroke-width\": stroke.style.width.toString(),\n      \"d\": SVGRendererStrokeUtil.getSVGPath(stroke)\n    }\n    if (stroke.style.opacity) {\n      strokeAttrs.opacity = stroke.style.opacity.toString()\n    }\n    strokeGroup.append(SVGBuilder.createPath(strokeAttrs))\n\n    stroke.decorators.forEach(d =>\n    {\n      const deco = SVGRendererDecoratorUtil.getSVGElement(d, stroke)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          strokeGroup.prepend(deco)\n        }\n        else {\n          strokeGroup.append(deco)\n        }\n      }\n    })\n\n    return strokeGroup\n  }\n\n}","import { DecoratorKind, IIText } from \"../../symbol\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererTextUtil\n{\n  static getSVGElement(text: IIText): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": text.id,\n      \"type\": text.type,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"style\": SVGRendererConst.noSelection,\n    }\n    if (text.style.opacity) {\n      attrs.opacity = text.style.opacity.toString()\n    }\n    if (text.rotation) {\n      attrs.transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n    }\n    if (text.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (text.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const textGroup = SVGBuilder.createGroup(attrs)\n\n    const textElement = SVGBuilder.createText(text.point, \"\")\n\n    text.chars.forEach(c =>\n    {\n      const attrs: { [key: string]: string } = {\n        id: c.id,\n        fill: c.color,\n        \"font-size\": `${ c.fontSize }px`,\n        \"font-weight\": c.fontWeight.toString(),\n      }\n      textElement.appendChild(SVGBuilder.createTSpan(c.label, attrs))\n    })\n    textGroup.append(textElement)\n\n    text.decorators.forEach(d =>\n    {\n      const deco = SVGRendererDecoratorUtil.getSVGElement(d, text)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          textGroup.prepend(deco)\n        }\n        else {\n          textGroup.append(deco)\n        }\n      }\n    })\n\n    return textGroup\n  }\n}","import { DecoratorKind, RecognizedKind, TIIRecognized } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererStrokeUtil } from \"./SVGRendererStrokeUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererRecognizedUtil\n{\n  static getSVGElement(recognizedSymbol: TIIRecognized): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": recognizedSymbol.id,\n      \"type\": recognizedSymbol.type,\n      \"kind\": recognizedSymbol.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": recognizedSymbol.style.color || DefaultStyle.color,\n      \"stroke-width\": (recognizedSymbol.style.width || DefaultStyle.width).toString(),\n    }\n    if (recognizedSymbol.style.opacity) {\n      attrs[\"opacity\"] = recognizedSymbol.style.opacity.toString()\n    }\n    if (recognizedSymbol.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (recognizedSymbol.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    recognizedSymbol.strokes.forEach(s =>\n    {\n      groupEl.append(SVGRendererStrokeUtil.getSVGElement(s))\n    })\n\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.decorators.forEach(d =>\n      {\n        const deco = SVGRendererDecoratorUtil.getSVGElement(d, recognizedSymbol)\n        if (deco) {\n          if (d.kind === DecoratorKind.Highlight) {\n            groupEl.prepend(deco)\n          }\n          else {\n            groupEl.append(deco)\n          }\n        }\n      })\n    }\n\n    return groupEl\n  }\n\n}","import { DecoratorKind, IIEraser, IISymbolGroup, SymbolType, TIISymbol } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererEdgeUtil } from \"./SVGRendererEdgeUtil\"\nimport { SVGRendererShapeUtil } from \"./SVGRendererShapeUtil\"\nimport { SVGRendererStrokeUtil } from \"./SVGRendererStrokeUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\nimport { SVGRendererTextUtil } from \"./SVGRendererTextUtil\"\nimport { SVGRendererRecognizedUtil } from \"./SVGRendererRecognizedUtil\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererGroupUtil\n{\n\n  static getChildElement(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined\n  {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = SVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = SVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = SVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = SVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = SVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Recognized:\n        element = SVGRendererRecognizedUtil.getSVGElement(symbol)\n        break\n    }\n    return element\n  }\n\n  static getSVGElement(symbolGroup: IISymbolGroup): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": symbolGroup.id,\n      \"type\": \"group\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": symbolGroup.style.color || DefaultStyle.color!,\n      \"stroke-width\": (symbolGroup.style.width || DefaultStyle.width).toString(),\n    }\n    if (symbolGroup.style.opacity) {\n      attrs[\"opacity\"] = symbolGroup.style.opacity.toString()\n    }\n    if (symbolGroup.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (symbolGroup.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    symbolGroup.children.forEach(sym =>\n    {\n      groupEl.append(SVGRendererGroupUtil.getChildElement(sym)!)\n    })\n\n    symbolGroup.decorators.forEach(d =>\n    {\n      const deco = SVGRendererDecoratorUtil.getSVGElement(d, symbolGroup)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          groupEl.prepend(deco)\n        }\n        else {\n          groupEl.append(deco)\n        }\n      }\n    })\n\n    return groupEl\n  }\n\n}","import { SvgElementRole } from \"../../Constants\"\nimport { getClosestPoints } from \"../../utils\"\nimport { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TIISymbol, TPoint, TBox, Box, IIEraser, SymbolType } from \"../../symbol\"\nimport { TIIRendererConfiguration } from \"../RendererConfiguration\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGRendererEdgeUtil } from \"./SVGRendererEdgeUtil\"\nimport { SVGRendererEraserUtil } from \"./SVGRendererEraserUtil\"\nimport { SVGRendererGroupUtil } from \"./SVGRendererGroupUtil\"\nimport { SVGRendererShapeUtil } from \"./SVGRendererShapeUtil\"\nimport { SVGRendererStrokeUtil } from \"./SVGRendererStrokeUtil\"\nimport { SVGRendererTextUtil } from \"./SVGRendererTextUtil\"\nimport { SVGRendererRecognizedUtil } from \"./SVGRendererRecognizedUtil\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRenderer {\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n  groupGuidesId = \"guides-wrapper\"\n\n  configuration: TIIRendererConfiguration\n  parent!: HTMLElement\n  layer!: SVGSVGElement\n  definitionGroup!: SVGGElement\n\n  verticalGuides: number[] = []\n  horizontalGuides: number[] = []\n\n  constructor(configuration: TIIRendererConfiguration) {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected initLayer(): void {\n    const width = Math.max(this.configuration.minWidth, this.parent.clientWidth)\n    const height = Math.max(this.configuration.minHeight, this.parent.clientHeight)\n    this.layer = SVGBuilder.createLayer({ x: 0, y: 0, width, height })\n    this.layer.style.setProperty(\"height\", \"auto\")\n    this.layer.style.setProperty(\"width\", \"auto\")\n    this.layer.appendChild(this.createSVGTools())\n    this.parent.style.setProperty(\"overflow\", \"auto\")\n    this.parent.appendChild(this.layer)\n  }\n\n  protected createDefs(): SVGDefsElement {\n    const defs = SVGBuilder.createDefs()\n\n    const SIZE = 5\n    const REFX = SIZE - 1, REFY = SIZE / 2\n    const arrowHeadMarkerAttrs = {\n      style: SVGRendererConst.noSelection,\n      fill: \"context-stroke\",\n      markerWidth: SIZE.toString(),\n      markerHeight: SIZE.toString(),\n      refX: REFX.toString(),\n      refY: REFY.toString(),\n    }\n\n    const arrowHeadStart = SVGBuilder.createMarker(SVGRendererConst.arrowHeadStartMarker, { ...arrowHeadMarkerAttrs, orient: \"auto-start-reverse\" })\n    arrowHeadStart.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadStart)\n\n    const arrowHeadEnd = SVGBuilder.createMarker(SVGRendererConst.arrowHeadEndMaker, { ...arrowHeadMarkerAttrs, orient: \"auto\" })\n    arrowHeadEnd.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadEnd)\n\n    const crossMarkerAttrs = {\n      style: SVGRendererConst.noSelection,\n      markerWidth: \"5\",\n      markerHeight: \"5\",\n      refX: \"0\",\n      refY: \"0\",\n      viewBox: \"-5 -5 10 10\"\n    }\n    const cross = SVGBuilder.createMarker(SVGRendererConst.crossMarker, crossMarkerAttrs)\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"white\", \"stroke-width\": \"3\" }))\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"context-stroke\", \"stroke-width\": \"2\" }))\n    defs.appendChild(cross)\n\n    return defs\n  }\n\n  protected createFilters(): SVGGElement {\n    const filtersGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    const removalFilter = SVGBuilder.createFilter(SVGRendererConst.removalFilterId, { filterUnits: \"userSpaceOnUse\" })\n    const bfeComponentTransfer = SVGBuilder.createComponentTransfert()\n    const bfeFuncA = SVGBuilder.createTransfertFunctionTable(\"feFuncA\", \"0 0.25\")\n    bfeComponentTransfer.appendChild(bfeFuncA)\n    removalFilter.appendChild(bfeComponentTransfer)\n    filtersGroup.appendChild(removalFilter)\n\n    const selectionFilter = SVGBuilder.createFilter(SVGRendererConst.selectionFilterId, { filterUnits: \"userSpaceOnUse\" })\n    selectionFilter.appendChild(SVGBuilder.createDropShadow({ dx: -1, dy: -1, deviation: 1 }))\n    filtersGroup.appendChild(selectionFilter)\n\n    return filtersGroup\n  }\n\n  protected drawGuides(): void {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    const height = Number(this.layer.getAttribute(\"height\")?.replace(\"px\", \"\"))\n    const width = Number(this.layer.getAttribute(\"width\")?.replace(\"px\", \"\"))\n    const offSet = this.configuration.guides.gap\n    const subOffSet = this.configuration.guides.gap / 5\n    const attrs = {\n      id: this.groupGuidesId,\n      stroke: \"grey\",\n      opacity: \"0.5\",\n      style: SVGRendererConst.noSelection,\n      role: SvgElementRole.Guide\n    }\n    const guidesGroup = SVGBuilder.createGroup(attrs)\n    switch (this.configuration.guides.type) {\n      case \"line\":\n        for (let y = offSet; y < height; y += offSet) {\n          const begin: TPoint = { x: offSet, y }\n          const end: TPoint = { x: width - offSet, y }\n          this.horizontalGuides.push(y)\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: SVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n        }\n        break\n      case \"grid\":\n        for (let y = 0; y < height; y += offSet) {\n          const begin: TPoint = { x: 0, y }\n          const end: TPoint = { x: width, y }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: SVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.horizontalGuides.push(y)\n          for (let subY = y + subOffSet; subY < y + offSet; subY += subOffSet) {\n            this.horizontalGuides.push(subY)\n            const svgLine = SVGBuilder.createLine({ x: 0, y: subY }, { x: width, y: subY }, { \"stroke-width\": \"0.25\", style: SVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        for (let x = 0; x < width; x += offSet) {\n          const begin: TPoint = { x, y: 0 }\n          const end: TPoint = { x, y: height }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: SVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.verticalGuides.push(x)\n          for (let subX = x + subOffSet; subX < x + offSet; subX += subOffSet) {\n            this.verticalGuides.push(subX)\n            const svgLine = SVGBuilder.createLine({ x: subX, y: 0 }, { x: subX, y: height }, { \"stroke-width\": \"0.25\", style: SVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        break\n      case \"point\":\n        for (let x = offSet; x < width; x += offSet) {\n          this.verticalGuides.push(x)\n          for (let y = offSet; y < height; y += offSet) {\n            this.horizontalGuides.push(y)\n            const svgPoint = SVGBuilder.createCircle({ x, y }, 1)\n            guidesGroup.appendChild(svgPoint)\n          }\n        }\n        break\n      default:\n        this.#logger.error(\"drawGuides\", `Guide type unknown: ${this.configuration.guides.type}`)\n        break\n    }\n    this.horizontalGuides = [...new Set(this.horizontalGuides)]\n    this.verticalGuides = [...new Set(this.verticalGuides)]\n    this.definitionGroup.appendChild(guidesGroup)\n  }\n\n  protected removeGuides(): void {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    this.layer.querySelector(`#${this.groupGuidesId}`)?.remove()\n  }\n\n  protected createSVGTools(): SVGGElement {\n    this.definitionGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    this.definitionGroup.appendChild(this.createDefs())\n    this.definitionGroup.appendChild(this.createFilters())\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n    return this.definitionGroup\n  }\n\n  init(element: HTMLElement): void {\n    this.#logger.info(\"init\", { element })\n    this.parent = element\n    this.parent.oncontextmenu = () => false\n    this.initLayer()\n  }\n\n  getAttribute(id: string, name: string): string | undefined | null {\n    const element = this.layer.querySelector(`#${id}`) as HTMLElement | null\n    return element?.getAttribute(name)\n  }\n\n  setAttribute(id: string, name: string, value: string): void {\n    const element = this.layer.querySelector(`#${id}`) as HTMLElement | null\n    element?.setAttribute(name, value)\n  }\n\n  buildElementFromSymbol(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = SVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Eraser:\n        element = SVGRendererEraserUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = SVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = SVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = SVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = SVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Recognized:\n        element = SVGRendererRecognizedUtil.getSVGElement(symbol)\n        break\n      default:\n        this.#logger.error(\"buildElementFromSymbol\", `symbol unknow: \"${JSON.stringify(symbol)}\"`)\n    }\n    return element\n  }\n\n  prependElement(el: Element): void {\n    this.layer.prepend(el)\n  }\n\n  changeOrderSymbol(symbolToMove: TIISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void {\n    const moveEl = this.layer.querySelector(`#${symbolToMove.id}`)\n    if (!moveEl) return\n    switch (position) {\n      case \"first\":\n        this.definitionGroup.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"last\":\n        this.layer.insertAdjacentElement(\"beforeend\", moveEl)\n        break\n      case \"forward\":\n        moveEl.nextElementSibling?.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"backward\":\n        if (moveEl.previousElementSibling !== this.definitionGroup) {\n          moveEl.previousElementSibling?.insertAdjacentElement(\"beforebegin\", moveEl)\n        }\n        break\n    }\n  }\n\n  appendElement(el: Element): void {\n    this.layer.appendChild(el)\n  }\n\n  removeElement(id: string): void {\n    this.#logger.debug(\"Element\", { id })\n    const oldStroke = this.layer.querySelector(`#${id}`)\n    if (oldStroke) {\n      oldStroke.remove()\n    }\n  }\n\n  drawSymbol(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    const oldNode = this.layer.querySelector(`#${symbol?.id}`)\n    const svgEl = this.buildElementFromSymbol(symbol)\n\n    if (svgEl) {\n      if (oldNode) {\n        oldNode.replaceWith(svgEl)\n      }\n      else {\n        this.layer.appendChild(svgEl)\n      }\n    }\n    return svgEl\n  }\n\n  replaceSymbol(id: string, symbols: TIISymbol[]): SVGGraphicsElement[] | undefined {\n    this.#logger.debug(\"drawSymbol\", { symbols })\n    const oldNode = this.layer.querySelector(`#${id}`)\n    const elements = symbols.map(s => this.buildElementFromSymbol(s)).filter(x => !!x) as SVGGraphicsElement[]\n\n    if (elements.length) {\n      if (oldNode) {\n        elements.forEach(e => oldNode.insertAdjacentElement(\"beforebegin\", e))\n        oldNode.remove()\n      }\n      else {\n        elements.forEach(e => this.layer.appendChild(e))\n      }\n    }\n    return elements\n  }\n\n  removeSymbol(id: string): void {\n    this.#logger.debug(\"removeSymbol\", { id })\n    this.removeElement(id)\n  }\n\n  drawCircle(point: TPoint, radius: number, attrs: { [key: string]: string } = {}): void {\n    this.#logger.info(\"drawCircle\", { point, radius, attrs })\n    this.layer.appendChild(SVGBuilder.createCircle(point, radius, attrs))\n  }\n\n  drawRect(box: TBox, attrs: { [key: string]: string } = {}): void {\n    this.#logger.info(\"drawRect\", { box, attrs })\n    this.layer.appendChild(SVGBuilder.createRect(box, attrs))\n  }\n\n  drawLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): void {\n    this.#logger.info(\"drawLine\", { p1, p2, attrs })\n    this.layer.appendChild(SVGBuilder.createLine(p1, p2, attrs))\n  }\n\n  drawConnectionBetweenBox(id: string, box1: TBox, box2: TBox, position: \"corners\" | \"sides\", attrs?: { [key: string]: string }): void {\n    let points1: TPoint[] = new Box(box1).corners\n    let points2: TPoint[] = new Box(box2).corners\n    if (position === \"sides\") {\n      points1 = new Box(box1).side\n      points2 = new Box(box2).side\n    }\n    const { p1, p2 } = getClosestPoints(points1, points2)\n    const attrsLine = {\n      id,\n      fill: \"transparent\",\n      style: SVGRendererConst.noSelection,\n      ...attrs\n    }\n    this.drawLine(p1, p2, attrsLine)\n  }\n\n  resize(height: number, width: number): void {\n    this.#logger.info(\"resize\", { height, width })\n    this.layer.setAttribute(\"width\", `${width}px`)\n    this.layer.setAttribute(\"height\", `${height}px`)\n    this.layer.setAttribute(\"viewBox\", `0, 0, ${width}, ${height}`)\n    this.removeGuides()\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n  }\n\n  getElementById(id: string): SVGGraphicsElement | null {\n    return this.layer.querySelector(`#${id}`) as SVGGraphicsElement | null\n  }\n\n  getElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): NodeListOf<Element> {\n    this.#logger.info(\"getElements\", { tagName, attrs })\n    let query = tagName || \"*\"\n    if (attrs) {\n      Object.keys(attrs).forEach(k => {\n        query += `[${k}=${attrs[k]}]`\n      })\n    }\n    return this.layer.querySelectorAll(query)\n  }\n\n  clearElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): void {\n    this.#logger.info(\"clearElements\", { tagName, attrs })\n    this.getElements({ tagName, attrs })\n      .forEach(e => e.remove())\n  }\n\n  clear(): void {\n    this.#logger.info(\"clear\")\n    if (this.layer) {\n      while (this.layer.firstChild) {\n        this.layer.firstChild.remove()\n      }\n      this.layer.appendChild(this.createSVGTools())\n    }\n  }\n\n  destroy(): void {\n    if (this.layer) {\n      this.layer.remove()\n    }\n  }\n}","import { TPointer, TStroke } from \"../../symbol\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class SVGStroker\n{\n\n  protected getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x },${ center.y }`,\n      `m ${ -radius },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ radius * 2 },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ -(radius * 2) },0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x },${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      parts.push(`L ${ end.x - (end.p * width * Math.sin(newAngle)) },${ end.y + (end.p * width * Math.cos(newAngle)) }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x },${ linkPoints3[0].y } ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x },${ linkPoints3[1].y } ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected buildSVGPath(stroke: TStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  drawStroke(svgElement: SVGElement, stroke: TStroke, attrs?: { name: string, value: string }[]): void\n  {\n    const svgPathElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\")\n    svgPathElement.classList.add(\"pending-stroke\")\n    svgPathElement.setAttribute(\"id\", stroke.id)\n    svgPathElement.setAttribute(\"type\", stroke.pointerType)\n    attrs?.forEach(a =>\n    {\n      svgPathElement.setAttribute(a.name, a.value)\n    })\n    const svgPath = this.buildSVGPath(stroke)\n    svgPathElement.setAttribute(\"d\", `${ svgPath }Z`)\n    svgElement.appendChild(svgPathElement)\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Model } from \"../../model\"\nimport { TStroke } from \"../../symbol\"\nimport { TRendererConfiguration } from \"../RendererConfiguration\"\nimport { TUpdatePatch, TUpdatePatchAppendChild, TUpdatePatchInsertBefore, TUpdatePatchRemoveAttribut, TUpdatePatchRemoveChild, TUpdatePatchRemoveElement, TUpdatePatchReplaceAll, TUpdatePatchReplaceELement, TUpdatePatchSetAttribut } from \"../../recognizer\"\nimport { SVGStroker } from \"./SVGStroker\"\n\n/**\n * @group Renderer\n */\nexport class InteractiveInkSSRSVGRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  config: TRendererConfiguration\n  stroker: SVGStroker\n  context!: {\n    parent: HTMLElement\n  }\n\n  constructor(config: TRendererConfiguration)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.config = config\n    this.stroker = new SVGStroker()\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    element.style.fontSize = \"10px\"\n    this.context = {\n      parent: element\n    }\n  }\n\n  protected drawStroke(svgElement: SVGElement, stroke: TStroke)\n  {\n    let style: string\n    if (stroke.pointerType === \"eraser\") {\n      stroke.style.width = 12\n      style = \"fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;\"\n    } else {\n      style = `fill:${ stroke.style.color };stroke:transparent;`\n    }\n    this.stroker.drawStroke(svgElement, stroke, [{ name: \"style\", value: style }])\n  }\n\n  protected replaceAll(layerName: string, update: TUpdatePatchReplaceAll): void\n  {\n    const oldLayer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement | null\n    oldLayer?.remove()\n    this.context.parent.insertAdjacentHTML(\"beforeend\", update.svg)\n    const layer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement\n    if (layerName === \"MODEL\") {\n      const pendingStrokesGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n      pendingStrokesGroup.id = \"pendingStrokes\"\n      layer.appendChild(pendingStrokesGroup)\n    }\n  }\n\n  protected replaceElement(update: TUpdatePatchReplaceELement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`) as HTMLElement | null\n    if (elementToRemove) {\n      const parent = elementToRemove.parentNode as HTMLElement | null | undefined\n      elementToRemove?.remove()\n      parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n    }\n  }\n\n  protected appendChild(layerName: string, update: TUpdatePatchAppendChild): void\n  {\n    const parentSelector = update.parentId ? `#${ update.parentId }` : `svg[data-layer=\"${ layerName }\"]`\n    const parent = this.context.parent.querySelector(parentSelector) as HTMLElement\n    parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n  }\n\n  protected removeChild(update: TUpdatePatchRemoveChild): void\n  {\n    this.context.parent.querySelector(`#${ update.parentId } > *:nth-child(${ update.index + 1 })`)?.remove()\n  }\n\n  protected removeElement(update: TUpdatePatchRemoveElement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`)\n    if (elementToRemove) {\n      if (update.id.includes(\"s\") || update.id.includes(\"MODEL\")) {\n        elementToRemove.remove()\n      } else {\n        elementToRemove.setAttribute(\"class\", \"removed-stroke\")\n        setTimeout(() =>\n        {\n          elementToRemove?.remove()\n        }, 100)\n      }\n    }\n  }\n\n  protected insertBefore(update: TUpdatePatchInsertBefore): void\n  {\n    const parent = this.context.parent.querySelector(`#${ update.refId }`) as HTMLElement | null\n    parent?.insertAdjacentHTML(\"beforebegin\", update.svg)\n  }\n\n  protected setAttribute(update: TUpdatePatchSetAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.setAttribute(update.name, update.value)\n  }\n\n  protected removeAttribute(update: TUpdatePatchRemoveAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.removeAttribute(update.name)\n  }\n\n  updateLayer(layerName: string, update: TUpdatePatch): void\n  {\n    this.#logger.info(\"updateLayer\", { layerName, update })\n    switch (update.type) {\n      case \"REPLACE_ALL\":\n        this.replaceAll(layerName, update as TUpdatePatchReplaceAll)\n        break\n      case \"REPLACE_ELEMENT\":\n        this.replaceElement(update as TUpdatePatchReplaceELement)\n        break\n      case \"APPEND_CHILD\":\n        this.appendChild(layerName, update as TUpdatePatchAppendChild)\n        break\n      case \"REMOVE_ELEMENT\":\n        this.removeElement(update as TUpdatePatchRemoveElement)\n        break\n      case \"REMOVE_CHILD\":\n        this.removeChild(update as TUpdatePatchRemoveChild)\n        break\n      case \"INSERT_BEFORE\":\n        this.insertBefore(update as TUpdatePatchInsertBefore)\n        break\n      case \"SET_ATTRIBUTE\":\n        this.setAttribute(update as TUpdatePatchSetAttribut)\n        break\n      case \"REMOVE_ATTRIBUTE\":\n        this.removeAttribute(update as TUpdatePatchRemoveAttribut)\n        break\n      default:\n        this.#logger.warn(\"updateLayer\", `update.type unknow ${update.type}`)\n        break\n    }\n  }\n\n  updatesLayer(layerName: string, updates: TUpdatePatch[]): void\n  {\n    this.#logger.info(\"updatesLayer\", { layerName, updates })\n    updates.forEach(u => this.updateLayer(layerName, u))\n    this.clearPendingStroke()\n  }\n\n  clearPendingStroke(): void\n  {\n    this.#logger.info(\"clearPendingStroke\")\n    const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n    if (pendingStrokeGroup) {\n      pendingStrokeGroup.innerHTML = \"\"\n    }\n  }\n\n  drawPendingStroke(stroke: TStroke): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    if (stroke) {\n      const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n      if (pendingStrokeGroup) {\n        const oldStroke = pendingStrokeGroup.querySelector(`#${ stroke?.id }`)\n        if (oldStroke) {\n          oldStroke.remove()\n        }\n        this.drawStroke(pendingStrokeGroup, stroke)\n      }\n    }\n  }\n\n  clearErasingStrokes(): void\n  {\n    const erasingStrokeList = this.context.parent.querySelectorAll(\"[type=eraser]\") as NodeListOf<SVGElement>\n    erasingStrokeList.forEach(erasingStroke => {\n      erasingStroke.remove()\n    })\n  }\n\n  resize(model: Model): void\n  {\n    this.#logger.info(\"resize\", { model })\n    const rect = this.context.parent.getBoundingClientRect()\n    const svgList = this.context.parent.querySelectorAll(\"svg\")\n    const width = Math.max(rect.width, model.width)\n    const height = Math.max(rect.height, model.height)\n    svgList.forEach(svg =>\n    {\n      svg.setAttribute(\"viewBox\", `0 0 ${ width }, ${ height }`)\n      svg.setAttribute(\"width\", `${ width }px`)\n      svg.setAttribute(\"height\", `${ height }px`)\n    })\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\", { context: this.context })\n    if (this.context?.parent) {\n      this.context.parent.querySelectorAll(\"svg\").forEach(n => n.remove())\n    }\n  }\n}","\n/**\n * @group Renderer\n */\nexport type TGuidesConfiguration = {\n  enable: boolean,\n  gap: number\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultGuidesConfiguration: TGuidesConfiguration = {\n  enable: true,\n  gap: 50,\n}\n\n/**\n * @group Renderer\n */\nexport type TRendererConfiguration = {\n  minHeight: number\n  minWidth: number\n  guides: TGuidesConfiguration\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultRendererConfiguration: TRendererConfiguration = {\n  guides: DefaultGuidesConfiguration,\n  minHeight: 100,\n  minWidth: 100,\n}\n\n/**\n * @group Renderer\n */\nexport type TIIRendererConfiguration = TRendererConfiguration & {\n  guides: TGuidesConfiguration & {\n    type: \"line\" | \"grid\" | \"point\"\n  },\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultIIRendererConfiguration: TIIRendererConfiguration = {\n  guides: {\n    enable: true,\n    gap: 50,\n    type: \"point\"\n  },\n  minHeight: 100,\n  minWidth: 100,\n}\n","\n/**\n * @group Grabber\n */\nexport type TListenerConfiguration = {\n  capture: boolean\n  passive: boolean\n}\n\n/**\n * @group Grabber\n * @source\n */\nexport const DefaultListenerConfiguration: TListenerConfiguration = {\n  capture: false,\n  passive: true\n}\n\n/**\n * @group Grabber\n */\nexport type TGrabberConfiguration = {\n  listenerOptions: TListenerConfiguration\n  xyFloatPrecision: number\n  timestampFloatPrecision: number\n  delayLongTouch: number\n}\n\n/**\n * @group Grabber\n * @source\n */\nexport const DefaultGrabberConfiguration: TGrabberConfiguration = {\n  listenerOptions: DefaultListenerConfiguration,\n  xyFloatPrecision: 0,\n  timestampFloatPrecision: 0,\n  delayLongTouch: 500\n}\n","import { TGrabberConfiguration } from \"./GrabberConfiguration\"\nimport { LoggerCategory, LoggerLevel, LoggerManager } from \"../logger\"\nimport { TPointer } from \"../symbol\"\n\nexport type PointerInfo = {\n  clientX: number,\n  clientY: number,\n  isPrimary: boolean,\n  type: string,\n  pointerType: string,\n  target: HTMLElement,\n  pointer: TPointer,\n  button: number,\n  buttons: number\n}\n\n/**\n * @group Grabber\n */\nexport class PointerEventGrabber\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.GRABBER)\n\n  protected configuration: TGrabberConfiguration\n  protected layerCapture!: HTMLElement\n  protected capturing: boolean = false\n  protected pointerType?: string\n  protected prevent = (e: Event) => e.preventDefault()\n\n  onPointerDown?: (info: PointerInfo) => void\n  onPointerMove?: (info: PointerInfo) => void\n  onPointerUp?: (info: PointerInfo) => void\n  onContextMenu?: (info: PointerInfo) => void\n\n  constructor(configuration: TGrabberConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected roundFloat(oneFloat: number, requestedFloatPrecision: number): number\n  {\n    if (requestedFloatPrecision >= 0) {\n      const floatPrecision: number = Math.pow(10, requestedFloatPrecision)\n      return Math.round(oneFloat / floatPrecision) * floatPrecision\n    }\n    this.#logger.debug(\"roundFloat\", { oneFloat, requestedFloatPrecision })\n    return oneFloat\n  }\n\n  protected extractPointer(event: MouseEvent | TouchEvent): TPointer\n  {\n    let clientX: number, clientY: number\n    if (\"changedTouches\" in event) {\n      ({ clientX, clientY } = event.changedTouches[0])\n    } else {\n      ({ clientX, clientY } = event)\n    }\n    const rect: DOMRect = this.layerCapture.getBoundingClientRect()\n    const pointer = {\n      x: this.roundFloat(clientX - rect.left - this.layerCapture.clientLeft + this.layerCapture.scrollLeft, this.configuration.xyFloatPrecision),\n      y: this.roundFloat(clientY - rect.top - this.layerCapture.clientTop + this.layerCapture.scrollTop, this.configuration.xyFloatPrecision),\n      t: this.roundFloat(Date.now(), this.configuration.timestampFloatPrecision),\n      p: (event as PointerEvent).pressure,\n    }\n    this.#logger.debug(\"extractPointer\", { event, pointer })\n    return pointer\n  }\n\n  protected getPointerInfos(evt: PointerEvent): PointerInfo\n  {\n    return {\n      clientX: evt.clientX,\n      clientY: evt.clientY,\n      isPrimary: evt.isPrimary,\n      type: evt.type,\n      target: evt.target as HTMLElement,\n      pointerType: evt.pointerType,\n      pointer: this.extractPointer(evt),\n      button: evt.button,\n      buttons: evt.buttons\n    }\n  }\n\n  protected pointerDownHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerDownHandler\", pointerInfo)\n\n    // exit if not a left click or multi-touch\n    if (pointerInfo.button !== 0 || evt.buttons !== 1) {\n      return\n    }\n    this.capturing = true\n    this.pointerType = evt.pointerType\n\n    if (this.#logger.level === LoggerLevel.INFO) {\n      this.#logger.info(\"pointerDownHandler\", pointerInfo)\n    }\n\n    if (this.onPointerDown) {\n      this.onPointerDown(pointerInfo)\n    }\n  }\n\n  protected pointerMoveHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerMoveHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerMoveHandler\", pointerInfo)\n      }\n      if (this.onPointerMove) {\n        this.onPointerMove(pointerInfo)\n      }\n    }\n  }\n\n  protected pointerUpHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerUpHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerUpHandler\", pointerInfo)\n      }\n      this.pointerType = undefined\n      this.capturing = false\n      if (this.onPointerUp) {\n        this.onPointerUp(pointerInfo)\n      }\n    }\n  }\n\n  protected pointerOutHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerOutHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType && !this.layerCapture.contains(evt.target as HTMLElement)) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerOutHandler\", pointerInfo)\n      }\n      this.pointerType = undefined\n      this.capturing = false\n      if (this.onPointerUp) {\n        this.onPointerUp(pointerInfo)\n      }\n    }\n  }\n\n  protected contextMenuHandler = (evt: MouseEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt as PointerEvent)\n    this.#logger.debug(\"contextMenuHandler\", pointerInfo)\n    if (evt.target && this.onContextMenu){\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"contextMenuHandler\", pointerInfo)\n      }\n      this.onContextMenu(pointerInfo)\n    }\n  }\n\n  stopPointerEvent(): void\n  {\n    this.capturing = false\n    this.pointerType = undefined\n  }\n\n  attach(layerCapture: HTMLElement)\n  {\n    this.#logger.info(\"attach\", { domElement: layerCapture })\n    if (this.layerCapture) {\n      this.detach()\n    }\n    this.layerCapture = layerCapture\n    // The touch-action CSS property prevents the input from continuing.\n    // https://developer.mozilla.org/en-US/docs/Web/API/Element/pointercancel_event\n    this.layerCapture.style.setProperty(\"touch-action\", \"none\")\n    this.layerCapture.addEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n\n  detach()\n  {\n    this.#logger.info(\"detach\")\n    this.layerCapture?.style.removeProperty(\"touch-action\")\n    this.layerCapture?.removeEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport\n{\n  TIISymbol,\n  TPointer,\n} from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { InkEditor } from \"../editor\"\n\n\n/**\n * @group Manager\n */\nexport abstract class AbstractWriterManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.WRITE)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor | InkEditor\n  currentSymbol?: TIISymbol\n\n  detectGesture: boolean = true\n\n  constructor(editor: InteractiveInkEditor | InkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  protected abstract createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol\n  protected abstract updateCurrentSymbol(pointer: TPointer): TIISymbol\n\n  start(info: PointerInfo): void\n  {\n    this.#logger.info(\"startWriting\", { info })\n    const localPointer = info.pointer\n    this.currentSymbol = this.createCurrentSymbol(localPointer, this.editor.penStyle, info.pointerType)\n    this.renderer.drawSymbol(this.currentSymbol!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    this.#logger.info(\"continueWriting\", { info })\n    const localPointer = info.pointer\n    this.currentSymbol = this.updateCurrentSymbol(localPointer)\n    this.renderer.drawSymbol(this.currentSymbol!)\n  }\n\n  abstract end(info: PointerInfo): Promise<void>\n}\n","import { InteractiveInkEditor } from \"../editor\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport\n{\n  IIModel,\n  TJIIXChar,\n  TJIIXEdgeArc,\n  TJIIXEdgeElement,\n  JIIXEdgeKind,\n  TJIIXEdgeLine,\n  TJIIXEdgePolyEdge,\n  TJIIXExport,\n  TJIIXNodeCircle,\n  TJIIXNodeElement,\n  TJIIXNodeEllipse,\n  JIIXNodeKind,\n  TJIIXNodeParrallelogram,\n  TJIIXNodePolygon,\n  TJIIXNodeRectangle,\n  TJIIXNodeRhombus,\n  TJIIXNodeTriangle,\n  TJIIXTextElement,\n  TJIIXWord\n} from \"../model\"\nimport\n{\n  Box,\n  DecoratorKind,\n  IIDecorator,\n  IIEdgeArc,\n  IIEdgeLine,\n  IIEdgePolyLine,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIShapePolygon,\n  IIStroke,\n  IIText,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TIISymbolChar,\n  TPoint\n} from \"../symbol\"\nimport { RecognizedKind } from \"../symbol\"\nimport { computeAngleAxeRadian, computeAverage, convertBoundingBoxMillimeterToPixel, convertMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class IIConversionManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get configuration(): { size: number | \"auto\", weight: \"bold\" | \"normal\" | \"auto\" } {\n    return this.editor.configuration.fontStyle\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  protected computeFontSize(chars: TJIIXChar[]): number\n  {\n    if (chars.some(c => c[\"bounding-box\"])) {\n      const height = convertMillimeterToPixel(computeAverage(chars.map(c => c[\"bounding-box\"]?.height || 1)))\n      return Math.round(Math.round(height * this.rowHeight) / this.rowHeight / 2) * 2\n    }\n    return Math.round(this.rowHeight / 2)\n  }\n\n  buildChar(char: TJIIXChar, strokes: IIStroke[], fontSize: number): TIISymbolChar\n  {\n    const points = char.grid.map(p => ({\n      x: convertMillimeterToPixel(p.x),\n      y: convertMillimeterToPixel(p.y),\n    }))\n    let fontWeight = this.configuration.weight\n    if (fontWeight === \"auto\") {\n      fontWeight = (strokes[0].style.width || 1) > 2 ? \"bold\" : \"normal\"\n    }\n\n    const color = strokes[0].style.color || \"black\"\n    return {\n      id: `text-char-${ createUUID() }`,\n      label: char.label,\n      color,\n      fontSize,\n      fontWeight,\n      bounds: Box.createFromPoints(points)\n    }\n  }\n\n  buildText(word: TJIIXWord, chars: TJIIXChar[], strokes: IIStroke[], size: number | \"auto\"): IIText\n  {\n    const boundingBox = Box.createFromBoxes([convertBoundingBoxMillimeterToPixel(word[\"bounding-box\"])])\n    const charSymbols: TIISymbolChar[] = []\n    const charFontSize = size === \"auto\" ? this.computeFontSize(chars) : size\n\n    chars.forEach(char =>\n    {\n      const charStrokes = strokes.filter(s => char.items?.some(i => i[\"full-id\"] === s.id)) as IIStroke[]\n      if (charStrokes.length) {\n        charSymbols.push(this.buildChar(char, charStrokes, charFontSize))\n      }\n    })\n    const point: TPoint = {\n      x: boundingBox.xMin,\n      y: boundingBox.yMax\n    }\n    const text = new IIText(charSymbols, point, boundingBox, strokes[0].style)\n    const decorators = strokes.flatMap(s => s.decorators)\n    strokes.forEach(s =>\n    {\n      const sym = this.model.getRootSymbol(s.id)\n      if ((sym?.type === SymbolType.Recognized && sym.kind === RecognizedKind.Text) || sym?.type === SymbolType.Group) {\n        const hightlight = sym.decorators.find(d => d.kind === DecoratorKind.Highlight)\n        if (hightlight) decorators.push(hightlight)\n        const strikethrough = sym.decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n        if (strikethrough) decorators.push(strikethrough)\n        const surround = sym.decorators.find(d => d.kind === DecoratorKind.Surround)\n        if (surround) decorators.push(surround)\n        const underline = sym.decorators.find(d => d.kind === DecoratorKind.Underline)\n        if (underline) decorators.push(underline)\n      }\n    })\n    if (decorators.length) {\n      const hightlight = decorators.find(d => d.kind === DecoratorKind.Highlight)\n      if (hightlight) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Highlight, hightlight.style))\n      }\n      const strikethrough = decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n      if (strikethrough) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Strikethrough, strikethrough.style))\n      }\n      const surround = decorators.find(d => d.kind === DecoratorKind.Surround)\n      if (surround) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Surround, surround.style))\n      }\n      const underline = decorators.find(d => d.kind === DecoratorKind.Underline)\n      if (underline) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Underline, underline.style))\n      }\n    }\n\n    return text\n  }\n\n  convertText(text: TJIIXTextElement, strokes: IIStroke[], onlyText: boolean): { symbol: IIText, strokes: IIStroke[] }[] | undefined\n  {\n    if (!text.lines) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.lines = true\")\n    }\n    if (!text.words) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.words = true\")\n    }\n    if (!text.chars) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.chars = true\")\n    }\n    if (!text.chars.some(c => c.items)) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.strokes = true\")\n    }\n\n    const jiixWords = text.words as TJIIXWord[]\n    const jiixChars = text.chars as TJIIXChar[]\n\n    const result: { symbol: IIText, strokes: IIStroke[] }[] = []\n\n\n    let textFontSize = this.configuration.size\n    if (onlyText && textFontSize === \"auto\") {\n      textFontSize = Math.round(this.computeFontSize(jiixChars.filter(c => c.items?.length)) / 2) * 2\n    }\n    else if (this.configuration.size !== \"auto\") {\n      textFontSize = this.configuration.size * this.rowHeight\n    }\n\n    let isNewLine = false\n    let currentY = convertMillimeterToPixel(text.lines[0][\"baseline-y\"])\n    const leftX = convertMillimeterToPixel(text[\"bounding-box\"]?.x || 0)\n    let currentX = convertMillimeterToPixel(jiixWords[0][\"bounding-box\"]?.x || 0)\n    jiixWords.forEach(word =>\n    {\n      if (word.label === \" \") {\n        currentX += this.editor.texter.getSpaceWidth(result.at(-1)?.symbol.chars[0].fontSize|| (this.rowHeight / 2))\n        return\n      }\n      const wordStrokes = strokes.filter(s => word.items?.some(i => i[\"full-id\"] === s.id)) as IIStroke[]\n      if (wordStrokes.length) {\n        const chars = jiixChars.slice(word[\"first-char\"] as number, (word[\"last-char\"] || 0) + 1)\n        const wordSymbol = this.buildText(word, chars, wordStrokes, textFontSize)\n\n        if (onlyText) {\n          if (isNewLine) {\n            isNewLine = false\n            const nbRow = Math.round((wordSymbol.point.y - currentY) / this.rowHeight) || 1\n            currentY += nbRow * this.rowHeight\n            if (Math.abs(wordSymbol.point.x - leftX) < this.rowHeight) {\n              currentX = leftX\n            }\n            else {\n              currentX = wordSymbol.point.x\n            }\n          }\n          wordSymbol.point.x = currentX\n          wordSymbol.point.y = this.model.roundToLineGuide(currentY)\n        }\n\n        this.editor.texter.setBounds(wordSymbol)\n        currentX += wordSymbol.bounds.width\n        result.push({\n          symbol: wordSymbol,\n          strokes: wordStrokes\n        })\n      }\n      isNewLine = word.label === \"\\n\"\n    })\n\n    return result\n  }\n\n  buildCircle(circle: TJIIXNodeCircle, strokes: IIStroke[]): IIShapeCircle\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(circle.cx),\n      y: convertMillimeterToPixel(circle.cy)\n    }\n    return new IIShapeCircle(center, convertMillimeterToPixel(circle.r), strokes[0]?.style)\n  }\n\n  buildEllipse(ellipse: TJIIXNodeEllipse, strokes: IIStroke[]): IIShapeEllipse\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(ellipse.cx),\n      y: convertMillimeterToPixel(ellipse.cy),\n    }\n    return new IIShapeEllipse(center, convertMillimeterToPixel(ellipse.rx), convertMillimeterToPixel(ellipse.ry), ellipse.orientation, strokes[0]?.style)\n  }\n\n  buildRectangle(rectangle: TJIIXNodeRectangle, strokes: IIStroke[]): IIShapePolygon\n  {\n    const height = convertMillimeterToPixel(rectangle.height)\n    const width = convertMillimeterToPixel(rectangle.width)\n    const x = convertMillimeterToPixel(rectangle.x)\n    const y = convertMillimeterToPixel(rectangle.y)\n    const points: TPoint[] = [\n      { x, y },\n      { x: x + width, y },\n      { x: x + width, y: y + height },\n      { x, y: y + height }\n    ]\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildPolygon(polygon: TJIIXNodePolygon, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildRhombus(polygon: TJIIXNodeRhombus, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildTriangle(polygon: TJIIXNodeTriangle, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildParallelogram(polygon: TJIIXNodeParrallelogram, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  convertNode(node: TJIIXNodeElement, strokes: IIStroke[]): { symbol: TIIShape, strokes: IIStroke[] } | undefined\n  {\n    const associatedStroke = strokes.filter(s => node.items?.some(i => i[\"full-id\"] === s.id))\n    if (!associatedStroke.length) return\n\n    const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n\n    let shape: TIIShape\n    switch (node.kind) {\n      case JIIXNodeKind.Circle:\n        shape = this.buildCircle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Ellipse:\n        shape = this.buildEllipse(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rectangle:\n        shape = this.buildRectangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Triangle:\n        shape = this.buildTriangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Parallelogram:\n        shape = this.buildParallelogram(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Polygon:\n        shape = this.buildPolygon(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rhombus:\n        shape = this.buildRhombus(node, uniqStrokes)\n        break\n      default:\n        this.#logger.warn(\"convertNode\", `Conversion of Node with kind equal to ${ JSON.stringify(node) } is unknow`)\n        return\n    }\n    return { symbol: shape, strokes: uniqStrokes }\n  }\n\n  buildLine(line: TJIIXEdgeLine, strokes: IIStroke[]): IIEdgeLine\n  {\n    const point1: TPoint = { x: convertMillimeterToPixel(line.x1), y: convertMillimeterToPixel(line.y1) }\n    const point2: TPoint = { x: convertMillimeterToPixel(line.x2), y: convertMillimeterToPixel(line.y2) }\n    const angle = computeAngleAxeRadian(point1, point2)\n\n    if (Math.abs(angle % Math.PI) < 0.1) {\n      // to adjust the line with the horizontal\n      point1.y = +((point1.y + point2.y) / 2).toFixed(3)\n      point2.y = point1.y\n    }\n    else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n      // to adjust the line with the vertical\n      point1.x = +((point1.x + point2.x) / 2).toFixed(3)\n      point2.x = point1.x\n    }\n    return new IIEdgeLine(point1, point2, line.p1Decoration, line.p2Decoration, strokes[0]?.style)\n  }\n\n  buildPolyEdge(polyline: TJIIXEdgePolyEdge, strokes: IIStroke[]): IIEdgePolyLine\n  {\n    const start: TPoint = { x: convertMillimeterToPixel(polyline.edges[0].x1), y: convertMillimeterToPixel(polyline.edges[0].y1) }\n    const points = polyline.edges.map(e => ({ x: convertMillimeterToPixel(e.x2), y: convertMillimeterToPixel(e.y2) }))\n    points.unshift(start)\n    for (let index = 0; index < points.length - 1; index++) {\n      const p1 = points[index]\n      const p2 = points[index + 1]\n      const angle = computeAngleAxeRadian(p1, p2)\n      if (Math.abs(angle % Math.PI) < 0.1) {\n        p1.y = +((p1.y + p2.y) / 2).toFixed(3)\n        p2.y = p1.y\n      }\n      else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n        p1.x = +((p1.x + p2.x) / 2).toFixed(3)\n        p2.x = p1.x\n      }\n    }\n\n    return new IIEdgePolyLine(points, polyline.edges[0].p1Decoration, polyline.edges.at(-1)!.p2Decoration, strokes[0]?.style)\n  }\n\n  buildArc(arc: TJIIXEdgeArc, strokes: IIStroke[]): IIEdgeArc\n  {\n    const center: TPoint = { x: convertMillimeterToPixel(arc.cx), y: convertMillimeterToPixel(arc.cy) }\n    const radiusX = convertMillimeterToPixel(arc.rx)\n    const radiusY = convertMillimeterToPixel(arc.ry)\n    return new IIEdgeArc(center, arc.startAngle, arc.sweepAngle, radiusX, radiusY, arc.phi, arc.startDecoration, arc.endDecoration, strokes[0]?.style)\n  }\n\n  convertEdge(edge: TJIIXEdgeElement, strokes: IIStroke[]): { symbol: TIIEdge, strokes: IIStroke[] } | undefined\n  {\n    switch (edge.kind) {\n      case JIIXEdgeKind.Line: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildLine(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.Arc: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildArc(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.PolyEdge: {\n        const associatedStroke = strokes.filter(s => edge.edges.flatMap(e => e.items)?.some(i => i![\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildPolyEdge(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      default:\n        this.#logger.error(\"convertEdge\", `Conversion of Edge with kind equal to ${ JSON.stringify(edge) } is unknow`)\n        return\n    }\n  }\n\n  async apply(symbols: TIISymbol[] = []): Promise<void>\n  {\n    this.#logger.info(\"convert\")\n    if (!this.model.exports?.[\"application/vnd.myscript.jiix\"]) {\n      await this.editor.export([\"application/vnd.myscript.jiix\"])\n    }\n    this.editor.selector.removeSelectedGroup()\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"] as TJIIXExport\n    if (jiix?.elements?.length) {\n      const strokesToConvert = this.editor.extractStrokesFromSymbols(symbols.length ? symbols : this.model.symbols)\n\n      const onlyText = !jiix.elements?.some(e => e.type !== \"Text\")\n      const conversionResults: { symbol: TIISymbol, strokes: IIStroke[] }[] = []\n      jiix.elements.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            const conversion = this.convertText(el, strokesToConvert, onlyText)\n            if (conversion) {\n              conversionResults.push(...conversion)\n            }\n            break\n          }\n          case \"Node\": {\n            const conversion = this.convertNode(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          case \"Edge\": {\n            const conversion = this.convertEdge(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"buildConversions\", `Unknow jiix element type: ${ el.type }`)\n          }\n        }\n      })\n\n      this.editor.addSymbols(conversionResults.map(cs => cs.symbol), false)\n      this.editor.removeSymbols(conversionResults.flatMap(cs => cs.strokes.map(s => s.id)), false)\n      this.editor.history.push(this.model, { added: conversionResults.map(c => c.symbol), erased: conversionResults.flatMap(cs => cs.strokes) })\n    }\n  }\n}\n","import { ResizeDirection, SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIStroke,\n  IISymbolGroup,\n  IIText,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint,\n  TIIRecognized,\n  RecognizedKind\n} from \"../symbol\"\n\n/**\n * @group Manager\n */\nexport class IIResizeManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n\n  interactElementsGroup?: SVGElement\n  direction!: ResizeDirection\n  boundingBox!: Box\n  transformOrigin!: TPoint\n  keepRatio = false\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, origin: TPoint, scaleX: number, scaleY: number): IIStroke\n  {\n    this.#logger.debug(\"applyToStroke\", { stroke, origin, scaleX, scaleY })\n    stroke.pointers.forEach(p =>\n    {\n      p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n      p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, origin: TPoint, scaleX: number, scaleY: number): TIIShape\n  {\n    this.#logger.debug(\"applyToShape\", { shape, origin, scaleX, scaleY })\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        const cosPhi = Math.cos(shape.orientation)\n        const sinPhi = Math.sin(shape.orientation)\n        shape.center.x = +(shape.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(shape.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (shape.center.y - origin.y)).toFixed(3)\n        shape.radiusX = +(Math.abs(shape.radiusX * (scaleX * cosPhi - scaleY * sinPhi))).toFixed(3)\n        shape.radiusY = +(Math.abs(shape.radiusY * (scaleX * sinPhi + scaleY * cosPhi))).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.radius = +(shape.radius * (scaleX + scaleY) / 2).toFixed(3)\n        shape.center.x = +(origin.x + scaleX * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(origin.y + scaleY * (shape.center.y - origin.y)).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply resize on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, origin: TPoint, scaleX: number, scaleY: number): TIIEdge\n  {\n    this.#logger.debug(\"applyToEdge\", { edge, origin, scaleX, scaleY })\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        const cosPhi = Math.cos(edge.phi)\n        const sinPhi = Math.sin(edge.phi)\n        edge.center.x = +(edge.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (edge.center.x - origin.x)).toFixed(3)\n        edge.center.y = +(edge.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (edge.center.y - origin.y)).toFixed(3)\n        edge.radiusX = +(edge.radiusX * Math.abs(scaleX * cosPhi + scaleY * sinPhi)).toFixed(3)\n        edge.radiusY = +(edge.radiusY * Math.abs(scaleX * sinPhi + scaleY * cosPhi)).toFixed(3)\n\n        if (scaleX < 0) {\n          edge.startAngle = +(Math.PI - edge.startAngle).toFixed(3)\n          edge.sweepAngle *= -1\n        }\n        else if (scaleY < 0) {\n          edge.sweepAngle *= -1\n        }\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x = +(origin.x + scaleX * (edge.start.x - origin.x)).toFixed(3)\n        edge.start.y = +(origin.y + scaleY * (edge.start.y - origin.y)).toFixed(3)\n        edge.end.x = +(origin.x + scaleX * (edge.end.x - origin.x)).toFixed(3)\n        edge.end.y = +(origin.y + scaleY * (edge.end.y - origin.y)).toFixed(3)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n          return p\n        })\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply resize on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n  }\n\n  protected applyOnText(text: IIText, origin: TPoint, scaleX: number, scaleY: number): IIText\n  {\n    text.point.x = +(origin.x + scaleX * (text.point.x - origin.x)).toFixed(3)\n    text.point.y = +(origin.y + scaleY * (text.point.y - origin.y)).toFixed(3)\n\n    text.chars.forEach(c =>\n    {\n      c.fontSize = +(c.fontSize * (scaleX + scaleY) / 2).toFixed(3)\n    })\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, origin: TPoint, scaleX: number, scaleY: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, origin, scaleX, scaleY))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(recognizedSymbol: TIIRecognized, origin: TPoint, scaleX: number, scaleY: number): TIIRecognized\n  {\n    recognizedSymbol.strokes.forEach(s => this.applyToStroke(s, origin, scaleX, scaleY))\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.xHeight *= scaleY\n    }\n    return recognizedSymbol\n  }\n\n  applyToSymbol(symbol: TIISymbol, origin: TPoint, scaleX: number, scaleY: number): TIISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, scaleX, scaleY })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, origin, scaleX, scaleY)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, origin, scaleX, scaleY)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, origin, scaleX, scaleY)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, origin, scaleX, scaleY)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, origin, scaleX, scaleY)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, origin, scaleX, scaleY)\n      default:\n        throw new Error(`Can't apply resize on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.editor.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  scaleElement(id: string, sx: number, sy: number): void\n  {\n    this.#logger.info(\"scaleElement\", { id, sx, sy })\n    this.editor.renderer.setAttribute(id, \"transform\", `scale(${ sx },${ sy })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.direction = target.getAttribute(\"resize-direction\") as ResizeDirection\n\n    this.keepRatio = this.model.symbolsSelected.some(s => s.type === SymbolType.Text || (s.type === SymbolType.Shape && (s as TIIShape).kind === ShapeKind.Circle))\n\n    this.transformOrigin = origin\n    this.boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n    this.setTransformOrigin(this.interactElementsGroup!.id, this.transformOrigin.x, this.transformOrigin.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.transformOrigin.x, this.transformOrigin.y)\n    })\n  }\n\n  continue(point: TPoint): { scaleX: number, scaleY: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't resize, you must call start before\")\n    }\n    const localPoint = point\n    const horizontalResize = [\n      ResizeDirection.East,\n      ResizeDirection.NorthEast,\n      ResizeDirection.SouthEast,\n      ResizeDirection.West,\n      ResizeDirection.NorthWest,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const verticalResize = [\n      ResizeDirection.North,\n      ResizeDirection.NorthEast,\n      ResizeDirection.NorthWest,\n      ResizeDirection.South,\n      ResizeDirection.SouthEast,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const { x, y } = this.editor.snaps.snapResize(point, horizontalResize, verticalResize)\n    localPoint.x = x\n    localPoint.y = y\n\n    let deltaX = 0, deltaY = 0\n    if ([ResizeDirection.East, ResizeDirection.NorthEast, ResizeDirection.SouthEast].includes(this.direction)) {\n      deltaX = localPoint.x - this.boundingBox.xMax\n    }\n    else if ([ResizeDirection.West, ResizeDirection.NorthWest, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaX = this.boundingBox.xMin - localPoint.x\n    }\n\n    if ([ResizeDirection.North, ResizeDirection.NorthEast, ResizeDirection.NorthWest].includes(this.direction)) {\n      deltaY = this.boundingBox.yMin - localPoint.y\n    }\n    else if ([ResizeDirection.South, ResizeDirection.SouthEast, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaY = localPoint.y - this.boundingBox.yMax\n    }\n\n    let scaleX = this.boundingBox.width ? 1 + (deltaX / this.boundingBox.width) : 1\n    let scaleY = this.boundingBox.height ? 1 + (deltaY / this.boundingBox.height) : 1\n\n    if (this.keepRatio) {\n      if ([ResizeDirection.North, ResizeDirection.South].includes(this.direction)) {\n        scaleX = scaleY\n      }\n      else if ([ResizeDirection.East, ResizeDirection.West].includes(this.direction)) {\n        scaleY = scaleX\n      }\n      else {\n        scaleX = Math.max(scaleX, scaleY)\n        scaleY = scaleX\n      }\n    }\n    this.scaleElement(this.interactElementsGroup.id, scaleX, scaleY)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.scaleElement(s.id, scaleX, scaleY)\n    })\n    return {\n      scaleX,\n      scaleY\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { scaleX, scaleY } = this.continue(point)\n    this.editor.snaps.clearSnapToElementLines()\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.transformOrigin, scaleX, scaleY)\n      this.editor.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n\n    const strokesFromSymbols = this.editor.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.editor.recognizer.transformScale(strokesFromSymbols.map(s => s.id), scaleX, scaleY, this.transformOrigin.x, this.transformOrigin.y)\n    this.editor.history.push(this.model, { scale: [{ symbols: oldSymbols, origin: {...this.transformOrigin}, scaleX, scaleY }] })\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIStroke,\n  IISymbolGroup,\n  IIText,\n  TIIRecognized,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint\n} from \"../symbol\"\nimport { computeAngleRadian, convertDegreeToRadian, convertRadianToDegree, computeRotatedPoint } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class IIRotationManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n  interactElementsGroup?: SVGElement\n  center!: TPoint\n  origin!: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, center: TPoint, angleRad: number): IIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      const { x, y } = computeRotatedPoint(p, center, angleRad)\n      p.x = x\n      p.y = y\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, center: TPoint, angleRad: number): TIIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        shape.orientation = (shape.orientation + angleRad) % (2 * Math.PI)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          const { x, y } = computeRotatedPoint(p, center, angleRad)\n          p.x = x\n          p.y = y\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply rotate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, center: TPoint, angleRad: number): TIIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.phi = (edge.phi - angleRad) % (2 * Math.PI)\n        edge.center = computeRotatedPoint(edge.center, center, angleRad)\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start = computeRotatedPoint(edge.start, center, angleRad)\n        edge.end = computeRotatedPoint(edge.end, center, angleRad)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points = edge.points.map(p => computeRotatedPoint(p, center, angleRad))\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply rotate on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n    return edge\n  }\n\n  protected applyOnText(text: IIText, center: TPoint, angleRad: number): IIText\n  {\n    text.rotation = {\n      degree: convertRadianToDegree(angleRad) + (text.rotation?.degree || 0),\n      center: center\n    }\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, center: TPoint, angleRad: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, center, angleRad))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(strokeText: TIIRecognized, center: TPoint, angleRad: number): TIIRecognized\n  {\n    strokeText.strokes.forEach(s => this.applyToStroke(s, center, angleRad))\n    return strokeText\n  }\n\n  applyToSymbol(symbol: TIISymbol, center: TPoint, angleRad: number): TIISymbol\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, center, angleRad)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, center, angleRad)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, center, angleRad)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, center, angleRad)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, center, angleRad)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, center, angleRad)\n      default:\n        throw new Error(`Can't apply rotate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.editor.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  rotateElement(id: string, degree: number): void\n  {\n    this.#logger.info(\"rotateElement\", { id, degree })\n    this.editor.renderer.setAttribute(id, \"transform\", `rotate(${ degree })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    const boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n\n    this.center = {\n      x: boundingBox.xMin + boundingBox.width / 2,\n      y: boundingBox.yMid\n    }\n    this.origin = origin\n    this.setTransformOrigin(this.interactElementsGroup.id, this.center.x, this.center.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.center.x, this.center.y)\n    })\n  }\n\n  continue(point: TPoint): number\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't rotate, you must call start before\")\n    }\n    let angleDegree = Math.round(convertRadianToDegree(computeAngleRadian(this.origin, this.center, point)))\n\n    angleDegree = this.editor.snaps.snapRotation(angleDegree)\n\n    if (point.x - this.center.x < 0) {\n      angleDegree = 360 - angleDegree\n    }\n\n    this.rotateElement(this.interactElementsGroup.id, angleDegree)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.rotateElement(s.id, angleDegree)\n    })\n    return angleDegree\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const angleDegree = this.continue(point)\n    const angleRad = convertDegreeToRadian(angleDegree) % (2 * Math.PI)\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.center, angleRad)\n      this.editor.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n    const strokesFromSymbols = this.editor.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.editor.recognizer.transformRotate(strokesFromSymbols.map(s => s.id), angleRad, this.center.x, this.center.y)\n    this.editor.history.push(this.model, { rotate: [{ symbols: oldSymbols, angle: angleRad, center: {...this.center}, }] })\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n}\n","import { ResizeDirection, SELECTION_MARGIN, SvgElementRole } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, IIText, SymbolType, TBox, TIIEdge, TIISymbol, TPoint } from \"../symbol\"\nimport { SVGRenderer, SVGBuilder } from \"../renderer\"\nimport { IIResizeManager } from \"./IIResizeManager\"\nimport { IIRotationManager } from \"./IIRotationManager\"\nimport { IITranslateManager } from \"./IITranslateManager\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\n\n/**\n * @group Manager\n */\nexport class IISelectionManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.SELECTION)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  #selectingId = \"selecting-rect\"\n  startSelectionPoint?: TPoint\n  endSelectionPoint?: TPoint\n  selectedGroup?: SVGGElement\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n    this.grabber.onContextMenu = this.onContextMenu.bind(this)\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get rotator(): IIRotationManager\n  {\n    return this.editor.rotator\n  }\n\n  get translator(): IITranslateManager\n  {\n    return this.editor.translator\n  }\n\n  get resizer(): IIResizeManager\n  {\n    return this.editor.resizer\n  }\n\n  get selectionBox(): Box | undefined\n  {\n    if (this.startSelectionPoint && this.endSelectionPoint) {\n      return Box.createFromPoints([this.startSelectionPoint, this.endSelectionPoint])\n    }\n    return\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.removeSelectedGroup()\n    this.grabber.attach(layer)\n  }\n\n  detach(): void\n  {\n    this.removeSelectedGroup()\n    this.grabber.detach()\n  }\n\n  drawSelectingRect(box: TBox): void\n  {\n    this.clearSelectingRect()\n    const attrs = {\n      id: this.#selectingId,\n      fill: \"transparent\",\n      stroke: \"grey\",\n      opacity: \"0.25\",\n    }\n    this.renderer.appendElement(SVGBuilder.createRect(box, attrs))\n  }\n\n  clearSelectingRect(): void\n  {\n    this.renderer.clearElements({ attrs: { id: this.#selectingId } })\n  }\n\n  protected getPoint(ev: PointerEvent): TPoint\n  {\n    const { clientLeft, scrollLeft, clientTop, scrollTop } = this.renderer.parent\n    const rect: DOMRect = this.renderer.parent.getBoundingClientRect()\n    return {\n      x: ev.clientX - rect.left - clientLeft + scrollLeft,\n      y: ev.clientY - rect.top - clientTop + scrollTop,\n    }\n  }\n\n  protected createTranslateRect(box: TBox): SVGRectElement\n  {\n    const attrs = {\n      role: SvgElementRole.Translate,\n      style: \"cursor:move\",\n      fill: \"transparent\",\n      stroke: \"transparent\",\n    }\n    const boxWithMarge: TBox = {\n      height: box.height,\n      width: box.width,\n      x: box.x,\n      y: box.y\n    }\n    const translateEl = SVGBuilder.createRect(boxWithMarge, attrs)\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      this.renderer.layer.style.cursor = \"\"\n      this.resetSelectedGroup(this.model.symbolsSelected)\n    }\n\n    translateEl.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.hideInteractElements()\n      this.translator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n\n      this.renderer.layer.style.cursor = \"move\"\n    })\n    return translateEl\n  }\n\n  protected createRotateGroup(box: TBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Rotate,\n      \"vector-effect\": \"non-scaling-size\",\n      \"style\": \"cursor:pointer;\",\n      \"opacity\": \"1\",\n    })\n    const radius = 8\n    const center: TPoint = {\n      x: (box.x + box.width / 2),\n      y: box.y - 4 * SELECTION_MARGIN\n    }\n    const attrs1 = {\n      role: SvgElementRole.Rotate,\n      \"stroke-width\": \"2\",\n      \"stroke\": \"black\",\n      fill: \"white\",\n    }\n    group.appendChild(SVGBuilder.createCircle(center, radius, attrs1))\n\n    const attrs2 = {\n      role: SvgElementRole.Rotate,\n      fill: \"black\",\n    }\n\n    group.appendChild(SVGBuilder.createCircle(center, radius / 2, attrs2))\n    const attrs3 = {\n      role: SvgElementRole.Rotate,\n      stroke: \"black\",\n      \"stroke-width\": \"2\"\n    }\n    group.appendChild(SVGBuilder.createLine({ x: center.x, y: center.y + radius }, { x: center.x, y: box.y - SELECTION_MARGIN }, attrs3))\n\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      this.resetSelectedGroup(this.model.symbolsSelected)\n    }\n\n    group.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.hideInteractElements()\n      this.rotator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n    })\n    return group\n  }\n\n  protected createResizeGroup(box: TBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n    const P_NW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_NE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_SE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n    const P_SW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n\n    const bindEl = (el: SVGElement, transformOrigin: TPoint, cursor: string) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.continue(this.getPoint(ev))\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.end(this.getPoint(ev))\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n\n        this.renderer.layer.style.cursor = \"\"\n        this.resetSelectedGroup(this.model.symbolsSelected)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.hideInteractElements()\n        this.renderer.layer.style.cursor = cursor\n        this.resizer.start(ev.target as Element, transformOrigin)\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n\n    const sideResizeDefs = [\n      { direction: ResizeDirection.North, p1: P_NW, p2: P_NE, transformOrigin: { x: box.x + box.width / 2, y: box.y + box.height } },\n      { direction: ResizeDirection.East, p1: P_NE, p2: P_SE, transformOrigin: { x: box.x, y: box.y + box.height / 2 } },\n      { direction: ResizeDirection.South, p1: P_SW, p2: P_SE, transformOrigin: { x: box.x + box.width / 2, y: box.y } },\n      { direction: ResizeDirection.West, p1: P_NW, p2: P_SW, transformOrigin: { x: box.x + box.width, y: box.y + box.height / 2 } },\n    ]\n    sideResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        style: `cursor:${ def.direction };`\n      }\n      const lineResize = SVGBuilder.createLine(def.p1, def.p2, attrs)\n      bindEl(lineResize, def.transformOrigin, def.direction)\n      group.appendChild(lineResize)\n    })\n    const cornerResizeDefs = [\n      { direction: ResizeDirection.NorthWest, p: P_NW, transformOrigin: { x: box.x + box.width, y: box.y + box.height } },\n      { direction: ResizeDirection.NorthEast, p: P_NE, transformOrigin: { x: box.x, y: box.y + box.height } },\n      { direction: ResizeDirection.SouthEast, p: P_SE, transformOrigin: { x: box.x, y: box.y } },\n      { direction: ResizeDirection.SouthWest, p: P_SW, transformOrigin: { x: box.x + box.width, y: box.y } },\n    ]\n    cornerResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        \"stroke-width\": \"4\",\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        transform: \"scale(1, 1)\",\n        fill: \"white\",\n        style: `cursor:${ def.direction };`\n      }\n      const cornerResize = SVGBuilder.createCircle(def.p, 5, attrs)\n      bindEl(cornerResize, def.transformOrigin, def.direction)\n      group.appendChild(cornerResize)\n    })\n    return group\n  }\n\n  protected createInteractElementsGroup(symbols: TIISymbol[]): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractElementsGroup\", { symbols })\n\n    if (!symbols.length) return\n\n    const symbolElementMap = symbols.map(s =>\n    {\n      return {\n        symbol: s,\n        element: this.renderer.getElementById(s.id),\n      }\n    })\n\n    const box1 = Box.createFromBoxes(symbols.map(s =>\n    {\n      return {\n        x: s.bounds.x - (s.style.width || 1),\n        y: s.bounds.y - (s.style.width || 1),\n        height: s.bounds.height + (s.style.width || 1) * 2,\n        width: s.bounds.width + (s.style.width || 1) * 2,\n      }\n    }))\n\n    const box2 = Box.createFromPoints(symbols.flatMap(s => s.vertices))\n    const box = Box.createFromBoxes([box1, box2])\n\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(box))\n    surroundGroup.appendChild(this.createResizeGroup(box))\n    surroundGroup.appendChild(this.createRotateGroup(box))\n    const SURROUND_ATTRS = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"#3e68ff\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"4\",\n      \"vector-effect\": \"non-scaling-size\",\n      transform: \"rotate(0, 0, 0)\"\n    }\n    symbolElementMap.forEach(s =>\n    {\n      if (s.element) {\n        const bounds: TBox = {\n          x: s.symbol.bounds.x - (s.symbol.style.width || 1),\n          y: s.symbol.bounds.y - (s.symbol.style.width || 1),\n          height: s.symbol.bounds.height + (s.symbol.style.width || 1) * 2,\n          width: s.symbol.bounds.width + (s.symbol.style.width || 1) * 2,\n        }\n        if (s.symbol.type === SymbolType.Text) {\n          const t = s.symbol as IIText\n          SURROUND_ATTRS.transform = `rotate(${ t.rotation?.degree || 0 }, ${ t.rotation?.center.x || 0 }, ${ t.rotation?.center.y || 0 })`\n        }\n        else {\n          SURROUND_ATTRS.transform = \"rotate(0, 0, 0)\"\n        }\n        surroundGroup.prepend(SVGBuilder.createRect(bounds, SURROUND_ATTRS))\n      }\n    })\n    return surroundGroup\n  }\n\n  protected createEdgeResizeGroup(edge: TIIEdge): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n\n    const radius = 5\n    const attrs = {\n      role: SvgElementRole.Resize,\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n      fill: \"white\",\n      style: `cursor:grab;`\n    }\n    const bindEl = (el: SVGCircleElement, pointIndex: number) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        const point = this.getPoint(ev)\n        const { x, y } = this.editor.snaps.snapResize(point)\n        edge.vertices[pointIndex].x = x\n        edge.vertices[pointIndex].y = y\n        this.model.updateSymbol(edge)\n        this.renderer.drawSymbol(edge)\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        const point = this.getPoint(ev)\n        const { x, y } = this.editor.snaps.snapResize(point)\n        edge.vertices[pointIndex].x = x\n        edge.vertices[pointIndex].y = y\n        this.renderer.layer.style.cursor = \"\"\n        this.editor.updateSymbol(edge)\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n        this.editor.snaps.clearSnapToElementLines()\n        this.resetSelectedGroup(this.model.symbolsSelected)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        this.renderer.layer.style.cursor = \"grabbing\"\n        this.hideInteractElements()\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n    edge.vertices.forEach((p, i) =>\n    {\n      const pointEl = SVGBuilder.createCircle(p, radius, attrs)\n      bindEl(pointEl, i)\n      group.appendChild(pointEl)\n    })\n\n    return group\n  }\n\n  protected createInteractEdgeGroup(edge: TIIEdge): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractEdgeGroup\", { edge })\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(edge.bounds))\n    surroundGroup.appendChild(this.createEdgeResizeGroup(edge.clone()))\n    return surroundGroup\n  }\n\n  drawSelectedGroup(symbols: TIISymbol[]): void\n  {\n    if (!symbols.length) return\n    if (symbols.length === 1 && symbols[0].type === SymbolType.Edge) {\n      this.selectedGroup = this.createInteractEdgeGroup(symbols[0] as TIIEdge)\n    }\n    else {\n      this.selectedGroup = this.createInteractElementsGroup(symbols)\n    }\n    if (this.selectedGroup) {\n      this.renderer.layer.appendChild(this.selectedGroup)\n      const groupBox = this.selectedGroup.getBBox()\n      this.editor.menu.context.position.x = groupBox.x + groupBox.width / 2 - this.renderer.parent.clientLeft\n      this.editor.menu.context.position.y = groupBox.y + groupBox.height - this.renderer.parent.clientTop\n      this.editor.menu.context.show()\n    }\n    this.editor.menu.update()\n  }\n\n  resetSelectedGroup(symbols: TIISymbol[]): void\n  {\n    this.#logger.info(\"resetSelectedGroup\", { symbols })\n    this.removeSelectedGroup()\n    this.drawSelectedGroup(symbols)\n  }\n\n  removeSelectedGroup(): void\n  {\n    this.#logger.info(\"removeSelectedGroup\")\n    this.editor.menu.context.hide()\n    this.selectedGroup?.remove()\n    this.selectedGroup = undefined\n  }\n\n  hideInteractElements(): void\n  {\n    this.editor.menu.context.hide()\n    const query = `[role=${ SvgElementRole.Resize }],[role=${ SvgElementRole.Rotate }],[role=${ SvgElementRole.Translate }]`\n    this.selectedGroup?.querySelectorAll(query)\n      .forEach(el =>\n      {\n        el.setAttribute(\"visibility\", \"hidden\")\n      })\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.removeSelectedGroup()\n    this.startSelectionPoint = info.pointer\n    this.endSelectionPoint = info.pointer\n    this.drawSelectingRect(this.selectionBox!)\n  }\n\n  continue(info: PointerInfo): TIISymbol[]\n  {\n    if (!this.startSelectionPoint) {\n      throw new Error(\"You need to call startSelectionByBox before\")\n    }\n    this.endSelectionPoint = info.pointer\n    const updatedSymbols: TIISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (s.selected !== s.overlaps(this.selectionBox!)) {\n        s.selected = s.overlaps(this.selectionBox!)\n        updatedSymbols.push(s)\n        this.renderer.drawSymbol(s)\n      }\n    })\n    this.drawSelectingRect(this.selectionBox!)\n    return updatedSymbols\n  }\n\n  end(info: PointerInfo): TIISymbol[]\n  {\n    const updatedSymbols = this.continue(info)\n    this.startSelectionPoint = undefined\n    this.endSelectionPoint = undefined\n    this.clearSelectingRect()\n    this.drawSelectedGroup(this.model.symbolsSelected)\n    this.editor.event.emitSelected(this.model.symbolsSelected)\n    this.editor.menu.style.update()\n    return updatedSymbols\n  }\n\n  protected async onContextMenu(info: PointerInfo): Promise<void>\n  {\n    let found = false\n    let currentEl = info.target as HTMLElement | null\n    const symbolTypesAllowed = [SymbolType.Edge.toString(), SymbolType.Shape.toString(), SymbolType.Stroke.toString(), SymbolType.Text.toString()]\n    while (currentEl && currentEl.tagName !== \"svg\" && !found) {\n      if (symbolTypesAllowed.includes(currentEl.getAttribute(\"type\") as string)) {\n        found = true\n      }\n      else {\n        currentEl = currentEl.parentElement\n      }\n    }\n    this.editor.unselectAll()\n    if (currentEl?.id) {\n      this.model.selectSymbol(currentEl.id)\n      this.renderer.drawSymbol(this.model.symbolsSelected[0])\n      this.drawSelectedGroup(this.model.symbolsSelected)\n      this.editor.updateLayerUI()\n    }\n    else {\n      this.editor.menu.context.position.x = info.pointer.x + this.renderer.parent.clientLeft\n      this.editor.menu.context.position.y = info.pointer.y + this.renderer.parent.clientTop\n      this.editor.menu.context.show()\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, IIText, SymbolType, TIISymbol, TIISymbolChar } from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\n\n/**\n * @group Manager\n */\nexport class IITextManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected drawSymbolHidden(text: IIText): SVGGElement\n  {\n    const clone = text.clone()\n    clone.id = \"text-to-measure\"\n    clone.chars.forEach(c => c.id += \"-to-measure\")\n    clone.decorators = []\n    this.renderer.layer.querySelector(`#${ clone.id }`)?.remove()\n    const el = this.renderer.buildElementFromSymbol(clone)!\n    el.setAttribute(\"visibility\", \"hidden\")\n    this.renderer.prependElement(el)\n    return el\n  }\n\n  setCharsBounds(text: IIText, textGroupEl: SVGGElement): IIText\n  {\n    const textEl = textGroupEl.querySelector(\"text\")\n    if (textEl) {\n      for (let i = 0; i < textEl.getNumberOfChars(); i++) {\n        const char = text.chars.at(i)\n        if (char) {\n          const ext = textEl.getExtentOfChar(i)\n          char.bounds = new Box(ext)\n        }\n      }\n    }\n    return text\n  }\n\n  setBounds(text: IIText): void\n  {\n    const element = this.drawSymbolHidden(text)\n    text.bounds = this.getElementBoundingBox(element)\n    this.setCharsBounds(text, element)\n  }\n\n  getElementBoundingBox(textElement: SVGElement): Box\n  {\n    return new Box(textElement.querySelector(\"text\")!.getBBox({ stroke: true, markers: true, clipped: true, fill: true }))\n  }\n\n  getBoundingBox(text: IIText): Box\n  {\n    const element = this.drawSymbolHidden(text)\n    return this.getElementBoundingBox(element)\n  }\n\n  getSpaceWidth(fontSize: number): number\n  {\n    const boundingBox = new Box({ height: 0, width: 0, x: 0, y: 0 })\n    const charSymbol: TIISymbolChar = {\n      id: `text-char-space`,\n      label: \"-\",\n      color: \"\",\n      fontSize,\n      fontWeight: \"normal\",\n      bounds: boundingBox\n    }\n    return this.getBoundingBox(new IIText([charSymbol], { x: 0, y: 0 }, boundingBox))?.width as number\n  }\n\n  updateBounds(textSymbol: IIText): IIText\n  {\n    this.setBounds(textSymbol)\n    this.model.updateSymbol(textSymbol)\n    return textSymbol\n  }\n\n  moveTextAfter(text: IIText, tx: number): TIISymbol[] | undefined\n  {\n    const row = this.model.getSymbolsByRowOrdered().find(r => r.rowIndex === this.model.getSymbolRowIndex(text))\n    if (row) {\n      const textsAfter = row.symbols.filter(s => s.type === SymbolType.Text && s.bounds.xMid > text.bounds.xMid) as IIText[]\n      textsAfter.forEach(symbol => {\n        symbol.point.x += tx\n        this.updateBounds(symbol)\n        this.model.updateSymbol(symbol)\n        this.renderer.drawSymbol(symbol)\n      })\n      return textsAfter\n    }\n    return\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  EdgeKind,\n  IIStroke,\n  IIText,\n  IISymbolGroup,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint,\n  TIIRecognized,\n  RecognizedKind\n} from \"../symbol\"\n\n/**\n * @group Manager\n */\nexport class IITranslateManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n  interactElementsGroup?: SVGElement\n  transformOrigin!: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, tx: number, ty: number): IIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      p.x += tx\n      p.y += ty\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, tx: number, ty: number): TIIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse:\n      case ShapeKind.Circle: {\n        shape.center.x += tx\n        shape.center.y += ty\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply translate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, tx: number, ty: number): TIIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.center.x += tx\n        edge.center.y += ty\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x += tx\n        edge.start.y += ty\n        edge.end.x += tx\n        edge.end.y += ty\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return edge\n      }\n    }\n\n    return edge\n  }\n\n  protected applyOnText(text: IIText, tx: number, ty: number): IIText\n  {\n    if (text.rotation) {\n      text.rotation.center = { x: text.rotation.center.x + tx, y: text.rotation.center.y + ty }\n    }\n    text.point.x += tx\n    text.point.y += ty\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, tx: number, ty: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, tx, ty))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(recognizedSymbol: TIIRecognized, tx: number, ty: number): TIIRecognized\n  {\n    recognizedSymbol.strokes.forEach(s => this.applyToStroke(s, tx, ty))\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.baseline += ty\n    }\n    return recognizedSymbol\n  }\n\n  applyToSymbol(symbol: TIISymbol, tx: number, ty: number): TIISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, tx, ty })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, tx, ty)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, tx, ty)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, tx, ty)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, tx, ty)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, tx, ty)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, tx, ty)\n      default:\n        throw new Error(`Can't apply translate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  translate(symbols: TIISymbol[], tx: number, ty: number, addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"translate\", { symbols, tx, ty })\n    symbols.forEach(s =>\n    {\n      this.applyToSymbol(s, tx, ty)\n      this.model.updateSymbol(s)\n      this.editor.renderer.drawSymbol(s)\n    })\n    if (addToHistory) {\n      this.editor.history.push(this.model, { translate: [{ symbols: this.model.symbolsSelected, tx, ty }] })\n    }\n    const strokes = this.editor.extractStrokesFromSymbols(symbols)\n    return this.editor.recognizer.transformTranslate(strokes.map(s => s.id), tx, ty)\n  }\n\n  translateElement(id: string, tx: number, ty: number): void\n  {\n    this.#logger.info(\"translateElement\", { id, tx, ty })\n    this.editor.renderer.setAttribute(id, \"transform\", `translate(${ tx },${ ty })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { origin })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.transformOrigin = origin\n  }\n\n  continue(point: TPoint): { tx: number, ty: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't translate, you must call start before\")\n    }\n\n    let tx = point.x - this.transformOrigin.x\n    let ty = point.y - this.transformOrigin.y\n\n    const nudge = this.editor.snaps.snapTranslate(tx, ty)\n    tx = nudge.x\n    ty = nudge.y\n\n    this.translateElement(this.interactElementsGroup.id as string, tx, ty)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.translateElement(s.id as string, tx, ty)\n    })\n    return {\n      tx,\n      ty\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { tx, ty } = this.continue(point)\n    this.editor.snaps.clearSnapToElementLines()\n    this.translate(this.model.symbolsSelected, tx, ty)\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n\n}\n","import { SELECTION_MARGIN, EditorWriteTool } from \"../Constants\"\nimport { TGesture } from \"../gesture\"\nimport { IIModel } from \"../model\"\nimport\n{\n  EdgeDecoration,\n  EdgeKind,\n  IIEdgeLine,\n  IIShapePolygon,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIStroke,\n  SymbolType,\n  TIIEdge,\n  TIISymbol,\n  TPoint,\n  TPointer\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { SVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { IIHistoryManager } from \"../history\"\nimport { IIGestureManager } from \"../gesture/IIGestureManager\"\nimport { IISnapManager } from \"../snap/IISnapManager\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerInfo } from \"../grabber\"\nimport { AbstractWriterManager } from \"./AbstractWriterManager\"\n\n\n/**\n * @group Manager\n */\nexport class IIWriterManager extends AbstractWriterManager\n{\n  #tool: EditorWriteTool = EditorWriteTool.Pencil\n  detectGesture: boolean = true\n  editor: InteractiveInkEditor\n  currentSymbolOrigin?: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    super(editor)\n    this.editor = editor\n  }\n\n  get tool(): EditorWriteTool\n  {\n    return this.#tool\n  }\n  set tool(wt: EditorWriteTool)\n  {\n    this.#tool = wt\n    if (wt !== EditorWriteTool.Pencil) {\n      this.editor.layers.root.classList.add(\"shape\")\n    }\n    else {\n      this.editor.layers.root.classList.remove(\"shape\")\n    }\n    this.editor.unselectAll()\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get history(): IIHistoryManager\n  {\n    return this.editor.history\n  }\n\n  get gestureManager(): IIGestureManager\n  {\n    return this.editor.gesture\n  }\n\n  get snaps(): IISnapManager\n  {\n    return this.editor.snaps\n  }\n\n  get recognizer(): RecognizerWebSocket\n  {\n    return this.editor.recognizer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  protected needContextLessGesture(stroke: IIStroke): boolean\n  {\n    const strokeBoundsWithMargin = this.editor.getSymbolsBounds([stroke], 2 * SELECTION_MARGIN)\n    return this.detectGesture && this.model.symbols.some(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Recognized:\n        case SymbolType.Stroke:\n          return false\n        case SymbolType.Group:\n          if (s.containsOnlyStroke()) {\n            return false\n          }\n          else {\n            return s.bounds.overlaps(strokeBoundsWithMargin)\n          }\n        default:\n          return s.bounds.overlaps(strokeBoundsWithMargin)\n      }\n    })\n  }\n\n  protected createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol\n  {\n    switch (this.tool) {\n      case EditorWriteTool.Pencil:\n        this.model.currentSymbol = new IIStroke(style, pointerType)\n        break\n      case EditorWriteTool.Rectangle:\n        this.model.currentSymbol = IIShapePolygon.createRectangleBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Triangle:\n        this.model.currentSymbol = IIShapePolygon.createTriangleBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Parallelogram:\n        this.model.currentSymbol = IIShapePolygon.createParallelogramBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Rhombus:\n        this.model.currentSymbol = IIShapePolygon.createRhombusBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Circle:\n        this.model.currentSymbol = IIShapeCircle.createBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Ellipse:\n        this.model.currentSymbol = IIShapeEllipse.createBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Line:\n      case EditorWriteTool.Arrow:\n      case EditorWriteTool.DoubleArrow: {\n        let startDecoration, endDecoration\n        if (this.tool === EditorWriteTool.Arrow) {\n          endDecoration = EdgeDecoration.Arrow\n        }\n        else if (this.tool === EditorWriteTool.DoubleArrow) {\n          startDecoration = EdgeDecoration.Arrow\n          endDecoration = EdgeDecoration.Arrow\n        }\n        this.model.currentSymbol = new IIEdgeLine(pointer, pointer, startDecoration, endDecoration, style)\n        break\n      }\n      default:\n        throw new Error(`Can't create symbol, tool is unknow: \"${ this.tool }\"`)\n    }\n    return this.updateCurrentSymbol(pointer)\n  }\n\n  protected updateCurrentSymbolShape(pointer: TPointer): void\n  {\n    switch (this.tool) {\n      case EditorWriteTool.Rectangle:\n        IIShapePolygon.updateRectangleBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Triangle:\n        IIShapePolygon.updateTriangleBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Parallelogram:\n        IIShapePolygon.updateParallelogramBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Rhombus:\n        IIShapePolygon.updateRhombusBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Circle:\n        IIShapeCircle.updateBetweenPoints(this.model.currentSymbol as IIShapeCircle, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Ellipse:\n        IIShapeEllipse.updateBetweenPoints(this.model.currentSymbol as IIShapeEllipse, this.currentSymbolOrigin!, pointer)\n        break\n    }\n  }\n\n  protected updateCurrentSymbolEdge(pointer: TPointer): void\n  {\n    const edge = this.model.currentSymbol as TIIEdge\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        edge.end = pointer\n        break\n    }\n  }\n\n  protected updateCurrentSymbol(pointer: TPointer): TIISymbol\n  {\n    if (!this.model.currentSymbol) {\n      throw new Error(\"Can't update current symbol because currentSymbol is undefined\")\n    }\n\n    switch (this.model.currentSymbol.type) {\n      case SymbolType.Stroke:\n        this.model.currentSymbol!.addPointer(pointer)\n        break\n      case SymbolType.Shape:\n        this.updateCurrentSymbolShape(pointer)\n        break\n      case SymbolType.Edge:\n        this.updateCurrentSymbolEdge(pointer)\n        break\n    }\n    return this.model.currentSymbol\n  }\n\n  start(info: PointerInfo): void\n  {\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.currentSymbolOrigin = localPointer\n    this.createCurrentSymbol(localPointer, this.editor.penStyle, info.pointerType)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.updateCurrentSymbol(localPointer)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  protected async interactWithBackend(stroke: IIStroke): Promise<void>\n  {\n    const localStroke = stroke.clone()\n    let gestureFromContextLess: TGesture | undefined\n    if (this.needContextLessGesture(stroke)) {\n      gestureFromContextLess = await this.gestureManager.getGestureFromContextLess(localStroke)\n    }\n    if (gestureFromContextLess) {\n      this.history.pop()\n      this.recognizer.addStrokes([localStroke], this.detectGesture)\n      await this.gestureManager.apply(localStroke, gestureFromContextLess)\n    }\n    else {\n      const gesture = await this.recognizer.addStrokes([localStroke], this.detectGesture)\n      if (gesture) {\n        this.history.pop()\n        await this.gestureManager.apply(localStroke, gesture)\n      }\n    }\n  }\n\n  async end(info: PointerInfo): Promise<void>\n  {\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    const localSymbol = this.updateCurrentSymbol(localPointer)\n    this.model.currentSymbol = undefined\n    this.currentSymbolOrigin = undefined\n    this.snaps.clearSnapToElementLines()\n\n    this.renderer.drawSymbol(localSymbol!)\n    this.model.addSymbol(localSymbol)\n    this.history.push(this.model, { added: [localSymbol] })\n\n    if (localSymbol.type === SymbolType.Stroke) {\n      await this.interactWithBackend(localSymbol)\n    }\n  }\n}\n","import { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IIModel, JIIXEdgeKind } from \"../model\"\nimport { Box, IIText, SymbolType, TBox, TIISymbol } from \"../symbol\"\nimport { SVGRenderer, SVGRendererConst, SVGBuilder } from \"../renderer\"\nimport { convertBoundingBoxMillimeterToPixel, createUUID } from \"../utils\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\n\n/**\n * @group Manager\n */\nexport class IIDebugSVGManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.SVGDEBUG)\n  #snapPointsVisibility = false\n  #verticesVisibility = false\n  #boundingBoxVisibility = false\n  #recognitionBoxVisibility = false\n  #recognitionItemBoxVisibility = false\n\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get snapPointsVisibility(): boolean\n  {\n    return this.#snapPointsVisibility\n  }\n  set snapPointsVisibility(show: boolean)\n  {\n    this.#snapPointsVisibility = show\n    this.debugSnapPoints()\n  }\n\n  get verticesVisibility(): boolean\n  {\n    return this.#verticesVisibility\n  }\n  set verticesVisibility(show: boolean)\n  {\n    this.#verticesVisibility = show\n    this.debugVertices()\n  }\n\n  get boundingBoxVisibility(): boolean\n  {\n    return this.#boundingBoxVisibility\n  }\n  set boundingBoxVisibility(show: boolean)\n  {\n    this.#boundingBoxVisibility = show\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    this.#boundingBoxVisibility ? this.showBoundingBox() : this.hideBoundingBox()\n  }\n\n  get recognitionBoxVisibility(): boolean\n  {\n    return this.#recognitionBoxVisibility\n  }\n  set recognitionBoxVisibility(show: boolean)\n  {\n    this.#recognitionBoxVisibility = show\n    this.debugRecognitionBox()\n  }\n\n  get recognitionItemBoxVisibility(): boolean\n  {\n    return this.#recognitionItemBoxVisibility\n  }\n  set recognitionItemBoxVisibility(show: boolean)\n  {\n    this.#recognitionItemBoxVisibility = show\n    this.debugRecognitionItemBox()\n  }\n\n  protected showSnapPoints(): void\n  {\n    this.#logger.info(\"showSnapPoints\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" }))\n    }\n    this.model.symbols.forEach(s => s.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" })))\n  }\n  protected hideSnapPoints(): void\n  {\n    this.#logger.info(\"hideSnapPoints\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"snap-points\" } })\n  }\n  debugSnapPoints(): void\n  {\n    this.hideSnapPoints()\n    if (this.snapPointsVisibility) {\n      this.showSnapPoints()\n    }\n  }\n\n  protected showVertices(): void\n  {\n    this.#logger.info(\"showVertices\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" }))\n    }\n    this.model.symbols.forEach(s => s.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" })))\n  }\n  protected hideVertices(): void\n  {\n    this.#logger.info(\"hideVertices\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"vertices\" } })\n  }\n  debugVertices(): void\n  {\n    this.hideVertices()\n    if (this.verticesVisibility) {\n      this.showVertices()\n    }\n  }\n\n  protected drawBoundingBox(symbols: TIISymbol[]): void\n  {\n    const symbolAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"red\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"5 5\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    const charAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"orange\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"0 5 0\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    symbols.forEach(s =>\n    {\n      const symEl = this.renderer.getElementById(s.id)\n      if (symEl) {\n        if (s.type === SymbolType.Text) {\n          const text = s as IIText\n          let transform: string = \"\"\n          if (text.rotation) {\n            transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n          }\n          text.chars.forEach(c =>\n          {\n            const ca = {\n              ...charAttrs,\n              char: c.label,\n              transform\n            }\n            symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(c.bounds, ca))\n          })\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n            transform\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n        else {\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n      }\n    })\n  }\n  protected showBoundingBox(): void\n  {\n    this.#logger.info(\"showBoundingBox\")\n    if (this.model.currentSymbol) {\n      this.drawBoundingBox([this.model.currentSymbol])\n    }\n    this.drawBoundingBox(this.model.symbols)\n  }\n  protected hideBoundingBox(): void\n  {\n    this.#logger.info(\"hideBoundingBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"bounding-box\" } })\n  }\n  debugBoundingBox(): void\n  {\n    this.hideBoundingBox()\n    if (this.boundingBoxVisibility) {\n      this.showBoundingBox()\n    }\n  }\n\n  protected drawRecognitionBox(box: TBox, infos?: string[]): void\n  {\n    const COLOR = \"green\"\n    const TEXT_HEIGHT = 20\n    const recognitionGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-box\" })\n\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: SVGRendererConst.noSelection })\n    recognitionGroup.appendChild(rect)\n\n    const infosGroup = SVGBuilder.createGroup({ id: `infos-group-${ createUUID() }` })\n    const infoX = box.x + box.width\n    let infoY = box.y + TEXT_HEIGHT / 2\n    infos?.forEach(w =>\n    {\n      infosGroup.appendChild(SVGBuilder.createText({ x: infoX, y: infoY }, w, { stroke: COLOR, style: SVGRendererConst.noSelection }))\n      infoY += TEXT_HEIGHT\n    })\n    recognitionGroup.appendChild(infosGroup)\n    this.renderer.layer.appendChild(recognitionGroup)\n\n    const infosGroupBox = infosGroup.getBBox()\n    const rectBox = {\n      width: infosGroupBox.width + 10,\n      height: infosGroupBox.height + 10,\n      x: infosGroupBox.x - 5,\n      y: infosGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    infosGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(infosGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(infosGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(infosGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ infosGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ infosGroup.id }`, box, newRectBox, \"corners\", { stroke: COLOR, debug: \"recognition-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(infosGroup.id, \"originX\")) {\n        this.renderer.setAttribute(infosGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(infosGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n      this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    })\n  }\n\n  protected async showRecognitionBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBox\")\n    await this.editor.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBox\", { jiix })\n    if (jiix) {\n      if (!jiix[\"bounding-box\"]) {\n        this.#logger.warn(\"drawRecognitionBox\", \"You must to enabled configuration.recognition.exports[\\\"bounding-box\\\"]\")\n        return\n      }\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Node\": {\n            if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          case \"Text\": {\n            el.words?.forEach(w =>\n            {\n              if (w?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(w[\"bounding-box\"])\n                this.drawRecognitionBox(box, [`type: ${ el.type }`, `candidates: ${ JSON.stringify(w.candidates || []) }`])\n              }\n            })\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              const infos = [\n                `type: ${ el.type }`,\n                `kind: ${ el.kind }`,\n              ]\n              el.edges.forEach((e, i) =>\n              {\n                let inf = `edge-${ i }: [{ x1: ${ e.x1 }, y2: ${ e.y1 } },{ x2: ${ e.x2 }, y2: ${ e.y2 } }]`\n                if (e.p1Decoration) {\n                  inf += `, p1Decoration: ${ e.p1Decoration }`\n                }\n                if (e.p2Decoration) {\n                  inf += `, p2Decoration: ${ e.p2Decoration }`\n                }\n                infos.push(inf)\n              })\n              const box = convertBoundingBoxMillimeterToPixel(Box.createFromBoxes(el.edges.map(e => e[\"bounding-box\"] as TBox)))\n              this.drawRecognitionBox(box, infos)\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\", \"ports\", \"connected\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${ el.type }`)\n            break\n          }\n        }\n      })\n    }\n  }\n  protected clearRecognitionBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box-link\" } })\n  }\n  async debugRecognitionBox(): Promise<void>\n  {\n    this.clearRecognitionBox()\n    if (this.#recognitionBoxVisibility) {\n      this.showRecognitionBox()\n    }\n  }\n\n  protected drawRecognitionItemBox(box: TBox, label?: string, chars?: string[]): void\n  {\n    const COLOR = \"blue\"\n    const CHAR_SIZE = 14\n\n    const recognitionItemGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-item-box\" })\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: SVGRendererConst.noSelection })\n    recognitionItemGroup.appendChild(rect)\n\n    const charX = box.x\n    let charY = box.y - CHAR_SIZE\n\n    const charsGroup = SVGBuilder.createGroup({ id: `chars-group-${ createUUID() }` })\n    if (label) {\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `label: ${ label }`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: SVGRendererConst.noSelection }))\n    }\n    if (chars?.length) {\n      charY += CHAR_SIZE\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `[${ chars.join(\", \") }]`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: SVGRendererConst.noSelection }))\n    }\n\n    recognitionItemGroup.appendChild(charsGroup)\n    this.renderer.layer.appendChild(recognitionItemGroup)\n\n    const charsGroupBox = charsGroup.getBBox()\n    const rectBox = {\n      width: charsGroupBox.width + 10,\n      height: charsGroupBox.height + 10,\n      x: charsGroupBox.x - 5,\n      y: charsGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    charsGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(charsGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(charsGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(charsGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ charsGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ charsGroup.id }`, box, newRectBox, \"corners\", { stroke: COLOR, debug: \"recognition-item-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(charsGroup.id, \"originX\")) {\n        this.renderer.setAttribute(charsGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(charsGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n    })\n    this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n\n  }\n  protected async showRecognitionItemBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBoxItem\")\n    await this.editor.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBoxItem\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            el.chars?.forEach(c =>\n            {\n              if (c?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(c[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, c.label, c.candidates)\n              }\n            })\n            break\n          }\n          case \"Node\": {\n            if (el?.[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              el.edges.forEach(e =>\n              {\n                const box = convertBoundingBoxMillimeterToPixel(e[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, e.kind)\n              })\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          default:\n            this.#logger.warn(\"drawRecognitionBoxItem\", `Unknow jiix element type: ${ el.type }`)\n            break\n        }\n      })\n    }\n  }\n  protected clearRecognitionItemBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBoxItem\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box-link\" } })\n  }\n  async debugRecognitionItemBox(): Promise<void>\n  {\n    this.clearRecognitionItemBox()\n    if (this.#recognitionItemBoxVisibility) {\n      this.showRecognitionItemBox()\n    }\n  }\n\n  apply(): void\n  {\n    this.debugBoundingBox()\n    this.debugVertices()\n    this.debugSnapPoints()\n    this.debugRecognitionBox()\n    this.debugRecognitionItemBox()\n  }\n}\n","import { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { SVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class IIMoveManager\n{\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  origin?: {\n    left: number,\n    top: number,\n    x: number,\n    y: number\n  }\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.origin = {\n      left: this.renderer.parent.scrollLeft,\n      top: this.renderer.parent.scrollTop,\n      x: info.clientX,\n      y: info.clientY,\n    }\n  }\n\n  continue(info: PointerInfo): void\n  {\n    if (!this.origin) {\n      throw new Error(\"Can't move cause origin is undefined\")\n    }\n    const dx = info.clientX - this.origin.x\n    const dy = info.clientY - this.origin.y\n\n    this.renderer.parent.scrollTop = this.origin.top - dy\n    this.renderer.parent.scrollLeft = this.origin.left - dx\n  }\n\n  end(info: PointerInfo): void\n  {\n    this.continue(info)\n    this.origin = undefined\n  }\n}\n","import { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IModel } from \"../model\"\nimport { Box, IIStroke, IIText, SymbolType, TBox, TIISymbol } from \"../symbol\"\nimport { SVGRenderer, SVGRendererConst, SVGBuilder } from \"../renderer\"\nimport { createUUID } from \"../utils\"\nimport { InkEditor } from \"../editor\"\n\n/**\n * @group Manager\n */\nexport class IDebugSVGManager {\n  #logger = LoggerManager.getLogger(LoggerCategory.SVGDEBUG)\n  #recognitionBoxVisibility = false\n  #recognitionBoxItemsVisibility = false\n  #recognitionBoxDrawing = false\n  #recognitionBoxItemsDrawing = false\n\n  editor: InkEditor\n\n  constructor(editor: InkEditor) {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IModel {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer {\n    return this.editor.renderer\n  }\n\n  get recognitionBoxVisibility(): boolean {\n    return this.#recognitionBoxVisibility\n  }\n\n  set recognitionBoxVisibility(show: boolean) {\n    this.#recognitionBoxVisibility = show\n    this.debugRecognitionBox()\n  }\n\n  get recognitionBoxItemsVisibility(): boolean {\n    return this.#recognitionBoxItemsVisibility\n  }\n\n  set recognitionBoxItemsVisibility(show: boolean) {\n    this.#recognitionBoxItemsVisibility = show\n    this.debugRecognitionBoxItems()\n  }\n\n  protected drawBoundingBox(symbols: TIISymbol[]): void {\n    const symbolAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"red\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"5 5\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    const charAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"orange\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"0 5 0\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    symbols.forEach(s => {\n      const symEl = this.renderer.getElementById(s.id)\n      if (symEl) {\n        if (s.type === SymbolType.Text) {\n          const text = s as IIText\n          let transform: string = \"\"\n          if (text.rotation) {\n            transform = `rotate(${text.rotation.degree}, ${text.rotation.center.x}, ${text.rotation.center.y})`\n          }\n          text.chars.forEach(c => {\n            const ca = {\n              ...charAttrs,\n              char: c.label,\n              transform\n            }\n            symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(c.bounds, ca))\n          })\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n            transform\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n        else {\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n      }\n    })\n  }\n\n  protected drawRecognitionBox(box: TBox, infos: string[], color: string, debugAttr: string): void {\n    const TEXT_HEIGHT = 20\n    const recognitionGroup = SVGBuilder.createGroup({ \"debug\": debugAttr, \"opacity\": debugAttr === \"recognition-box-items\" ? \"0.8\" : \"1\" })\n    const rectAttr = {\n      fill: \"transparent\",\n      stroke: color,\n      style: SVGRendererConst.noSelection,\n      \"stroke-dasharray\": debugAttr === \"recognition-box-items\" ? \"1 5 10\" : \"\",\n    }\n    const rect = SVGBuilder.createRect(box, rectAttr)\n    recognitionGroup.appendChild(rect)\n\n    const infosGroup = SVGBuilder.createGroup({ id: `infos-group-${createUUID()}` })\n    const infoX = box.x + box.width\n    let infoY = box.y + TEXT_HEIGHT / 2\n    infos?.forEach(w => {\n      infosGroup.appendChild(SVGBuilder.createText({ x: infoX, y: infoY }, w, { stroke: color, style: SVGRendererConst.noSelection }))\n      infoY += TEXT_HEIGHT\n    })\n    recognitionGroup.appendChild(infosGroup)\n    this.renderer.layer.appendChild(recognitionGroup)\n\n    const infosGroupBox = infosGroup.getBBox()\n    const rectBox = {\n      width: infosGroupBox.width + 10,\n      height: infosGroupBox.height + 10,\n      x: infosGroupBox.x - 5,\n      y: infosGroupBox.y - 5,\n    }\n\n    const rectTranslate = SVGBuilder.createRect(rectBox, { ...rectAttr, fill: \"white\", style: \"cursor:move\" })\n    infosGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) => {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(infosGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(infosGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(infosGroup.id, \"transform\", `translate(${tx},${ty})`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${infosGroup.id}`)\n      this.renderer.drawConnectionBetweenBox(`connection-${infosGroup.id}`, box, newRectBox, \"sides\", { stroke: color, debug: debugAttr })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e => {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(infosGroup.id, \"originX\")) {\n        this.renderer.setAttribute(infosGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(infosGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n      this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    })\n  }\n\n  protected buildInfos(obj: object, currentPath = \"\"): string[] {\n    const infos: string[] = []\n    Object.keys(obj).forEach((key) => {\n      const value = obj[key as keyof typeof obj]\n      const localPath = currentPath ? `${currentPath}.${key}` : key\n      switch (typeof value) {\n        case \"object\":\n          infos.push(...this.buildInfos(value, localPath))\n          break\n        default:\n          infos.push(`${localPath}: ${JSON.stringify(value)}`)\n          break\n      }\n    })\n    return infos\n  }\n\n  protected async showRecognitionBox(): Promise<void> {\n    if(this.#recognitionBoxDrawing) return\n    this.#recognitionBoxDrawing = true\n    this.#logger.info(\"showRecognitionBox\")\n    let jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    if (!jiix) {\n      const exports = await this.editor.recognizer.send(this.model.strokes, [\"application/vnd.myscript.jiix\"])\n      jiix = exports[\"application/vnd.myscript.jiix\"]!\n    }\n    this.#logger.debug(\"showRecognitionBox\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el => {\n        switch (el.type) {\n          case \"Drawing\":\n          case \"Shape\": {\n            const associatedStrokes: IIStroke[] = []\n            el.range?.forEach(r => {\n              associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n            })\n            const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n            let infos: string[] = [`type: ${el.type}`]\n            infos.push(...this.buildInfos(el))\n            const hideProperties = [\"bounding-box\", \"primitives\", \"range\", \"candidates\"]\n            infos = infos.filter(i => !hideProperties.some(h => i.indexOf(h) > -1))\n            const color = el.type === \"Shape\" ? \"orange\" : \"green\"\n            this.drawRecognitionBox(box, infos, color, \"recognition-box\")\n            break\n          }\n          case \"Text\": {\n            const associatedStrokes: IIStroke[] = []\n            el.range?.forEach(r => {\n              associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n            })\n            const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n            this.drawRecognitionBox(box, [`type: ${el.type}`, `label: ${JSON.stringify(el.label || [])}`], \"blue\", \"recognition-box\")\n            break\n          }\n          case \"Math\": {\n            const associatedStrokes: IIStroke[] = []\n            el.range?.forEach(r => {\n              associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n            })\n            const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n            let infos: string[] = [`type: ${el.type}`]\n            infos.push(...this.buildInfos(el))\n            const hideProperties = [\"bounding-box\", \"primitives\", \"range\", \"candidates\"]\n            infos = infos.filter(i => !hideProperties.some(h => i.indexOf(h) > -1))\n            this.drawRecognitionBox(box, infos, \"red\", \"recognition-box\")\n            break\n          }\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${el.type}`)\n            break\n          }\n        }\n      })\n    }\n    this.#recognitionBoxDrawing = false\n  }\n\n  protected async showRecognitionBoxItems(): Promise<void> {\n    if(this.#recognitionBoxItemsDrawing) return\n    this.#recognitionBoxItemsDrawing = true\n    this.#logger.info(\"showRecognitionBoxItems\")\n    let jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    if (!jiix) {\n      const exports = await this.editor.recognizer.send(this.model.strokes, [\"application/vnd.myscript.jiix\"])\n      jiix = exports[\"application/vnd.myscript.jiix\"]!\n    }\n    this.#logger.debug(\"showRecognitionBoxItems\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el => {\n        switch (el.type) {\n          case \"Shape\": {\n            el.elements.forEach(e => {\n              const associatedStrokes: IIStroke[] = []\n              e.range?.forEach(r => {\n                associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n              })\n              const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n              let infos: string[] = [`type: ${el.type}`]\n              infos.push(...this.buildInfos(e))\n              const hideProperties = [\"bounding-box\", \"primitives\", \"range\", \"candidates\"]\n              infos = infos.filter(i => !hideProperties.some(h => i.indexOf(h) > -1))\n              this.drawRecognitionBox(box, infos, \"#ce922a\", \"recognition-box-items\")\n            })\n            break\n          }\n          case \"Math\":\n          case \"Text\": {\n            el.lines?.forEach(e => {\n              e.spans?.forEach(s => {\n                const associatedStrokes: IIStroke[] = []\n                s.range.forEach(r => {\n                  associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n                })\n                const color = s.type === \"Math\" ? \"#ff6565\" : \"#099df7\"\n                const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n                this.drawRecognitionBox(box, [`type: ${s.type}`, `label: ${JSON.stringify(s.label || [])}`], color, \"recognition-box-items\")\n              })\n            })\n            break\n          }\n\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${el.type}`)\n            break\n          }\n        }\n      })\n    }\n    this.#recognitionBoxItemsDrawing = false\n  }\n\n  protected clearRecognitionBox(): void {\n    this.#logger.info(\"clearRecognitionBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box\" } })\n  }\n\n  protected clearRecognitionBoxItems(): void {\n    this.#logger.info(\"clearRecognitionBoxItems\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box-items\" } })\n  }\n\n  async debugRecognitionBox(): Promise<void> {\n    this.clearRecognitionBox()\n    if (this.#recognitionBoxVisibility) {\n      this.showRecognitionBox()\n    }\n  }\n\n  async debugRecognitionBoxItems(): Promise<void> {\n    this.clearRecognitionBoxItems()\n    if (this.#recognitionBoxItemsVisibility) {\n      this.showRecognitionBoxItems()\n    }\n  }\n\n  apply(): void {\n    this.debugRecognitionBox()\n    this.debugRecognitionBoxItems()\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIEraser, TSegment } from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { InkEditor } from \"../editor\"\n\n/**\n * @group Manager\n */\nexport class EraseManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.WRITE)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor | InkEditor\n\n  currentEraser?: IIEraser\n\n  constructor(editor: InteractiveInkEditor | InkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.#logger.info(\"startErase\", { info })\n    this.currentEraser = new IIEraser()\n    this.currentEraser.pointers.push(info.pointer)\n    this.renderer.drawSymbol(this.currentEraser!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    this.#logger.info(\"continueErase\", { info })\n    if (!this.currentEraser) {\n      throw new Error(\"Can't update current eraser because currentEraser is undefined\")\n    }\n    this.currentEraser.pointers.push(info.pointer)\n    this.renderer.drawSymbol(this.currentEraser)\n    const lastSeg: TSegment = {\n      p1: this.currentEraser.pointers.at(-1)!,\n      p2: this.currentEraser.pointers.at(-2)!\n    }\n    if (this.editor instanceof InteractiveInkEditor) {\n      this.editor.model.symbols.forEach(s =>\n      {\n        if (s.isIntersected(lastSeg)) {\n          s.deleting = true\n          this.renderer.drawSymbol(s)\n        }\n      })\n    }\n    else {\n      this.editor.model.strokes.forEach(s =>\n      {\n        if (s.isIntersected(lastSeg)) {\n          s.deleting = true\n          this.renderer.drawSymbol(s)\n        }\n      })\n    }\n  }\n\n  async end(info: PointerInfo): Promise<void>\n  {\n    this.#logger.info(\"finishErasing\", { info })\n    this.continue(info)\n\n    this.renderer.removeSymbol(this.currentEraser!.id)\n    if (this.editor instanceof InteractiveInkEditor) {\n      this.editor.removeSymbols(this.editor.model.symbolsToDelete.map(s => s.id))\n    }\n    else {\n      this.editor.removeStrokes(this.editor.model.strokesToDelete.map(s => s.id))\n    }\n    this.currentEraser = undefined\n  }\n}\n","/**\n * @group History\n */\nexport type THistoryContext = {\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  stackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group History\n */\nexport const getInitialHistoryContext = (): THistoryContext => {\n  return {\n    stackIndex: 0,\n    possibleUndoCount: 0,\n    canRedo: false,\n    canUndo: false,\n    empty: true,\n  }\n}\n","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model } from \"../model\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\n\n/**\n * @group History\n */\nexport class HistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: Model[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].symbols.length === 0\n  }\n\n  push(model: Model): void\n  {\n    this.#logger.info(\"push\", { model })\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push(model.clone())\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  updateStack(model: Model): void\n  {\n    this.#logger.info(\"updateStack\", { model })\n    const index = this.stack.findIndex(m => m.modificationDate === model.modificationDate)\n    if (index > -1) {\n      this.stack.splice(index, 1, model.clone())\n    }\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  undo(): Model\n  {\n    this.#logger.info(\"undo\")\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"undo\", previousModel)\n    return previousModel\n  }\n\n  redo(): Model\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"redo\", nextModel)\n    return nextModel\n  }\n}\n","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { IIDecorator, IIStroke, TIISymbol, TPoint } from \"../symbol\"\nimport { TStyle } from \"../style\"\nimport { MatrixTransform, TMatrixTransform } from \"../transform\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\nimport { PartialDeep } from \"../utils\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\n\n/**\n * @group History\n */\nexport type TIIHistoryChanges = {\n  added?: TIISymbol[]\n  updated?: TIISymbol[]\n  erased?: TIISymbol[]\n  replaced?: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] }\n  matrix?: { symbols: TIISymbol[], matrix: TMatrixTransform }\n  translate?: { symbols: TIISymbol[], tx: number, ty: number }[]\n  scale?: { symbols: TIISymbol[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { symbols: TIISymbol[], angle: number, center: TPoint }[]\n  style?: { symbols: TIISymbol[], style?: PartialDeep<TStyle>, fontSize?: number }\n  order?: { symbols: TIISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\" }\n  decorator?: { symbol: TIISymbol, decorator: IIDecorator, added: boolean }[]\n  group?: { symbols: TIISymbol[] }\n  ungroup?: { group: TIISymbol }\n}\n\n/**\n * @group History\n * @remarks used to send messages to the backend on undo or redo\n */\nexport type TIIHistoryBackendChanges = {\n  added?: IIStroke[]\n  erased?: IIStroke[]\n  replaced?: { oldStrokes: IIStroke[], newStrokes: IIStroke[] }\n  matrix?: { strokes: IIStroke[], matrix: TMatrixTransform },\n  translate?: { strokes: IIStroke[], tx: number, ty: number }[]\n  scale?: { strokes: IIStroke[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { strokes: IIStroke[], angle: number, center: TPoint }[]\n}\n\n/**\n * @group History\n */\nexport type TIIHistoryStackItem = {\n  changes: TIIHistoryChanges\n  model: IIModel\n}\n\n/**\n * @group History\n */\nexport class IIHistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: TIIHistoryStackItem[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].model.symbols.length === 0\n  }\n\n  isChangesEmpty(changes: TIIHistoryChanges): boolean\n  {\n    return !(\n      changes.added?.length ||\n      changes.updated?.length ||\n      changes.erased?.length ||\n      changes.replaced?.oldSymbols.length ||\n      changes.matrix?.symbols.length ||\n      changes.translate?.length ||\n      changes.rotate?.length ||\n      changes.scale?.length ||\n      changes.style?.symbols?.length ||\n      changes.order?.symbols?.length ||\n      changes.decorator?.length ||\n      changes.group?.symbols.length ||\n      changes.ungroup?.group\n    )\n  }\n\n  init(model: IIModel): void\n  {\n    this.stack.push({ model: model.clone(), changes: {} })\n    this.event.emitChanged(this.context)\n  }\n\n  push(model: IIModel, changes: TIIHistoryChanges): void\n  {\n    this.#logger.info(\"push\", { model, changes })\n    if (this.isChangesEmpty(changes)) return\n\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push({ model: model.clone(), changes })\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  update(model: IIModel): void\n  {\n    this.#logger.info(\"pop\")\n    const stackIdx = this.stack.findIndex(s => s.model.modificationDate === model.modificationDate)\n    if (stackIdx > -1) {\n      this.stack[stackIdx].model = model\n      this.updateContext()\n    }\n  }\n\n  pop(): void\n  {\n    this.#logger.info(\"pop\")\n    this.stack.pop()\n    this.context.stackIndex = this.stack.length - 1\n    this.updateContext()\n  }\n\n  protected reverseChanges(changes: TIIHistoryChanges): TIIHistoryChanges\n  {\n    const reversedChanges: TIIHistoryChanges = {}\n    if (changes.added) {\n      reversedChanges.erased = changes.added\n    }\n    if (changes.erased) {\n      reversedChanges.added = changes.erased\n    }\n    if (changes.replaced) {\n      reversedChanges.replaced = {\n        newSymbols: changes.replaced.oldSymbols,\n        oldSymbols: changes.replaced.newSymbols\n      }\n    }\n    if (changes.matrix) {\n      reversedChanges.matrix = {\n        symbols: changes.matrix.symbols,\n        matrix: new MatrixTransform(changes.matrix.matrix.xx, changes.matrix.matrix.yx, changes.matrix.matrix.xy, changes.matrix.matrix.yy, changes.matrix.matrix.tx, changes.matrix.matrix.ty).invert()\n      }\n    }\n    if (changes.translate?.length) {\n      reversedChanges.translate = changes.translate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          tx: -tr.tx,\n          ty: -tr.ty,\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      reversedChanges.rotate = changes.rotate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          angle: 2 * Math.PI - tr.angle,\n          center: tr.center\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      reversedChanges.scale = changes.scale.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          origin: tr.origin,\n          scaleX: 1 / tr.scaleX,\n          scaleY: 1 / tr.scaleY\n        }\n      })\n    }\n\n    return reversedChanges\n  }\n\n  undo(): TIIHistoryStackItem\n  {\n    this.#logger.info(\"undo\")\n    const currentStackItem = this.stack[this.context.stackIndex]\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"undo\", previousStackItem)\n    return {\n      model: previousStackItem.model,\n      changes: this.reverseChanges(currentStackItem.changes)\n    }\n  }\n\n  redo(): TIIHistoryStackItem\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"redo\", nextStackItem)\n    return nextStackItem\n  }\n\n  clear(): void\n  {\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n}","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IModel } from \"../model\"\nimport { IIStroke, TIISymbol } from \"../symbol\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\n\n/**\n * @group History\n */\nexport type TIHistoryChanges = {\n  added?: TIISymbol[]\n  removed?: TIISymbol[]\n}\n\n/**\n * @group History\n * @remarks used to send messages to the backend on undo or redo\n */\nexport type TIHistoryBackendChanges = {\n  added?: IIStroke[]\n  removed?: IIStroke[]\n}\n\n/**\n * @group History\n */\nexport type TIHistoryStackItem = {\n  changes: TIHistoryChanges\n  model: IModel\n}\n\n/**\n * @group History\n */\nexport class IHistoryManager {\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: TIHistoryStackItem[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent) {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].model.strokes.length === 0\n  }\n\n  updateModelStack(model: IModel): void {\n    this.#logger.info(\"updateModelStack\", { model })\n    const stackIdx = this.stack.findIndex(s => s.model.modificationDate === model.modificationDate)\n    if (stackIdx > -1) {\n      this.stack[stackIdx].model = model.clone()\n      this.updateContext()\n    }\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  isChangesEmpty(changes: TIHistoryChanges): boolean {\n    return !(\n      changes.added?.length ||\n      changes.removed?.length\n    )\n  }\n\n  init(model: IModel): void {\n    this.stack.push({ model: model.clone(), changes: {} })\n    this.event.emitChanged(this.context)\n  }\n\n  push(model: IModel, changes: TIHistoryChanges): void {\n    this.#logger.info(\"push\", { model, changes })\n    if (this.isChangesEmpty(changes)) return\n\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push({ model: model.clone(), changes })\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  pop(): void {\n    this.#logger.info(\"pop\")\n    this.stack.pop()\n    this.context.stackIndex = this.stack.length - 1\n    this.updateContext()\n  }\n\n  protected reverseChanges(changes: TIHistoryChanges): TIHistoryChanges {\n    const reversedChanges: TIHistoryChanges = {}\n    if (changes.added) {\n      reversedChanges.removed = changes.added\n    }\n    if (changes.removed) {\n      reversedChanges.added = changes.removed\n    }\n    return reversedChanges\n  }\n\n  undo(): TIHistoryStackItem {\n    this.#logger.info(\"undo\")\n    const currentStackItem = this.stack[this.context.stackIndex]\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"undo\", previousStackItem)\n    return {\n      model: previousStackItem.model,\n      changes: this.reverseChanges(currentStackItem.changes)\n    }\n  }\n\n  redo(): TIHistoryStackItem {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"redo\", nextStackItem)\n    return nextStackItem\n  }\n\n  clear(): void {\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n}\n","\n/**\n * @group History\n */\nexport type THistoryConfiguration = {\n  maxStackSize: number\n}\n\n/**\n * @group History\n * @source\n */\nexport const DefaultHistoryConfiguration: THistoryConfiguration = {\n  maxStackSize: 100\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\n\n/**\n * @group Menu\n */\nexport type TMenuItem = {\n  id: string,\n  label: string,\n  type: \"button\" | \"checkbox\" | \"select\" | \"list\" | \"colors\"\n  disabled?: boolean\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButton = TMenuItem & {\n  type: \"button\"\n  icon?: string\n  callback: () => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButtonList = TMenuItem & {\n  type: \"list\"\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemColorList = TMenuItem & {\n  type: \"colors\"\n  initValue: string,\n  values: string[]\n  fill: boolean\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemBoolean = TMenuItem & {\n  type: \"checkbox\",\n  initValue: boolean | \"indeterminate\",\n  callback: (value: boolean) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemSelect = TMenuItem & {\n  type: \"select\",\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport abstract class IIMenu\n{\n  thicknessList = [\n    { label: \"S\", value: 1 },\n    { label: \"M\", value: 2 },\n    { label: \"L\", value: 4 },\n    { label: \"XL\", value: 8 },\n  ]\n\n  fontSizeList = [\n    { label: \"Auto\", value: \"auto\" },\n    { label: \"S\", value: 0.5 },\n    { label: \"M\", value: 0.75 },\n    { label: \"L\", value: 1 },\n  ]\n\n  fontWeightList = [\n    { label: \"Auto\", value: \"auto\" },\n    { label: \"Normal\", value: \"normal\" },\n    { label: \"Bold\", value: \"bold\" },\n  ]\n\n  colors = [\n    \"#000000\", \"#808080\", \"#ffffff\", \"transparent\",\n    \"#ff0000\", \"#ff6400\", \"#ffc800\", \"#ffff00\",\n    \"#0000ff\", \"#0064ff\", \"#00c8ff\", \"#00ffff\",\n    \"#008000\", \"#00af00\", \"#00e100\", \"#00ff00\"\n  ]\n\n  protected createWrapCollapsible(el: Node, title: string): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"collapsible-wrapper\")\n    const head = document.createElement(\"div\")\n    head.classList.add(\"collapsible-header\")\n    head.textContent = title\n    const btn = document.createElement(\"span\")\n    btn.classList.add(\"collapsible-header-icon\")\n    btn.innerHTML = ArrowDown\n    head.appendChild(btn)\n    head.style.setProperty(\"pointer\", \"cursor\")\n    const content = document.createElement(\"div\")\n    content.classList.add(\"collapsible-content\")\n    head.addEventListener(\"pointerup\", () => wrapper.classList.toggle(\"active\"))\n    wrapper.appendChild(head)\n    content.appendChild(el)\n    wrapper.appendChild(content)\n    return wrapper\n  }\n\n  protected createMenuItemBoolean(item: TMenuItemBoolean): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const checkbox = document.createElement(\"input\")\n    checkbox.id = item.id\n    checkbox.setAttribute(\"type\", \"checkbox\")\n    if (item.disabled) {\n      checkbox.disabled = true\n    }\n    if (item.initValue === \"indeterminate\") {\n      checkbox.indeterminate = true\n    } else {\n      checkbox.checked = item.initValue\n    }\n    checkbox.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).checked))\n    wrapper.appendChild(checkbox)\n    return wrapper\n  }\n\n  protected createMenuItemSelect(item: TMenuItemSelect): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const select = document.createElement(\"select\")\n    select.id = item.id\n    if (item.disabled) {\n      select.disabled = true\n    }\n    item.values.forEach(v =>\n    {\n      const selected = v.value === item.initValue\n      const opt = new Option(v.label, v.value.toString(), selected, selected)\n      select.appendChild(opt)\n    })\n    select.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).value))\n    wrapper.appendChild(select)\n    return wrapper\n  }\n\n  protected createMenuItemButton(item: TMenuItemButton): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.classList.add(\"ms-menu-item\", \"ms-menu-button\")\n    btn.innerHTML = item.icon || item.label\n    btn.addEventListener(\"pointerup\", item.callback)\n    return btn\n  }\n\n  protected createMenuItemButtonList(item: TMenuItemButtonList): HTMLElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    item.values.forEach((v) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${item.id}-${ v.value }-btn`\n      if (item.initValue === v.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.textContent = v.label\n      btn.addEventListener(\"pointerup\", () =>\n      {\n        item.callback(v.value)\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      wrapper.appendChild(btn)\n    })\n    return wrapper\n  }\n\n  protected createMenuItemColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    wrapper.appendChild(this.createColorList(item))\n    return wrapper\n  }\n\n  protected createColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const list = document.createElement(\"div\")\n    list.id = `${ item.id }-list`\n    list.classList.add(\"ms-menu-row\", \"color-list\")\n    item.values.forEach((color) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${ item.id }-${ color.replace(\"#\", \"\") }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      const colorEl = document.createElement(\"div\")\n      colorEl.classList.add(\"color\")\n      if (item.fill) {\n        colorEl.style.setProperty(\"background-color\", color)\n        colorEl.style.setProperty(\"border\", \"1px solid lightgrey\")\n      } else {\n        colorEl.style.setProperty(\"background-color\", \"transparent\")\n        colorEl.style.setProperty(\"border\", `3px solid ${ color }`)\n      }\n      if (color === \"#ffffff\") {\n        colorEl.style.setProperty(\"border\", \"1px solid black\")\n      }\n      if (color === \"transparent\") {\n        colorEl.style.setProperty(\"background-image\", \"linear-gradient(45deg, #AAA 10%, transparent 20%, #AAA 30%, transparent 40%, #AAA 50%, transparent 60%, #AAA 70%, transparent 80%, #AAA 90%, transparent 100%)\")\n      }\n      if (item.initValue === color) {\n        btn.classList.add(\"active\")\n      }\n      btn.appendChild(colorEl)\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        item.callback(color)\n        list.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      list!.appendChild(btn)\n    })\n    return list\n  }\n\n  protected createMenuItem(item: TMenuItem): HTMLElement\n  {\n    switch (item.type) {\n      case \"checkbox\":\n        return this.createMenuItemBoolean(item as TMenuItemBoolean)\n      case \"select\":\n        return this.createMenuItemSelect(item as TMenuItemSelect)\n      case \"list\":\n        return this.createMenuItemButtonList(item as TMenuItemButtonList)\n      case \"colors\":\n        return this.createMenuItemColorList(item as TMenuItemColorList)\n      case \"button\":\n      default:\n        return this.createMenuItemButton(item as TMenuItemButton)\n    }\n  }\n\n  abstract render(domElement: HTMLElement): void\n\n  abstract update(): void\n\n  abstract show(): void\n\n  abstract hide(): void\n\n  abstract destroy(): void\n}\n","\n/**\n * @group Gesture\n * @summary List all authorized gestures\n */\nexport type TGestureType = \"UNDERLINE\" | \"SCRATCH\" | \"JOIN\" | \"INSERT\" | \"STRIKETHROUGH\" | \"SURROUND\"\n\n/**\n * @group Gesture\n * @remarks\n *  when gestureType = \"INSERT\", subStrokes represent the two parts\n *  when gestureType = \"SCRATCH\", subStrokes represent the part to substract at the stroke corresponding fullStrokeId\n */\nexport type TGesture = {\n  gestureType: TGestureType\n  gestureStrokeId: string\n  strokeIds: string[]\n  strokeBeforeIds: string[]\n  strokeAfterIds: string[]\n  subStrokes?: { fullStrokeId: string, x: number[], y: number[] }[]\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on surround detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum SurroundAction\n{\n  Select = \"select\",\n  Surround = \"surround\",\n  Highlight = \"highlight\"\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on strikeThrough detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum StrikeThroughAction\n{\n  Erase = \"erase\",\n  Draw = \"draw\"\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on split detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum InsertAction\n{\n  /**\n   * @remarks Add line break on gesture place\n   */\n  LineBreak = \"line-break\",\n  /**\n   * @remarks Insert place in gesture place\n   */\n  Insert = \"insert\"\n}\n","import { InsertAction, StrikeThroughAction, SurroundAction } from \"./Gesture\"\n\n/**\n * @group Gesture\n * @source\n */\nexport type TGestureConfiguration = {\n  surround: SurroundAction\n  strikeThrough: StrikeThroughAction\n  insert: InsertAction\n}\n\n/**\n * @group Gesture\n * @source\n */\nexport const DefaultGestureConfiguration: TGestureConfiguration = {\n  surround: SurroundAction.Select,\n  strikeThrough: StrikeThroughAction.Draw,\n  insert: InsertAction.LineBreak\n}\n","import { EditorTool } from \"../Constants\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  IIDecorator,\n  IIStroke,\n  SymbolType,\n  IIText,\n  DecoratorKind,\n  IISymbolGroup,\n  TIISymbol,\n  Box,\n  TPoint,\n  IIRecognizedText,\n  RecognizedKind,\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { SVGRenderer } from \"../renderer\"\nimport { IIHistoryManager, TIIHistoryChanges } from \"../history\"\nimport { computeAverage, isBetween, PartialDeep } from \"../utils\"\nimport { IITranslateManager } from \"../manager/IITranslateManager\"\nimport { IITextManager } from \"../manager/IITextManager\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { InsertAction, StrikeThroughAction, SurroundAction, TGesture } from \"./Gesture\"\nimport { DefaultGestureConfiguration, TGestureConfiguration } from \"./GestureConfiguration\"\n\n/**\n * @group Gesture\n */\nexport class IIGestureManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.GESTURE)\n\n  insertAction: InsertAction = InsertAction.LineBreak\n  surroundAction: SurroundAction = SurroundAction.Select\n  strikeThroughAction: StrikeThroughAction = StrikeThroughAction.Draw\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor, gestureAction?: PartialDeep<TGestureConfiguration>)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.surroundAction = gestureAction?.surround || DefaultGestureConfiguration.surround\n    this.strikeThroughAction = gestureAction?.strikeThrough || DefaultGestureConfiguration.strikeThrough\n    this.insertAction = gestureAction?.insert || DefaultGestureConfiguration.insert\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get recognizer(): RecognizerWebSocket\n  {\n    return this.editor.recognizer\n  }\n\n  get translator(): IITranslateManager\n  {\n    return this.editor.translator\n  }\n\n  get texter(): IITextManager\n  {\n    return this.editor.texter\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get history(): IIHistoryManager\n  {\n    return this.editor.history\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get strokeSpaceWidth(): number\n  {\n    return this.editor.configuration.rendering.guides.gap * 2\n  }\n\n  async applySurroundGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"applySurroundGesture\", { gestureStroke, gesture })\n    const changes: TIIHistoryChanges = {}\n    const ids = this.model.symbols.filter(s => gestureStroke.bounds.contains(s.bounds)).map(s => s.id)\n    switch (this.surroundAction) {\n      case SurroundAction.Select: {\n        if (ids.length) {\n          this.editor.tool = EditorTool.Select\n          this.editor.select(ids)\n        }\n        break\n      }\n      case SurroundAction.Highlight: {\n        const symbolIds: string[] = []\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(sym.type) && !symbolIds.includes(sym.id)) {\n            const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const highlight = new IIDecorator(DecoratorKind.Highlight, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Highlight)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(highlight) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            symbolIds.push(symWithDec.id)\n            changes.decorator!.push({ symbol: symWithDec, decorator: highlight, added })\n          }\n        })\n        if (changes.decorator.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case SurroundAction.Surround: {\n        const symbolIds: string[] = []\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(sym.type) && !symbolIds.includes(sym.id)) {\n            const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const surround = new IIDecorator(DecoratorKind.Surround, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Surround)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(surround) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator!.push({ symbol: symWithDec, decorator: surround, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        this.history.push(this.model, changes)\n        break\n      }\n      default:\n        this.#logger.error(\"applySurroundGesture\", `Unknow surroundAction: ${ this.surroundAction }, values allowed are: ${ SurroundAction.Highlight }, ${ SurroundAction.Select }, ${ SurroundAction.Surround }`)\n        break\n    }\n    return\n  }\n\n  protected computeScratchOnStrokes(gesture: TGesture, stroke: IIStroke): IIStroke[]\n  {\n    const newStrokes: IIStroke[] = []\n    const partPointersToRemove = gesture.subStrokes?.find(ss => ss.fullStrokeId === stroke.id)\n    if (partPointersToRemove) {\n      const strokePartToErase = new IIStroke()\n      partPointersToRemove.x.forEach((x, i) => strokePartToErase.addPointer({ x, y: partPointersToRemove.y[i], p: 1, t: 1 }))\n      const subStrokes = IIStroke.substract(stroke, strokePartToErase)\n      if (subStrokes.before && subStrokes.before.pointers.length > 1) newStrokes.push(subStrokes.before)\n      if (subStrokes.after && subStrokes.after.pointers.length > 1) newStrokes.push(subStrokes.after)\n    }\n    return newStrokes\n  }\n\n  protected computeScratchOnText(gestureStroke: IIStroke, textSymbol: IIText): IIText | undefined\n  {\n    const charsToRemove = textSymbol.getCharsOverlaps(gestureStroke.pointers)\n    if (textSymbol.chars.length == charsToRemove.length) {\n      return\n    }\n    else {\n      charsToRemove.forEach(c =>\n      {\n        const cIndex = textSymbol.chars.findIndex(c1 => c1.id === c.id)\n        textSymbol.chars.splice(cIndex, 1)\n      })\n      this.texter.updateBounds(textSymbol)\n      return textSymbol\n    }\n  }\n\n  protected computeScratchOnSymbol(gestureStroke: IIStroke, gesture: TGesture, symbol: TIISymbol): { erased?: boolean, replaced?: TIISymbol[] }\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke: {\n        const strokesScratchedResult = this.computeScratchOnStrokes(gesture, symbol)\n        if (strokesScratchedResult.length) {\n          return {\n            replaced: strokesScratchedResult\n          }\n        }\n        else {\n          return { erased: true }\n        }\n      }\n      case SymbolType.Recognized: {\n        if (symbol.kind === RecognizedKind.Text) {\n          const childrenNotTouch = symbol.strokes.filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n          const childrenTouch = symbol.strokes.filter(s => gestureStroke.bounds.overlaps(s.bounds))\n          const results = childrenTouch.map(s =>\n          {\n            return {\n              symbol: s,\n              result: this.computeScratchOnStrokes(gesture, s)\n            }\n          })\n          if (childrenNotTouch.length === 0 && results.every(r => r.result.length === 0)) {\n            return { erased: true }\n          }\n          else {\n            const strokesToConserve: IIStroke[] = childrenNotTouch.concat(...results.flatMap(r => r.result))\n            const strokeText = new IIRecognizedText(strokesToConserve, { baseline: symbol.baseline, xHeight: symbol.xHeight }, symbol.style)\n            strokeText.decorators = symbol.decorators\n            return {\n              replaced: [strokeText]\n            }\n          }\n        }\n        return {}\n      }\n      case SymbolType.Group: {\n        const childrenNotTouch = symbol.children.filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n        const childrenTouch = symbol.children.filter(s => gestureStroke.bounds.overlaps(s.bounds))\n        const results = childrenTouch.map(s =>\n        {\n          return {\n            symbol: s,\n            result: this.computeScratchOnSymbol(gestureStroke, gesture, s)\n          }\n        })\n        if (childrenNotTouch.length === 0 && results.every(r => r.result.erased)) {\n          return { erased: true }\n        }\n        else {\n          const symbolsGroup: TIISymbol[] = childrenNotTouch\n          results.forEach(r =>\n          {\n            if (r.result.replaced) {\n              symbolsGroup.push(...r.result.replaced)\n            }\n          })\n          const newGroup = new IISymbolGroup(symbolsGroup, symbol.style)\n          newGroup.decorators = symbol.decorators\n          return {\n            replaced: [newGroup]\n          }\n        }\n      }\n      case SymbolType.Text: {\n        const textScratchedResult = this.computeScratchOnText(gestureStroke, symbol)\n        if (textScratchedResult) {\n          return {\n            replaced: [textScratchedResult]\n          }\n        }\n        else {\n          return {\n            erased: true\n          }\n        }\n      }\n      case SymbolType.Shape:\n      case SymbolType.Edge: {\n        return {\n          erased: true\n        }\n      }\n    }\n  }\n\n  async applyScratch(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyScratchGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyScratchGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n    const symbolsToUpdate: TIISymbol[] = []\n    const symbolsToErase: TIISymbol[] = []\n    const symbolsToReplace: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && !symbolsToErase.some(s => s.id === sym.id) && !symbolsToReplace.oldSymbols.some(s => s.id === sym.id)) {\n        const result = this.computeScratchOnSymbol(gestureStroke, gesture, sym)\n        if (result.erased) symbolsToErase.push(sym)\n        else if (result.replaced) {\n          symbolsToReplace.newSymbols.push(...result.replaced)\n          symbolsToReplace.oldSymbols.push(sym)\n        }\n      }\n    })\n\n    const promises: Promise<void | TIISymbol[]>[] = []\n    const changes: TIIHistoryChanges = {}\n    if (symbolsToUpdate.length) {\n      promises.push(this.editor.updateSymbols(symbolsToUpdate, false))\n      changes.updated = symbolsToUpdate\n    }\n\n    if (symbolsToErase.length) {\n      promises.push(this.editor.removeSymbols(symbolsToErase.map(s => s.id), false))\n      changes.erased = symbolsToErase\n    }\n\n    if (symbolsToReplace.newSymbols.length) {\n      changes.replaced = symbolsToReplace\n      promises.push(this.editor.replaceSymbols(symbolsToReplace.oldSymbols, symbolsToReplace.newSymbols, false))\n    }\n\n    this.history.push(this.model, changes)\n    await Promise.all(promises)\n  }\n\n  async applyJoinGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyJoinGesture\", { gestureStroke, gesture })\n\n    const symbolsAbove = this.model.symbols.filter(s => this.model.isSymbolAbove(gestureStroke, s))\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => s.bounds.xMax <= gestureStroke.bounds.xMid)\n    const symbolsOnGestureInRow = symbolsRow.filter(s => s.bounds.xMax > gestureStroke.bounds.xMid && s.bounds.xMin <= gestureStroke.bounds.xMid)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => s.bounds.xMin > gestureStroke.bounds.xMid)\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n    const changes: TIIHistoryChanges = {}\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    if (symbolsOnGestureInRow.length) {\n      const symbolToJoin = symbolsOnGestureInRow[0]\n      if (symbolToJoin?.type === SymbolType.Group) {\n        const children = symbolToJoin.children.map(c => c.clone())\n        const childBefore = children.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = children.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          const newGroup = new IISymbolGroup(children, symbolToJoin.style)\n          newGroup.decorators = symbolToJoin.decorators.map(d => d.clone())\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [newGroup]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n      else if (symbolToJoin?.type === SymbolType.Recognized) {\n        const strokeText = symbolToJoin.clone()\n        const childBefore = strokeText.strokes.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = strokeText.strokes.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [strokeText]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsAfterGestureInRow.length) {\n      const lastSymbBefore = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfter = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n\n      const lastXBefore = Math.max(...symbolsBeforeGestureInRow.map(s => s.bounds.xMax))\n      const firstXAfter = Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      const translateX = lastXBefore - firstXAfter\n\n      const lastSymbBeforeClone = lastSymbBefore.clone()\n      const firstSymbolAfterClone = firstSymbolAfter.clone()\n      this.translator.applyToSymbol(firstSymbolAfterClone, translateX, 0)\n      const symbolsToGroup = lastSymbBefore.type === SymbolType.Group ? (lastSymbBeforeClone as IISymbolGroup).children : [lastSymbBeforeClone]\n      symbolsToGroup.push(...(firstSymbolAfterClone.type === SymbolType.Group ? (firstSymbolAfterClone as IISymbolGroup).children : [firstSymbolAfterClone]))\n\n      if (symbolsToGroup.every(s => s.type === SymbolType.Text)) {\n        const texts = symbolsToGroup as IIText[]\n        const text = new IIText(texts.flatMap(s => s.chars), texts[0].point, Box.createFromBoxes(texts.map(t => t.bounds)))\n        this.texter.setBounds(text)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [text]\n        }\n      }\n      else if (symbolsToGroup.every(s => s.type === SymbolType.Recognized)) {\n        const strokeTexts = symbolsToGroup as IIRecognizedText[]\n        const strokeText = new IIRecognizedText(strokeTexts.flatMap(s => s.strokes), strokeTexts[0], strokeTexts[0].style)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [strokeText]\n        }\n      }\n      else {\n        const group = new IISymbolGroup(symbolsToGroup, lastSymbBefore.style)\n        if ([SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(lastSymbBefore.type)) {\n          (lastSymbBefore as IIStroke).decorators.forEach(d =>\n          {\n            group.decorators.push(new IIDecorator(d.kind, d.style))\n          })\n        }\n        if ([SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(firstSymbolAfter.type)) {\n          (firstSymbolAfter as IIStroke).decorators.forEach(d =>\n          {\n            if (!group.decorators.some(d1 => d1.kind == d.kind)) {\n              group.decorators.push(new IIDecorator(d.kind, d.style))\n            }\n          })\n        }\n\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [group]\n        }\n      }\n\n      const rest = symbolsAfterGestureInRow.filter(s => s.id !== firstSymbolAfter.id)\n      if (rest.length) {\n        translate.push({ symbols: rest, tx: translateX, ty: 0 })\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length) {\n      const lastSymbolBeforeGesture = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsBelow)\n      if (firstSymbolAfterGesture) {\n        if (this.model.roundToLineGuide(lastSymbolBeforeGesture.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const symbolInNextRow = symbolsBelow.filter(s => this.model.isSymbolInRow(firstSymbolAfterGesture, s))\n          if (symbolInNextRow.length) {\n            const translateX = lastSymbolBeforeGesture.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n            translate.push({ symbols: symbolInNextRow, tx: translateX, ty: -this.rowHeight })\n          }\n          const symbolsAfterNextRow = symbolsBelow.filter(s => this.model.isSymbolBelow(firstSymbolAfterGesture, s))\n          if (symbolsAfterNextRow.length) {\n            translate.push({ symbols: symbolsAfterNextRow, tx: 0, ty: -this.rowHeight })\n          }\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n      }\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n      const lastSymbolAbove = this.model.getLastSymbol(symbolsAbove)\n      if (lastSymbolAbove) {\n        if (this.model.roundToLineGuide(lastSymbolAbove.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const translateX = lastSymbolAbove.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: -this.rowHeight })\n        }\n        else {\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: 0, ty: -this.rowHeight })\n        }\n\n        if (symbolsBelow.length) {\n          translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsAfterGestureInRow.concat(...symbolsBelow), tx: 0, ty: -this.rowHeight })\n      }\n\n    }\n    if (changes.replaced?.oldSymbols.length) {\n      this.editor.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false)\n    }\n    if (translate.length) {\n      changes.translate = translate\n      Promise.all(translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n    }\n    this.history.push(this.model, changes)\n  }\n\n  protected createStrokesFromGestureSubStroke(strokeOrigin: IIStroke, subStrokes: { x: number[], y: number[] }[]): IIStroke[]\n  {\n    const strokes: IIStroke[] = []\n    if (subStrokes[0]) {\n      const subStroke = new IIStroke(strokeOrigin.style)\n      subStrokes![0].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![0].y[i],\n          p: strokeOrigin.pointers.at(i)?.p || 1,\n          t: strokeOrigin.pointers.at(i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    if (subStrokes[1]) {\n      const subStroke = new IIStroke(strokeOrigin.style)\n      subStrokes[1].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![1].y[i],\n          p: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.p || 1,\n          t: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    return strokes\n  }\n\n  protected computeSplitStroke(strokeOrigin: IIStroke, subStrokes: { x: number[], y: number[] }[]): { before?: IIStroke, after?: IIStroke }\n  {\n    let after: IIStroke | undefined\n    const newStrokes = this.createStrokesFromGestureSubStroke(strokeOrigin, subStrokes)\n\n    if (newStrokes[1]) {\n      after = newStrokes[1]\n      this.translator.applyToSymbol(after, this.strokeSpaceWidth, 0)\n    }\n    return {\n      before: newStrokes[0],\n      after\n    }\n  }\n\n  protected computeSplitStrokeInGroup(gestureStroke: IIStroke, group: IISymbolGroup, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): IISymbolGroup[]\n  {\n    const newGroups: IISymbolGroup[] = []\n    const symbolsBefore: TIISymbol[] = []\n    const symbolsAfter: TIISymbol[] = []\n\n    const strokeIdToSplit = subStrokes[0].fullStrokeId\n\n    group.children.forEach(gs =>\n    {\n      if (gs.id === strokeIdToSplit) {\n        const subStroke = this.computeSplitStroke(gs as IIStroke, subStrokes)\n        if (subStroke.before) {\n          symbolsBefore.push(subStroke.before)\n        }\n        if (subStroke.after) {\n          symbolsAfter.push(subStroke.after)\n        }\n      }\n      else if (gs.bounds.xMid < gestureStroke.bounds.xMid) {\n        symbolsBefore.push(gs)\n      }\n      else if (gs.bounds.xMid > gestureStroke.bounds.xMid) {\n        this.translator.applyToSymbol(gs, this.strokeSpaceWidth, 0)\n        symbolsAfter.push(gs)\n      }\n    })\n\n    if (symbolsBefore.length) {\n      newGroups.push(new IISymbolGroup(symbolsBefore, group.style))\n    }\n    if (symbolsAfter.length) {\n      newGroups.push(new IISymbolGroup(symbolsAfter, group.style))\n    }\n    return newGroups\n  }\n\n  protected computeChangesOnSplitStroke(gestureStroke: IIStroke, strokeIdToSplit: string, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolToSplit = this.model.getRootSymbol(strokeIdToSplit)\n    if (symbolToSplit?.type === SymbolType.Group) {\n      const newGroups = this.computeSplitStrokeInGroup(gestureStroke, symbolToSplit, subStrokes)\n      replaced.newSymbols.push(...newGroups)\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Stroke) {\n      const newStrokes = this.computeSplitStroke(symbolToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Recognized) {\n      const strokesToSplit = symbolToSplit.strokes.find(s => s.id === strokeIdToSplit)!\n      const strokesBefore = symbolToSplit.strokes.filter(s => s.id !== strokeIdToSplit && s.bounds.xMid < gestureStroke.bounds.xMid)\n      const strokesAfter = symbolToSplit.strokes.filter(s => s.id !== strokeIdToSplit && s.bounds.xMid > gestureStroke.bounds.xMid)\n      const newStrokes = this.computeSplitStroke(strokesToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(...strokesBefore, newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after, ...strokesAfter)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    if (symbolsAfterGestureInRow.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitGroup(gestureStroke: IIStroke, groupToSplit: IISymbolGroup): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const groupSymbolsBefore = groupToSplit.children.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const groupsSymbolsAfter = groupToSplit.children.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(groupToSplit)\n    if (groupSymbolsBefore.length) {\n      const groupBefore = new IISymbolGroup(groupSymbolsBefore.map(s => s.clone()), groupToSplit.style)\n      groupBefore.decorators = groupToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(groupBefore)\n    }\n    if (groupsSymbolsAfter.length) {\n      const grouAfter = new IISymbolGroup(groupsSymbolsAfter.map(s => s.clone()), groupToSplit.style)\n      grouAfter.decorators = groupToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(grouAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(grouAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== groupToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitStrokeText(gestureStroke: IIStroke, strokeTextToSplit: IIRecognizedText): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const strokesBefore = strokeTextToSplit.strokes.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const strokesAfter = strokeTextToSplit.strokes.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(strokeTextToSplit)\n    if (strokesBefore.length) {\n      const strokeTextBefore = new IIRecognizedText(strokesBefore.map(s => s.clone()), strokeTextToSplit, strokeTextToSplit.style)\n      strokeTextBefore.decorators = strokeTextToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(strokeTextBefore)\n    }\n    if (strokesAfter.length) {\n      const strokeTextAfter = new IIRecognizedText(strokesAfter.map(s => s.clone()), strokeTextToSplit, strokeTextToSplit.style)\n      strokeTextAfter.decorators = strokeTextToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(strokeTextAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(strokeTextAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== strokeTextToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitText(gestureStroke: IIStroke, textToSplit: IIText): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const charsBefore = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 <= gestureStroke.bounds.xMid)\n    const charsAfter = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 > gestureStroke.bounds.xMid)\n    const newTexts: IIText[] = []\n    if (charsBefore.length && charsAfter.length) {\n      const textBefore = new IIText(charsBefore, textToSplit.point, Box.createFromBoxes(charsBefore.map(c => c.bounds)))\n      this.texter.setBounds(textBefore)\n      newTexts.push(textBefore)\n      const pointAfter: TPoint = {\n        x: textBefore.point.x + textBefore.bounds.width + this.texter.getSpaceWidth(computeAverage(textBefore.chars.map(c => c.fontSize))),\n        y: textBefore.point.y\n      }\n      const textAfter = new IIText(charsAfter, pointAfter, Box.createFromBoxes(charsAfter.map(c => c.bounds)))\n      this.texter.setBounds(textAfter)\n      newTexts.push(textAfter)\n      replaced.newSymbols = newTexts\n      replaced.oldSymbols = [textToSplit]\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== gestureStroke.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  async applyInsertGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyInsertGesture\", { gestureStroke, gesture })\n\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n    const textToSplit = symbolsRow.find(s => s.type === SymbolType.Text && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IIText | undefined\n    const groupToSplit = symbolsRow.find(s => s.type === SymbolType.Group && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IISymbolGroup | undefined\n    const strokeTextToSplit = symbolsRow.find(s => s.type === SymbolType.Recognized && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IIRecognizedText | undefined\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid > s.bounds.xMax)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n\n    let changes: TIIHistoryChanges | undefined\n    if (gesture.strokeIds.length && gesture.subStrokes?.length) {\n      changes = this.computeChangesOnSplitStroke(gestureStroke, gesture.strokeIds[0], gesture.subStrokes)\n    }\n    else if (groupToSplit) {\n      changes = this.computeChangesOnSplitGroup(gestureStroke, groupToSplit)\n    }\n    else if (textToSplit) {\n      changes = this.computeChangesOnSplitText(gestureStroke, textToSplit)\n    }\n    else if (strokeTextToSplit) {\n      changes = this.computeChangesOnSplitStrokeText(gestureStroke, strokeTextToSplit)\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n      let translateX = 0\n      if (symbolsBeforeGestureInRow.length) {\n        translateX = Math.min(...symbolsBeforeGestureInRow.map(s => s.bounds.xMin)) - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      }\n\n      switch (this.insertAction) {\n        case InsertAction.LineBreak:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: this.rowHeight })\n          if (symbolsBelow.length) {\n            translate.push({ symbols: symbolsBelow, tx: 0, ty: this.rowHeight })\n          }\n          break\n        case InsertAction.Insert:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth * 2, ty: 0 })\n          break\n      }\n      changes = { translate }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsBelow.length && this.insertAction === InsertAction.LineBreak) {\n      changes = { translate: [{ symbols: symbolsBelow, tx: 0, ty: this.rowHeight }] }\n    }\n\n    if (changes) {\n      this.history.push(this.model, changes)\n      const promises: Promise<void>[] = []\n      if (changes.translate?.length) {\n        promises.push(...changes.translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n      }\n      if (changes.replaced?.newSymbols.length) {\n        promises.push(this.editor.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false))\n      }\n      await Promise.all(promises)\n    }\n  }\n\n  async applyUnderlineGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyUnderlineGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyUnderlineGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n\n    const changes: TIIHistoryChanges = { decorator: [] }\n    const symbolIds: string[] = []\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(sym.type) && !symbolIds.includes(sym.id)) {\n        const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n        const underline = new IIDecorator(DecoratorKind.Underline, this.editor.penStyle)\n        const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Underline)\n        const added = index === -1\n        // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n        added ? symWithDec.decorators.push(underline) : symWithDec.decorators.splice(index, 1)\n        this.model.updateSymbol(symWithDec)\n        this.renderer.drawSymbol(symWithDec)\n        changes.decorator?.push({ symbol: symWithDec, decorator: underline, added })\n        symbolIds.push(symWithDec.id)\n      }\n    })\n    if (changes.decorator?.length) {\n      this.history.push(this.model, changes)\n    }\n  }\n\n  async applyStrikeThroughGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void | TIISymbol[]>\n  {\n    this.#logger.debug(\"applyStrikeThroughGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyStrikeThroughGesture\", \"Unable to apply strikethrough because there are no strokes\")\n      return\n    }\n    switch (this.strikeThroughAction) {\n      case StrikeThroughAction.Draw: {\n        const changes: TIIHistoryChanges = { decorator: [] }\n        const symbolIds: string[] = []\n        gesture.strokeIds.forEach(id =>\n        {\n          const symbol = this.model.getRootSymbol(id)\n          if (symbol && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(symbol.type) && !symbolIds.includes(symbol.id)) {\n            const symWithDec = symbol as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const strikethrough = new IIDecorator(DecoratorKind.Strikethrough, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Strikethrough)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(strikethrough) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator?.push({ symbol: symWithDec, decorator: strikethrough, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        if (changes.decorator?.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case StrikeThroughAction.Erase: {\n        return this.editor.removeSymbols(gesture.strokeIds)\n      }\n      default:\n        this.#logger.warn(\"#applyStrikeThroughGesture\", `Unknow OnStrikeThrough: ${ this.strikeThroughAction }, values allowed are: ${ StrikeThroughAction.Draw }, ${ StrikeThroughAction.Erase }`)\n        break\n    }\n  }\n\n  async apply(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"apply\", { gestureStroke, gesture })\n    this.editor.updateSymbolsStyle([gestureStroke.id], { opacity: (gestureStroke.style.opacity || 1) / 2 }, false)\n    await this.editor.removeSymbol(gestureStroke.id, false)\n    await this.editor.synchronizeStrokesWithJIIX()\n    switch (gesture.gestureType) {\n      case \"UNDERLINE\":\n        await this.applyUnderlineGesture(gestureStroke, gesture)\n        break\n      case \"SCRATCH\":\n        await this.applyScratch(gestureStroke, gesture)\n        break\n      case \"JOIN\":\n        await this.applyJoinGesture(gestureStroke, gesture)\n        break\n      case \"INSERT\":\n        await this.applyInsertGesture(gestureStroke, gesture)\n        break\n      case \"STRIKETHROUGH\":\n        await this.applyStrikeThroughGesture(gestureStroke, gesture)\n        break\n      case \"SURROUND\":\n        await this.applySurroundGesture(gestureStroke, gesture)\n        break\n      default:\n        this.#logger.warn(\"apply\", `Gesture unknow: ${ gesture.gestureType }`)\n        break\n    }\n    this.editor.event.emitGestured({ gestureType: gesture.gestureType, stroke: gestureStroke })\n    this.editor.svgDebugger.apply()\n    return Promise.resolve()\n  }\n\n  async getGestureFromContextLess(gestureStroke: IIStroke): Promise<TGesture | undefined>\n  {\n    const gesture = await this.recognizer.recognizeGesture(gestureStroke)\n    if (!gesture) return\n    switch (gesture.gestureType) {\n      case \"surround\": {\n        const hasSymbolsToSurrond = this.model.symbols.some(s =>\n        {\n          if (s.id !== gestureStroke.id && gestureStroke.bounds.contains(s.bounds)) {\n            return this.surroundAction === SurroundAction.Select || [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(s.type)\n          }\n          return false\n        })\n        if (hasSymbolsToSurrond) {\n          return {\n            gestureType: \"SURROUND\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"left-right\":\n      case \"right-left\": {\n        const symbolsToUnderline = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id && [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height * 3 / 4, s.bounds.y + s.bounds.height * 5 / 4)\n        })\n        if (symbolsToUnderline.length) {\n          return {\n            gestureType: \"UNDERLINE\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToUnderline.map(s => s.id),\n          }\n        }\n        const symbolsToStrikeThrough = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id && [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height / 4, s.bounds.y + s.bounds.height * 3 / 4)\n        })\n        if (symbolsToStrikeThrough.length) {\n          return {\n            gestureType: \"STRIKETHROUGH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToStrikeThrough.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"scratch\": {\n        const symbolsToErase = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id &&\n            (\n              gestureStroke.bounds.overlaps(s.bounds) && [SymbolType.Stroke, SymbolType.Text, SymbolType.Group].includes(s.type) ||\n              gestureStroke.bounds.contains(s.bounds) && [SymbolType.Shape, SymbolType.Edge].includes(s.type)\n            )\n        })\n\n        if (symbolsToErase.length) {\n          return {\n            gestureType: \"SCRATCH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToErase.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"bottom-top\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"JOIN\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"top-bottom\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"INSERT\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"none\":\n      default:\n        return\n    }\n  }\n}\n","/**\n * @group Menu\n */\nexport type TSubMenuParam =\n{\n  trigger: HTMLElement,\n  menuTitle?: string,\n  subMenu: HTMLElement,\n  position: \"top\" | \"left\" | \"right\" | \"right-top\" | \"bottom\" | \"bottom-left\" | \"bottom-right\"\n}\n\n/**\n * @group Menu\n */\nexport class IIMenuSub {\n  element: HTMLDivElement\n  content: HTMLElement\n\n  constructor(param : TSubMenuParam) {\n    this.element = document.createElement(\"div\")\n    this.element.classList.add(\"sub-menu\")\n    this.element.appendChild(param.trigger)\n    this.content = document.createElement(\"div\")\n    if(param.menuTitle) {\n      const menuTitleElement = document.createElement(\"h3\")\n      menuTitleElement.classList.add(\"ms-menu-title\")\n      menuTitleElement.textContent = param.menuTitle\n      this.content.appendChild(menuTitleElement)\n    }\n    this.content.classList.add(\"sub-menu-content\", param.position)\n    this.content.appendChild(param.subMenu)\n    this.element.appendChild(this.content)\n\n    param.trigger.addEventListener(\"pointerdown\", () => this.toggle())\n    document.addEventListener(\"pointerdown\", (e) => {\n      if (!this.element.contains(e.target as HTMLElement)) {\n        this.close()\n      }\n    })\n  }\n\n  open(): void {\n    this.content.classList.add(\"open\")\n  }\n\n  close(): void {\n    this.content.classList.remove(\"open\")\n  }\n\n  toggle(): void {\n    this.content.classList.toggle(\"open\")\n  }\n\n  unwrap(): void {\n    this.content.classList.remove(\"sub-menu-content\")\n    this.element.insertAdjacentElement(\"beforebegin\", this.content)\n    this.element.style.display = \"none\"\n  }\n\n  wrap(): void {\n    this.content.classList.add(\"sub-menu-content\")\n    this.element.appendChild(this.content)\n    this.element.style.display = \"block\"\n  }\n\n}\n","import menuIcon from \"../assets/svg/menu.svg\"\nimport languageIcon from \"../assets/svg/language.svg\"\nimport trashIcon from \"../assets/svg/trash.svg\"\nimport undoIcon from \"../assets/svg/undo.svg\"\nimport redoIcon from \"../assets/svg/redo.svg\"\nimport translateIcon from \"../assets/svg/translate.svg\"\nimport gestureIcon from \"../assets/svg/spock-hand-gesture.svg\"\nimport guideIcon from \"../assets/svg/orthogonal-view.svg\"\nimport snapIcon from \"../assets/svg/arrow-to-dot.svg\"\nimport debugIcon from \"../assets/svg/wolf.svg\"\nimport downloadIcon from \"../assets/svg/download.svg\"\nimport uploadIcon from \"../assets/svg/upload.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { IIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemButtonList, TMenuItemSelect } from \"./IIMenu\"\nimport { TIISymbol } from \"../symbol\"\nimport { InsertAction, StrikeThroughAction, SurroundAction } from \"../gesture\"\nimport { IIMenuSub, TSubMenuParam } from \"./IIMenuSub\"\nimport { getAvailableLanguageList, PartialDeep } from \"../utils\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuAction extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLElement\n  menuLanguage!: IIMenuSub\n  menuClear?: HTMLButtonElement\n  menuUndo?: HTMLButtonElement\n  menuRedo?: HTMLButtonElement\n  menuConvert?: HTMLButtonElement\n\n  guideGaps = [\n    { label: \"S\", value: \"25\" },\n    { label: \"M\", value: \"50\" },\n    { label: \"L\", value: \"100\" },\n    { label: \"XL\", value: \"150\" },\n  ]\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-action\")\n  {\n    super()\n    this.id = id\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get isMobile(): boolean\n  {\n    return this.editor.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuClear(): HTMLElement\n  {\n    this.menuClear = document.createElement(\"button\")\n    this.menuClear.id = `${ this.id }-clear`\n    this.menuClear.classList.add(\"ms-menu-button\", \"square\")\n    this.menuClear.innerHTML = trashIcon\n    this.menuClear.addEventListener(\"pointerup\", () =>\n    {\n      this.#logger.info(`${ this.id }.clear`)\n      this.editor.clear()\n    })\n    return this.menuClear\n  }\n\n  protected createMenuLanguage(): HTMLElement\n  {\n    const triggerBtn = document.createElement(\"button\")\n    triggerBtn.id = `${ this.id }-language-trigger`\n    triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n    triggerBtn.innerHTML = languageIcon\n\n    const select = document.createElement(\"select\")\n    select.classList.add(\"select-language\")\n    select.id = `${ this.id }-language`\n    getAvailableLanguageList(this.editor.configuration)\n      .then(json =>\n      {\n        const languages = json.result as { [key: string]: string }\n        Object.keys(languages).forEach(key =>\n        {\n          const selected = key === this.editor.configuration.recognition.lang\n          const opt = new Option(languages[key], key, selected, selected)\n          select.appendChild(opt)\n        })\n      })\n    select.addEventListener(\"change\", (e) =>\n    {\n      this.#logger.info(`${ this.id }.selectLanguage`)\n      const value = (e.target as HTMLInputElement).value\n      this.editor.changeLanguage(value)\n    })\n    const params: TSubMenuParam = {\n      trigger: triggerBtn,\n      subMenu: select,\n      position: \"bottom-right\"\n    }\n    this.menuLanguage = new IIMenuSub(params)\n    return this.menuLanguage.element\n  }\n\n  protected createMenuUndo(): HTMLElement\n  {\n    this.menuUndo = document.createElement(\"button\")\n    this.menuUndo.id = `${ this.id }-undo`\n    this.menuUndo.classList.add(\"ms-menu-button\", \"square\")\n    this.menuUndo.innerHTML = undoIcon\n    this.menuUndo.addEventListener(\"pointerup\", async () =>\n    {\n      this.#logger.info(`${ this.id }.undo`)\n      await this.editor.undo()\n    })\n    return this.menuUndo\n  }\n\n  protected createMenuRedo(): HTMLElement\n  {\n    this.menuRedo = document.createElement(\"button\")\n    this.menuRedo.id = `${ this.id }-redo`\n    this.menuRedo.classList.add(\"ms-menu-button\", \"square\")\n    this.menuRedo.innerHTML = redoIcon\n    this.menuRedo.addEventListener(\"pointerup\", async () =>\n    {\n      this.#logger.info(`${ this.id }.redo`)\n      await this.editor.redo()\n    })\n    return this.menuRedo\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.menuConvert = document.createElement(\"button\")\n    this.menuConvert.id = `${ this.id }-convert`\n    this.menuConvert.classList.add(\"ms-menu-button\", \"square\")\n    this.menuConvert.innerHTML = translateIcon\n    this.menuConvert.addEventListener(\"pointerup\", () =>\n    {\n      this.#logger.info(`${ this.id }.convert`)\n      this.editor.convert()\n    })\n    return this.menuConvert\n  }\n\n  protected createMenuGesture(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-gesture`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = gestureIcon\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const surroundActionValues: { label: string, value: string }[] = []\n    for (const key in SurroundAction) {\n      const value = SurroundAction[key as keyof typeof SurroundAction]\n      surroundActionValues.push({ label: key, value })\n    }\n    const strikeThroughActionValues: { label: string, value: string }[] = []\n    for (const key in StrikeThroughAction) {\n      const value = StrikeThroughAction[key as keyof typeof StrikeThroughAction]\n      strikeThroughActionValues.push({ label: key, value })\n    }\n    const splitActionValues: { label: string, value: string }[] = []\n    for (const key in InsertAction) {\n      const value = InsertAction[key as keyof typeof InsertAction]\n      splitActionValues.push({ label: key, value })\n    }\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-gesture-detect`,\n        label: \"Detect gesture\",\n        initValue: this.editor.writer.detectGesture,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-detect`, { value })\n          this.editor.writer.detectGesture = value\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-surround`,\n        label: \"On surround\",\n        values: surroundActionValues,\n        initValue: this.editor.gesture.surroundAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-surround`, { value })\n          this.editor.gesture.surroundAction = value as SurroundAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-strikethrough`,\n        label: \"On strikethrough\",\n        values: strikeThroughActionValues,\n        initValue: this.editor.gesture.strikeThroughAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-strikethrough`, { value })\n          this.editor.gesture.strikeThroughAction = value as StrikeThroughAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-insert`,\n        label: \"On insert\",\n        values: splitActionValues,\n        initValue: this.editor.gesture.insertAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-InsertAction`, { value })\n          this.editor.gesture.insertAction = value as InsertAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Gesture\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuGuide(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-guide`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = guideIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect | TMenuItemButtonList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-guide-enable`,\n        label: \"Show guide\",\n        initValue: this.editor.configuration.rendering.guides.enable,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-enable`, { value })\n          this.editor.configuration.rendering.guides.enable = value as boolean\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-guide-type`,\n        label: \"Guide style\",\n        values: [\n          { label: \"Line\", value: \"line\" },\n          { label: \"Grid\", value: \"grid\" },\n          { label: \"Point\", value: \"point\" },\n        ],\n        initValue: this.editor.configuration.rendering.guides.type,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-type`, { value })\n          this.editor.configuration.rendering.guides.type = value as (\"line\" | \"grid\" | \"point\")\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n      {\n        type: \"list\",\n        id: `${ this.id }-guide-size`,\n        label: \"Guide style\",\n        values: this.guideGaps,\n        initValue: this.editor.configuration.rendering.guides.gap.toString(),\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-size`, { value })\n          this.editor.configuration.rendering.guides.gap = +value\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Guide\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuSnap(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-snap`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = snapIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-guide`,\n        label: \"Snap to guide\",\n        initValue: this.editor.snaps.configuration.guide,\n        callback: (value) => this.editor.snaps.configuration.guide = value\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-element`,\n        label: \"Snap to element\",\n        initValue: this.editor.snaps.configuration.symbol,\n        callback: (value) => this.editor.snaps.configuration.symbol = value\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-snap-angle`,\n        label: \"Snap angle\",\n        values: [\n          { label: \"None\", value: \"0\" },\n          { label: \"10\", value: \"10\" },\n          { label: \"30\", value: \"30\" },\n          { label: \"45\", value: \"45\" },\n          { label: \"90\", value: \"90\" },\n          { label: \"180\", value: \"180\" },\n        ],\n        initValue: this.editor.snaps.configuration.angle.toString(),\n        callback: (angle) => this.editor.snaps.configuration.angle = +angle\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Snap\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuDebug(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-debug`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = debugIcon\n\n    const menuItems: TMenuItemBoolean[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-box`,\n        label: \"Show bounding box\",\n        initValue: this.editor.svgDebugger.boundingBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.boundingBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-recognition-box`,\n        label: \"Show recognition box\",\n        initValue: this.editor.svgDebugger.recognitionBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.recognitionBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-item-box`,\n        label: \"Show recognition item box\",\n        initValue: this.editor.svgDebugger.recognitionItemBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.recognitionItemBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-snap-points`,\n        label: \"Show snap points\",\n        initValue: this.editor.svgDebugger.snapPointsVisibility,\n        callback: (debug) => this.editor.svgDebugger.snapPointsVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-vertices`,\n        label: \"Show vertices\",\n        initValue: this.editor.svgDebugger.verticesVisibility,\n        callback: (debug) => this.editor.svgDebugger.verticesVisibility = debug\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Debug\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = downloadIcon\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () =>\n        {\n          this.editor.downloadAsJson()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () =>\n        {\n          this.editor.downloadAsSVG()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () =>\n        {\n          this.editor.downloadAsPNG()\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Export\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected async readFileAsText(file: File): Promise<string>\n  {\n    return new Promise((resolve, reject) =>\n    {\n      const reader = new FileReader()\n      reader.onerror = reject;\n      reader.onload = () => {\n        resolve(reader.result as string)\n      }\n      if (file) {\n        reader.readAsText(file)\n      }\n    })\n  }\n\n  protected createMenuImport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-import`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = uploadIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const importInput = document.createElement(\"input\")\n    importInput.type = \"file\"\n    importInput.accept = \".json\"\n    importInput.multiple = false\n    importInput.addEventListener(\"change\", () => {\n      importBtn.disabled = !importInput.files?.length\n    })\n\n    subMenuWrapper.appendChild(importInput)\n    const importBtn = document.createElement(\"button\")\n    importBtn.classList.add(\"ms-menu-button\")\n    importBtn.innerText = \"Import\"\n    importBtn.disabled = true\n    subMenuWrapper.appendChild(importBtn)\n    importBtn.addEventListener(\"pointerup\", async (e) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (importInput.files?.length) {\n        const fileString = await this.readFileAsText(importInput.files[0])\n        const symbols = JSON.parse(fileString) as PartialDeep<TIISymbol>[]\n        await this.editor.createSymbols(symbols)\n        importInput.value = \"\"\n        importBtn.disabled = true\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Import\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  protected closeAllSubMenu(): void\n  {\n    this.wrapper?.querySelectorAll(\".open\").forEach(e => e.classList.remove(\"open\"))\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.action.enable) {\n      const menuTrigger = document.createElement(\"button\")\n      menuTrigger.id = this.id\n      menuTrigger.classList.add(\"ms-menu-button\", \"square\")\n      menuTrigger.innerHTML = menuIcon\n\n      const subMenuWrapper = document.createElement(\"div\")\n      subMenuWrapper.classList.add(\"ms-menu-colmun\")\n      subMenuWrapper.appendChild(this.createMenuGesture())\n      subMenuWrapper.appendChild(this.createMenuGuide())\n      subMenuWrapper.appendChild(this.createMenuSnap())\n      subMenuWrapper.appendChild(this.createMenuDebug())\n      subMenuWrapper.appendChild(this.createMenuImport())\n      subMenuWrapper.appendChild(this.createMenuExport())\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-left\", \"ms-menu-row\")\n      this.wrapper.appendChild(new IIMenuSub({ trigger: menuTrigger, subMenu: subMenuWrapper, position: \"bottom\" }).element)\n      this.wrapper.appendChild(this.createMenuLanguage())\n      this.wrapper.appendChild(this.createMenuClear())\n      this.wrapper.appendChild(this.createMenuUndo())\n      this.wrapper.appendChild(this.createMenuRedo())\n      this.wrapper.appendChild(this.createMenuConvert())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  update(): void\n  {\n    if (this.menuLanguage) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      this.isMobile ? this.menuLanguage.wrap() : this.menuLanguage.unwrap()\n    }\n    if (this.menuClear) {\n      this.menuClear.disabled = this.editor.history.context.empty\n    }\n    if (this.menuUndo) {\n      this.menuUndo.disabled = !this.editor.history.context.canUndo\n    }\n    if (this.menuRedo) {\n      this.menuRedo.disabled = !this.editor.history.context.canRedo\n    }\n    if (this.menuConvert) {\n      this.menuConvert.disabled = !this.editor.extractStrokesFromSymbols(this.model.symbols).length\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.menuClear = undefined\n      this.menuUndo = undefined\n      this.menuRedo = undefined\n      this.menuConvert = undefined\n    }\n  }\n}\n","import pencilIcon from \"../assets/svg/edit-pencil.svg\"\nimport cursorIcon from \"../assets/svg/frame-select.svg\"\nimport eraseIcon from \"../assets/svg/erase.svg\"\nimport handIcon from \"../assets/svg/drag-hand-gesture.svg\"\nimport rectangleIcon from \"../assets/svg/rectangle.svg\"\nimport rhombusIcon from \"../assets/svg/rhombus.svg\"\nimport circleIcon from \"../assets/svg/circle.svg\"\nimport ellipseIcon from \"../assets/svg/ellipse.svg\"\nimport triangleIcon from \"../assets/svg/triangle.svg\"\nimport lineIcon from \"../assets/svg/linear.svg\"\nimport arrowIcon from \"../assets/svg/linear-arrow.svg\"\nimport doubleArrowIcon from \"../assets/svg/linear-double-arrow.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIMenu } from \"./IIMenu\"\nimport { IIMenuSub } from \"./IIMenuSub\"\nimport { TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuTool extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLDivElement\n  writeBtn?: HTMLButtonElement\n  menuSelect?: HTMLButtonElement\n  menuMove?: HTMLButtonElement\n  menuErase?: HTMLButtonElement\n  menuShape?: HTMLButtonElement\n  subMenuShape?: {\n    rectangle: HTMLButtonElement,\n    circle: HTMLButtonElement,\n    triangle: HTMLButtonElement,\n    ellipse: HTMLButtonElement\n    rhombus: HTMLButtonElement\n  }\n  menuEdge?: HTMLButtonElement\n  subMenuEdge?: {\n    line: HTMLButtonElement,\n    arrow: HTMLButtonElement,\n    doubleArrow: HTMLButtonElement,\n  }\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-tool\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  protected createMenuWrite(): HTMLElement\n  {\n    this.writeBtn = document.createElement(\"button\")\n    this.writeBtn.id = `${this.id}-write-pencil`\n    this.writeBtn.classList.add(\"ms-menu-button\", \"square\")\n    this.writeBtn.innerHTML = pencilIcon\n    this.writeBtn.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.writeBtn!.classList.add(\"active\")\n      this.editor.tool = EditorTool.Write\n      this.editor.writer.tool = EditorWriteTool.Pencil\n    })\n    return this.writeBtn\n  }\n\n  protected createMenuMove(): HTMLElement\n  {\n    this.menuMove = document.createElement(\"button\")\n    this.menuMove.id = `${this.id}-move`\n    this.menuMove.classList.add(\"ms-menu-button\", \"square\")\n    this.menuMove.innerHTML = handIcon\n    this.menuMove.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuMove!.classList.add(\"active\")\n      this.editor.tool = EditorTool.Move\n    })\n    return this.menuMove\n  }\n\n  protected createMenuSelect(): HTMLElement\n  {\n    this.menuSelect = document.createElement(\"button\")\n    this.menuSelect.id = `${this.id}-select`\n    this.menuSelect.classList.add(\"ms-menu-button\", \"square\")\n    this.menuSelect.innerHTML = cursorIcon\n    this.menuSelect.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuSelect!.classList.add(\"active\")\n      this.editor.tool = EditorTool.Select\n    })\n    return this.menuSelect\n  }\n\n  protected createMenuErase(): HTMLElement\n  {\n    this.menuErase = document.createElement(\"button\")\n    this.menuErase.id = `${this.id}-erase`\n    this.menuErase.classList.add(\"ms-menu-button\", \"square\")\n    this.menuErase.innerHTML = eraseIcon\n    this.menuErase.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuErase!.classList.add(\"active\")\n      this.editor.tool = EditorTool.Erase\n    })\n    return this.menuErase\n  }\n\n  protected createShapeSubMenu(icon: string, tool: EditorWriteTool): HTMLButtonElement\n  {\n    const subMenuShape = document.createElement(\"button\")\n    subMenuShape.id = `${this.id}-write-shape-${tool}`\n    subMenuShape.classList.add(\"ms-menu-button\", \"square\")\n    subMenuShape.innerHTML = icon\n    subMenuShape.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.editor.tool = EditorTool.Write\n      this.editor.writer.tool = tool\n      subMenuShape.classList.add(\"active\")\n      this.menuShape!.innerHTML = icon\n      this.menuShape!.classList.add(\"active\")\n      const subMenuContent = this.menuShape!.nextSibling\n      if (subMenuContent) {\n        (subMenuContent as HTMLElement).classList.remove(\"open\")\n      }\n    })\n    return subMenuShape\n  }\n\n  protected createMenuShape(): HTMLElement\n  {\n    this.menuShape = document.createElement(\"button\")\n    this.menuShape.id = `${this.id}-write-shape`\n    this.menuShape.classList.add(\"ms-menu-button\", \"square\")\n    this.menuShape.innerHTML = rectangleIcon\n    this.subMenuShape = {\n      circle: this.createShapeSubMenu(circleIcon, EditorWriteTool.Circle),\n      rectangle: this.createShapeSubMenu(rectangleIcon, EditorWriteTool.Rectangle),\n      triangle: this.createShapeSubMenu(triangleIcon, EditorWriteTool.Triangle),\n      ellipse: this.createShapeSubMenu(ellipseIcon, EditorWriteTool.Ellipse),\n      rhombus: this.createShapeSubMenu(rhombusIcon, EditorWriteTool.Rhombus),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-shape-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-shape\")\n    subMenuContent.appendChild(this.subMenuShape.rectangle)\n    subMenuContent.appendChild(this.subMenuShape.circle)\n    subMenuContent.appendChild(this.subMenuShape.ellipse)\n    subMenuContent.appendChild(this.subMenuShape.triangle)\n    subMenuContent.appendChild(this.subMenuShape.rhombus)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuShape,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new IIMenuSub(params).element\n  }\n\n  protected createEdgeSubMenu(square: string, tool: EditorWriteTool): HTMLButtonElement\n  {\n    const subMenuEdge = document.createElement(\"button\")\n    subMenuEdge.id = `${this.id}-write-edge-${tool}`\n    subMenuEdge.classList.add(\"ms-menu-button\", \"square\")\n    subMenuEdge.innerHTML = square\n    subMenuEdge.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.editor.tool = EditorTool.Write\n      this.editor.writer.tool = tool\n      subMenuEdge.classList.add(\"active\")\n      this.menuEdge!.innerHTML = square\n      this.menuEdge!.classList.add(\"active\")\n      const subMenuContent = this.menuEdge!.nextSibling\n      if (subMenuContent) {\n        (subMenuContent as HTMLElement).classList.remove(\"open\")\n      }\n    })\n    return subMenuEdge\n  }\n\n  protected createMenuEdge(): HTMLElement\n  {\n    this.menuEdge = document.createElement(\"button\")\n    this.menuEdge.id = `${this.id}-write-edge`\n    this.menuEdge.classList.add(\"ms-menu-button\", \"square\")\n    this.menuEdge.innerHTML = lineIcon\n    this.subMenuEdge = {\n      line: this.createEdgeSubMenu(lineIcon, EditorWriteTool.Line),\n      arrow: this.createEdgeSubMenu(arrowIcon, EditorWriteTool.Arrow),\n      doubleArrow: this.createEdgeSubMenu(doubleArrowIcon, EditorWriteTool.DoubleArrow),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-edge-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-edge\")\n    subMenuContent.appendChild(this.subMenuEdge.line)\n    subMenuContent.appendChild(this.subMenuEdge.arrow)\n    subMenuContent.appendChild(this.subMenuEdge.doubleArrow)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuEdge,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new IIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  update(): void\n  {\n    this.unselectAll()\n    switch (this.editor.tool) {\n      case EditorTool.Erase:\n        this.menuErase?.classList.add(\"active\")\n        break;\n      case EditorTool.Move:\n        this.menuMove?.classList.add(\"active\")\n        break;\n      case EditorTool.Select:\n        this.menuSelect?.classList.add(\"active\")\n        break;\n      case EditorTool.Write:\n        switch (this.editor.writer.tool) {\n          case EditorWriteTool.Circle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.circle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Ellipse:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.ellipse?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Triangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.triangle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Rectangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.rectangle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Line:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.line?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Arrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.arrow?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.DoubleArrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.doubleArrow?.classList.add(\"active\")\n            break;\n          default:\n            this.writeBtn?.classList.add(\"active\")\n            break;\n        }\n        break;\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.tool.enable) {\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-bottom\", \"ms-menu-row\")\n\n      this.wrapper.appendChild(this.createMenuWrite())\n      this.wrapper.appendChild(this.createMenuMove())\n      this.wrapper.appendChild(this.createMenuSelect())\n      this.wrapper.appendChild(this.createMenuErase())\n      this.wrapper.appendChild(this.createMenuEdge())\n      this.wrapper.appendChild(this.createMenuShape())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.writeBtn = undefined\n      this.menuSelect = undefined\n      this.menuMove = undefined\n      this.menuErase = undefined\n      this.menuShape = undefined\n      this.subMenuShape = undefined\n      this.menuEdge = undefined\n      this.subMenuEdge = undefined\n      this.wrapper = undefined\n    }\n  }\n}\n","import styleIcon from \"../assets/svg/palette.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { SymbolType, TIISymbol } from \"../symbol\"\nimport { IIMenu, TMenuItemColorList } from \"./IIMenu\"\nimport { IIMenuSub } from \"./IIMenuSub\"\nimport { TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuStyle extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLDivElement\n  subMenu?: IIMenuSub\n  triggerBtn?: HTMLButtonElement\n  menuColorStroke?: HTMLDivElement\n  menuColorFill?: HTMLDivElement\n  menuThickness?: HTMLDivElement\n  menuFontSize?: HTMLDivElement\n  menuFontWeight?: HTMLDivElement\n  menuStrokeOpacity?: HTMLDivElement\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-style\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.model.symbolsSelected\n  }\n\n  get writeShape(): boolean\n  {\n    return ![EditorWriteTool.Arrow, EditorWriteTool.DoubleArrow, EditorWriteTool.Line, EditorWriteTool.Pencil].includes(this.editor.writer.tool)\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get isMobile(): boolean\n  {\n    return this.editor.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuStroke(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0]?.color ? symbolsStyles[0]?.color : this.editor.penStyle.color as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Colors\",\n      id: `${ this.id }-color`,\n      fill: false,\n      values: this.colors,\n      initValue: color,\n      callback: (color) =>\n      {\n        this.editor.penStyle = { color }\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { color })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorStroke = this.createWrapCollapsible(menuColor, \"Colors\")\n    this.menuColorStroke.id = `${ this.id }-color`\n    return this.menuColorStroke\n  }\n\n  protected createMenuColorFill(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0].color ? symbolsStyles[0].color : this.editor.penStyle.color as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Fill\",\n      id: `${ this.id }-fill`,\n      fill: true,\n      values: this.colors,\n      initValue: color,\n      callback: (fill) =>\n      {\n        this.editor.penStyle = { fill }\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { fill })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorFill = this.createWrapCollapsible(menuColor, \"Fill\")\n    this.menuColorFill.id = `${ this.id }-fill`\n    return this.menuColorFill\n  }\n\n  protected createMenuThickness(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-thickness-list`\n    wrapper.classList.add(\"ms-menu-row\", \"thickness-list\")\n\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqWidth = symbolsStyles.length && symbolsStyles.every(st => st.width === symbolsStyles[0].width)\n    const width = hasUniqWidth ? symbolsStyles[0].width : this.editor.penStyle.width\n\n    this.thicknessList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-thickness-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (width === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        this.editor.penStyle = { width: size.value }\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (this.symbolsSelected.length) {\n          this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { width: size.value })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuThickness = this.createWrapCollapsible(wrapper, \"Thickness\")\n    this.menuThickness.id = `${ this.id }-thickness`\n    return this.menuThickness\n  }\n\n  protected createMenuFontSize(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-size-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-size-list\")\n\n    this.fontSizeList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-size-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (this.editor.configuration.fontStyle.size === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (size.value === \"auto\") {\n          this.editor.configuration.fontStyle.size = \"auto\"\n        }\n        else {\n          const fontSize = (size.value as number)\n          this.editor.configuration.fontStyle.size = fontSize\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractText().length))\n          this.editor.updateTextFontStyle(textSymbols.map(s => s.id), { fontSize: fontSize * this.rowHeight })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontSize = this.createWrapCollapsible(wrapper, \"Font size\")\n    this.menuFontSize.id = `${ this.id }-font-size`\n    return this.menuFontSize\n  }\n\n  protected createMenuFontWeight(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-weight-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-weight-list\")\n\n    this.fontWeightList.forEach((weight) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-weight-${ weight.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"center\")\n      btn.textContent = weight.label\n      if (this.editor.configuration.fontStyle.weight === weight.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        this.editor.configuration.fontStyle.weight = weight.value as \"auto\" | \"normal\" | \"bold\"\n        if (this.editor.configuration.fontStyle.weight !== \"auto\") {\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractText().length))\n          this.editor.updateTextFontStyle(textSymbols.map(s => s.id), { fontWeight: this.editor.configuration.fontStyle.weight })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontWeight = this.createWrapCollapsible(wrapper, \"Font weight\")\n    this.menuFontWeight.id = `${ this.id }-font-weight`\n    return this.menuFontWeight\n  }\n\n  protected createMenuOpacity(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqOpacity = symbolsStyles.length && symbolsStyles.every(st => st.opacity === symbolsStyles[0]?.opacity)\n    const currentOpacity = (hasUniqOpacity && symbolsStyles[0]?.opacity ? symbolsStyles[0]?.opacity : (this.editor.penStyle.opacity || 1)) * 100 as number\n\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-opacity-input-wrapper`\n    const input = document.createElement(\"input\")\n    input.id = `${ this.id }-opacity-input`\n    input.setAttribute(\"name\", `opacity`)\n    input.setAttribute(\"type\", \"range\")\n    input.setAttribute(\"step\", \"1\")\n    input.setAttribute(\"min\", \"1\")\n    input.setAttribute(\"max\", \"100\")\n    wrapper.appendChild(input)\n\n    const output = document.createElement(\"output\")\n    output.setAttribute(\"for\", `opacity`)\n    output.innerHTML = currentOpacity ? `${ currentOpacity }` : \"-\"\n    wrapper.appendChild(output)\n\n    if (currentOpacity) {\n      input.setAttribute(\"value\", currentOpacity.toString())\n    }\n    input.addEventListener(\"input\", (evt) =>\n    {\n      const value = (evt.target as HTMLInputElement).value as unknown as number\n      output.innerHTML = `${ value }%`\n      this.editor.penStyle = { opacity: value / 100 }\n      if (this.symbolsSelected.length) {\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { opacity: value / 100 })\n      }\n    })\n    this.menuStrokeOpacity = this.createWrapCollapsible(wrapper, \"Opacity\")\n    this.menuStrokeOpacity.id = `${ this.id }-opacity`\n    return this.menuStrokeOpacity\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.style.enable) {\n      this.triggerBtn = document.createElement(\"button\")\n      this.triggerBtn.id = this.id\n      this.triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n      this.triggerBtn.innerHTML = styleIcon\n\n      const subMenuContent = document.createElement(\"div\")\n      subMenuContent.classList.add(\"ms-menu-colmun\")\n      subMenuContent.appendChild(this.createMenuStroke())\n      subMenuContent.appendChild(this.createMenuColorFill())\n      subMenuContent.appendChild(this.createMenuThickness())\n      subMenuContent.appendChild(this.createMenuFontSize())\n      subMenuContent.appendChild(this.createMenuFontWeight())\n      subMenuContent.appendChild(this.createMenuOpacity())\n\n      const params: TSubMenuParam = {\n        trigger: this.triggerBtn,\n        subMenu: subMenuContent,\n        position: \"bottom-left\",\n      }\n      this.subMenu = new IIMenuSub(params)\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-right\")\n      this.wrapper.appendChild(this.subMenu.element)\n      layer.appendChild(this.wrapper)\n      this.update()\n    }\n  }\n\n  update(): void\n  {\n    if (this.subMenu) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      this.isMobile ? this.subMenu.wrap() : this.subMenu.unwrap()\n    }\n\n    if (this.editor.tool === EditorTool.Write) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        this.menuColorFill.style.display = this.writeShape ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else if (this.editor.tool === EditorTool.Select) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        const shapeSelected = this.model.symbolsSelected.length && this.model.symbolsSelected.some(s => s.type === SymbolType.Shape)\n        this.menuColorFill.style.display = shapeSelected ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else {\n      this.hide()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.subMenu = undefined\n      this.triggerBtn = undefined\n      this.menuColorStroke = undefined\n      this.menuColorFill = undefined\n      this.menuThickness = undefined\n      this.menuFontSize = undefined\n      this.menuFontWeight = undefined\n      this.menuStrokeOpacity = undefined\n    }\n  }\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\nimport { SELECTION_MARGIN } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { DecoratorKind, IIDecorator, IIRecognizedText, IIStroke, IISymbolGroup, IIText, RecognizedKind, SymbolType, TIISymbol } from \"../symbol\"\nimport { IIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemColorList } from \"./IIMenu\"\nimport { createUUID } from \"../utils\"\nimport { IIMenuSub, TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\n/**\n * @group Menu\n */\nexport class IIMenuContext extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLElement\n  editMenu?: HTMLDivElement\n  editInput?: HTMLInputElement\n  editSaveBtn?: HTMLButtonElement\n  reorderMenu?: HTMLDivElement\n  decoratorMenu?: HTMLDivElement\n  menuExport?: HTMLDivElement\n  duplicateBtn?: HTMLButtonElement\n  groupBtn?: HTMLButtonElement\n  convertBtn?: HTMLButtonElement\n  removeBtn?: HTMLButtonElement\n\n  position: {\n    x: number,\n    y: number,\n    scrollTop: number,\n    scrollLeft: number\n  }\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-context\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.position = { x: 0, y: 0, scrollLeft: 0, scrollTop: 0 }\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.editor.model.symbolsSelected\n  }\n\n  get haveSymbolsSelected(): boolean\n  {\n    return this.symbolsSelected.length > 0\n  }\n\n  get symbolsDecorable(): (IIStroke | IIText | IISymbolGroup | IIRecognizedText)[]\n  {\n    return this.symbolsSelected.filter(s => [SymbolType.Stroke, SymbolType.Text, SymbolType.Group].includes(s.type) || (s.type === SymbolType.Recognized && s.kind === RecognizedKind.Text)) as (IIStroke | IIText | IISymbolGroup | IIRecognizedText)[]\n  }\n\n  get showDecorator(): boolean\n  {\n    return this.symbolsDecorable.length > 0\n  }\n\n  protected createMenuEdit(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-edit-trigger`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Edit\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    this.editInput = document.createElement(\"input\")\n    subMenuWrapper.appendChild(this.editInput)\n    this.editSaveBtn = document.createElement(\"button\")\n    this.editSaveBtn.classList.add(\"ms-menu-button\")\n    this.editSaveBtn.innerText = \"Save\"\n    subMenuWrapper.appendChild(this.editSaveBtn)\n    this.editSaveBtn.addEventListener(\"pointerdown\", async (e) =>\n    {\n      e.stopPropagation()\n      const textSymbol = this.editor.model.symbolsSelected.find(s => s.type === SymbolType.Text) as IIText\n      if (textSymbol) {\n        const firstChar = textSymbol.chars[0]\n        textSymbol.chars = []\n        for (let i = 0; i < this.editInput!.value.length; i++) {\n          textSymbol.chars.push({\n            label: this.editInput!.value.charAt(i),\n            id: createUUID(),\n            color: firstChar.color,\n            fontSize: firstChar.fontSize,\n            fontWeight: firstChar.fontWeight,\n            bounds: firstChar.bounds\n          })\n        }\n        await this.editor.updateSymbol(textSymbol)\n        this.editor.selector.resetSelectedGroup([textSymbol])\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.editMenu = new IIMenuSub(params).element\n\n    return this.editMenu\n  }\n\n  protected createMenuDuplicate(): HTMLElement\n  {\n    this.duplicateBtn = document.createElement(\"button\")\n    this.duplicateBtn.id = `${ this.id }-duplicate`\n    this.duplicateBtn.textContent = \"Duplicate\"\n    this.duplicateBtn.classList.add(\"ms-menu-button\")\n    this.duplicateBtn.addEventListener(\"pointerup\", async () =>\n    {\n      const symbolsToDuplicate = this.symbolsSelected\n\n      const updateDeepIdInGroup = (gr: IISymbolGroup) =>\n      {\n        gr.children.forEach(s =>\n        {\n          s.id = s.id.slice(0, -36) + `-${ createUUID() }`\n          switch (s.type) {\n            case SymbolType.Group:\n              updateDeepIdInGroup(s)\n              break\n            case SymbolType.Recognized:\n              s.strokes.forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n              break\n          }\n        })\n      }\n      const duplicatedSymbols = symbolsToDuplicate.map(s =>\n      {\n        const clone = s.clone()\n        while (this.editor.model.symbols.find(s => s.id === clone.id)) {\n          clone.id = clone.id.slice(0, -36) + `-${ createUUID() }`\n          if (clone.type === SymbolType.Group) {\n            updateDeepIdInGroup(clone)\n          }\n          else if (clone.type === SymbolType.Recognized) {\n            clone.strokes.forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n          }\n        }\n        clone.selected = true\n        this.editor.translator.applyToSymbol(clone, SELECTION_MARGIN, SELECTION_MARGIN)\n        return clone\n      })\n\n      this.editor.unselectAll()\n      await this.editor.addSymbols(duplicatedSymbols)\n      this.editor.selector.drawSelectedGroup(duplicatedSymbols)\n    })\n    return this.duplicateBtn\n  }\n\n  protected createMenuGroup(): HTMLElement\n  {\n    this.groupBtn = document.createElement(\"button\")\n    this.groupBtn.id = `${ this.id }-duplicate`\n    this.groupBtn.textContent = \"Group\"\n    this.groupBtn.classList.add(\"ms-menu-button\")\n    this.groupBtn.addEventListener(\"pointerup\", async () =>\n    {\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        const symbols = this.editor.ungroupSymbol(this.symbolsSelected[0] as IISymbolGroup)\n        this.editor.select(symbols.map(s => s.id))\n      }\n      else {\n        const symbols = this.symbolsSelected.slice()\n        this.editor.unselectAll()\n        const group = this.editor.groupSymbols(symbols)\n        group.selected = true\n        this.editor.select([group.id])\n      }\n    })\n    return this.groupBtn\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.convertBtn = document.createElement(\"button\")\n    this.convertBtn.id = `${ this.id }-convert`\n    this.convertBtn.textContent = \"Convert\"\n    this.convertBtn.classList.add(\"ms-menu-button\")\n    this.convertBtn.addEventListener(\"pointerup\", () => this.editor.convertSymbols(this.symbolsSelected))\n    return this.convertBtn\n  }\n\n  protected createMenuRemove(): HTMLButtonElement\n  {\n    this.removeBtn = document.createElement(\"button\")\n    this.removeBtn.id = `${ this.id }-remove`\n    this.removeBtn.textContent = \"Remove\"\n    this.removeBtn.classList.add(\"ms-menu-button\")\n    this.removeBtn.addEventListener(\"pointerup\", async () =>\n    {\n      this.editor.selector.removeSelectedGroup()\n      await this.editor.removeSymbols(this.symbolsSelected.map(s => s.id))\n    })\n    return this.removeBtn\n  }\n\n  protected createMenuReorder(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-reorder`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Reorder\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-first`,\n        label: \"Bring to front\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"last\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-forward`,\n        label: \"Bring forward\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"forward\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-backward`,\n        label: \"Send backward\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"backward\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-last`,\n        label: \"Send to back\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected.slice().reverse(), \"first\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.reorderMenu = new IIMenuSub(params).element\n    return this.reorderMenu\n  }\n\n  protected createDecoratorSubMenu(label: string, kind: DecoratorKind): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator-${ kind }`\n    trigger.classList.add(\"ms-menu-button\")\n    const labelEL = document.createElement(\"span\")\n    labelEL.innerText = label\n    trigger.appendChild(labelEL)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: (TMenuItemBoolean | TMenuItemColorList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-decorator-${ kind }-enable`,\n        label: \"Enable\",\n        initValue: false,\n        callback: (enable) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            if (enable) {\n              if (!s.decorators.some(d => d.kind === kind)) {\n                s.decorators.push(new IIDecorator(kind, this.editor.penStyle))\n              }\n            }\n            else {\n              const decoIndex = s.decorators.findIndex(d => d.kind === kind)\n              if (decoIndex > -1) {\n                s.decorators.splice(decoIndex, 1)\n              }\n            }\n            this.editor.model.updateSymbol(s)\n            this.editor.renderer.drawSymbol(s)\n          })\n\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n          {\n            (b as HTMLButtonElement).disabled = !enable\n            b.classList.remove(\"active\")\n          })\n          if (enable) {\n            document.querySelector(`#${ this.id }-decorator-${ kind }-color button`)?.classList.add(\"active\")\n          }\n        }\n      },\n      {\n        type: \"colors\",\n        label: \"Colors\",\n        id: `${ this.id }-decorator-${ kind }-color`,\n        fill: false,\n        values: this.colors.filter((_c, i) => !(i % 4)),\n        initValue: this.colors[0],\n        disabled: true,\n        callback: (color) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            const deco = s.decorators.find(d => d.kind === kind)\n            if (deco) {\n              deco.style.color = color\n              this.editor.model.updateSymbol(s)\n              this.editor.renderer.drawSymbol(s)\n            }\n          })\n        },\n      }\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    return this.decoratorMenu = new IIMenuSub(params).element\n  }\n\n  protected createMenuDecorator(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Decorator\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Hightlight\", DecoratorKind.Highlight))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Surround\", DecoratorKind.Surround))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Underline\", DecoratorKind.Underline))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Strikethrough\", DecoratorKind.Strikethrough))\n\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.decoratorMenu = new IIMenuSub(params).element\n    return this.decoratorMenu\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Export\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () => this.editor.downloadAsJson(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () => this.editor.downloadAsSVG(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () => this.editor.downloadAsPNG(this.haveSymbolsSelected)\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.menuExport = new IIMenuSub(params).element\n    return this.menuExport\n  }\n\n  protected createMenuSelectAll(): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.id = `${ this.id }-duplicate`\n    btn.textContent = \"Select all\"\n    btn.classList.add(\"ms-menu-button\")\n    btn.addEventListener(\"pointerup\", async () => this.editor.selectAll())\n    return btn\n  }\n\n  protected updateDecoratorSubMenu(): void\n  {\n    if (this.showDecorator) {\n      this.decoratorMenu?.style.removeProperty(\"display\")\n\n      Object.values(DecoratorKind).forEach(kind =>\n      {\n        const checkbox = document.getElementById(`${ this.id }-decorator-${ kind }-enable`) as HTMLInputElement\n        if (checkbox) {\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(e => e.classList.remove(\"active\"))\n          const decos = this.symbolsDecorable.flatMap(s => s.decorators).filter(d => d.kind === kind)\n\n          if (decos.length && decos.every(d => d.style.color === decos[0].style.color)) {\n            const btnToActivate = document.getElementById(`${ this.id }-decorator-${ kind }-color-${ decos[0].style.color?.replace(\"#\", \"\") }-btn`)\n            btnToActivate?.classList.add(\"active\")\n          }\n\n          if (this.symbolsDecorable.filter(s => s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = true\n\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n            checkbox.indeterminate = false\n          }\n          else if (this.symbolsDecorable.filter(s => !s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = false\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = true\n            })\n            checkbox.indeterminate = false\n          }\n          else {\n            checkbox.setAttribute(\"indeterminate\", \"true\")\n            checkbox.indeterminate = true\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n          }\n        }\n\n      })\n    }\n    else {\n      this.decoratorMenu?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  protected updateGroupMenu(): void\n  {\n    if (this.groupBtn && this.haveSymbolsSelected) {\n      this.groupBtn.style.removeProperty(\"display\")\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        this.groupBtn.textContent = \"UnGroup\"\n      }\n      else {\n        this.groupBtn.textContent = \"Group\"\n      }\n    }\n    else {\n      this.groupBtn?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  update(): void\n  {\n    this.wrapper?.style.setProperty(\"left\", `${ this.position.x - this.position.scrollLeft }px`)\n    this.wrapper?.style.setProperty(\"top\", `${ this.position.y - this.position.scrollTop }px`)\n\n    if (this.haveSymbolsSelected) {\n      const textSymbol = this.editor.model.symbolsSelected.find(s => s.type === SymbolType.Text)\n      if (this.editMenu && this.editInput && this.editor.model.symbolsSelected.length === 1 && textSymbol) {\n        this.editMenu.style.removeProperty(\"display\")\n        this.editInput.value = (textSymbol as IIText).label\n      }\n      else {\n        this.editMenu?.style.setProperty(\"display\", \"none\")\n      }\n\n      if (this.editor.extractStrokesFromSymbols(this.symbolsSelected).length) {\n        this.convertBtn?.style.removeProperty(\"display\")\n      }\n      else {\n        this.convertBtn?.style.setProperty(\"display\", \"none\")\n      }\n\n\n      this.reorderMenu?.style.removeProperty(\"display\")\n      this.duplicateBtn?.style.removeProperty(\"display\")\n      this.removeBtn?.style.removeProperty(\"display\")\n      this.menuExport?.style.removeProperty(\"display\")\n    }\n    else {\n      this.editMenu?.style.setProperty(\"display\", \"none\")\n      this.convertBtn?.style.setProperty(\"display\", \"none\")\n      this.reorderMenu?.style.setProperty(\"display\", \"none\")\n      this.duplicateBtn?.style.setProperty(\"display\", \"none\")\n      this.removeBtn?.style.setProperty(\"display\", \"none\")\n      this.menuExport?.style.setProperty(\"display\", \"none\")\n    }\n    this.updateDecoratorSubMenu()\n    this.updateGroupMenu()\n  }\n\n  render(layer: HTMLElement): void\n  {\n    this.wrapper = document.createElement(\"div\")\n    this.wrapper.id = `${ this.id }-wrapper`\n    this.wrapper.classList.add(\"ms-menu\", \"ms-menu-context\")\n    this.wrapper.appendChild(this.createMenuEdit())\n    this.wrapper.appendChild(this.createMenuDecorator())\n    this.wrapper.appendChild(this.createMenuReorder())\n    this.wrapper.appendChild(this.createMenuExport())\n    this.wrapper.appendChild(this.createMenuConvert())\n    this.wrapper.appendChild(this.createMenuGroup())\n    this.wrapper.appendChild(this.createMenuDuplicate())\n    this.wrapper.appendChild(this.createMenuRemove())\n    this.wrapper.appendChild(this.createMenuSelectAll())\n    this.wrapper.style.setProperty(\"display\", \"none\")\n    layer.appendChild(this.wrapper)\n\n    this.editor.layers.rendering.addEventListener(\"scroll\", () =>\n    {\n      this.position.scrollLeft = this.editor.layers.rendering.scrollLeft || 0\n      this.position.scrollTop = this.editor.layers.rendering.scrollTop || 0\n      this.update()\n    })\n  }\n\n  show(): void\n  {\n    this.update()\n    this.wrapper?.style.setProperty(\"display\", \"block\")\n  }\n\n  hide(): void\n  {\n    this.wrapper?.style.setProperty(\"display\", \"none\")\n  }\n\n  destroy(): void\n  {\n    while (this.wrapper?.lastChild) {\n      this.wrapper.removeChild(this.wrapper.lastChild)\n    }\n    this.wrapper?.remove()\n  }\n}\n","\n/**\n * @group Menu\n */\nexport type TMenuConfiguration = {\n  enable: boolean,\n  style: {\n    enable: boolean,\n  }\n  tool: {\n    enable: boolean,\n  }\n  action: {\n    enable: boolean,\n  }\n  context: {\n    enable: boolean,\n  }\n}\n\n/**\n * @group Menu\n * @source\n */\nexport const DefaultMenuConfiguration: TMenuConfiguration = {\n  enable: true,\n  style: {\n    enable: true\n  },\n  tool: {\n    enable: true\n  },\n  action: {\n    enable: true\n  },\n  context: {\n    enable: true\n  },\n}\n","import style from \"./menu.css\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { IIMenuAction } from \"./IIMenuAction\"\nimport { IIMenuTool } from \"./IIMenuTool\"\nimport { IIMenuContext } from \"./IIMenuContext\"\nimport { IIMenuStyle } from \"./IIMenuStyle\"\n\n/**\n * @group Manager\n */\nexport class IIMenuManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n  editor: InteractiveInkEditor\n  layer?: HTMLElement\n  action: IIMenuAction\n  tool: IIMenuTool\n  context: IIMenuContext\n  style: IIMenuStyle\n\n  constructor(editor: InteractiveInkEditor, custom?: { style?: IIMenuStyle, tool?: IIMenuTool, action?: IIMenuAction, context?: IIMenuContext })\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n\n    if (custom?.style) {\n      const CustomMenuStyle = custom.style as unknown as typeof IIMenuStyle\n      this.style = new CustomMenuStyle(this.editor)\n    }\n    else {\n      this.style = new IIMenuStyle(this.editor)\n    }\n    if (custom?.tool) {\n      const CustomMenuTool = custom.tool as unknown as typeof IIMenuTool\n      this.tool = new CustomMenuTool(this.editor)\n    }\n    else {\n      this.tool = new IIMenuTool(this.editor)\n    }\n    if (custom?.action) {\n      const CustomMenuAction = custom.action as unknown as typeof IIMenuAction\n      this.action = new CustomMenuAction(this.editor)\n    }\n    else {\n      this.action = new IIMenuAction(this.editor)\n    }\n    if (custom?.context) {\n      const CustomMenuAction = custom.context as unknown as typeof IIMenuContext\n      this.context = new CustomMenuAction(this.editor)\n    }\n    else {\n      this.context = new IIMenuContext(this.editor)\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.enable) {\n      this.layer = layer\n\n      const styleElement = document.createElement(\"style\")\n      styleElement.appendChild(document.createTextNode(style as string))\n      this.layer.prepend(styleElement)\n\n      if (this.editor.configuration.menu.action.enable) {\n        this.action.render(this.layer)\n      }\n      if (this.editor.configuration.menu.style.enable) {\n        this.style.render(this.layer)\n      }\n      if (this.editor.configuration.menu.tool.enable) {\n        this.tool.render(this.layer)\n      }\n      if (this.editor.configuration.menu.context.enable) {\n        this.context.render(this.layer)\n      }\n    }\n  }\n\n  update(): void\n  {\n    this.action.update()\n    this.tool.update()\n    this.style.update()\n  }\n\n  show(): void\n  {\n    this.action.show()\n    this.tool.show()\n    this.style.show()\n  }\n\n  hide(): void\n  {\n    this.action.hide()\n    this.tool.hide()\n    this.style.hide()\n  }\n\n  destroy(): void\n  {\n    this.action.destroy()\n    this.tool.destroy()\n    this.style.destroy()\n  }\n}\n","import { PartialDeep } from \"../utils\"\n\n/**\n * @group Snap\n */\nexport type TSnapConfiguration = {\n  guide: boolean\n  symbol: boolean\n  angle: number\n}\n\n/**\n * @group Snap\n * @source\n */\nexport const DefaultSnapConfiguration: TSnapConfiguration = {\n  guide: true,\n  symbol: true,\n  angle: 0\n}\n\n/**\n * @group Snap\n */\nexport class SnapConfiguration implements TSnapConfiguration\n{\n  guide: boolean\n  symbol: boolean\n  angle: number\n\n  constructor(config? : PartialDeep<TSnapConfiguration>)\n  {\n    this.symbol = config?.symbol !== undefined ? config.symbol : DefaultSnapConfiguration.symbol\n    this.guide = config?.guide !== undefined ? config.guide : DefaultSnapConfiguration.guide\n    this.angle = config?.angle !== undefined ? config.angle : DefaultSnapConfiguration.angle\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, TPoint, TSegment } from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { SVGRendererConst } from \"../renderer/svg/SVGRendererConst\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PartialDeep } from \"../utils\"\nimport { SnapConfiguration, TSnapConfiguration } from \"./IISnapConfiguration\"\n\n/**\n * @group Snap\n */\nexport type TSnapNudge = TPoint\n\n/**\n * @group Snap\n */\nexport type TSnapLineInfos = {\n  nudge: TSnapNudge,\n  verticales: TSegment[]\n  horizontales: TSegment[]\n}\n\n/**\n * @group Snap\n */\nexport class IISnapManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n  configuration: SnapConfiguration\n\n  constructor(editor: InteractiveInkEditor, config?: PartialDeep<TSnapConfiguration>)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.configuration = new SnapConfiguration(config)\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get selectionSnapPoints(): TPoint[]\n  {\n    return Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.snapPoints)).snapPoints\n  }\n\n  get otherSnapPoints(): TPoint[]\n  {\n    const selectSymbolIds = this.model.symbolsSelected.map(s => s.id)\n    return this.model.symbols.filter(s => !selectSymbolIds.includes(s.id)).flatMap(s => s.snapPoints)\n  }\n\n  get snapThreshold(): number\n  {\n    return this.editor.configuration.rendering.guides.gap / 2\n  }\n\n  protected getNearestVerticalGuide(x: number): number\n  {\n    if (this.renderer.verticalGuides.length) {\n      return this.renderer.verticalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - x) < Math.abs(prev - x) ? curr : prev)\n      })\n    }\n    return x\n  }\n\n  protected getNearestHorizontalGuide(y: number): number\n  {\n    if (this.renderer.horizontalGuides.length) {\n      return this.renderer.horizontalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - y) < Math.abs(prev - y) ? curr : prev)\n      })\n    }\n    return y\n  }\n\n  protected getGuidePointToSnap(point: TPoint): TPoint\n  {\n    return {\n      x: this.getNearestVerticalGuide(point.x),\n      y: this.getNearestHorizontalGuide(point.y)\n    }\n  }\n\n  drawSnapToElementLines(lines: TSegment[]): void\n  {\n    const attrs = {\n      role: \"snap-to-element\",\n      fill: \"transparent\",\n      stroke: \"blue\",\n      \"stroke-width\": \"2\",\n      style: SVGRendererConst.noSelection,\n      \"marker-start\": `url(#${ SVGRendererConst.crossMarker })`,\n      \"marker-end\": `url(#${ SVGRendererConst.crossMarker })`\n    }\n    lines.forEach(seg =>\n    {\n      this.renderer.drawLine(seg.p1, seg.p2, attrs)\n    })\n  }\n\n  clearSnapToElementLines(): void\n  {\n    this.renderer.clearElements({ attrs: { role: \"snap-to-element\" } })\n  }\n\n  protected getSnapLinesInfos(sourcePoints: TPoint[], targetPoints: TPoint[]): TSnapLineInfos\n  {\n    const infos: TSnapLineInfos = {\n      nudge: {\n        x: Infinity,\n        y: Infinity\n      },\n      verticales: [],\n      horizontales: [],\n    }\n    if (!sourcePoints.length || !targetPoints.length) return infos\n\n    sourcePoints.forEach(p1 =>\n    {\n      targetPoints.forEach(p2 =>\n      {\n        if (this.snapThreshold > Math.abs(p2.x - p1.x)) {\n          if (Math.abs(infos.nudge.x) > Math.abs(p2.x - p1.x)) {\n            infos.nudge.x = p2.x - p1.x\n            infos.verticales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.x === p2.x - p1.x) {\n            infos.verticales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n        if (this.snapThreshold > Math.abs(p2.y - p1.y)) {\n          if (Math.abs(infos.nudge.y) > Math.abs(p2.y - p1.y)) {\n            infos.nudge.y = p2.y - p1.y\n            infos.horizontales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.y === p2.y - p1.y) {\n            infos.horizontales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n      })\n    })\n\n    return infos\n  }\n\n  snapResize(point: TPoint, horizontal = true, vertical = true): TPoint\n  {\n    this.clearSnapToElementLines()\n    if (!this.configuration.symbol && !this.configuration.guide) return point\n\n    let localPoint: TPoint = {\n      x: Infinity,\n      y: Infinity\n    }\n    if (this.configuration.guide) {\n      localPoint = this.getGuidePointToSnap(point)\n    }\n    const snapLines: TSegment[] = []\n\n    if (this.configuration.symbol) {\n      const snapLinesInfos = this.getSnapLinesInfos([point], this.otherSnapPoints)\n      if (horizontal && Math.abs(snapLinesInfos.nudge.x) <= Math.abs(point.x - localPoint.x)) {\n        localPoint.x = point.x + snapLinesInfos.nudge.x\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (vertical && Math.abs(snapLinesInfos.nudge.y) <= Math.abs(point.y - localPoint.y)) {\n        localPoint.y = point.y + snapLinesInfos.nudge.y\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n\n    if (localPoint.x === Infinity) localPoint.x = point.x\n    if (localPoint.y === Infinity) localPoint.y = point.y\n\n    snapLines.forEach(s => s.p1 = localPoint)\n    this.drawSnapToElementLines(snapLines)\n    return localPoint\n  }\n\n  snapTranslate(tx: number, ty: number): TSnapNudge\n  {\n    this.clearSnapToElementLines()\n    const nudge: TSnapNudge = { x: tx, y: ty }\n    if (!this.configuration.symbol && !this.configuration.guide) return nudge\n\n    const selectionSymbolPoints = this.selectionSnapPoints.map(p => ({ x: p.x + tx, y: p.y + ty }))\n\n    let lastDeltaX = Infinity\n    let lastDeltaY = Infinity\n\n    if (this.configuration.guide) {\n      selectionSymbolPoints.forEach(p =>\n      {\n        const gridPoint = this.getGuidePointToSnap(p)\n        if (lastDeltaX > Math.abs(gridPoint.x - p.x)) {\n          nudge.x = gridPoint.x - p.x + tx\n          lastDeltaX = Math.abs(gridPoint.x - p.x)\n        }\n        if (lastDeltaY > Math.abs(gridPoint.y - p.y)) {\n          nudge.y = gridPoint.y - p.y + ty\n          lastDeltaY = Math.abs(gridPoint.y - p.y)\n        }\n      })\n    }\n\n    const snapLines: TSegment[] = []\n    if (this.configuration.symbol) {\n      const snapLinesInfos = this.getSnapLinesInfos(selectionSymbolPoints, this.otherSnapPoints)\n      if (lastDeltaX >= Math.abs(snapLinesInfos.nudge.x) && snapLinesInfos.verticales.length) {\n        nudge.x = snapLinesInfos.nudge.x + tx\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (lastDeltaY >= Math.abs(snapLinesInfos.nudge.y) && snapLinesInfos.horizontales.length) {\n        nudge.y = snapLinesInfos.nudge.y + ty\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n    if (snapLines.length) {\n      snapLines.forEach(l =>\n      {\n        l.p1.x += nudge.x - tx\n        l.p1.y += nudge.y - ty\n      })\n      this.drawSnapToElementLines(snapLines)\n    }\n    return nudge\n  }\n\n  snapRotation(angleDegree: number): number\n  {\n    if (this.configuration.angle > 0) {\n      return this.configuration.angle * Math.round(angleDegree / this.configuration.angle)\n    }\n    return angleDegree\n  }\n}\n","import { mergeDeep, PartialDeep } from \"../utils\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultMenuConfiguration, TMenuConfiguration } from \"../menu\"\nimport { DefaultRecognizerWebSocketConfiguration, RecognizerWebSocketConfiguration, TRecognitionWebSocketConfiguration, TRecognizerWebSocketConfiguration, TServerWebsocketConfiguration } from \"../recognizer\"\nimport { DefaultIIRendererConfiguration, TIIRendererConfiguration } from \"../renderer\"\nimport { DefaultGestureConfiguration, TGestureConfiguration } from \"../gesture\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaultSnapConfiguration, SnapConfiguration, TSnapConfiguration } from \"../snap\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkEditorConfiguration = TEditorConfiguration & TRecognizerWebSocketConfiguration & {\n \"undo-redo\": THistoryConfiguration\n  rendering: TIIRendererConfiguration\n  grabber: TGrabberConfiguration\n  menu: TMenuConfiguration\n  penStyle: TStyle,\n  fontStyle: {\n    size: number | \"auto\"\n    weight: \"bold\" | \"normal\" | \"auto\"\n  }\n  gesture: TGestureConfiguration\n  snap: TSnapConfiguration\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInteractiveInkEditorConfiguration: TInteractiveInkEditorConfiguration = {\n  server: DefaultRecognizerWebSocketConfiguration.server,\n  recognition: DefaultRecognizerWebSocketConfiguration.recognition,\n  menu: DefaultMenuConfiguration,\n  rendering: DefaultIIRendererConfiguration,\n  logger: DefaultLoggerConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n\n  penStyle: DefaultStyle,\n  fontStyle: {\n    size: \"auto\",\n    weight: \"auto\",\n  },\n  gesture: DefaultGestureConfiguration,\n  snap: DefaultSnapConfiguration\n}\n\n/**\n * @group Editor\n */\nexport class InteractiveInkEditorConfiguration implements TInteractiveInkEditorConfiguration\n{\n  grabber: TGrabberConfiguration\n  logger: TLoggerConfiguration\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  menu: TMenuConfiguration\n\n  penStyle: TStyle\n  fontStyle: {\n    size: number | \"auto\"\n    weight: \"bold\" | \"normal\" | \"auto\"\n  }\n  gesture: TGestureConfiguration\n  snap: TSnapConfiguration\n\n  constructor(configuration?: PartialDeep<TInteractiveInkEditorConfiguration>)\n  {\n    const { server, recognition } =  new RecognizerWebSocketConfiguration(configuration)\n    this.recognition = recognition\n    this.server = server\n\n    this.grabber = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.grabber, configuration?.grabber)\n    this.logger = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.logger, configuration?.logger)\n    this.rendering = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.rendering, configuration?.rendering)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInteractiveInkEditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.menu = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.menu, configuration?.menu)\n    this.gesture = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.gesture, configuration?.gesture)\n    this.snap = new SnapConfiguration(configuration?.snap)\n\n    this.penStyle = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.penStyle, configuration?.penStyle)\n    this.fontStyle = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.fontStyle, configuration?.fontStyle)\n  }\n}\n","import { EditorTool, SELECTION_MARGIN } from \"../Constants\"\nimport { JIIXEdgeKind, JIIXELementType, JIIXNodeKind, IIModel, TExport, TJIIXStrokeItem } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIDecorator,\n  TIIEdge,\n  IIEdgeArc,\n  IIEdgeLine,\n  IIEdgePolyLine,\n  TIIShape,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIShapePolygon,\n  IIStroke,\n  IIRecognizedText,\n  IISymbolGroup,\n  IIText,\n  ShapeKind,\n  SymbolType,\n  TIISymbol,\n  convertPartialStrokesToOIStrokes,\n  TIIRecognized,\n  IIRecognizedLine,\n  IIRecognizedPolyLine,\n  IIRecognizedArc,\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { SVGRenderer, SVGBuilder, TIIRendererConfiguration } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport\n{\n  IIConversionManager,\n  IIWriterManager,\n  IISelectionManager,\n  IIResizeManager,\n  IIRotationManager,\n  IITranslateManager,\n  IITextManager,\n  EraseManager,\n  IIDebugSVGManager,\n  IIMoveManager,\n} from \"../manager\"\nimport { RecognizedKind, IIRecognizedCircle, IIRecognizedEllipse, IIRecognizedPolygon } from \"../symbol\"\nimport { IIHistoryManager, TIIHistoryBackendChanges, TIIHistoryChanges, THistoryContext } from \"../history\"\nimport { PartialDeep, convertMillimeterToPixel, mergeDeep } from \"../utils\"\nimport { IIMenuAction, IIMenuManager, IIMenuStyle, IIMenuTool } from \"../menu\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InteractiveInkEditorConfiguration, TInteractiveInkEditorConfiguration } from \"./InteractiveInkEditorConfiguration\"\nimport { IIGestureManager } from \"../gesture\"\nimport { IISnapManager } from \"../snap\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkEditorOptions = PartialDeep<EditorOptionsBase &\n  {\n    configuration: TInteractiveInkEditorConfiguration\n  }> &\n  {\n    override?: {\n      recognizer?: RecognizerWebSocket\n      menu?: {\n        style?: IIMenuStyle\n        tool?: IIMenuTool\n        action?: IIMenuAction\n      }\n    }\n  }\n/**\n * @group Editor\n */\nexport class InteractiveInkEditor extends AbstractEditor\n{\n  #configuration: InteractiveInkEditorConfiguration\n  #model: IIModel\n  #tool: EditorTool = EditorTool.Write\n  #layerUITimer?: ReturnType<typeof setTimeout>\n  #recognizeStrokeTimer?: ReturnType<typeof setTimeout>\n\n  renderer: SVGRenderer\n  recognizer: RecognizerWebSocket\n\n  #penStyle: TStyle\n\n  history: IIHistoryManager\n  writer: IIWriterManager\n  eraser: EraseManager\n  gesture: IIGestureManager\n  resizer: IIResizeManager\n  rotator: IIRotationManager\n  translator: IITranslateManager\n  converter: IIConversionManager\n  texter: IITextManager\n  selector: IISelectionManager\n  svgDebugger: IIDebugSVGManager\n  snaps: IISnapManager\n  move: IIMoveManager\n  menu: IIMenuManager\n\n  constructor(rootElement: HTMLElement, options?: TInteractiveInkEditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InteractiveInkEditorConfiguration(options?.configuration)\n    this.#penStyle = Object.assign({}, this.#configuration.penStyle)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options?.override.recognizer as unknown as typeof RecognizerWebSocket\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerWebSocket(this.#configuration)\n    }\n    this.recognizer.event.addErrorListener(this.manageError.bind(this))\n    this.recognizer.event.addExportedListener(this.event.emitExported.bind(this.event))\n    this.recognizer.event.addContentChangedListener(this.onContentChanged.bind(this))\n    this.recognizer.event.addSessionOpenedListener(this.event.emitSessionOpened.bind(this.event))\n    this.recognizer.event.addEndInitialization(this.layers.hideMessageModal.bind(this.layers))\n    this.recognizer.event.addIdleListener(this.updateLayerState.bind(this))\n\n    this.renderer = new SVGRenderer(this.#configuration.rendering)\n\n    this.history = new IIHistoryManager(this.#configuration[\"undo-redo\"], this.event)\n\n    this.writer = new IIWriterManager(this)\n    this.eraser = new EraseManager(this)\n    this.selector = new IISelectionManager(this)\n    this.move = new IIMoveManager(this)\n\n    this.gesture = new IIGestureManager(this, this.#configuration.gesture)\n    this.resizer = new IIResizeManager(this)\n    this.rotator = new IIRotationManager(this)\n    this.translator = new IITranslateManager(this)\n    this.converter = new IIConversionManager(this)\n    this.texter = new IITextManager(this)\n    this.svgDebugger = new IIDebugSVGManager(this)\n    this.snaps = new IISnapManager(this, this.#configuration.snap)\n    this.menu = new IIMenuManager(this, options?.override?.menu)\n\n    this.#model = new IIModel(this.#configuration.rendering.minWidth, this.#configuration.rendering.minHeight, this.configuration.rendering.guides.gap)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.recognizer.initialized.promise\n  }\n\n  //#region Properties\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.menu.tool.update()\n    this.setCursorStyle()\n    this.unselectAll()\n\n    this.eraser.detach()\n    this.selector.detach()\n    this.move.detach()\n    this.writer.detach()\n    switch (this.#tool) {\n      case EditorTool.Erase:\n        this.eraser.attach(this.layers.rendering)\n        break\n      case EditorTool.Select:\n        this.selector.attach(this.layers.rendering)\n        break\n      case EditorTool.Move:\n        this.move.attach(this.layers.rendering)\n        break\n      default:\n        this.writer.attach(this.layers.rendering)\n        break\n    }\n    this.event.emitToolChanged(i)\n  }\n\n  get model(): IIModel\n  {\n    return this.#model\n  }\n\n  get configuration(): InteractiveInkEditorConfiguration\n  {\n    return this.#configuration\n  }\n  set renderingConfiguration(renderingConfiguration: TIIRendererConfiguration)\n  {\n    this.configuration.rendering = mergeDeep(this.configuration.rendering, renderingConfiguration)\n    const height = Math.max(this.renderer.parent.clientHeight, this.configuration.rendering.minHeight)\n    const width = Math.max(this.renderer.parent.clientWidth, this.configuration.rendering.minWidth)\n    this.renderer.resize(height, width)\n    this.model.rowHeight = this.configuration.rendering.guides.gap\n    this.history.stack.forEach(i => i.model.rowHeight = this.model.rowHeight)\n    this.event.emitUIpdated()\n  }\n  //#endregion\n\n  //#region Style\n  get penStyle(): TStyle\n  {\n    return this.#penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TStyle>)\n  {\n    this.logger.info(\"set penStyle\", { penStyle })\n    this.#penStyle = Object.assign({}, this.#penStyle, penStyle)\n  }\n  //#endregion\n\n  protected updateLayerState(idle: boolean): void\n  {\n    this.event.emitIdle(idle)\n    this.layers.updateState(idle)\n  }\n\n  updateLayerUI(timeout: number = 500): void\n  {\n    clearTimeout(this.#layerUITimer)\n    this.#layerUITimer = setTimeout(() =>\n    {\n      this.menu.update()\n      this.svgDebugger.apply()\n      this.waitForIdle()\n      this.event.emitUIpdated()\n    }, timeout)\n  }\n\n  manageError(error: Error): void\n  {\n    this.layers.showMessageError(error)\n    this.event.emitError(error)\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.#tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n      case EditorTool.Select:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.add(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n      case EditorTool.Move:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.add(\"move\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n    }\n  }\n\n  protected async onContentChanged(undoRedoContext: THistoryContext): Promise<void>\n  {\n    clearTimeout(this.#recognizeStrokeTimer)\n    this.#recognizeStrokeTimer = setTimeout(async () =>\n    {\n      await this.synchronizeStrokesWithJIIX()\n      this.updateLayerUI(0)\n      this.event.emitChanged(undoRedoContext)\n    }, 500)\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n      this.tool = EditorTool.Write\n      this.renderer.init(this.layers.rendering)\n      this.menu.render(this.layers.ui.root)\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.model.rowHeight = this.configuration.rendering.guides.gap\n      this.history.init(this.model)\n\n      if(!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n      await this.recognizer.init()\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  async changeLanguage(code: string): Promise<void>\n  {\n    try {\n      this.logger.info(\"changeLanguage\", { code })\n      this.updateLayerState(false)\n      this.configuration.recognition.lang = code\n      await this.recognizer.newSession(this.configuration)\n      this.recognizer.addStrokes(this.extractStrokesFromSymbols(this.model.symbols), false)\n      await this.synchronizeStrokesWithJIIX(true)\n      this.layers.hideLoader()\n      this.event.emitLoaded()\n    }\n    catch (error) {\n      this.logger.error(\"changeLanguage\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  protected buildShape(partialShape: PartialDeep<TIIShape>): TIIShape\n  {\n    switch (partialShape.kind) {\n      case ShapeKind.Circle:\n        return IIShapeCircle.create(partialShape as PartialDeep<IIShapeCircle>)\n      case ShapeKind.Ellipse:\n        return IIShapeEllipse.create(partialShape as PartialDeep<IIShapeEllipse>)\n      case ShapeKind.Polygon:\n        return IIShapePolygon.create(partialShape as PartialDeep<IIShapePolygon>)\n      default:\n        throw new Error(`Unable to create shape, kind: \"${ partialShape.kind }\" is unknown`)\n    }\n  }\n\n  protected buildEdge(partialEdge: PartialDeep<TIIEdge>): TIIEdge\n  {\n    switch (partialEdge.kind) {\n      case EdgeKind.Arc:\n        return IIEdgeArc.create(partialEdge as PartialDeep<IIEdgeArc>)\n      case EdgeKind.Line:\n        return IIEdgeLine.create(partialEdge as PartialDeep<IIEdgeLine>)\n      case EdgeKind.PolyEdge:\n        return IIEdgePolyLine.create(partialEdge as PartialDeep<IIEdgePolyLine>)\n      default:\n        throw new Error(`Unable to create edge, kind: \"${ partialEdge.kind }\" is unknown`)\n    }\n  }\n\n  protected buildRecognized(partialSymbol: PartialDeep<TIIRecognized>): TIIRecognized\n  {\n    switch (partialSymbol.kind) {\n      case RecognizedKind.Text:\n        return IIRecognizedText.create(partialSymbol)\n      case RecognizedKind.Arc:\n        return IIRecognizedArc.create(partialSymbol)\n      case RecognizedKind.Circle:\n        return IIRecognizedCircle.create(partialSymbol)\n      case RecognizedKind.Ellipse:\n        return IIRecognizedEllipse.create(partialSymbol)\n      case RecognizedKind.Polygone:\n        return IIRecognizedPolygon.create(partialSymbol)\n      case RecognizedKind.Line:\n        return IIRecognizedLine.create(partialSymbol)\n      case RecognizedKind.PolyEdge:\n        return IIRecognizedPolyLine.create(partialSymbol)\n      default:\n        throw new Error(`Unable to create recognized, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n    }\n  }\n\n  protected buildGroup(partialGroup: PartialDeep<IISymbolGroup>): IISymbolGroup\n  {\n    if (!partialGroup.children?.length) {\n      throw new Error(`Unable to create group, no children`)\n    }\n\n    const children = partialGroup.children.map(partialSymbol =>\n    {\n      switch (partialSymbol?.type) {\n        case SymbolType.Stroke:\n          return IIStroke.create(partialSymbol as PartialDeep<IIStroke>)\n        case SymbolType.Shape:\n          return this.buildShape(partialSymbol as PartialDeep<TIIShape>)\n        case SymbolType.Edge:\n          return this.buildEdge(partialSymbol as PartialDeep<TIIEdge>)\n        case SymbolType.Text:\n          return IIText.create(partialSymbol as PartialDeep<IIText>)\n        case SymbolType.Group:\n          return this.buildGroup(partialSymbol as PartialDeep<IISymbolGroup>)\n        case SymbolType.Recognized:\n          return this.buildRecognized(partialSymbol as PartialDeep<TIIRecognized>)\n        default:\n          throw new Error(`Unable to create group, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n      }\n    })\n    const group = new IISymbolGroup(children, partialGroup.style)\n    if (partialGroup.id) {\n      group.id = partialGroup.id\n    }\n    if (partialGroup.decorators) {\n      group.decorators = partialGroup.decorators.map(d => new IIDecorator(d!.kind!, d!.style as TStyle))\n    }\n    return group\n  }\n\n  protected buildStroke(partialSymbol: PartialDeep<IIStroke>): IIStroke\n  {\n    return IIStroke.create(partialSymbol as PartialDeep<IIStroke>)\n  }\n\n  protected buildStrokeText(partialSymbol: PartialDeep<IIRecognizedText>): IIRecognizedText\n  {\n    return IIRecognizedText.create(partialSymbol as PartialDeep<IIRecognizedText>)\n  }\n\n  protected buildText(partialSymbol: PartialDeep<IIText>): IIText\n  {\n    return IIText.create(partialSymbol as PartialDeep<IIText>)\n  }\n\n  protected buildSymbol(partialSymbol: PartialDeep<TIISymbol>): TIISymbol\n  {\n    try {\n      switch (partialSymbol.type) {\n        case SymbolType.Stroke:\n          return this.buildStroke(partialSymbol)\n        case SymbolType.Shape:\n          return this.buildShape(partialSymbol)\n        case SymbolType.Edge:\n          return this.buildEdge(partialSymbol)\n        case SymbolType.Text:\n          return this.buildText(partialSymbol)\n        case SymbolType.Group:\n          return this.buildGroup(partialSymbol)\n        case SymbolType.Recognized:\n          return this.buildRecognized(partialSymbol as PartialDeep<TIIRecognized>)\n        default:\n          throw new Error(`Unable to build symbol, type: \"${ partialSymbol.type }\" is unknown`)\n      }\n    }\n    catch (error) {\n      this.logger.error(\"createSymbol\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n  }\n\n  async createSymbol(partialSymbol: PartialDeep<TIISymbol>): Promise<TIISymbol>\n  {\n    try {\n      return await this.addSymbol(this.buildSymbol(partialSymbol))\n    }\n    catch (error) {\n      this.logger.error(\"createSymbol\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  async createSymbols(partialSymbols: PartialDeep<TIISymbol>[]): Promise<TIISymbol[]>\n  {\n    try {\n      const errors: string[] = []\n      const symbols: TIISymbol[] = []\n      partialSymbols.forEach(partialSymbol =>\n      {\n        try {\n          symbols.push(this.buildSymbol(partialSymbol))\n        } catch (error) {\n          errors.push(((error as Error).message || error) as string)\n        }\n      })\n      if (errors.length) {\n        throw new Error(errors.join(\"\\n\"))\n      }\n      return await this.addSymbols(symbols)\n    } catch (error) {\n      this.logger.error(\"createSymbols\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n  }\n\n  /** @hidden */\n  protected updateTextBounds(symbol: TIISymbol): void\n  {\n    if (symbol.type === SymbolType.Text) {\n      this.texter.updateBounds(symbol)\n    }\n    else if (symbol.type === SymbolType.Group) {\n      symbol.extractText().forEach(t => this.texter.updateBounds(t))\n    }\n  }\n\n  /** @hidden */\n  async addSymbol(sym: TIISymbol, addToHistory = true): Promise<TIISymbol>\n  {\n    this.logger.info(\"addSymbol\", { sym })\n    this.updateLayerState(false)\n    this.updateTextBounds(sym)\n    this.model.addSymbol(sym)\n    this.renderer.drawSymbol(sym)\n\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.addStrokes(strokes, false)\n\n    if (addToHistory) {\n      this.history.push(this.model, { added: [sym] })\n    }\n    this.updateLayerUI()\n    return sym\n  }\n\n  /** @hidden */\n  async addSymbols(symList: TIISymbol[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"addSymbol\", { symList })\n    this.updateLayerState(false)\n    symList.forEach(s =>\n    {\n      this.updateTextBounds(s)\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.addStrokes(strokes, false)\n    if (addToHistory) {\n      this.history.push(this.model, { added: symList })\n    }\n    this.updateLayerUI()\n    return symList\n  }\n\n  async updateSymbol(sym: TIISymbol, addToHistory = true): Promise<TIISymbol>\n  {\n    this.logger.info(\"updateSymbol\", { sym })\n    this.updateLayerState(false)\n    this.updateTextBounds(sym)\n    this.model.updateSymbol(sym)\n    this.renderer.drawSymbol(sym)\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: [sym] })\n    }\n    this.updateLayerUI()\n    return sym\n  }\n\n  async updateSymbols(symList: TIISymbol[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"updateSymbol\", { symList })\n    this.updateLayerState(false)\n    symList.forEach(s =>\n    {\n      this.updateTextBounds(s)\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: symList })\n    }\n    this.updateLayerUI()\n    return symList\n  }\n\n  updateSymbolsStyle(symbolIds: string[], style: PartialDeep<TStyle>, addToHistory = true): void\n  {\n    this.logger.info(\"updateSymbolsStyle\", { symbolIds, style })\n    const symbols: TIISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (symbolIds.includes(s.id)) {\n        s.style = Object.assign({}, s.style, style)\n        if (\n          SymbolType.Text === s.type ||\n          SymbolType.Group === s.type ||\n          SymbolType.Recognized === s.type) {\n          s.updateChildrenStyle()\n        }\n        this.renderer.drawSymbol(s)\n        this.model.updateSymbol(s)\n        s.modificationDate = Date.now()\n        symbols.push(s)\n      }\n    })\n    if (symbols.length) {\n      symbols.forEach(s =>\n      {\n        if (s.type === SymbolType.Text) {\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            this.texter.moveTextAfter(s, tx)\n          }\n        }\n      })\n    }\n    if (addToHistory && symbols.length) {\n      this.history.push(this.model, { style: { symbols, style } })\n    }\n  }\n\n  updateTextFontStyle(textIds: string[], { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" | \"auto\" }): void\n  {\n    this.logger.info(\"updateTextFontStyle\", { textIds, fontSize, fontWeight })\n    const symbols: (IIText | IISymbolGroup)[] = []\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (textIds.includes(s.id)) {\n        if (s.type === SymbolType.Text) {\n          s.updateChildrenFont({ fontSize, fontWeight: fontWeight === \"auto\" ? undefined : fontWeight })\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          this.renderer.drawSymbol(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            const symbolsTranslated = this.texter.moveTextAfter(s, tx)\n            if (symbolsTranslated?.length) {\n              translate.push({\n                symbols: symbolsTranslated,\n                tx,\n                ty: 0\n              })\n            }\n          }\n          s.modificationDate = Date.now()\n          symbols.push(s)\n        }\n        else if (s.type === SymbolType.Group) {\n          const textChildren = s.extractText()\n          if (textChildren.length) {\n            textChildren.forEach(text =>\n            {\n              text.updateChildrenFont({ fontSize, fontWeight: fontWeight === \"auto\" ? undefined : fontWeight })\n              const lastWidth = s.bounds.width\n              this.texter.updateBounds(text)\n              const tx = s.bounds.width - lastWidth\n              const symbolsTranslated = this.texter.moveTextAfter(text, tx)\n              if (symbolsTranslated?.length) {\n                translate.push({\n                  symbols: symbolsTranslated,\n                  tx,\n                  ty: 0\n                })\n              }\n            })\n            s.modificationDate = Date.now()\n            this.renderer.drawSymbol(s)\n            symbols.push(s)\n          }\n\n        }\n      }\n    })\n    if (symbols.length) {\n      this.history.push(this.model, { style: { symbols, fontSize }, translate })\n    }\n  }\n\n  async replaceSymbols(oldSymbols: TIISymbol[], newSymbols: TIISymbol[], addToHistory = true): Promise<void>\n  {\n    this.logger.info(\"replaceSymbol\", { oldSymbols, newSymbols })\n    this.updateLayerState(false)\n\n    const oldStrokes = this.extractStrokesFromSymbols(oldSymbols)\n    const newStrokes = this.extractStrokesFromSymbols(newSymbols)\n\n    const symToReplace = oldSymbols.shift()\n\n    if (symToReplace) {\n      oldSymbols.forEach(s =>\n      {\n        this.renderer.removeSymbol(s.id)\n        this.model.removeSymbol(s.id)\n      })\n\n      this.model.replaceSymbol(symToReplace.id, newSymbols)\n      this.renderer.replaceSymbol(symToReplace.id, newSymbols)\n\n\n      if (oldStrokes.length && newStrokes.length) {\n        this.recognizer.replaceStrokes(oldStrokes.map(s => s.id), newStrokes)\n      }\n      else if (oldStrokes.length) {\n        this.recognizer.eraseStrokes(oldStrokes.map(s => s.id))\n      }\n      else {\n        this.recognizer.addStrokes(newStrokes, false)\n      }\n\n      if (addToHistory) {\n        this.history.push(this.model, { replaced: { oldSymbols, newSymbols } })\n      }\n      this.updateLayerUI()\n    }\n  }\n\n  changeOrderSymbol(symbol: TIISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void\n  {\n    this.model.changeOrderSymbol(symbol.id, position)\n    this.renderer.changeOrderSymbol(symbol, position)\n    this.history.push(this.model, { order: { symbols: [symbol], position } })\n  }\n\n  changeOrderSymbols(symbols: TIISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    symbols.forEach(s =>\n    {\n      this.model.changeOrderSymbol(s.id, position)\n      this.renderer.changeOrderSymbol(s, position)\n    })\n    this.history.push(this.model, { order: { symbols, position } })\n  }\n\n  groupSymbols(symbols: TIISymbol[]): IISymbolGroup\n  {\n    const group = this.buildGroup({ children: symbols })\n    symbols.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n    this.model.addSymbol(group)\n    this.history.push(this.model, { group: { symbols } })\n    return group\n  }\n\n  ungroupSymbol(group: IISymbolGroup): TIISymbol[]\n  {\n    group.children.forEach(s => this.renderer.drawSymbol(s))\n    this.renderer.removeSymbol(group.id)\n    this.model.replaceSymbol(group.id, group.children)\n    this.history.push(this.model, { ungroup: { group } })\n    return group.children\n  }\n\n  async synchronizeStrokesWithJIIX(force: boolean = false): Promise<void>\n  {\n    //if there is no stroke, jiix should not have changed\n    const strokes = this.model.symbols.filter(s => s.type === SymbolType.Stroke)\n    if (!force && !strokes.length) {\n      this.event.emitSynchronized()\n      return\n    }\n    await this.export([\"application/vnd.myscript.jiix\"])\n\n    const getSymbolsAndStrokesAssociatedFromJIIXStrokeItems = (items: TJIIXStrokeItem[] = []): { symbols: TIISymbol[], strokes: IIStroke[] } =>\n    {\n      const symbols: TIISymbol[] = []\n      const strokes: IIStroke[] = []\n      const strokeIdsUsed: string[] = []\n      items.forEach(i =>\n      {\n        const strokeId = i[\"full-id\"]!\n        if (strokeIdsUsed.includes(strokeId)) {\n          return\n        }\n        strokeIdsUsed.push(strokeId)\n        const sym = this.model.getRootSymbol(strokeId)\n        if (sym) {\n          switch (sym?.type) {\n            // we do not modify a group created by the user\n            // case SymbolType.Group:\n            //   strokes.push(...sym.extractStrokes())\n            //   break\n            case SymbolType.Recognized:\n              // if it's recognized symbol with same number of strokes\n              // the recognition has been already done\n              // if (sym.strokes.length === items.length) {\n              //   return\n              // }\n              strokes.push(sym.strokes.find(s => s.id === i[\"full-id\"]!)!)\n              break\n            default:\n              strokes.push(sym as IIStroke)\n              break\n          }\n          const symIdx = symbols.findIndex(s => s.id === sym.id)\n          if (symIdx < 0) {\n            symbols.push(sym)\n          }\n          else {\n            symbols[symIdx] = sym\n          }\n        }\n      })\n      return {\n        symbols,\n        strokes\n      }\n    }\n\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    jiix?.elements?.forEach(el =>\n    {\n      switch (el.type) {\n        case JIIXELementType.Text: {\n          el.words?.forEach(w =>\n          {\n            const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(w.items)\n            if (jiixAssociation.strokes.length) {\n              if (jiixAssociation.symbols.length === 1) {\n                const symAsso = jiixAssociation.symbols[0]\n                if (\n                  symAsso.type === SymbolType.Recognized && symAsso.kind === RecognizedKind.Text &&\n                  symAsso.label === w.label &&\n                  symAsso.strokes.length === symAsso.strokes.length\n                ) {\n                  return\n                }\n              }\n              const line = el.lines!.find(l => l[\"first-char\"]! <= w[\"first-char\"]! && l[\"last-char\"]! >= w[\"last-char\"]!)!\n              const recognizedText = new IIRecognizedText(jiixAssociation.strokes, { baseline: convertMillimeterToPixel(line[\"baseline-y\"]), xHeight: convertMillimeterToPixel(line[\"x-height\"]) })\n              recognizedText.label = w.label\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                if (sym.type === SymbolType.Recognized && sym.kind === RecognizedKind.Text) {\n                  sym.decorators.forEach(d =>\n                  {\n                    if (!recognizedText.decorators.some(wd => wd.kind === d.kind)) {\n                      recognizedText.decorators.push(d)\n                    }\n                  })\n                }\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(recognizedText)\n              this.renderer.drawSymbol(recognizedText)\n            }\n          })\n          break\n        }\n        case JIIXELementType.Node: {\n          let symbolRecognized: TIIRecognized | undefined\n          const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(el.items)\n          if (jiixAssociation.strokes.length) {\n            if (jiixAssociation.symbols.length === 1) {\n              const symAsso = jiixAssociation.symbols[0]\n              if (symAsso.type === SymbolType.Recognized &&\n                symAsso.strokes.length === jiixAssociation.strokes.length) {\n                return\n              }\n            }\n            switch (el.kind) {\n              case JIIXNodeKind.Circle: {\n                symbolRecognized = new IIRecognizedCircle(jiixAssociation.strokes)\n                break\n              }\n              case JIIXNodeKind.Ellipse: {\n                symbolRecognized = new IIRecognizedEllipse(jiixAssociation.strokes)\n                break\n              }\n              case JIIXNodeKind.Rectangle:\n              case JIIXNodeKind.Triangle:\n              case JIIXNodeKind.Parallelogram:\n              case JIIXNodeKind.Polygon:\n              case JIIXNodeKind.Rhombus: {\n                symbolRecognized = new IIRecognizedPolygon(jiixAssociation.strokes)\n                break\n              }\n              default:\n                this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized shape symbol, kind unknow: ${ el }`)\n                break\n            }\n            if (symbolRecognized) {\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(symbolRecognized)\n              this.renderer.drawSymbol(symbolRecognized)\n            }\n          }\n          break\n        }\n        case JIIXELementType.Edge: {\n          let symbolRecognized: TIIRecognized | undefined\n          const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(el.kind === JIIXEdgeKind.PolyEdge ? el.edges.flatMap(e => e.items!) : el.items)\n          if (jiixAssociation.strokes.length) {\n            if (jiixAssociation.symbols.length === 1) {\n              const symAsso = jiixAssociation.symbols[0]\n              if (symAsso.type === SymbolType.Recognized &&\n                symAsso.strokes.length === jiixAssociation.strokes.length) {\n                return\n              }\n            }\n            switch (el.kind) {\n              case JIIXEdgeKind.Line: {\n                symbolRecognized = new IIRecognizedLine(jiixAssociation.strokes)\n                break\n              }\n              case JIIXEdgeKind.PolyEdge: {\n                symbolRecognized = new IIRecognizedPolyLine(jiixAssociation.strokes)\n                break\n              }\n              case JIIXEdgeKind.Arc: {\n                symbolRecognized = new IIRecognizedArc(jiixAssociation.strokes)\n                break\n              }\n              default:\n                this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized edge symbol, kind unknow: ${ el }`)\n                break\n            }\n            if (symbolRecognized) {\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(symbolRecognized)\n              this.renderer.drawSymbol(symbolRecognized)\n            }\n          }\n          break\n        }\n        default:\n          this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized symbol, type unknow: ${ el }`)\n          break\n      }\n    })\n    // because model.export is emptied when you change symbols\n    this.model.mergeExport({ \"application/vnd.myscript.jiix\": jiix })\n    this.history.update(this.model)\n    this.event.emitSynchronized()\n  }\n\n  async removeSymbol(id: string, addToHistory = true): Promise<void>\n  {\n    this.logger.info(\"removeSymbol\", { id })\n    const symbol = this.model.getRootSymbol(id)\n    if (symbol) {\n      this.updateLayerState(false)\n      if (symbol.type === SymbolType.Group) {\n        const groupStrokeIds = symbol.extractStrokes().map(s => s.id)\n        symbol.removeChilds([id])\n        if (symbol.children.length) {\n          this.model.updateSymbol(symbol)\n          this.renderer.drawSymbol(symbol)\n          if (groupStrokeIds.includes(id)) {\n            this.recognizer.eraseStrokes([id])\n          }\n        }\n        else {\n          this.recognizer.eraseStrokes(groupStrokeIds)\n          this.model.removeSymbol(symbol.id)\n          this.renderer.removeSymbol(symbol.id)\n        }\n      }\n      else {\n        this.recognizer.eraseStrokes([id])\n        this.model.removeSymbol(symbol.id)\n        this.renderer.removeSymbol(symbol.id)\n      }\n      if (addToHistory) {\n        this.history.push(this.model, { erased: [symbol] })\n      }\n      this.updateLayerUI()\n    }\n    else {\n      this.renderer.removeSymbol(id)\n      this.recognizer.eraseStrokes([id])\n    }\n  }\n\n  async removeSymbols(ids: string[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"removeSymbol\", { ids })\n    const symbolsToRemove: TIISymbol[] = []\n    const symbolsToUpdate: TIISymbol[] = []\n    const strokesIds: string[] = []\n    ids.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym) {\n        /** we remove root element */\n        if (sym.id === id) {\n          symbolsToRemove.push(sym)\n          switch (sym.type) {\n            case SymbolType.Stroke:\n              strokesIds.push(sym.id)\n              break\n            case SymbolType.Recognized:\n              strokesIds.push(...sym.strokes.map(s => s.id))\n              break\n            case SymbolType.Group:\n              strokesIds.push(...sym.extractStrokes().map(s => s.id))\n              break\n          }\n        }\n        else {\n          /** we want to remove child */\n          switch (sym.type) {\n            case SymbolType.Group: {\n              const gr = sym.clone()\n              strokesIds.push(...gr.extractStrokes().map(s => s.id).filter(id => ids.includes(id)))\n              gr.removeChilds(ids)\n              if (gr.children.length) {\n                symbolsToUpdate.push(gr)\n              }\n              else {\n                symbolsToRemove.push(gr)\n              }\n              break\n            }\n            case SymbolType.Recognized: {\n              strokesIds.push(id)\n              const ws = sym.clone()\n              ws.removeStrokes(ids)\n              if (ws.strokes.length) {\n                symbolsToUpdate.push(ws)\n              }\n              else {\n                symbolsToRemove.push(ws)\n              }\n              break\n            }\n          }\n\n        }\n      }\n    })\n    this.recognizer.eraseStrokes(strokesIds)\n    symbolsToRemove.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n\n    symbolsToUpdate.forEach(s =>\n    {\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n\n\n    if (addToHistory) {\n      const changes: TIIHistoryChanges = {}\n      if (symbolsToRemove.length || symbolsToUpdate.length) {\n        if (symbolsToRemove.length) {\n          changes.erased = symbolsToRemove\n        }\n        if (symbolsToUpdate.length) {\n          changes.updated = symbolsToUpdate\n        }\n        this.history.push(this.model, changes)\n        this.updateLayerUI()\n      }\n    }\n    this.updateLayerState(false)\n    return symbolsToRemove\n  }\n\n  select(ids: string[]): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = ids.includes(s.id)\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.updateLayerUI()\n    this.event.emitSelected(this.model.symbolsSelected)\n  }\n\n  selectAll(): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = true\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.updateLayerUI()\n    this.event.emitSelected(this.model.symbolsSelected)\n  }\n\n  unselectAll(): void\n  {\n    if (this.model.symbolsSelected.length) {\n      this.model.symbolsSelected.forEach(s =>\n      {\n        s.selected = false\n        this.renderer.drawSymbol(s)\n      })\n      this.selector.removeSelectedGroup()\n      this.updateLayerUI()\n      this.event.emitSelected(this.model.symbolsSelected)\n    }\n  }\n\n  async importPointEvents(partialStrokes: PartialDeep<IIStroke>[]): Promise<IIModel>\n  {\n    this.logger.info(\"importPointEvents\", { partialStrokes })\n    this.updateLayerState(false)\n    const strokes = convertPartialStrokesToOIStrokes(partialStrokes)\n    strokes.forEach(s =>\n    {\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    this.recognizer.addStrokes(strokes, false)\n    this.history.push(this.model, { added: strokes })\n    this.logger.debug(\"importPointEvents\", this.model)\n    this.updateLayerUI()\n    this.event.emitImported(this.model.exports as TExport)\n    return this.model\n  }\n\n  protected triggerDownload(fileName: string, urlData: string): void\n  {\n    const downloadAnchorNode = document.createElement(\"a\")\n    downloadAnchorNode.setAttribute(\"href\", urlData)\n    downloadAnchorNode.setAttribute(\"download\", fileName)\n    document.body.appendChild(downloadAnchorNode)\n    downloadAnchorNode.click()\n    downloadAnchorNode.remove()\n  }\n\n  getSymbolsBounds(symbols: TIISymbol[], margin: number = SELECTION_MARGIN): Box\n  {\n    const box = Box.createFromBoxes(symbols.map(s => s.bounds))\n    box.x -= margin\n    box.y -= margin\n    box.width += margin * 2\n    box.height += margin * 2\n    return box\n  }\n\n  protected buildBlobFromSymbols(symbols: TIISymbol[], box: Box): Blob\n  {\n    const svgNode = SVGBuilder.createLayer(box)\n    symbols.forEach(s =>\n    {\n      const el = this.renderer.getElementById(s.id)?.cloneNode(true)\n      if (el) {\n        svgNode.appendChild(el)\n      }\n    })\n\n    const svgString = (new XMLSerializer()).serializeToString(svgNode)\n\n    return new Blob([svgString], {\n      type: \"image/svg+xml;charset=utf-8\"\n    })\n  }\n\n  protected getExportName(extension: string): string\n  {\n    const options: Intl.DateTimeFormatOptions = { year: \"numeric\", month: \"numeric\", day: \"numeric\", hour: \"2-digit\", minute: \"2-digit\", second: \"2-digit\" }\n    try {\n      return `iink-ts-${ new Date().toLocaleDateString(navigator.language, options) }.${ extension }`\n    }\n    catch {\n      return `iink-ts-${ new Date().toLocaleDateString(\"en-US\", options) }.${ extension }`\n    }\n  }\n\n  downloadAsSVG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n    const url = URL.createObjectURL(svgBlob)\n    this.triggerDownload(this.getExportName(\"svg\"), url)\n  }\n\n  downloadAsPNG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n\n    const url = URL.createObjectURL(svgBlob)\n    const image = new Image(box.width, box.height)\n    image.src = url\n    image.onload = () =>\n    {\n      const canvas = document.createElement(\"canvas\")\n      canvas.width = image.width\n      canvas.height = image.height\n\n      const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D\n      ctx.drawImage(image, 0, 0)\n      URL.revokeObjectURL(url)\n\n      const imgURI = canvas\n        .toDataURL(\"image/png\")\n        .replace(\"image/png\", \"image/octet-stream\")\n\n      this.triggerDownload(this.getExportName(\"png\"), imgURI)\n    }\n  }\n\n  downloadAsJson(selection = false)\n  {\n    const symbolsToExport = selection ? this.model.symbolsSelected : this.model.symbols\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(symbolsToExport, null, 2))\n    this.triggerDownload(this.getExportName(\"json\"), dataStr)\n  }\n\n  extractStrokesFromSymbols(symbols: TIISymbol[] | undefined): IIStroke[]\n  {\n    if (!symbols?.length) return []\n    const strokes: IIStroke[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break\n        case SymbolType.Recognized:\n          strokes.push(...s.strokes)\n          break\n        case SymbolType.Group:\n          strokes.push(...s.extractStrokes())\n          break\n      }\n    })\n    return strokes\n  }\n\n  extractTextsFromSymbols(symbols: TIISymbol[] | undefined): IIText[]\n  {\n    if (!symbols?.length) return []\n    const texts: IIText[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Text:\n          texts.push(s)\n          break\n        case SymbolType.Group:\n          texts.push(...s.extractText())\n          break\n      }\n    })\n    return texts\n  }\n\n  protected extractBackendChanges(changes: TIIHistoryChanges): TIIHistoryBackendChanges\n  {\n    const backendChanges: TIIHistoryBackendChanges = {}\n    backendChanges.added = this.extractStrokesFromSymbols(changes.added)\n    backendChanges.erased = this.extractStrokesFromSymbols(changes.erased)\n\n    const updated = this.extractStrokesFromSymbols(changes.updated)\n\n    const oldStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.oldSymbols))\n    const newStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.newSymbols))\n    if (oldStrokes.length && newStrokes.length) {\n      backendChanges.replaced = {\n        oldStrokes,\n        newStrokes\n      }\n    }\n    else {\n      backendChanges.added.push(...newStrokes)\n      backendChanges.erased.push(...oldStrokes)\n    }\n\n    if (changes.matrix) {\n      backendChanges.matrix = {\n        strokes: this.extractStrokesFromSymbols(changes.matrix.symbols),\n        matrix: changes.matrix.matrix,\n      }\n    }\n\n    if (changes.translate?.length) {\n      backendChanges.translate = []\n      changes.translate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.translate!.push({\n            strokes,\n            tx: tr.tx,\n            ty: tr.ty\n          })\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      backendChanges.scale = []\n      changes.scale.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.scale!.push({\n            strokes,\n            origin: tr.origin,\n            scaleX: tr.scaleX,\n            scaleY: tr.scaleY\n          })\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      backendChanges.rotate = []\n      changes.rotate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.rotate!.push({\n            strokes,\n            center: tr.center,\n            angle: tr.angle\n          })\n        }\n      })\n    }\n    return backendChanges\n  }\n\n  async undo(): Promise<IIModel>\n  {\n    this.logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.updateLayerState(false)\n      this.unselectAll()\n      const previousStackItem = this.history.undo()\n      const modifications = previousStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = previousStackItem.model.clone()\n      this.logger.debug(\"undo\", { previousStackItem })\n      const actionsToBackend = this.extractBackendChanges(previousStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.undo(actionsToBackend)\n      }\n      this.updateLayerUI()\n    }\n    return this.model\n  }\n\n  async redo(): Promise<IIModel>\n  {\n    this.logger.info(\"redo\")\n\n    if (this.history.context.canRedo) {\n      this.updateLayerState(false)\n      this.unselectAll()\n      const nextStackItem = this.history.redo()\n      const modifications = nextStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = nextStackItem.model.clone()\n      this.logger.debug(\"redo\", { modifications })\n      const actionsToBackend = this.extractBackendChanges(nextStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.redo(actionsToBackend)\n      }\n\n      this.updateLayerUI()\n    }\n    return this.model\n  }\n\n  async export(mimeTypes?: string[]): Promise<IIModel>\n  {\n    try {\n      this.logger.info(\"export\", { mimeTypes })\n      const exports = await this.recognizer.export(mimeTypes)\n      this.model.mergeExport(exports as TExport)\n    }\n    catch (error) {\n      this.logger.error(\"export\", { error })\n      this.manageError(error as Error)\n      throw error\n    }\n    return this.model\n  }\n\n  async convert(): Promise<void>\n  {\n    await this.convertSymbols()\n  }\n\n  async convertSymbols(symbols?: TIISymbol[]): Promise<void>\n  {\n    try {\n      this.updateLayerState(false)\n      await this.converter.apply(symbols)\n      this.event.emitConverted(this.model.converts as TExport)\n    }\n    catch (error) {\n      this.logger.error(\"convert\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    try {\n      this.logger.info(\"resize\", { height, width })\n      const compStyles = window.getComputedStyle(this.layers.root)\n      height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n      width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n\n      this.updateLayerState(false)\n      this.model.height = height\n      this.model.width = width\n      this.renderer.resize(height, width)\n      this.updateLayerUI(50)\n      this.updateLayerState(true)\n    } catch (error) {\n      this.manageError(error as Error)\n    }\n  }\n\n  async clear(): Promise<void>\n  {\n    try {\n      this.logger.info(\"clear\")\n      this.updateLayerState(false)\n      if (this.model.symbols.length) {\n        this.selector.removeSelectedGroup()\n        const erased = this.model.symbols\n        this.renderer.clear()\n        this.model.clear()\n        this.history.push(this.model, { erased })\n        this.recognizer.clear()\n        this.event.emitSelected(this.model.symbolsSelected)\n      }\n      this.updateLayerUI()\n      this.event.emitCleared()\n    } catch (error) {\n      this.manageError(error as Error)\n    }\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n\n    this.layers.root.classList.remove(\"draw\")\n    this.layers.root.classList.remove(\"erase\")\n    this.layers.root.classList.remove(\"select\")\n    this.layers.root.classList.remove(\"move\")\n\n    this.eraser.detach()\n    this.selector.detach()\n    this.move.detach()\n    this.writer.detach()\n\n    this.renderer.destroy()\n    this.layers.destroy()\n    this.menu.destroy()\n    this.recognizer.destroy()\n    this.model.clear()\n    this.history.clear()\n    return Promise.resolve()\n  }\n}\n","/**\n * @group Editor\n * @remarks\n * Configure when the action is triggered.\n *\n * POINTER_UP :   Action is triggered on every PenUP.\n *                This is the recommended mode for CDK V3 WebSocket recognitions.\n *\n * QUIET_PERIOD : Action is triggered after a quiet period in milli-seconds on every pointer up.\n *                The value is set to 1000 for example recognition will be triggered when the user stops writing for 1 seconds.\n *                This is the recommended mode for all REST discoveries.\n *\n * DEMAND :       Action is triggered on external demande\n */\nexport type TEditorTriggerConfiguration = {\n    exportContent: \"QUIET_PERIOD\" | \"POINTER_UP\" | \"DEMAND\"\n    exportContentDelay: number\n    resizeTriggerDelay: number\n  }\n\n  /**\n   * @group Editor\n   * @source\n   */\n  export const DefaulTEditorTriggerConfiguration: TEditorTriggerConfiguration = {\n    exportContent: \"QUIET_PERIOD\",\n    exportContentDelay: 1000,\n    resizeTriggerDelay: 100\n  }\n","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerHTTPV1Configuration, RecognizerHTTPV1Configuration, TRecognitionHTTPV1Configuration, TRecognizerHTTPV1Configuration, TServerHTTPConfiguration } from \"../recognizer\"\nimport { DefaultRendererConfiguration, TRendererConfiguration } from \"../renderer\"\nimport { DefaultTheme, TPenStyle, TTheme } from \"../style\"\nimport { mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaulTEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n\n/**\n * @group Editor\n */\nexport type TInkEditorDeprecatedConfiguration = TEditorConfiguration & TRecognizerHTTPV1Configuration & {\n  rendering: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle,\n  penStyleClasses?: string\n  theme: TTheme\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInkEditorDeprecatedConfiguration: TInkEditorDeprecatedConfiguration = {\n  server: DefaultRecognizerHTTPV1Configuration.server,\n  recognition: DefaultRecognizerHTTPV1Configuration.recognition,\n  rendering: DefaultRendererConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaulTEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: {},\n  theme: DefaultTheme\n}\n\n/**\n * @group Editor\n */\nexport class InkEditorDeprecatedConfiguration implements TInkEditorDeprecatedConfiguration\n{\n  server: TServerHTTPConfiguration\n  recognition: TRecognitionHTTPV1Configuration\n  rendering: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle\n  penStyleClasses?: string\n  theme: TTheme\n\n  constructor(configuration?: PartialDeep<TInkEditorDeprecatedConfiguration>)\n  {\n    const { server, recognition } = new RecognizerHTTPV1Configuration(configuration)\n    this.server = server\n    this.recognition = recognition\n    this.rendering = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.rendering, configuration?.rendering)\n    this.grabber = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.grabber, configuration?.grabber)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.triggers = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.penStyle, configuration?.penStyle)\n    this.penStyleClasses = configuration?.penStyleClasses || this.penStyleClasses\n    this.theme = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.theme, configuration?.theme)\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { Model, TExport } from \"../model\"\nimport { Stroke, TStroke, TPointer } from \"../symbol\"\nimport { RecognizerHTTPV1, TConverstionState } from \"../recognizer\"\nimport { CanvasRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InkEditorDeprecatedConfiguration, TInkEditorDeprecatedConfiguration } from \"./InkEditorDeprecatedConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInkEditorDeprecatedOptions = PartialDeep<EditorOptionsBase &\n{\n  configuration: TInkEditorDeprecatedConfiguration\n}> &\n{\n  override?: {\n    grabber?: PointerEventGrabber\n    recognizer?: RecognizerHTTPV1\n  }\n}\n\n/**\n * @group Editor\n * @deprecated Use {@link InkEditor} instead.\n */\nexport class InkEditorDeprecated extends AbstractEditor\n{\n  #configuration: InkEditorDeprecatedConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n  #exportTimer?: ReturnType<typeof setTimeout>\n\n  grabber: PointerEventGrabber\n  renderer: CanvasRenderer\n  recognizer: RecognizerHTTPV1\n  history: HistoryManager\n  styleManager: StyleManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInkEditorDeprecatedOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InkEditorDeprecatedConfiguration(options?.configuration)\n    this.styleManager = new StyleManager(options?.configuration?.penStyle, options?.configuration?.theme)\n\n    if (options?.override?.grabber) {\n      const CustomGrabber = options.override.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerHTTPV1\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerHTTPV1(this.#configuration)\n    }\n    this.renderer = new CanvasRenderer(this.#configuration.rendering)\n\n    this.tool = EditorTool.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  protected onPointerDown(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerDown\", { tool: this.tool, info })\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.initCurrentStroke(info.pointer, info.pointerType, style)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerDown\", `onPointerDown tool unknow: \"${ this.tool }\"`)\n        break\n    }\n  }\n\n  protected onPointerMove(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerMove\", { tool: this.tool, info })\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.appendToCurrentStroke(info.pointer)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerMove\", `onPointerMove tool unknow: \"${ this.tool }\"`)\n        break\n    }\n  }\n\n  protected async onPointerUp(info: PointerInfo): Promise<void>\n  {\n    try {\n      this.logger.info(\"onPointerUp\", { tool: this.tool, info })\n      switch (this.tool) {\n        case EditorTool.Erase:\n          this.model.removeStrokesFromPoint(info.pointer)\n          if (this.history.stack.at(-1)?.modificationDate !== this.model.modificationDate) {\n            await this.updateModelRendering()\n          }\n          break\n        case EditorTool.Write:\n          this.model.endCurrentStroke(info.pointer)\n          await this.updateModelRendering()\n          break\n        default:\n          this.logger.warn(\"#onPointerUp\", `onPointerUp tool unknow: \"${ this.tool }\"`)\n          break\n      }\n    } catch (error) {\n      this.layers.showMessageError(error as Error)\n      this.event.emitError(error as Error)\n      throw error\n    }\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return Promise.resolve()\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.setCursorStyle()\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  set penStyle(penStyle: TPenStyle | undefined)\n  {\n    this.logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  set penStyleClasses(penStyleClasses: string | undefined)\n  {\n    this.logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    this.styleManager.setPenStyleClasses(penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n  }\n\n  get configuration(): InkEditorDeprecatedConfiguration\n  {\n    return this.#configuration\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.history.push(this.model)\n      this.layers.rendering.classList.add(this.configuration.recognition.type.toLowerCase().replace(\" \", \"-\"))\n      this.renderer.init(this.layers.rendering, { x: 50, y: 50 })\n      this.grabber.attach(this.layers.rendering)\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    this.renderer.drawPendingStroke(this.model.currentSymbol)\n  }\n\n  async updateModelRendering(): Promise<Model>\n  {\n    this.logger.info(\"updateModelRendering\")\n    this.renderer.drawModel(this.model)\n    const deferred = new DeferredPromise<Model>()\n    this.history.push(this.model)\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      let currentModel = this.model.clone()\n      this.#exportTimer = setTimeout(async () =>\n      {\n        try {\n          currentModel = await this.recognizer.export(currentModel)\n          this.history.updateStack(currentModel)\n          if (this.model.modificationDate === currentModel.modificationDate) {\n            this.model.exports = currentModel.exports\n          }\n          deferred.resolve(this.model)\n        } catch (error) {\n          this.logger.error(\"updateModelRendering\", { error })\n          this.event.emitError(error as Error)\n          deferred.reject(error as Error)\n        }\n      }, this.#configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.#configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve(this.model)\n    }\n    await deferred.promise\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"updateModelRendering\", this.model.exports)\n    return deferred.promise\n  }\n\n  async export(mimeTypes?: string[]): Promise<Model>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    const newModel = await this.recognizer.export(this.model.clone(), mimeTypes)\n    if (this.model.modificationDate === newModel.modificationDate) {\n      this.model.mergeExport(newModel.exports as TExport)\n    }\n    this.history.updateStack(newModel)\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"export\", this.model)\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState, mimeTypes?: string[] }): Promise<Model>\n  {\n    this.logger.info(\"convert\", { params })\n    const newModel = await this.recognizer.convert(this.model, params?.conversionState, params?.mimeTypes)\n    Object.assign(this.#model, newModel)\n    this.event.emitConverted(this.model.converts as TExport)\n    this.logger.debug(\"convert\", this.model)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<Model>\n  {\n    const errors: string[] = []\n    strokes.forEach((s, strokeIndex) =>\n    {\n      let flag = true\n      const stroke = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) stroke.id = s.id\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${ strokeIndex + 1 } has not pointers`)\n        flag = false\n        return\n      }\n      s.pointers?.forEach((pp, pIndex) =>\n      {\n        if (!pp) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no x at pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no y at pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          stroke.pointers.push(pointer)\n        }\n      })\n      if (flag) {\n        this.model.addStroke(stroke)\n      }\n    })\n\n    if (errors.length) {\n      this.event.emitError(new Error(errors.join(\"\\n\")))\n    }\n    try {\n      const newModel = await this.updateModelRendering()\n      Object.assign(this.#model, newModel)\n      this.event.emitImported(this.model.exports as TExport)\n      return this.model\n    } catch (error) {\n      this.event.emitError(error as Error)\n      throw error as Error\n    }\n  }\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    this.renderer.resize(this.model)\n    if (this.model.symbols.length) {\n      clearTimeout(this.#resizeTimer)\n      this.#resizeTimer = setTimeout(async () =>\n      {\n        const resizeModel = await this.recognizer.resize(this.model)\n        deferredResize.resolve(resizeModel)\n      }, this.#configuration.triggers.resizeTriggerDelay)\n    } else {\n      deferredResize.resolve(this.model)\n    }\n    this.#model = await deferredResize.promise\n    this.logger.debug(\"resize\", { model: this.model })\n    this.event.emitExported(this.model.exports as TExport)\n  }\n\n  async undo(): Promise<void>\n  {\n    this.logger.info(\"undo\")\n    this.#model = this.history.undo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"undo\", this.#model)\n  }\n\n  async redo(): Promise<void>\n  {\n    this.logger.info(\"redo\")\n    this.#model = this.history.redo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"redo\", this.#model)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    this.renderer.drawModel(this.model)\n    this.event.emitExported(this.model.exports as TExport)\n    this.event.emitCleared()\n    this.logger.debug(\"clear\", this.model)\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.grabber.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import style from \"./InteractiveInkSSRSmartGuide.css\"\nimport { InteractiveInkSSREditor } from \"../editor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { ExportType, TJIIXExport, TJIIXWord } from \"../model\"\nimport { convertMillimeterToPixel, createUUID } from \"../utils\"\nimport { TMarginConfiguration } from \"../recognizer\"\n\n/**\n * @group InteractiveInkSSRSmartGuide\n */\nexport class InteractiveInkSSRSmartGuide\n{\n  uuid: string\n  #smartGuideElement!: HTMLDivElement\n  #wrapperElement!: HTMLDivElement\n  #prompterContainerElement!: HTMLDivElement\n  #prompterTextElement!: HTMLDivElement\n  #ellipsisElement!: HTMLDivElement\n  #tagElement!: HTMLDivElement\n  #candidatesElement!: HTMLDivElement\n  #menuElement!: HTMLDivElement\n  #convertElement!: HTMLButtonElement\n  #copyElement!: HTMLButtonElement\n  #deleteElement!: HTMLButtonElement\n  #isMenuOpen!: boolean\n  editor: InteractiveInkSSREditor\n  margin: TMarginConfiguration\n  jiix?: TJIIXExport\n  lastWord?: TJIIXWord\n  wordToChange?: TJIIXWord\n  #logger = LoggerManager.getLogger(LoggerCategory.SMARTGUIDE)\n\n  constructor(editor: InteractiveInkSSREditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.uuid = createUUID()\n    this.editor = editor\n    this.margin = {\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0\n    }\n    this.#createRootElement()\n    this.#createWrapperElement()\n    this.#createPrompterContainerElement()\n    this.#createPrompterTextElement()\n    this.#createEllipsisElement()\n    this.#createTagElement()\n    this.#createCandidatesElement()\n    this.#createMoreMenuElement()\n    this.#createConvertElement()\n    this.#createCopyElement()\n    this.#createDeleteElement()\n  }\n\n  #createRootElement(): void\n  {\n    this.#smartGuideElement = document.createElement(\"div\")\n    this.#smartGuideElement.id = `smartguide-${ this.uuid }`\n    this.#smartGuideElement.classList.add(\"smartguide\")\n    this.#smartGuideElement.addEventListener(\"pointerdown\", e => {\n      e.preventDefault()\n      e.stopPropagation()\n    })\n  }\n\n  #createWrapperElement(): void\n  {\n    this.#wrapperElement = document.createElement(\"div\")\n    this.#wrapperElement.id = `smartguide-wrapper-${ this.uuid }`\n    this.#wrapperElement.classList.add(\"smartguide-wrapper\")\n  }\n\n  #createPrompterContainerElement(): void\n  {\n    this.#prompterContainerElement = document.createElement(\"div\")\n    this.#prompterContainerElement.id = `prompter-container-${ this.uuid }`\n    this.#prompterContainerElement.classList.add(\"prompter-container\")\n  }\n\n  #createPrompterTextElement(): void\n  {\n    this.#prompterTextElement = document.createElement(\"div\")\n    this.#prompterTextElement.id = `prompter-text-${ this.uuid }`\n    this.#prompterTextElement.classList.add(\"prompter-text\")\n    this.#prompterTextElement.setAttribute(\"touch-action\", \"none\")\n  }\n\n  #createEllipsisElement(): void\n  {\n    this.#ellipsisElement = document.createElement(\"div\")\n    this.#ellipsisElement.id = `ellipsis-${ this.uuid }`\n    this.#ellipsisElement.classList.add(\"ellipsis\")\n    this.#ellipsisElement.innerHTML = \"...\"\n  }\n\n  #createTagElement(): void\n  {\n    this.#tagElement = document.createElement(\"div\")\n    this.#tagElement.id = `tag-icon-${ this.uuid }`\n    this.#tagElement.classList.add(\"tag-icon\")\n    this.#tagElement.innerHTML = \"&#182;\"\n  }\n\n  #createCandidatesElement(): void\n  {\n    this.#candidatesElement = document.createElement(\"div\")\n    this.#candidatesElement.id = `candidates-${ this.uuid }`\n    this.#candidatesElement.classList.add(\"candidates\")\n  }\n\n  #createMoreMenuElement(): void\n  {\n    this.#menuElement = document.createElement(\"div\")\n    this.#menuElement.id = `more-menu-${ this.uuid }`\n    this.#menuElement.classList.add(\"more-menu\")\n  }\n\n  #createConvertElement(): void\n  {\n    this.#convertElement = document.createElement(\"button\")\n    this.#convertElement.id = `convert-${ this.uuid }`\n    this.#convertElement.classList.add(\"options-label-button\")\n    this.#convertElement.innerHTML = \"Convert\"\n  }\n\n  #createCopyElement(): void\n  {\n    this.#copyElement = document.createElement(\"button\")\n    this.#copyElement.id = `copy-${ this.uuid }`\n    this.#copyElement.classList.add(\"options-label-button\")\n    this.#copyElement.innerHTML = \"Copy\"\n  }\n\n  #createDeleteElement(): void\n  {\n    this.#deleteElement = document.createElement(\"button\")\n    this.#deleteElement.id = `delete-${ this.uuid }`\n    this.#deleteElement.classList.add(\"options-label-button\")\n    this.#deleteElement.innerHTML = \"Delete\"\n  }\n\n  init(domElement: HTMLElement, margin: TMarginConfiguration): void\n  {\n    this.#logger.info(\"init\", { domElement, margin })\n\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    domElement.appendChild(styleElement)\n\n\n    domElement.appendChild(this.#smartGuideElement)\n    this.#smartGuideElement.appendChild(this.#wrapperElement)\n\n    this.#wrapperElement.appendChild(this.#tagElement)\n\n    this.#prompterContainerElement.appendChild(this.#prompterTextElement)\n    this.#wrapperElement.appendChild(this.#prompterContainerElement)\n\n    this.#wrapperElement.appendChild(this.#ellipsisElement)\n\n    this.#menuElement.appendChild(this.#convertElement)\n    this.#menuElement.appendChild(this.#copyElement)\n    this.#menuElement.appendChild(this.#deleteElement)\n    this.#menuElement.classList.add(\"close\")\n    this.#wrapperElement.appendChild(this.#menuElement)\n    this.#isMenuOpen = false\n\n    this.#candidatesElement.style.display = \"none\"\n    this.#wrapperElement.appendChild(this.#candidatesElement)\n    this.margin = margin\n    this.#addListeners()\n\n    this.resize()\n  }\n\n  #showCandidates = (target: HTMLElement) =>\n  {\n    this.#logger.info(\"showCandidates\", { target })\n    const wordId = parseInt(target.id.replace(\"word-\", \"\").replace(this.uuid, \"\"))\n    const words = this.jiix?.words as TJIIXWord[]\n    this.wordToChange = words[wordId]\n    if (this.wordToChange) {\n      this.wordToChange.id = wordId.toString()\n      this.#candidatesElement.innerHTML = \"\"\n      if (this.wordToChange?.candidates) {\n        this.#candidatesElement.style.display = \"flex\"\n        this.wordToChange.candidates.forEach((word, index) =>\n        {\n          if (this.wordToChange?.label === word) {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\" class=\"selected-word\">${ word }</span>`\n          } else {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\">${ word }</span>`\n          }\n        })\n\n        target.appendChild(this.#candidatesElement)\n      }\n    }\n  }\n  #hideCandidates(): void\n  {\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #openMenu(): void\n  {\n    this.#menuElement.classList.add(\"open\")\n    this.#menuElement.classList.remove(\"close\")\n    this.#isMenuOpen = true\n  }\n  #closeMenu(): void\n  {\n    this.#menuElement.classList.add(\"close\")\n    this.#menuElement.classList.remove(\"open\")\n    this.#isMenuOpen = false\n  }\n\n  #onClickEllipsis = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickEllipsis\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    this.#isMenuOpen ? this.#closeMenu() : this.#openMenu()\n    this.#hideCandidates()\n  }\n\n  #onClickConvert = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickConvert\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.editor.convert()\n    this.#closeMenu()\n  }\n\n  #createTextAreaElement(value: string): HTMLTextAreaElement\n  {\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\"\n    const textArea = document.createElement(\"textarea\")\n    textArea.style.fontSize = \"12pt\"\n    textArea.style.display = \"absolute\"\n    textArea.style[isRTL ? \"right\" : \"left\"] = \"-9999px\"\n    const yPosition = window.pageYOffset || document.documentElement.scrollTop\n    textArea.style.top = `${ yPosition }px`\n    textArea.setAttribute(\"readonly\", \"\")\n    textArea.value = value\n    return textArea\n  }\n\n  #selectText(textArea: HTMLTextAreaElement)\n  {\n    if (navigator.userAgent.match(/ipad|iphone/i)) {\n      const range = document.createRange()\n      range.selectNodeContents(textArea)\n      const selection = window.getSelection()\n      if (selection) {\n        selection.removeAllRanges()\n        selection.addRange(range)\n        textArea.setSelectionRange(0, 999999)\n      }\n    } else {\n      textArea.select()\n    }\n  }\n\n  #onClickCopy = async (evt: Event): Promise<void> =>\n  {\n    this.#logger.info(\"onClickCopy\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    try {\n      this.#closeMenu()\n      let message = \"Nothing to copy\"\n      if (this.#prompterTextElement.innerText) {\n        message = `\"${ this.#prompterTextElement.innerText }\" copied to clipboard`\n        const fakeEl = this.#createTextAreaElement(this.#prompterTextElement.innerText)\n        this.#prompterContainerElement.appendChild(fakeEl)\n        this.#selectText(fakeEl)\n        document.execCommand(\"copy\")\n        fakeEl.remove()\n      }\n      this.editor.event.emitNotif({ message, timeout: 1500 })\n    } catch (error) {\n      this.#logger.error(\"onClickCopy\", error)\n      this.editor.event.emitError(error as Error)\n    }\n  }\n\n  #onClickDelete = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickDelete\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.editor.clear()\n    this.#closeMenu()\n  }\n\n  #onClickCandidate = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickCandidate\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    const target = evt.target as HTMLElement\n    const candidate = target.innerText\n    if (this.jiix?.words && candidate !== this.wordToChange?.label && this.wordToChange?.candidates?.includes(candidate)) {\n      this.jiix.words[parseInt(this.wordToChange?.id as string)].label = candidate\n      this.editor.import(new Blob([JSON.stringify(this.jiix)], { type: ExportType.JIIX }), ExportType.JIIX)\n    }\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #onClickPrompter = (evt: Event): void =>\n  {\n    this.#logger.info(\"onClickPrompter\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.#closeMenu()\n    const target = evt.target as HTMLElement\n    if (target.id !== this.#prompterTextElement.id) {\n      this.#showCandidates(target)\n    } else {\n      this.#hideCandidates()\n    }\n  }\n\n  #stopPropagation = (evt: Event) =>\n  {\n    evt.preventDefault()\n    evt.stopPropagation()\n  }\n\n  #onClickOutSide = () =>\n  {\n    this.#hideCandidates()\n    this.#closeMenu()\n  }\n\n  #addListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation.bind(this))\n    this.#ellipsisElement.addEventListener(\"pointerdown\", this.#onClickEllipsis.bind(this))\n    this.#convertElement.addEventListener(\"pointerdown\", this.#onClickConvert.bind(this))\n    this.#copyElement.addEventListener(\"pointerdown\", this.#onClickCopy.bind(this))\n    this.#deleteElement.addEventListener(\"pointerdown\", this.#onClickDelete.bind(this))\n    this.#prompterTextElement.addEventListener(\"pointerdown\", this.#onClickPrompter.bind(this))\n    this.#candidatesElement.addEventListener(\"pointerdown\", this.#onClickCandidate.bind(this))\n    document.addEventListener(\"pointerdown\", this.#onClickOutSide.bind(this))\n  }\n\n  #removeListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation)\n    this.#ellipsisElement.removeEventListener(\"pointerdown\", this.#onClickEllipsis)\n    this.#convertElement.removeEventListener(\"pointerdown\", this.#onClickConvert)\n    this.#copyElement.removeEventListener(\"pointerdown\", this.#onClickCopy)\n    this.#deleteElement.removeEventListener(\"pointerdown\", this.#onClickDelete)\n    this.#prompterTextElement.removeEventListener(\"pointerdown\", this.#onClickPrompter)\n    this.#candidatesElement.removeEventListener(\"pointerdown\", this.#onClickCandidate)\n    document.removeEventListener(\"pointerdown\", this.#onClickOutSide)\n  }\n\n  resize(): void\n  {\n    this.#logger.info(\"resize\")\n    const marginLeft = convertMillimeterToPixel(this.margin.left)\n    const marginRight = convertMillimeterToPixel(this.margin.right)\n    this.#wrapperElement.style.marginLeft = `${ marginLeft }px`\n    this.#wrapperElement.style.marginRight = `${ marginRight }px`\n  }\n\n  update(exports: TJIIXExport): void\n  {\n    this.#logger.info(\"update\", { exports })\n    this.jiix = exports\n    const createWordSpan = (index: number, word?: TJIIXWord) =>\n    {\n      const span = document.createElement(\"span\")\n      span.id = `word-${ index }${ this.uuid }`\n      if (word) {\n        span.textContent = word.label\n      } else {\n        span.innerHTML = \"&nbsp;\"\n      }\n      this.#logger.debug(\"update\", { span })\n      return span\n    }\n\n    const populatePrompter = () =>\n    {\n      this.#logger.info(\"populatePrompter\")\n      this.#prompterTextElement.innerHTML = \"\"\n      if (this.jiix?.words) {\n        const words = this.jiix.words as TJIIXWord[]\n        const myFragment = document.createDocumentFragment()\n        words.forEach((word, index) =>\n        {\n          if (word.label === \" \" || word.label.includes(\"\\n\")) {\n            myFragment.appendChild(createWordSpan(index))\n          } else if (index !== words.length - 1) {\n            myFragment.appendChild(createWordSpan(index, word))\n          } else {\n            this.#prompterTextElement.appendChild(myFragment)\n            if (this.lastWord) {\n              this.lastWord = word\n            }\n            const span = createWordSpan(index, word)\n            // This is used to scroll to last word if last word is modified\n\n            if ((this.lastWord?.candidates !== word.candidates) && (this.lastWord?.label !== word.label)) {\n              this.lastWord = word\n            }\n            if (this.wordToChange?.id === index.toString()) {\n              span.classList.add(\"modified-word\")\n              this.wordToChange = undefined\n            }\n            else {\n              span.classList.add(\"added-word\")\n            }\n            this.#prompterTextElement.appendChild(span)\n            this.#prompterContainerElement.scrollLeft = span.offsetLeft\n            this.#logger.debug(\"update => populatePrompter\", { span, lastWord: this.lastWord })\n          }\n        })\n      }\n    }\n    populatePrompter()\n    if (this.jiix?.words?.length) {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"auto\")\n    }\n    else {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"none\")\n    }\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.#prompterTextElement.innerHTML = \"\"\n    this.#candidatesElement.innerHTML = \"\"\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.#removeListeners()\n    this.#smartGuideElement.remove()\n  }\n}","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerWebSocketSSRConfiguration, TRecognizerWebSocketSSRRecognitionConfiguration, TRecognizerWebSocketSSRConfiguration, RecognizerWebSocketSSRConfiguration, TServerWebsocketConfiguration } from \"../recognizer\"\nimport { DefaultRendererConfiguration, TRendererConfiguration } from \"../renderer\"\nimport { DefaultTheme, TPenStyle, TTheme } from \"../style\"\nimport { mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaulTEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkSSREditorConfiguration = TEditorConfiguration & TRecognizerWebSocketSSRConfiguration & {\n  rendering: TRendererConfiguration\n  smartGuide: {\n    enable: boolean\n  },\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle,\n  penStyleClasses?: string\n  theme: TTheme\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInteractiveInkSSREditorConfiguration: TInteractiveInkSSREditorConfiguration = {\n  server: DefaultRecognizerWebSocketSSRConfiguration.server,\n  recognition: DefaultRecognizerWebSocketSSRConfiguration.recognition,\n  rendering: DefaultRendererConfiguration,\n  smartGuide: {\n    enable: true\n  },\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaulTEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: {},\n  theme: DefaultTheme\n}\n\n/**\n * @group Editor\n */\nexport class InteractiveInkSSREditorConfiguration implements TInteractiveInkSSREditorConfiguration\n{\n  server: TServerWebsocketConfiguration\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n  rendering: TRendererConfiguration\n  smartGuide: {\n    enable: boolean\n  }\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle\n  penStyleClasses?: string\n  theme: TTheme\n\n  constructor(configuration?: PartialDeep<TInteractiveInkSSREditorConfiguration>)\n  {\n    const { server, recognition } = new RecognizerWebSocketSSRConfiguration(configuration)\n    this.server = server\n    this.recognition = recognition\n\n    this.rendering = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.rendering, configuration?.rendering)\n    this.smartGuide = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.smartGuide, configuration?.smartGuide)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.grabber = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.grabber, configuration?.grabber)\n    this.triggers = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.penStyle, configuration?.penStyle)\n    this.penStyleClasses = configuration?.penStyleClasses || this.penStyleClasses\n    this.theme = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.theme, configuration?.theme)\n\n    if (this.recognition.type !== \"TEXT\") {\n      this.smartGuide.enable = false\n    }\n    if (this.smartGuide.enable && !this.recognition.text.mimeTypes.includes(\"application/vnd.myscript.jiix\")) {\n      this.recognition.text.mimeTypes.push(\"application/vnd.myscript.jiix\")\n    }\n\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TRecognizerWebSocketSSRMessageSVGPatch, RecognizerWebSocketSSR, DefaultMarginConfiguration, TConverstionState, TMarginConfiguration } from \"../recognizer\"\nimport { InteractiveInkSSRSmartGuide } from \"../smartguide\"\nimport { InteractiveInkSSRSVGRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager, THistoryContext } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { Stroke, TStroke, TPointer } from \"../symbol\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InteractiveInkSSREditorConfiguration } from \"./InteractiveInkSSREditorConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkSSREditorOptions = PartialDeep<EditorOptionsBase &\n  {\n    configuration: InteractiveInkSSREditorConfiguration\n  }> &\n  {\n    override?: {\n      grabber?: PointerEventGrabber\n      recognizer?: RecognizerWebSocketSSR\n    }\n  }\n\n/**\n * @group Editor\n */\nexport class InteractiveInkSSREditor extends AbstractEditor\n{\n  #configuration: InteractiveInkSSREditorConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n\n  smartGuide?: InteractiveInkSSRSmartGuide\n  grabber: PointerEventGrabber\n  renderer: InteractiveInkSSRSVGRenderer\n  recognizer: RecognizerWebSocketSSR\n  history: HistoryManager\n  styleManager: StyleManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInteractiveInkSSREditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InteractiveInkSSREditorConfiguration(options?.configuration)\n    this.styleManager = new StyleManager(options?.configuration?.penStyle, options?.configuration?.theme)\n\n    if (options?.override?.grabber) {\n      const CustomGrabber = options.override.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerWebSocketSSR\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerWebSocketSSR(this.#configuration)\n    }\n\n    this.renderer = new InteractiveInkSSRSVGRenderer(this.#configuration.rendering)\n\n    this.tool = EditorTool.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.recognizer.initialized.promise\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.setCursorStyle()\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get configuration(): InteractiveInkSSREditorConfiguration\n  {\n    return this.#configuration\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TPenStyle>)\n  {\n    this.logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n    this.logger.debug(\"setPenStyle\", this.styleManager.penStyle)\n    this.recognizer.setPenStyle(this.styleManager.penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  set penStyleClasses(penClass: string)\n  {\n    this.logger.info(\"setPenStyleClasses\", { penClass })\n    this.styleManager.setPenStyleClasses(penClass)\n    this.logger.debug(\"setPenStyleClasses\", this.styleManager.penStyleClasses)\n    this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n    this.logger.debug(\"setTheme\", this.styleManager.theme)\n    this.recognizer.setTheme(this.styleManager.theme)\n  }\n\n  protected async syncStyle(): Promise<void>\n  {\n    await Promise.all([\n      this.recognizer.setPenStyle(this.styleManager.penStyle),\n      this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses),\n      this.recognizer.setTheme(this.styleManager.theme)\n    ])\n  }\n\n  protected onExport(exports: TExport): void\n  {\n    this.logger.debug(\"onExport\", { exports })\n    if (this.smartGuide && exports?.[\"application/vnd.myscript.jiix\"]) {\n      const jjix = exports[\"application/vnd.myscript.jiix\"] as TJIIXExport\n      this.smartGuide.update(jjix)\n    }\n    this.model.mergeExport(exports)\n    this.event.emitExported(exports)\n  }\n\n  protected onPointerDown(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerDown\", { tool: this.tool, info })\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    this.model.initCurrentStroke(info.pointer, this.tool === EditorTool.Erase ? \"eraser\" : info.pointerType, style)\n    this.drawCurrentStroke()\n  }\n\n  protected onPointerMove(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerMove\", { tool: this.tool, info })\n    this.model.appendToCurrentStroke(info.pointer)\n    this.drawCurrentStroke()\n  }\n\n  protected async onPointerUp(info: PointerInfo): Promise<void>\n  {\n    try {\n      this.logger.info(\"onPointerUp\", { tool: this.tool, info })\n      this.model.endCurrentStroke(info.pointer)\n      await this.synchronizeModelWithBackend()\n    } catch (error) {\n      this.event.emitError(error as Error)\n    }\n  }\n\n  protected onSVGPatch(evt: TRecognizerWebSocketSSRMessageSVGPatch): void\n  {\n    this.logger.info(\"onSVGPatch\", { evt })\n    this.renderer.updatesLayer(evt.layer, evt.updates)\n  }\n\n  protected initializeSmartGuide(): void\n  {\n    this.smartGuide?.destroy()\n    this.logger.info(\"initializeSmartGuide\", { smartGuide: this.configuration.smartGuide })\n    if (this.configuration.smartGuide.enable) {\n      this.smartGuide = new InteractiveInkSSRSmartGuide(this)\n      let margin: TMarginConfiguration = DefaultMarginConfiguration\n      switch (this.configuration.recognition.type) {\n        case \"TEXT\":\n          margin = this.configuration.recognition.text.margin\n          break\n        case \"MATH\":\n          margin = this.configuration.recognition.math.margin\n          break\n      }\n      this.smartGuide.init(this.layers.ui.root, margin)\n    }\n  }\n\n  protected onContentChanged(undoRedoContext: THistoryContext): void\n  {\n    this.history.context = undoRedoContext\n    this.event.emitChanged(undoRedoContext)\n  }\n\n  protected onError(error: Error): void\n  {\n    this.layers.showMessageError(error)\n    this.event.emitError(error)\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.history.push(this.model)\n      this.renderer.init(this.layers.rendering)\n\n      this.grabber.attach(this.layers.rendering)\n      this.grabber.onPointerDown = this.onPointerDown.bind(this)\n      this.grabber.onPointerMove = this.onPointerMove.bind(this)\n      this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n      this.initializeSmartGuide()\n\n      if(!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n      await this.recognizer.init(this.model.height, this.model.width)\n      this.recognizer.event.addExportedListener(this.onExport.bind(this))\n      this.recognizer.event.addSVGPatchListener(this.onSVGPatch.bind(this))\n      this.recognizer.event.addContentChangedListener(this.onContentChanged.bind(this))\n      this.recognizer.event.addIdleListener(this.event.emitIdle.bind(this.event))\n      this.recognizer.event.addErrorListener(this.onError.bind(this))\n\n      await this.syncStyle()\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    const currentSymbol = this.model.currentSymbol as Stroke\n    if (currentSymbol) {\n      this.renderer.drawPendingStroke(currentSymbol)\n    }\n  }\n\n  async synchronizeModelWithBackend(): Promise<Model>\n  {\n    this.logger.info(\"synchronizeModelWithBackend\")\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      const unsentStrokes = this.model.extractUnsentStrokes()\n      this.model.updatePositionSent()\n      this.history.push(this.model)\n      this.renderer.clearErasingStrokes()\n      const exports = await this.recognizer.addStrokes(unsentStrokes)\n      this.model.mergeExport(exports)\n      this.history.updateStack(this.model)\n    }\n    this.logger.debug(\"synchronizeModelWithBackend\", this.model)\n    return this.model\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async export(mimeTypes?: string[]): Promise<Model>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    try {\n      if (this.#configuration.triggers.exportContent === \"DEMAND\") {\n        const unsentStrokes = this.model.extractUnsentStrokes()\n        this.history.push(this.model)\n        this.history.stack.push(this.model.clone())\n        this.model.updatePositionSent()\n        const exports = await this.recognizer.addStrokes(unsentStrokes)\n        this.model.updatePositionReceived()\n        this.model.mergeExport(exports)\n        this.logger.debug(\"export\", this.model)\n      } else {\n        return await this.recognizer.export(this.model, mimeTypes)\n      }\n    } catch (error) {\n      this.logger.error(\"export\", { error })\n      this.event.emitError(error as Error)\n      return Promise.reject(error)\n    }\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState }): Promise<Model>\n  {\n    this.logger.info(\"convert\", { params })\n    this.history.push(this.model)\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.convert(this.model, params?.conversionState)\n    this.logger.debug(\"convert\", this.model)\n    this.history.push(this.model)\n    this.event.emitConverted(this.model.converts as TExport)\n    return this.model\n  }\n\n  async import(data: Blob | string | TJIIXExport, mimeType?: string): Promise<Model>\n  {\n    let blobToImport: Blob\n    if (data instanceof Blob) {\n      blobToImport = data\n    }\n    else if (typeof data === \"string\") {\n      blobToImport = new Blob([data])\n    }\n    else {\n      blobToImport = new Blob([JSON.stringify(data)])\n    }\n    this.logger.info(\"import\", { data, mimeType })\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.import(this.model, blobToImport, mimeType)\n    this.history.push(this.model)\n    this.event.emitImported(this.model.exports as TExport)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<Model>\n  {\n    this.logger.info(\"importPointEvents\", { strokes })\n    const errors: string[] = []\n    const strokesToImport = strokes.map((s, strokeIndex) =>\n    {\n      const str = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) str.id = s.id\n      if (s.pointerType) str.pointerType = s.pointerType\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${ strokeIndex + 1 } has not pointers`)\n      }\n      let flag = true\n      s.pointers?.forEach((pp, pIndex) =>\n      {\n        flag = true\n        if (!pp) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no pointer at ${ pIndex }`)\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no x at pointer at ${ pIndex }`)\n          flag = false\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no y at pointer at ${ pIndex }`)\n          flag = false\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          str.pointers.push(pointer)\n        }\n      })\n      return str\n    })\n    if (errors.length) {\n      this.event.emitError(new Error(errors.join(\"\\n\")))\n    }\n    strokesToImport.map(s => this.model.addStroke(s))\n    const exportPoints = await this.recognizer.importPointEvents(strokesToImport)\n    this.model.mergeExport(exportPoints)\n    this.event.emitImported(this.model.exports as TExport)\n    this.logger.debug(\"importPointEvents\", this.model)\n    return this.model\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    const clonedModel = this.model.clone()\n    this.renderer.resize(clonedModel)\n    clearTimeout(this.#resizeTimer)\n    this.#resizeTimer = setTimeout(async () =>\n    {\n      try {\n        const resizeModel = await this.recognizer.resize(clonedModel)\n        deferredResize.resolve(resizeModel)\n      } catch (error) {\n        this.logger.error(\"resize\", { height, width, error })\n        deferredResize.reject(error as Error)\n      }\n    }, this.#configuration.triggers.resizeTriggerDelay)\n\n    this.#model = await deferredResize.promise\n    this.smartGuide?.resize()\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"resize\", this.model)\n  }\n\n  async undo(): Promise<Model>\n  {\n    this.logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.#model = this.history.undo() as Model\n      return this.recognizer.undo(this.model)\n    }\n    else {\n      throw new Error(\"Undo not allowed\")\n    }\n  }\n\n  async redo(): Promise<Model>\n  {\n    this.logger.info(\"redo\")\n    if (this.history.context.canRedo) {\n      this.#model = this.history.redo() as Model\n      this.logger.debug(\"undo\", this.#model)\n      return this.recognizer.redo(this.model)\n    }\n    else {\n      throw new Error(\"Redo not allowed\")\n    }\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    await this.recognizer.clear(this.model)\n    this.event.emitCleared()\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.grabber.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    this.recognizer.destroy()\n    this.smartGuide?.destroy()\n    return Promise.resolve()\n  }\n}\n","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerHTTPV2Configuration, RecognizerHTTPV2Configuration, TRecognizerHTTPV2Configuration, TRecognizerHTTPV2RecognitionConfiguration, TServerHTTPConfiguration } from \"../recognizer\"\nimport { DefaultIIRendererConfiguration, TIIRendererConfiguration } from \"../renderer\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { convertPixelToMillimeter, mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaulTEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n\n/**\n * @group Editor\n */\nexport type TInkEditorConfiguration = TEditorConfiguration & TRecognizerHTTPV2Configuration & {\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TStyle\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInkEditorConfiguration: TInkEditorConfiguration = {\n  server: DefaultRecognizerHTTPV2Configuration.server,\n  recognition: DefaultRecognizerHTTPV2Configuration.recognition,\n  rendering: DefaultIIRendererConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaulTEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: DefaultStyle,\n}\n\n/**\n * @group Editor\n */\nexport class InkEditorConfiguration implements TInkEditorConfiguration\n{\n  server: TServerHTTPConfiguration\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TStyle\n\n  constructor(configuration?: PartialDeep<InkEditorConfiguration>)\n  {\n    const { server, recognition } = new RecognizerHTTPV2Configuration(configuration)\n    this.server = server\n    this.recognition = recognition\n    this.rendering = mergeDeep({}, DefaultInkEditorConfiguration.rendering, configuration?.rendering)\n    this.recognition.text.guides.enable = this.rendering.guides.enable\n    if (this.rendering.guides.enable)\n    {\n      this.recognition.text.guides[\"line-gap-mm\"] = convertPixelToMillimeter(this.rendering.guides.gap)\n    }\n    this.grabber = mergeDeep({}, DefaultInkEditorConfiguration.grabber, configuration?.grabber)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInkEditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.triggers = mergeDeep({}, DefaultInkEditorConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInkEditorConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInkEditorConfiguration.penStyle, configuration?.penStyle)\n  }\n}\n","import { InkEditor } from \"../editor\";\nimport { PointerInfo } from \"../grabber\";\nimport { IModel } from \"../model\";\nimport { TStyle } from \"../style\";\nimport { IIStroke, SymbolType, TIISymbol, TPointer } from \"../symbol\";\nimport { DeferredPromise } from \"../utils\";\nimport { AbstractWriterManager } from \"./AbstractWriterManager\";\n\nexport class IWriterManager extends AbstractWriterManager {\n  editor: InkEditor\n  #exportTimer?: ReturnType<typeof setTimeout>\n\n  constructor(editor: InkEditor) {\n    super(editor)\n    this.editor = editor\n  }\n\n  get model(): IModel {\n    return this.editor.model\n  }\n\n  protected createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol {\n    this.model.currentStroke = new IIStroke(style, pointerType)\n    this.model.currentStroke.addPointer(pointer)\n    return this.model.currentStroke\n  }\n\n  protected updateCurrentSymbol(pointer: TPointer): IIStroke {\n    if (this.model.currentStroke?.type === SymbolType.Stroke) {\n      this.model.currentStroke.addPointer(pointer)\n    }\n    return this.model.currentStroke!\n  }\n\n  async end(info: PointerInfo): Promise<void> {\n    const localPointer = info.pointer\n    const localSymbol = this.updateCurrentSymbol(localPointer)\n    this.model.currentStroke = undefined\n    this.renderer.drawSymbol(localSymbol)\n    this.model.addStroke(localSymbol)\n    this.editor.history.push(this.model, { added: [localSymbol] })\n    const deferred = new DeferredPromise<void>()\n\n    if (this.editor.configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      this.#exportTimer = setTimeout(async () => {\n        this.editor.export()\n      }, this.editor.configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.editor.configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve()\n    }\n    return deferred.promise\n\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber } from \"../grabber\"\nimport { IModel, TExport, TExportV2 } from \"../model\"\nimport { RecognizerHTTPV2 } from \"../recognizer\"\nimport { SVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { IHistoryManager } from \"../history\"\nimport { PartialDeep } from \"../utils\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InkEditorConfiguration, TInkEditorConfiguration } from \"./InkEditorConfiguration\"\nimport { IWriterManager } from \"../manager/IWriterManager\"\nimport { IDebugSVGManager, EraseManager } from \"../manager\"\n\n/**\n * @group Editor\n */\nexport type TInkEditorOptions = PartialDeep<EditorOptionsBase &\n{\n  configuration: TInkEditorConfiguration\n}> &\n{\n  override?: {\n    grabber?: PointerEventGrabber\n    recognizer?: RecognizerHTTPV2\n  }\n}\n\n/**\n * @group Editor\n */\nexport class InkEditor extends AbstractEditor\n{\n  #configuration: InkEditorConfiguration\n  #model: IModel\n  #penStyle: TStyle\n  renderer: SVGRenderer\n  recognizer: RecognizerHTTPV2\n  history: IHistoryManager\n  writer: IWriterManager\n  eraser: EraseManager\n  debugger: IDebugSVGManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInkEditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InkEditorConfiguration(options?.configuration)\n\n    this.#penStyle = Object.assign({}, this.#configuration.penStyle)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerHTTPV2\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerHTTPV2(this.#configuration)\n    }\n    this.renderer = new SVGRenderer(this.#configuration.rendering)\n\n    this.#model = new IModel()\n    this.writer = new IWriterManager(this)\n    this.eraser = new EraseManager(this)\n    this.debugger = new IDebugSVGManager(this)\n    this.tool = EditorTool.Write\n    this.history = new IHistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  get penStyle(): TStyle\n  {\n    return this.#penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TStyle>)\n  {\n    this.logger.info(\"set penStyle\", { penStyle })\n    this.#penStyle = Object.assign({}, this.#penStyle, penStyle)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return Promise.resolve()\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.writer.detach()\n    this.eraser.detach()\n\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.eraser.attach(this.layers.root)\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.writer.attach(this.layers.root)\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n\n  }\n\n  get model(): IModel\n  {\n    return this.#model\n  }\n\n  get configuration(): InkEditorConfiguration\n  {\n    return this.#configuration\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n      this.tool = EditorTool.Write\n      this.renderer.init(this.layers.rendering)\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.model.rowHeight = this.configuration.rendering.guides.gap\n      this.history.init(this.model)\n\n      if (!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  //updateBoundingBox\n  updateSymbolsStyle(symbolIds: string[], style: PartialDeep<TStyle>): void\n  {\n    this.logger.info(\"updateSymbolsStyle\", { symbolIds, style })\n    this.model.strokes.forEach(s =>\n    {\n      if (symbolIds.includes(s.id)) {\n        s.style = Object.assign({}, s.style, style)\n        this.renderer.drawSymbol(s)\n        this.model.updateStroke(s)\n        s.modificationDate = Date.now()\n      }\n    })\n  }\n\n  async export(requestedMimeTypes?: string[]): Promise<TExportV2>\n  {\n    try {\n      this.logger.info(\"export\")\n      const currentModel = this.model.clone()\n\n      const exports = await this.recognizer.send(currentModel.strokes, requestedMimeTypes)\n      currentModel.mergeExport(exports)\n      if (this.model.modificationDate === currentModel.modificationDate) {\n        this.model.exports = currentModel.exports\n      }\n      this.history.updateModelStack(currentModel)\n      this.event.emitExported(this.model.exports || {})\n      if (this.debugger.recognitionBoxItemsVisibility) {\n        this.debugger.debugRecognitionBoxItems()\n      }\n      if (this.debugger.recognitionBoxVisibility) {\n        this.debugger.debugRecognitionBox()\n      }\n      return exports\n    } catch (error) {\n      this.logger.error(\"export\", error)\n      this.layers.showMessageError(error as Error)\n      this.event.emitError(error as Error)\n      throw error\n    }\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    this.renderer.resize(this.model.height, this.model.width)\n    this.logger.debug(\"resize\", { model: this.model })\n    this.event.emitExported(this.model.exports || {})\n  }\n\n  async removeStrokes(strokeIds: string[]): Promise<void>\n  {\n    this.logger.info(\"removeStrokes\", { strokeIds })\n    const removedStrokes = this.model.strokes.filter(s => strokeIds.includes(s.id))\n    if (removedStrokes.length === 0) {\n      this.logger.warn(\"removeStrokes\", \"No strokes found to remove\")\n      return\n    }\n    this.#model = this.model.clone()\n    removedStrokes.forEach(s => {\n      this.renderer.removeSymbol(s.id)\n      this.model.removeStroke(s.id)\n    })\n    this.history.push(this.#model, { removed: removedStrokes })\n    const exports = await this.recognizer.send(this.model.strokes)\n    this.model.mergeExport(exports)\n    this.history.updateModelStack(this.model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"removeStrokes\", { model: this.#model })\n  }\n\n  async undo(): Promise<void>\n  {\n    this.logger.info(\"undo\")\n    const previousStackItem = this.history.undo()\n    const modifications = previousStackItem.model.extractDifferenceStrokes(this.model)\n    this.#model = previousStackItem.model.clone()\n    modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n    modifications.added.forEach(s => this.renderer.drawSymbol(s))\n    await this.export()\n  }\n\n  async redo(): Promise<void>\n  {\n    this.logger.info(\"redo\")\n    const previousStackItem = this.history.redo()\n    const modifications = previousStackItem.model.extractDifferenceStrokes(this.model)\n    this.#model = previousStackItem.model.clone()\n    modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n    modifications.added.forEach(s => this.renderer.drawSymbol(s))\n    await this.export()\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    const erased = this.model.strokes\n    this.model.clear()\n    this.history.push(this.model, { removed: erased })\n    this.renderer.clear()\n    this.event.emitExported(this.#model.exports as TExport)\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.writer.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { EditorType } from \"./AbstractEditor\"\nimport { InteractiveInkEditor, TInteractiveInkEditorOptions } from \"./InteractiveInkEditor\"\nimport { InkEditorDeprecated, TInkEditorDeprecatedOptions } from \"./InkEditorDeprecated\"\nimport { InteractiveInkSSREditor, TInteractiveInkSSREditorOptions } from \"./InteractiveInkSSREditor\"\nimport { InkEditor, TInkEditorOptions } from \"./InkEditor\"\n\n/**\n * @group Editor\n * @hideconstructor\n */\nexport class Editor\n{\n  protected static logger = LoggerManager.getLogger(LoggerCategory.EDITOR)\n  protected static instance: InteractiveInkEditor | InkEditorDeprecated | InteractiveInkSSREditor | InkEditor |undefined\n\n  static async load<T extends EditorType>(rootElement: HTMLElement, type: T, options: T extends \"INTERACTIVEINK\" ? TInteractiveInkEditorOptions : T extends \"INKV1\" ? TInkEditorDeprecatedOptions : TInteractiveInkSSREditorOptions extends \"INKV2\" ? TInkEditorOptions : TInteractiveInkSSREditorOptions):\n    Promise<T extends \"INTERACTIVEINK\" ? InteractiveInkEditor : T extends \"INKV1\" ? InkEditorDeprecated : InteractiveInkSSREditor extends \"INKV2\" ? InkEditor : InteractiveInkSSREditor>\n  {\n    Editor.logger.info(\"load\", { type, options })\n    if (!options) {\n        throw new Error(`Param 'options' missing`)\n    }\n    if (Editor.instance) {\n      await Editor.instance.destroy()\n    }\n\n    switch (type) {\n      case \"INTERACTIVEINK\":\n        Editor.instance = new InteractiveInkEditor(rootElement, options as TInteractiveInkEditorOptions)\n        break\n      case \"INKV1\":\n        Editor.instance = new InkEditorDeprecated(rootElement, options as TInkEditorDeprecatedOptions)\n        break\n      case \"INKV2\":\n        Editor.instance = new InkEditor(rootElement, options as TInkEditorOptions)\n        break;\n      // case \"INTERACTIVEINKSSR\":\n      default:\n        Editor.instance = new InteractiveInkSSREditor(rootElement, options as TInteractiveInkSSREditorOptions)\n        break\n    }\n\n    await Editor.instance.initialize()\n\n    return Editor.instance as T extends \"INTERACTIVEINK\" ? InteractiveInkEditor : T extends \"INKV1\" ? InkEditorDeprecated : InteractiveInkSSREditor extends \"INKV2\" ? InkEditor : InteractiveInkSSREditor\n  }\n\n  static getInstance(): InteractiveInkEditor | InkEditorDeprecated | InteractiveInkSSREditor | InkEditor | undefined\n  {\n    return Editor.instance\n  }\n\n}\n","\n/**\n * @group Recognizer\n */\nexport type TConvertionConfiguration = {\n    force?: {\n        \"on-stylesheet-change\": boolean\n    }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultConvertionConfiguration: TConvertionConfiguration = {\n    force: {\n        \"on-stylesheet-change\": false\n    }\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableFontList(configuration: PartialDeep<{ server: TServerHTTPConfiguration, recognition: { lang: string }}>): Promise<Array<string>>\n{\n  if (!configuration?.server?.scheme && !configuration?.server?.host) {\n    return Promise.reject(\"Failed to get fonts: configuration.server.scheme & configuration.server.host are required!\")\n  }\n  if (!configuration?.recognition?.lang) {\n    return Promise.reject(\"Failed to get fonts: configuration.recognition.lang is required!\")\n  }\n  const serverConfig = configuration.server\n  const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/font/google/language/` + configuration.recognition.lang)\n  const { result } = await response.json()\n  return result.sort()\n}\n"],"names":["EditorTool","EditorWriteTool","SvgElementRole","ResizeDirection","SELECTION_MARGIN","DeferredPromise","promise","resolve","reject","isFullFilled","isPending","constructor","this","Promise","async","v","isValidNumber","x","isNaN","parseFloat","toString","isFinite","isBetween","val","min","max","computeAverage","arr","reduce","p","c","length","computeDistance","p1","p2","distance","Math","hypot","y","computeAngleAxeRadian","begin","end","atan2","scalaire","v1","v2","computeNearestPointOnSegment","seg","vectP1P","vectP1P2","scalaireP1P_P1P2","scalaireP1P2_P1P2","t","convertRadianToDegree","radian","PI","toFixed","convertDegreeToRadian","degree","computeRotatedPoint","point","center","dx","dy","cos","sin","computePointOnEllipse","radiusX","radiusY","phi","theta","cosPhi","sinPhi","M","abs","N","findIntersectionBetween2Segment","seg1","seg2","S1dx","S1dy","S2dx","S2dy","S1S2dx","S1S2dy","ua_t","ub_t","u_b","ua","ub","findIntersectBetweenSegmentAndCircle","r","result","a","pow","b","cc","deter","e","sqrt","u1","u2","push","computeAngleRadian","p1c","p2c","p1p2","acos","getClosestPoints","points1","points2","minDistance","Number","MAX_SAFE_INTEGER","forEach","_p1","_p2","d","getClosestPoint","points","closest","index","i","isPointInsidePolygon","inside","j","isVersionSuperiorOrEqual","source","target","sourceParts","split","targetParts","computeHmac","message","applicationKey","hmacKey","enc","TextEncoder","messageEncoded","encode","keyEncoded","key","crypto","subtle","importKey","name","hash","signature","sign","buffer","Uint8Array","Array","prototype","map","call","padStart","join","convertMillimeterToPixel","mm","convertPixelToMillimeter","px","convertBoundingBoxMillimeterToPixel","box","width","height","createUUID","dt","Date","now","replace","random","floor","mergeDeep","sources","isObject","item","isArray","shift","Object","assign","concat","isDeepEqual","object1","object2","objKeys1","keys","objKeys2","value1","value2","isObjects","object","getAvailableLanguageList","configuration","server","scheme","host","serverConfig","fetch","json","computeLinksPointers","angle","radius","computeMiddlePointer","point1","point2","getApiInfos","response","ok","version","gitCommit","nativeVersion","LoggerLevel","LoggerCategory","Logger","category","level","debug","functionName","data","DEBUG","dataLog","from","console","info","INFO","warn","WARN","error","LoggerManager","static","Map","getLogger","loggerMap","has","set","ERROR","get","setLoggerLevel","config","lc","DefaultLoggerConfiguration","EDITOR","RECOGNIZER","GRABBER","RENDERER","EDITOR_EVENT","MODEL","SYMBOL","SMARTGUIDE","GESTURE","STYLE","HISTORY","TRANSFORMER","CONVERTER","WRITE","SELECTION","SVGDEBUG","MENU","EditorEventName","EditorEvent","EventTarget","logger","abortController","element","super","AbortController","removeAllListeners","abort","emit","type","evt","CustomEvent","bubbles","composed","detail","undefined","dispatchEvent","emitSessionOpened","sessionId","SESSION_OPENED","addSessionOpenedListener","callback","addEventListener","signal","emitLoaded","LOADED","addLoadedListener","emitNotif","notif","NOTIF","addNotifListener","emitError","err","addErrorListener","emitExported","exports","EXPORTED","addExportedListener","emitChanged","undoRedoContext","CHANGED","canClear","empty","addChangedListener","emitIdle","idle","IDLE","addIdleListener","emitCleared","CLEARED","addClearedListener","emitConverted","CONVERTED","addConvertedListener","emitImported","IMPORTED","addImportedListener","emitSelected","symbols","SELECTED","addSelectedListener","emitToolChanged","mode","TOOL_CHANGED","addToolChangedListener","emitUIpdated","UI_UPDATED","addUIpdatedListener","emitSynchronized","SYNCHRONIZED","addSynchronizedListener","emitGestured","gesture","GESTURED","addGesturedListener","ExportType","JIIXELementType","JIIXNodeKind","JIIXEdgeKind","ExportV2Type","JIIXV2ShapeKind","EditorLayer","root","ui","rendering","onCloseModal","rootClassCss","classList","add","createLayerRender","createLayerUI","render","styleElement","document","createElement","appendChild","createTextNode","prepend","createLoader","loaderHTML","style","display","showLoader","loader","hideLoader","createMessageOverlay","overlay","closeMessageModal","modal","contains","hideMessageModal","text","innerText","remove","createMessageModal","closeBtn","bind","createMessage","showMessageInfo","setTimeout","timeout","showMessageError","createBusy","busy","createState","showState","state","hideState","updateState","destroy","lastChild","removeChild","AbstractEditor","layers","event","loggerConfiguration","rootElement","options","override","cssClass","editor","loggerConfig","loadInfo","Box","boundindBox","Error","createFromBoxes","boxes","createFromPoints","getCorners","getSide","getCenter","getSides","vertices","isContained","wrapper","containsPoint","child","overlaps","box1","box2","xMin","xMid","xMax","yMin","yMid","yMax","corners","side","snapPoints","boundaries","DefaultStyle","color","DefaultPenStyle","DefaultTheme","ink","module","o","n","l","m","defineProperty","configurable","enumerable","__esModule","default","hasOwnProperty","s","TypeError","value","Symbol","iterator","toJSON","u","trim","indexOf","substring","_trimSemiColon","toCSS","slice","parser","JsonCSS","StyleHelper","themeToCSS","themeToJSON","theme","penStyleToCSS","penStyle","css","penStyleToJSON","penStyleString","stringToJSON","JSONToString","entries","k","StyleManager","penStyleClasses","currentPenStyle","setTheme","setPenStyleClasses","setPenStyle","structuredClone","penStyleClass","DecoratorKind","SymbolType","EdgeKind","ShapeKind","RecognizedKind","IIDecorator","id","kind","clone","MatrixTransform","xx","yx","xy","yy","tx","ty","identity","applyToPoint","mat","rotation","hypotAc","hypotBd","toCssString","matrix","invert","denom","multiply","translate","rotate","cosAngle","round","sinAngle","scale","IISymbolBase","creationTime","modificationDate","selected","deleting","transform","opacity","edges","isClosed","isIntersected","some","edge","EdgeDecoration","OIEdgeBase","startDecoration","endDecoration","Edge","bounds","bb","e1","e2","isValidPoint","IIEdgeArc","startAngle","sweepAngle","_vertices","Arc","verticesId","computedVertices","nbVertices","angleStep","endAngle","at","create","partial","arc","IIEdgeLine","start","Line","line","IIEdgePolyLine","PolyEdge","polyline","OIShapeBase","Shape","IIShapeCircle","_bounds","Circle","computedBondingBox","firstPoint","perimeter","nbPoint","rad","boundingBox","createBetweenPoints","origin","updateBetweenPoints","circle","IIShapeEllipse","orientation","Ellipse","ellipse","IIShapePolygon","Polygon","polygon","createTriangleBetweenPoints","updateTriangleBetweenPoints","poly","createParallelogramBetweenPoints","updateParallelogramBetweenPoints","createRectangleBetweenPoints","updateRectangleBetweenPoints","createRhombusBetweenPoints","updateRhombusBetweenPoints","IIStroke","pointerType","decorators","pointers","Stroke","strokeToSplit","before","after","substract","stroke","partStroke","lastPointBeforeStroke","closestLastPointBeforeStroke","newStrokes","strokeAfter","firstPointAfterStroke","closestFirstPointStrokeAfter","computePressure","ratio","pressure","filterPointByAcquisitionDelta","lastPointer","delta","addPointer","pointer","formatToSend","errors","flag","pp","pIndex","convertPartialStrokesToOIStrokes","strokes","IIRecognizedBase","Recognized","flatMap","updateChildrenStyle","containsStroke","strokeId","removeStrokes","strokeIds","strokeRemoved","filter","includes","IIRecognizedArc","JSON","parse","stringify","ws","IIRecognizedCircle","IIRecognizedEllipse","IIRecognizedLine","IIRecognizedPolyLine","IIRecognizedPolygon","Polygone","IIRecognizedText","baseline","xHeight","label","lines","Text","IISymbolGroup","children","Group","chars","containsSymbol","containsOnlyStroke","extractText","extractStrokes","removeChilds","symbolIds","group","every","texts","symbolId","symbol","s1","IIText","offsetY","getCharCorners","char","boxBox","updateChildrenFont","fontSize","fontWeight","getCharsOverlaps","charCorners","fill","IIEraser","Eraser","Model","positions","currentSymbol","converts","rowHeight","creationDate","lastSentPosition","lastReceivedPosition","globalDistance","getStrokeFromPoint","_strokeList","strokePointer","addPoint","addStroke","updateStroke","updatedStroke","strokeIndex","findIndex","splice","removeStroke","removeStrokesFromPoint","strokeToRemove","extractUnsentStrokes","initCurrentStroke","dpi","pxWidth","appendToCurrentStroke","endCurrentStroke","updatePositionSent","position","updatePositionReceived","mergeExport","mergeConvert","clonedModel","clear","IIModel","symbolsSelected","symbolsToDelete","selectSymbol","find","unselectSymbol","resetSelection","getRootSymbol","getSymbolRowIndex","getSymbolsByRowOrdered","rows","rowIndex","row","sort","s2","r1","r2","roundToLineGuide","isSymbolAbove","isSymbolInRow","isSymbolBelow","getFirstSymbol","previous","current","getLastSymbol","addSymbol","updateSymbol","updatedSymbol","sIndex","replaceSymbol","changeOrderSymbol","fromIndex","toIndex","sym","removeSymbol","symbolIndex","extractDifferenceSymbols","model","added","removed","IModel","currentStroke","strokesToDelete","extractDifferenceStrokes","DefaultServerHTTPConfiguration","DefaultServerWebsocketConfiguration","websocket","pingEnabled","pingDelay","maxPingLostCount","autoReconnect","maxRetryCount","fileChunkSize","DefaultEraserConfiguration","DefaultDiagramConvertConfiguration","types","DefaultDiagramConfiguration","convert","eraser","mimeTypes","DefaultJiixConfiguration","ids","words","DefaultExportConfiguration","jiix","DefaultMarginConfiguration","top","left","right","bottom","DefaultSolverConfiguration","enable","DefaultMathUndoRedoConfiguration","DefaultMathConfiguration","solver","margin","DefaultRawContentConfiguration","recognition","classification","DefaultDebugConfiguration","DefaultRecognitionRendererConfiguration","DefaultTextGuidesConfiguration","DefaultTextConfiguration","guides","DefaultTextGuidesConfigurationV2","DefaultTexConfigurationV2","DefaultShapeConvertConfiguration","DefaultShapeBeautificationConfiguration","DefaultShapeConfiguration","beautification","DefaultMathV2Configuration","DefaultRawContentV2Configuration","RecognizerEventName","RecognizerError","RecognizerEvent","emitStartInitialization","START_INITIALIZATION","addStartInitialization","emitEndtInitialization","END_INITIALIZATION","addEndInitialization","emitContentChanged","CONTENT_CHANGED","addContentChangedListener","emitConnectionClose","code","CONNECTION_CLOSE","addConnectionCloseListener","emitSVGPatch","svgPatch","SVG_PATCH","addSVGPatchListener","DefaulRecognitionHTTPV1ConfigurationConfiguration","export","math","diagram","renderer","lang","DefaultRecognizerHTTPV1Configuration","RecognizerHTTPV1Configuration","Set","RecognizerHTTPV1","url","postConfig","buildData","strokeGroupByPenStyle","groupIndex","sg","isPenStyleEqual","ps1","ps2","strokeGroupsToSend","newGroup","contentType","charAt","toUpperCase","toLowerCase","xDPI","yDPI","strokeGroups","post","mimeType","headers","Headers","append","hmac","reqInit","method","body","credentials","request","Request","blob","catch","tryFetch","then","res","UNKNOW","WRONG_CREDENTIALS","CANT_ESTABLISH","getMimeTypes","requestedMimeTypes","conversionState","myModel","dataToConcert","promises","mt","all","String","mimeTypesRequiringExport","resize","DefaultRecognizerHTTPV2RecognitionConfiguration","shape","DefaultRecognizerHTTPV2Configuration","RecognizerHTTPV2Configuration","RecognizerHTTPV2","formatStrokes","scaleX","scaleY","send","TRecognizerWebSocketMessageType","DefaultRecognitionWebSocketConfiguration","gestures","ignoreGestureStrokes","DefaultRecognizerWebSocketConfiguration","RecognizerWebSocketConfiguration","RecognizerWebSocket","socket","pingWorker","pingCount","reconnectionCount","currentPartId","currentErrorCode","addStrokeDeferred","contextlessGestureDeferred","transformStrokeDeferred","eraseStrokeDeferred","replaceStrokeDeferred","exportDeferredMap","closeDeferred","waitForIdleDeferred","undoDeferred","redoDeferred","clearDeferred","initialized","readyState","OPEN","rejectDeferredPending","values","resetAllDeferred","clearSocketListener","removeEventListener","openCallback","closeCallback","messageCallback","reason","GOING_AWAY","PROTOCOL_ERROR","UNSUPPORTED_DATA","ABNORMAL_CLOSURE","INVALID_FRAME_PAYLOAD","POLICY_VIOLATION","MESSAGE_TOO_BIG","INTERNAL_ERROR","SERVICE_RESTART","TRY_AGAIN","BAD_GATEWAY","TLS_HANDSHAKE","terminate","manageHMACChallenge","hmacChallengeMessage","hmacChallenge","initPing","PingWorker","postMessage","onmessage","close","manageAuthenticated","pixelTomm","iinkSessionId","manageSessionDescriptionMessage","sessionDescriptionMessage","manageNewPartMessage","newPartMessage","managePartChangeMessage","partChangeMessage","partId","manageContentChangedMessage","contentChangeMessage","canRedo","canUndo","manageExportMessage","exportMessage","manageWaitForIdle","manageErrorMessage","errorMessage","NO_ACTIVITY","TOO_OLD","NO_SESSION_FOUND","manageGestureDetected","gestureMessage","manageContextlessGesture","websocketMessage","Pong","HMAC_Challenge","Authenticated","SessionDescription","NewPart","PartChanged","ContentChanged","Exported","GestureDetected","ContextlessGesture","Idle","newSession","init","WebSocket","CONNECTING","CLOSING","CLOSED","waitForIdle","buildAddStrokesMessage","processGestures","addStrokes","buildReplaceStrokesMessage","oldStrokeIds","replaceStrokes","buildTransformTranslateMessage","transformationType","transformTranslate","buildTransformRotateMessage","x0","y0","transformRotate","buildTransformScaleMessage","transformScale","buildTransformMatrixMessage","transformMatrix","buildEraseStrokesMessage","eraseStrokes","recognizeGesture","buildUndoRedoChanges","changes","changesMessages","erased","replaced","oldStrokes","tr","undo","actions","redo","DefaultRecognizerWebSocketSSRRecognitionConfiguration","DefaultRecognizerWebSocketSSRConfiguration","RecognizerWebSocketSSRConfiguration","RecognizerWebSocketSSR","viewSizeHeight","viewSizeWidth","connected","ackDeferred","exportDeferred","convertDeferred","importDeferred","resizeDeferred","importPointEventsDeferred","toLocaleLowerCase","infinitePing","params","xDpi","yDpi","manageAckMessage","manageContentPackageDescriptionMessage","manageContentChangeMessage","context","stackIndex","undoStackIndex","possibleUndoCount","manageSVGPatchMessage","svgPatchMessage","styleClasses","localModel","import","chunkSize","importFileId","readBlob","fileReader","FileReader","onloadend","ev","onerror","readAsText","importFileMessage","size","blobPart","fileChuckMessage","lastChunk","importPointEvents","events","myExportConverted","undoExports","redoExports","clearExports","CanvasRendererShape","table","returnedAngle","drawEllipseArc","context2D","shapeEllipse","centerPoint","maxRadius","minRadius","z1","z2","z3","z4","boundariesPoints","save","beginPath","alpha","cosAlpha","sinAlpha","moveTo","lineTo","restore","drawLine","drawArrowHead","headPoint","beta","fillStyle","strokeStyle","drawShapeEllipse","beginDecoration","beginTangentAngle","endTangentAngle","drawShapeLine","shapeLine","lastPoint","draw","lineWidth","CanvasRendererStroke","renderArc","context2d","renderLine","linkPoints1","linkPoints2","renderFinal","linkPoints","newAngle","renderQuadratic","ctrl","linkPoints3","quadraticCurveTo","NUMBER_POINTS","NUMBER_QUADRATICS","secondPoint","beginLine","endLine","beginFinal","endFinal","closePath","CanvasRendererText","string","textLine","drawUnderline","textUnderline","underline","topLeftPoint","firstCharacter","lastCharacter","drawText","font","textHeight","textAlign","justificationType","textBaseline","fillText","drawTextLine","underlineList","CanvasRenderer","strokeRenderer","shapeRenderer","textRenderer","createCanvas","canvas","resizeContent","pixelRatio","window","devicePixelRatio","renderingCanvas","capturingCanvas","domElement","parentNode","minWidth","clientWidth","minHeight","clientHeight","getContext","drawSymbol","guide","setAttribute","backgroundSize","parent","renderingCanvasContext","capturingCanvasContext","drawModel","clearRect","drawPendingStroke","innerHTML","SVGRendererConst","arrowHeadStartMarker","arrowHeadEndMaker","selectionFilterId","removalFilterId","crossMarker","noSelection","XMLNS","SVGBuilder","createLayer","attrs","svgEl","createElementNS","createFilter","createDefs","createMarker","marker","createComponentTransfert","createDropShadow","deviation","shadow","createTransfertFunctionTable","feFunc","createGroup","groupEl","createLine","lineEl","createCircle","circleEl","createPath","pathEl","createPolygon","polygonEl","createRect","rectEl","createTSpan","tSpanEl","textContent","createForeignObject","node","objEl","createText","textEl","SVGRendererEdgeUtil","getLinePath","getPolyLinePath","getArcPath","getSVGPath","getSVGElement","pathAttrs","Arrow","SVGRendererEraserUtil","startPath","strokeWith","acc","shadowBlur","SVGRendererDecoratorUtil","decorator","Highlight","Surround","Strikethrough","Underline","SVGRendererShapeUtil","getPolygonePath","getCirclePath","getEllipsePath","SVGRendererStrokeUtil","getFinalPath","parts","getQuadraticPath","central","STROKE_LENGTH","STROKE_WIDTH","NB_QUADRATICS","beforeLastPoint","strokeGroup","strokeAttrs","deco","SVGRendererTextUtil","textGroup","textElement","SVGRendererRecognizedUtil","recognizedSymbol","SVGRendererGroupUtil","getChildElement","symbolGroup","SVGRenderer","groupGuidesId","layer","definitionGroup","verticalGuides","horizontalGuides","initLayer","setProperty","createSVGTools","defs","REFX","SIZE","REFY","arrowHeadMarkerAttrs","markerWidth","markerHeight","refX","refY","arrowHeadStart","orient","arrowHeadEnd","crossMarkerAttrs","viewBox","cross","createFilters","filtersGroup","removalFilter","filterUnits","bfeComponentTransfer","bfeFuncA","selectionFilter","drawGuides","getAttribute","offSet","gap","subOffSet","role","Guide","guidesGroup","svgLine","subY","subX","svgPoint","removeGuides","querySelector","oncontextmenu","buildElementFromSymbol","prependElement","el","symbolToMove","moveEl","insertAdjacentElement","nextElementSibling","previousElementSibling","appendElement","removeElement","oldStroke","oldNode","replaceWith","elements","drawCircle","drawRect","drawConnectionBetweenBox","attrsLine","getElementById","getElements","tagName","query","querySelectorAll","clearElements","firstChild","SVGStroker","buildSVGPath","drawStroke","svgElement","svgPathElement","svgPath","InteractiveInkSSRSVGRenderer","stroker","replaceAll","layerName","update","oldLayer","insertAdjacentHTML","svg","pendingStrokesGroup","replaceElement","elementToRemove","parentSelector","parentId","insertBefore","refId","selector","removeAttribute","updateLayer","updatesLayer","updates","clearPendingStroke","pendingStrokeGroup","clearErasingStrokes","erasingStroke","rect","getBoundingClientRect","svgList","DefaultGuidesConfiguration","DefaultRendererConfiguration","DefaultIIRendererConfiguration","DefaultListenerConfiguration","capture","passive","DefaultGrabberConfiguration","listenerOptions","xyFloatPrecision","timestampFloatPrecision","delayLongTouch","PointerEventGrabber","layerCapture","capturing","prevent","preventDefault","onPointerDown","onPointerMove","onPointerUp","onContextMenu","roundFloat","oneFloat","requestedFloatPrecision","floatPrecision","extractPointer","clientX","clientY","changedTouches","clientLeft","scrollLeft","clientTop","scrollTop","getPointerInfos","isPrimary","button","buttons","pointerDownHandler","pointerInfo","pointerMoveHandler","pointerUpHandler","pointerOutHandler","contextMenuHandler","stopPointerEvent","attach","detach","removeProperty","AbstractWriterManager","grabber","detectGesture","continue","localPointer","createCurrentSymbol","updateCurrentSymbol","IIConversionManager","fontStyle","computeFontSize","buildChar","grid","weight","buildText","word","charSymbols","charFontSize","charStrokes","items","hightlight","strikethrough","surround","convertText","onlyText","jiixWords","jiixChars","textFontSize","isNewLine","currentY","leftX","currentX","texter","getSpaceWidth","wordStrokes","wordSymbol","nbRow","setBounds","buildCircle","cx","cy","buildEllipse","rx","ry","buildRectangle","rectangle","buildPolygon","buildRhombus","buildTriangle","buildParallelogram","convertNode","associatedStroke","uniqStrokes","Rectangle","Triangle","Parallelogram","Rhombus","buildLine","x1","y1","x2","y2","p1Decoration","p2Decoration","buildPolyEdge","unshift","buildArc","convertEdge","apply","removeSelectedGroup","strokesToConvert","extractStrokesFromSymbols","conversionResults","conversion","addSymbols","cs","removeSymbols","history","IIResizeManager","interactElementsGroup","direction","transformOrigin","keepRatio","applyToStroke","applyToShape","applyToEdge","applyOnText","updateBounds","applyOnGroup","applyToSymbol","applyOnRecognizedSymbol","setTransformOrigin","originX","originY","scaleElement","sx","sy","InteractElementsGroup","localPoint","horizontalResize","verticalResize","snaps","snapResize","deltaX","deltaY","clearSnapToElementLines","oldSymbols","strokesFromSymbols","recognizer","svgDebugger","IIRotationManager","angleRad","strokeText","rotateElement","angleDegree","snapRotation","IISelectionManager","selectingId","startSelectionPoint","endSelectionPoint","selectedGroup","rotator","translator","resizer","selectionBox","drawSelectingRect","clearSelectingRect","getPoint","createTranslateRect","Translate","boxWithMarge","translateEl","handler","stopPropagation","endHandler","cursor","resetSelectedGroup","hideInteractElements","createRotateGroup","Rotate","attrs1","attrs2","attrs3","createResizeGroup","Resize","P_NW","P_NE","P_SE","P_SW","bindEl","def","lineResize","cornerResize","createInteractElementsGroup","symbolElementMap","surroundGroup","SURROUND_ATTRS","createEdgeResizeGroup","pointIndex","pointEl","createInteractEdgeGroup","drawSelectedGroup","groupBox","getBBox","menu","show","hide","updatedSymbols","found","currentEl","symbolTypesAllowed","parentElement","unselectAll","updateLayerUI","IITextManager","drawSymbolHidden","setCharsBounds","textGroupEl","getNumberOfChars","ext","getExtentOfChar","getElementBoundingBox","markers","clipped","getBoundingBox","charSymbol","textSymbol","moveTextAfter","textsAfter","IITranslateManager","addToHistory","translateElement","nudge","snapTranslate","IIWriterManager","tool","Pencil","currentSymbolOrigin","wt","gestureManager","needContextLessGesture","strokeBoundsWithMargin","getSymbolsBounds","DoubleArrow","updateCurrentSymbolShape","updateCurrentSymbolEdge","interactWithBackend","localStroke","gestureFromContextLess","getGestureFromContextLess","pop","localSymbol","IIDebugSVGManager","snapPointsVisibility","verticesVisibility","boundingBoxVisibility","recognitionBoxVisibility","recognitionItemBoxVisibility","debugSnapPoints","debugVertices","showBoundingBox","hideBoundingBox","debugRecognitionBox","debugRecognitionItemBox","showSnapPoints","hideSnapPoints","showVertices","hideVertices","drawBoundingBox","symbolAttrs","charAttrs","symEl","ca","sa","debugBoundingBox","drawRecognitionBox","infos","COLOR","recognitionGroup","infosGroup","infoX","infoY","TEXT_HEIGHT","w","infosGroupBox","rectBox","rectTranslate","newRectBox","showRecognitionBox","hideProperties","candidates","inf","clearRecognitionBox","drawRecognitionItemBox","recognitionItemGroup","charX","charY","charsGroup","charsGroupBox","showRecognitionItemBox","clearRecognitionItemBox","IIMoveManager","IDebugSVGManager","recognitionBoxItemsVisibility","recognitionBoxDrawing","recognitionBoxItemsDrawing","debugRecognitionBoxItems","debugAttr","rectAttr","buildInfos","obj","currentPath","localPath","associatedStrokes","range","to","h","showRecognitionBoxItems","spans","clearRecognitionBoxItems","EraseManager","currentEraser","lastSeg","InteractiveInkEditor","getInitialHistoryContext","HistoryManager","stack","updateContext","maxStackSize","updateStack","previousModel","nextModel","IIHistoryManager","isChangesEmpty","updated","order","ungroup","stackIdx","reverseChanges","reversedChanges","newSymbols","currentStackItem","previousStackItem","nextStackItem","IHistoryManager","updateModelStack","DefaultHistoryConfiguration","IIMenu","thicknessList","fontSizeList","fontWeightList","colors","createWrapCollapsible","title","head","btn","ArrowDown","content","toggle","createMenuItemBoolean","labelEl","checkbox","disabled","initValue","indeterminate","checked","createMenuItemSelect","select","opt","Option","createMenuItemButton","icon","createMenuItemButtonList","createMenuItemColorList","createColorList","list","colorEl","createMenuItem","SurroundAction","StrikeThroughAction","InsertAction","DefaultGestureConfiguration","Select","strikeThrough","Draw","insert","LineBreak","IIGestureManager","insertAction","surroundAction","strikeThroughAction","gestureAction","strokeSpaceWidth","applySurroundGesture","gestureStroke","symWithDec","highlight","computeScratchOnStrokes","partPointersToRemove","subStrokes","ss","fullStrokeId","strokePartToErase","computeScratchOnText","charsToRemove","cIndex","c1","computeScratchOnSymbol","strokesScratchedResult","childrenNotTouch","results","strokesToConserve","symbolsGroup","textScratchedResult","applyScratch","symbolsToUpdate","symbolsToErase","symbolsToReplace","updateSymbols","replaceSymbols","applyJoinGesture","symbolsAbove","symbolsRow","symbolsBeforeGestureInRow","symbolsOnGestureInRow","symbolsAfterGestureInRow","symbolsBelow","symbolToJoin","childBefore","childAfter","lastSymbBefore","firstSymbolAfter","translateX","lastSymbBeforeClone","firstSymbolAfterClone","symbolsToGroup","strokeTexts","d1","rest","lastSymbolBeforeGesture","firstSymbolAfterGesture","symbolInNextRow","symbolsAfterNextRow","lastSymbolAbove","createStrokesFromGestureSubStroke","strokeOrigin","subStroke","computeSplitStroke","computeSplitStrokeInGroup","newGroups","symbolsBefore","symbolsAfter","strokeIdToSplit","gs","computeChangesOnSplitStroke","symbolToSplit","strokesToSplit","strokesBefore","strokesAfter","computeChangesOnSplitGroup","groupToSplit","groupSymbolsBefore","groupsSymbolsAfter","groupBefore","grouAfter","computeChangesOnSplitStrokeText","strokeTextToSplit","strokeTextBefore","strokeTextAfter","computeChangesOnSplitText","textToSplit","charsBefore","charsAfter","newTexts","textBefore","pointAfter","textAfter","applyInsertGesture","Insert","applyUnderlineGesture","applyStrikeThroughGesture","Erase","updateSymbolsStyle","synchronizeStrokesWithJIIX","gestureType","gestureStrokeId","strokeAfterIds","strokeBeforeIds","symbolsToUnderline","symbolsToStrikeThrough","IIMenuSub","param","trigger","menuTitle","menuTitleElement","subMenu","open","unwrap","wrap","IIMenuAction","menuLanguage","menuClear","menuUndo","menuRedo","menuConvert","guideGaps","isMobile","createMenuClear","createMenuLanguage","triggerBtn","languages","changeLanguage","createMenuUndo","createMenuRedo","createMenuConvert","createMenuGesture","subMenuWrapper","surroundActionValues","strikeThroughActionValues","splitActionValues","writer","Write","createMenuGuide","renderingConfiguration","createMenuSnap","createMenuDebug","menuItems","createMenuExport","downloadAsJson","downloadAsSVG","downloadAsPNG","readFileAsText","file","reader","onload","createMenuImport","importInput","accept","multiple","importBtn","files","fileString","createSymbols","closeAllSubMenu","action","menuTrigger","visibility","IIMenuTool","writeBtn","menuSelect","menuMove","menuErase","menuShape","subMenuShape","menuEdge","subMenuEdge","createMenuWrite","createMenuMove","Move","createMenuSelect","createMenuErase","createShapeSubMenu","subMenuContent","nextSibling","createMenuShape","rectangleIcon","triangle","rhombus","createEdgeSubMenu","square","createMenuEdge","lineIcon","arrow","doubleArrow","IIMenuStyle","menuColorStroke","menuColorFill","menuThickness","menuFontSize","menuFontWeight","menuStrokeOpacity","writeShape","createMenuStroke","symbolsStyles","st","menuColorStrokeDef","menuColor","createMenuColorFill","createMenuThickness","createMenuFontSize","textSymbols","updateTextFontStyle","createMenuFontWeight","createMenuOpacity","currentOpacity","input","output","shapeSelected","IIMenuContext","editMenu","editInput","editSaveBtn","reorderMenu","decoratorMenu","menuExport","duplicateBtn","groupBtn","convertBtn","removeBtn","haveSymbolsSelected","symbolsDecorable","showDecorator","createMenuEdit","firstChar","createMenuDuplicate","symbolsToDuplicate","updateDeepIdInGroup","gr","duplicatedSymbols","createMenuGroup","ungroupSymbol","groupSymbols","convertSymbols","createMenuRemove","createMenuReorder","changeOrderSymbols","reverse","createDecoratorSubMenu","labelEL","decoIndex","_c","createMenuDecorator","createMenuSelectAll","selectAll","updateDecoratorSubMenu","decos","btnToActivate","updateGroupMenu","DefaultMenuConfiguration","IIMenuManager","custom","CustomMenuStyle","CustomMenuTool","CustomMenuAction","DefaultSnapConfiguration","SnapConfiguration","IISnapManager","selectionSnapPoints","otherSnapPoints","selectSymbolIds","snapThreshold","getNearestVerticalGuide","prev","curr","getNearestHorizontalGuide","getGuidePointToSnap","drawSnapToElementLines","getSnapLinesInfos","sourcePoints","targetPoints","Infinity","verticales","horizontales","horizontal","vertical","snapLines","snapLinesInfos","selectionSymbolPoints","lastDeltaX","lastDeltaY","gridPoint","DefaultInteractiveInkEditorConfiguration","snap","InteractiveInkEditorConfiguration","layerUITimer","recognizeStrokeTimer","converter","move","CustomRecognizer","manageError","onContentChanged","updateLayerState","initializationPromise","setCursorStyle","clearTimeout","initialize","compStyles","getComputedStyle","parseInt","buildShape","partialShape","buildEdge","partialEdge","buildRecognized","partialSymbol","buildGroup","partialGroup","buildStroke","buildStrokeText","buildSymbol","createSymbol","partialSymbols","updateTextBounds","symList","lastWidth","textIds","symbolsTranslated","textChildren","symToReplace","force","getSymbolsAndStrokesAssociatedFromJIIXStrokeItems","strokeIdsUsed","symIdx","jiixAssociation","symAsso","recognizedText","wd","Node","symbolRecognized","groupStrokeIds","symbolsToRemove","strokesIds","partialStrokes","triggerDownload","fileName","urlData","downloadAnchorNode","click","buildBlobFromSymbols","svgNode","cloneNode","svgString","XMLSerializer","serializeToString","Blob","getExportName","extension","year","month","day","hour","minute","second","toLocaleDateString","navigator","language","selection","svgBlob","URL","createObjectURL","image","Image","src","drawImage","revokeObjectURL","imgURI","toDataURL","symbolsToExport","dataStr","encodeURIComponent","extractTextsFromSymbols","extractBackendChanges","backendChanges","modifications","actionsToBackend","DefaulTEditorTriggerConfiguration","exportContent","exportContentDelay","resizeTriggerDelay","DefaultInkEditorDeprecatedConfiguration","triggers","InkEditorDeprecatedConfiguration","InkEditorDeprecated","resizeTimer","exportTimer","styleManager","CustomGrabber","drawCurrentStroke","updateModelRendering","deferred","currentModel","newModel","deferredResize","resizeModel","InteractiveInkSSRSmartGuide","uuid","smartGuideElement","wrapperElement","prompterContainerElement","prompterTextElement","ellipsisElement","tagElement","candidatesElement","menuElement","convertElement","copyElement","deleteElement","isMenuOpen","lastWord","wordToChange","createRootElement","createWrapperElement","createPrompterContainerElement","createPrompterTextElement","createEllipsisElement","createTagElement","createCandidatesElement","createMoreMenuElement","createConvertElement","createCopyElement","createDeleteElement","addListeners","showCandidates","wordId","hideCandidates","openMenu","closeMenu","onClickEllipsis","onClickConvert","createTextAreaElement","isRTL","documentElement","textArea","yPosition","pageYOffset","selectText","userAgent","match","createRange","selectNodeContents","getSelection","removeAllRanges","addRange","setSelectionRange","onClickCopy","fakeEl","execCommand","onClickDelete","onClickCandidate","candidate","JIIX","onClickPrompter","onClickOutSide","removeListeners","marginLeft","marginRight","createWordSpan","span","myFragment","createDocumentFragment","offsetLeft","populatePrompter","DefaultInteractiveInkSSREditorConfiguration","smartGuide","InteractiveInkSSREditorConfiguration","InteractiveInkSSREditor","penClass","syncStyle","onExport","jjix","synchronizeModelWithBackend","onSVGPatch","initializeSmartGuide","onError","unsentStrokes","blobToImport","strokesToImport","str","exportPoints","DefaultInkEditorConfiguration","InkEditorConfiguration","IWriterManager","InkEditor","debugger","removedStrokes","Editor","load","instance","getInstance","computeDistanceBetweenPointAndSegment","convertPartialStrokesToStrokes","ji","createPointsOnSegment","spaceBetweenPoint","spaceWithP1","getAvailableFontList","isPointInsideBox"],"mappings":"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","x_google_ignoreList":[24]}