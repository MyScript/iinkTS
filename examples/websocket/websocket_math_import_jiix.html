<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="HandheldFriendly" content="true" />

    <title>Import math with JIIX</title>

    <link rel="stylesheet" href="../assets/style/reset.css" />
    <link rel="stylesheet" href="../assets/style/components.css" />
    <link rel="stylesheet" href="../assets/style/examples.css" />

    <script type="text/javascript" src="../../dist/iink.min.js"></script>
    <style>
      main {
        display: flex;
        flex-direction: row;
        height: calc(100% - 116px);
        width: 100%;
      }

      #editorEl {
        height: calc(100dvh - 116px);
        width: 60%;
      }

      #jiix {
        border-right: 1px solid #d7dde3;
        min-height: calc(100dvh - 120px);
        max-height: calc(100dvh - 120px);
        width: 40%;
      }

      @media only screen and (max-width: 600px) {
        main {
          display: flex;
          flex-direction: column;
        }

        #editorEl {
          height: calc(50svh - 116px);
          width: 100%;
        }

        #jiix {
          border-right: 1px solid #d7dde3;
          min-height: calc(50svh - 116px);
          max-height: calc(50svh - 116px);
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <header class="header-main">
      <button id="showModalBtn" class="btn-keys">
        Change server configuration
      </button>
      <h1 class="header-title">Import math with JIIX</h1>
    </header>
    <nav class="flex-container wrap between">
      <div class="flex-container wrap gap">
        <button class="classic-btn" id="import">
          Import
        </button>
      </div>
      <div class="flex-container wrap gap">
        <button id="undo" class="nav-btn btn-fab-mini btn-lightBlue" disabled>
          <img src="../assets/img/undo.svg" />
        </button>
        <button id="redo" class="nav-btn btn-fab-mini btn-lightBlue" disabled>
          <img src="../assets/img/redo.svg" />
        </button>
        <button class="classic-btn" id="convert" disabled>
          Convert
        </button>
      </div>
    </nav>

    <main>
      <textarea id="jiix">
{
  "type": "Math",
  "expressions": [
    {
      "type": "=",
      "id": "math/41",
      "items": [
        {
          "timestamp": "2023-09-11 09:04:24.566000",
          "X": [
            49.2124977,
            50.7999992,
            51.8583336,
            53.1812477,
            54.2395821,
            55.0333328
          ],
          "Y": [
            59.53125,
            59.53125,
            59.53125,
            59.7958298,
            59.53125,
            59.53125
          ],
          "F": [
            0.100000001,
            0.769999981,
            0.709999979,
            0.75,
            0.720000029,
            0.680000007
          ],
          "T": [
            0,
            116,
            133,
            149,
            167,
            182
          ],
          "type": "stroke",
          "id": "0000000001000b00ff00"
        },
        {
          "timestamp": "2023-09-11 09:04:25.239000",
          "X": [
            50.2708321,
            51.59375,
            52.6520805,
            53.9749985,
            55.8270836,
            57.1499977
          ],
          "Y": [
            62.1770821,
            61.9124985,
            61.6479149,
            61.6479149,
            61.6479149,
            61.6479149
          ],
          "F": [
            0.100000001,
            0.75,
            0.720000029,
            0.74000001,
            0.779999971,
            0.74000001
          ],
          "T": [
            0,
            100,
            116,
            134,
            150,
            167
          ],
          "type": "stroke",
          "id": "0000010001000b00ff00"
        }
      ],
      "operands": [
        {
          "type": "symbol",
          "id": "math/40",
          "label": "y",
          "items": [
            {
              "timestamp": "2023-09-11 09:04:22.598000",
              "X": [
                41.0104141,
                41.5395813,
                42.0687485,
                42.3333321,
                42.8624992,
                43.65625,
                43.9208336,
                44.7145805
              ],
              "Y": [
                57.4145813,
                58.7374992,
                59.53125,
                60.5895805,
                61.6479149,
                62.4416656,
                63.2354164,
                64.0291672
              ],
              "F": [
                0.100000001,
                0.75,
                0.699999988,
                0.720000029,
                0.730000019,
                0.720000029,
                0.680000007,
                0.720000029
              ],
              "T": [
                0,
                81,
                99,
                132,
                164,
                198,
                289,
                332
              ],
              "type": "stroke",
              "id": "0000020001000f00ff00"
            },
            {
              "timestamp": "2023-09-11 09:04:23.496000",
              "X": [
                46.8312492,
                46.3020821,
                46.0374985,
                45.5083313,
                45.2437477,
                44.7145805,
                44.4499969,
                44.1854172,
                43.65625,
                43.65625,
                43.3916664,
                43.3916664
              ],
              "Y": [
                57.6791649,
                59.0020828,
                59.7958298,
                60.8541641,
                61.6479149,
                62.7062492,
                63.7645798,
                64.5583344,
                65.6166611,
                66.6749954,
                67.46875,
                68.2624969
              ],
              "F": [
                0.100000001,
                0.75,
                0.680000007,
                0.730000019,
                0.680000007,
                0.730000019,
                0.720000029,
                0.680000007,
                0.730000019,
                0.709999979,
                0.680000007,
                0.680000007
              ],
              "T": [
                0,
                67,
                82,
                99,
                115,
                132,
                150,
                166,
                199,
                248,
                299,
                349
              ],
              "type": "stroke",
              "id": "0000030001001700ff00"
            }
          ]
        },
        {
          "type": "+",
          "id": "math/49",
          "items": [
            {
              "timestamp": "2023-09-11 09:04:36.215000",
              "X": [
                90.2229156,
                91.0166626,
                91.8104172,
                92.6041641
              ],
              "Y": [
                58.4729156,
                58.2083321,
                58.2083321,
                58.2083321
              ],
              "F": [
                0.100000001,
                0.680000007,
                0.680000007,
                0.680000007
              ],
              "T": [
                0,
                151,
                166,
                199
              ],
              "type": "stroke",
              "id": "0000040001000700ff00"
            },
            {
              "timestamp": "2023-09-11 09:04:37.037000",
              "X": [
                91.8104172,
                92.3395844,
                92.6041641,
                92.6041641,
                92.6041641,
                92.6041641
              ],
              "Y": [
                55.2979164,
                56.3562469,
                57.1499977,
                57.9437485,
                59.53125,
                60.3249969
              ],
              "F": [
                0.100000001,
                0.730000019,
                0.680000007,
                0.680000007,
                0.769999981,
                0.680000007
              ],
              "T": [
                0,
                77,
                94,
                111,
                128,
                161
              ],
              "type": "stroke",
              "id": "0000050001000b00ff00"
            }
          ],
          "operands": [
            {
              "type": "group",
              "id": "math/47",
              "operands": [
                {
                  "type": "number",
                  "id": "math/46",
                  "label": "3",
                  "value": 3,
                  "items": [
                    {
                      "timestamp": "2023-09-11 09:04:26.216000",
                      "X": [
                        65.0875015,
                        65.0875015,
                        65.3520813,
                        65.8812485,
                        66.9395828,
                        67.9979172,
                        68.7916641,
                        69.5854111,
                        70.3791656,
                        71.1729126,
                        71.7020798,
                        71.4375,
                        71.1729126,
                        70.1145782,
                        69.0562515,
                        68.2624969,
                        67.46875,
                        67.46875,
                        68.2624969,
                        69.3208313,
                        70.3791656,
                        71.4375,
                        71.9666672,
                        71.7020798,
                        70.6437454,
                        68.5270844,
                        67.46875,
                        66.4104156,
                        65.6166611
                      ],
                      "Y": [
                        55.0333328,
                        53.9749985,
                        52.9166641,
                        52.1229134,
                        51.8583336,
                        52.1229134,
                        52.1229134,
                        52.1229134,
                        52.1229134,
                        52.6520805,
                        53.4458313,
                        54.5041656,
                        55.5625,
                        56.6208305,
                        57.1499977,
                        57.4145813,
                        57.4145813,
                        56.6208305,
                        56.3562469,
                        56.6208305,
                        57.1499977,
                        57.9437485,
                        58.7374992,
                        59.53125,
                        60.3249969,
                        61.3833313,
                        61.9124985,
                        62.1770821,
                        62.7062492
                      ],
                      "F": [
                        0.100000001,
                        0.709999979,
                        0.720000029,
                        0.699999988,
                        0.720000029,
                        0.720000029,
                        0.680000007,
                        0.680000007,
                        0.680000007,
                        0.699999988,
                        0.699999988,
                        0.720000029,
                        0.720000029,
                        0.75999999,
                        0.730000019,
                        0.680000007,
                        0.680000007,
                        0.680000007,
                        0.680000007,
                        0.720000029,
                        0.730000019,
                        0.74000001,
                        0.699999988,
                        0.680000007,
                        0.74000001,
                        0.810000002,
                        0.730000019,
                        0.720000029,
                        0.699999988
                      ],
                      "T": [
                        0,
                        42,
                        75,
                        107,
                        158,
                        191,
                        207,
                        225,
                        241,
                        274,
                        307,
                        341,
                        358,
                        391,
                        407,
                        424,
                        540,
                        651,
                        692,
                        725,
                        758,
                        792,
                        825,
                        874,
                        908,
                        924,
                        958,
                        1007,
                        1056
                      ],
                      "type": "stroke",
                      "id": "0000060001003900ff00"
                    }
                  ]
                },
                {
                  "type": "symbol",
                  "id": "math/43",
                  "label": "x",
                  "items": [
                    {
                      "timestamp": "2023-09-11 09:04:34.133000",
                      "X": [
                        76.9937515,
                        77.2583313,
                        78.0520782,
                        79.375,
                        79.6395798,
                        79.1104126,
                        78.3166656,
                        77.5229111,
                        76.7291641
                      ],
                      "Y": [
                        57.9437485,
                        57.1499977,
                        57.4145813,
                        58.2083321,
                        59.0020828,
                        60.0604134,
                        60.8541641,
                        61.1187477,
                        61.6479149
                      ],
                      "F": [
                        0.100000001,
                        0.680000007,
                        0.680000007,
                        0.75999999,
                        0.680000007,
                        0.730000019,
                        0.720000029,
                        0.680000007,
                        0.699999988
                      ],
                      "T": [
                        0,
                        66,
                        169,
                        199,
                        248,
                        282,
                        316,
                        332,
                        368
                      ],
                      "type": "stroke",
                      "id": "0000070001001100ff00"
                    },
                    {
                      "timestamp": "2023-09-11 09:04:35.199000",
                      "X": [
                        82.0208282,
                        81.2270813,
                        80.4333344,
                        79.9041672,
                        80.6979141,
                        81.2270813,
                        81.7562485,
                        82.5499954,
                        83.34375,
                        84.6666641,
                        85.4604111
                      ],
                      "Y": [
                        56.8854141,
                        57.4145813,
                        57.6791649,
                        58.4729156,
                        59.2666664,
                        60.0604134,
                        60.8541641,
                        60.8541641,
                        60.8541641,
                        60.5895805,
                        60.5895805
                      ],
                      "F": [
                        0.100000001,
                        0.699999988,
                        0.680000007,
                        0.699999988,
                        0.720000029,
                        0.699999988,
                        0.699999988,
                        0.680000007,
                        0.680000007,
                        0.75,
                        0.680000007
                      ],
                      "T": [
                        0,
                        84,
                        117,
                        218,
                        283,
                        334,
                        382,
                        415,
                        452,
                        516,
                        550
                      ],
                      "type": "stroke",
                      "id": "0000080001001500ff00"
                    }
                  ]
                }
              ]
            },
            {
              "type": "number",
              "id": "math/48",
              "label": "2",
              "value": 2,
              "items": [
                {
                  "timestamp": "2023-09-11 09:04:37.717000",
                  "X": [
                    100.541664,
                    100.277084,
                    100.541664,
                    101.335411,
                    102.129166,
                    102.129166,
                    102.129166,
                    101.864578,
                    101.335411,
                    100.541664,
                    99.7479172,
                    100.541664,
                    101.599998,
                    102.922913,
                    103.981247,
                    104.774994
                  ],
                  "Y": [
                    55.8270836,
                    54.2395821,
                    52.9166641,
                    52.3874969,
                    53.7104149,
                    54.5041656,
                    55.2979164,
                    56.3562469,
                    57.4145813,
                    58.4729156,
                    59.2666664,
                    59.2666664,
                    59.2666664,
                    59.0020828,
                    58.7374992,
                    58.7374992
                  ],
                  "F": [
                    0.100000001,
                    0.769999981,
                    0.75,
                    0.699999988,
                    0.75999999,
                    0.680000007,
                    0.680000007,
                    0.720000029,
                    0.730000019,
                    0.74000001,
                    0.720000029,
                    0.680000007,
                    0.709999979,
                    0.75,
                    0.720000029,
                    0.680000007
                  ],
                  "T": [
                    0,
                    81,
                    97,
                    130,
                    213,
                    230,
                    246,
                    263,
                    280,
                    297,
                    313,
                    464,
                    479,
                    497,
                    512,
                    546
                  ],
                  "type": "stroke",
                  "id": "0000090001001f00ff00"
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "label": "y=3x+2",
  "id": "MainBlock",
  "version": "3"
}
      </textarea>
      <div id="editorEl"></div>
    </main>

    <script type="module">
      import { Editor } from '../../dist/iink.esm.js'
      import { ModalEditorOptions } from '../components/modal/modalEditorOptions.js'
      const editorElement = document.getElementById('editorEl')
      const undoElement = document.getElementById('undo')
      const redoElement = document.getElementById('redo')
      const convertElement = document.getElementById('convert')
      const importElement = document.getElementById('import')
      const showModalBtn = document.getElementById('showModalBtn')

      let editor

      const editorOptions = {
        configuration: {
          recognition: {
            type: 'MATH',
            math: {
              mimeTypes: ['application/vnd.myscript.jiix']
            },
            export: {
              jiix: {
                strokes: true
              }
            }
          }
        }
      }

      async function loadEditor(options) {
        /**
         * get editor instance from type
         * @param {Element} The DOM element to attach the ink paper
         * @param {Object} The Editor parameters
         */
        editor = await iink.Editor.load(editorElement, 'INTERACTIVEINKSSR', options)

        editor.event.addEventListener('changed', (event) => {
          undoElement.disabled = !event.detail.canUndo
          redoElement.disabled = !event.detail.canRedo
          convertElement.disabled = !event.detail.empty
        })

      }

      undoElement.addEventListener('click', () => {
        editor?.undo()
      })

      redoElement.addEventListener('click', () => {
        editor?.redo()
      })

      convertElement.addEventListener('click', () => {
        editor?.convert()
      })

      importElement.addEventListener('click', () => {
        const jiix = document.getElementById('jiix').value
        editor?.import(JSON.parse(jiix), 'application/vnd.myscript.jiix')
      })

      window.addEventListener('resize', () => {
        editor?.resize()
      })

      showModalBtn.addEventListener('click', () => {
        ModalEditorOptions.show(loadEditor, editorOptions)
      })

      ModalEditorOptions.initConfiguration(loadEditor, editorOptions)

      /**
       * We expose these objects to the window use it in test
       */
      window.editorOptions = editorOptions
      window.loadEditor = loadEditor
    </script>
  </body>

</html>
