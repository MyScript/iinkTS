{"version":3,"file":"iink.esm.js","sources":["../node_modules/tslib/tslib.es6.js","../src/Constants.ts","../src/grabber/PointerEventGrabber.ts","../src/renderer/canvas/CanvasRendererShapeSymbol.ts","../src/renderer/canvas/CanvasRendererTextSymbol.ts","../src/renderer/canvas/CanvasRenderer.ts","../src/renderer/canvas/CanvasRendererStrokeSymbol.ts","../src/renderer/QuadraticUtils.ts","../src/renderer/canvas/CanvasQuadraticStroker.ts","../node_modules/json-css/lib/jsoncss.min.js","../src/style/StyleHelper.ts","../node_modules/crypto-js/core.js","../node_modules/crypto-js/enc-hex.js","../node_modules/crypto-js/x64-core.js","../node_modules/crypto-js/sha512.js","../node_modules/crypto-js/hmac.js","../node_modules/crypto-js/hmac-sha512.js","../src/recognizer/CryptoHelper.ts","../src/event/GlobalEvent.ts","../src/recognizer/AbstractRecognizer.ts","../src/recognizer/RestRecognizer.ts","../src/utils/DeferredPromise.ts","../src/undo-redo/UndoRedoContext.ts","../src/undo-redo/UndoRedoManager.ts","../src/behaviors/RestBehaviors.ts","../src/event/WSEvent.ts","../src/recognizer/WSRecognizer.ts","../src/model/Stroke.ts","../src/model/Model.ts","../src/behaviors/WSBehaviors.ts","../src/behaviors/BehaviorsManager.ts","../src/configuration/DefaultConfiguration.ts","../src/configuration/Configuration.ts","../src/style/DefaultPenStyle.ts","../src/style/DefaultTheme.ts","../src/style/StyleManager.ts","../src/Editor.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/helpers.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","export const Error = {\n  ABNORMAL_CLOSURE: 'MyScript recognition server is not reachable. Please reload once you are connected.',\n  WRONG_CREDENTIALS: 'Application credentials are invalid. Please check or regenerate your application key and hmackey.',\n  TOO_OLD: 'Session is too old. Max Session Duration Reached.',\n  NO_ACTIVITY: 'Session closed due to no activity.',\n  UNKNOW: 'An unknown error has occurred.',\n  CANT_ESTABLISH: 'Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.',\n  GOING_AWAY: 'MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.',\n  PROTOCOL_ERROR: 'MyScript recognition server terminated the connection due to a protocol error.',\n  UNSUPPORTED_DATA: 'MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)',\n  INVALID_FRAME_PAULOAD: 'MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).',\n  POLICY_VIOLATION: 'MyScript recognition server terminated the connection because it received a message that violates its policy.',\n  MESSAGE_TOO_BIG: 'MyScript recognition server terminated the connection because a data frame was received that is too large.',\n  INTERNAL_ERROR: 'MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.',\n  SERVICE_RESTART: 'MyScript recognition server terminated the connection because it is restarting.',\n  TRY_AGAIN: 'MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.',\n  BAD_GATEWAY: 'MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.',\n  TLS_HANDSHAKE: 'MyScript recognition server connection was closed due to a failure to perform a TLS handshake'\n} as const\n\nexport const EventType = {\n  IDLE: 'idle',\n  CHANGED: 'changed',\n  IMPORTED: 'imported',\n  EXPORTED: 'exported',\n  CONVERTED: 'converted',\n  RENDERED: 'rendered', // Internal use only\n  LOADED: 'loaded',\n  UNDO: 'undo',\n  REDO: 'redo',\n  CLEAR: 'clear',\n  CLEARED: 'cleared',\n  IMPORT: 'import',\n  SUPPORTED_IMPORT_MIMETYPES: 'supportedImportMimeTypes',\n  EXPORT: 'export',\n  CONVERT: 'convert',\n  ERROR: 'error'\n} as const\n\nexport const WSEventType = {\n  PART_CHANGE: 'part_change',\n  CONTENT_CHANGE: 'content_change',\n  PATCH: 'patch',\n  EXPORTED: 'ws_exported',\n  INITIALIZED: 'initialized',\n  CONNECTED: 'connected',\n  CONNECTION_ACTIVE: 'connection_active',\n  DISCONNECTED: 'disconnected',\n} as const\n\nexport const Exports = {\n  JIIX: 'application/vnd.myscript.jiix'\n} as const\n\nexport default {\n  Error,\n  EventType,\n  Exports\n} as const\n","import { IGrabber } from '../@types/grabber/Grabber'\nimport { TGrabberConfiguration } from '../@types/configuration/GrabberConfiguration'\nimport { TPoint } from '../@types/renderer/Point'\n\nexport class PointerEventGrabber implements IGrabber\n{\n  private configuration!: TGrabberConfiguration\n\n  private domElement!: HTMLElement\n\n  private activePointerId?: number\n\n  private prevent = (e: Event) => e.preventDefault()\n\n  onPointerDown!: (evt: PointerEvent, point: TPoint) => void\n  onPointerMove!: (evt: PointerEvent, point: TPoint) => void\n  onPointerUp!: (evt: PointerEvent, point: TPoint) => void\n\n  constructor(configuration: TGrabberConfiguration)\n  {\n    this.setConfiguration(configuration)\n  }\n\n  private roundFloat(oneFloat: number, requestedFloatPrecision: number): number\n  {\n    if (requestedFloatPrecision >= 0) {\n      const floatPrecision: number = Math.pow(10, requestedFloatPrecision)\n      return Math.round(oneFloat / floatPrecision) * floatPrecision\n    }\n    return oneFloat\n  }\n\n  private extractPoint(event: MouseEvent | TouchEvent): TPoint\n  {\n    let clientX: number, clientY: number\n    if ('changedTouches' in event) {\n      ({ clientX, clientY } = event.changedTouches[0])\n    } else {\n      ({ clientX, clientY } = event)\n    }\n    const rect: DOMRect = this.domElement.getBoundingClientRect()\n    return {\n      x: this.roundFloat(clientX - rect.left - this.domElement.clientLeft, this.configuration.xyFloatPrecision),\n      y: this.roundFloat(clientY - rect.top - this.domElement.clientTop, this.configuration.xyFloatPrecision),\n      t: this.roundFloat(Date.now(), this.configuration.timestampFloatPrecision),\n      p: (event as PointerEvent).pressure || 1,\n\n    }\n  }\n\n  private pointerDownHandler = (evt: PointerEvent) =>\n  {\n    // exit if not a left click or multi-touch\n    if (evt.button !== 0 || evt.buttons !== 1) {\n      return\n    }\n\n    this.activePointerId = evt.pointerId\n\n    if (this.onPointerDown) {\n      const point = this.extractPoint(evt)\n      this.onPointerDown(evt, point)\n    }\n  }\n\n  private pointerMoveHandler = (evt: PointerEvent) =>\n  {\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      if (this.onPointerMove) {\n        const point = this.extractPoint(evt)\n        this.onPointerMove(evt, point)\n      }\n    }\n  }\n\n  private pointerUpHandler = (evt: PointerEvent) =>\n  {\n    if (this.activePointerId != undefined && this.activePointerId === evt.pointerId) {\n      this.activePointerId = undefined\n      evt.stopPropagation()\n      if (this.onPointerUp) {\n        const point = this.extractPoint(evt)\n        this.onPointerUp(evt, point)\n      }\n    }\n  }\n\n  setConfiguration(configuration: TGrabberConfiguration)\n  {\n    this.configuration = configuration\n  }\n\n  attach(domElement: HTMLElement)\n  {\n    if (this.domElement) {\n      this.detach()\n    }\n    this.domElement = domElement\n    this.domElement.addEventListener('pointerdown', this.pointerDownHandler, this.configuration.listenerOptions)\n\n    this.domElement.addEventListener('pointermove', this.pointerMoveHandler, this.configuration.listenerOptions)\n\n    this.domElement.addEventListener('pointerup', this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener('pointerout', this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener('pointerleave', this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.addEventListener('pointercancel', this.pointerUpHandler, this.configuration.listenerOptions)\n\n    this.domElement.addEventListener('touchmove', this.prevent)\n\n    // FIXME investigate why this is needed for iOS devices\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    document.documentElement.addEventListener('pointerdown', () => { })\n  }\n\n  detach()\n  {\n    this.domElement.removeEventListener('pointerdown', this.pointerDownHandler, this.configuration.listenerOptions)\n\n    this.domElement.removeEventListener('pointermove', this.pointerMoveHandler, this.configuration.listenerOptions)\n\n    this.domElement.removeEventListener('pointerup', this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.removeEventListener('pointerout', this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.removeEventListener('pointerleave', this.pointerUpHandler, this.configuration.listenerOptions)\n    this.domElement.removeEventListener('pointercancel', this.pointerUpHandler, this.configuration.listenerOptions)\n\n    this.domElement.removeEventListener('touchmove', this.prevent)\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    document.documentElement.removeEventListener('pointerdown', () => { })\n  }\n}","\nimport { TPartialXYPoint } from \"../../@types/renderer/Point\"\nimport { TSymbol, TShapeEllipseSymbol, TShapeLineSymbol, TShapeSymbol, TShapeTableSymbol, TLineSymbol, TShapeRecognizedSymbol } from \"../../@types/renderer/Symbol\"\n\nexport const ShapeSymbols = {\n  table: 'table',\n  shape: 'shape',\n  recognizedShape: 'recognizedShape',\n  ellipse: 'ellipse',\n  line: 'line'\n}\n\nfunction phi(angle: number): number\n{\n  let returnedAngle = ((angle + Math.PI) % (Math.PI * 2)) - Math.PI\n  if (returnedAngle < -Math.PI) {\n    returnedAngle += Math.PI * 2\n  }\n  return returnedAngle\n}\n\nfunction drawEllipseArc(context2D: CanvasRenderingContext2D, shapeEllipse: TShapeEllipseSymbol): TPartialXYPoint[]\n{\n  const { centerPoint, maxRadius, minRadius, orientation, startAngle, sweepAngle } = shapeEllipse\n  const angleStep = 0.02 // angle delta between interpolated\n\n  let z1 = Math.cos(orientation)\n  let z3 = Math.sin(orientation)\n  let z2 = z1\n  let z4 = z3\n  z1 *= maxRadius\n  z2 *= minRadius\n  z3 *= maxRadius\n  z4 *= minRadius\n\n  const n = Math.floor(Math.abs(sweepAngle) / angleStep)\n\n  const boundariesPoints = []\n\n  context2D.save()\n  try {\n    context2D.beginPath()\n\n    for (let i = 0; i <= n; i++) {\n      const angle = startAngle + ((i / n) * sweepAngle) // points on the arc, in radian\n      const alpha = Math.atan2(Math.sin(angle) / minRadius, Math.cos(angle) / maxRadius)\n\n      const cosAlpha = Math.cos(alpha)\n      const sinAlpha = Math.sin(alpha)\n\n      // current point\n      const x = (centerPoint.x + (z1 * cosAlpha)) - (z4 * sinAlpha)\n      const y = (centerPoint.y + (z2 * sinAlpha)) + (z3 * cosAlpha)\n      if (i === 0) {\n        context2D.moveTo(x, y)\n      } else {\n        context2D.lineTo(x, y)\n      }\n\n      if (i === 0 || i === n) {\n        boundariesPoints.push({ x, y })\n      }\n    }\n\n    context2D.stroke()\n  } finally {\n    context2D.restore()\n  }\n\n  return boundariesPoints\n}\n\nfunction drawArrowHead(context2D: CanvasRenderingContext2D, headPoint: TPartialXYPoint, angle: number, length: number)\n{\n  const alpha = phi(angle + (Math.PI * (7 / 8)))\n  const beta = phi(angle - (Math.PI * (7 / 8)))\n  context2D.save()\n  try {\n    context2D.fillStyle = context2D.strokeStyle\n\n    context2D.moveTo(headPoint.x, headPoint.y)\n    context2D.beginPath()\n    context2D.lineTo(headPoint.x + (length * Math.cos(alpha)), headPoint.y + (length * Math.sin(alpha)))\n    context2D.lineTo(headPoint.x + (length * Math.cos(beta)), headPoint.y + (length * Math.sin(beta)))\n    context2D.lineTo(headPoint.x, headPoint.y)\n    context2D.fill()\n  } finally {\n    context2D.restore()\n  }\n}\n\nfunction drawShapeEllipse(context2D: CanvasRenderingContext2D, shapeEllipse: TShapeEllipseSymbol)\n{\n  const points = drawEllipseArc(context2D, shapeEllipse)\n\n  if (shapeEllipse?.beginDecoration === 'ARROW_HEAD') {\n    drawArrowHead(context2D, points[0], shapeEllipse.beginTangentAngle, 12.0)\n  }\n  if (shapeEllipse?.endDecoration === 'ARROW_HEAD') {\n    drawArrowHead(context2D, points[1], shapeEllipse.endTangentAngle, 12.0)\n  }\n}\n\n/**\n * Draw a line\n * @param {Object} context2D Current rendering context2D\n * @param {{x: Number, y: Number}} p1 Origin point\n * @param {{x: Number, y: Number}} p2 Destination point\n */\nexport function drawLine(context2D: CanvasRenderingContext2D, p1: TPartialXYPoint, p2: TPartialXYPoint)\n{\n  context2D.save()\n  try {\n    context2D.beginPath()\n    context2D.moveTo(p1.x, p1.y)\n    context2D.lineTo(p2.x, p2.y)\n    context2D.stroke()\n  } finally {\n    context2D.restore()\n  }\n}\n\nfunction drawShapeLine(context2D: CanvasRenderingContext2D, shapeLine: TShapeLineSymbol)\n{\n  drawLine(context2D, shapeLine.firstPoint, shapeLine.lastPoint)\n  if (shapeLine.beginDecoration === 'ARROW_HEAD') {\n    drawArrowHead(context2D, shapeLine.firstPoint, shapeLine.beginTangentAngle, 12.0)\n  }\n  if (shapeLine.endDecoration === 'ARROW_HEAD') {\n    drawArrowHead(context2D, shapeLine.lastPoint, shapeLine.endTangentAngle, 12.0)\n  }\n}\n\n/**\n * Draw a shape symbol\n * @param {Object} context2D Current rendering context2D\n * @param {Object} symbol Symbol to draw\n */\nexport function drawShapeSymbol(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n{\n  context2D.save()\n  try {\n    context2D.lineWidth = symbol.width\n    context2D.strokeStyle = symbol.color\n\n    if (symbol.elementType) {\n      switch (symbol.elementType) {\n        case ShapeSymbols.shape:\n          // eslint-disable-next-line no-case-declarations\n          const shapeSymbol = symbol as TShapeSymbol\n          drawShapeSymbol(context2D, shapeSymbol.candidates[shapeSymbol.selectedCandidateIndex])\n          break\n        case ShapeSymbols.table:\n          // eslint-disable-next-line no-case-declarations\n          const tableSymbols = symbol as TShapeTableSymbol\n          tableSymbols.lines.forEach(line => drawShapeSymbol(context2D, line))\n          break\n        case ShapeSymbols.line:\n          // eslint-disable-next-line no-case-declarations\n          const lineSymbol = symbol as TLineSymbol\n          drawLine(context2D, lineSymbol.data.p1, lineSymbol.data.p2)\n          break\n        default:\n          // logger.error(`${ symbol.elementType } not implemented`)\n          break\n      }\n    } else {\n      switch (symbol.type) {\n        case ShapeSymbols.ellipse:\n          drawShapeEllipse(context2D, symbol as TShapeEllipseSymbol)\n          break\n        case ShapeSymbols.line:\n          drawShapeLine(context2D, symbol as TShapeLineSymbol)\n          break\n        case ShapeSymbols.recognizedShape:\n          // eslint-disable-next-line no-case-declarations\n          const recognizedSymbols = symbol as TShapeRecognizedSymbol\n          recognizedSymbols.primitives.forEach(primitive => drawShapeSymbol(context2D, primitive))\n          break\n        default:\n          // logger.error(`${ symbol.type } not implemented`)\n          break\n      }\n    }\n  } finally {\n    context2D.restore()\n  }\n}\n","import { TPartialXYPoint } from '../../@types/renderer/Point'\nimport { drawLine } from './CanvasRendererShapeSymbol'\nimport { TSymbol, TTextUnderlineDataSymbol, TTextUnderlineSymbol, TUnderLineSymbol } from '../../@types/renderer/Symbol'\n\nexport const TextSymbols = {\n  inputCharacter: 'inputCharacter',\n  char: 'char',\n  string: 'string',\n  textLine: 'textLine'\n}\n\nfunction drawUnderline(context2D: CanvasRenderingContext2D, underline: TUnderLineSymbol, label: string, data: TTextUnderlineDataSymbol)\n{\n  const delta = data.width / label.length\n  const p1: TPartialXYPoint = {\n    x: data.topLeftPoint.x + (underline.data.firstCharacter * delta),\n    y: data.topLeftPoint.y + data.height\n  }\n  const p2: TPartialXYPoint = {\n    x: data.topLeftPoint.x + (underline.data.lastCharacter * delta),\n    y: data.topLeftPoint.y + data.height\n  }\n  drawLine(context2D, p1, p2)\n}\n\nfunction drawText(context2D: CanvasRenderingContext2D, label: string, data: TTextUnderlineDataSymbol)\n{\n  context2D.save()\n  try {\n    context2D.font = `${ data.textHeight }px serif`\n    context2D.textAlign = (data.justificationType === 'CENTER') ? 'center' : 'left'\n    context2D.textBaseline = 'bottom'\n    context2D.fillStyle = context2D.strokeStyle\n    context2D.fillText(label, data.topLeftPoint.x, (data.topLeftPoint.y + data.height))\n  } finally {\n    context2D.restore()\n  }\n}\n\nfunction drawTextLine(context2D: CanvasRenderingContext2D, textLine: TTextUnderlineSymbol)\n{\n  drawText(context2D, textLine.label, textLine.data)\n  textLine.underlineList.forEach((underline) =>\n  {\n    drawUnderline(context2D, underline, textLine.label, textLine.data)\n  })\n}\n\n/**\n * Draw a text symbol\n * @param {Object} context Current rendering context\n * @param {Object} symbol Symbol to draw\n */\nexport function drawTextSymbol(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n{\n  context2D.save()\n  try {\n    context2D.lineWidth = symbol.width\n    context2D.strokeStyle = symbol.color\n    const type: string = symbol.elementType || symbol.type\n\n    switch (type) {\n      case TextSymbols.textLine:\n        drawTextLine(context2D, symbol as TTextUnderlineSymbol)\n        break\n      default:\n        // logger.error(`${symbol.elementType} not implemented`)\n        break\n    }\n\n  } finally {\n    context2D.restore()\n  }\n}\n","import { TStroke, IStroker } from \"../../@types/stroker/Stroker\"\nimport { TRenderingConfiguration } from \"../../@types/configuration/RenderingConfiguration\"\nimport { IModel } from \"../../@types/model/Model\"\nimport { IRenderer, TRendererContext } from \"../../@types/renderer/Renderer\"\nimport { TSymbol } from \"../../@types/renderer/Symbol\"\n\nimport { drawShapeSymbol, ShapeSymbols } from \"./CanvasRendererShapeSymbol\"\nimport { drawStroke } from \"./CanvasRendererStrokeSymbol\"\nimport { drawTextSymbol, TextSymbols } from \"./CanvasRendererTextSymbol\"\n\nexport class CanvasRenderer implements IRenderer\n{\n  config: TRenderingConfiguration\n  context!: TRendererContext\n\n  constructor(config: TRenderingConfiguration) {\n    this.config = config\n  }\n\n  private createCanvas(element: HTMLElement, type: string): HTMLCanvasElement\n  {\n    const canvas: HTMLCanvasElement = document.createElement('canvas')\n    canvas.id = type\n    canvas.classList.add(type)\n    canvas.classList.add('ms-canvas')\n    element.appendChild(canvas)\n    return canvas\n  }\n\n  private resizeContent(): void\n  {\n    const pixelRatio: number = window.devicePixelRatio\n    const elements: HTMLCanvasElement[] = [this.context.renderingCanvas, this.context.capturingCanvas]\n    elements.forEach((canvas) =>\n    {\n      const domElement = canvas.parentNode as HTMLElement\n      const width = Math.max(this.context?.minWidth, domElement.clientWidth)\n      const height = Math.max(this.context?.minHeight, domElement.clientHeight)\n      canvas.width = width * pixelRatio\n      canvas.height = height * pixelRatio\n      canvas.getContext('2d')?.scale(pixelRatio, pixelRatio)\n      canvas.style.width = `${ width }px`\n      canvas.style.height = `${ height }px`\n    })\n  }\n\n  private drawSymbol(context2D: CanvasRenderingContext2D, symbol: TSymbol, stroker: IStroker)\n  {\n    const type = symbol.elementType || symbol.type\n    if (type === 'stroke') {\n      drawStroke(context2D, symbol as TStroke, stroker)\n    } else if (Object.keys(TextSymbols).includes(type)) {\n      drawTextSymbol(context2D, symbol)\n    } else if (Object.keys(ShapeSymbols).includes(type)) {\n      drawShapeSymbol(context2D, symbol)\n    }\n  }\n\n  init(element: HTMLElement): void\n  {\n    const renderingCanvas: HTMLCanvasElement = this.createCanvas(element, 'ms-rendering-canvas')\n    const capturingCanvas: HTMLCanvasElement = this.createCanvas(element, 'ms-capture-canvas')\n\n    this.context = {\n      minHeight: this.config.minHeight || 0,\n      minWidth: this.config.minWidth || 0,\n      renderingCanvas,\n      renderingCanvasContext: renderingCanvas.getContext('2d') as CanvasRenderingContext2D,\n      capturingCanvas,\n      capturingCanvasContext: capturingCanvas.getContext('2d') as CanvasRenderingContext2D\n    }\n\n    this.resizeContent()\n  }\n\n  drawModel(model: IModel, stroker: IStroker): void\n  {\n    this.context.renderingCanvasContext?.clearRect(0, 0, this.context.renderingCanvas.width, this.context.renderingCanvas.height)\n    const symbols = [...model.defaultSymbols]\n    if (model.recognizedSymbols) {\n      symbols.push(...model.recognizedSymbols)\n      symbols.push(...model.extractPendingStrokes())\n    } else {\n      symbols.push(...model.rawStrokes)\n    }\n    symbols.forEach(symbol => this.drawSymbol(this.context.renderingCanvasContext, symbol, stroker))\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n    model.updatePositionRendered(symbols.length)\n  }\n\n  drawCurrentStroke(model: IModel, stroker: IStroker): void\n  {\n    // Render the current stroke\n    const stroke: TStroke | undefined = model.currentStroke\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n    if (stroker && stroke && stroke?.pointerType !== 'eraser') {\n      stroker.drawStroke(this.context.capturingCanvasContext, stroke)\n    }\n  }\n\n  resize(model: IModel, stroker: IStroker): void\n  {\n    this.resizeContent()\n    this.drawModel(model, stroker)\n  }\n\n  destroy(element: HTMLElement)\n  {\n    element.removeChild(this.context.renderingCanvas)\n    element.removeChild(this.context.capturingCanvas)\n    // this.context = undefined\n  }\n}","import { TStroke, IStroker } from \"../../@types/stroker/Stroker\"\n\nexport function drawStroke (context2D: CanvasRenderingContext2D, stroke: TStroke, stroker: IStroker) {\n  if (stroker && stroke && stroke.pointerType !== 'eraser') {\n    stroker.drawStroke(context2D, stroke)\n  }\n}","import { TPartialXYPoint, TPoint } from \"../@types/renderer/Point\"\n\nexport function computeLinksPoints(point: TPoint, angle: number, width: number): TPartialXYPoint[]\n{\n  const radius = point.p * width\n  return [\n    {\n      x: (point.x - (Math.sin(angle) * radius)),\n      y: (point.y + (Math.cos(angle) * radius))\n    },\n    {\n      x: (point.x + (Math.sin(angle) * radius)),\n      y: (point.y - (Math.cos(angle) * radius))\n    }\n  ]\n}\n\nexport function computeMiddlePoint(point1: TPoint, point2: TPoint): TPoint\n{\n  return {\n    x: ((point2.x + point1.x) / 2),\n    y: ((point2.y + point1.y) / 2),\n    p: ((point2.p + point1.p) / 2),\n    t: ((point2.t + point1.t) / 2)\n  }\n}\n\nexport function computeAxeAngle(begin: TPoint, end: TPoint): number\n{\n  return Math.atan2(end.y - begin.y, end.x - begin.x)\n}\n","import { TPoint } from \"../../@types/renderer/Point\"\nimport { TStroke, IStroker } from \"../../@types/stroker/Stroker\"\nimport { computeAxeAngle, computeLinksPoints, computeMiddlePoint } from \"../QuadraticUtils\"\n\nexport class QuadraticCanvasStroker implements IStroker\n{\n\n  private renderArc(context2d: CanvasRenderingContext2D, center: TPoint, radius: number)\n  {\n    context2d.arc(center.x, center.y, radius, 0, Math.PI * 2, true)\n  }\n\n  private renderLine(context2d: CanvasRenderingContext2D, begin: TPoint, end: TPoint, width: number)\n  {\n    const linkPoints1 = computeLinksPoints(begin, computeAxeAngle(begin, end), width)\n    const linkPoints2 = computeLinksPoints(end, computeAxeAngle(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.lineTo(linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.lineTo(linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  private renderFinal(context2d: CanvasRenderingContext2D, begin: TPoint, end: TPoint, width: number)\n  {\n    const ARCSPLIT = 6\n    const angle = computeAxeAngle(begin, end)\n    const linkPoints = computeLinksPoints(end, angle, width)\n    context2d.moveTo(linkPoints[0].x, linkPoints[0].y)\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - ((i * Math.PI) / ARCSPLIT)\n      context2d.lineTo(end.x - ((end.p * width) * Math.sin(newAngle)), end.y + (end.p * width * Math.cos(newAngle)))\n    }\n  }\n\n  private renderQuadratic(context2d: CanvasRenderingContext2D, begin: TPoint, end: TPoint, ctrl: TPoint, width: number)\n  {\n    const linkPoints1 = computeLinksPoints(begin, computeAxeAngle(begin, ctrl), width)\n    const linkPoints2 = computeLinksPoints(end, computeAxeAngle(ctrl, end), width)\n    const linkPoints3 = computeLinksPoints(ctrl, computeAxeAngle(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.quadraticCurveTo(linkPoints3[0].x, linkPoints3[0].y, linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.quadraticCurveTo(linkPoints3[1].x, linkPoints3[1].y, linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  private getPointByIndex(stroke: TStroke, index: number): TPoint {\n    const point: TPoint = {\n      x: stroke.x[index] || 0,\n      y: stroke.y[index] || 0,\n      t: stroke.t[index] || 0,\n      p: stroke.p[index] || 0,\n    }\n    return point\n  }\n\n  drawStroke(context2d: CanvasRenderingContext2D, stroke: TStroke)\n  {\n    const length = stroke.x.length\n    const width = stroke.width > 0 ? stroke.width : context2d.lineWidth\n    const color = stroke.color ? stroke.color : context2d.strokeStyle\n    const firstPoint = this.getPointByIndex(stroke, 0) as TPoint\n    const nbquadratics = length - 2\n\n    context2d.save()\n    try {\n      context2d.beginPath()\n      if (length < 3) {\n        this.renderArc(context2d, firstPoint, width * 0.6)\n      } else {\n        this.renderArc(context2d, firstPoint, width * firstPoint.p)\n        const secondPoint: TPoint = computeMiddlePoint(firstPoint, this.getPointByIndex(stroke, 1))\n        this.renderLine(context2d, firstPoint, secondPoint, width)\n\n        // Possibility to try this (the start looks better when the ink is large)\n        // var first = computeMiddlePoint(stroke[0], stroke[1]);\n        // context2d.arc(first.x, first.y, width * first.p, 0, Math.PI * 2, true);\n\n        for (let i = 0; i < nbquadratics; i++) {\n          const begin: TPoint = computeMiddlePoint(this.getPointByIndex(stroke, i), this.getPointByIndex(stroke, i + 1))\n          const end: TPoint = computeMiddlePoint(this.getPointByIndex(stroke, i + 1), this.getPointByIndex(stroke, i + 2))\n          const ctrl: TPoint = this.getPointByIndex(stroke, i + 1)\n          this.renderQuadratic(context2d, begin, end, ctrl, width)\n        }\n        const beginLine: TPoint = computeMiddlePoint(this.getPointByIndex(stroke, length - 2), this.getPointByIndex(stroke, length - 1))\n        const endLine: TPoint = this.getPointByIndex(stroke, length - 1)\n        this.renderLine(context2d, beginLine, endLine, width)\n\n        const beginFinal: TPoint = this.getPointByIndex(stroke, length - 2)\n        const endFinal: TPoint = this.getPointByIndex(stroke, length - 1)\n        this.renderFinal(context2d, beginFinal, endFinal, width)\n      }\n      context2d.closePath()\n      if (color !== undefined) {\n        context2d.fillStyle = color\n        context2d.fill()\n      }\n      context2d.save()\n    }\n    finally {\n      context2d.restore()\n    }\n  }\n}","!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.JsonCSS=e():t.JsonCSS=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,\"a\",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p=\"\",e(e.s=1)}([function(t,e,n){\"use strict\";function o(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(e,\"__esModule\",{value:!0});var r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},i=function t(e){var n=this;o(this,t),this.toJSON=function(t){if(\"string\"!=typeof t)return console.error(\"Need a CSS string but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid CSS..!\";var e={},o=void 0,i=void 0,u=void 0;try{t.split(\"{\").forEach(function(t){if(i=t.trim())if(-1===i.indexOf(\"}\"))e[i]={},o=i;else{i.substring(0,i.indexOf(\"}\")).split(\";\").forEach(function(t){(u=t.split(\":\"))&&2===u.length&&(e[o][u[0].trim().replace(/^\\\"|\\\"$/g,\"\")]=n._trimSemiColon(u[1].trim().replace(/^\\\"|\\\"$/g,\"\")))});try{o=i.split(\"}\")[1].trim(),o&&(e[o]={})}catch(t){}}})}catch(t){return\"Not a valid CSS..!\"}return e},this.toCSS=function(t){if(\"object\"!==(void 0===t?\"undefined\":r(t)))return console.error(\"Need a JSON object but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid JSON..!\";var e=\"\";try{for(var n in t)if(t.hasOwnProperty(n)){e+=n+\" {\\n\";for(var o in t[n])t[n].hasOwnProperty(o)&&(e+=o+\": \"+t[n][o]+\";\\n\");e+=\"}\\n\"}}catch(t){return\"Not a valid JSON..!\"}return e},this._trimSemiColon=function(t){return\";\"===t.slice(-1)?t.slice(0,n.length-1):t}};e.default=i},function(t,e,n){\"use strict\";t.exports=n(0).default}])});","import JsonCSS from 'json-css'\nimport { TPenStyle } from '../@types/style/PenStyle'\nimport { TTheme } from '../@types/style/Theme'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst parser: any = new JsonCSS()\n\nexport default {\n  themeToCSS(json: TTheme): string\n  {\n    let css = parser.toCSS(json) as string\n    css = css.replace( /[\\r\\n]+/gm, \"\" )\n    return css\n  },\n  themeToJSON(style: string): TTheme\n  {\n    const theme = parser.toJSON(style) as TTheme\n    theme['.text']['font-size'] = Number(theme['.text']['font-size'])\n    theme.ink['-myscript-pen-width'] = Number(theme.ink['-myscript-pen-width'])\n    theme.ink.width = Number(theme.ink.width)\n    return theme\n  },\n  penStyleToCSS (penStyle: TPenStyle): string {\n    let css = parser.toCSS({ css: penStyle }) as string\n    css = css.substring(6, css.length - 3)\n    css = css.replace( /[\\r\\n]+/gm, \"\" )\n    return css\n  },\n  penStyleToJSON (penStyleString: string): TPenStyle {\n    const penStyle = parser.toJSON(`css {${penStyleString}}`).css as TPenStyle\n    penStyle.width = Number(penStyle.width)\n    penStyle['-myscript-pen-width'] = Number(penStyle['-myscript-pen-width'])\n    return penStyle\n  }\n}",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory();\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\troot.CryptoJS = factory();\n\t}\n}(this, function () {\n\n\t/**\n\t * CryptoJS core components.\n\t */\n\tvar CryptoJS = CryptoJS || (function (Math, undefined) {\n\t    /*\n\t     * Local polyfil of Object.create\n\t     */\n\t    var create = Object.create || (function () {\n\t        function F() {};\n\n\t        return function (obj) {\n\t            var subtype;\n\n\t            F.prototype = obj;\n\n\t            subtype = new F();\n\n\t            F.prototype = null;\n\n\t            return subtype;\n\t        };\n\t    }())\n\n\t    /**\n\t     * CryptoJS namespace.\n\t     */\n\t    var C = {};\n\n\t    /**\n\t     * Library namespace.\n\t     */\n\t    var C_lib = C.lib = {};\n\n\t    /**\n\t     * Base object for prototypal inheritance.\n\t     */\n\t    var Base = C_lib.Base = (function () {\n\n\n\t        return {\n\t            /**\n\t             * Creates a new object that inherits from this object.\n\t             *\n\t             * @param {Object} overrides Properties to copy into the new object.\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         field: 'value',\n\t             *\n\t             *         method: function () {\n\t             *         }\n\t             *     });\n\t             */\n\t            extend: function (overrides) {\n\t                // Spawn\n\t                var subtype = create(this);\n\n\t                // Augment\n\t                if (overrides) {\n\t                    subtype.mixIn(overrides);\n\t                }\n\n\t                // Create default initializer\n\t                if (!subtype.hasOwnProperty('init') || this.init === subtype.init) {\n\t                    subtype.init = function () {\n\t                        subtype.$super.init.apply(this, arguments);\n\t                    };\n\t                }\n\n\t                // Initializer's prototype is the subtype object\n\t                subtype.init.prototype = subtype;\n\n\t                // Reference supertype\n\t                subtype.$super = this;\n\n\t                return subtype;\n\t            },\n\n\t            /**\n\t             * Extends this object and runs the init method.\n\t             * Arguments to create() will be passed to init().\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var instance = MyType.create();\n\t             */\n\t            create: function () {\n\t                var instance = this.extend();\n\t                instance.init.apply(instance, arguments);\n\n\t                return instance;\n\t            },\n\n\t            /**\n\t             * Initializes a newly created object.\n\t             * Override this method to add some logic when your objects are created.\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         init: function () {\n\t             *             // ...\n\t             *         }\n\t             *     });\n\t             */\n\t            init: function () {\n\t            },\n\n\t            /**\n\t             * Copies properties into this object.\n\t             *\n\t             * @param {Object} properties The properties to mix in.\n\t             *\n\t             * @example\n\t             *\n\t             *     MyType.mixIn({\n\t             *         field: 'value'\n\t             *     });\n\t             */\n\t            mixIn: function (properties) {\n\t                for (var propertyName in properties) {\n\t                    if (properties.hasOwnProperty(propertyName)) {\n\t                        this[propertyName] = properties[propertyName];\n\t                    }\n\t                }\n\n\t                // IE won't copy toString using the loop above\n\t                if (properties.hasOwnProperty('toString')) {\n\t                    this.toString = properties.toString;\n\t                }\n\t            },\n\n\t            /**\n\t             * Creates a copy of this object.\n\t             *\n\t             * @return {Object} The clone.\n\t             *\n\t             * @example\n\t             *\n\t             *     var clone = instance.clone();\n\t             */\n\t            clone: function () {\n\t                return this.init.prototype.extend(this);\n\t            }\n\t        };\n\t    }());\n\n\t    /**\n\t     * An array of 32-bit words.\n\t     *\n\t     * @property {Array} words The array of 32-bit words.\n\t     * @property {number} sigBytes The number of significant bytes in this word array.\n\t     */\n\t    var WordArray = C_lib.WordArray = Base.extend({\n\t        /**\n\t         * Initializes a newly created word array.\n\t         *\n\t         * @param {Array} words (Optional) An array of 32-bit words.\n\t         * @param {number} sigBytes (Optional) The number of significant bytes in the words.\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.create();\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607]);\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607], 6);\n\t         */\n\t        init: function (words, sigBytes) {\n\t            words = this.words = words || [];\n\n\t            if (sigBytes != undefined) {\n\t                this.sigBytes = sigBytes;\n\t            } else {\n\t                this.sigBytes = words.length * 4;\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts this word array to a string.\n\t         *\n\t         * @param {Encoder} encoder (Optional) The encoding strategy to use. Default: CryptoJS.enc.Hex\n\t         *\n\t         * @return {string} The stringified word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     var string = wordArray + '';\n\t         *     var string = wordArray.toString();\n\t         *     var string = wordArray.toString(CryptoJS.enc.Utf8);\n\t         */\n\t        toString: function (encoder) {\n\t            return (encoder || Hex).stringify(this);\n\t        },\n\n\t        /**\n\t         * Concatenates a word array to this word array.\n\t         *\n\t         * @param {WordArray} wordArray The word array to append.\n\t         *\n\t         * @return {WordArray} This word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray1.concat(wordArray2);\n\t         */\n\t        concat: function (wordArray) {\n\t            // Shortcuts\n\t            var thisWords = this.words;\n\t            var thatWords = wordArray.words;\n\t            var thisSigBytes = this.sigBytes;\n\t            var thatSigBytes = wordArray.sigBytes;\n\n\t            // Clamp excess bits\n\t            this.clamp();\n\n\t            // Concat\n\t            if (thisSigBytes % 4) {\n\t                // Copy one byte at a time\n\t                for (var i = 0; i < thatSigBytes; i++) {\n\t                    var thatByte = (thatWords[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                    thisWords[(thisSigBytes + i) >>> 2] |= thatByte << (24 - ((thisSigBytes + i) % 4) * 8);\n\t                }\n\t            } else {\n\t                // Copy one word at a time\n\t                for (var i = 0; i < thatSigBytes; i += 4) {\n\t                    thisWords[(thisSigBytes + i) >>> 2] = thatWords[i >>> 2];\n\t                }\n\t            }\n\t            this.sigBytes += thatSigBytes;\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Removes insignificant bits.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray.clamp();\n\t         */\n\t        clamp: function () {\n\t            // Shortcuts\n\t            var words = this.words;\n\t            var sigBytes = this.sigBytes;\n\n\t            // Clamp\n\t            words[sigBytes >>> 2] &= 0xffffffff << (32 - (sigBytes % 4) * 8);\n\t            words.length = Math.ceil(sigBytes / 4);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this word array.\n\t         *\n\t         * @return {WordArray} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = wordArray.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone.words = this.words.slice(0);\n\n\t            return clone;\n\t        },\n\n\t        /**\n\t         * Creates a word array filled with random bytes.\n\t         *\n\t         * @param {number} nBytes The number of random bytes to generate.\n\t         *\n\t         * @return {WordArray} The random word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.random(16);\n\t         */\n\t        random: function (nBytes) {\n\t            var words = [];\n\n\t            var r = (function (m_w) {\n\t                var m_w = m_w;\n\t                var m_z = 0x3ade68b1;\n\t                var mask = 0xffffffff;\n\n\t                return function () {\n\t                    m_z = (0x9069 * (m_z & 0xFFFF) + (m_z >> 0x10)) & mask;\n\t                    m_w = (0x4650 * (m_w & 0xFFFF) + (m_w >> 0x10)) & mask;\n\t                    var result = ((m_z << 0x10) + m_w) & mask;\n\t                    result /= 0x100000000;\n\t                    result += 0.5;\n\t                    return result * (Math.random() > .5 ? 1 : -1);\n\t                }\n\t            });\n\n\t            for (var i = 0, rcache; i < nBytes; i += 4) {\n\t                var _r = r((rcache || Math.random()) * 0x100000000);\n\n\t                rcache = _r() * 0x3ade67b7;\n\t                words.push((_r() * 0x100000000) | 0);\n\t            }\n\n\t            return new WordArray.init(words, nBytes);\n\t        }\n\t    });\n\n\t    /**\n\t     * Encoder namespace.\n\t     */\n\t    var C_enc = C.enc = {};\n\n\t    /**\n\t     * Hex encoding strategy.\n\t     */\n\t    var Hex = C_enc.Hex = {\n\t        /**\n\t         * Converts a word array to a hex string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The hex string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var hexString = CryptoJS.enc.Hex.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var hexChars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                hexChars.push((bite >>> 4).toString(16));\n\t                hexChars.push((bite & 0x0f).toString(16));\n\t            }\n\n\t            return hexChars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a hex string to a word array.\n\t         *\n\t         * @param {string} hexStr The hex string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Hex.parse(hexString);\n\t         */\n\t        parse: function (hexStr) {\n\t            // Shortcut\n\t            var hexStrLength = hexStr.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < hexStrLength; i += 2) {\n\t                words[i >>> 3] |= parseInt(hexStr.substr(i, 2), 16) << (24 - (i % 8) * 4);\n\t            }\n\n\t            return new WordArray.init(words, hexStrLength / 2);\n\t        }\n\t    };\n\n\t    /**\n\t     * Latin1 encoding strategy.\n\t     */\n\t    var Latin1 = C_enc.Latin1 = {\n\t        /**\n\t         * Converts a word array to a Latin1 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The Latin1 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var latin1String = CryptoJS.enc.Latin1.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var latin1Chars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                latin1Chars.push(String.fromCharCode(bite));\n\t            }\n\n\t            return latin1Chars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a Latin1 string to a word array.\n\t         *\n\t         * @param {string} latin1Str The Latin1 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Latin1.parse(latin1String);\n\t         */\n\t        parse: function (latin1Str) {\n\t            // Shortcut\n\t            var latin1StrLength = latin1Str.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < latin1StrLength; i++) {\n\t                words[i >>> 2] |= (latin1Str.charCodeAt(i) & 0xff) << (24 - (i % 4) * 8);\n\t            }\n\n\t            return new WordArray.init(words, latin1StrLength);\n\t        }\n\t    };\n\n\t    /**\n\t     * UTF-8 encoding strategy.\n\t     */\n\t    var Utf8 = C_enc.Utf8 = {\n\t        /**\n\t         * Converts a word array to a UTF-8 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The UTF-8 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var utf8String = CryptoJS.enc.Utf8.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            try {\n\t                return decodeURIComponent(escape(Latin1.stringify(wordArray)));\n\t            } catch (e) {\n\t                throw new Error('Malformed UTF-8 data');\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts a UTF-8 string to a word array.\n\t         *\n\t         * @param {string} utf8Str The UTF-8 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Utf8.parse(utf8String);\n\t         */\n\t        parse: function (utf8Str) {\n\t            return Latin1.parse(unescape(encodeURIComponent(utf8Str)));\n\t        }\n\t    };\n\n\t    /**\n\t     * Abstract buffered block algorithm template.\n\t     *\n\t     * The property blockSize must be implemented in a concrete subtype.\n\t     *\n\t     * @property {number} _minBufferSize The number of blocks that should be kept unprocessed in the buffer. Default: 0\n\t     */\n\t    var BufferedBlockAlgorithm = C_lib.BufferedBlockAlgorithm = Base.extend({\n\t        /**\n\t         * Resets this block algorithm's data buffer to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm.reset();\n\t         */\n\t        reset: function () {\n\t            // Initial values\n\t            this._data = new WordArray.init();\n\t            this._nDataBytes = 0;\n\t        },\n\n\t        /**\n\t         * Adds new data to this block algorithm's buffer.\n\t         *\n\t         * @param {WordArray|string} data The data to append. Strings are converted to a WordArray using UTF-8.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm._append('data');\n\t         *     bufferedBlockAlgorithm._append(wordArray);\n\t         */\n\t        _append: function (data) {\n\t            // Convert string to WordArray, else assume WordArray already\n\t            if (typeof data == 'string') {\n\t                data = Utf8.parse(data);\n\t            }\n\n\t            // Append\n\t            this._data.concat(data);\n\t            this._nDataBytes += data.sigBytes;\n\t        },\n\n\t        /**\n\t         * Processes available data blocks.\n\t         *\n\t         * This method invokes _doProcessBlock(offset), which must be implemented by a concrete subtype.\n\t         *\n\t         * @param {boolean} doFlush Whether all blocks and partial blocks should be processed.\n\t         *\n\t         * @return {WordArray} The processed data.\n\t         *\n\t         * @example\n\t         *\n\t         *     var processedData = bufferedBlockAlgorithm._process();\n\t         *     var processedData = bufferedBlockAlgorithm._process(!!'flush');\n\t         */\n\t        _process: function (doFlush) {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\t            var dataSigBytes = data.sigBytes;\n\t            var blockSize = this.blockSize;\n\t            var blockSizeBytes = blockSize * 4;\n\n\t            // Count blocks ready\n\t            var nBlocksReady = dataSigBytes / blockSizeBytes;\n\t            if (doFlush) {\n\t                // Round up to include partial blocks\n\t                nBlocksReady = Math.ceil(nBlocksReady);\n\t            } else {\n\t                // Round down to include only full blocks,\n\t                // less the number of blocks that must remain in the buffer\n\t                nBlocksReady = Math.max((nBlocksReady | 0) - this._minBufferSize, 0);\n\t            }\n\n\t            // Count words ready\n\t            var nWordsReady = nBlocksReady * blockSize;\n\n\t            // Count bytes ready\n\t            var nBytesReady = Math.min(nWordsReady * 4, dataSigBytes);\n\n\t            // Process blocks\n\t            if (nWordsReady) {\n\t                for (var offset = 0; offset < nWordsReady; offset += blockSize) {\n\t                    // Perform concrete-algorithm logic\n\t                    this._doProcessBlock(dataWords, offset);\n\t                }\n\n\t                // Remove processed words\n\t                var processedWords = dataWords.splice(0, nWordsReady);\n\t                data.sigBytes -= nBytesReady;\n\t            }\n\n\t            // Return processed words\n\t            return new WordArray.init(processedWords, nBytesReady);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this object.\n\t         *\n\t         * @return {Object} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = bufferedBlockAlgorithm.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone._data = this._data.clone();\n\n\t            return clone;\n\t        },\n\n\t        _minBufferSize: 0\n\t    });\n\n\t    /**\n\t     * Abstract hasher template.\n\t     *\n\t     * @property {number} blockSize The number of 32-bit words this hasher operates on. Default: 16 (512 bits)\n\t     */\n\t    var Hasher = C_lib.Hasher = BufferedBlockAlgorithm.extend({\n\t        /**\n\t         * Configuration options.\n\t         */\n\t        cfg: Base.extend(),\n\n\t        /**\n\t         * Initializes a newly created hasher.\n\t         *\n\t         * @param {Object} cfg (Optional) The configuration options to use for this hash computation.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hasher = CryptoJS.algo.SHA256.create();\n\t         */\n\t        init: function (cfg) {\n\t            // Apply config defaults\n\t            this.cfg = this.cfg.extend(cfg);\n\n\t            // Set initial values\n\t            this.reset();\n\t        },\n\n\t        /**\n\t         * Resets this hasher to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.reset();\n\t         */\n\t        reset: function () {\n\t            // Reset data buffer\n\t            BufferedBlockAlgorithm.reset.call(this);\n\n\t            // Perform concrete-hasher logic\n\t            this._doReset();\n\t        },\n\n\t        /**\n\t         * Updates this hasher with a message.\n\t         *\n\t         * @param {WordArray|string} messageUpdate The message to append.\n\t         *\n\t         * @return {Hasher} This hasher.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.update('message');\n\t         *     hasher.update(wordArray);\n\t         */\n\t        update: function (messageUpdate) {\n\t            // Append\n\t            this._append(messageUpdate);\n\n\t            // Update the hash\n\t            this._process();\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Finalizes the hash computation.\n\t         * Note that the finalize operation is effectively a destructive, read-once operation.\n\t         *\n\t         * @param {WordArray|string} messageUpdate (Optional) A final message update.\n\t         *\n\t         * @return {WordArray} The hash.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hash = hasher.finalize();\n\t         *     var hash = hasher.finalize('message');\n\t         *     var hash = hasher.finalize(wordArray);\n\t         */\n\t        finalize: function (messageUpdate) {\n\t            // Final message update\n\t            if (messageUpdate) {\n\t                this._append(messageUpdate);\n\t            }\n\n\t            // Perform concrete-hasher logic\n\t            var hash = this._doFinalize();\n\n\t            return hash;\n\t        },\n\n\t        blockSize: 512/32,\n\n\t        /**\n\t         * Creates a shortcut function to a hasher's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to create a helper for.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var SHA256 = CryptoJS.lib.Hasher._createHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHelper: function (hasher) {\n\t            return function (message, cfg) {\n\t                return new hasher.init(cfg).finalize(message);\n\t            };\n\t        },\n\n\t        /**\n\t         * Creates a shortcut function to the HMAC's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to use in this HMAC helper.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var HmacSHA256 = CryptoJS.lib.Hasher._createHmacHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHmacHelper: function (hasher) {\n\t            return function (message, key) {\n\t                return new C_algo.HMAC.init(hasher, key).finalize(message);\n\t            };\n\t        }\n\t    });\n\n\t    /**\n\t     * Algorithm namespace.\n\t     */\n\t    var C_algo = C.algo = {};\n\n\t    return C;\n\t}(Math));\n\n\n\treturn CryptoJS;\n\n}));",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\treturn CryptoJS.enc.Hex;\n\n}));",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function (undefined) {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var Base = C_lib.Base;\n\t    var X32WordArray = C_lib.WordArray;\n\n\t    /**\n\t     * x64 namespace.\n\t     */\n\t    var C_x64 = C.x64 = {};\n\n\t    /**\n\t     * A 64-bit word.\n\t     */\n\t    var X64Word = C_x64.Word = Base.extend({\n\t        /**\n\t         * Initializes a newly created 64-bit word.\n\t         *\n\t         * @param {number} high The high 32 bits.\n\t         * @param {number} low The low 32 bits.\n\t         *\n\t         * @example\n\t         *\n\t         *     var x64Word = CryptoJS.x64.Word.create(0x00010203, 0x04050607);\n\t         */\n\t        init: function (high, low) {\n\t            this.high = high;\n\t            this.low = low;\n\t        }\n\n\t        /**\n\t         * Bitwise NOTs this word.\n\t         *\n\t         * @return {X64Word} A new x64-Word object after negating.\n\t         *\n\t         * @example\n\t         *\n\t         *     var negated = x64Word.not();\n\t         */\n\t        // not: function () {\n\t            // var high = ~this.high;\n\t            // var low = ~this.low;\n\n\t            // return X64Word.create(high, low);\n\t        // },\n\n\t        /**\n\t         * Bitwise ANDs this word with the passed word.\n\t         *\n\t         * @param {X64Word} word The x64-Word to AND with this word.\n\t         *\n\t         * @return {X64Word} A new x64-Word object after ANDing.\n\t         *\n\t         * @example\n\t         *\n\t         *     var anded = x64Word.and(anotherX64Word);\n\t         */\n\t        // and: function (word) {\n\t            // var high = this.high & word.high;\n\t            // var low = this.low & word.low;\n\n\t            // return X64Word.create(high, low);\n\t        // },\n\n\t        /**\n\t         * Bitwise ORs this word with the passed word.\n\t         *\n\t         * @param {X64Word} word The x64-Word to OR with this word.\n\t         *\n\t         * @return {X64Word} A new x64-Word object after ORing.\n\t         *\n\t         * @example\n\t         *\n\t         *     var ored = x64Word.or(anotherX64Word);\n\t         */\n\t        // or: function (word) {\n\t            // var high = this.high | word.high;\n\t            // var low = this.low | word.low;\n\n\t            // return X64Word.create(high, low);\n\t        // },\n\n\t        /**\n\t         * Bitwise XORs this word with the passed word.\n\t         *\n\t         * @param {X64Word} word The x64-Word to XOR with this word.\n\t         *\n\t         * @return {X64Word} A new x64-Word object after XORing.\n\t         *\n\t         * @example\n\t         *\n\t         *     var xored = x64Word.xor(anotherX64Word);\n\t         */\n\t        // xor: function (word) {\n\t            // var high = this.high ^ word.high;\n\t            // var low = this.low ^ word.low;\n\n\t            // return X64Word.create(high, low);\n\t        // },\n\n\t        /**\n\t         * Shifts this word n bits to the left.\n\t         *\n\t         * @param {number} n The number of bits to shift.\n\t         *\n\t         * @return {X64Word} A new x64-Word object after shifting.\n\t         *\n\t         * @example\n\t         *\n\t         *     var shifted = x64Word.shiftL(25);\n\t         */\n\t        // shiftL: function (n) {\n\t            // if (n < 32) {\n\t                // var high = (this.high << n) | (this.low >>> (32 - n));\n\t                // var low = this.low << n;\n\t            // } else {\n\t                // var high = this.low << (n - 32);\n\t                // var low = 0;\n\t            // }\n\n\t            // return X64Word.create(high, low);\n\t        // },\n\n\t        /**\n\t         * Shifts this word n bits to the right.\n\t         *\n\t         * @param {number} n The number of bits to shift.\n\t         *\n\t         * @return {X64Word} A new x64-Word object after shifting.\n\t         *\n\t         * @example\n\t         *\n\t         *     var shifted = x64Word.shiftR(7);\n\t         */\n\t        // shiftR: function (n) {\n\t            // if (n < 32) {\n\t                // var low = (this.low >>> n) | (this.high << (32 - n));\n\t                // var high = this.high >>> n;\n\t            // } else {\n\t                // var low = this.high >>> (n - 32);\n\t                // var high = 0;\n\t            // }\n\n\t            // return X64Word.create(high, low);\n\t        // },\n\n\t        /**\n\t         * Rotates this word n bits to the left.\n\t         *\n\t         * @param {number} n The number of bits to rotate.\n\t         *\n\t         * @return {X64Word} A new x64-Word object after rotating.\n\t         *\n\t         * @example\n\t         *\n\t         *     var rotated = x64Word.rotL(25);\n\t         */\n\t        // rotL: function (n) {\n\t            // return this.shiftL(n).or(this.shiftR(64 - n));\n\t        // },\n\n\t        /**\n\t         * Rotates this word n bits to the right.\n\t         *\n\t         * @param {number} n The number of bits to rotate.\n\t         *\n\t         * @return {X64Word} A new x64-Word object after rotating.\n\t         *\n\t         * @example\n\t         *\n\t         *     var rotated = x64Word.rotR(7);\n\t         */\n\t        // rotR: function (n) {\n\t            // return this.shiftR(n).or(this.shiftL(64 - n));\n\t        // },\n\n\t        /**\n\t         * Adds this word with the passed word.\n\t         *\n\t         * @param {X64Word} word The x64-Word to add with this word.\n\t         *\n\t         * @return {X64Word} A new x64-Word object after adding.\n\t         *\n\t         * @example\n\t         *\n\t         *     var added = x64Word.add(anotherX64Word);\n\t         */\n\t        // add: function (word) {\n\t            // var low = (this.low + word.low) | 0;\n\t            // var carry = (low >>> 0) < (this.low >>> 0) ? 1 : 0;\n\t            // var high = (this.high + word.high + carry) | 0;\n\n\t            // return X64Word.create(high, low);\n\t        // }\n\t    });\n\n\t    /**\n\t     * An array of 64-bit words.\n\t     *\n\t     * @property {Array} words The array of CryptoJS.x64.Word objects.\n\t     * @property {number} sigBytes The number of significant bytes in this word array.\n\t     */\n\t    var X64WordArray = C_x64.WordArray = Base.extend({\n\t        /**\n\t         * Initializes a newly created word array.\n\t         *\n\t         * @param {Array} words (Optional) An array of CryptoJS.x64.Word objects.\n\t         * @param {number} sigBytes (Optional) The number of significant bytes in the words.\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.x64.WordArray.create();\n\t         *\n\t         *     var wordArray = CryptoJS.x64.WordArray.create([\n\t         *         CryptoJS.x64.Word.create(0x00010203, 0x04050607),\n\t         *         CryptoJS.x64.Word.create(0x18191a1b, 0x1c1d1e1f)\n\t         *     ]);\n\t         *\n\t         *     var wordArray = CryptoJS.x64.WordArray.create([\n\t         *         CryptoJS.x64.Word.create(0x00010203, 0x04050607),\n\t         *         CryptoJS.x64.Word.create(0x18191a1b, 0x1c1d1e1f)\n\t         *     ], 10);\n\t         */\n\t        init: function (words, sigBytes) {\n\t            words = this.words = words || [];\n\n\t            if (sigBytes != undefined) {\n\t                this.sigBytes = sigBytes;\n\t            } else {\n\t                this.sigBytes = words.length * 8;\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts this 64-bit word array to a 32-bit word array.\n\t         *\n\t         * @return {CryptoJS.lib.WordArray} This word array's data as a 32-bit word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     var x32WordArray = x64WordArray.toX32();\n\t         */\n\t        toX32: function () {\n\t            // Shortcuts\n\t            var x64Words = this.words;\n\t            var x64WordsLength = x64Words.length;\n\n\t            // Convert\n\t            var x32Words = [];\n\t            for (var i = 0; i < x64WordsLength; i++) {\n\t                var x64Word = x64Words[i];\n\t                x32Words.push(x64Word.high);\n\t                x32Words.push(x64Word.low);\n\t            }\n\n\t            return X32WordArray.create(x32Words, this.sigBytes);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this word array.\n\t         *\n\t         * @return {X64WordArray} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = x64WordArray.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\n\t            // Clone \"words\" array\n\t            var words = clone.words = this.words.slice(0);\n\n\t            // Clone each X64Word object\n\t            var wordsLength = words.length;\n\t            for (var i = 0; i < wordsLength; i++) {\n\t                words[i] = words[i].clone();\n\t            }\n\n\t            return clone;\n\t        }\n\t    });\n\t}());\n\n\n\treturn CryptoJS;\n\n}));",";(function (root, factory, undef) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"), require(\"./x64-core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\", \"./x64-core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function () {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var Hasher = C_lib.Hasher;\n\t    var C_x64 = C.x64;\n\t    var X64Word = C_x64.Word;\n\t    var X64WordArray = C_x64.WordArray;\n\t    var C_algo = C.algo;\n\n\t    function X64Word_create() {\n\t        return X64Word.create.apply(X64Word, arguments);\n\t    }\n\n\t    // Constants\n\t    var K = [\n\t        X64Word_create(0x428a2f98, 0xd728ae22), X64Word_create(0x71374491, 0x23ef65cd),\n\t        X64Word_create(0xb5c0fbcf, 0xec4d3b2f), X64Word_create(0xe9b5dba5, 0x8189dbbc),\n\t        X64Word_create(0x3956c25b, 0xf348b538), X64Word_create(0x59f111f1, 0xb605d019),\n\t        X64Word_create(0x923f82a4, 0xaf194f9b), X64Word_create(0xab1c5ed5, 0xda6d8118),\n\t        X64Word_create(0xd807aa98, 0xa3030242), X64Word_create(0x12835b01, 0x45706fbe),\n\t        X64Word_create(0x243185be, 0x4ee4b28c), X64Word_create(0x550c7dc3, 0xd5ffb4e2),\n\t        X64Word_create(0x72be5d74, 0xf27b896f), X64Word_create(0x80deb1fe, 0x3b1696b1),\n\t        X64Word_create(0x9bdc06a7, 0x25c71235), X64Word_create(0xc19bf174, 0xcf692694),\n\t        X64Word_create(0xe49b69c1, 0x9ef14ad2), X64Word_create(0xefbe4786, 0x384f25e3),\n\t        X64Word_create(0x0fc19dc6, 0x8b8cd5b5), X64Word_create(0x240ca1cc, 0x77ac9c65),\n\t        X64Word_create(0x2de92c6f, 0x592b0275), X64Word_create(0x4a7484aa, 0x6ea6e483),\n\t        X64Word_create(0x5cb0a9dc, 0xbd41fbd4), X64Word_create(0x76f988da, 0x831153b5),\n\t        X64Word_create(0x983e5152, 0xee66dfab), X64Word_create(0xa831c66d, 0x2db43210),\n\t        X64Word_create(0xb00327c8, 0x98fb213f), X64Word_create(0xbf597fc7, 0xbeef0ee4),\n\t        X64Word_create(0xc6e00bf3, 0x3da88fc2), X64Word_create(0xd5a79147, 0x930aa725),\n\t        X64Word_create(0x06ca6351, 0xe003826f), X64Word_create(0x14292967, 0x0a0e6e70),\n\t        X64Word_create(0x27b70a85, 0x46d22ffc), X64Word_create(0x2e1b2138, 0x5c26c926),\n\t        X64Word_create(0x4d2c6dfc, 0x5ac42aed), X64Word_create(0x53380d13, 0x9d95b3df),\n\t        X64Word_create(0x650a7354, 0x8baf63de), X64Word_create(0x766a0abb, 0x3c77b2a8),\n\t        X64Word_create(0x81c2c92e, 0x47edaee6), X64Word_create(0x92722c85, 0x1482353b),\n\t        X64Word_create(0xa2bfe8a1, 0x4cf10364), X64Word_create(0xa81a664b, 0xbc423001),\n\t        X64Word_create(0xc24b8b70, 0xd0f89791), X64Word_create(0xc76c51a3, 0x0654be30),\n\t        X64Word_create(0xd192e819, 0xd6ef5218), X64Word_create(0xd6990624, 0x5565a910),\n\t        X64Word_create(0xf40e3585, 0x5771202a), X64Word_create(0x106aa070, 0x32bbd1b8),\n\t        X64Word_create(0x19a4c116, 0xb8d2d0c8), X64Word_create(0x1e376c08, 0x5141ab53),\n\t        X64Word_create(0x2748774c, 0xdf8eeb99), X64Word_create(0x34b0bcb5, 0xe19b48a8),\n\t        X64Word_create(0x391c0cb3, 0xc5c95a63), X64Word_create(0x4ed8aa4a, 0xe3418acb),\n\t        X64Word_create(0x5b9cca4f, 0x7763e373), X64Word_create(0x682e6ff3, 0xd6b2b8a3),\n\t        X64Word_create(0x748f82ee, 0x5defb2fc), X64Word_create(0x78a5636f, 0x43172f60),\n\t        X64Word_create(0x84c87814, 0xa1f0ab72), X64Word_create(0x8cc70208, 0x1a6439ec),\n\t        X64Word_create(0x90befffa, 0x23631e28), X64Word_create(0xa4506ceb, 0xde82bde9),\n\t        X64Word_create(0xbef9a3f7, 0xb2c67915), X64Word_create(0xc67178f2, 0xe372532b),\n\t        X64Word_create(0xca273ece, 0xea26619c), X64Word_create(0xd186b8c7, 0x21c0c207),\n\t        X64Word_create(0xeada7dd6, 0xcde0eb1e), X64Word_create(0xf57d4f7f, 0xee6ed178),\n\t        X64Word_create(0x06f067aa, 0x72176fba), X64Word_create(0x0a637dc5, 0xa2c898a6),\n\t        X64Word_create(0x113f9804, 0xbef90dae), X64Word_create(0x1b710b35, 0x131c471b),\n\t        X64Word_create(0x28db77f5, 0x23047d84), X64Word_create(0x32caab7b, 0x40c72493),\n\t        X64Word_create(0x3c9ebe0a, 0x15c9bebc), X64Word_create(0x431d67c4, 0x9c100d4c),\n\t        X64Word_create(0x4cc5d4be, 0xcb3e42b6), X64Word_create(0x597f299c, 0xfc657e2a),\n\t        X64Word_create(0x5fcb6fab, 0x3ad6faec), X64Word_create(0x6c44198c, 0x4a475817)\n\t    ];\n\n\t    // Reusable objects\n\t    var W = [];\n\t    (function () {\n\t        for (var i = 0; i < 80; i++) {\n\t            W[i] = X64Word_create();\n\t        }\n\t    }());\n\n\t    /**\n\t     * SHA-512 hash algorithm.\n\t     */\n\t    var SHA512 = C_algo.SHA512 = Hasher.extend({\n\t        _doReset: function () {\n\t            this._hash = new X64WordArray.init([\n\t                new X64Word.init(0x6a09e667, 0xf3bcc908), new X64Word.init(0xbb67ae85, 0x84caa73b),\n\t                new X64Word.init(0x3c6ef372, 0xfe94f82b), new X64Word.init(0xa54ff53a, 0x5f1d36f1),\n\t                new X64Word.init(0x510e527f, 0xade682d1), new X64Word.init(0x9b05688c, 0x2b3e6c1f),\n\t                new X64Word.init(0x1f83d9ab, 0xfb41bd6b), new X64Word.init(0x5be0cd19, 0x137e2179)\n\t            ]);\n\t        },\n\n\t        _doProcessBlock: function (M, offset) {\n\t            // Shortcuts\n\t            var H = this._hash.words;\n\n\t            var H0 = H[0];\n\t            var H1 = H[1];\n\t            var H2 = H[2];\n\t            var H3 = H[3];\n\t            var H4 = H[4];\n\t            var H5 = H[5];\n\t            var H6 = H[6];\n\t            var H7 = H[7];\n\n\t            var H0h = H0.high;\n\t            var H0l = H0.low;\n\t            var H1h = H1.high;\n\t            var H1l = H1.low;\n\t            var H2h = H2.high;\n\t            var H2l = H2.low;\n\t            var H3h = H3.high;\n\t            var H3l = H3.low;\n\t            var H4h = H4.high;\n\t            var H4l = H4.low;\n\t            var H5h = H5.high;\n\t            var H5l = H5.low;\n\t            var H6h = H6.high;\n\t            var H6l = H6.low;\n\t            var H7h = H7.high;\n\t            var H7l = H7.low;\n\n\t            // Working variables\n\t            var ah = H0h;\n\t            var al = H0l;\n\t            var bh = H1h;\n\t            var bl = H1l;\n\t            var ch = H2h;\n\t            var cl = H2l;\n\t            var dh = H3h;\n\t            var dl = H3l;\n\t            var eh = H4h;\n\t            var el = H4l;\n\t            var fh = H5h;\n\t            var fl = H5l;\n\t            var gh = H6h;\n\t            var gl = H6l;\n\t            var hh = H7h;\n\t            var hl = H7l;\n\n\t            // Rounds\n\t            for (var i = 0; i < 80; i++) {\n\t                // Shortcut\n\t                var Wi = W[i];\n\n\t                // Extend message\n\t                if (i < 16) {\n\t                    var Wih = Wi.high = M[offset + i * 2]     | 0;\n\t                    var Wil = Wi.low  = M[offset + i * 2 + 1] | 0;\n\t                } else {\n\t                    // Gamma0\n\t                    var gamma0x  = W[i - 15];\n\t                    var gamma0xh = gamma0x.high;\n\t                    var gamma0xl = gamma0x.low;\n\t                    var gamma0h  = ((gamma0xh >>> 1) | (gamma0xl << 31)) ^ ((gamma0xh >>> 8) | (gamma0xl << 24)) ^ (gamma0xh >>> 7);\n\t                    var gamma0l  = ((gamma0xl >>> 1) | (gamma0xh << 31)) ^ ((gamma0xl >>> 8) | (gamma0xh << 24)) ^ ((gamma0xl >>> 7) | (gamma0xh << 25));\n\n\t                    // Gamma1\n\t                    var gamma1x  = W[i - 2];\n\t                    var gamma1xh = gamma1x.high;\n\t                    var gamma1xl = gamma1x.low;\n\t                    var gamma1h  = ((gamma1xh >>> 19) | (gamma1xl << 13)) ^ ((gamma1xh << 3) | (gamma1xl >>> 29)) ^ (gamma1xh >>> 6);\n\t                    var gamma1l  = ((gamma1xl >>> 19) | (gamma1xh << 13)) ^ ((gamma1xl << 3) | (gamma1xh >>> 29)) ^ ((gamma1xl >>> 6) | (gamma1xh << 26));\n\n\t                    // W[i] = gamma0 + W[i - 7] + gamma1 + W[i - 16]\n\t                    var Wi7  = W[i - 7];\n\t                    var Wi7h = Wi7.high;\n\t                    var Wi7l = Wi7.low;\n\n\t                    var Wi16  = W[i - 16];\n\t                    var Wi16h = Wi16.high;\n\t                    var Wi16l = Wi16.low;\n\n\t                    var Wil = gamma0l + Wi7l;\n\t                    var Wih = gamma0h + Wi7h + ((Wil >>> 0) < (gamma0l >>> 0) ? 1 : 0);\n\t                    var Wil = Wil + gamma1l;\n\t                    var Wih = Wih + gamma1h + ((Wil >>> 0) < (gamma1l >>> 0) ? 1 : 0);\n\t                    var Wil = Wil + Wi16l;\n\t                    var Wih = Wih + Wi16h + ((Wil >>> 0) < (Wi16l >>> 0) ? 1 : 0);\n\n\t                    Wi.high = Wih;\n\t                    Wi.low  = Wil;\n\t                }\n\n\t                var chh  = (eh & fh) ^ (~eh & gh);\n\t                var chl  = (el & fl) ^ (~el & gl);\n\t                var majh = (ah & bh) ^ (ah & ch) ^ (bh & ch);\n\t                var majl = (al & bl) ^ (al & cl) ^ (bl & cl);\n\n\t                var sigma0h = ((ah >>> 28) | (al << 4))  ^ ((ah << 30)  | (al >>> 2)) ^ ((ah << 25) | (al >>> 7));\n\t                var sigma0l = ((al >>> 28) | (ah << 4))  ^ ((al << 30)  | (ah >>> 2)) ^ ((al << 25) | (ah >>> 7));\n\t                var sigma1h = ((eh >>> 14) | (el << 18)) ^ ((eh >>> 18) | (el << 14)) ^ ((eh << 23) | (el >>> 9));\n\t                var sigma1l = ((el >>> 14) | (eh << 18)) ^ ((el >>> 18) | (eh << 14)) ^ ((el << 23) | (eh >>> 9));\n\n\t                // t1 = h + sigma1 + ch + K[i] + W[i]\n\t                var Ki  = K[i];\n\t                var Kih = Ki.high;\n\t                var Kil = Ki.low;\n\n\t                var t1l = hl + sigma1l;\n\t                var t1h = hh + sigma1h + ((t1l >>> 0) < (hl >>> 0) ? 1 : 0);\n\t                var t1l = t1l + chl;\n\t                var t1h = t1h + chh + ((t1l >>> 0) < (chl >>> 0) ? 1 : 0);\n\t                var t1l = t1l + Kil;\n\t                var t1h = t1h + Kih + ((t1l >>> 0) < (Kil >>> 0) ? 1 : 0);\n\t                var t1l = t1l + Wil;\n\t                var t1h = t1h + Wih + ((t1l >>> 0) < (Wil >>> 0) ? 1 : 0);\n\n\t                // t2 = sigma0 + maj\n\t                var t2l = sigma0l + majl;\n\t                var t2h = sigma0h + majh + ((t2l >>> 0) < (sigma0l >>> 0) ? 1 : 0);\n\n\t                // Update working variables\n\t                hh = gh;\n\t                hl = gl;\n\t                gh = fh;\n\t                gl = fl;\n\t                fh = eh;\n\t                fl = el;\n\t                el = (dl + t1l) | 0;\n\t                eh = (dh + t1h + ((el >>> 0) < (dl >>> 0) ? 1 : 0)) | 0;\n\t                dh = ch;\n\t                dl = cl;\n\t                ch = bh;\n\t                cl = bl;\n\t                bh = ah;\n\t                bl = al;\n\t                al = (t1l + t2l) | 0;\n\t                ah = (t1h + t2h + ((al >>> 0) < (t1l >>> 0) ? 1 : 0)) | 0;\n\t            }\n\n\t            // Intermediate hash value\n\t            H0l = H0.low  = (H0l + al);\n\t            H0.high = (H0h + ah + ((H0l >>> 0) < (al >>> 0) ? 1 : 0));\n\t            H1l = H1.low  = (H1l + bl);\n\t            H1.high = (H1h + bh + ((H1l >>> 0) < (bl >>> 0) ? 1 : 0));\n\t            H2l = H2.low  = (H2l + cl);\n\t            H2.high = (H2h + ch + ((H2l >>> 0) < (cl >>> 0) ? 1 : 0));\n\t            H3l = H3.low  = (H3l + dl);\n\t            H3.high = (H3h + dh + ((H3l >>> 0) < (dl >>> 0) ? 1 : 0));\n\t            H4l = H4.low  = (H4l + el);\n\t            H4.high = (H4h + eh + ((H4l >>> 0) < (el >>> 0) ? 1 : 0));\n\t            H5l = H5.low  = (H5l + fl);\n\t            H5.high = (H5h + fh + ((H5l >>> 0) < (fl >>> 0) ? 1 : 0));\n\t            H6l = H6.low  = (H6l + gl);\n\t            H6.high = (H6h + gh + ((H6l >>> 0) < (gl >>> 0) ? 1 : 0));\n\t            H7l = H7.low  = (H7l + hl);\n\t            H7.high = (H7h + hh + ((H7l >>> 0) < (hl >>> 0) ? 1 : 0));\n\t        },\n\n\t        _doFinalize: function () {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\n\t            var nBitsTotal = this._nDataBytes * 8;\n\t            var nBitsLeft = data.sigBytes * 8;\n\n\t            // Add padding\n\t            dataWords[nBitsLeft >>> 5] |= 0x80 << (24 - nBitsLeft % 32);\n\t            dataWords[(((nBitsLeft + 128) >>> 10) << 5) + 30] = Math.floor(nBitsTotal / 0x100000000);\n\t            dataWords[(((nBitsLeft + 128) >>> 10) << 5) + 31] = nBitsTotal;\n\t            data.sigBytes = dataWords.length * 4;\n\n\t            // Hash final blocks\n\t            this._process();\n\n\t            // Convert hash to 32-bit word array before returning\n\t            var hash = this._hash.toX32();\n\n\t            // Return final computed hash\n\t            return hash;\n\t        },\n\n\t        clone: function () {\n\t            var clone = Hasher.clone.call(this);\n\t            clone._hash = this._hash.clone();\n\n\t            return clone;\n\t        },\n\n\t        blockSize: 1024/32\n\t    });\n\n\t    /**\n\t     * Shortcut function to the hasher's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     *\n\t     * @return {WordArray} The hash.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hash = CryptoJS.SHA512('message');\n\t     *     var hash = CryptoJS.SHA512(wordArray);\n\t     */\n\t    C.SHA512 = Hasher._createHelper(SHA512);\n\n\t    /**\n\t     * Shortcut function to the HMAC's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     * @param {WordArray|string} key The secret key.\n\t     *\n\t     * @return {WordArray} The HMAC.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hmac = CryptoJS.HmacSHA512(message, key);\n\t     */\n\t    C.HmacSHA512 = Hasher._createHmacHelper(SHA512);\n\t}());\n\n\n\treturn CryptoJS.SHA512;\n\n}));",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function () {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var Base = C_lib.Base;\n\t    var C_enc = C.enc;\n\t    var Utf8 = C_enc.Utf8;\n\t    var C_algo = C.algo;\n\n\t    /**\n\t     * HMAC algorithm.\n\t     */\n\t    var HMAC = C_algo.HMAC = Base.extend({\n\t        /**\n\t         * Initializes a newly created HMAC.\n\t         *\n\t         * @param {Hasher} hasher The hash algorithm to use.\n\t         * @param {WordArray|string} key The secret key.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hmacHasher = CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA256, key);\n\t         */\n\t        init: function (hasher, key) {\n\t            // Init hasher\n\t            hasher = this._hasher = new hasher.init();\n\n\t            // Convert string to WordArray, else assume WordArray already\n\t            if (typeof key == 'string') {\n\t                key = Utf8.parse(key);\n\t            }\n\n\t            // Shortcuts\n\t            var hasherBlockSize = hasher.blockSize;\n\t            var hasherBlockSizeBytes = hasherBlockSize * 4;\n\n\t            // Allow arbitrary length keys\n\t            if (key.sigBytes > hasherBlockSizeBytes) {\n\t                key = hasher.finalize(key);\n\t            }\n\n\t            // Clamp excess bits\n\t            key.clamp();\n\n\t            // Clone key for inner and outer pads\n\t            var oKey = this._oKey = key.clone();\n\t            var iKey = this._iKey = key.clone();\n\n\t            // Shortcuts\n\t            var oKeyWords = oKey.words;\n\t            var iKeyWords = iKey.words;\n\n\t            // XOR keys with pad constants\n\t            for (var i = 0; i < hasherBlockSize; i++) {\n\t                oKeyWords[i] ^= 0x5c5c5c5c;\n\t                iKeyWords[i] ^= 0x36363636;\n\t            }\n\t            oKey.sigBytes = iKey.sigBytes = hasherBlockSizeBytes;\n\n\t            // Set initial values\n\t            this.reset();\n\t        },\n\n\t        /**\n\t         * Resets this HMAC to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     hmacHasher.reset();\n\t         */\n\t        reset: function () {\n\t            // Shortcut\n\t            var hasher = this._hasher;\n\n\t            // Reset\n\t            hasher.reset();\n\t            hasher.update(this._iKey);\n\t        },\n\n\t        /**\n\t         * Updates this HMAC with a message.\n\t         *\n\t         * @param {WordArray|string} messageUpdate The message to append.\n\t         *\n\t         * @return {HMAC} This HMAC instance.\n\t         *\n\t         * @example\n\t         *\n\t         *     hmacHasher.update('message');\n\t         *     hmacHasher.update(wordArray);\n\t         */\n\t        update: function (messageUpdate) {\n\t            this._hasher.update(messageUpdate);\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Finalizes the HMAC computation.\n\t         * Note that the finalize operation is effectively a destructive, read-once operation.\n\t         *\n\t         * @param {WordArray|string} messageUpdate (Optional) A final message update.\n\t         *\n\t         * @return {WordArray} The HMAC.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hmac = hmacHasher.finalize();\n\t         *     var hmac = hmacHasher.finalize('message');\n\t         *     var hmac = hmacHasher.finalize(wordArray);\n\t         */\n\t        finalize: function (messageUpdate) {\n\t            // Shortcut\n\t            var hasher = this._hasher;\n\n\t            // Compute HMAC\n\t            var innerHash = hasher.finalize(messageUpdate);\n\t            hasher.reset();\n\t            var hmac = hasher.finalize(this._oKey.clone().concat(innerHash));\n\n\t            return hmac;\n\t        }\n\t    });\n\t}());\n\n\n}));",";(function (root, factory, undef) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"), require(\"./x64-core\"), require(\"./sha512\"), require(\"./hmac\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\", \"./x64-core\", \"./sha512\", \"./hmac\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\treturn CryptoJS.HmacSHA512;\n\n}));","import Hex from 'crypto-js/enc-hex'\nimport HmacSHA512 from 'crypto-js/hmac-sha512'\n\nexport function computeHmac (message: string, applicationKey: string, hmacKey: string): string {\n  const hmac = new HmacSHA512(message, applicationKey + hmacKey)\n  return hmac.toString(Hex) as string\n}\n","import { IModel, TExport } from \"../@types/model/Model\"\nimport { TUndoRedoContext } from \"../@types/undo-redo/UndoRedoContext\"\nimport { EventType } from \"../Constants\"\n\nexport class GlobalEvent extends EventTarget\n{\n  private static instance: GlobalEvent\n\n  private constructor()\n  {\n    super()\n  }\n\n  public static getInstance(): GlobalEvent\n  {\n    if (!GlobalEvent.instance) {\n      GlobalEvent.instance = new GlobalEvent()\n    }\n\n    return GlobalEvent.instance\n  }\n\n  private emit(type: string, data?: unknown): void\n  {\n    this.dispatchEvent(new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined)))\n  }\n\n  emitLoaded(): void\n  {\n    this.emit(EventType.LOADED)\n  }\n  emitExported(exports: TExport): void\n  {\n    this.emit(EventType.EXPORTED, exports)\n  }\n  emitChange(undoRedoContext: TUndoRedoContext): void\n  {\n    this.emit(EventType.CHANGED, {\n      canUndo: undoRedoContext.canUndo,\n      canRedo: undoRedoContext.canRedo,\n      canClear: !undoRedoContext.stack[undoRedoContext.stackIndex].isEmpty,\n      stackIndex: undoRedoContext.stackIndex,\n      stackLength: undoRedoContext.stack.length,\n      isEmpty: undoRedoContext.stack[undoRedoContext.stackIndex].isEmpty,\n    })\n  }\n  emitIdle(model: IModel): void\n  {\n    this.emit(EventType.IDLE, model)\n  }\n  emitError(err: Error): void\n  {\n    this.emit(EventType.ERROR, err)\n  }\n  emitClear(model?: IModel): void\n  {\n    this.emit(EventType.CLEAR, model)\n  }\n  emitCleared(model?: IModel): void\n  {\n    this.emit(EventType.CLEARED, model)\n  }\n  emitConvert(): void\n  {\n    this.emit(EventType.CONVERT)\n  }\n  emitImport(jiix: string, mimeType: string): void\n  {\n    this.emit(EventType.IMPORT, { jiix, mimeType })\n  }\n}\n","\nimport { TRecognitionConfiguration } from '../@types/configuration/RecognitionConfiguration'\nimport { TServerConfiguration } from '../@types/configuration/ServerConfiguration'\nimport { IModel } from '../@types/model/Model'\nimport { IRecognizer } from '../@types/recognizer/Recognizer'\nimport { GlobalEvent } from '../event/GlobalEvent'\n\nexport abstract class AbstractRecognizer implements IRecognizer\n{\n  protected serverConfiguration: TServerConfiguration\n  protected recognitionConfiguration: TRecognitionConfiguration\n\n  constructor(serverConfig: TServerConfiguration, recognitionConfig: TRecognitionConfiguration)\n  {\n    this.serverConfiguration = serverConfig\n    this.recognitionConfiguration = recognitionConfig\n  }\n\n  get globalEvent(): GlobalEvent\n  {\n    return GlobalEvent.getInstance()\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\n  init(_height: number, _width: number): void { }\n\n  abstract export(model: IModel, mimeTypes?: string[]): Promise<IModel | never>\n\n  abstract resize(model: IModel): Promise<IModel | never>\n\n}\n","import { TStroke, TStrokeGroup, TStrokeGroupJSON } from \"../@types/stroker/Stroker\"\nimport { TRecognitionConfiguration } from \"../@types/configuration/RecognitionConfiguration\"\nimport { TServerConfiguration } from \"../@types/configuration/ServerConfiguration\"\nimport { IModel, TExport, TJIIXExport } from \"../@types/model/Model\"\nimport { TPenStyle } from \"../@types/style/PenStyle\"\n\nimport Constants from '../Constants'\nimport StyleHelper from \"../style/StyleHelper\"\nimport { computeHmac } from \"./CryptoHelper\"\nimport { AbstractRecognizer } from \"./AbstractRecognizer\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\nexport class RestRecognizer extends AbstractRecognizer\n{\n  constructor(serverConfig: TServerConfiguration, recognitionConfig: TRecognitionConfiguration)\n  {\n    super(serverConfig, recognitionConfig)\n  }\n\n  get url()\n  {\n    return `${ this.serverConfiguration.scheme }://${ this.serverConfiguration.host }/api/v4.0/iink/batch`\n  }\n\n  get postConfig()\n  {\n    switch (this.recognitionConfiguration.type) {\n      case 'DIAGRAM':\n        return {\n          lang: this.recognitionConfiguration.lang,\n          diagram: this.recognitionConfiguration.diagram,\n          export: this.recognitionConfiguration.export\n        }\n      case 'MATH':\n        return {\n          lang: this.recognitionConfiguration.lang,\n          math: this.recognitionConfiguration.math,\n          export: this.recognitionConfiguration.export\n        }\n      case 'Raw Content':\n        return {\n          lang: this.recognitionConfiguration.lang,\n          'raw-content': this.recognitionConfiguration.rawContent,\n          export: this.recognitionConfiguration.export\n        }\n      case 'TEXT':\n        return {\n          lang: this.recognitionConfiguration.lang,\n          text: this.recognitionConfiguration.text,\n          export: this.recognitionConfiguration.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${ this.recognitionConfiguration.type }\"`)\n        break\n    }\n  }\n\n  private buildData(model: IModel)\n  {\n    const newStrokes: TStrokeGroupJSON[] = []\n    model.strokeGroups.forEach((group: TStrokeGroup) =>\n    {\n      const newPenStyle = JSON.stringify(group.penStyle) === '{}' ? undefined : StyleHelper.penStyleToCSS(group.penStyle as TPenStyle)\n      const newGroup = {\n        penStyle: newPenStyle,\n        strokes: group.strokes.map((s: TStroke) =>\n        {\n          return {\n            x: s.x,\n            y: s.y,\n            t: s.t,\n            p: s.p,\n            pointerType: s.pointerType\n          }\n        })\n      }\n      newStrokes.push(newGroup)\n    })\n\n    const contentType: string = this.recognitionConfiguration.type === 'Raw Content' ?\n      'Raw Content' :\n      this.recognitionConfiguration.type.charAt(0).toUpperCase() + this.recognitionConfiguration.type.slice(1).toLowerCase()\n\n    return {\n      configuration: this.postConfig,\n      xDPI: 96,\n      yDPI: 96,\n      contentType,\n      // conversionState: 'DIGITAL_EDIT', 'HANDWRITING'\n      // theme: StyleHelper.themeToCSS(),\n      height: model.height,\n      width: model.width,\n      strokeGroups: newStrokes\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private async post(data: any, mimeType: string): Promise<any>\n  {\n    const headers = new Headers()\n    headers.append('Accept', 'application/json,' + mimeType)\n    headers.append('applicationKey', this.serverConfiguration.applicationKey)\n    headers.append('hmac', computeHmac(JSON.stringify(data), this.serverConfiguration.applicationKey, this.serverConfiguration.hmacKey))\n    headers.append('Content-Type', 'application/json')\n    const reqInit: RequestInit = {\n      method: 'POST',\n      headers,\n      body: JSON.stringify(data)\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get('content-type')\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      let result: any\n      switch (contentType) {\n        case 'application/vnd.openxmlformats-officedocument.presentationml.presentation':\n        case 'image/png':\n        case 'image/jpeg':\n          result = await response.blob()\n          break\n        case 'application/json':\n          result = await response.json()\n          break\n        case 'application/vnd.myscript.jiix':\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      throw err\n    }\n  }\n\n  private async callPostMessage(model: IModel, mimeType: string): Promise<TExport | never>\n  {\n    const data = this.buildData(model)\n    return this.post(data, mimeType)\n      .then((res) =>\n      {\n        const exports: TExport = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        return exports\n      })\n      .catch((err) =>\n      {\n        let message = err.message\n        if (!err.code) {\n          message = Constants.Error.CANT_ESTABLISH\n        }\n        const error = new Error(message)\n        error.name = err.code || ''\n        this.globalEvent.emitError(error)\n        throw error\n      })\n  }\n\n  async export(model: IModel, requestedMimeTypes?: string[]): Promise<IModel | never>\n  {\n    const myModel = model.getClone()\n    myModel.updatePositionSent()\n\n    if (myModel.isEmpty) {\n      return Promise.resolve(myModel)\n    }\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.recognitionConfiguration.type) {\n        case 'DIAGRAM':\n          mimeTypes = this.recognitionConfiguration.diagram.mimeTypes\n          break\n        case 'MATH':\n          mimeTypes = this.recognitionConfiguration.math.mimeTypes\n          break\n        case 'Raw Content':\n          mimeTypes = this.recognitionConfiguration.rawContent.mimeTypes\n          break\n        case 'TEXT':\n          mimeTypes = this.recognitionConfiguration.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.recognitionConfiguration.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n          break\n      }\n    }\n\n    if (!mimeTypes.length) {\n      return Promise.reject(new Error('Export failed, no mimeTypes define in recognition configuration'))\n    }\n\n    const mimeTypesRequiringExport: string[] = mimeTypes.filter(m => !myModel.exports || !myModel.exports[m])\n\n    const exports: TExport[] = await Promise.all(mimeTypesRequiringExport.map(mimeType => this.callPostMessage(myModel, mimeType)))\n\n    myModel.updatePositionReceived()\n\n    exports.forEach(e => {\n      myModel.exports = Object.assign(myModel.exports || {}, e)\n    })\n\n    return myModel\n  }\n\n  async resize(model: IModel): Promise<IModel | never>\n  {\n    return this.export(model)\n  }\n\n}\n","\nexport class DeferredPromise<T> {\n  promise: Promise<T>\n  resolve!: (value: T) => void\n  reject!: (value: Error) => void\n\n  isFullFilled: boolean\n  isPending: boolean\n\n\n  constructor() {\n    this.isFullFilled = false\n    this.isPending = true\n\n    this.promise = new Promise((resolve, reject)=> {\n      this.reject = async (v: unknown) => {\n        this.isFullFilled = true\n        this.isPending = false\n        return reject(v)\n      }\n      this.resolve = async (v: unknown) => {\n        this.isFullFilled = true\n        this.isPending = false\n        return resolve(v as T)\n      }\n    })\n  }\n}","import { IModel } from \"../@types/model/Model\"\nimport { TUndoRedoContext } from \"../@types/undo-redo/UndoRedoContext\"\n\nexport class UndoRedoContext implements TUndoRedoContext\n{\n  stackIndex: number\n  stack: IModel[]\n  canRedo: boolean\n  canUndo: boolean\n\n  constructor(model: IModel)\n  {\n    this.stackIndex = 0\n    this.stack = [model.getClone()]\n    this.canRedo = false\n    this.canUndo = false\n  }\n}\n","import { TUndoRedoConfiguration } from \"../@types/configuration/UndoRedoConfiguration\"\nimport { IModel } from \"../@types/model/Model\"\nimport { TUndoRedoContext } from \"../@types/undo-redo/UndoRedoContext\"\nimport { GlobalEvent } from \"../event/GlobalEvent\"\nimport { UndoRedoContext } from \"./UndoRedoContext\"\n\nexport class UndoRedoManager\n{\n  context: TUndoRedoContext\n  configuration: TUndoRedoConfiguration\n\n  constructor(configuration: TUndoRedoConfiguration, model: IModel)\n  {\n    this.configuration = configuration\n    this.context = new UndoRedoContext(model)\n  }\n\n  get events(): GlobalEvent\n  {\n    return GlobalEvent.getInstance()\n  }\n\n  private updateCanUndoRedo(): void {\n    this.context.canRedo = this.context.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n  }\n\n  addModelToStack(model: IModel): void {\n    if (this.context.stackIndex + 1 < this.context.stack.length) {\n      this.context.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.context.stackIndex++\n    this.context.stack.push(model.getClone())\n\n    if (this.context.stack.length > this.configuration.maxStackSize) {\n      this.context.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateCanUndoRedo()\n    this.events.emitChange(this.context)\n  }\n\n  updateModelInStack(model: IModel): void {\n    const index = this.context.stack.findIndex(m => m.modificationDate === model.modificationDate)\n    if (index > -1) {\n      this.context.stack.splice(index, 1, model.getClone())\n      this.events.emitChange(this.context)\n    }\n  }\n\n  undo(): IModel {\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateCanUndoRedo()\n      this.events.emitChange(this.context)\n    }\n    return this.context.stack[this.context.stackIndex].getClone()\n  }\n\n  redo(): IModel {\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateCanUndoRedo()\n      this.events.emitChange(this.context)\n    }\n    return this.context.stack[this.context.stackIndex].getClone()\n  }\n\n  reset(model: IModel): void {\n    this.context = new UndoRedoContext(model)\n    this.events.emitChange(this.context)\n  }\n\n}\n","import { IBehaviors } from \"../@types/Behaviors\"\nimport { TConfiguration } from \"../@types/Configuration\"\nimport { IModel, TExport } from \"../@types/model/Model\"\n\nimport { PointerEventGrabber } from '../grabber/PointerEventGrabber'\nimport { CanvasRenderer } from \"../renderer/canvas/CanvasRenderer\"\nimport { QuadraticCanvasStroker } from \"../renderer/canvas/CanvasQuadraticStroker\"\nimport { RestRecognizer } from \"../recognizer/RestRecognizer\"\nimport { DeferredPromise } from \"../utils/DeferredPromise\"\nimport { TTriggerConfiguration } from \"../@types/configuration/TriggerConfiguration\"\nimport { GlobalEvent } from \"../event/GlobalEvent\"\nimport { UndoRedoManager } from \"../undo-redo/UndoRedoManager\"\n\nexport class RestBehaviors implements IBehaviors\n{\n  grabber: PointerEventGrabber\n  stroker: QuadraticCanvasStroker\n  renderer: CanvasRenderer\n  recognizer: RestRecognizer\n  undoRedoManager: UndoRedoManager\n  private _triggerConfiguration: TTriggerConfiguration\n  private _resizeTimer?: ReturnType<typeof setTimeout>\n  private _exportTimer?: ReturnType<typeof setTimeout>\n  initalise: DeferredPromise<void | Error>\n\n  constructor(configuration: TConfiguration, model: IModel)\n  {\n    this.grabber = new PointerEventGrabber(configuration.grabber)\n    this.stroker = new QuadraticCanvasStroker()\n    this.renderer = new CanvasRenderer(configuration.rendering)\n    this.recognizer = new RestRecognizer(configuration.server, configuration.recognition)\n    this.undoRedoManager = new UndoRedoManager(configuration[\"undo-redo\"], model.getClone())\n\n    this._triggerConfiguration = configuration.triggers\n    this.initalise = new DeferredPromise<void | Error>()\n  }\n\n  get globalEvents(): GlobalEvent\n  {\n    return GlobalEvent.getInstance()\n  }\n\n  private async _export(model: IModel, mimeTypes?: string[]): Promise<IModel | never>\n  {\n    const newModel = await this.recognizer.export(model, mimeTypes)\n    this.globalEvents.emitExported(newModel?.exports as TExport)\n    return newModel\n  }\n\n  init(domElement: HTMLElement): Promise<void | Error>\n  {\n    this.grabber.attach(domElement)\n    this.renderer.init(domElement)\n    this.initalise.resolve()\n    return this.initalise.promise\n  }\n\n  drawCurrentStroke(model: IModel): void\n  {\n    this.renderer.drawCurrentStroke(model, this.stroker)\n  }\n\n  drawModel(model: IModel): void\n  {\n    this.renderer.drawModel(model, this.stroker)\n  }\n\n  async export(model: IModel, mimeTypes?: string[]): Promise<IModel | never>\n  {\n    const deferred = new DeferredPromise<IModel | never>()\n    this.undoRedoManager.addModelToStack(model)\n    if (this._triggerConfiguration.exportContent !== \"DEMAND\") {\n      clearTimeout(this._exportTimer)\n      let currentModel = model.getClone()\n      this._exportTimer = setTimeout(async () =>\n      {\n        currentModel = await this._export(currentModel, mimeTypes)\n        this.undoRedoManager.updateModelInStack(currentModel)\n        if (model.modificationDate === currentModel.modificationDate) {\n          model.exports = currentModel.exports\n        }\n        deferred.resolve(model)\n      }, this._triggerConfiguration.exportContentDelay)\n    } else {\n      deferred.resolve(model)\n    }\n    return deferred.promise\n  }\n\n  async resize(model: IModel): Promise<IModel>\n  {\n    this.renderer.resize(model, this.stroker)\n    if (model.strokeGroups.length) {\n      const deferredResize = new DeferredPromise<IModel>()\n      clearTimeout(this._resizeTimer)\n      this._resizeTimer = setTimeout(async () =>\n      {\n        const resizeModel = await this.recognizer.resize(model)\n        deferredResize.resolve(resizeModel)\n      }, this._triggerConfiguration.resizeTriggerDelay)\n      return deferredResize.promise\n    } else {\n      return Promise.resolve(model)\n    }\n  }\n\n  async undo(): Promise<IModel>\n  {\n    const oldModel = this.undoRedoManager.undo()\n    this.drawModel(oldModel)\n    const modelUpdated = await this._export(oldModel)\n    this.undoRedoManager.updateModelInStack(modelUpdated)\n    return modelUpdated\n  }\n\n  async redo(): Promise<IModel>\n  {\n    const newModel = this.undoRedoManager.redo()\n    this.drawModel(newModel)\n    const modelUpdated = await this._export(newModel)\n    this.undoRedoManager.updateModelInStack(modelUpdated)\n    return modelUpdated\n  }\n\n  async clear(model: IModel): Promise<IModel>\n  {\n    const myModel = model.getClone()\n    myModel.clear()\n    this.undoRedoManager.addModelToStack(myModel)\n    this.drawModel(myModel)\n    myModel.modificationDate = new Date().getTime()\n    console.log('myModel.exports: ', myModel.exports);\n    this.globalEvents.emitExported(myModel.exports as TExport)\n    this.globalEvents.emitCleared(myModel)\n    return myModel\n  }\n}\n","import { TWebSocketContentChangeEvent, TWebSocketExportEvent, TWebSocketPartChangeEvent, TWebSocketPatchEvent } from \"../@types/recognizer/WSRecognizer\"\nimport { WSEventType } from \"../Constants\"\n\nexport class WSEvent extends EventTarget\n{\n  private abortController: AbortController\n\n  constructor()\n  {\n    super()\n    this.abortController = new AbortController()\n  }\n\n  private emit(type: string, data?: unknown): void\n  {\n    this.dispatchEvent(new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined)))\n  }\n\n  emitInitialized(): void\n  {\n    this.emit(WSEventType.INITIALIZED)\n  }\n  emitConnected(): void\n  {\n    this.emit(WSEventType.CONNECTED)\n  }\n\n  emitConnectionActive(): void\n  {\n    this.emit(WSEventType.CONNECTION_ACTIVE)\n  }\n  addConnectionActiveListener(callback: () => void): void\n  {\n    this.addEventListener(WSEventType.CONNECTION_ACTIVE, () => callback(), { signal: this.abortController.signal })\n  }\n\n  emitDisconnected(event: CloseEvent): void\n  {\n    this.emit(WSEventType.DISCONNECTED, event)\n  }\n  addDisconnectedListener(callback: (event: CloseEvent) => void): void\n  {\n    this.addEventListener(WSEventType.DISCONNECTED, (evt: unknown) => callback(((evt as CustomEvent).detail as CloseEvent)), { signal: this.abortController.signal })\n  }\n\n  emitPartChange(partChange: TWebSocketPartChangeEvent): void\n  {\n    this.emit(WSEventType.PART_CHANGE, partChange)\n  }\n  addPartChangeListener(callback: (partChange: TWebSocketPartChangeEvent) => void): void\n  {\n    this.addEventListener(WSEventType.PART_CHANGE, (evt: unknown) => callback(((evt as CustomEvent).detail as TWebSocketPartChangeEvent)), { signal: this.abortController.signal })\n  }\n\n  emitContentChange(contentChange: TWebSocketContentChangeEvent): void\n  {\n    this.emit(WSEventType.CONTENT_CHANGE, contentChange)\n  }\n  addContentChangeListener(callback: (contentChange: TWebSocketContentChangeEvent) => void): void\n  {\n    this.addEventListener(WSEventType.CONTENT_CHANGE, (evt: unknown) => callback(((evt as CustomEvent).detail as TWebSocketContentChangeEvent)), { signal: this.abortController.signal })\n  }\n\n  emitPatch(patchChange: TWebSocketPatchEvent): void\n  {\n    this.emit(WSEventType.PATCH, patchChange)\n  }\n  addPatchListener(callback: (contentChange: TWebSocketPatchEvent) => void): void\n  {\n    this.addEventListener(WSEventType.PATCH, (evt: unknown) => callback(((evt as CustomEvent).detail as TWebSocketPatchEvent)), { signal: this.abortController.signal })\n  }\n\n  emitExported(exports: TWebSocketExportEvent): void\n  {\n    this.emit(WSEventType.EXPORTED, exports)\n  }\n  addExportListener(callback: (exports: TWebSocketExportEvent) => void): void\n  {\n    this.addEventListener(WSEventType.EXPORTED, (evt: unknown) => callback(((evt as CustomEvent).detail as TWebSocketExportEvent)), { signal: this.abortController.signal })\n  }\n\n  clearListeners()\n  {\n    this.abortController.abort()\n  }\n}","import { TRecognitionConfiguration } from \"../@types/configuration/RecognitionConfiguration\"\nimport { TServerConfiguration } from \"../@types/configuration/ServerConfiguration\"\nimport { IModel } from \"../@types/model/Model\"\nimport { TWebSocketContentChangeEvent, TWebSocketErrorEvent, TWebSocketEvent, TWebSocketExportEvent, TWebSocketHMACChallengeEvent, TWebSocketPartChangeEvent, TWebSocketPatchEvent } from \"../@types/recognizer/WSRecognizer\"\nimport { TStroke } from \"../@types/stroker/Stroker\"\nimport { Error as ErrorConst, WSEventType } from \"../Constants\"\nimport { WSEvent } from \"../event/WSEvent\"\nimport { AbstractRecognizer } from \"./AbstractRecognizer\"\nimport { computeHmac } from \"./CryptoHelper\"\n\nexport class WSRecognizer extends AbstractRecognizer\n{\n  private socket!: WebSocket\n  private pingCount = 0\n  private reconnectionCount = 0\n  // private contentPartCount = 0\n  private sessionId?: string\n  private currentPartId?: string\n  private viewSizeHeight!: number\n  private viewSizeWidth!: number\n  private currentErrorCode?: string | number\n  wsEvent: WSEvent\n\n  constructor(serverConfig: TServerConfiguration, recognitionConfig: TRecognitionConfiguration)\n  {\n    super(serverConfig, recognitionConfig)\n    this.wsEvent = new WSEvent()\n  }\n\n  get url()\n  {\n    const scheme = (this.serverConfiguration.scheme === 'https') ? 'wss' : 'ws'\n    return `${ scheme }://${ this.serverConfiguration.host }/api/v4.0/iink/document`\n  }\n\n  get mimeTypes(): string[]\n  {\n    switch (this.recognitionConfiguration.type.toLocaleLowerCase()) {\n      case 'text':\n        return this.recognitionConfiguration.text.mimeTypes\n      case 'math':\n        return this.recognitionConfiguration.math.mimeTypes\n      case 'raw-content':\n        return this.recognitionConfiguration.rawContent.mimeTypes\n      case 'diagram':\n        return this.recognitionConfiguration.diagram.mimeTypes\n      default:\n        return []\n    }\n  }\n\n  private infinitePing(): void\n  {\n    this.pingCount++\n    if (this.serverConfiguration.websocket.maxPingLostCount < this.pingCount) {\n      this.close(1000, 'PING_LOST')\n    } else if (this.socket.readyState <= 1) {\n      setTimeout(() =>\n      {\n        if (this.socket.readyState <= 1) {\n          this.socket.send(JSON.stringify({ type: 'ping' }))\n          this.infinitePing()\n        }\n      }, this.serverConfiguration.websocket.pingDelay)\n    }\n  }\n\n  private openCallback(): void\n  {\n    this.wsEvent.emitConnected()\n    const params = {\n      type: this.sessionId ? 'restoreIInkSession' : 'newContentPackage',\n      iinkSessionId: this.sessionId,\n      applicationKey: this.serverConfiguration.applicationKey,\n      xDpi: 96,\n      yDpi: 96,\n      viewSizeHeight: this.viewSizeHeight,\n      viewSizeWidth: this.viewSizeWidth\n    }\n    this.send(params)\n  }\n\n  private closeCallback(evt: CloseEvent): void\n  {\n    let message = ''\n    if (this.currentErrorCode) return\n    switch (evt.code) {\n      case 1000:\n        // Normal Closure\n        break\n      case 1001:\n        message = ErrorConst.GOING_AWAY\n        break\n      case 1002:\n        message = ErrorConst.PROTOCOL_ERROR\n        break\n      case 1003:\n        message = ErrorConst.UNSUPPORTED_DATA\n        break\n      case 1005:\n        message = ErrorConst.UNSUPPORTED_DATA\n        break\n      case 1006:\n        message = ErrorConst.ABNORMAL_CLOSURE\n        break\n      case 1007:\n        message = ErrorConst.INVALID_FRAME_PAULOAD\n        break\n      case 1008:\n        message = ErrorConst.POLICY_VIOLATION\n        break\n      case 1009:\n        message = ErrorConst.MESSAGE_TOO_BIG\n        break\n      case 1011:\n        message = ErrorConst.INTERNAL_ERROR\n        break\n      case 1012:\n        message = ErrorConst.SERVICE_RESTART\n        break\n      case 1013:\n        message = ErrorConst.TRY_AGAIN\n        break\n      case 1014:\n        message = ErrorConst.BAD_GATEWAY\n        break\n      case 1015:\n        message = ErrorConst.TLS_HANDSHAKE\n        break\n      default:\n        message = ErrorConst.CANT_ESTABLISH\n        break\n    }\n    if (message) {\n      this.globalEvent.emitError(new Error(message))\n    }\n    this.wsEvent.emitDisconnected(evt)\n  }\n\n  private errorCallback(e: Event): void\n  {\n    this.globalEvent.emitError(new Error(e.type))\n  }\n\n  private manageHMACChallengeMessage(websocketMessage: TWebSocketEvent): void\n  {\n    const hmacChallengeMessage = websocketMessage as TWebSocketHMACChallengeEvent\n    if (hmacChallengeMessage.hmacChallenge) {\n      this.send({\n        type: 'hmac',\n        hmac: computeHmac(hmacChallengeMessage.hmacChallenge, this.serverConfiguration.applicationKey, this.serverConfiguration.hmacKey)\n      })\n    }\n    if (hmacChallengeMessage.iinkSessionId) {\n      this.sessionId = hmacChallengeMessage.iinkSessionId\n    }\n  }\n\n  private manageContentPackageDescriptionMessage(): void\n  {\n    this.reconnectionCount = 0\n\n    this.send({ ...this.recognitionConfiguration, type: 'configuration' })\n\n    if (this.currentPartId) {\n      this.send({ type: 'openContentPart', id: this.currentPartId, mimeTypes: this.mimeTypes })\n    }\n    else {\n      this.send({ type: 'newContentPart', contentType: this.recognitionConfiguration.type, mimeTypes: this.mimeTypes })\n    }\n  }\n\n  private managePartChangeMessage(websocketMessage: TWebSocketEvent): void\n  {\n    const partChangeMessage = websocketMessage as TWebSocketPartChangeEvent\n    this.currentPartId = partChangeMessage.partId\n    this.wsEvent.emitPartChange(partChangeMessage)\n  }\n\n  private manageContentChangeMessage(websocketMessage: TWebSocketEvent): void\n  {\n    const contentChangeMessage = websocketMessage as TWebSocketContentChangeEvent\n    this.wsEvent.emitContentChange(contentChangeMessage)\n  }\n\n  private manageExportMessage(websocketMessage: TWebSocketEvent): void\n  {\n    const exportMessage = websocketMessage as TWebSocketExportEvent\n    this.wsEvent.emitExported(exportMessage)\n  }\n\n  private managePatchMessage(websocketMessage: TWebSocketEvent): void\n  {\n    const patchMessage = websocketMessage as TWebSocketPatchEvent\n    this.wsEvent.emitPatch(patchMessage)\n  }\n\n  private manageErrorMessage(websocketMessage: TWebSocketEvent): void\n  {\n    const err = websocketMessage as TWebSocketErrorEvent\n    this.currentErrorCode = err.data?.code || err.code\n    let message = err.data?.message || err.message\n    switch (this.currentErrorCode) {\n      case 'no.activity':\n        message = ErrorConst.NO_ACTIVITY\n        break\n      case 'api.invalid.format':\n        message = err.message\n        break\n      case 'access.not.granted':\n        message = ErrorConst.WRONG_CREDENTIALS\n        break\n      case 'session.too.old':\n        message = ErrorConst.TOO_OLD\n        break\n      default:\n        if (!message) {\n          message = ErrorConst.UNKNOW\n        }\n        break\n    }\n    this.globalEvent.emitError(new Error(message))\n  }\n\n  private messageCallback(message: MessageEvent<string>): void\n  {\n    this.currentErrorCode = undefined\n    const websocketMessage: TWebSocketEvent = JSON.parse(message.data)\n    if (websocketMessage.type !== 'pong') {\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case 'ack':\n          this.manageHMACChallengeMessage(websocketMessage)\n          break\n        case 'contentPackageDescription':\n          this.manageContentPackageDescriptionMessage()\n          break\n        case 'partChanged':\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case 'newPart':\n          this.wsEvent.emitConnectionActive()\n          break\n        case 'contentChanged':\n          this.manageContentChangeMessage(websocketMessage)\n          break\n        case 'exported':\n          this.manageExportMessage(websocketMessage)\n          break\n        case 'svgPatch':\n          this.managePatchMessage(websocketMessage)\n          break\n        case 'error':\n          this.manageErrorMessage(websocketMessage)\n          break\n        // case 'supportedImportMimeTypes':\n        //   recognizerContext.supportedImportMimeTypes = message.data.mimeTypes\n        //   recognitionContext.response(undefined, message.data)\n        //   break\n        //   case 'fileChunkAck':\n        //     recognitionContext.response(undefined, message.data)\n        //     break\n        //   case 'idle':\n        //     recognizerContext.idle = true\n        //     recognitionContext.patch(undefined, message.data)\n        //     break\n        //   default :\n        //     logger.warn('This is something unexpected in current recognizer. Not the type of message we should have here.', message)\n      }\n    }\n  }\n\n  init(height: number, width: number): void\n  {\n    try {\n      this.viewSizeHeight = height\n      this.viewSizeWidth = width\n\n      this.socket = new WebSocket(this.url)\n\n      if (this.serverConfiguration.websocket.pingEnabled) {\n        this.infinitePing()\n      }\n\n      this.socket.onopen = () => this.openCallback()\n      this.socket.onclose = (ev: CloseEvent) => this.closeCallback(ev)\n      this.socket.onerror = (ev: Event) => this.errorCallback(ev)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      this.socket.onmessage = (ev: MessageEvent<any>) => this.messageCallback(ev)\n\n      this.wsEvent.emitInitialized()\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    } catch (err: any) {\n      const error = new Error(ErrorConst.CANT_ESTABLISH)\n      error.name = err.code || 'CANT_ESTABLISH'\n      this.globalEvent.emitError(err)\n    }\n  }\n\n  canReconnect(): boolean\n  {\n    return this.socket && this.serverConfiguration.websocket.autoReconnect &&\n      this.reconnectionCount <= this.serverConfiguration.websocket.maxRetryCount &&\n      (!this.currentErrorCode || !['api.invalid.format', 'access.not.granted'].includes(this.currentErrorCode.toString()))\n  }\n\n  shouldAttemptReconnect() : boolean {\n    this.reconnectionCount++\n    return this.canReconnect()\n  }\n\n  addStrokes(model: IModel): void {\n    const strokes: TStroke[] = model.extractPendingStrokes()\n    if (strokes.length === 0) {\n      return\n    }\n    this.send({\n      type: 'addStrokes',\n      strokes: strokes.map((s: TStroke) =>\n      {\n        return {\n          pointerType: s.pointerType,\n          pointerId: s.pointerId,\n          x: s.x,\n          y: s.y,\n          t: s.t,\n          p: s.p,\n        }\n      })\n    })\n  }\n\n  send(message: TWebSocketEvent): void\n  {\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.socket.send(JSON.stringify(message))\n    } else {\n      this.socket.removeEventListener('close', this.closeCallback)\n      this.socket.removeEventListener('error', this.errorCallback)\n      this.socket.removeEventListener('message', this.messageCallback)\n      this.socket.removeEventListener('open', this.openCallback)\n      throw new Error(WSEventType.DISCONNECTED)\n    }\n  }\n\n  close(code: number, reason: string): void\n  {\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.socket.close(code, reason)\n    }\n  }\n\n  async export(model: IModel, requestedMimeTypes?: string[]): Promise<IModel | never>\n  {\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.recognitionConfiguration.type) {\n        case 'DIAGRAM':\n          mimeTypes = this.recognitionConfiguration.diagram.mimeTypes\n          break\n        case 'MATH':\n          mimeTypes = this.recognitionConfiguration.math.mimeTypes\n          break\n        case 'Raw Content':\n          mimeTypes = this.recognitionConfiguration.rawContent.mimeTypes\n          break\n        case 'TEXT':\n          mimeTypes = this.recognitionConfiguration.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.recognitionConfiguration.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n          break\n      }\n    }\n\n    if (!mimeTypes.length) {\n      return Promise.reject(new Error('Export failed, no mimeTypes define in recognition configuration'))\n    }\n\n    const message: TWebSocketEvent = {\n      type: 'export',\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    this.send(message)\n    return model\n  }\n\n  async resize(model: IModel): Promise<IModel>\n  {\n    this.viewSizeHeight = model.height\n    this.viewSizeWidth = model.width\n    const message: TWebSocketEvent = {\n      type: 'changeViewSize',\n      partId: this.currentPartId,\n      height: this.viewSizeHeight,\n      width: this.viewSizeWidth,\n    }\n    this.send(message)\n    return Promise.resolve(model)\n  }\n}","import { TPenStyle } from '../@types/style/PenStyle'\nimport { TStroke } from '../@types/stroker/Stroker'\n\nexport class Stroke implements TStroke\n{\n  type: string\n  pointerId: number\n  pointerType: string\n  elementType?: string\n  x: number[]\n  y: number[]\n  t: number[]\n  p: number[]\n  l: number[]\n  color: string\n  width: number\n  '-myscript-pen-width': number\n  '-myscript-pen-fill-style': string\n  '-myscript-pen-fill-color': string\n\n  constructor(style: TPenStyle, pointerId: number, pointerType = 'pen')\n  {\n    this.type = 'stroke'\n    this.pointerId = pointerId\n    this.pointerType = pointerType\n    this.x = []\n    this.y = []\n    this.t = []\n    this.p = []\n    this.l = []\n    this.color = style.color\n    this.width = style.width\n    this['-myscript-pen-width'] = style['-myscript-pen-width']\n    this['-myscript-pen-fill-style'] = style['-myscript-pen-fill-style']\n    this['-myscript-pen-fill-color'] = style['-myscript-pen-fill-color']\n  }\n}","import { TPenStyle } from '../@types/style/PenStyle'\nimport { TPoint } from '../@types/renderer/Point'\nimport { TStroke, TStrokeGroup } from '../@types/stroker/Stroker'\nimport { IModel, TExport, TRawResults } from '../@types/model/Model'\nimport { TRecognitionPositions } from '../@types/model/RecognitionPositions'\nimport { Stroke } from './Stroke'\n\nexport class Model implements IModel\n{\n  readonly creationTime: number\n  modificationDate: number\n  currentStroke?: TStroke\n  strokeGroups: TStrokeGroup[]\n  positions: TRecognitionPositions\n  defaultSymbols: TStroke[]\n  rawStrokes: TStroke[]\n  recognizedSymbols?: TStroke[]\n  rawResults: TRawResults\n  exports?: TExport\n  width: number\n  height: number\n  idle: boolean\n  isEmpty: boolean\n\n  constructor(width: number, height: number, creationDate: number = new Date().getTime())\n  {\n    this.rawStrokes = []\n    this.strokeGroups = []\n    this.positions = {\n      lastSentPosition: -1,\n      lastReceivedPosition: -1,\n      lastRenderedPosition: -1\n    }\n    this.defaultSymbols = []\n    this.rawResults = {\n      convert: undefined,\n      exports: undefined\n    }\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.idle = true\n    this.isEmpty = true\n  }\n\n  private computeDistance (point1: TPoint, point2: TPoint): number {\n    const distance = Math.sqrt(Math.pow((point1.y - point2.y), 2) + Math.pow((point1.x - point2.x), 2))\n    return isNaN(distance) ? 0 : distance\n  }\n\n  private computeLength (point1: TPoint, point2: TPoint, lastDistance: number): number {\n    const length = lastDistance + this.computeDistance(point1, point2)\n    return isNaN(length) ? 0 : length\n  }\n\n  private computePressure (point1: TPoint, point2: TPoint, lastDistance: number): number {\n    let ratio = 1.0\n    const distance = this.computeDistance(point1, point2)\n    const length = this.computeLength(point1, point2, lastDistance)\n\n    if (length === 0) {\n      ratio = 0.5\n    } else if (distance === length) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > length - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (length - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  private filterPointByAcquisitionDelta(stroke: TStroke, point: TPoint): boolean\n  {\n    const delta: number = (2 + (stroke['-myscript-pen-width'] / 4))\n    return stroke.x.length === 0 || stroke.y.length === 0 ||\n      Math.abs(stroke.x[stroke.x.length - 1] - point.x) >= delta ||\n      Math.abs(stroke.y[stroke.y.length - 1] - point.y) >= delta\n  }\n\n  addPoint(stroke: TStroke, point: TPoint): void\n  {\n    if (this.filterPointByAcquisitionDelta(stroke, point)) {\n      const lastPoint: TPoint = {\n        x: stroke.x[stroke.x.length -1],\n        y: stroke.y[stroke.y.length -1],\n        p: stroke.p[stroke.p.length -1],\n        t: stroke.t[stroke.t.length -1],\n      }\n      const lastDistance: number = stroke.l[stroke.l.length - 1]\n      stroke.x.push(point.x)\n      stroke.y.push(point.y)\n      stroke.t.push(point.t)\n      stroke.p.push(this.computePressure(point, lastPoint, lastDistance))\n      stroke.l.push(this.computeLength(point, lastPoint, lastDistance))\n    }\n  }\n\n  addStroke(stroke: TStroke): void\n  {\n    this.rawStrokes.push(stroke)\n  }\n\n  extractPendingStrokes(position?: number): TStroke[]\n  {\n    position = position || this.positions.lastReceivedPosition + 1\n    return this.rawStrokes.slice(position)\n  }\n\n  addStrokeToGroup(stroke: TStroke, strokePenStyle: TPenStyle): void\n  {\n    const lastGroup = this.strokeGroups.length - 1\n\n    const isPenStyleEqual = (ps1: TPenStyle, ps2: TPenStyle) => {\n      return ps1['-myscript-pen-fill-color'] === ps2['-myscript-pen-fill-color'] &&\n        ps1['-myscript-pen-fill-style'] === ps2['-myscript-pen-fill-style'] &&\n        ps1['-myscript-pen-width'] === ps2['-myscript-pen-width'] &&\n        ps1.color === ps2.color &&\n        ps1.width === ps2.width\n    }\n\n    if (this.strokeGroups[lastGroup] && isPenStyleEqual(this.strokeGroups[lastGroup].penStyle, strokePenStyle)) {\n      this.strokeGroups[lastGroup].strokes.push(stroke)\n    } else {\n      const newStrokeGroup: TStrokeGroup = {\n        penStyle: strokePenStyle,\n        strokes: [stroke]\n      }\n      this.strokeGroups.push(newStrokeGroup)\n    }\n    this.isEmpty = false\n  }\n\n  initCurrentStroke(point: TPoint, pointerId: number, pointerType: string, style: TPenStyle, dpi = 96): void\n  {\n    if (style['-myscript-pen-width']) {\n      const pxWidth = (style['-myscript-pen-width'] * dpi) / 25.4\n      style.width = pxWidth / 2\n    }\n    this.modificationDate = new Date().getTime()\n    this.exports = undefined\n    this.currentStroke = new Stroke(style, pointerId, pointerType)\n    this.addPoint(this.currentStroke, point)\n  }\n\n  appendToCurrentStroke(point: TPoint): void\n  {\n    if (this.currentStroke) {\n      this.addPoint(this.currentStroke, point)\n    }\n  }\n\n  endCurrentStroke(point: TPoint, penStyle: TPenStyle): void\n  {\n    if (this.currentStroke) {\n      this.addPoint(this.currentStroke, point)\n      // Mutating pending strokes\n      this.addStroke(this.currentStroke)\n      this.addStrokeToGroup(this.currentStroke, penStyle)\n      // Resetting the current stroke to an undefined one\n      this.currentStroke = undefined\n    }\n  }\n\n  updatePositionSent(position: number = this.rawStrokes.length - 1): void\n  {\n    this.positions.lastSentPosition = position\n  }\n\n  updatePositionReceived(): void\n  {\n    this.positions.lastReceivedPosition = this.positions.lastSentPosition\n  }\n\n  updatePositionRendered(position: number = this.recognizedSymbols ? this.recognizedSymbols.length - 1 : -1): void\n  {\n    this.positions.lastRenderedPosition = position\n  }\n\n  resetPositionRenderer(): void\n  {\n    this.positions.lastRenderedPosition = -1\n  }\n\n  resetPositions(): void\n  {\n    this.positions.lastSentPosition = -1\n    this.positions.lastReceivedPosition = -1\n  }\n\n  getClone(): IModel\n  {\n    const clonedModel = new Model(this.width, this.height, this.creationTime)\n    clonedModel.modificationDate = JSON.parse(JSON.stringify(this.modificationDate))\n    clonedModel.defaultSymbols = JSON.parse(JSON.stringify(this.defaultSymbols))\n    clonedModel.currentStroke = this.currentStroke ? JSON.parse(JSON.stringify(this.currentStroke)) : undefined\n    clonedModel.rawStrokes = JSON.parse(JSON.stringify(this.rawStrokes))\n    clonedModel.strokeGroups = JSON.parse(JSON.stringify(this.strokeGroups))\n    clonedModel.positions = JSON.parse(JSON.stringify(this.positions))\n    clonedModel.exports = this.exports ? JSON.parse(JSON.stringify(this.exports)) : undefined\n    clonedModel.rawResults.convert = this.rawResults.convert ? JSON.parse(JSON.stringify(this.rawResults.convert)) : undefined\n    clonedModel.rawResults.exports = this.rawResults.exports ? JSON.parse(JSON.stringify(this.rawResults.exports)) : undefined\n    clonedModel.recognizedSymbols = this.recognizedSymbols ? JSON.parse(JSON.stringify(this.recognizedSymbols)) : undefined\n    clonedModel.idle = this.idle\n    clonedModel.isEmpty = this.isEmpty\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.modificationDate = new Date().getTime()\n    this.currentStroke = undefined\n    this.rawStrokes = []\n    this.strokeGroups = []\n    this.positions.lastSentPosition = -1\n    this.positions.lastReceivedPosition = -1\n    this.positions.lastRenderedPosition = -1\n    this.recognizedSymbols = undefined\n    this.exports = undefined\n    this.rawResults.convert = undefined\n    this.rawResults.exports = undefined\n    this.idle = true\n    this.isEmpty = true\n  }\n}\n","import { IBehaviors } from \"../@types/Behaviors\"\nimport { IStroker } from \"../@types/stroker/Stroker\"\nimport { TConfiguration } from \"../@types/Configuration\"\nimport { IRenderer } from \"../@types/renderer/Renderer\"\nimport { IModel, TExport } from \"../@types/model/Model\"\n\nimport { PointerEventGrabber } from '../grabber/PointerEventGrabber'\nimport { CanvasRenderer } from \"../renderer/canvas/CanvasRenderer\"\nimport { QuadraticCanvasStroker } from \"../renderer/canvas/CanvasQuadraticStroker\"\nimport { WSRecognizer } from \"../recognizer/WSRecognizer\"\nimport { TWebSocketContentChangeEvent, TWebSocketExportEvent, TWebSocketPartChangeEvent, TWebSocketPatchEvent } from \"../@types/recognizer/WSRecognizer\"\nimport { DeferredPromise } from \"../utils/DeferredPromise\"\nimport { Model } from \"../model/Model\"\nimport { GlobalEvent } from \"../event/GlobalEvent\"\n\nexport class WSBehaviors implements IBehaviors\n{\n  grabber: PointerEventGrabber\n  stroker: IStroker\n  renderer: IRenderer\n  recognizer: WSRecognizer\n  initalise: DeferredPromise<void>\n  exportDeffered?: DeferredPromise<TExport>\n  addStrokeDeffered?: DeferredPromise<IModel>\n\n  constructor(configuration: TConfiguration)\n  {\n    this.grabber = new PointerEventGrabber(configuration.grabber)\n    this.stroker = new QuadraticCanvasStroker()\n    this.renderer = new CanvasRenderer(configuration.rendering)\n    this.recognizer = new WSRecognizer(configuration.server, configuration.recognition)\n    this.initalise = new DeferredPromise<void>()\n  }\n\n  get globalEvents(): GlobalEvent\n  {\n    return GlobalEvent.getInstance()\n  }\n\n  init(domElement: HTMLElement, model: IModel): Promise<void>\n  {\n    this.grabber.attach(domElement)\n    this.renderer.init(domElement)\n    this.recognizer.init(model.height, model.width)\n\n    this.recognizer.wsEvent.addConnectionActiveListener(this.onConnectionActive)\n    this.recognizer.wsEvent.addPartChangeListener(this.onPartChange)\n    this.recognizer.wsEvent.addContentChangeListener(this.onContentChange)\n    this.recognizer.wsEvent.addPatchListener(this.onPatch)\n    this.recognizer.wsEvent.addExportListener(this.onExport)\n    this.recognizer.wsEvent.addDisconnectedListener(this.onDisconnected)\n\n    return this.initalise.promise\n  }\n\n  private onConnectionActive = () => {\n    this.initalise.resolve()\n  }\n\n  private onPartChange = (evt: TWebSocketPartChangeEvent) =>\n  {\n    console.log('onPartChange evt:', evt)\n  }\n\n  private onContentChange = (evt: TWebSocketContentChangeEvent) =>\n  {\n    console.log('onContentChange evt:', evt)\n    this.addStrokeDeffered?.resolve({} as IModel)\n  }\n\n  private onPatch = (evt: TWebSocketPatchEvent) =>\n  {\n    console.log('onContentChange evt:', evt)\n  }\n\n  private onExport = (exportMessage: TWebSocketExportEvent) =>\n  {\n    console.log('WSBehaviors => callback on WSExported exportMessage: ', exportMessage)\n    this.exportDeffered?.resolve(exportMessage.exports)\n    this.globalEvents.emitExported(exportMessage.exports)\n  }\n\n  private onDisconnected = (event: CloseEvent) =>\n  {\n    if (this.initalise.isPending) {\n      if (event.code === 1000) {\n        this.initalise.resolve()\n      } else {\n        const err = new Error(event.reason)\n        err.name = event.code.toString()\n        this.initalise.reject(err)\n      }\n    }\n  }\n\n  drawCurrentStroke(model: IModel): void\n  {\n    this.renderer.drawCurrentStroke(model, this.stroker)\n  }\n\n  drawModel(model: IModel): void\n  {\n    this.renderer.drawModel(model, this.stroker)\n  }\n\n  async addStrokes(model: IModel): Promise<IModel | never>\n  {\n    await this.initalise.promise\n    this.addStrokeDeffered = new DeferredPromise<IModel>()\n    console.log('WSBehaviors => addStrokes model: ', model)\n    this.recognizer.addStrokes(model)\n\n    await this.addStrokeDeffered.promise\n    this.addStrokeDeffered = undefined\n    return model\n  }\n\n  async export(model: IModel, mimeTypes?: string[]): Promise<IModel | never>\n  {\n    await this.initalise.promise\n    this.exportDeffered = new DeferredPromise<TExport>()\n    await this.recognizer.export(model, mimeTypes)\n\n    const exports: TExport = await this.exportDeffered.promise\n\n    model.updatePositionReceived()\n    // model.rawResults.exports = exports\n    if (model.exports) {\n      Object.assign(model.exports, exports)\n    } else {\n      model.exports = exports\n    }\n    this.exportDeffered = undefined\n    return model\n  }\n\n  async resize(model: IModel): Promise<IModel>\n  {\n    await this.initalise.promise\n    return this.recognizer.resize(model)\n  }\n\n  async undo(): Promise<IModel>\n  {\n    await this.initalise.promise\n    // TODO\n    return new Model(1, 1)\n    // const oldModel = this.undoRedoManager.undo()\n    // this.drawModel(oldModel)\n    // const modelUpdated = await this._export(oldModel)\n    // this.undoRedoManager.updateModelInStack(modelUpdated)\n    // return modelUpdated\n  }\n\n  async redo(): Promise<IModel>\n  {\n    await this.initalise.promise\n    // TODO\n    return new Model(1, 1)\n    // const newModel = this.undoRedoManager.redo()\n    // this.drawModel(newModel)\n    // const modelUpdated = await this._export(newModel)\n    // this.undoRedoManager.updateModelInStack(modelUpdated)\n    // return modelUpdated\n  }\n\n  async clear(model: IModel): Promise<IModel>\n  {\n    await this.initalise.promise\n    const myModel = model.getClone()\n    myModel.clear()\n    // this.undoRedoManager.addModelToStack(myModel)\n    // this.behaviors.drawModel(myModel)\n    // this.globalEvents.emitExported(myModel.exports as TExport)\n    // this.globalEvents.emitCleared(myModel)\n    return myModel\n  }\n}\n","import { IBehaviors } from \"../@types/Behaviors\"\nimport { TConfiguration } from \"../@types/Configuration\"\nimport { IModel } from \"../@types/model/Model\"\nimport { RestBehaviors } from \"./RestBehaviors\"\nimport { WSBehaviors } from \"./WSBehaviors\"\n\nexport class BehaviorsManager\n{\n  behaviors!: IBehaviors\n\n  constructor(configuration: TConfiguration, model: IModel, behaviors?: IBehaviors)\n  {\n    this.overrideDefaultBehaviors(configuration, model, behaviors)\n  }\n\n  overrideDefaultBehaviors(configuration: TConfiguration, model: IModel, behaviors?: IBehaviors)\n  {\n    let defaultBehaviors: IBehaviors\n    if (configuration.server.protocol === 'REST') {\n      defaultBehaviors = new RestBehaviors(configuration, model)\n    } else {\n      defaultBehaviors = new WSBehaviors(configuration)\n    }\n\n    this.behaviors = Object.assign(defaultBehaviors, behaviors)\n  }\n\n  init(domElement: HTMLElement, model: IModel): Promise<void | Error>\n  {\n    return this.behaviors.init(domElement, model)\n  }\n\n}","import { TConfiguration } from '../@types/Configuration'\nimport { TGrabberConfiguration } from \"../@types/configuration/GrabberConfiguration\"\nimport { TRenderingConfiguration } from '../@types/configuration/RenderingConfiguration'\nimport { TServerConfiguration } from '../@types/configuration/ServerConfiguration'\nimport { TRecognitionConfiguration } from '../@types/configuration/RecognitionConfiguration'\nimport { TTriggerConfiguration } from '../@types/configuration/TriggerConfiguration'\nimport { TEventConfiguration } from '../@types/configuration/EventConfiguration'\nimport { TUndoRedoConfiguration } from '../@types/configuration/UndoRedoConfiguration'\n\nexport const DefaultServerConfiguration: TServerConfiguration = {\n  protocol: 'WEBSOCKET',\n  scheme: 'https',\n  host: 'webdemoapi.myscript.com',\n  applicationKey: '',\n  hmacKey: '',\n  useWindowLocation: false,\n  websocket: {\n    pingEnabled: true,\n    pingDelay: 30000,\n    maxPingLostCount: 10,\n    autoReconnect: true,\n    maxRetryCount: 2,\n    fileChunkSize: 300000\n  }\n}\n\nexport const DefaultRecognitionConfiguration: TRecognitionConfiguration = {\n  type: 'TEXT',\n  alwaysConnected: true,\n  lang: 'en_US',\n  gesture: {\n    enable: true\n  },\n  export: {\n    'image-resolution': 300,\n    jiix: {\n      'bounding-box': false,\n      strokes: false,\n      text: {\n        chars: false,\n        words: true\n      }\n    },\n  },\n  renderer: {\n    debug: {\n      'draw-text-boxes': false,\n      'draw-image-boxes': false\n    }\n  },\n  math: {\n    mimeTypes: ['application/x-latex'], // 'application/mathml+xml', 'application/vnd.myscript.jiix',\n    solver: {\n      enable: true,\n      'fractional-part-digits': 3,\n      'decimal-separator': '.',\n      'rounding-mode': 'half up',\n      'angle-unit': 'deg'\n    },\n    margin: {\n      bottom: 10,\n      left: 15,\n      right: 15,\n      top: 10\n    },\n    eraser: {\n      'erase-precisely': false\n    },\n    'undo-redo': {\n      mode: 'stroke'\n    }\n  },\n  text: {\n    guides: {\n      enable: true\n    },\n    mimeTypes: ['text/plain'], // 'application/vnd.myscript.jiix'\n    margin: {\n      top: 20,\n      left: 10,\n      right: 10,\n      bottom: 10\n    },\n    eraser: {\n      'erase-precisely': false\n    }\n  },\n  diagram: {\n    mimeTypes: ['application/vnd.myscript.jiix'], // 'application/vnd.openxmlformats-officedocument.presentationml.presentation'\n    eraser: {\n      'erase-precisely': false\n    }\n  },\n  rawContent: {\n    mimeTypes: ['application/vnd.myscript.jiix'],\n    recognition: {\n      text: true,\n      shape: false\n    },\n    eraser: {\n      'erase-precisely': false\n    }\n  }\n}\n\nexport const DefaultGrabberConfiguration: TGrabberConfiguration = {\n  listenerOptions: {\n    capture: false,\n    passive: true\n  },\n  xyFloatPrecision: 0,\n  timestampFloatPrecision: 0\n}\n\nexport const DefaultRenderingConfiguration: TRenderingConfiguration = {\n  minHeight: 100,\n  minWidth: 100,\n  smartGuide: {\n    enable: false,\n    fadeOut: {\n      enable: false,\n      duration: 10000\n    }\n  }\n}\n\nexport const DefaultTriggerConfiguration: TTriggerConfiguration = {\n  exportContent: 'POINTER_UP',\n  exportContentDelay: 1000,\n  resizeTriggerDelay: 100\n}\n\nexport const DefaultEventsConfiguration: TEventConfiguration = {\n  processDelay: 10\n}\n\nexport const DefaultUndoRedoConfiguration: TUndoRedoConfiguration = {\n  maxStackSize: 10\n}\n\nexport const DefaultConfiguration: TConfiguration = {\n  server: DefaultServerConfiguration,\n  recognition: DefaultRecognitionConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  rendering: DefaultRenderingConfiguration,\n  triggers: DefaultTriggerConfiguration,\n  events: DefaultEventsConfiguration,\n  'undo-redo': DefaultUndoRedoConfiguration\n} as const\n","\nimport { TConfiguration, TConfigurationClient } from '../@types/Configuration'\nimport { TEventConfiguration } from '../@types/configuration/EventConfiguration'\nimport { TGrabberConfiguration } from '../@types/configuration/GrabberConfiguration'\nimport { TRecognitionConfiguration } from '../@types/configuration/RecognitionConfiguration'\nimport { TRenderingConfiguration } from '../@types/configuration/RenderingConfiguration'\nimport { TServerConfiguration } from '../@types/configuration/ServerConfiguration'\nimport { TTriggerConfiguration } from '../@types/configuration/TriggerConfiguration'\nimport { TUndoRedoConfiguration } from '../@types/configuration/UndoRedoConfiguration'\nimport { DefaultConfiguration } from './DefaultConfiguration'\n\nexport class Configuration implements TConfiguration\n{\n  events: TEventConfiguration\n  grabber: TGrabberConfiguration\n  recognition: TRecognitionConfiguration\n  rendering: TRenderingConfiguration\n  server: TServerConfiguration\n  triggers: TTriggerConfiguration\n  'undo-redo': TUndoRedoConfiguration\n\n  constructor(configuration?: TConfigurationClient)\n  {\n    this.events = JSON.parse(JSON.stringify(DefaultConfiguration.events))\n    this.grabber = JSON.parse(JSON.stringify(DefaultConfiguration.grabber))\n    this.recognition = JSON.parse(JSON.stringify(DefaultConfiguration.recognition))\n    this.rendering = JSON.parse(JSON.stringify(DefaultConfiguration.rendering))\n    this.server = JSON.parse(JSON.stringify(DefaultConfiguration.server))\n    this.triggers = JSON.parse(JSON.stringify(DefaultConfiguration.triggers))\n\n    this.overrideDefaultConfiguration(configuration)\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  mergeDeep(target: any, ...sources: any[]): any\n  {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const isObject = (item: any) =>\n    {\n      return (item && typeof item === 'object' && !Array.isArray(item))\n    }\n    if (!sources.length) return target\n    const source = sources.shift()\n\n    if (isObject(target) && isObject(source)) {\n      for (const key in source) {\n        if (isObject(source[key])) {\n          if (!target[key]) {\n            Object.assign(target, { [key]: {} })\n          }\n          this.mergeDeep(target[key], source[key])\n        } else {\n          Object.assign(target, { [key]: source[key] })\n        }\n      }\n    }\n\n    return this.mergeDeep(target, ...sources)\n  }\n\n  overrideDefaultConfiguration(configuration?: TConfigurationClient): void\n  {\n    this.events = this.mergeDeep({}, DefaultConfiguration.events, configuration?.events)\n    this.grabber = this.mergeDeep({}, DefaultConfiguration.grabber, configuration?.grabber)\n    this.recognition = this.mergeDeep({}, DefaultConfiguration.recognition, configuration?.recognition)\n    this.rendering = this.mergeDeep({}, DefaultConfiguration.rendering, configuration?.rendering)\n    this.server = this.mergeDeep({}, DefaultConfiguration.server, configuration?.server)\n    this.triggers = this.mergeDeep({}, DefaultConfiguration.triggers, configuration?.triggers)\n    this['undo-redo'] = this.mergeDeep({}, DefaultConfiguration['undo-redo'], configuration?.['undo-redo'])\n\n    this.recognition.text.mimeTypes = configuration?.recognition?.text?.mimeTypes || DefaultConfiguration.recognition.text.mimeTypes\n    this.recognition.math.mimeTypes = configuration?.recognition?.math?.mimeTypes || DefaultConfiguration.recognition.math.mimeTypes\n    this.recognition.diagram.mimeTypes = configuration?.recognition?.diagram?.mimeTypes || DefaultConfiguration.recognition.diagram.mimeTypes\n    this.recognition.rawContent.mimeTypes = configuration?.recognition?.rawContent?.mimeTypes || DefaultConfiguration.recognition.rawContent.mimeTypes\n\n    if (this.server?.useWindowLocation) {\n      this.server.scheme = window.location.protocol.indexOf('s') > -1 ? 'https' : 'http'\n      this.server.host = window.location.host\n    }\n\n    if (\n      this.server.protocol === 'REST' &&\n      this.triggers.exportContent === 'POINTER_UP'\n    ) {\n      this.triggers.exportContent = 'QUIET_PERIOD'\n      this.triggers.exportContentDelay = Math.max(this.triggers.exportContentDelay, 50)\n    }\n\n    if (\n      this.server.protocol === 'WEBSOCKET' &&\n      this.recognition.type === 'TEXT'\n    ) {\n      if (\n        this.rendering.smartGuide.enable &&\n        !this.recognition.text.mimeTypes.includes('application/vnd.myscript.jiix')\n      ) {\n        // mimeType required for smartGuide\n        this.recognition.text.mimeTypes.push('application/vnd.myscript.jiix')\n      }\n    } else {\n      // smartGuide enable only on websocket text\n      this.rendering.smartGuide.enable = false\n    }\n  }\n}\n","import { TPenStyle } from \"../@types/style/PenStyle\"\n\nexport const DefaultPenStyle: TPenStyle = {\n  color: '#000000',\n  width: 0,\n  '-myscript-pen-width': 1,\n  '-myscript-pen-fill-style': 'none',\n  '-myscript-pen-fill-color': '#FFFFFF00'\n}","import { TTheme } from \"../@types/style/Theme\"\n\nexport const DefaultTheme: TTheme = {\n  ink: {\n    color: '#000000',\n    width: 1,\n    '-myscript-pen-width': 1,\n    '-myscript-pen-fill-style': 'none',\n    '-myscript-pen-fill-color': '#FFFFFF00'\n  },\n  '.math': {\n    'font-family': 'STIXGeneral'\n  },\n  '.math-solved': {\n    'font-family': 'STIXGeneral',\n    color: '#A8A8A8FF'\n  },\n  '.text': {\n    'font-family': 'MyScriptInter',\n    'font-size': 10\n  }\n}\n","import { TPenStyle } from \"../@types/style/PenStyle\"\nimport { TTheme } from \"../@types/style/Theme\"\nimport { DefaultPenStyle } from \"./DefaultPenStyle\"\n\nimport { DefaultTheme } from \"./DefaultTheme\"\n\nexport class StyleManager\n{\n  private _penStyle!: TPenStyle\n  private _theme!: TTheme\n\n  get penStyle(): TPenStyle {\n    return this._penStyle\n  }\n  get theme(): TTheme {\n    return this._theme\n  }\n\n  constructor(penStyle?: TPenStyle, theme?: TTheme)\n  {\n    this.overrideDefaultPenStyle(penStyle)\n    this.overrideDefaultTheme(theme)\n  }\n\n  overrideDefaultPenStyle(penStyle?: TPenStyle): void\n  {\n    const currentPenStyle: TPenStyle = {\n      ...DefaultPenStyle,\n      ...(penStyle || {})\n    }\n    this._penStyle = currentPenStyle\n  }\n\n  overrideDefaultTheme(theme?: TTheme): void\n  {\n    const currentTheme: TTheme = {\n      ...DefaultTheme,\n      ...(theme || {})\n    }\n    this._theme = currentTheme\n  }\n}","import { TConfiguration, TConfigurationClient } from \"./@types/Configuration\"\nimport { TEditorOptions } from \"./@types/Editor\"\nimport { IGrabber } from \"./@types/grabber/Grabber\"\nimport { IModel } from \"./@types/model/Model\"\nimport { TPoint } from \"./@types/renderer/Point\"\nimport { TPenStyle } from \"./@types/style/PenStyle\"\nimport { TTheme } from \"./@types/style/Theme\"\n\nimport { EventType } from \"./Constants\"\nimport { BehaviorsManager } from \"./behaviors/BehaviorsManager\"\nimport { Configuration } from \"./configuration/Configuration\"\nimport { GlobalEvent } from \"./event/GlobalEvent\"\nimport { Model } from \"./model/Model\"\nimport { StyleManager } from \"./style/StyleManager\"\n\nimport './iink.css'\nimport { IBehaviors } from \"./@types/Behaviors\"\n\nexport enum EditorMode\n{\n  Mouse = 'mouse',\n  Pen = 'pen',\n  Touche = 'touch',\n  Eraser = 'eraser'\n}\n\nexport type HTMLEditorElement = HTMLElement &\n{\n  editor: Editor\n}\n\nexport class Editor\n{\n  private _wrapperHTML: HTMLEditorElement\n  private _loaderHTML: HTMLDivElement\n  private _errorHTML: HTMLDivElement\n  private _configuration: Configuration\n  private _behaviorsManager: BehaviorsManager\n  private _styleManager: StyleManager\n  private _mode: EditorMode\n  private _initialized = false\n  // private _exportTimer?: ReturnType<typeof setTimeout>\n\n  model: IModel\n  debug = false\n\n  constructor(wrapperHTML: HTMLElement, options?: TEditorOptions)\n  {\n    this._wrapperHTML = wrapperHTML as HTMLEditorElement\n    this._wrapperHTML.classList.add(options?.globalClassCss || 'ms-editor')\n\n    this._loaderHTML = document.createElement('div')\n    this._loaderHTML.classList.add('loader')\n    this._loaderHTML = this._wrapperHTML.appendChild(this._loaderHTML)\n    this._loaderHTML.style.display = 'initial'\n\n    this._errorHTML = document.createElement('div')\n    this._errorHTML.classList.add('error-msg')\n    this._errorHTML = this._wrapperHTML.appendChild(this._errorHTML)\n    this._errorHTML.style.display = 'none'\n\n    this._mode = EditorMode.Pen\n\n    this._styleManager = new StyleManager(options?.penStyle, options?.theme)\n\n    this._configuration = new Configuration(options?.configuration)\n\n    const width = Math.max(this._wrapperHTML.clientWidth, this.configuration.rendering.minWidth)\n    const height = Math.max(this._wrapperHTML.clientHeight, this.configuration.rendering.minHeight)\n    this.model = new Model(width, height)\n\n    this._behaviorsManager = new BehaviorsManager(this.configuration, this.model, options?.behaviors)\n    this.initalizeBehaviors()\n  }\n\n  get initialized(): boolean\n  {\n    return this._initialized\n  }\n\n  get configuration(): TConfiguration\n  {\n    return this._configuration\n  }\n  set configuration(config: TConfigurationClient)\n  {\n    this.clear()\n    // TODO maybe need some removeListener are close connection\n    this._configuration.overrideDefaultConfiguration(config)\n\n    this.model.height = Math.max(this._wrapperHTML.clientHeight, this._configuration.rendering.minHeight)\n    this.model.width = Math.max(this._wrapperHTML.clientWidth, this._configuration.rendering.minWidth)\n\n    this._behaviorsManager.overrideDefaultBehaviors(this._configuration, this.model)\n    this.initalizeBehaviors()\n  }\n  get behaviors(): IBehaviors\n  {\n    return this._behaviorsManager.behaviors\n  }\n  get grabber(): IGrabber\n  {\n    return this._behaviorsManager.behaviors.grabber\n  }\n  get theme(): TTheme\n  {\n    return this._styleManager.theme\n  }\n  get penStyle(): TPenStyle\n  {\n    return this._styleManager.penStyle\n  }\n  get mode(): EditorMode\n  {\n    return this._mode\n  }\n  get events(): GlobalEvent\n  {\n    return GlobalEvent.getInstance()\n  }\n\n  private initalizeBehaviors(): void\n  {\n    this._behaviorsManager.init(this._wrapperHTML, this.model)\n      .then(async () =>\n      {\n        this.grabber.onPointerDown = (evt: PointerEvent, point: TPoint) => this.pointerDown(evt, point)\n        this.grabber.onPointerMove = (evt: PointerEvent, point: TPoint) => this.pointerMove(evt, point)\n        this.grabber.onPointerUp = (evt: PointerEvent, point: TPoint) => this.pointerUp(evt, point)\n\n        this.events.addEventListener(EventType.ERROR, (evt: Event) => this.handleError(evt))\n        this.events.addEventListener(EventType.CLEAR, this.clear)\n        // this.events.addEventListener(EventType.IMPORT, this.import)\n\n        this._initialized = true\n        this._wrapperHTML.editor = this\n        this.events.emitLoaded()\n      })\n      .catch((e: Error) =>\n      {\n        this._initialized = false\n        this.showError(e)\n        this.events.emitError(e)\n      })\n      .finally(() =>\n      {\n        this._loaderHTML.style.display = 'none'\n      })\n  }\n\n  private showError(err: Error)\n  {\n    this._errorHTML.style.display = 'initial'\n    this._errorHTML.innerText = err.message\n    if (this.debug) {\n      const pName = document.createElement('p')\n      pName.innerHTML = err.name\n      this._errorHTML.prepend(pName)\n\n      const pStack = document.createElement('p')\n      pStack.style.width = '50vw'\n      pStack.style.marginLeft = 'calc(-25vw + 100px)'\n      pStack.innerHTML = err.stack || ''\n      this._errorHTML.appendChild(pStack)\n    }\n  }\n\n  private handleError(evt: Event)\n  {\n    // const error = (evt as unknown) as\n    // if (this._errorHTML.innerText === Constants.Error.TOO_OLD || evt.reason === 'CLOSE_RECOGNIZER') {\n    //   this._errorHTML.style.display = 'none'\n    // } else {\n      const customEvent = evt as CustomEvent\n      const err = customEvent?.detail as Error\n      this.showError(err)\n    // }\n  }\n\n  pointerDown(evt: PointerEvent, point: TPoint): void\n  {\n    const target: Element = (evt.target as Element)\n    const pointerDownOnEditor = target?.id === this._wrapperHTML.id || target?.classList?.contains('ms-canvas')\n    if (pointerDownOnEditor) {\n      let { pointerType } = evt\n      if (this._mode === EditorMode.Eraser) {\n        pointerType = EditorMode.Eraser\n      }\n      const style: TPenStyle = Object.assign({}, this.theme?.ink, this.penStyle)\n      this.model.initCurrentStroke(point, evt.pointerId, pointerType, style)\n      this.behaviors.drawCurrentStroke(this.model)\n    }\n  }\n\n  pointerMove(_evt: PointerEvent, point: TPoint): void\n  {\n    this.model.appendToCurrentStroke(point)\n    this.behaviors.drawCurrentStroke(this.model)\n  }\n\n  async pointerUp(_evt: PointerEvent, point: TPoint): Promise<void>\n  {\n    this.model.endCurrentStroke(point, this.penStyle)\n    this.behaviors.drawModel(this.model)\n    try {\n      if (this.behaviors.addStrokes) {\n        this.model = await this.behaviors.addStrokes(this.model)\n      } else {\n        this.model = await this.behaviors.export(this.model)\n      }\n    } catch (error) {\n      this.showError(error as Error)\n    }\n  }\n\n  setMode(mode: EditorMode): void\n  {\n    this._mode = mode\n    if (this._mode === EditorMode.Eraser) {\n      this._wrapperHTML.classList.add('erasing')\n    } else {\n      document.body.style.cursor = 'initial'\n      this._wrapperHTML.classList.remove('erasing')\n    }\n  }\n\n  async undo(): Promise<IModel>\n  {\n    this.model = await this.behaviors.undo()\n    return this.model\n  }\n\n  async redo(): Promise<IModel>\n  {\n    this.model = await this.behaviors.redo()\n    return this.model\n  }\n\n  async clear(): Promise<IModel>\n  {\n    this.model = await this.behaviors.clear(this.model)\n    return this.model\n  }\n\n  async resize(): Promise<IModel>\n  {\n    this.model.height = Math.max(this._wrapperHTML.clientHeight, this.configuration.rendering.minHeight)\n    this.model.width = Math.max(this._wrapperHTML.clientWidth, this.configuration.rendering.minWidth)\n    this.model = await this.behaviors.resize(this.model)\n    return this.model\n  }\n\n  async export(mimeTypes: string[]): Promise<IModel>\n  {\n    return this.behaviors.export(this.model, mimeTypes)\n  }\n\n  // import(evt: Event)\n  // {\n  //   if (this.behaviors.import) {\n  //     const customEvent = evt as CustomEvent\n  //     if (customEvent?.detail) {\n  //       const jiix: string = customEvent.detail.jiix\n  //       const mimeType: string = customEvent.detail.mimeType\n  //       this.behaviors.import(jiix, mimeType)\n  //     }\n  //   }\n  // }\n}\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { TConfigurationClient } from \"./@types/Configuration\"\n\n/**\n * Return the list of available recognition languages\n * @param {Configuration} [configuration] Configuration to get the languages\n * @return {JSON} A list of available languages\n */\n export async function getAvailableLanguageList(configuration?: TConfigurationClient): Promise<Array<Record<string, string>> | never>\n {\n   if (configuration?.server?.scheme && configuration?.server?.host) {\n     const serverConfig = configuration.server\n     const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/availableLanguageList`)\n     return response.json()\n   } else {\n     return Promise.reject('Cannot get languages ! Please check your server configuration!')\n   }\n }"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","adopt","then","apply","Error","ABNORMAL_CLOSURE","WRONG_CREDENTIALS","TOO_OLD","NO_ACTIVITY","UNKNOW","CANT_ESTABLISH","GOING_AWAY","PROTOCOL_ERROR","UNSUPPORTED_DATA","INVALID_FRAME_PAULOAD","POLICY_VIOLATION","MESSAGE_TOO_BIG","INTERNAL_ERROR","SERVICE_RESTART","TRY_AGAIN","BAD_GATEWAY","TLS_HANDSHAKE","EventType","IDLE","CHANGED","IMPORTED","EXPORTED","CONVERTED","RENDERED","LOADED","UNDO","REDO","CLEAR","CLEARED","IMPORT","SUPPORTED_IMPORT_MIMETYPES","EXPORT","CONVERT","ERROR","WSEventType","Constants","PointerEventGrabber","constructor","configuration","this","prevent","preventDefault","pointerDownHandler","evt","button","buttons","activePointerId","pointerId","onPointerDown","point","extractPoint","pointerMoveHandler","undefined","onPointerMove","pointerUpHandler","stopPropagation","onPointerUp","setConfiguration","roundFloat","oneFloat","requestedFloatPrecision","floatPrecision","Math","pow","round","event","clientX","clientY","changedTouches","rect","domElement","getBoundingClientRect","x","left","clientLeft","xyFloatPrecision","y","top","clientTop","t","Date","now","timestampFloatPrecision","p","pressure","attach","detach","addEventListener","listenerOptions","document","documentElement","removeEventListener","ShapeSymbols","table","shape","recognizedShape","ellipse","line","phi","angle","returnedAngle","PI","drawArrowHead","context2D","headPoint","length","alpha","beta","save","fillStyle","strokeStyle","moveTo","beginPath","lineTo","cos","sin","fill","restore","drawShapeEllipse","shapeEllipse","points","drawEllipseArc","centerPoint","maxRadius","minRadius","orientation","startAngle","sweepAngle","z1","z3","z2","z4","n","floor","abs","boundariesPoints","i","atan2","cosAlpha","sinAlpha","push","stroke","beginDecoration","beginTangentAngle","endDecoration","endTangentAngle","drawLine","p1","p2","drawShapeSymbol","symbol","lineWidth","width","color","elementType","shapeSymbol","candidates","selectedCandidateIndex","lines","forEach","lineSymbol","data","type","drawShapeLine","shapeLine","firstPoint","lastPoint","primitives","primitive","TextSymbols","inputCharacter","char","string","textLine","drawTextLine","drawText","label","font","textHeight","textAlign","justificationType","textBaseline","fillText","topLeftPoint","height","underlineList","underline","drawUnderline","delta","firstCharacter","lastCharacter","CanvasRenderer","config","createCanvas","element","canvas","createElement","id","classList","add","appendChild","resizeContent","pixelRatio","window","devicePixelRatio","context","renderingCanvas","capturingCanvas","parentNode","max","_a","minWidth","clientWidth","_b","minHeight","clientHeight","_c","getContext","scale","style","drawSymbol","stroker","drawStroke","pointerType","Object","keys","includes","drawTextSymbol","init","renderingCanvasContext","capturingCanvasContext","drawModel","model","clearRect","symbols","defaultSymbols","recognizedSymbols","extractPendingStrokes","rawStrokes","updatePositionRendered","drawCurrentStroke","currentStroke","resize","destroy","removeChild","computeLinksPoints","radius","computeMiddlePoint","point1","point2","computeAxeAngle","begin","end","QuadraticCanvasStroker","renderArc","context2d","center","arc","renderLine","linkPoints1","linkPoints2","renderFinal","linkPoints","newAngle","renderQuadratic","ctrl","linkPoints3","quadraticCurveTo","getPointByIndex","index","nbquadratics","secondPoint","beginLine","endLine","beginFinal","endFinal","closePath","module","o","exports","r","l","call","m","c","d","defineProperty","configurable","enumerable","get","__esModule","default","prototype","hasOwnProperty","s","TypeError","Symbol","iterator","toJSON","console","error","u","split","trim","indexOf","substring","replace","_trimSemiColon","toCSS","slice","parser","JsonCSS","StyleHelper","themeToCSS","json","css","themeToJSON","theme","Number","ink","penStyleToCSS","penStyle","penStyleToJSON","penStyleString","CryptoJS","create","F","obj","subtype","C","C_lib","lib","Base","extend","overrides","mixIn","$super","arguments","instance","properties","propertyName","toString","clone","WordArray","words","sigBytes","encoder","Hex","stringify","concat","wordArray","thisWords","thatWords","thisSigBytes","thatSigBytes","clamp","thatByte","ceil","random","nBytes","rcache","m_w","m_z","mask","_r","C_enc","enc","hexChars","bite","join","parse","hexStr","hexStrLength","parseInt","substr","Latin1","latin1Chars","String","fromCharCode","latin1Str","latin1StrLength","charCodeAt","Utf8","decodeURIComponent","escape","utf8Str","unescape","encodeURIComponent","BufferedBlockAlgorithm","reset","_data","_nDataBytes","_append","_process","doFlush","dataWords","dataSigBytes","blockSize","nBlocksReady","nWordsReady","_minBufferSize","nBytesReady","min","offset","_doProcessBlock","processedWords","splice","Hasher","cfg","_doReset","update","messageUpdate","finalize","_doFinalize","_createHelper","hasher","message","_createHmacHelper","key","C_algo","HMAC","algo","require$$0","X32WordArray","C_x64","x64","Word","high","low","toX32","x64Words","x64WordsLength","x32Words","x64Word","wordsLength","X64Word","X64WordArray","X64Word_create","K","W","SHA512","_hash","M","H","H0","H1","H2","H3","H4","H5","H6","H7","H0h","H0l","H1h","H1l","H2h","H2l","H3h","H3l","H4h","H4l","H5h","H5l","H6h","H6l","H7h","H7l","ah","al","bh","bl","ch","cl","dh","dl","eh","el","fh","fl","gh","gl","hh","hl","Wi","Wih","Wil","gamma0x","gamma0xh","gamma0xl","gamma0h","gamma0l","gamma1x","gamma1xh","gamma1xl","gamma1h","gamma1l","Wi7","Wi7h","Wi7l","Wi16","Wi16h","Wi16l","t1l","chh","chl","majh","majl","sigma0h","sigma0l","sigma1h","sigma1l","Ki","Kih","Kil","t1h","t2l","nBitsTotal","nBitsLeft","HmacSHA512","_hasher","hasherBlockSize","hasherBlockSizeBytes","oKey","_oKey","iKey","_iKey","oKeyWords","iKeyWords","innerHash","computeHmac","applicationKey","hmacKey","GlobalEvent","EventTarget","super","static","emit","dispatchEvent","CustomEvent","assign","bubbles","composed","detail","emitLoaded","emitExported","emitChange","undoRedoContext","canUndo","canRedo","canClear","stack","stackIndex","isEmpty","stackLength","emitIdle","emitError","err","emitClear","emitCleared","emitConvert","emitImport","jiix","mimeType","AbstractRecognizer","serverConfig","recognitionConfig","serverConfiguration","recognitionConfiguration","globalEvent","getInstance","_height","_width","RestRecognizer","url","scheme","host","postConfig","lang","diagram","export","math","rawContent","text","buildData","newStrokes","strokeGroups","group","newGroup","JSON","strokes","map","contentType","charAt","toUpperCase","toLowerCase","xDPI","yDPI","post","headers","Headers","append","reqInit","method","body","request","Request","response","fetch","ok","blob","catch","callPostMessage","res","code","name","requestedMimeTypes","myModel","getClone","updatePositionSent","mimeTypes","mimeTypesRequiringExport","filter","all","updatePositionReceived","DeferredPromise","isFullFilled","isPending","promise","v","UndoRedoContext","UndoRedoManager","events","updateCanUndoRedo","addModelToStack","maxStackSize","shift","updateModelInStack","findIndex","modificationDate","undo","redo","RestBehaviors","grabber","renderer","rendering","recognizer","server","recognition","undoRedoManager","_triggerConfiguration","triggers","initalise","globalEvents","_export","newModel","deferred","exportContent","clearTimeout","_exportTimer","currentModel","setTimeout","exportContentDelay","deferredResize","_resizeTimer","resizeModel","resizeTriggerDelay","oldModel","modelUpdated","clear","getTime","log","WSEvent","abortController","AbortController","emitInitialized","emitConnected","emitConnectionActive","addConnectionActiveListener","callback","signal","emitDisconnected","addDisconnectedListener","emitPartChange","partChange","addPartChangeListener","emitContentChange","contentChange","addContentChangeListener","emitPatch","patchChange","addPatchListener","addExportListener","clearListeners","abort","WSRecognizer","pingCount","reconnectionCount","wsEvent","toLocaleLowerCase","infinitePing","websocket","maxPingLostCount","close","socket","readyState","send","pingDelay","openCallback","params","sessionId","iinkSessionId","xDpi","yDpi","viewSizeHeight","viewSizeWidth","closeCallback","currentErrorCode","ErrorConst","errorCallback","manageHMACChallengeMessage","websocketMessage","hmacChallengeMessage","hmacChallenge","hmac","manageContentPackageDescriptionMessage","currentPartId","managePartChangeMessage","partChangeMessage","partId","manageContentChangeMessage","contentChangeMessage","manageExportMessage","exportMessage","managePatchMessage","patchMessage","manageErrorMessage","messageCallback","WebSocket","pingEnabled","onopen","onclose","ev","onerror","onmessage","canReconnect","autoReconnect","maxRetryCount","shouldAttemptReconnect","addStrokes","OPEN","reason","CONNECTING","Stroke","Model","creationDate","positions","lastSentPosition","lastReceivedPosition","lastRenderedPosition","rawResults","convert","creationTime","idle","computeDistance","distance","sqrt","isNaN","computeLength","lastDistance","computePressure","ratio","filterPointByAcquisitionDelta","addPoint","addStroke","position","addStrokeToGroup","strokePenStyle","lastGroup","ps1","ps2","newStrokeGroup","initCurrentStroke","dpi","pxWidth","appendToCurrentStroke","endCurrentStroke","resetPositionRenderer","resetPositions","clonedModel","WSBehaviors","onConnectionActive","onPartChange","onContentChange","addStrokeDeffered","onPatch","onExport","exportDeffered","onDisconnected","BehaviorsManager","behaviors","overrideDefaultBehaviors","defaultBehaviors","protocol","DefaultConfiguration","useWindowLocation","fileChunkSize","alwaysConnected","gesture","enable","chars","debug","solver","margin","bottom","right","eraser","mode","guides","capture","passive","smartGuide","fadeOut","duration","processDelay","Configuration","overrideDefaultConfiguration","mergeDeep","target","sources","isObject","item","Array","isArray","source","_d","_f","_e","_h","_g","_j","location","DefaultPenStyle","DefaultTheme","StyleManager","overrideDefaultPenStyle","overrideDefaultTheme","_penStyle","_theme","currentPenStyle","currentTheme","EditorMode","styleInject","ref","insertAt","head","getElementsByTagName","firstChild","insertBefore","styleSheet","cssText","createTextNode","Editor","wrapperHTML","options","_initialized","_wrapperHTML","globalClassCss","_loaderHTML","display","_errorHTML","_mode","Pen","_styleManager","_configuration","_behaviorsManager","initalizeBehaviors","initialized","pointerDown","pointerMove","pointerUp","handleError","editor","showError","finally","innerText","pName","innerHTML","prepend","pStack","marginLeft","customEvent","contains","Eraser","_evt","setMode","cursor","remove","getAvailableLanguageList"],"mappings":"QAqEO,SAASA,UAAUC,EAASC,EAAYC,EAAGC,GAE9C,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,UAAUC,GAAS,IAAMC,KAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,GAAO,CAC3F,SAASC,SAASJ,GAAS,IAAMC,KAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,GAAO,CAC9F,SAASF,KAAKI,GAAUA,EAAOC,KAAOT,EAAQQ,EAAOL,OAJzD,SAASO,MAAMP,GAAS,OAAOA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,EAAO,GAAM,CAI1CO,CAAMF,EAAOL,OAAOQ,KAAKT,UAAWK,SAAY,CAC9GH,MAAMN,EAAYA,EAAUc,MAAMjB,EAASC,GAAc,KAAKS,OACtE,GACA,wQC7EO,MAAMQ,EAAQ,CACnBC,iBAAkB,sFAClBC,kBAAmB,oGACnBC,QAAS,oDACTC,YAAa,qCACbC,OAAQ,iCACRC,eAAgB,yGAChBC,WAAY,oKACZC,eAAgB,iFAChBC,iBAAkB,iLAClBC,sBAAuB,sKACvBC,iBAAkB,gHAClBC,gBAAiB,6GACjBC,eAAgB,sJAChBC,gBAAiB,kFACjBC,UAAW,oJACXC,YAAa,0HACbC,cAAe,iGAGJC,EAAY,CACvBC,KAAM,OACNC,QAAS,UACTC,SAAU,WACVC,SAAU,WACVC,UAAW,YACXC,SAAU,WACVC,OAAQ,SACRC,KAAM,OACNC,KAAM,OACNC,MAAO,QACPC,QAAS,UACTC,OAAQ,SACRC,2BAA4B,2BAC5BC,OAAQ,SACRC,QAAS,UACTC,MAAO,SAGIC,EACE,cADFA,EAEK,iBAFLA,EAGJ,QAHIA,EAID,cAJCA,EAKE,cALFA,EAMA,YANAA,EAOQ,oBAPRA,EAQG,eAOhB,IAAeC,EACbpC,QCnDWqC,oBAcXC,YAAYC,GANJC,KAAOC,QAAIhD,GAAaA,EAAEiD,iBAsC1BF,KAAAG,mBAAsBC,IAG5B,GAAmB,IAAfA,EAAIC,QAAgC,IAAhBD,EAAIE,UAI5BN,KAAKO,gBAAkBH,EAAII,UAEvBR,KAAKS,eAAe,CACtB,MAAMC,EAAQV,KAAKW,aAAaP,GAChCJ,KAAKS,cAAcL,EAAKM,EACzB,GAGKV,KAAAY,mBAAsBR,IAE5B,GAA4BS,MAAxBb,KAAKO,iBAAgCP,KAAKO,kBAAoBH,EAAII,WAChER,KAAKc,cAAe,CACtB,MAAMJ,EAAQV,KAAKW,aAAaP,GAChCJ,KAAKc,cAAcV,EAAKM,EACzB,CACF,EAGKV,KAAAe,iBAAoBX,IAE1B,GAA4BS,MAAxBb,KAAKO,iBAAgCP,KAAKO,kBAAoBH,EAAII,YACpER,KAAKO,qBAAkBM,EACvBT,EAAIY,kBACAhB,KAAKiB,aAAa,CACpB,MAAMP,EAAQV,KAAKW,aAAaP,GAChCJ,KAAKiB,YAAYb,EAAKM,EACvB,CACF,EAhEDV,KAAKkB,iBAAiBnB,EACvB,CAEOoB,WAAWC,EAAkBC,GAEnC,GAAIA,GAA2B,EAAG,CAChC,MAAMC,EAAyBC,KAAKC,IAAI,GAAIH,GAC5C,OAAOE,KAAKE,MAAML,EAAWE,GAAkBA,CAChD,CACD,OAAOF,CACR,CAEOT,aAAae,GAEnB,IAAIC,EAAiBC,IAEhBD,UAASC,WADV,mBAAoBF,EACEA,EAAMG,eAAe,GAErBH,GAE1B,MAAMI,EAAgB9B,KAAK+B,WAAWC,wBACtC,MAAO,CACLC,EAAGjC,KAAKmB,WAAWQ,EAAUG,EAAKI,KAAOlC,KAAK+B,WAAWI,WAAYnC,KAAKD,cAAcqC,kBACxFC,EAAGrC,KAAKmB,WAAWS,EAAUE,EAAKQ,IAAMtC,KAAK+B,WAAWQ,UAAWvC,KAAKD,cAAcqC,kBACtFI,EAAGxC,KAAKmB,WAAWsB,KAAKC,MAAO1C,KAAKD,cAAc4C,yBAClDC,EAAIlB,EAAuBmB,UAAY,EAG1C,CAuCD3B,iBAAiBnB,GAEfC,KAAKD,cAAgBA,CACtB,CAED+C,OAAOf,GAED/B,KAAK+B,YACP/B,KAAK+C,SAEP/C,KAAK+B,WAAaA,EAClB/B,KAAK+B,WAAWiB,iBAAiB,cAAehD,KAAKG,mBAAoBH,KAAKD,cAAckD,iBAE5FjD,KAAK+B,WAAWiB,iBAAiB,cAAehD,KAAKY,mBAAoBZ,KAAKD,cAAckD,iBAE5FjD,KAAK+B,WAAWiB,iBAAiB,YAAahD,KAAKe,iBAAkBf,KAAKD,cAAckD,iBACxFjD,KAAK+B,WAAWiB,iBAAiB,aAAchD,KAAKe,iBAAkBf,KAAKD,cAAckD,iBACzFjD,KAAK+B,WAAWiB,iBAAiB,eAAgBhD,KAAKe,iBAAkBf,KAAKD,cAAckD,iBAC3FjD,KAAK+B,WAAWiB,iBAAiB,gBAAiBhD,KAAKe,iBAAkBf,KAAKD,cAAckD,iBAE5FjD,KAAK+B,WAAWiB,iBAAiB,YAAahD,KAAKC,SAInDiD,SAASC,gBAAgBH,iBAAiB,eAAe,QAC1D,CAEDD,SAEE/C,KAAK+B,WAAWqB,oBAAoB,cAAepD,KAAKG,mBAAoBH,KAAKD,cAAckD,iBAE/FjD,KAAK+B,WAAWqB,oBAAoB,cAAepD,KAAKY,mBAAoBZ,KAAKD,cAAckD,iBAE/FjD,KAAK+B,WAAWqB,oBAAoB,YAAapD,KAAKe,iBAAkBf,KAAKD,cAAckD,iBAC3FjD,KAAK+B,WAAWqB,oBAAoB,aAAcpD,KAAKe,iBAAkBf,KAAKD,cAAckD,iBAC5FjD,KAAK+B,WAAWqB,oBAAoB,eAAgBpD,KAAKe,iBAAkBf,KAAKD,cAAckD,iBAC9FjD,KAAK+B,WAAWqB,oBAAoB,gBAAiBpD,KAAKe,iBAAkBf,KAAKD,cAAckD,iBAE/FjD,KAAK+B,WAAWqB,oBAAoB,YAAapD,KAAKC,SAEtDiD,SAASC,gBAAgBC,oBAAoB,eAAe,QAC7D,EC5HI,MAAMC,EAAe,CAC1BC,MAAO,QACPC,MAAO,QACPC,gBAAiB,kBACjBC,QAAS,UACTC,KAAM,QAGR,SAASC,IAAIC,GAEX,IAAIC,GAAkBD,EAAQrC,KAAKuC,KAAiB,EAAVvC,KAAKuC,IAAWvC,KAAKuC,GAI/D,OAHID,GAAiBtC,KAAKuC,KACxBD,GAA2B,EAAVtC,KAAKuC,IAEjBD,CACT,CAqDA,SAASE,cAAcC,EAAqCC,EAA4BL,EAAeM,GAErG,MAAMC,EAAQR,IAAIC,EAASrC,KAAKuC,IAAM,EAAI,IACpCM,EAAOT,IAAIC,EAASrC,KAAKuC,IAAM,EAAI,IACzCE,EAAUK,OACV,IACEL,EAAUM,UAAYN,EAAUO,YAEhCP,EAAUQ,OAAOP,EAAUhC,EAAGgC,EAAU5B,GACxC2B,EAAUS,YACVT,EAAUU,OAAOT,EAAUhC,EAAKiC,EAAS3C,KAAKoD,IAAIR,GAASF,EAAU5B,EAAK6B,EAAS3C,KAAKqD,IAAIT,IAC5FH,EAAUU,OAAOT,EAAUhC,EAAKiC,EAAS3C,KAAKoD,IAAIP,GAAQH,EAAU5B,EAAK6B,EAAS3C,KAAKqD,IAAIR,IAC3FJ,EAAUU,OAAOT,EAAUhC,EAAGgC,EAAU5B,GACxC2B,EAAUa,MAGX,CAFS,QACRb,EAAUc,SACX,CACH,CAEA,SAASC,iBAAiBf,EAAqCgB,GAE7D,MAAMC,EAxER,SAASC,eAAelB,EAAqCgB,GAE3D,MAAMG,YAAEA,EAAWC,UAAEA,EAASC,UAAEA,EAASC,YAAEA,EAAWC,WAAEA,EAAUC,WAAEA,GAAeR,EAGnF,IAAIS,EAAKlE,KAAKoD,IAAIW,GACdI,EAAKnE,KAAKqD,IAAIU,GACdK,EAAKF,EACLG,EAAKF,EACTD,GAAML,EACNO,GAAMN,EACNK,GAAMN,EACNQ,GAAMP,EAEN,MAAMQ,EAAItE,KAAKuE,MAAMvE,KAAKwE,IAAIP,GAXZ,KAaZQ,EAAmB,GAEzBhC,EAAUK,OACV,IACEL,EAAUS,YAEV,IAAK,IAAIwB,EAAI,EAAGA,GAAKJ,EAAGI,IAAK,CAC3B,MAAMrC,EAAQ2B,EAAeU,EAAIJ,EAAKL,EAChCrB,EAAQ5C,KAAK2E,MAAM3E,KAAKqD,IAAIhB,GAASyB,EAAW9D,KAAKoD,IAAIf,GAASwB,GAElEe,EAAW5E,KAAKoD,IAAIR,GACpBiC,EAAW7E,KAAKqD,IAAIT,GAGpBlC,EAAKkD,EAAYlD,EAAKwD,EAAKU,EAAcP,EAAKQ,EAC9C/D,EAAK8C,EAAY9C,EAAKsD,EAAKS,EAAcV,EAAKS,EAC1C,IAANF,EACFjC,EAAUQ,OAAOvC,EAAGI,GAEpB2B,EAAUU,OAAOzC,EAAGI,GAGZ,IAAN4D,GAAWA,IAAMJ,GACnBG,EAAiBK,KAAK,CAAEpE,IAAGI,KAE9B,CAED2B,EAAUsC,QAGX,CAFS,QACRtC,EAAUc,SACX,CAED,OAAOkB,CACT,CAuBiBd,CAAelB,EAAWgB,GAEH,gBAAlCA,aAAY,EAAZA,EAAcuB,kBAChBxC,cAAcC,EAAWiB,EAAO,GAAID,EAAawB,kBAAmB,IAElC,gBAAhCxB,aAAY,EAAZA,EAAcyB,gBAChB1C,cAAcC,EAAWiB,EAAO,GAAID,EAAa0B,gBAAiB,GAEtE,UAQgBC,SAAS3C,EAAqC4C,EAAqBC,GAEjF7C,EAAUK,OACV,IACEL,EAAUS,YACVT,EAAUQ,OAAOoC,EAAG3E,EAAG2E,EAAGvE,GAC1B2B,EAAUU,OAAOmC,EAAG5E,EAAG4E,EAAGxE,GAC1B2B,EAAUsC,QAGX,CAFS,QACRtC,EAAUc,SACX,CACH,CAkBgB,SAAAgC,gBAAgB9C,EAAqC+C,GAEnE/C,EAAUK,OACV,IAIE,GAHAL,EAAUgD,UAAYD,EAAOE,MAC7BjD,EAAUO,YAAcwC,EAAOG,MAE3BH,EAAOI,YACT,OAAQJ,EAAOI,aACb,KAAK9D,EAAaE,MAEhB,MAAM6D,EAAcL,EACpBD,gBAAgB9C,EAAWoD,EAAYC,WAAWD,EAAYE,yBAC9D,MACF,KAAKjE,EAAaC,MAEKyD,EACRQ,MAAMC,SAAQ9D,GAAQoD,gBAAgB9C,EAAWN,KAC9D,MACF,KAAKL,EAAaK,KAEhB,MAAM+D,EAAaV,EACnBJ,SAAS3C,EAAWyD,EAAWC,KAAKd,GAAIa,EAAWC,KAAKb,SAO5D,OAAQE,EAAOY,MACb,KAAKtE,EAAaI,QAChBsB,iBAAiBf,EAAW+C,GAC5B,MACF,KAAK1D,EAAaK,MAjD1B,SAASkE,cAAc5D,EAAqC6D,GAE1DlB,SAAS3C,EAAW6D,EAAUC,WAAYD,EAAUE,WAClB,eAA9BF,EAAUtB,iBACZxC,cAAcC,EAAW6D,EAAUC,WAAYD,EAAUrB,kBAAmB,IAE9C,eAA5BqB,EAAUpB,eACZ1C,cAAcC,EAAW6D,EAAUE,UAAWF,EAAUnB,gBAAiB,GAE7E,CAyCUkB,CAAc5D,EAAW+C,GACzB,MACF,KAAK1D,EAAaG,gBAEUuD,EACRiB,WAAWR,SAAQS,GAAanB,gBAAgB9C,EAAWiE,KASpF,CAFS,QACRjE,EAAUc,SACX,CACH,CCvLO,MAAMoD,EAAc,CACzBC,eAAgB,iBAChBC,KAAM,OACNC,OAAQ,SACRC,SAAU,YA+BZ,SAASC,aAAavE,EAAqCsE,IAd3D,SAASE,SAASxE,EAAqCyE,EAAef,GAEpE1D,EAAUK,OACV,IACEL,EAAU0E,KAAO,GAAIhB,EAAKiB,qBAC1B3E,EAAU4E,UAAwC,WAA3BlB,EAAKmB,kBAAkC,SAAW,OACzE7E,EAAU8E,aAAe,SACzB9E,EAAUM,UAAYN,EAAUO,YAChCP,EAAU+E,SAASN,EAAOf,EAAKsB,aAAa/G,EAAIyF,EAAKsB,aAAa3G,EAAIqF,EAAKuB,OAG5E,CAFS,QACRjF,EAAUc,SACX,CACH,CAIE0D,CAASxE,EAAWsE,EAASG,MAAOH,EAASZ,MAC7CY,EAASY,cAAc1B,SAAS2B,KA/BlC,SAASC,cAAcpF,EAAqCmF,EAA6BV,EAAef,GAEtG,MAAM2B,EAAQ3B,EAAKT,MAAQwB,EAAMvE,OASjCyC,SAAS3C,EARmB,CAC1B/B,EAAGyF,EAAKsB,aAAa/G,EAAKkH,EAAUzB,KAAK4B,eAAiBD,EAC1DhH,EAAGqF,EAAKsB,aAAa3G,EAAIqF,EAAKuB,QAEJ,CAC1BhH,EAAGyF,EAAKsB,aAAa/G,EAAKkH,EAAUzB,KAAK6B,cAAgBF,EACzDhH,EAAGqF,EAAKsB,aAAa3G,EAAIqF,EAAKuB,QAGlC,CAqBIG,CAAcpF,EAAWmF,EAAWb,EAASG,MAAOH,EAASZ,KAAK,GAEtE,OCpCa8B,eAKX1J,YAAY2J,GACVzJ,KAAKyJ,OAASA,CACf,CAEOC,aAAaC,EAAsBhC,GAEzC,MAAMiC,EAA4B1G,SAAS2G,cAAc,UAKzD,OAJAD,EAAOE,GAAKnC,EACZiC,EAAOG,UAAUC,IAAIrC,GACrBiC,EAAOG,UAAUC,IAAI,aACrBL,EAAQM,YAAYL,GACbA,CACR,CAEOM,gBAEN,MAAMC,EAAqBC,OAAOC,iBACI,CAACrK,KAAKsK,QAAQC,gBAAiBvK,KAAKsK,QAAQE,iBACzEhD,SAASoC,cAEhB,MAAM7H,EAAa6H,EAAOa,WACpBxD,EAAQ1F,KAAKmJ,YAAIC,EAAA3K,KAAKsK,8BAASM,SAAU7I,EAAW8I,aACpD5B,EAAS1H,KAAKmJ,YAAII,EAAA9K,KAAKsK,8BAASS,UAAWhJ,EAAWiJ,cAC5DpB,EAAO3C,MAAQA,EAAQkD,EACvBP,EAAOX,OAASA,EAASkB,EACA,QAAzBc,EAAArB,EAAOsB,WAAW,aAAO,IAAAD,GAAAA,EAAAE,MAAMhB,EAAYA,GAC3CP,EAAOwB,MAAMnE,MAAQ,GAAIA,MACzB2C,EAAOwB,MAAMnC,OAAS,GAAIA,KAAW,GAExC,CAEOoC,WAAWrH,EAAqC+C,EAAiBuE,GAEvE,MAAM3D,EAAOZ,EAAOI,aAAeJ,EAAOY,KAC7B,WAATA,WC/CQ4D,WAAYvH,EAAqCsC,EAAiBgF,GAC5EA,GAAWhF,GAAiC,WAAvBA,EAAOkF,aAC9BF,EAAQC,WAAWvH,EAAWsC,EAElC,CD4CMiF,CAAWvH,EAAW+C,EAAmBuE,GAChCG,OAAOC,KAAKxD,GAAayD,SAAShE,GDEjC,SAAAiE,eAAe5H,EAAqC+C,GAElE/C,EAAUK,OACV,IACEL,EAAUgD,UAAYD,EAAOE,MAC7BjD,EAAUO,YAAcwC,EAAOG,OACVH,EAAOI,aAAeJ,EAAOY,QAG3CO,EAAYI,UACfC,aAAavE,EAAW+C,EAS7B,CAFS,QACR/C,EAAUc,SACX,CACH,CCrBM8G,CAAe5H,EAAW+C,GACjB0E,OAAOC,KAAKrI,GAAcsI,SAAShE,IAC5Cb,gBAAgB9C,EAAW+C,EAE9B,CAED8E,KAAKlC,GAEH,MAAMY,EAAqCvK,KAAK0J,aAAaC,EAAS,uBAChEa,EAAqCxK,KAAK0J,aAAaC,EAAS,qBAEtE3J,KAAKsK,QAAU,CACbS,UAAW/K,KAAKyJ,OAAOsB,WAAa,EACpCH,SAAU5K,KAAKyJ,OAAOmB,UAAY,EAClCL,kBACAuB,uBAAwBvB,EAAgBW,WAAW,MACnDV,kBACAuB,uBAAwBvB,EAAgBU,WAAW,OAGrDlL,KAAKkK,eACN,CAED8B,UAAUC,EAAeX,SAEY,QAAnCX,EAAA3K,KAAKsK,QAAQwB,8BAAsB,IAAAnB,GAAAA,EAAEuB,UAAU,EAAG,EAAGlM,KAAKsK,QAAQC,gBAAgBtD,MAAOjH,KAAKsK,QAAQC,gBAAgBtB,QACtH,MAAMkD,EAAU,IAAIF,EAAMG,gBACtBH,EAAMI,mBACRF,EAAQ9F,QAAQ4F,EAAMI,mBACtBF,EAAQ9F,QAAQ4F,EAAMK,0BAEtBH,EAAQ9F,QAAQ4F,EAAMM,YAExBJ,EAAQ3E,SAAQT,GAAU/G,KAAKqL,WAAWrL,KAAKsK,QAAQwB,uBAAwB/E,EAAQuE,KACvFtL,KAAKsK,QAAQyB,uBAAuBG,UAAU,EAAG,EAAGlM,KAAKsK,QAAQE,gBAAgBvD,MAAOjH,KAAKsK,QAAQE,gBAAgBvB,QACrHgD,EAAMO,uBAAuBL,EAAQjI,OACtC,CAEDuI,kBAAkBR,EAAeX,GAG/B,MAAMhF,EAA8B2F,EAAMS,cAC1C1M,KAAKsK,QAAQyB,uBAAuBG,UAAU,EAAG,EAAGlM,KAAKsK,QAAQE,gBAAgBvD,MAAOjH,KAAKsK,QAAQE,gBAAgBvB,QACjHqC,GAAWhF,GAAkC,YAAxBA,aAAM,EAANA,EAAQkF,cAC/BF,EAAQC,WAAWvL,KAAKsK,QAAQyB,uBAAwBzF,EAE3D,CAEDqG,OAAOV,EAAeX,GAEpBtL,KAAKkK,gBACLlK,KAAKgM,UAAUC,EAAOX,EACvB,CAEDsB,QAAQjD,GAENA,EAAQkD,YAAY7M,KAAKsK,QAAQC,iBACjCZ,EAAQkD,YAAY7M,KAAKsK,QAAQE,gBAElC,WE7GasC,mBAAmBpM,EAAekD,EAAeqD,GAE/D,MAAM8F,EAASrM,EAAMkC,EAAIqE,EACzB,MAAO,CACL,CACEhF,EAAIvB,EAAMuB,EAAKV,KAAKqD,IAAIhB,GAASmJ,EACjC1K,EAAI3B,EAAM2B,EAAKd,KAAKoD,IAAIf,GAASmJ,GAEnC,CACE9K,EAAIvB,EAAMuB,EAAKV,KAAKqD,IAAIhB,GAASmJ,EACjC1K,EAAI3B,EAAM2B,EAAKd,KAAKoD,IAAIf,GAASmJ,GAGvC,CAEgB,SAAAC,mBAAmBC,EAAgBC,GAEjD,MAAO,CACLjL,GAAKiL,EAAOjL,EAAIgL,EAAOhL,GAAK,EAC5BI,GAAK6K,EAAO7K,EAAI4K,EAAO5K,GAAK,EAC5BO,GAAKsK,EAAOtK,EAAIqK,EAAOrK,GAAK,EAC5BJ,GAAK0K,EAAO1K,EAAIyK,EAAOzK,GAAK,EAEhC,CAEgB,SAAA2K,gBAAgBC,EAAeC,GAE7C,OAAO9L,KAAK2E,MAAMmH,EAAIhL,EAAI+K,EAAM/K,EAAGgL,EAAIpL,EAAImL,EAAMnL,EACnD,OC1BaqL,uBAGHC,UAAUC,EAAqCC,EAAgBV,GAErES,EAAUE,IAAID,EAAOxL,EAAGwL,EAAOpL,EAAG0K,EAAQ,EAAa,EAAVxL,KAAKuC,IAAQ,EAC3D,CAEO6J,WAAWH,EAAqCJ,EAAeC,EAAapG,GAElF,MAAM2G,EAAcd,mBAAmBM,EAAOD,gBAAgBC,EAAOC,GAAMpG,GACrE4G,EAAcf,mBAAmBO,EAAKF,gBAAgBC,EAAOC,GAAMpG,GAEzEuG,EAAUhJ,OAAOoJ,EAAY,GAAG3L,EAAG2L,EAAY,GAAGvL,GAClDmL,EAAU9I,OAAOmJ,EAAY,GAAG5L,EAAG4L,EAAY,GAAGxL,GAClDmL,EAAU9I,OAAOmJ,EAAY,GAAG5L,EAAG4L,EAAY,GAAGxL,GAClDmL,EAAU9I,OAAOkJ,EAAY,GAAG3L,EAAG2L,EAAY,GAAGvL,EACnD,CAEOyL,YAAYN,EAAqCJ,EAAeC,EAAapG,GAEnF,MACMrD,EAAQuJ,gBAAgBC,EAAOC,GAC/BU,EAAajB,mBAAmBO,EAAKzJ,EAAOqD,GAClDuG,EAAUhJ,OAAOuJ,EAAW,GAAG9L,EAAG8L,EAAW,GAAG1L,GAChD,IAAK,IAAI4D,EAAI,EAAGA,GAJC,EAIcA,IAAK,CAClC,MAAM+H,EAAWpK,EAAUqC,EAAI1E,KAAKuC,GALrB,EAMf0J,EAAU9I,OAAO2I,EAAIpL,EAAMoL,EAAIzK,EAAIqE,EAAS1F,KAAKqD,IAAIoJ,GAAYX,EAAIhL,EAAKgL,EAAIzK,EAAIqE,EAAQ1F,KAAKoD,IAAIqJ,GACpG,CACF,CAEOC,gBAAgBT,EAAqCJ,EAAeC,EAAaa,EAAcjH,GAErG,MAAM2G,EAAcd,mBAAmBM,EAAOD,gBAAgBC,EAAOc,GAAOjH,GACtE4G,EAAcf,mBAAmBO,EAAKF,gBAAgBe,EAAMb,GAAMpG,GAClEkH,EAAcrB,mBAAmBoB,EAAMf,gBAAgBC,EAAOC,GAAMpG,GAE1EuG,EAAUhJ,OAAOoJ,EAAY,GAAG3L,EAAG2L,EAAY,GAAGvL,GAClDmL,EAAUY,iBAAiBD,EAAY,GAAGlM,EAAGkM,EAAY,GAAG9L,EAAGwL,EAAY,GAAG5L,EAAG4L,EAAY,GAAGxL,GAChGmL,EAAU9I,OAAOmJ,EAAY,GAAG5L,EAAG4L,EAAY,GAAGxL,GAClDmL,EAAUY,iBAAiBD,EAAY,GAAGlM,EAAGkM,EAAY,GAAG9L,EAAGuL,EAAY,GAAG3L,EAAG2L,EAAY,GAAGvL,EACjG,CAEOgM,gBAAgB/H,EAAiBgI,GAOvC,MANsB,CACpBrM,EAAGqE,EAAOrE,EAAEqM,IAAU,EACtBjM,EAAGiE,EAAOjE,EAAEiM,IAAU,EACtB9L,EAAG8D,EAAO9D,EAAE8L,IAAU,EACtB1L,EAAG0D,EAAO1D,EAAE0L,IAAU,EAGzB,CAED/C,WAAWiC,EAAqClH,GAE9C,MAAMpC,EAASoC,EAAOrE,EAAEiC,OAClB+C,EAAQX,EAAOW,MAAQ,EAAIX,EAAOW,MAAQuG,EAAUxG,UACpDE,EAAQZ,EAAOY,MAAQZ,EAAOY,MAAQsG,EAAUjJ,YAChDuD,EAAa9H,KAAKqO,gBAAgB/H,EAAQ,GAC1CiI,EAAerK,EAAS,EAE9BsJ,EAAUnJ,OACV,IAEE,GADAmJ,EAAU/I,YACNP,EAAS,EACXlE,KAAKuN,UAAUC,EAAW1F,EAAoB,GAARb,OACjC,CACLjH,KAAKuN,UAAUC,EAAW1F,EAAYb,EAAQa,EAAWlF,GACzD,MAAM4L,EAAsBxB,mBAAmBlF,EAAY9H,KAAKqO,gBAAgB/H,EAAQ,IACxFtG,KAAK2N,WAAWH,EAAW1F,EAAY0G,EAAavH,GAMpD,IAAK,IAAIhB,EAAI,EAAGA,EAAIsI,EAActI,IAAK,CACrC,MAAMmH,EAAgBJ,mBAAmBhN,KAAKqO,gBAAgB/H,EAAQL,GAAIjG,KAAKqO,gBAAgB/H,EAAQL,EAAI,IACrGoH,EAAcL,mBAAmBhN,KAAKqO,gBAAgB/H,EAAQL,EAAI,GAAIjG,KAAKqO,gBAAgB/H,EAAQL,EAAI,IACvGiI,EAAelO,KAAKqO,gBAAgB/H,EAAQL,EAAI,GACtDjG,KAAKiO,gBAAgBT,EAAWJ,EAAOC,EAAKa,EAAMjH,EACnD,CACD,MAAMwH,EAAoBzB,mBAAmBhN,KAAKqO,gBAAgB/H,EAAQpC,EAAS,GAAIlE,KAAKqO,gBAAgB/H,EAAQpC,EAAS,IACvHwK,EAAkB1O,KAAKqO,gBAAgB/H,EAAQpC,EAAS,GAC9DlE,KAAK2N,WAAWH,EAAWiB,EAAWC,EAASzH,GAE/C,MAAM0H,EAAqB3O,KAAKqO,gBAAgB/H,EAAQpC,EAAS,GAC3D0K,EAAmB5O,KAAKqO,gBAAgB/H,EAAQpC,EAAS,GAC/DlE,KAAK8N,YAAYN,EAAWmB,EAAYC,EAAU3H,EACnD,CACDuG,EAAUqB,iBACIhO,IAAVqG,IACFsG,EAAUlJ,UAAY4C,EACtBsG,EAAU3I,QAEZ2I,EAAUnJ,MAIX,CAFO,QACNmJ,EAAU1I,SACX,CACF,yQCvG8DgK,UAAyJ,SAAStM,GAAG,SAASvF,EAAE8R,GAAG,GAAGlJ,EAAEkJ,GAAG,OAAOlJ,EAAEkJ,GAAGC,QAAQ,IAAIC,EAAEpJ,EAAEkJ,GAAG,CAAC9I,EAAE8I,EAAEG,GAAE,EAAGF,QAAQ,CAAA,GAAI,OAAOxM,EAAEuM,GAAGI,KAAKF,EAAED,QAAQC,EAAEA,EAAED,QAAQ/R,GAAGgS,EAAEC,GAAE,EAAGD,EAAED,OAAO,CAAC,IAAInJ,EAAE,CAAE,EAAC,OAAO5I,EAAEmS,EAAE5M,EAAEvF,EAAEoS,EAAExJ,EAAE5I,EAAEgJ,EAAE,SAASzD,GAAG,OAAOA,CAAC,EAAEvF,EAAEqS,EAAE,SAAS9M,EAAEqD,EAAEkJ,GAAG9R,EAAE8R,EAAEvM,EAAEqD,IAAI4F,OAAO8D,eAAe/M,EAAEqD,EAAE,CAAC2J,cAAa,EAAGC,YAAW,EAAGC,IAAIX,GAAG,EAAE9R,EAAE4I,EAAE,SAASrD,GAAG,IAAIqD,EAAErD,GAAGA,EAAEmN,WAAW,WAAW,OAAOnN,EAAEoN,OAAO,EAAE,WAAW,OAAOpN,CAAC,EAAE,OAAOvF,EAAEqS,EAAEzJ,EAAE,IAAIA,GAAGA,CAAC,EAAE5I,EAAE8R,EAAE,SAASvM,EAAEvF,GAAG,OAAOwO,OAAOoE,UAAUC,eAAeX,KAAK3M,EAAEvF,EAAE,EAAEA,EAAE2F,EAAE,GAAG3F,EAAEA,EAAE8S,EAAE,EAAE,CAA1e,CAA4e,CAAC,SAASvN,EAAEvF,EAAE4I,GAAgB,SAASkJ,EAAEvM,EAAEvF,GAAG,KAAKuF,aAAavF,GAAG,MAAM,IAAI+S,UAAU,oCAAoC,CAACvE,OAAO8D,eAAetS,EAAE,aAAa,CAACH,OAAM,IAAK,IAAImS,EAAE,mBAAmBgB,QAAQ,iBAAiBA,OAAOC,SAAS,SAAS1N,GAAG,cAAcA,CAAC,EAAE,SAASA,GAAG,OAAOA,GAAG,mBAAmByN,QAAQzN,EAAE1C,cAAcmQ,QAAQzN,IAAIyN,OAAOJ,UAAU,gBAAgBrN,CAAC,EAAEyD,EAAE,SAASzD,EAAEvF,GAAG,IAAI4I,EAAE7F,KAAK+O,EAAE/O,KAAKwC,GAAGxC,KAAKmQ,OAAO,SAAS3N,GAAG,GAAG,iBAAiBA,EAAE,OAAO4N,QAAQC,MAAM,oCAA+B,IAAS7N,EAAE,YAAYyM,EAAEzM,GAAGA,GAAG,qBAAqB,IAAIvF,EAAE,GAAG8R,OAAE,EAAO9I,OAAE,EAAOqK,OAAE,EAAO,IAAI9N,EAAE+N,MAAM,KAAK/I,SAAQ,SAAShF,GAAG,GAAGyD,EAAEzD,EAAEgO,OAAO,IAAI,IAAIvK,EAAEwK,QAAQ,KAAKxT,EAAEgJ,GAAG,CAAE,EAAC8I,EAAE9I,MAAM,CAACA,EAAEyK,UAAU,EAAEzK,EAAEwK,QAAQ,MAAMF,MAAM,KAAK/I,SAAQ,SAAShF,IAAI8N,EAAE9N,EAAE+N,MAAM,OAAO,IAAID,EAAEpM,SAASjH,EAAE8R,GAAGuB,EAAE,GAAGE,OAAOG,QAAQ,WAAW,KAAK9K,EAAE+K,eAAeN,EAAE,GAAGE,OAAOG,QAAQ,WAAW,KAAK,IAAG,KAAI5B,EAAE9I,EAAEsK,MAAM,KAAK,GAAGC,UAAWvT,EAAE8R,GAAG,IAAI,MAAMvM,IAAI,CAAC,GAAsC,CAAnC,MAAMA,GAAG,MAAM,oBAAoB,CAAC,OAAOvF,CAAC,EAAE+C,KAAK6Q,MAAM,SAASrO,GAAG,GAAG,iBAAY,IAASA,EAAE,YAAYyM,EAAEzM,IAAI,OAAO4N,QAAQC,MAAM,qCAAgC,IAAS7N,EAAE,YAAYyM,EAAEzM,GAAGA,GAAG,sBAAsB,IAAIvF,EAAE,GAAG,IAAI,IAAI,IAAI4I,KAAKrD,EAAE,GAAGA,EAAEsN,eAAejK,GAAG,CAAa,IAAI,IAAIkJ,KAApB9R,GAAG4I,EAAE,OAAoBrD,EAAEqD,GAAGrD,EAAEqD,GAAGiK,eAAef,KAAK9R,GAAG8R,EAAE,KAAKvM,EAAEqD,GAAGkJ,GAAG,OAAO9R,GAAG,KAAK,CAAsC,CAApC,MAAMuF,GAAG,MAAM,qBAAqB,CAAC,OAAOvF,CAAC,EAAE+C,KAAK4Q,eAAe,SAASpO,GAAG,MAAM,MAAMA,EAAEsO,OAAO,GAAGtO,EAAEsO,MAAM,EAAEjL,EAAE3B,OAAO,GAAG1B,CAAC,CAAC,EAAEvF,EAAE2S,QAAQ3J,CAAC,EAAE,SAASzD,EAAEvF,EAAE4I,GAAgBrD,EAAEwM,QAAQnJ,EAAE,GAAG+J,OAAO,uICK9pE,MAAMmB,EAAc,IAAIC,EAExB,IAAeC,EAAA,CACbC,WAAWC,GAET,IAAIC,EAAML,EAAOF,MAAMM,GAEvB,OADAC,EAAMA,EAAIT,QAAS,YAAa,IACzBS,CACR,EACDC,YAAYjG,GAEV,MAAMkG,EAAQP,EAAOZ,OAAO/E,GAI5B,OAHAkG,EAAM,SAAS,aAAeC,OAAOD,EAAM,SAAS,cACpDA,EAAME,IAAI,uBAAyBD,OAAOD,EAAME,IAAI,wBACpDF,EAAME,IAAIvK,MAAQsK,OAAOD,EAAME,IAAIvK,OAC5BqK,CACR,EACDG,cAAeC,GACb,IAAIN,EAAML,EAAOF,MAAM,CAAEO,IAAKM,IAG9B,OAFAN,EAAMA,EAAIV,UAAU,EAAGU,EAAIlN,OAAS,GACpCkN,EAAMA,EAAIT,QAAS,YAAa,IACzBS,CACR,EACDO,eAAgBC,GACd,MAAMF,EAAWX,EAAOZ,OAAO,QAAQyB,MAAmBR,IAG1D,OAFAM,EAASzK,MAAQsK,OAAOG,EAASzK,OACjCyK,EAAS,uBAAyBH,OAAOG,EAAS,wBAC3CA,CACR,yCCjCD,IAkBGG,EAfH/C,WAeG+C,EAAWA,GAAa,SAAUtQ,EAAMV,GAIxC,IAAIiR,EAASrG,OAAOqG,QAAW,WAC3B,SAASC,IAClB,CACS,OAAO,SAAUC,GACb,IAAIC,EAQJ,OANAF,EAAElC,UAAYmC,EAEdC,EAAU,IAAIF,EAEdA,EAAElC,UAAY,KAEPoC,CACpB,CACA,IAKSC,EAAI,CAAA,EAKJC,EAAQD,EAAEE,IAAM,GAKhBC,EAAOF,EAAME,KAGN,CAmBHC,OAAQ,SAAUC,GAEd,IAAIN,EAAUH,EAAO9R,MAoBrB,OAjBIuS,GACAN,EAAQO,MAAMD,GAIbN,EAAQnC,eAAe,SAAW9P,KAAK6L,OAASoG,EAAQpG,OACzDoG,EAAQpG,KAAO,WACXoG,EAAQQ,OAAO5G,KAAKtO,MAAMyC,KAAM0S,UACzD,GAIiBT,EAAQpG,KAAKgE,UAAYoC,EAGzBA,EAAQQ,OAASzS,KAEViS,CACV,EAcDH,OAAQ,WACJ,IAAIa,EAAW3S,KAAKsS,SAGpB,OAFAK,EAAS9G,KAAKtO,MAAMoV,EAAUD,WAEvBC,CACV,EAcD9G,KAAM,WACL,EAaD2G,MAAO,SAAUI,GACb,IAAK,IAAIC,KAAgBD,EACjBA,EAAW9C,eAAe+C,KAC1B7S,KAAK6S,GAAgBD,EAAWC,IAKpCD,EAAW9C,eAAe,cAC1B9P,KAAK8S,SAAWF,EAAWE,SAElC,EAWDC,MAAO,WACH,OAAO/S,KAAK6L,KAAKgE,UAAUyC,OAAOtS,KACrC,GAULgT,EAAYb,EAAMa,UAAYX,EAAKC,OAAO,CAa1CzG,KAAM,SAAUoH,EAAOC,GACnBD,EAAQjT,KAAKiT,MAAQA,GAAS,GAG1BjT,KAAKkT,SADLA,GAAYrS,EACIqS,EAEe,EAAfD,EAAM/O,MAE7B,EAeD4O,SAAU,SAAUK,GAChB,OAAQA,GAAWC,GAAKC,UAAUrT,KACrC,EAaDsT,OAAQ,SAAUC,GAEd,IAAIC,EAAYxT,KAAKiT,MACjBQ,EAAYF,EAAUN,MACtBS,EAAe1T,KAAKkT,SACpBS,EAAeJ,EAAUL,SAM7B,GAHAlT,KAAK4T,QAGDF,EAAe,EAEf,IAAK,IAAIzN,EAAI,EAAGA,EAAI0N,EAAc1N,IAAK,CACnC,IAAI4N,EAAYJ,EAAUxN,IAAM,KAAQ,GAAMA,EAAI,EAAK,EAAM,IAC7DuN,EAAWE,EAAezN,IAAO,IAAM4N,GAAa,IAAOH,EAAezN,GAAK,EAAK,CACvF,MAGD,IAASA,EAAI,EAAGA,EAAI0N,EAAc1N,GAAK,EACnCuN,EAAWE,EAAezN,IAAO,GAAKwN,EAAUxN,IAAM,GAM9D,OAHAjG,KAAKkT,UAAYS,EAGV3T,IACV,EASD4T,MAAO,WAEH,IAAIX,EAAQjT,KAAKiT,MACbC,EAAWlT,KAAKkT,SAGpBD,EAAMC,IAAa,IAAM,YAAe,GAAMA,EAAW,EAAK,EAC9DD,EAAM/O,OAAS3C,EAAKuS,KAAKZ,EAAW,EACvC,EAWDH,MAAO,WACH,IAAIA,EAAQV,EAAKU,MAAM5D,KAAKnP,MAG5B,OAFA+S,EAAME,MAAQjT,KAAKiT,MAAMnC,MAAM,GAExBiC,CACV,EAeDgB,OAAQ,SAAUC,GAkBd,IAjBA,IAiBgBC,EAjBZhB,EAAQ,GAERhE,EAAK,SAAUiF,GACf,IACIC,EAAM,UACNC,EAAO,WAEX,OAAO,WAGH,IAAIjX,IAFJgX,EAAO,OAAgB,MAANA,IAAiBA,GAAO,IAASC,IAE5B,KADtBF,EAAO,MAAgB,MAANA,IAAiBA,GAAO,IAASE,GACbA,EAGrC,OAFAjX,GAAU,YACVA,GAAU,KACOoE,EAAKwS,SAAW,GAAK,GAAK,EAC9C,CACJ,EAEQ9N,EAAI,EAAWA,EAAI+N,EAAQ/N,GAAK,EAAG,CACxC,IAAIoO,EAAKpF,EAA8B,YAA3BgF,GAAU1S,EAAKwS,WAE3BE,EAAgB,UAAPI,IACTpB,EAAM5M,KAAa,WAAPgO,IAAsB,EACrC,CAED,OAAO,IAAIrB,EAAUnH,KAAKoH,EAAOe,EACpC,IAMDM,EAAQpC,EAAEqC,IAAM,GAKhBnB,EAAMkB,EAAMlB,IAAM,CAclBC,UAAW,SAAUE,GAOjB,IALA,IAAIN,EAAQM,EAAUN,MAClBC,EAAWK,EAAUL,SAGrBsB,EAAW,GACNvO,EAAI,EAAGA,EAAIiN,EAAUjN,IAAK,CAC/B,IAAIwO,EAAQxB,EAAMhN,IAAM,KAAQ,GAAMA,EAAI,EAAK,EAAM,IACrDuO,EAASnO,MAAMoO,IAAS,GAAG3B,SAAS,KACpC0B,EAASnO,MAAa,GAAPoO,GAAa3B,SAAS,IACxC,CAED,OAAO0B,EAASE,KAAK,GACxB,EAeDC,MAAO,SAAUC,GAMb,IAJA,IAAIC,EAAeD,EAAO1Q,OAGtB+O,EAAQ,GACHhN,EAAI,EAAGA,EAAI4O,EAAc5O,GAAK,EACnCgN,EAAMhN,IAAM,IAAM6O,SAASF,EAAOG,OAAO9O,EAAG,GAAI,KAAQ,GAAMA,EAAI,EAAK,EAG3E,OAAO,IAAI+M,EAAUnH,KAAKoH,EAAO4B,EAAe,EACnD,GAMDG,EAASV,EAAMU,OAAS,CAcxB3B,UAAW,SAAUE,GAOjB,IALA,IAAIN,EAAQM,EAAUN,MAClBC,EAAWK,EAAUL,SAGrB+B,EAAc,GACThP,EAAI,EAAGA,EAAIiN,EAAUjN,IAAK,CAC/B,IAAIwO,EAAQxB,EAAMhN,IAAM,KAAQ,GAAMA,EAAI,EAAK,EAAM,IACrDgP,EAAY5O,KAAK6O,OAAOC,aAAaV,GACxC,CAED,OAAOQ,EAAYP,KAAK,GAC3B,EAeDC,MAAO,SAAUS,GAMb,IAJA,IAAIC,EAAkBD,EAAUlR,OAG5B+O,EAAQ,GACHhN,EAAI,EAAGA,EAAIoP,EAAiBpP,IACjCgN,EAAMhN,IAAM,KAAiC,IAA1BmP,EAAUE,WAAWrP,KAAe,GAAMA,EAAI,EAAK,EAG1E,OAAO,IAAI+M,EAAUnH,KAAKoH,EAAOoC,EACpC,GAMDE,EAAOjB,EAAMiB,KAAO,CAcpBlC,UAAW,SAAUE,GACjB,IACI,OAAOiC,mBAAmBC,OAAOT,EAAO3B,UAAUE,IAGrD,CAFC,MAAOtW,GACL,MAAM,IAAIO,MAAM,uBACnB,CACJ,EAeDmX,MAAO,SAAUe,GACb,OAAOV,EAAOL,MAAMgB,SAASC,mBAAmBF,IACnD,GAUDG,EAAyB1D,EAAM0D,uBAAyBxD,EAAKC,OAAO,CAQpEwD,MAAO,WAEH9V,KAAK+V,MAAQ,IAAI/C,EAAUnH,KAC3B7L,KAAKgW,YAAc,CACtB,EAYDC,QAAS,SAAUvO,GAEI,iBAARA,IACPA,EAAO6N,EAAKZ,MAAMjN,IAItB1H,KAAK+V,MAAMzC,OAAO5L,GAClB1H,KAAKgW,aAAetO,EAAKwL,QAC5B,EAgBDgD,SAAU,SAAUC,GAEhB,IAAIzO,EAAO1H,KAAK+V,MACZK,EAAY1O,EAAKuL,MACjBoD,EAAe3O,EAAKwL,SACpBoD,EAAYtW,KAAKsW,UAIjBC,EAAeF,GAHc,EAAZC,GAcjBE,GARAD,EAFAJ,EAEe5U,EAAKuS,KAAKyC,GAIVhV,EAAKmJ,KAAoB,EAAf6L,GAAoBvW,KAAKyW,eAAgB,IAIrCH,EAG7BI,EAAcnV,EAAKoV,IAAkB,EAAdH,EAAiBH,GAG5C,GAAIG,EAAa,CACb,IAAK,IAAII,EAAS,EAAGA,EAASJ,EAAaI,GAAUN,EAEjDtW,KAAK6W,gBAAgBT,EAAWQ,GAIpC,IAAIE,EAAiBV,EAAUW,OAAO,EAAGP,GACzC9O,EAAKwL,UAAYwD,CACpB,CAGD,OAAO,IAAI1D,EAAUnH,KAAKiL,EAAgBJ,EAC7C,EAWD3D,MAAO,WACH,IAAIA,EAAQV,EAAKU,MAAM5D,KAAKnP,MAG5B,OAFA+S,EAAMgD,MAAQ/V,KAAK+V,MAAMhD,QAElBA,CACV,EAED0D,eAAgB,IAQPtE,EAAM6E,OAASnB,EAAuBvD,OAAO,CAItD2E,IAAK5E,EAAKC,SAWVzG,KAAM,SAAUoL,GAEZjX,KAAKiX,IAAMjX,KAAKiX,IAAI3E,OAAO2E,GAG3BjX,KAAK8V,OACR,EASDA,MAAO,WAEHD,EAAuBC,MAAM3G,KAAKnP,MAGlCA,KAAKkX,UACR,EAcDC,OAAQ,SAAUC,GAQd,OANApX,KAAKiW,QAAQmB,GAGbpX,KAAKkW,WAGElW,IACV,EAgBDqX,SAAU,SAAUD,GAShB,OAPIA,GACApX,KAAKiW,QAAQmB,GAINpX,KAAKsX,aAGnB,EAEDhB,UAAW,GAeXiB,cAAe,SAAUC,GACrB,OAAO,SAAUC,EAASR,GACtB,OAAO,IAAIO,EAAO3L,KAAKoL,GAAKI,SAASI,EACtD,CACU,EAeDC,kBAAmB,SAAUF,GACzB,OAAO,SAAUC,EAASE,GACtB,OAAO,IAAIC,EAAOC,KAAKhM,KAAK2L,EAAQG,GAAKN,SAASI,EACnE,CACU,IAML,IAAIG,EAAS1F,EAAE4F,KAAO,GAEtB,OAAO5F,CACZ,EAAG3Q,MAGKsQ,4CClvBN/C,EAAAE,QAAmC+I,EAYpBxD,IAAInB,8CCfnB,IAeUvS,EAEHqR,EACAC,EACAE,EACA2F,EAKAC,EAZSpG,EAVhB/C,EAAAE,SAeOmD,GADAD,EAJSL,EAVmBkG,GAelB3F,IACVC,EAAOF,EAAME,KACb2F,EAAe7F,EAAMa,WAKrBiF,EAAQ/F,EAAEgG,IAAM,IAKAC,KAAO9F,EAAKC,OAAO,CAWnCzG,KAAM,SAAUuM,EAAMC,GAClBrY,KAAKoY,KAAOA,EACZpY,KAAKqY,IAAMA,CACd,IA8KcJ,EAAMjF,UAAYX,EAAKC,OAAO,CAqB7CzG,KAAM,SAAUoH,EAAOC,GACnBD,EAAQjT,KAAKiT,MAAQA,GAAS,GAG1BjT,KAAKkT,SADLA,GAAYrS,EACIqS,EAEe,EAAfD,EAAM/O,MAE7B,EAWDoU,MAAO,WAOH,IALA,IAAIC,EAAWvY,KAAKiT,MAChBuF,EAAiBD,EAASrU,OAG1BuU,EAAW,GACNxS,EAAI,EAAGA,EAAIuS,EAAgBvS,IAAK,CACrC,IAAIyS,EAAUH,EAAStS,GACvBwS,EAASpS,KAAKqS,EAAQN,MACtBK,EAASpS,KAAKqS,EAAQL,IACzB,CAED,OAAOL,EAAalG,OAAO2G,EAAUzY,KAAKkT,SAC7C,EAWDH,MAAO,WAQH,IAPA,IAAIA,EAAQV,EAAKU,MAAM5D,KAAKnP,MAGxBiT,EAAQF,EAAME,MAAQjT,KAAKiT,MAAMnC,MAAM,GAGvC6H,EAAc1F,EAAM/O,OACf+B,EAAI,EAAGA,EAAI0S,EAAa1S,IAC7BgN,EAAMhN,GAAKgN,EAAMhN,GAAG8M,QAGxB,OAAOA,CACV,IAKFlB,0CC7SN,IAagBA,EAVhB/C,EAAAE,SAUgB6C,EAVmBkG,EAYnC,WAEG,IAAI7F,EAAIL,EAEJmF,EADQ9E,EAAEE,IACK4E,OACfiB,EAAQ/F,EAAEgG,IACVU,EAAUX,EAAME,KAChBU,EAAeZ,EAAMjF,UACrB4E,EAAS1F,EAAE4F,KAEf,SAASgB,iBACL,OAAOF,EAAQ9G,OAAOvU,MAAMqb,EAASlG,UACxC,CAGD,IAAIqG,EAAI,CACJD,eAAe,WAAY,YAAaA,eAAe,WAAY,WACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,UAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,UAAY,YACnEA,eAAe,UAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,WACnEA,eAAe,WAAY,WAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,WACnEA,eAAe,UAAY,YAAaA,eAAe,UAAY,YACnEA,eAAe,UAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,WACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,UAAY,YAAaA,eAAe,UAAY,WACnEA,eAAe,UAAY,YAAaA,eAAe,UAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,WACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,WACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,UAAY,WACnEA,eAAe,UAAY,YAAaA,eAAe,UAAY,YACnEA,eAAe,UAAY,YAAaA,eAAe,UAAY,YACnEA,eAAe,UAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,WACnEA,eAAe,WAAY,WAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,WACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,UAAY,YAAaA,eAAe,UAAY,YACnEA,eAAe,UAAY,YAAaA,eAAe,UAAY,WACnEA,eAAe,UAAY,WAAaA,eAAe,UAAY,YACnEA,eAAe,WAAY,WAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,YAAaA,eAAe,WAAY,YACnEA,eAAe,WAAY,WAAaA,eAAe,WAAY,aAInEE,EAAI,IACP,WACG,IAAK,IAAI/S,EAAI,EAAGA,EAAI,GAAIA,IACpB+S,EAAE/S,GAAK6S,gBAEpB,CAJK,GASA,IAAIG,EAASrB,EAAOqB,OAASjC,EAAO1E,OAAO,CACvC4E,SAAU,WACNlX,KAAKkZ,MAAQ,IAAIL,EAAahN,KAAK,CAC/B,IAAI+M,EAAQ/M,KAAK,WAAY,YAAa,IAAI+M,EAAQ/M,KAAK,WAAY,YACvE,IAAI+M,EAAQ/M,KAAK,WAAY,YAAa,IAAI+M,EAAQ/M,KAAK,WAAY,YACvE,IAAI+M,EAAQ/M,KAAK,WAAY,YAAa,IAAI+M,EAAQ/M,KAAK,WAAY,WACvE,IAAI+M,EAAQ/M,KAAK,UAAY,YAAa,IAAI+M,EAAQ/M,KAAK,WAAY,YAE9E,EAEDgL,gBAAiB,SAAUsC,EAAGvC,GAiD1B,IA/CA,IAAIwC,EAAIpZ,KAAKkZ,MAAMjG,MAEfoG,EAAKD,EAAE,GACPE,EAAKF,EAAE,GACPG,EAAKH,EAAE,GACPI,EAAKJ,EAAE,GACPK,EAAKL,EAAE,GACPM,EAAKN,EAAE,GACPO,EAAKP,EAAE,GACPQ,EAAKR,EAAE,GAEPS,EAAMR,EAAGjB,KACT0B,EAAMT,EAAGhB,IACT0B,EAAMT,EAAGlB,KACT4B,EAAMV,EAAGjB,IACT4B,EAAMV,EAAGnB,KACT8B,EAAMX,EAAGlB,IACT8B,EAAMX,EAAGpB,KACTgC,EAAMZ,EAAGnB,IACTgC,EAAMZ,EAAGrB,KACTkC,EAAMb,EAAGpB,IACTkC,EAAMb,EAAGtB,KACToC,EAAMd,EAAGrB,IACToC,EAAMd,EAAGvB,KACTsC,EAAMf,EAAGtB,IACTsC,EAAMf,EAAGxB,KACTwC,EAAMhB,EAAGvB,IAGTwC,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EACLiB,EAAKhB,EAGA3U,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAEzB,IAAI4V,EAAK7C,EAAE/S,GAGX,GAAIA,EAAI,GACJ,IAAI6V,EAAMD,EAAGzD,KAA+B,EAAxBe,EAAEvC,EAAa,EAAJ3Q,GAC3B8V,EAAMF,EAAGxD,IAA+B,EAAxBc,EAAEvC,EAAa,EAAJ3Q,EAAQ,OACpC,CAEH,IAAI+V,GAAWhD,EAAE/S,EAAI,IACjBgW,GAAWD,GAAQ5D,KACnB8D,GAAWF,GAAQ3D,IACnB8D,IAAaF,KAAa,EAAMC,IAAY,KAASD,KAAa,EAAMC,IAAY,IAAQD,KAAa,EACzGG,IAAaF,KAAa,EAAMD,IAAY,KAASC,KAAa,EAAMD,IAAY,KAASC,KAAa,EAAMD,IAAY,IAG5HI,GAAWrD,EAAE/S,EAAI,GACjBqW,GAAWD,GAAQjE,KACnBmE,GAAWF,GAAQhE,IACnBmE,IAAaF,KAAa,GAAOC,IAAY,KAASD,IAAY,EAAMC,KAAa,IAAQD,KAAa,EAC1GG,IAAaF,KAAa,GAAOD,IAAY,KAASC,IAAY,EAAMD,KAAa,KAASC,KAAa,EAAMD,IAAY,IAG7HI,GAAO1D,EAAE/S,EAAI,GACb0W,GAAOD,GAAItE,KACXwE,GAAOF,GAAIrE,IAEXwE,GAAQ7D,EAAE/S,EAAI,IACd6W,GAAQD,GAAKzE,KACb2E,GAAQF,GAAKxE,IAObyD,GAFAA,GAFAA,EAAMK,GAAUQ,KADhBZ,EAAMK,GAAUQ,MACiB,EAAMR,KAAY,EAAK,EAAI,IAEhDI,KADZT,GAAYU,MACoB,EAAMA,KAAY,EAAK,EAAI,IAE/CK,KADZf,GAAYgB,MACkB,EAAMA,KAAU,EAAK,EAAI,GAE3DlB,EAAGzD,KAAO0D,EACVD,EAAGxD,IAAO0D,CACb,CAED,IAqBIiB,GArBAC,GAAQ5B,EAAKE,GAAQF,EAAKI,EAC1ByB,GAAQ5B,EAAKE,GAAQF,EAAKI,EAC1ByB,GAAQtC,EAAKE,EAAOF,EAAKI,EAAOF,EAAKE,EACrCmC,GAAQtC,EAAKE,EAAOF,EAAKI,EAAOF,EAAKE,EAErCmC,IAAYxC,IAAO,GAAOC,GAAM,IAASD,GAAM,GAAQC,IAAO,IAAQD,GAAM,GAAOC,IAAO,GAC1FwC,IAAYxC,IAAO,GAAOD,GAAM,IAASC,GAAM,GAAQD,IAAO,IAAQC,GAAM,GAAOD,IAAO,GAC1F0C,IAAYlC,IAAO,GAAOC,GAAM,KAASD,IAAO,GAAOC,GAAM,KAASD,GAAM,GAAOC,IAAO,GAC1FkC,IAAYlC,IAAO,GAAOD,GAAM,KAASC,IAAO,GAAOD,GAAM,KAASC,GAAM,GAAOD,IAAO,GAG1FoC,GAAM1E,EAAE9S,GACRyX,GAAMD,GAAGrF,KACTuF,GAAMF,GAAGpF,IAGTuF,GAAMjC,EAAK4B,KADXP,GAAMpB,EAAK4B,MACoB,EAAM5B,IAAO,EAAK,EAAI,GASrDiC,GAAMP,GAAUF,GAIpBzB,EAAKF,EACLG,EAAKF,EACLD,EAAKF,EACLG,EAAKF,EACLD,EAAKF,EACLG,EAAKF,EAELD,EAAMF,GAdFyC,IAFAA,IAFAA,GAAMA,GAAMX,KADZD,IAAYE,MACgB,EAAMA,KAAQ,EAAK,EAAI,IAEvCQ,KADZV,IAAYW,MACgB,EAAMA,KAAQ,EAAK,EAAI,IAEvC7B,IADZkB,IAAYjB,KACgB,EAAMA,IAAQ,EAAK,EAAI,MAavDT,EAAMF,EAAK4B,GAAO,KACQ,EAAM5B,IAAO,EAAK,EAAI,GAAM,EACtDD,EAAKF,EACLG,EAAKF,EACLD,EAAKF,EACLG,EAAKF,EACLD,EAAKF,EACLG,EAAKF,EAELD,EAAM+C,IAlBIP,GAAUF,IAASU,KAAQ,EAAMP,KAAY,EAAK,EAAI,MAiBhExC,EAAMkC,GAAMa,GAAO,KACQ,EAAMb,KAAQ,EAAK,EAAI,GAAM,CAC3D,CAGDlD,EAAMT,EAAGhB,IAAQyB,EAAMgB,EACvBzB,EAAGjB,KAAQyB,EAAMgB,GAAOf,IAAQ,EAAMgB,IAAO,EAAK,EAAI,GACtDd,EAAMV,EAAGjB,IAAQ2B,EAAMgB,EACvB1B,EAAGlB,KAAQ2B,EAAMgB,GAAOf,IAAQ,EAAMgB,IAAO,EAAK,EAAI,GACtDd,EAAMX,EAAGlB,IAAQ6B,EAAMgB,EACvB3B,EAAGnB,KAAQ6B,EAAMgB,GAAOf,IAAQ,EAAMgB,IAAO,EAAK,EAAI,GACtDd,EAAMZ,EAAGnB,IAAQ+B,EAAMgB,EACvB5B,EAAGpB,KAAQ+B,EAAMgB,GAAOf,IAAQ,EAAMgB,IAAO,EAAK,EAAI,GACtDd,EAAMb,EAAGpB,IAAQiC,EAAMgB,EACvB7B,EAAGrB,KAAQiC,EAAMgB,GAAOf,IAAQ,EAAMgB,IAAO,EAAK,EAAI,GACtDd,EAAMd,EAAGrB,IAAQmC,EAAMgB,EACvB9B,EAAGtB,KAAQmC,EAAMgB,GAAOf,IAAQ,EAAMgB,IAAO,EAAK,EAAI,GACtDd,EAAMf,EAAGtB,IAAQqC,EAAMgB,EACvB/B,EAAGvB,KAAQqC,EAAMgB,GAAOf,IAAQ,EAAMgB,IAAO,EAAK,EAAI,GACtDd,EAAMhB,EAAGvB,IAAQuC,EAAMgB,EACvBhC,EAAGxB,KAAQuC,EAAMgB,GAAOf,IAAQ,EAAMgB,IAAO,EAAK,EAAI,EACzD,EAEDtE,YAAa,WAET,IAAI5P,EAAO1H,KAAK+V,MACZK,EAAY1O,EAAKuL,MAEjB6K,EAAgC,EAAnB9d,KAAKgW,YAClB+H,EAA4B,EAAhBrW,EAAKwL,SAerB,OAZAkD,EAAU2H,IAAc,IAAM,KAAS,GAAKA,EAAY,GACxD3H,EAA8C,IAAjC2H,EAAY,MAAS,IAAO,IAAWxc,KAAKuE,MAAMgY,EAAa,YAC5E1H,EAA8C,IAAjC2H,EAAY,MAAS,IAAO,IAAWD,EACpDpW,EAAKwL,SAA8B,EAAnBkD,EAAUlS,OAG1BlE,KAAKkW,WAGMlW,KAAKkZ,MAAMZ,OAIzB,EAEDvF,MAAO,WACH,IAAIA,EAAQiE,EAAOjE,MAAM5D,KAAKnP,MAG9B,OAFA+S,EAAMmG,MAAQlZ,KAAKkZ,MAAMnG,QAElBA,CACV,EAEDuD,UAAW,KAiBfpE,EAAE+G,OAASjC,EAAOO,cAAc0B,GAgBhC/G,EAAE8L,WAAahH,EAAOU,kBAAkBuB,EAC7C,CA9SC,GAiTOpH,EAASoH,+CChUf,IAiBO/G,EAEAG,EAEAkD,EAlBPzG,EAAAE,SAgBOqD,GAFAH,EAd4B6F,GAelB3F,IACGC,KAEbkD,EADQrD,EAAEqC,IACGgB,UACJrD,EAAE4F,KAKGD,KAAOxF,EAAKC,OAAO,CAWjCzG,KAAM,SAAU2L,EAAQG,GAEpBH,EAASxX,KAAKie,QAAU,IAAIzG,EAAO3L,KAGjB,iBAAP8L,IACPA,EAAMpC,EAAKZ,MAAMgD,IAIrB,IAAIuG,EAAkB1G,EAAOlB,UACzB6H,EAAyC,EAAlBD,EAGvBvG,EAAIzE,SAAWiL,IACfxG,EAAMH,EAAOH,SAASM,IAI1BA,EAAI/D,QAWJ,IARA,IAAIwK,EAAOpe,KAAKqe,MAAQ1G,EAAI5E,QACxBuL,EAAOte,KAAKue,MAAQ5G,EAAI5E,QAGxByL,EAAYJ,EAAKnL,MACjBwL,EAAYH,EAAKrL,MAGZhN,EAAI,EAAGA,EAAIiY,EAAiBjY,IACjCuY,EAAUvY,IAAM,WAChBwY,EAAUxY,IAAM,UAEpBmY,EAAKlL,SAAWoL,EAAKpL,SAAWiL,EAGhCne,KAAK8V,OACR,EASDA,MAAO,WAEH,IAAI0B,EAASxX,KAAKie,QAGlBzG,EAAO1B,QACP0B,EAAOL,OAAOnX,KAAKue,MACtB,EAcDpH,OAAQ,SAAUC,GAId,OAHApX,KAAKie,QAAQ9G,OAAOC,GAGbpX,IACV,EAgBDqX,SAAU,SAAUD,GAEhB,IAAII,EAASxX,KAAKie,QAGdS,EAAYlH,EAAOH,SAASD,GAIhC,OAHAI,EAAO1B,QACI0B,EAAOH,SAASrX,KAAKqe,MAAMtL,QAAQO,OAAOoL,GAGxD,6CCtIR5P,EAAcE,QAAqB+I,EAYpBiG,wBCZDW,YAAalH,EAAiBmH,EAAwBC,GAEpE,OADa,IAAIb,EAAWvG,EAASmH,EAAiBC,GAC1C/L,SAASM,EACvB,CCFM,MAAO0L,oBAAoBC,YAI/Bjf,cAEEkf,OACD,CAEMC,qBAML,OAJKH,YAAYnM,WACfmM,YAAYnM,SAAW,IAAImM,aAGtBA,YAAYnM,QACpB,CAEOuM,KAAKvX,EAAcD,GAEzB1H,KAAKmf,cAAc,IAAIC,YAAYzX,EAAM8D,OAAO4T,OAAO,CAAEC,SAAS,EAAMC,UAAU,GAAQ7X,EAAO,CAAE8X,OAAQ9X,QAAS7G,IACrH,CAED4e,aAEEzf,KAAKkf,KAAKxgB,EAAUO,OACrB,CACDygB,aAAa1Q,GAEXhP,KAAKkf,KAAKxgB,EAAUI,SAAUkQ,EAC/B,CACD2Q,WAAWC,GAET5f,KAAKkf,KAAKxgB,EAAUE,QAAS,CAC3BihB,QAASD,EAAgBC,QACzBC,QAASF,EAAgBE,QACzBC,UAAWH,EAAgBI,MAAMJ,EAAgBK,YAAYC,QAC7DD,WAAYL,EAAgBK,WAC5BE,YAAaP,EAAgBI,MAAM9b,OACnCgc,QAASN,EAAgBI,MAAMJ,EAAgBK,YAAYC,SAE9D,CACDE,SAASnU,GAEPjM,KAAKkf,KAAKxgB,EAAUC,KAAMsN,EAC3B,CACDoU,UAAUC,GAERtgB,KAAKkf,KAAKxgB,EAAUgB,MAAO4gB,EAC5B,CACDC,UAAUtU,GAERjM,KAAKkf,KAAKxgB,EAAUU,MAAO6M,EAC5B,CACDuU,YAAYvU,GAEVjM,KAAKkf,KAAKxgB,EAAUW,QAAS4M,EAC9B,CACDwU,cAEEzgB,KAAKkf,KAAKxgB,EAAUe,QACrB,CACDihB,WAAWC,EAAcC,GAEvB5gB,KAAKkf,KAAKxgB,EAAUY,OAAQ,CAAEqhB,OAAMC,YACrC,QC9DmBC,mBAKpB/gB,YAAYghB,EAAoCC,GAE9C/gB,KAAKghB,oBAAsBF,EAC3B9gB,KAAKihB,yBAA2BF,CACjC,CAEGG,kBAEF,OAAOpC,YAAYqC,aACpB,CAGDtV,KAAKuV,EAAiBC,GAAyB,ECR3C,MAAOC,uBAAuBT,mBAElC/gB,YAAYghB,EAAoCC,GAE9C/B,MAAM8B,EAAcC,EACrB,CAEGQ,UAEF,MAAO,GAAIvhB,KAAKghB,oBAAoBQ,YAAcxhB,KAAKghB,oBAAoBS,0BAC5E,CAEGC,iBAEF,OAAQ1hB,KAAKihB,yBAAyBtZ,MACpC,IAAK,UACH,MAAO,CACLga,KAAM3hB,KAAKihB,yBAAyBU,KACpCC,QAAS5hB,KAAKihB,yBAAyBW,QACvCC,OAAQ7hB,KAAKihB,yBAAyBY,QAE1C,IAAK,OACH,MAAO,CACLF,KAAM3hB,KAAKihB,yBAAyBU,KACpCG,KAAM9hB,KAAKihB,yBAAyBa,KACpCD,OAAQ7hB,KAAKihB,yBAAyBY,QAE1C,IAAK,cACH,MAAO,CACLF,KAAM3hB,KAAKihB,yBAAyBU,KACpC,cAAe3hB,KAAKihB,yBAAyBc,WAC7CF,OAAQ7hB,KAAKihB,yBAAyBY,QAE1C,IAAK,OACH,MAAO,CACLF,KAAM3hB,KAAKihB,yBAAyBU,KACpCK,KAAMhiB,KAAKihB,yBAAyBe,KACpCH,OAAQ7hB,KAAKihB,yBAAyBY,QAE1C,QACE,MAAM,IAAIrkB,MAAM,gDAAiDwC,KAAKihB,yBAAyBtZ,SAGpG,CAEOsa,UAAUhW,GAEhB,MAAMiW,EAAiC,GACvCjW,EAAMkW,aAAa3a,SAAS4a,IAE1B,MACMC,EAAW,CACf3Q,SAFqD,OAAnC4Q,KAAKjP,UAAU+O,EAAM1Q,eAAqB7Q,EAAYoQ,EAAYQ,cAAc2Q,EAAM1Q,UAGxG6Q,QAASH,EAAMG,QAAQC,KAAKzS,IAEnB,CACL9N,EAAG8N,EAAE9N,EACLI,EAAG0N,EAAE1N,EACLG,EAAGuN,EAAEvN,EACLI,EAAGmN,EAAEnN,EACL4I,YAAauE,EAAEvE,iBAIrB0W,EAAW7b,KAAKgc,EAAS,IAG3B,MAAMI,EAA6D,gBAAvCziB,KAAKihB,yBAAyBtZ,KACxD,cACA3H,KAAKihB,yBAAyBtZ,KAAK+a,OAAO,GAAGC,cAAgB3iB,KAAKihB,yBAAyBtZ,KAAKmJ,MAAM,GAAG8R,cAE3G,MAAO,CACL7iB,cAAeC,KAAK0hB,WACpBmB,KAAM,GACNC,KAAM,GACNL,cAGAxZ,OAAQgD,EAAMhD,OACdhC,MAAOgF,EAAMhF,MACbkb,aAAcD,EAEjB,CAGaa,KAAKrb,EAAWkZ,oDAE5B,MAAMoC,EAAU,IAAIC,QACpBD,EAAQE,OAAO,SAAU,oBAAsBtC,GAC/CoC,EAAQE,OAAO,iBAAkBljB,KAAKghB,oBAAoBpC,gBAC1DoE,EAAQE,OAAO,OAAQvE,YAAY2D,KAAKjP,UAAU3L,GAAO1H,KAAKghB,oBAAoBpC,eAAgB5e,KAAKghB,oBAAoBnC,UAC3HmE,EAAQE,OAAO,eAAgB,oBAC/B,MAAMC,EAAuB,CAC3BC,OAAQ,OACRJ,UACAK,KAAMf,KAAKjP,UAAU3L,IAEjB4b,EAAU,IAAIC,QAAQvjB,KAAKuhB,IAAK4B,GAChCK,QAA2BC,MAAMH,GACvC,GAAIE,EAASE,GAAI,CAGf,IAAIvmB,EACJ,OAHoBqmB,EAASR,QAAQtT,IAAI,iBAIvC,IAAK,4EACL,IAAK,YACL,IAAK,aACHvS,QAAeqmB,EAASG,OACxB,MACF,IAAK,mBACHxmB,QAAeqmB,EAASrS,OACxB,MACF,IAAK,gCACHhU,QAAeqmB,EAASzQ,QAAQ5B,OAAOyS,OAAM,IAAWvnB,UAAA2D,UAAA,OAAA,GAAA,YAAC,aAAMwjB,EAASxB,MAAM,MAC9E,MACF,QACE7kB,QAAeqmB,EAASxB,OAG5B,OAAO7kB,CACR,CAEC,YADkBqmB,EAASrS,SAG9B,CAEa0S,gBAAgB5X,EAAe2U,oDAE3C,MAAMlZ,EAAO1H,KAAKiiB,UAAUhW,GAC5B,OAAOjM,KAAK+iB,KAAKrb,EAAMkZ,GACpBtjB,MAAMwmB,IAEL,MAAM9U,EAAmB,CAAA,EAEzB,OADAA,EAAQ4R,GAAYkD,EACb9U,CAAO,IAEf4U,OAAOtD,IAEN,IAAI7I,EAAU6I,EAAI7I,QACb6I,EAAIyD,OACPtM,EAAU7X,EAAgB9B,gBAE5B,MAAMuS,EAAQ,IAAI7S,MAAMia,GAGxB,MAFApH,EAAM2T,KAAO1D,EAAIyD,MAAQ,GACzB/jB,KAAKkhB,YAAYb,UAAUhQ,GACrBA,CAAK,MAEhB,CAEKwR,OAAO5V,EAAegY,oDAE1B,MAAMC,EAAUjY,EAAMkY,WAGtB,GAFAD,EAAQE,qBAEJF,EAAQhE,QACV,OAAOxjB,QAAQC,QAAQunB,GAEzB,IAAIG,EAAsBJ,GAAsB,GAChD,IAAKI,EAAUngB,OACb,OAAQlE,KAAKihB,yBAAyBtZ,MACpC,IAAK,UACH0c,EAAYrkB,KAAKihB,yBAAyBW,QAAQyC,UAClD,MACF,IAAK,OACHA,EAAYrkB,KAAKihB,yBAAyBa,KAAKuC,UAC/C,MACF,IAAK,cACHA,EAAYrkB,KAAKihB,yBAAyBc,WAAWsC,UACrD,MACF,IAAK,OACHA,EAAYrkB,KAAKihB,yBAAyBe,KAAKqC,UAC/C,MACF,QACE,MAAM,IAAI7mB,MAAM,qBAAsBwC,KAAKihB,yBAAyBtZ,qFAK1E,IAAK0c,EAAUngB,OACb,OAAOxH,QAAQE,OAAO,IAAIY,MAAM,oEAGlC,MAAM8mB,EAAqCD,EAAUE,QAAOnV,IAAM8U,EAAQlV,UAAYkV,EAAQlV,QAAQI,KAEhGJ,QAA2BtS,QAAQ8nB,IAAIF,EAAyB9B,KAAI5B,GAAY5gB,KAAK6jB,gBAAgBK,EAAStD,MAQpH,OANAsD,EAAQO,yBAERzV,EAAQxH,SAAQvK,IACdinB,EAAQlV,QAAUvD,OAAO4T,OAAO6E,EAAQlV,SAAW,CAAA,EAAI/R,EAAE,IAGpDinB,IACR,CAEKvX,OAAOV,oDAEX,OAAOjM,KAAK6hB,OAAO5V,KACpB,QCrNUyY,gBASX5kB,cACEE,KAAK2kB,cAAe,EACpB3kB,KAAK4kB,WAAY,EAEjB5kB,KAAK6kB,QAAU,IAAInoB,SAAQ,CAACC,EAASC,KACnCoD,KAAKpD,OAAgBkoB,GAAczoB,UAAA2D,UAAA,OAAA,GAAA,YAGjC,OAFAA,KAAK2kB,cAAe,EACpB3kB,KAAK4kB,WAAY,EACVhoB,EAAOkoB,EAChB,IACA9kB,KAAKrD,QAAiBmoB,GAAczoB,UAAA2D,UAAA,OAAA,GAAA,YAGlC,OAFAA,KAAK2kB,cAAe,EACpB3kB,KAAK4kB,WAAY,EACVjoB,EAAQmoB,EACjB,GAAC,GAEJ,QCvBUC,gBAOXjlB,YAAYmM,GAEVjM,KAAKigB,WAAa,EAClBjgB,KAAKggB,MAAQ,CAAC/T,EAAMkY,YACpBnkB,KAAK8f,SAAU,EACf9f,KAAK6f,SAAU,CAChB,QCVUmF,gBAKXllB,YAAYC,EAAuCkM,GAEjDjM,KAAKD,cAAgBA,EACrBC,KAAKsK,QAAU,IAAIya,gBAAgB9Y,EACpC,CAEGgZ,aAEF,OAAOnG,YAAYqC,aACpB,CAEO+D,oBACNllB,KAAKsK,QAAQwV,QAAU9f,KAAKsK,QAAQ0V,MAAM9b,OAAS,EAAIlE,KAAKsK,QAAQ2V,WACpEjgB,KAAKsK,QAAQuV,QAAU7f,KAAKsK,QAAQ2V,WAAa,CAClD,CAEDkF,gBAAgBlZ,GACVjM,KAAKsK,QAAQ2V,WAAa,EAAIjgB,KAAKsK,QAAQ0V,MAAM9b,QACnDlE,KAAKsK,QAAQ0V,MAAMjJ,OAAO/W,KAAKsK,QAAQ2V,WAAa,GAGtDjgB,KAAKsK,QAAQ2V,aACbjgB,KAAKsK,QAAQ0V,MAAM3Z,KAAK4F,EAAMkY,YAE1BnkB,KAAKsK,QAAQ0V,MAAM9b,OAASlE,KAAKD,cAAcqlB,eACjDplB,KAAKsK,QAAQ0V,MAAMqF,QACnBrlB,KAAKsK,QAAQ2V,cAGfjgB,KAAKklB,oBACLllB,KAAKilB,OAAOtF,WAAW3f,KAAKsK,QAC7B,CAEDgb,mBAAmBrZ,GACjB,MAAMqC,EAAQtO,KAAKsK,QAAQ0V,MAAMuF,WAAUnW,GAAKA,EAAEoW,mBAAqBvZ,EAAMuZ,mBACzElX,GAAS,IACXtO,KAAKsK,QAAQ0V,MAAMjJ,OAAOzI,EAAO,EAAGrC,EAAMkY,YAC1CnkB,KAAKilB,OAAOtF,WAAW3f,KAAKsK,SAE/B,CAEDmb,OAME,OALIzlB,KAAKsK,QAAQuV,UACf7f,KAAKsK,QAAQ2V,aACbjgB,KAAKklB,oBACLllB,KAAKilB,OAAOtF,WAAW3f,KAAKsK,UAEvBtK,KAAKsK,QAAQ0V,MAAMhgB,KAAKsK,QAAQ2V,YAAYkE,UACpD,CAEDuB,OAME,OALI1lB,KAAKsK,QAAQwV,UACf9f,KAAKsK,QAAQ2V,aACbjgB,KAAKklB,oBACLllB,KAAKilB,OAAOtF,WAAW3f,KAAKsK,UAEvBtK,KAAKsK,QAAQ0V,MAAMhgB,KAAKsK,QAAQ2V,YAAYkE,UACpD,CAEDrO,MAAM7J,GACJjM,KAAKsK,QAAU,IAAIya,gBAAgB9Y,GACnCjM,KAAKilB,OAAOtF,WAAW3f,KAAKsK,QAC7B,QC5DUqb,cAYX7lB,YAAYC,EAA+BkM,GAEzCjM,KAAK4lB,QAAU,IAAI/lB,oBAAoBE,EAAc6lB,SACrD5lB,KAAKsL,QAAU,IAAIgC,uBACnBtN,KAAK6lB,SAAW,IAAIrc,eAAezJ,EAAc+lB,WACjD9lB,KAAK+lB,WAAa,IAAIzE,eAAevhB,EAAcimB,OAAQjmB,EAAckmB,aACzEjmB,KAAKkmB,gBAAkB,IAAIlB,gBAAgBjlB,EAAc,aAAckM,EAAMkY,YAE7EnkB,KAAKmmB,sBAAwBpmB,EAAcqmB,SAC3CpmB,KAAKqmB,UAAY,IAAI3B,eACtB,CAEG4B,mBAEF,OAAOxH,YAAYqC,aACpB,CAEaoF,QAAQta,EAAeoY,oDAEnC,MAAMmC,QAAiBxmB,KAAK+lB,WAAWlE,OAAO5V,EAAOoY,GAErD,OADArkB,KAAKsmB,aAAa5G,aAAa8G,aAAA,EAAAA,EAAUxX,SAClCwX,IACR,CAED3a,KAAK9J,GAKH,OAHA/B,KAAK4lB,QAAQ9iB,OAAOf,GACpB/B,KAAK6lB,SAASha,KAAK9J,GACnB/B,KAAKqmB,UAAU1pB,UACRqD,KAAKqmB,UAAUxB,OACvB,CAEDpY,kBAAkBR,GAEhBjM,KAAK6lB,SAASpZ,kBAAkBR,EAAOjM,KAAKsL,QAC7C,CAEDU,UAAUC,GAERjM,KAAK6lB,SAAS7Z,UAAUC,EAAOjM,KAAKsL,QACrC,CAEKuW,OAAO5V,EAAeoY,oDAE1B,MAAMoC,EAAW,IAAI/B,gBAErB,GADA1kB,KAAKkmB,gBAAgBf,gBAAgBlZ,GACY,WAA7CjM,KAAKmmB,sBAAsBO,cAA4B,CACzDC,aAAa3mB,KAAK4mB,cAClB,IAAIC,EAAe5a,EAAMkY,WACzBnkB,KAAK4mB,aAAeE,YAAW,IAAWzqB,UAAA2D,UAAA,OAAA,GAAA,YAExC6mB,QAAqB7mB,KAAKumB,QAAQM,EAAcxC,GAChDrkB,KAAKkmB,gBAAgBZ,mBAAmBuB,GACpC5a,EAAMuZ,mBAAqBqB,EAAarB,mBAC1CvZ,EAAM+C,QAAU6X,EAAa7X,SAE/ByX,EAAS9pB,QAAQsP,EAClB,KAAEjM,KAAKmmB,sBAAsBY,mBAC/B,MACCN,EAAS9pB,QAAQsP,GAEnB,OAAOwa,EAAS5B,UACjB,CAEKlY,OAAOV,oDAGX,GADAjM,KAAK6lB,SAASlZ,OAAOV,EAAOjM,KAAKsL,SAC7BW,EAAMkW,aAAaje,OAAQ,CAC7B,MAAM8iB,EAAiB,IAAItC,gBAO3B,OANAiC,aAAa3mB,KAAKinB,cAClBjnB,KAAKinB,aAAeH,YAAW,IAAWzqB,UAAA2D,UAAA,OAAA,GAAA,YAExC,MAAMknB,QAAoBlnB,KAAK+lB,WAAWpZ,OAAOV,GACjD+a,EAAerqB,QAAQuqB,EACxB,KAAElnB,KAAKmmB,sBAAsBgB,oBACvBH,EAAenC,OACvB,CACC,OAAOnoB,QAAQC,QAAQsP,KAE1B,CAEKwZ,wDAEJ,MAAM2B,EAAWpnB,KAAKkmB,gBAAgBT,OACtCzlB,KAAKgM,UAAUob,GACf,MAAMC,QAAqBrnB,KAAKumB,QAAQa,GAExC,OADApnB,KAAKkmB,gBAAgBZ,mBAAmB+B,GACjCA,IACR,CAEK3B,wDAEJ,MAAMc,EAAWxmB,KAAKkmB,gBAAgBR,OACtC1lB,KAAKgM,UAAUwa,GACf,MAAMa,QAAqBrnB,KAAKumB,QAAQC,GAExC,OADAxmB,KAAKkmB,gBAAgBZ,mBAAmB+B,GACjCA,IACR,CAEKC,MAAMrb,oDAEV,MAAMiY,EAAUjY,EAAMkY,WAQtB,OAPAD,EAAQoD,QACRtnB,KAAKkmB,gBAAgBf,gBAAgBjB,GACrClkB,KAAKgM,UAAUkY,GACfA,EAAQsB,kBAAmB,IAAI/iB,MAAO8kB,UACtCnX,QAAQoX,IAAI,oBAAqBtD,EAAQlV,SACzChP,KAAKsmB,aAAa5G,aAAawE,EAAQlV,SACvChP,KAAKsmB,aAAa9F,YAAY0D,GACvBA,IACR,ECpIG,MAAOuD,gBAAgB1I,YAI3Bjf,cAEEkf,QACAhf,KAAK0nB,gBAAkB,IAAIC,eAC5B,CAEOzI,KAAKvX,EAAcD,GAEzB1H,KAAKmf,cAAc,IAAIC,YAAYzX,EAAM8D,OAAO4T,OAAO,CAAEC,SAAS,EAAMC,UAAU,GAAQ7X,EAAO,CAAE8X,OAAQ9X,QAAS7G,IACrH,CAED+mB,kBAEE5nB,KAAKkf,KAAKvf,EACX,CACDkoB,gBAEE7nB,KAAKkf,KAAKvf,EACX,CAEDmoB,uBAEE9nB,KAAKkf,KAAKvf,EACX,CACDooB,4BAA4BC,GAE1BhoB,KAAKgD,iBAAiBrD,GAA+B,IAAMqoB,KAAY,CAAEC,OAAQjoB,KAAK0nB,gBAAgBO,QACvG,CAEDC,iBAAiBxmB,GAEf1B,KAAKkf,KAAKvf,EAA0B+B,EACrC,CACDymB,wBAAwBH,GAEtBhoB,KAAKgD,iBAAiBrD,GAA2BS,GAAiB4nB,EAAW5nB,EAAoBof,SAAwB,CAAEyI,OAAQjoB,KAAK0nB,gBAAgBO,QACzJ,CAEDG,eAAeC,GAEbroB,KAAKkf,KAAKvf,EAAyB0oB,EACpC,CACDC,sBAAsBN,GAEpBhoB,KAAKgD,iBAAiBrD,GAA0BS,GAAiB4nB,EAAW5nB,EAAoBof,SAAuC,CAAEyI,OAAQjoB,KAAK0nB,gBAAgBO,QACvK,CAEDM,kBAAkBC,GAEhBxoB,KAAKkf,KAAKvf,EAA4B6oB,EACvC,CACDC,yBAAyBT,GAEvBhoB,KAAKgD,iBAAiBrD,GAA6BS,GAAiB4nB,EAAW5nB,EAAoBof,SAA0C,CAAEyI,OAAQjoB,KAAK0nB,gBAAgBO,QAC7K,CAEDS,UAAUC,GAER3oB,KAAKkf,KAAKvf,EAAmBgpB,EAC9B,CACDC,iBAAiBZ,GAEfhoB,KAAKgD,iBAAiBrD,GAAoBS,GAAiB4nB,EAAW5nB,EAAoBof,SAAkC,CAAEyI,OAAQjoB,KAAK0nB,gBAAgBO,QAC5J,CAEDvI,aAAa1Q,GAEXhP,KAAKkf,KAAKvf,EAAsBqP,EACjC,CACD6Z,kBAAkBb,GAEhBhoB,KAAKgD,iBAAiBrD,GAAuBS,GAAiB4nB,EAAW5nB,EAAoBof,SAAmC,CAAEyI,OAAQjoB,KAAK0nB,gBAAgBO,QAChK,CAEDa,iBAEE9oB,KAAK0nB,gBAAgBqB,OACtB,EC1EG,MAAOC,qBAAqBnI,mBAahC/gB,YAAYghB,EAAoCC,GAE9C/B,MAAM8B,EAAcC,GAZd/gB,KAASipB,UAAG,EACZjpB,KAAiBkpB,kBAAG,EAY1BlpB,KAAKmpB,QAAU,IAAI1B,OACpB,CAEGlG,UAGF,MAAO,GAD6C,UAApCvhB,KAAKghB,oBAAoBQ,OAAsB,MAAQ,UAC9CxhB,KAAKghB,oBAAoBS,6BACnD,CAEG4C,gBAEF,OAAQrkB,KAAKihB,yBAAyBtZ,KAAKyhB,qBACzC,IAAK,OACH,OAAOppB,KAAKihB,yBAAyBe,KAAKqC,UAC5C,IAAK,OACH,OAAOrkB,KAAKihB,yBAAyBa,KAAKuC,UAC5C,IAAK,cACH,OAAOrkB,KAAKihB,yBAAyBc,WAAWsC,UAClD,IAAK,UACH,OAAOrkB,KAAKihB,yBAAyBW,QAAQyC,UAC/C,QACE,MAAO,GAEZ,CAEOgF,eAENrpB,KAAKipB,YACDjpB,KAAKghB,oBAAoBsI,UAAUC,iBAAmBvpB,KAAKipB,UAC7DjpB,KAAKwpB,MAAM,IAAM,aACRxpB,KAAKypB,OAAOC,YAAc,GACnC5C,YAAW,KAEL9mB,KAAKypB,OAAOC,YAAc,IAC5B1pB,KAAKypB,OAAOE,KAAKrH,KAAKjP,UAAU,CAAE1L,KAAM,UACxC3H,KAAKqpB,eACN,GACArpB,KAAKghB,oBAAoBsI,UAAUM,UAEzC,CAEOC,eAEN7pB,KAAKmpB,QAAQtB,gBACb,MAAMiC,EAAS,CACbniB,KAAM3H,KAAK+pB,UAAY,qBAAuB,oBAC9CC,cAAehqB,KAAK+pB,UACpBnL,eAAgB5e,KAAKghB,oBAAoBpC,eACzCqL,KAAM,GACNC,KAAM,GACNC,eAAgBnqB,KAAKmqB,eACrBC,cAAepqB,KAAKoqB,eAEtBpqB,KAAK2pB,KAAKG,EACX,CAEOO,cAAcjqB,GAEpB,IAAIqX,EAAU,GACd,IAAIzX,KAAKsqB,iBAAT,CACA,OAAQlqB,EAAI2jB,MACV,KAAK,IAEH,MACF,KAAK,KACHtM,EAAU8S,EAAWxsB,WACrB,MACF,KAAK,KACH0Z,EAAU8S,EAAWvsB,eACrB,MACF,KAAK,KAGL,KAAK,KACHyZ,EAAU8S,EAAWtsB,iBACrB,MACF,KAAK,KACHwZ,EAAU8S,EAAW9sB,iBACrB,MACF,KAAK,KACHga,EAAU8S,EAAWrsB,sBACrB,MACF,KAAK,KACHuZ,EAAU8S,EAAWpsB,iBACrB,MACF,KAAK,KACHsZ,EAAU8S,EAAWnsB,gBACrB,MACF,KAAK,KACHqZ,EAAU8S,EAAWlsB,eACrB,MACF,KAAK,KACHoZ,EAAU8S,EAAWjsB,gBACrB,MACF,KAAK,KACHmZ,EAAU8S,EAAWhsB,UACrB,MACF,KAAK,KACHkZ,EAAU8S,EAAW/rB,YACrB,MACF,KAAK,KACHiZ,EAAU8S,EAAW9rB,cACrB,MACF,QACEgZ,EAAU8S,EAAWzsB,eAGrB2Z,GACFzX,KAAKkhB,YAAYb,UAAU,IAAI7iB,MAAMia,IAEvCzX,KAAKmpB,QAAQjB,iBAAiB9nB,EAnDG,CAoDlC,CAEOoqB,cAAcvtB,GAEpB+C,KAAKkhB,YAAYb,UAAU,IAAI7iB,MAAMP,EAAE0K,MACxC,CAEO8iB,2BAA2BC,GAEjC,MAAMC,EAAuBD,EACzBC,EAAqBC,eACvB5qB,KAAK2pB,KAAK,CACRhiB,KAAM,OACNkjB,KAAMlM,YAAYgM,EAAqBC,cAAe5qB,KAAKghB,oBAAoBpC,eAAgB5e,KAAKghB,oBAAoBnC,WAGxH8L,EAAqBX,gBACvBhqB,KAAK+pB,UAAYY,EAAqBX,cAEzC,CAEOc,yCAEN9qB,KAAKkpB,kBAAoB,EAEzBlpB,KAAK2pB,KAAIle,OAAA4T,OAAA5T,OAAA4T,OAAA,CAAA,EAAMrf,KAAKihB,0BAAwB,CAAEtZ,KAAM,mBAEhD3H,KAAK+qB,cACP/qB,KAAK2pB,KAAK,CAAEhiB,KAAM,kBAAmBmC,GAAI9J,KAAK+qB,cAAe1G,UAAWrkB,KAAKqkB,YAG7ErkB,KAAK2pB,KAAK,CAAEhiB,KAAM,iBAAkB8a,YAAaziB,KAAKihB,yBAAyBtZ,KAAM0c,UAAWrkB,KAAKqkB,WAExG,CAEO2G,wBAAwBN,GAE9B,MAAMO,EAAoBP,EAC1B1qB,KAAK+qB,cAAgBE,EAAkBC,OACvClrB,KAAKmpB,QAAQf,eAAe6C,EAC7B,CAEOE,2BAA2BT,GAEjC,MAAMU,EAAuBV,EAC7B1qB,KAAKmpB,QAAQZ,kBAAkB6C,EAChC,CAEOC,oBAAoBX,GAE1B,MAAMY,EAAgBZ,EACtB1qB,KAAKmpB,QAAQzJ,aAAa4L,EAC3B,CAEOC,mBAAmBb,GAEzB,MAAMc,EAAed,EACrB1qB,KAAKmpB,QAAQT,UAAU8C,EACxB,CAEOC,mBAAmBf,WAEzB,MAAMpK,EAAMoK,EACZ1qB,KAAKsqB,kBAA2B,UAARhK,EAAI5Y,YAAI,IAAAiD,OAAA,EAAAA,EAAEoZ,OAAQzD,EAAIyD,KAC9C,IAAItM,GAAkB,QAAR3M,EAAAwV,EAAI5Y,YAAI,IAAAoD,OAAA,EAAAA,EAAE2M,UAAW6I,EAAI7I,QACvC,OAAQzX,KAAKsqB,kBACX,IAAK,cACH7S,EAAU8S,EAAW3sB,YACrB,MACF,IAAK,qBACH6Z,EAAU6I,EAAI7I,QACd,MACF,IAAK,qBACHA,EAAU8S,EAAW7sB,kBACrB,MACF,IAAK,kBACH+Z,EAAU8S,EAAW5sB,QACrB,MACF,QACO8Z,IACHA,EAAU8S,EAAW1sB,QAI3BmC,KAAKkhB,YAAYb,UAAU,IAAI7iB,MAAMia,GACtC,CAEOiU,gBAAgBjU,GAEtBzX,KAAKsqB,sBAAmBzpB,EACxB,MAAM6pB,EAAoCpI,KAAK3N,MAAM8C,EAAQ/P,MAC7D,GAA8B,SAA1BgjB,EAAiB/iB,KAEnB,OADA3H,KAAKipB,UAAY,EACTyB,EAAiB/iB,MACvB,IAAK,MACH3H,KAAKyqB,2BAA2BC,GAChC,MACF,IAAK,4BACH1qB,KAAK8qB,yCACL,MACF,IAAK,cACH9qB,KAAKgrB,wBAAwBN,GAC7B,MACF,IAAK,UACH1qB,KAAKmpB,QAAQrB,uBACb,MACF,IAAK,iBACH9nB,KAAKmrB,2BAA2BT,GAChC,MACF,IAAK,WACH1qB,KAAKqrB,oBAAoBX,GACzB,MACF,IAAK,WACH1qB,KAAKurB,mBAAmBb,GACxB,MACF,IAAK,QACH1qB,KAAKyrB,mBAAmBf,GAiB/B,CAED7e,KAAK5C,EAAgBhC,GAEnB,IACEjH,KAAKmqB,eAAiBlhB,EACtBjJ,KAAKoqB,cAAgBnjB,EAErBjH,KAAKypB,OAAS,IAAIkC,UAAU3rB,KAAKuhB,KAE7BvhB,KAAKghB,oBAAoBsI,UAAUsC,aACrC5rB,KAAKqpB,eAGPrpB,KAAKypB,OAAOoC,OAAS,IAAM7rB,KAAK6pB,eAChC7pB,KAAKypB,OAAOqC,QAAWC,GAAmB/rB,KAAKqqB,cAAc0B,GAC7D/rB,KAAKypB,OAAOuC,QAAWD,GAAc/rB,KAAKwqB,cAAcuB,GAExD/rB,KAAKypB,OAAOwC,UAAaF,GAA0B/rB,KAAK0rB,gBAAgBK,GAExE/rB,KAAKmpB,QAAQvB,iBAMd,CAJC,MAAOtH,GACO,IAAI9iB,MAAM+sB,EAAWzsB,gBAC7BkmB,KAAO1D,EAAIyD,MAAQ,iBACzB/jB,KAAKkhB,YAAYb,UAAUC,EAC5B,CACF,CAED4L,eAEE,OAAOlsB,KAAKypB,QAAUzpB,KAAKghB,oBAAoBsI,UAAU6C,eACvDnsB,KAAKkpB,mBAAqBlpB,KAAKghB,oBAAoBsI,UAAU8C,iBAC3DpsB,KAAKsqB,mBAAqB,CAAC,qBAAsB,sBAAsB3e,SAAS3L,KAAKsqB,iBAAiBxX,YAC3G,CAEDuZ,yBAEE,OADArsB,KAAKkpB,oBACElpB,KAAKksB,cACb,CAEDI,WAAWrgB,GACT,MAAMsW,EAAqBtW,EAAMK,wBACV,IAAnBiW,EAAQre,QAGZlE,KAAK2pB,KAAK,CACRhiB,KAAM,aACN4a,QAASA,EAAQC,KAAKzS,IAEb,CACLvE,YAAauE,EAAEvE,YACfhL,UAAWuP,EAAEvP,UACbyB,EAAG8N,EAAE9N,EACLI,EAAG0N,EAAE1N,EACLG,EAAGuN,EAAEvN,EACLI,EAAGmN,EAAEnN,OAIZ,CAED+mB,KAAKlS,GAEH,GAAIzX,KAAKypB,OAAOC,aAAe1pB,KAAKypB,OAAO8C,KAOzC,MAJAvsB,KAAKypB,OAAOrmB,oBAAoB,QAASpD,KAAKqqB,eAC9CrqB,KAAKypB,OAAOrmB,oBAAoB,QAASpD,KAAKwqB,eAC9CxqB,KAAKypB,OAAOrmB,oBAAoB,UAAWpD,KAAK0rB,iBAChD1rB,KAAKypB,OAAOrmB,oBAAoB,OAAQpD,KAAK6pB,cACvC,IAAIrsB,MAAMmC,GANhBK,KAAKypB,OAAOE,KAAKrH,KAAKjP,UAAUoE,GAQnC,CAED+R,MAAMzF,EAAcyI,GAEdxsB,KAAKypB,OAAOC,aAAe1pB,KAAKypB,OAAO8C,MAAQvsB,KAAKypB,OAAOC,aAAe1pB,KAAKypB,OAAOgD,YACxFzsB,KAAKypB,OAAOD,MAAMzF,EAAMyI,EAE3B,CAEK3K,OAAO5V,EAAegY,oDAE1B,IAAII,EAAsBJ,GAAsB,GAChD,IAAKI,EAAUngB,OACb,OAAQlE,KAAKihB,yBAAyBtZ,MACpC,IAAK,UACH0c,EAAYrkB,KAAKihB,yBAAyBW,QAAQyC,UAClD,MACF,IAAK,OACHA,EAAYrkB,KAAKihB,yBAAyBa,KAAKuC,UAC/C,MACF,IAAK,cACHA,EAAYrkB,KAAKihB,yBAAyBc,WAAWsC,UACrD,MACF,IAAK,OACHA,EAAYrkB,KAAKihB,yBAAyBe,KAAKqC,UAC/C,MACF,QACE,MAAM,IAAI7mB,MAAM,qBAAsBwC,KAAKihB,yBAAyBtZ,qFAK1E,IAAK0c,EAAUngB,OACb,OAAOxH,QAAQE,OAAO,IAAIY,MAAM,oEAGlC,MAAMia,EAA2B,CAC/B9P,KAAM,SACNujB,OAAQlrB,KAAK+qB,cACb1G,aAGF,OADArkB,KAAK2pB,KAAKlS,GACHxL,IACR,CAEKU,OAAOV,oDAEXjM,KAAKmqB,eAAiBle,EAAMhD,OAC5BjJ,KAAKoqB,cAAgBne,EAAMhF,MAC3B,MAAMwQ,EAA2B,CAC/B9P,KAAM,iBACNujB,OAAQlrB,KAAK+qB,cACb9hB,OAAQjJ,KAAKmqB,eACbljB,MAAOjH,KAAKoqB,eAGd,OADApqB,KAAK2pB,KAAKlS,GACH/a,QAAQC,QAAQsP,KACxB,QC7YUygB,OAiBX5sB,YAAYsL,EAAkB5K,EAAmBgL,EAAc,OAE7DxL,KAAK2H,KAAO,SACZ3H,KAAKQ,UAAYA,EACjBR,KAAKwL,YAAcA,EACnBxL,KAAKiC,EAAI,GACTjC,KAAKqC,EAAI,GACTrC,KAAKwC,EAAI,GACTxC,KAAK4C,EAAI,GACT5C,KAAKkP,EAAI,GACTlP,KAAKkH,MAAQkE,EAAMlE,MACnBlH,KAAKiH,MAAQmE,EAAMnE,MACnBjH,KAAK,uBAAyBoL,EAAM,uBACpCpL,KAAK,4BAA8BoL,EAAM,4BACzCpL,KAAK,4BAA8BoL,EAAM,2BAC1C,QC5BUuhB,MAiBX7sB,YAAYmH,EAAegC,EAAgB2jB,GAAuB,IAAInqB,MAAO8kB,WAE3EvnB,KAAKuM,WAAa,GAClBvM,KAAKmiB,aAAe,GACpBniB,KAAK6sB,UAAY,CACfC,kBAAmB,EACnBC,sBAAuB,EACvBC,sBAAuB,GAEzBhtB,KAAKoM,eAAiB,GACtBpM,KAAKitB,WAAa,CAChBC,aAASrsB,EACTmO,aAASnO,GAEXb,KAAKmtB,aAAeP,EACpB5sB,KAAKwlB,iBAAmBoH,EACxB5sB,KAAKiH,MAAQA,EACbjH,KAAKiJ,OAASA,EACdjJ,KAAKotB,MAAO,EACZptB,KAAKkgB,SAAU,CAChB,CAEOmN,gBAAiBpgB,EAAgBC,GACvC,MAAMogB,EAAW/rB,KAAKgsB,KAAKhsB,KAAKC,IAAKyL,EAAO5K,EAAI6K,EAAO7K,EAAI,GAAKd,KAAKC,IAAKyL,EAAOhL,EAAIiL,EAAOjL,EAAI,IAChG,OAAOurB,MAAMF,GAAY,EAAIA,CAC9B,CAEOG,cAAexgB,EAAgBC,EAAgBwgB,GACrD,MAAMxpB,EAASwpB,EAAe1tB,KAAKqtB,gBAAgBpgB,EAAQC,GAC3D,OAAOsgB,MAAMtpB,GAAU,EAAIA,CAC5B,CAEOypB,gBAAiB1gB,EAAgBC,EAAgBwgB,GACvD,IAAIE,EAAQ,EACZ,MAAMN,EAAWttB,KAAKqtB,gBAAgBpgB,EAAQC,GACxChJ,EAASlE,KAAKytB,cAAcxgB,EAAQC,EAAQwgB,GAEnC,IAAXxpB,EACF0pB,EAAQ,GACCN,IAAappB,EACtB0pB,EAAQ,EACCN,EAAW,GACpBM,EAAQ,GAAMrsB,KAAKC,IAAI,GAAM8rB,EAAU,IAC9BA,EAAWppB,EAAS,KAC7B0pB,EAAQ,GAAMrsB,KAAKC,IAAI,IAAO0C,EAASopB,GAAW,KAEpD,MAAMzqB,EAAW+qB,EAAQrsB,KAAKmJ,IAAI,GAAK,EAAO,GAAMnJ,KAAKgsB,KAAKD,IAC9D,OAAOE,MAAM3qB,GAAY,GAAMtB,KAAKE,MAAiB,IAAXoB,GAAkB,GAC7D,CAEOgrB,8BAA8BvnB,EAAiB5F,GAErD,MAAM2I,EAAiB,EAAK/C,EAAO,uBAAyB,EAC5D,OAA2B,IAApBA,EAAOrE,EAAEiC,QAAoC,IAApBoC,EAAOjE,EAAE6B,QACvC3C,KAAKwE,IAAIO,EAAOrE,EAAEqE,EAAOrE,EAAEiC,OAAS,GAAKxD,EAAMuB,IAAMoH,GACrD9H,KAAKwE,IAAIO,EAAOjE,EAAEiE,EAAOjE,EAAE6B,OAAS,GAAKxD,EAAM2B,IAAMgH,CACxD,CAEDykB,SAASxnB,EAAiB5F,GAExB,GAAIV,KAAK6tB,8BAA8BvnB,EAAQ5F,GAAQ,CACrD,MAAMqH,EAAoB,CACxB9F,EAAGqE,EAAOrE,EAAEqE,EAAOrE,EAAEiC,OAAQ,GAC7B7B,EAAGiE,EAAOjE,EAAEiE,EAAOjE,EAAE6B,OAAQ,GAC7BtB,EAAG0D,EAAO1D,EAAE0D,EAAO1D,EAAEsB,OAAQ,GAC7B1B,EAAG8D,EAAO9D,EAAE8D,EAAO9D,EAAE0B,OAAQ,IAEzBwpB,EAAuBpnB,EAAO4I,EAAE5I,EAAO4I,EAAEhL,OAAS,GACxDoC,EAAOrE,EAAEoE,KAAK3F,EAAMuB,GACpBqE,EAAOjE,EAAEgE,KAAK3F,EAAM2B,GACpBiE,EAAO9D,EAAE6D,KAAK3F,EAAM8B,GACpB8D,EAAO1D,EAAEyD,KAAKrG,KAAK2tB,gBAAgBjtB,EAAOqH,EAAW2lB,IACrDpnB,EAAO4I,EAAE7I,KAAKrG,KAAKytB,cAAc/sB,EAAOqH,EAAW2lB,GACpD,CACF,CAEDK,UAAUznB,GAERtG,KAAKuM,WAAWlG,KAAKC,EACtB,CAEDgG,sBAAsB0hB,GAGpB,OADAA,EAAWA,GAAYhuB,KAAK6sB,UAAUE,qBAAuB,EACtD/sB,KAAKuM,WAAWuE,MAAMkd,EAC9B,CAEDC,iBAAiB3nB,EAAiB4nB,GAEhC,MAAMC,EAAYnuB,KAAKmiB,aAAaje,OAAS,EAU7C,GAAIlE,KAAKmiB,aAAagM,KARGC,EAQ2BpuB,KAAKmiB,aAAagM,GAAWzc,SARxC2c,EAQkDH,EAPlFE,EAAI,8BAAgCC,EAAI,6BAC7CD,EAAI,8BAAgCC,EAAI,6BACxCD,EAAI,yBAA2BC,EAAI,wBACnCD,EAAIlnB,QAAUmnB,EAAInnB,OAClBknB,EAAInnB,QAAUonB,EAAIpnB,OAIpBjH,KAAKmiB,aAAagM,GAAW5L,QAAQlc,KAAKC,OACrC,CACL,MAAMgoB,EAA+B,CACnC5c,SAAUwc,EACV3L,QAAS,CAACjc,IAEZtG,KAAKmiB,aAAa9b,KAAKioB,EACxB,CAhBuB,IAACF,EAAgBC,EAiBzCruB,KAAKkgB,SAAU,CAChB,CAEDqO,kBAAkB7tB,EAAeF,EAAmBgL,EAAqBJ,EAAkBojB,EAAM,IAE/F,GAAIpjB,EAAM,uBAAwB,CAChC,MAAMqjB,EAAWrjB,EAAM,uBAAyBojB,EAAO,KACvDpjB,EAAMnE,MAAQwnB,EAAU,CACzB,CACDzuB,KAAKwlB,kBAAmB,IAAI/iB,MAAO8kB,UACnCvnB,KAAKgP,aAAUnO,EACfb,KAAK0M,cAAgB,IAAIggB,OAAOthB,EAAO5K,EAAWgL,GAClDxL,KAAK8tB,SAAS9tB,KAAK0M,cAAehM,EACnC,CAEDguB,sBAAsBhuB,GAEhBV,KAAK0M,eACP1M,KAAK8tB,SAAS9tB,KAAK0M,cAAehM,EAErC,CAEDiuB,iBAAiBjuB,EAAegR,GAE1B1R,KAAK0M,gBACP1M,KAAK8tB,SAAS9tB,KAAK0M,cAAehM,GAElCV,KAAK+tB,UAAU/tB,KAAK0M,eACpB1M,KAAKiuB,iBAAiBjuB,KAAK0M,cAAegF,GAE1C1R,KAAK0M,mBAAgB7L,EAExB,CAEDujB,mBAAmB4J,EAAmBhuB,KAAKuM,WAAWrI,OAAS,GAE7DlE,KAAK6sB,UAAUC,iBAAmBkB,CACnC,CAEDvJ,yBAEEzkB,KAAK6sB,UAAUE,qBAAuB/sB,KAAK6sB,UAAUC,gBACtD,CAEDtgB,uBAAuBwhB,GAAmBhuB,KAAKqM,kBAAoBrM,KAAKqM,kBAAkBnI,OAAS,GAAK,IAEtGlE,KAAK6sB,UAAUG,qBAAuBgB,CACvC,CAEDY,wBAEE5uB,KAAK6sB,UAAUG,sBAAwB,CACxC,CAED6B,iBAEE7uB,KAAK6sB,UAAUC,kBAAoB,EACnC9sB,KAAK6sB,UAAUE,sBAAwB,CACxC,CAED5I,WAEE,MAAM2K,EAAc,IAAInC,MAAM3sB,KAAKiH,MAAOjH,KAAKiJ,OAAQjJ,KAAKmtB,cAa5D,OAZA2B,EAAYtJ,iBAAmBlD,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAKwlB,mBAC9DsJ,EAAY1iB,eAAiBkW,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAKoM,iBAC5D0iB,EAAYpiB,cAAgB1M,KAAK0M,cAAgB4V,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAK0M,qBAAkB7L,EAClGiuB,EAAYviB,WAAa+V,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAKuM,aACxDuiB,EAAY3M,aAAeG,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAKmiB,eAC1D2M,EAAYjC,UAAYvK,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAK6sB,YACvDiC,EAAY9f,QAAUhP,KAAKgP,QAAUsT,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAKgP,eAAYnO,EAChFiuB,EAAY7B,WAAWC,QAAUltB,KAAKitB,WAAWC,QAAU5K,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAKitB,WAAWC,eAAYrsB,EACjHiuB,EAAY7B,WAAWje,QAAUhP,KAAKitB,WAAWje,QAAUsT,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAKitB,WAAWje,eAAYnO,EACjHiuB,EAAYziB,kBAAoBrM,KAAKqM,kBAAoBiW,KAAK3N,MAAM2N,KAAKjP,UAAUrT,KAAKqM,yBAAsBxL,EAC9GiuB,EAAY1B,KAAOptB,KAAKotB,KACxB0B,EAAY5O,QAAUlgB,KAAKkgB,QACpB4O,CACR,CAEDxH,QAEEtnB,KAAKwlB,kBAAmB,IAAI/iB,MAAO8kB,UACnCvnB,KAAK0M,mBAAgB7L,EACrBb,KAAKuM,WAAa,GAClBvM,KAAKmiB,aAAe,GACpBniB,KAAK6sB,UAAUC,kBAAoB,EACnC9sB,KAAK6sB,UAAUE,sBAAwB,EACvC/sB,KAAK6sB,UAAUG,sBAAwB,EACvChtB,KAAKqM,uBAAoBxL,EACzBb,KAAKgP,aAAUnO,EACfb,KAAKitB,WAAWC,aAAUrsB,EAC1Bb,KAAKitB,WAAWje,aAAUnO,EAC1Bb,KAAKotB,MAAO,EACZptB,KAAKkgB,SAAU,CAChB,QClNU6O,YAUXjvB,YAAYC,GA8BJC,KAAkBgvB,mBAAG,KAC3BhvB,KAAKqmB,UAAU1pB,SAAS,EAGlBqD,KAAAivB,aAAgB7uB,IAEtBgQ,QAAQoX,IAAI,oBAAqBpnB,EAAI,EAG/BJ,KAAAkvB,gBAAmB9uB,UAEzBgQ,QAAQoX,IAAI,uBAAwBpnB,GACd,QAAtBuK,EAAA3K,KAAKmvB,yBAAiB,IAAAxkB,GAAAA,EAAEhO,QAAQ,CAAY,EAAC,EAGvCqD,KAAAovB,QAAWhvB,IAEjBgQ,QAAQoX,IAAI,uBAAwBpnB,EAAI,EAGlCJ,KAAAqvB,SAAY/D,UAElBlb,QAAQoX,IAAI,wDAAyD8D,GAChD,QAArB3gB,EAAA3K,KAAKsvB,sBAAgB,IAAA3kB,GAAAA,EAAAhO,QAAQ2uB,EAActc,SAC3ChP,KAAKsmB,aAAa5G,aAAa4L,EAActc,QAAQ,EAG/ChP,KAAAuvB,eAAkB7tB,IAExB,GAAI1B,KAAKqmB,UAAUzB,UACjB,GAAmB,MAAfljB,EAAMqiB,KACR/jB,KAAKqmB,UAAU1pB,cACV,CACL,MAAM2jB,EAAM,IAAI9iB,MAAMkE,EAAM8qB,QAC5BlM,EAAI0D,KAAOtiB,EAAMqiB,KAAKjR,WACtB9S,KAAKqmB,UAAUzpB,OAAO0jB,EACvB,CACF,EAjEDtgB,KAAK4lB,QAAU,IAAI/lB,oBAAoBE,EAAc6lB,SACrD5lB,KAAKsL,QAAU,IAAIgC,uBACnBtN,KAAK6lB,SAAW,IAAIrc,eAAezJ,EAAc+lB,WACjD9lB,KAAK+lB,WAAa,IAAIiD,aAAajpB,EAAcimB,OAAQjmB,EAAckmB,aACvEjmB,KAAKqmB,UAAY,IAAI3B,eACtB,CAEG4B,mBAEF,OAAOxH,YAAYqC,aACpB,CAEDtV,KAAK9J,EAAyBkK,GAa5B,OAXAjM,KAAK4lB,QAAQ9iB,OAAOf,GACpB/B,KAAK6lB,SAASha,KAAK9J,GACnB/B,KAAK+lB,WAAWla,KAAKI,EAAMhD,OAAQgD,EAAMhF,OAEzCjH,KAAK+lB,WAAWoD,QAAQpB,4BAA4B/nB,KAAKgvB,oBACzDhvB,KAAK+lB,WAAWoD,QAAQb,sBAAsBtoB,KAAKivB,cACnDjvB,KAAK+lB,WAAWoD,QAAQV,yBAAyBzoB,KAAKkvB,iBACtDlvB,KAAK+lB,WAAWoD,QAAQP,iBAAiB5oB,KAAKovB,SAC9CpvB,KAAK+lB,WAAWoD,QAAQN,kBAAkB7oB,KAAKqvB,UAC/CrvB,KAAK+lB,WAAWoD,QAAQhB,wBAAwBnoB,KAAKuvB,gBAE9CvvB,KAAKqmB,UAAUxB,OACvB,CA0CDpY,kBAAkBR,GAEhBjM,KAAK6lB,SAASpZ,kBAAkBR,EAAOjM,KAAKsL,QAC7C,CAEDU,UAAUC,GAERjM,KAAK6lB,SAAS7Z,UAAUC,EAAOjM,KAAKsL,QACrC,CAEKghB,WAAWrgB,oDASf,aAPMjM,KAAKqmB,UAAUxB,QACrB7kB,KAAKmvB,kBAAoB,IAAIzK,gBAC7BtU,QAAQoX,IAAI,oCAAqCvb,GACjDjM,KAAK+lB,WAAWuG,WAAWrgB,SAErBjM,KAAKmvB,kBAAkBtK,QAC7B7kB,KAAKmvB,uBAAoBtuB,EAClBoL,IACR,CAEK4V,OAAO5V,EAAeoY,0DAEpBrkB,KAAKqmB,UAAUxB,QACrB7kB,KAAKsvB,eAAiB,IAAI5K,sBACpB1kB,KAAK+lB,WAAWlE,OAAO5V,EAAOoY,GAEpC,MAAMrV,QAAyBhP,KAAKsvB,eAAezK,QAUnD,OARA5Y,EAAMwY,yBAEFxY,EAAM+C,QACRvD,OAAO4T,OAAOpT,EAAM+C,QAASA,GAE7B/C,EAAM+C,QAAUA,EAElBhP,KAAKsvB,oBAAiBzuB,EACfoL,IACR,CAEKU,OAAOV,oDAGX,aADMjM,KAAKqmB,UAAUxB,QACd7kB,KAAK+lB,WAAWpZ,OAAOV,KAC/B,CAEKwZ,wDAIJ,aAFMzlB,KAAKqmB,UAAUxB,QAEd,IAAI8H,MAAM,EAAG,KAMrB,CAEKjH,wDAIJ,aAFM1lB,KAAKqmB,UAAUxB,QAEd,IAAI8H,MAAM,EAAG,KAMrB,CAEKrF,MAAMrb,0DAEJjM,KAAKqmB,UAAUxB,QACrB,MAAMX,EAAUjY,EAAMkY,WAMtB,OALAD,EAAQoD,QAKDpD,IACR,QC1KUsL,iBAIX1vB,YAAYC,EAA+BkM,EAAewjB,GAExDzvB,KAAK0vB,yBAAyB3vB,EAAekM,EAAOwjB,EACrD,CAEDC,yBAAyB3vB,EAA+BkM,EAAewjB,GAErE,IAAIE,EAEFA,EADoC,SAAlC5vB,EAAcimB,OAAO4J,SACJ,IAAIjK,cAAc5lB,EAAekM,GAEjC,IAAI8iB,YAAYhvB,GAGrCC,KAAKyvB,UAAYhkB,OAAO4T,OAAOsQ,EAAkBF,EAClD,CAED5jB,KAAK9J,EAAyBkK,GAE5B,OAAOjM,KAAKyvB,UAAU5jB,KAAK9J,EAAYkK,EACxC,ECrBI,MAmIM4jB,EAAuC,CAClD7J,OApI8D,CAC9D4J,SAAU,YACVpO,OAAQ,QACRC,KAAM,0BACN7C,eAAgB,GAChBC,QAAS,GACTiR,mBAAmB,EACnBxG,UAAW,CACTsC,aAAa,EACbhC,UAAW,IACXL,iBAAkB,GAClB4C,eAAe,EACfC,cAAe,EACf2D,cAAe,MAwHjB9J,YApHwE,CACxEte,KAAM,OACNqoB,iBAAiB,EACjBrO,KAAM,QACNsO,QAAS,CACPC,QAAQ,GAEVrO,OAAQ,CACN,mBAAoB,IACpBlB,KAAM,CACJ,gBAAgB,EAChB4B,SAAS,EACTP,KAAM,CACJmO,OAAO,EACPld,OAAO,KAIb4S,SAAU,CACRuK,MAAO,CACL,mBAAmB,EACnB,oBAAoB,IAGxBtO,KAAM,CACJuC,UAAW,CAAC,uBACZgM,OAAQ,CACNH,QAAQ,EACR,yBAA0B,EAC1B,oBAAqB,IACrB,gBAAiB,UACjB,aAAc,OAEhBI,OAAQ,CACNC,OAAQ,GACRruB,KAAM,GACNsuB,MAAO,GACPluB,IAAK,IAEPmuB,OAAQ,CACN,mBAAmB,GAErB,YAAa,CACXC,KAAM,WAGV1O,KAAM,CACJ2O,OAAQ,CACNT,QAAQ,GAEV7L,UAAW,CAAC,cACZiM,OAAQ,CACNhuB,IAAK,GACLJ,KAAM,GACNsuB,MAAO,GACPD,OAAQ,IAEVE,OAAQ,CACN,mBAAmB,IAGvB7O,QAAS,CACPyC,UAAW,CAAC,iCACZoM,OAAQ,CACN,mBAAmB,IAGvB1O,WAAY,CACVsC,UAAW,CAAC,iCACZ4B,YAAa,CACXjE,MAAM,EACNze,OAAO,GAETktB,OAAQ,CACN,mBAAmB,KA2CvB7K,QAtCgE,CAChE3iB,gBAAiB,CACf2tB,SAAS,EACTC,SAAS,GAEXzuB,iBAAkB,EAClBO,wBAAyB,GAiCzBmjB,UA9BoE,CACpE/a,UAAW,IACXH,SAAU,IACVkmB,WAAY,CACVZ,QAAQ,EACRa,QAAS,CACPb,QAAQ,EACRc,SAAU,OAwBd5K,SAnBgE,CAChEM,cAAe,aACfK,mBAAoB,IACpBI,mBAAoB,KAiBpBlC,OAd6D,CAC7DgM,aAAc,IAcd,YAXkE,CAClE7L,aAAc,WC9HH8L,cAUXpxB,YAAYC,GAEVC,KAAKilB,OAAS3C,KAAK3N,MAAM2N,KAAKjP,UAAUwc,EAAqB5K,SAC7DjlB,KAAK4lB,QAAUtD,KAAK3N,MAAM2N,KAAKjP,UAAUwc,EAAqBjK,UAC9D5lB,KAAKimB,YAAc3D,KAAK3N,MAAM2N,KAAKjP,UAAUwc,EAAqB5J,cAClEjmB,KAAK8lB,UAAYxD,KAAK3N,MAAM2N,KAAKjP,UAAUwc,EAAqB/J,YAChE9lB,KAAKgmB,OAAS1D,KAAK3N,MAAM2N,KAAKjP,UAAUwc,EAAqB7J,SAC7DhmB,KAAKomB,SAAW9D,KAAK3N,MAAM2N,KAAKjP,UAAUwc,EAAqBzJ,WAE/DpmB,KAAKmxB,6BAA6BpxB,EACnC,CAGDqxB,UAAUC,KAAgBC,GAGxB,MAAMC,SAAYC,GAERA,GAAwB,iBAATA,IAAsBC,MAAMC,QAAQF,GAE7D,IAAKF,EAAQptB,OAAQ,OAAOmtB,EAC5B,MAAMM,EAASL,EAAQjM,QAEvB,GAAIkM,SAASF,IAAWE,SAASI,GAC/B,IAAK,MAAMha,KAAOga,EACZJ,SAASI,EAAOha,KACb0Z,EAAO1Z,IACVlM,OAAO4T,OAAOgS,EAAQ,CAAE1Z,CAACA,GAAM,CAAE,IAEnC3X,KAAKoxB,UAAUC,EAAO1Z,GAAMga,EAAOha,KAEnClM,OAAO4T,OAAOgS,EAAQ,CAAE1Z,CAACA,GAAMga,EAAOha,KAK5C,OAAO3X,KAAKoxB,UAAUC,KAAWC,EAClC,CAEDH,6BAA6BpxB,yBAE3BC,KAAKilB,OAASjlB,KAAKoxB,UAAU,CAAE,EAAEvB,EAAqB5K,OAAQllB,eAAAA,EAAeklB,QAC7EjlB,KAAK4lB,QAAU5lB,KAAKoxB,UAAU,CAAE,EAAEvB,EAAqBjK,QAAS7lB,eAAAA,EAAe6lB,SAC/E5lB,KAAKimB,YAAcjmB,KAAKoxB,UAAU,CAAE,EAAEvB,EAAqB5J,YAAalmB,eAAAA,EAAekmB,aACvFjmB,KAAK8lB,UAAY9lB,KAAKoxB,UAAU,CAAE,EAAEvB,EAAqB/J,UAAW/lB,eAAAA,EAAe+lB,WACnF9lB,KAAKgmB,OAAShmB,KAAKoxB,UAAU,CAAE,EAAEvB,EAAqB7J,OAAQjmB,eAAAA,EAAeimB,QAC7EhmB,KAAKomB,SAAWpmB,KAAKoxB,UAAU,CAAE,EAAEvB,EAAqBzJ,SAAUrmB,eAAAA,EAAeqmB,UACjFpmB,KAAK,aAAeA,KAAKoxB,UAAU,CAAE,EAAEvB,EAAqB,aAAc9vB,aAAa,EAAbA,EAAgB,cAE1FC,KAAKimB,YAAYjE,KAAKqC,WAA4C,QAAhCvZ,EAA0B,QAA1BH,EAAA5K,aAAa,EAAbA,EAAekmB,mBAAW,IAAAtb,OAAA,EAAAA,EAAEqX,YAAI,IAAAlX,OAAA,EAAAA,EAAEuZ,YAAawL,EAAqB5J,YAAYjE,KAAKqC,UACvHrkB,KAAKimB,YAAYnE,KAAKuC,WAA4C,QAAhCuN,EAA0B,QAA1B3mB,EAAAlL,aAAa,EAAbA,EAAekmB,mBAAW,IAAAhb,OAAA,EAAAA,EAAE6W,YAAI,IAAA8P,OAAA,EAAAA,EAAEvN,YAAawL,EAAqB5J,YAAYnE,KAAKuC,UACvHrkB,KAAKimB,YAAYrE,QAAQyC,WAA+C,QAAnCwN,EAA0B,QAA1BC,EAAA/xB,aAAa,EAAbA,EAAekmB,mBAAW,IAAA6L,OAAA,EAAAA,EAAElQ,eAAO,IAAAiQ,OAAA,EAAAA,EAAExN,YAAawL,EAAqB5J,YAAYrE,QAAQyC,UAChIrkB,KAAKimB,YAAYlE,WAAWsC,WAAkD,QAAtC0N,EAA0B,QAA1BC,EAAAjyB,aAAa,EAAbA,EAAekmB,mBAAW,IAAA+L,OAAA,EAAAA,EAAEjQ,kBAAU,IAAAgQ,OAAA,EAAAA,EAAE1N,YAAawL,EAAqB5J,YAAYlE,WAAWsC,WAE1H,UAAXrkB,KAAKgmB,cAAM,IAAAiM,OAAA,EAAAA,EAAEnC,qBACf9vB,KAAKgmB,OAAOxE,OAASpX,OAAO8nB,SAAStC,SAASnf,QAAQ,MAAQ,EAAI,QAAU,OAC5EzQ,KAAKgmB,OAAOvE,KAAOrX,OAAO8nB,SAASzQ,MAIV,SAAzBzhB,KAAKgmB,OAAO4J,UACoB,eAAhC5vB,KAAKomB,SAASM,gBAEd1mB,KAAKomB,SAASM,cAAgB,eAC9B1mB,KAAKomB,SAASW,mBAAqBxlB,KAAKmJ,IAAI1K,KAAKomB,SAASW,mBAAoB,KAIrD,cAAzB/mB,KAAKgmB,OAAO4J,UACc,SAA1B5vB,KAAKimB,YAAYte,KAGf3H,KAAK8lB,UAAUgL,WAAWZ,SACzBlwB,KAAKimB,YAAYjE,KAAKqC,UAAU1Y,SAAS,kCAG1C3L,KAAKimB,YAAYjE,KAAKqC,UAAUhe,KAAK,iCAIvCrG,KAAK8lB,UAAUgL,WAAWZ,QAAS,CAEtC,ECrGI,MAAMiC,EAA6B,CACxCjrB,MAAO,UACPD,MAAO,EACP,sBAAuB,EACvB,2BAA4B,OAC5B,2BAA4B,aCLjBmrB,EAAuB,CAClC5gB,IAAK,CACHtK,MAAO,UACPD,MAAO,EACP,sBAAuB,EACvB,2BAA4B,OAC5B,2BAA4B,aAE9B,QAAS,CACP,cAAe,eAEjB,eAAgB,CACd,cAAe,cACfC,MAAO,aAET,QAAS,CACP,cAAe,gBACf,YAAa,WCbJmrB,aAYXvyB,YAAY4R,EAAsBJ,GAEhCtR,KAAKsyB,wBAAwB5gB,GAC7B1R,KAAKuyB,qBAAqBjhB,EAC3B,CAXGI,eACF,OAAO1R,KAAKwyB,SACb,CACGlhB,YACF,OAAOtR,KAAKyyB,MACb,CAQDH,wBAAwB5gB,GAEtB,MAAMghB,EACDjnB,OAAA4T,OAAA5T,OAAA4T,OAAA,CAAA,EAAA8S,GACCzgB,GAAY,CAAA,GAElB1R,KAAKwyB,UAAYE,CAClB,CAEDH,qBAAqBjhB,GAEnB,MAAMqhB,EACDlnB,OAAA4T,OAAA5T,OAAA4T,OAAA,CAAA,EAAA+S,GACC9gB,GAAS,CAAA,GAEftR,KAAKyyB,OAASE,CACf,MCtBSC,GClBZ,SAASC,YAAYzhB,EAAK0hB,QACX,IAARA,IAAiBA,EAAM,CAAA,GAC5B,IAAIC,EAAWD,EAAIC,SAEnB,GAAK3hB,GAA2B,oBAAblO,SAAnB,CAEA,IAAI8vB,EAAO9vB,SAAS8vB,MAAQ9vB,SAAS+vB,qBAAqB,QAAQ,GAC9D7nB,EAAQlI,SAAS2G,cAAc,SACnCuB,EAAMzD,KAAO,WAEI,QAAborB,GACEC,EAAKE,WACPF,EAAKG,aAAa/nB,EAAO4nB,EAAKE,YAKhCF,EAAK/oB,YAAYmB,GAGfA,EAAMgoB,WACRhoB,EAAMgoB,WAAWC,QAAUjiB,EAE3BhG,EAAMnB,YAAY/G,SAASowB,eAAeliB,GAnBY,CAqB1D,+uPDPA,SAAYwhB,GAEVA,EAAA,MAAA,QACAA,EAAA,IAAA,MACAA,EAAA,OAAA,QACAA,EAAA,OAAA,QACD,CAND,CAAYA,IAAAA,EAMX,CAAA,UAOYW,OAeXzzB,YAAY0zB,EAA0BC,GAN9BzzB,KAAY0zB,cAAG,EAIvB1zB,KAAKowB,OAAG,EAINpwB,KAAK2zB,aAAeH,EACpBxzB,KAAK2zB,aAAa5pB,UAAUC,KAAIypB,eAAAA,EAASG,iBAAkB,aAE3D5zB,KAAK6zB,YAAc3wB,SAAS2G,cAAc,OAC1C7J,KAAK6zB,YAAY9pB,UAAUC,IAAI,UAC/BhK,KAAK6zB,YAAc7zB,KAAK2zB,aAAa1pB,YAAYjK,KAAK6zB,aACtD7zB,KAAK6zB,YAAYzoB,MAAM0oB,QAAU,UAEjC9zB,KAAK+zB,WAAa7wB,SAAS2G,cAAc,OACzC7J,KAAK+zB,WAAWhqB,UAAUC,IAAI,aAC9BhK,KAAK+zB,WAAa/zB,KAAK2zB,aAAa1pB,YAAYjK,KAAK+zB,YACrD/zB,KAAK+zB,WAAW3oB,MAAM0oB,QAAU,OAEhC9zB,KAAKg0B,MAAQpB,EAAWqB,IAExBj0B,KAAKk0B,cAAgB,IAAI7B,aAAaoB,aAAA,EAAAA,EAAS/hB,SAAU+hB,eAAAA,EAASniB,OAElEtR,KAAKm0B,eAAiB,IAAIjD,cAAcuC,aAAA,EAAAA,EAAS1zB,eAEjD,MAAMkH,EAAQ1F,KAAKmJ,IAAI1K,KAAK2zB,aAAa9oB,YAAa7K,KAAKD,cAAc+lB,UAAUlb,UAC7E3B,EAAS1H,KAAKmJ,IAAI1K,KAAK2zB,aAAa3oB,aAAchL,KAAKD,cAAc+lB,UAAU/a,WACrF/K,KAAKiM,MAAQ,IAAI0gB,MAAM1lB,EAAOgC,GAE9BjJ,KAAKo0B,kBAAoB,IAAI5E,iBAAiBxvB,KAAKD,cAAeC,KAAKiM,MAAOwnB,eAAAA,EAAShE,WACvFzvB,KAAKq0B,oBACN,CAEGC,kBAEF,OAAOt0B,KAAK0zB,YACb,CAEG3zB,oBAEF,OAAOC,KAAKm0B,cACb,CACGp0B,kBAAc0J,GAEhBzJ,KAAKsnB,QAELtnB,KAAKm0B,eAAehD,6BAA6B1nB,GAEjDzJ,KAAKiM,MAAMhD,OAAS1H,KAAKmJ,IAAI1K,KAAK2zB,aAAa3oB,aAAchL,KAAKm0B,eAAerO,UAAU/a,WAC3F/K,KAAKiM,MAAMhF,MAAQ1F,KAAKmJ,IAAI1K,KAAK2zB,aAAa9oB,YAAa7K,KAAKm0B,eAAerO,UAAUlb,UAEzF5K,KAAKo0B,kBAAkB1E,yBAAyB1vB,KAAKm0B,eAAgBn0B,KAAKiM,OAC1EjM,KAAKq0B,oBACN,CACG5E,gBAEF,OAAOzvB,KAAKo0B,kBAAkB3E,SAC/B,CACG7J,cAEF,OAAO5lB,KAAKo0B,kBAAkB3E,UAAU7J,OACzC,CACGtU,YAEF,OAAOtR,KAAKk0B,cAAc5iB,KAC3B,CACGI,eAEF,OAAO1R,KAAKk0B,cAAcxiB,QAC3B,CACGgf,WAEF,OAAO1wB,KAAKg0B,KACb,CACG/O,aAEF,OAAOnG,YAAYqC,aACpB,CAEOkT,qBAENr0B,KAAKo0B,kBAAkBvoB,KAAK7L,KAAK2zB,aAAc3zB,KAAKiM,OACjD3O,MAAK,IAAWjB,UAAA2D,UAAA,OAAA,GAAA,YAEfA,KAAK4lB,QAAQnlB,cAAgB,CAACL,EAAmBM,IAAkBV,KAAKu0B,YAAYn0B,EAAKM,GACzFV,KAAK4lB,QAAQ9kB,cAAgB,CAACV,EAAmBM,IAAkBV,KAAKw0B,YAAYp0B,EAAKM,GACzFV,KAAK4lB,QAAQ3kB,YAAc,CAACb,EAAmBM,IAAkBV,KAAKy0B,UAAUr0B,EAAKM,GAErFV,KAAKilB,OAAOjiB,iBAAiBtE,EAAUgB,OAAQU,GAAeJ,KAAK00B,YAAYt0B,KAC/EJ,KAAKilB,OAAOjiB,iBAAiBtE,EAAUU,MAAOY,KAAKsnB,OAGnDtnB,KAAK0zB,cAAe,EACpB1zB,KAAK2zB,aAAagB,OAAS30B,KAC3BA,KAAKilB,OAAOxF,YACd,MACCmE,OAAO3mB,IAEN+C,KAAK0zB,cAAe,EACpB1zB,KAAK40B,UAAU33B,GACf+C,KAAKilB,OAAO5E,UAAUpjB,EAAE,IAEzB43B,SAAQ,KAEP70B,KAAK6zB,YAAYzoB,MAAM0oB,QAAU,MAAM,GAE5C,CAEOc,UAAUtU,GAIhB,GAFAtgB,KAAK+zB,WAAW3oB,MAAM0oB,QAAU,UAChC9zB,KAAK+zB,WAAWe,UAAYxU,EAAI7I,QAC5BzX,KAAKowB,MAAO,CACd,MAAM2E,EAAQ7xB,SAAS2G,cAAc,KACrCkrB,EAAMC,UAAY1U,EAAI0D,KACtBhkB,KAAK+zB,WAAWkB,QAAQF,GAExB,MAAMG,EAAShyB,SAAS2G,cAAc,KACtCqrB,EAAO9pB,MAAMnE,MAAQ,OACrBiuB,EAAO9pB,MAAM+pB,WAAa,sBAC1BD,EAAOF,UAAY1U,EAAIN,OAAS,GAChChgB,KAAK+zB,WAAW9pB,YAAYirB,EAC7B,CACF,CAEOR,YAAYt0B,GAMhB,MAAMg1B,EAAch1B,EACdkgB,EAAM8U,aAAA,EAAAA,EAAa5V,OACzBxf,KAAK40B,UAAUtU,EAElB,CAEDiU,YAAYn0B,EAAmBM,WAE7B,MAAM2wB,EAAmBjxB,EAAIixB,OAE7B,IAD4BA,aAAA,EAAAA,EAAQvnB,MAAO9J,KAAK2zB,aAAa7pB,KAAuB,QAAjBa,EAAA0mB,eAAAA,EAAQtnB,iBAAS,IAAAY,OAAA,EAAAA,EAAE0qB,SAAS,cACtE,CACvB,IAAI7pB,YAAEA,GAAgBpL,EAClBJ,KAAKg0B,QAAUpB,EAAW0C,SAC5B9pB,EAAconB,EAAW0C,QAE3B,MAAMlqB,EAAmBK,OAAO4T,OAAO,CAAE,UAAEvU,EAAA9K,KAAKsR,4BAAOE,IAAKxR,KAAK0R,UACjE1R,KAAKiM,MAAMsiB,kBAAkB7tB,EAAON,EAAII,UAAWgL,EAAaJ,GAChEpL,KAAKyvB,UAAUhjB,kBAAkBzM,KAAKiM,MACvC,CACF,CAEDuoB,YAAYe,EAAoB70B,GAE9BV,KAAKiM,MAAMyiB,sBAAsBhuB,GACjCV,KAAKyvB,UAAUhjB,kBAAkBzM,KAAKiM,MACvC,CAEKwoB,UAAUc,EAAoB70B,oDAElCV,KAAKiM,MAAM0iB,iBAAiBjuB,EAAOV,KAAK0R,UACxC1R,KAAKyvB,UAAUzjB,UAAUhM,KAAKiM,OAC9B,IACMjM,KAAKyvB,UAAUnD,WACjBtsB,KAAKiM,YAAcjM,KAAKyvB,UAAUnD,WAAWtsB,KAAKiM,OAElDjM,KAAKiM,YAAcjM,KAAKyvB,UAAU5N,OAAO7hB,KAAKiM,MAIjD,CAFC,MAAOoE,GACPrQ,KAAK40B,UAAUvkB,EAChB,IACF,CAEDmlB,QAAQ9E,GAEN1wB,KAAKg0B,MAAQtD,EACT1wB,KAAKg0B,QAAUpB,EAAW0C,OAC5Bt1B,KAAK2zB,aAAa5pB,UAAUC,IAAI,YAEhC9G,SAASmgB,KAAKjY,MAAMqqB,OAAS,UAC7Bz1B,KAAK2zB,aAAa5pB,UAAU2rB,OAAO,WAEtC,CAEKjQ,wDAGJ,OADAzlB,KAAKiM,YAAcjM,KAAKyvB,UAAUhK,OAC3BzlB,KAAKiM,QACb,CAEKyZ,wDAGJ,OADA1lB,KAAKiM,YAAcjM,KAAKyvB,UAAU/J,OAC3B1lB,KAAKiM,QACb,CAEKqb,yDAGJ,OADAtnB,KAAKiM,YAAcjM,KAAKyvB,UAAUnI,MAAMtnB,KAAKiM,OACtCjM,KAAKiM,QACb,CAEKU,0DAKJ,OAHA3M,KAAKiM,MAAMhD,OAAS1H,KAAKmJ,IAAI1K,KAAK2zB,aAAa3oB,aAAchL,KAAKD,cAAc+lB,UAAU/a,WAC1F/K,KAAKiM,MAAMhF,MAAQ1F,KAAKmJ,IAAI1K,KAAK2zB,aAAa9oB,YAAa7K,KAAKD,cAAc+lB,UAAUlb,UACxF5K,KAAKiM,YAAcjM,KAAKyvB,UAAU9iB,OAAO3M,KAAKiM,OACvCjM,KAAKiM,QACb,CAEK4V,OAAOwC,oDAEX,OAAOrkB,KAAKyvB,UAAU5N,OAAO7hB,KAAKiM,MAAOoY,KAC1C,EExPI,SAAgBsR,yBAAyB51B,4DAE7C,IAA2B,UAAvBA,aAAA,EAAAA,EAAeimB,cAAQ,IAAArb,OAAA,EAAAA,EAAA6W,UAA+B,QAArB1W,EAAA/K,aAAA,EAAAA,EAAeimB,cAAM,IAAAlb,OAAA,EAAAA,EAAE2W,MAAM,CAChE,MAAMX,EAAe/gB,EAAcimB,OAEnC,aADuBvC,MAAM,GAAI3C,EAAaU,YAAcV,EAAaW,6CACzDtQ,MACjB,CACC,OAAOzU,QAAQE,OAAO,oEAEzB"}