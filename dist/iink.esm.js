function __awaiter(n,i,s,a){return new(s||(s=Promise))((function(d,c){function fulfilled(n){try{step(a.next(n))}catch(n){c(n)}}function rejected(n){try{step(a.throw(n))}catch(n){c(n)}}function step(n){n.done?d(n.value):function adopt(n){return n instanceof s?n:new s((function(i){i(n)}))}(n.value).then(fulfilled,rejected)}step((a=a.apply(n,i||[])).next())}))}var n={NOT_REACHABLE:"MyScript recognition server is not reachable. Please reload once you are connected.",WRONG_CREDENTIALS:"Application credentials are invalid. Please check or regenerate your application key and hmackey.",TOO_OLD:"Session is too old. Max Session Duration Reached.",NO_ACTIVITY:"Session closed due to no activity.",CANT_ESTABLISH:"Unable to establish a connection to the server. Check the host and your connectivity"},i={IDLE:"idle",CHANGED:"changed",IMPORTED:"imported",EXPORTED:"exported",CONVERTED:"converted",RENDERED:"rendered",LOADED:"loaded",UNDO:"undo",REDO:"redo",CLEAR:"clear",CLEARED:"cleared",IMPORT:"import",SUPPORTED_IMPORT_MIMETYPES:"supportedImportMimeTypes",EXPORT:"export",CONVERT:"convert",ERROR:"error"};class PointerEventGrabber{constructor(n){this.prevent=n=>n.preventDefault(),this.pointerDownHandler=n=>{if(0===n.button&&1===n.buttons&&(this.activePointerId=n.pointerId,this.onPointerDown)){const i=this.extractPoint(n);this.onPointerDown(n,i)}},this.pointerMoveHandler=n=>{if(null!=this.activePointerId&&this.activePointerId===n.pointerId&&this.onPointerMove){const i=this.extractPoint(n);this.onPointerMove(n,i)}},this.pointerUpHandler=n=>{if(null!=this.activePointerId&&this.activePointerId===n.pointerId&&(this.activePointerId=void 0,n.stopPropagation(),this.onPointerUp)){const i=this.extractPoint(n);this.onPointerUp(n,i)}},this.setConfiguration(n)}roundFloat(n,i){if(i>=0){const s=Math.pow(10,i);return Math.round(n/s)*s}return n}extractPoint(n){let i,s;({clientX:i,clientY:s}="changedTouches"in n?n.changedTouches[0]:n);const a=this.domElement.getBoundingClientRect();return{x:this.roundFloat(i-a.left-this.domElement.clientLeft,this.configuration.xyFloatPrecision),y:this.roundFloat(s-a.top-this.domElement.clientTop,this.configuration.xyFloatPrecision),t:this.roundFloat(Date.now(),this.configuration.timestampFloatPrecision),p:n.pressure||1}}setConfiguration(n){this.configuration=n}attach(n){this.domElement&&this.detach(),this.domElement=n,this.domElement.addEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("touchmove",this.prevent),document.documentElement.addEventListener("pointerdown",(()=>{}))}detach(){this.domElement.removeEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("touchmove",this.prevent),document.documentElement.removeEventListener("pointerdown",(()=>{}))}}const s={table:"table",shape:"shape",recognizedShape:"recognizedShape",ellipse:"ellipse",line:"line"};function phi(n){let i=(n+Math.PI)%(2*Math.PI)-Math.PI;return i<-Math.PI&&(i+=2*Math.PI),i}function drawArrowHead(n,i,s,a){const d=phi(s+Math.PI*(7/8)),c=phi(s-Math.PI*(7/8));n.save();try{n.fillStyle=n.strokeStyle,n.moveTo(i.x,i.y),n.beginPath(),n.lineTo(i.x+a*Math.cos(d),i.y+a*Math.sin(d)),n.lineTo(i.x+a*Math.cos(c),i.y+a*Math.sin(c)),n.lineTo(i.x,i.y),n.fill()}finally{n.restore()}}function drawShapeEllipse(n,i){const s=function drawEllipseArc(n,i){const{centerPoint:s,maxRadius:a,minRadius:d,orientation:c,startAngle:h,sweepAngle:l}=i;let p=Math.cos(c),u=Math.sin(c),g=p,m=u;p*=a,g*=d,u*=a,m*=d;const f=Math.floor(Math.abs(l)/.02),y=[];n.save();try{n.beginPath();for(let i=0;i<=f;i++){const c=h+i/f*l,v=Math.atan2(Math.sin(c)/d,Math.cos(c)/a),x=Math.cos(v),w=Math.sin(v),b=s.x+p*x-m*w,S=s.y+g*w+u*x;0===i?n.moveTo(b,S):n.lineTo(b,S),0!==i&&i!==f||y.push({x:b,y:S})}n.stroke()}finally{n.restore()}return y}(n,i);"ARROW_HEAD"===(null==i?void 0:i.beginDecoration)&&drawArrowHead(n,s[0],i.beginTangentAngle,12),"ARROW_HEAD"===(null==i?void 0:i.endDecoration)&&drawArrowHead(n,s[1],i.endTangentAngle,12)}function drawLine(n,i,s){n.save();try{n.beginPath(),n.moveTo(i.x,i.y),n.lineTo(s.x,s.y),n.stroke()}finally{n.restore()}}function drawShapeSymbol(n,i){n.save();try{if(n.lineWidth=i.width,n.strokeStyle=i.color,i.elementType)switch(i.elementType){case s.shape:const a=i;drawShapeSymbol(n,a.candidates[a.selectedCandidateIndex]);break;case s.table:i.lines.forEach((i=>drawShapeSymbol(n,i)));break;case s.line:const d=i;drawLine(n,d.data.p1,d.data.p2)}else switch(i.type){case s.ellipse:drawShapeEllipse(n,i);break;case s.line:!function drawShapeLine(n,i){drawLine(n,i.firstPoint,i.lastPoint),"ARROW_HEAD"===i.beginDecoration&&drawArrowHead(n,i.firstPoint,i.beginTangentAngle,12),"ARROW_HEAD"===i.endDecoration&&drawArrowHead(n,i.lastPoint,i.endTangentAngle,12)}(n,i);break;case s.recognizedShape:i.primitives.forEach((i=>drawShapeSymbol(n,i)))}}finally{n.restore()}}const a={inputCharacter:"inputCharacter",char:"char",string:"string",textLine:"textLine"};function drawTextLine(n,i){!function drawText(n,i,s){n.save();try{n.font=`${s.textHeight}px serif`,n.textAlign="CENTER"===s.justificationType?"center":"left",n.textBaseline="bottom",n.fillStyle=n.strokeStyle,n.fillText(i,s.topLeftPoint.x,s.topLeftPoint.y+s.height)}finally{n.restore()}}(n,i.label,i.data),i.underlineList.forEach((s=>{!function drawUnderline(n,i,s,a){const d=a.width/s.length;drawLine(n,{x:a.topLeftPoint.x+i.data.firstCharacter*d,y:a.topLeftPoint.y+a.height},{x:a.topLeftPoint.x+i.data.lastCharacter*d,y:a.topLeftPoint.y+a.height})}(n,s,i.label,i.data)}))}class CanvasRenderer{constructor(n){this.config=n}createCanvas(n,i){const s=document.createElement("canvas");return s.classList.add(i),s.classList.add("ms-canvas"),n.appendChild(s),s}resizeContent(){const n=window.devicePixelRatio;[this.context.renderingCanvas,this.context.capturingCanvas].forEach((i=>{var s,a,d;const c=i.parentNode,h=Math.max(null===(s=this.context)||void 0===s?void 0:s.minWidth,c.clientWidth),l=Math.max(null===(a=this.context)||void 0===a?void 0:a.minHeight,c.clientHeight);i.width=h*n,i.height=l*n,null===(d=i.getContext("2d"))||void 0===d||d.scale(n,n),i.style.width=`${h}px`,i.style.height=`${l}px`}))}drawSymbol(n,i,d){const c=i.elementType||i.type;"stroke"===c?function drawStroke(n,i,s){s&&i&&"eraser"!==i.pointerType&&s.drawStroke(n,i)}(n,i,d):Object.keys(a).includes(c)?function drawTextSymbol(n,i){n.save();try{n.lineWidth=i.width,n.strokeStyle=i.color,(i.elementType||i.type)===a.textLine&&drawTextLine(n,i)}finally{n.restore()}}(n,i):Object.keys(s).includes(c)&&drawShapeSymbol(n,i)}init(n){const i=this.createCanvas(n,"ms-rendering-canvas"),s=this.createCanvas(n,"ms-capture-canvas");this.context={minHeight:this.config.minHeight||0,minWidth:this.config.minWidth||0,renderingCanvas:i,renderingCanvasContext:i.getContext("2d"),capturingCanvas:s,capturingCanvasContext:s.getContext("2d")},this.resizeContent()}drawModel(n,i){var s;null===(s=this.context.renderingCanvasContext)||void 0===s||s.clearRect(0,0,this.context.renderingCanvas.width,this.context.renderingCanvas.height);const a=[...n.defaultSymbols];n.recognizedSymbols?(a.push(...n.recognizedSymbols),a.push(...n.extractPendingStrokes())):a.push(...n.rawStrokes),a.forEach((n=>this.drawSymbol(this.context.renderingCanvasContext,n,i))),this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),n.updatePositionRendered(a.length)}drawCurrentStroke(n,i){const s=n.currentStroke;this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),i&&s&&"eraser"!==(null==s?void 0:s.pointerType)&&i.drawStroke(this.context.capturingCanvasContext,s)}resize(n,i){this.resizeContent(),this.drawModel(n,i)}destroy(n){n.removeChild(this.context.renderingCanvas),n.removeChild(this.context.capturingCanvas)}}function computeLinksPoints(n,i,s){const a=n.p*s;return[{x:n.x-Math.sin(i)*a,y:n.y+Math.cos(i)*a},{x:n.x+Math.sin(i)*a,y:n.y-Math.cos(i)*a}]}function computeMiddlePoint(n,i){return{x:(i.x+n.x)/2,y:(i.y+n.y)/2,p:(i.p+n.p)/2,t:(i.t+n.t)/2}}function computeAxeAngle(n,i){return Math.atan2(i.y-n.y,i.x-n.x)}class QuadraticCanvasStroker{renderArc(n,i,s){n.arc(i.x,i.y,s,0,2*Math.PI,!0)}renderLine(n,i,s,a){const d=computeLinksPoints(i,computeAxeAngle(i,s),a),c=computeLinksPoints(s,computeAxeAngle(i,s),a);n.moveTo(d[0].x,d[0].y),n.lineTo(c[0].x,c[0].y),n.lineTo(c[1].x,c[1].y),n.lineTo(d[1].x,d[1].y)}renderFinal(n,i,s,a){const d=computeAxeAngle(i,s),c=computeLinksPoints(s,d,a);n.moveTo(c[0].x,c[0].y);for(let i=1;i<=6;i++){const c=d-i*Math.PI/6;n.lineTo(s.x-s.p*a*Math.sin(c),s.y+s.p*a*Math.cos(c))}}renderQuadratic(n,i,s,a,d){const c=computeLinksPoints(i,computeAxeAngle(i,a),d),h=computeLinksPoints(s,computeAxeAngle(a,s),d),l=computeLinksPoints(a,computeAxeAngle(i,s),d);n.moveTo(c[0].x,c[0].y),n.quadraticCurveTo(l[0].x,l[0].y,h[0].x,h[0].y),n.lineTo(h[1].x,h[1].y),n.quadraticCurveTo(l[1].x,l[1].y,c[1].x,c[1].y)}getPointByIndex(n,i){return{x:n.x[i]||0,y:n.y[i]||0,t:n.t[i]||0,p:n.p[i]||0}}drawStroke(n,i){const s=i.x.length,a=i.width>0?i.width:n.lineWidth,d=i.color?i.color:n.strokeStyle,c=this.getPointByIndex(i,0),h=s-2;n.save();try{if(n.beginPath(),s<3)this.renderArc(n,c,.6*a);else{this.renderArc(n,c,a*c.p);const d=computeMiddlePoint(c,this.getPointByIndex(i,1));this.renderLine(n,c,d,a);for(let s=0;s<h;s++){const d=computeMiddlePoint(this.getPointByIndex(i,s),this.getPointByIndex(i,s+1)),c=computeMiddlePoint(this.getPointByIndex(i,s+1),this.getPointByIndex(i,s+2)),h=this.getPointByIndex(i,s+1);this.renderQuadratic(n,d,c,h,a)}const l=computeMiddlePoint(this.getPointByIndex(i,s-2),this.getPointByIndex(i,s-1)),p=this.getPointByIndex(i,s-1);this.renderLine(n,l,p,a);const u=this.getPointByIndex(i,s-2),g=this.getPointByIndex(i,s-1);this.renderFinal(n,u,g,a)}n.closePath(),void 0!==d&&(n.fillStyle=d,n.fill()),n.save()}finally{n.restore()}}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function createCommonjsModule(n,i){return n(i={exports:{}},i.exports),i.exports}var d=createCommonjsModule((function(n,i){n.exports=function(n){function e(s){if(i[s])return i[s].exports;var a=i[s]={i:s,l:!1,exports:{}};return n[s].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};return e.m=n,e.c=i,e.i=function(n){return n},e.d=function(n,i,s){e.o(n,i)||Object.defineProperty(n,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(i,"a",i),i},e.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},e.p="",e(e.s=1)}([function(n,i,s){function o(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},d=function t(n){var i=this;o(this,t),this.toJSON=function(n){if("string"!=typeof n)return console.error("Need a CSS string but given ",void 0===n?"undefined":a(n),n),"Not a valid CSS..!";var s={},d=void 0,c=void 0,h=void 0;try{n.split("{").forEach((function(n){if(c=n.trim())if(-1===c.indexOf("}"))s[c]={},d=c;else{c.substring(0,c.indexOf("}")).split(";").forEach((function(n){(h=n.split(":"))&&2===h.length&&(s[d][h[0].trim().replace(/^\"|\"$/g,"")]=i._trimSemiColon(h[1].trim().replace(/^\"|\"$/g,"")))}));try{(d=c.split("}")[1].trim())&&(s[d]={})}catch(n){}}}))}catch(n){return"Not a valid CSS..!"}return s},this.toCSS=function(n){if("object"!==(void 0===n?"undefined":a(n)))return console.error("Need a JSON object but given ",void 0===n?"undefined":a(n),n),"Not a valid JSON..!";var i="";try{for(var s in n)if(n.hasOwnProperty(s)){for(var d in i+=s+" {\n",n[s])n[s].hasOwnProperty(d)&&(i+=d+": "+n[s][d]+";\n");i+="}\n"}}catch(n){return"Not a valid JSON..!"}return i},this._trimSemiColon=function(n){return";"===n.slice(-1)?n.slice(0,i.length-1):n}};i.default=d},function(n,i,s){n.exports=s(0).default}])})),c=function unwrapExports(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}(d);d.JsonCSS;const h=new c;var l={themeToCSS(n){let i=h.toCSS(n);return i=i.replace(/[\r\n]+/gm,""),i},themeToJSON(n){const i=h.toJSON(n);return i[".text"]["font-size"]=Number(i[".text"]["font-size"]),i.ink["-myscript-pen-width"]=Number(i.ink["-myscript-pen-width"]),i.ink.width=Number(i.ink.width),i},penStyleToCSS(n){let i=h.toCSS({css:n});return i=i.substring(6,i.length-3),i=i.replace(/[\r\n]+/gm,""),i},penStyleToJSON(n){const i=h.toJSON(`css {${n}}`).css;return i.width=Number(i.width),i["-myscript-pen-width"]=Number(i["-myscript-pen-width"]),i}},p=createCommonjsModule((function(n,i){var s;n.exports=(s=s||function(n,i){var s=Object.create||function(){function F(){}return function(n){var i;return F.prototype=n,i=new F,F.prototype=null,i}}(),a={},d=a.lib={},c=d.Base={extend:function(n){var i=s(this);return n&&i.mixIn(n),i.hasOwnProperty("init")&&this.init!==i.init||(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var n=this.extend();return n.init.apply(n,arguments),n},init:function(){},mixIn:function(n){for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i]);n.hasOwnProperty("toString")&&(this.toString=n.toString)},clone:function(){return this.init.prototype.extend(this)}},h=d.WordArray=c.extend({init:function(n,s){n=this.words=n||[],this.sigBytes=s!=i?s:4*n.length},toString:function(n){return(n||p).stringify(this)},concat:function(n){var i=this.words,s=n.words,a=this.sigBytes,d=n.sigBytes;if(this.clamp(),a%4)for(var c=0;c<d;c++){var h=s[c>>>2]>>>24-c%4*8&255;i[a+c>>>2]|=h<<24-(a+c)%4*8}else for(c=0;c<d;c+=4)i[a+c>>>2]=s[c>>>2];return this.sigBytes+=d,this},clamp:function(){var i=this.words,s=this.sigBytes;i[s>>>2]&=4294967295<<32-s%4*8,i.length=n.ceil(s/4)},clone:function(){var n=c.clone.call(this);return n.words=this.words.slice(0),n},random:function(i){for(var s,a=[],r=function(i){var s=987654321,a=4294967295;return function(){var d=((s=36969*(65535&s)+(s>>16)&a)<<16)+(i=18e3*(65535&i)+(i>>16)&a)&a;return d/=4294967296,(d+=.5)*(n.random()>.5?1:-1)}},d=0;d<i;d+=4){var c=r(4294967296*(s||n.random()));s=987654071*c(),a.push(4294967296*c()|0)}return new h.init(a,i)}}),l=a.enc={},p=l.Hex={stringify:function(n){for(var i=n.words,s=n.sigBytes,a=[],d=0;d<s;d++){var c=i[d>>>2]>>>24-d%4*8&255;a.push((c>>>4).toString(16)),a.push((15&c).toString(16))}return a.join("")},parse:function(n){for(var i=n.length,s=[],a=0;a<i;a+=2)s[a>>>3]|=parseInt(n.substr(a,2),16)<<24-a%8*4;return new h.init(s,i/2)}},u=l.Latin1={stringify:function(n){for(var i=n.words,s=n.sigBytes,a=[],d=0;d<s;d++){var c=i[d>>>2]>>>24-d%4*8&255;a.push(String.fromCharCode(c))}return a.join("")},parse:function(n){for(var i=n.length,s=[],a=0;a<i;a++)s[a>>>2]|=(255&n.charCodeAt(a))<<24-a%4*8;return new h.init(s,i)}},g=l.Utf8={stringify:function(n){try{return decodeURIComponent(escape(u.stringify(n)))}catch(n){throw new Error("Malformed UTF-8 data")}},parse:function(n){return u.parse(unescape(encodeURIComponent(n)))}},m=d.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(n){"string"==typeof n&&(n=g.parse(n)),this._data.concat(n),this._nDataBytes+=n.sigBytes},_process:function(i){var s=this._data,a=s.words,d=s.sigBytes,c=this.blockSize,l=d/(4*c),p=(l=i?n.ceil(l):n.max((0|l)-this._minBufferSize,0))*c,u=n.min(4*p,d);if(p){for(var g=0;g<p;g+=c)this._doProcessBlock(a,g);var m=a.splice(0,p);s.sigBytes-=u}return new h.init(m,u)},clone:function(){var n=c.clone.call(this);return n._data=this._data.clone(),n},_minBufferSize:0});d.Hasher=m.extend({cfg:c.extend(),init:function(n){this.cfg=this.cfg.extend(n),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(n){return this._append(n),this._process(),this},finalize:function(n){return n&&this._append(n),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(i,s){return new n.init(s).finalize(i)}},_createHmacHelper:function(n){return function(i,s){return new f.HMAC.init(n,s).finalize(i)}}});var f=a.algo={};return a}(Math),s)})),u=createCommonjsModule((function(n,i){n.exports=p.enc.Hex})),g=(createCommonjsModule((function(n,i){var s,a,d,c,h,l,u;n.exports=(d=(a=u=p).lib,c=d.Base,h=d.WordArray,(l=a.x64={}).Word=c.extend({init:function(n,i){this.high=n,this.low=i}}),l.WordArray=c.extend({init:function(n,i){n=this.words=n||[],this.sigBytes=i!=s?i:8*n.length},toX32:function(){for(var n=this.words,i=n.length,s=[],a=0;a<i;a++){var d=n[a];s.push(d.high),s.push(d.low)}return h.create(s,this.sigBytes)},clone:function(){for(var n=c.clone.call(this),i=n.words=this.words.slice(0),s=i.length,a=0;a<s;a++)i[a]=i[a].clone();return n}}),u)})),createCommonjsModule((function(n,i){var s;n.exports=(s=p,function(){var n=s,i=n.lib.Hasher,a=n.x64,d=a.Word,c=a.WordArray,h=n.algo;function X64Word_create(){return d.create.apply(d,arguments)}var l=[X64Word_create(1116352408,3609767458),X64Word_create(1899447441,602891725),X64Word_create(3049323471,3964484399),X64Word_create(3921009573,2173295548),X64Word_create(961987163,4081628472),X64Word_create(1508970993,3053834265),X64Word_create(2453635748,2937671579),X64Word_create(2870763221,3664609560),X64Word_create(3624381080,2734883394),X64Word_create(310598401,1164996542),X64Word_create(607225278,1323610764),X64Word_create(1426881987,3590304994),X64Word_create(1925078388,4068182383),X64Word_create(2162078206,991336113),X64Word_create(2614888103,633803317),X64Word_create(3248222580,3479774868),X64Word_create(3835390401,2666613458),X64Word_create(4022224774,944711139),X64Word_create(264347078,2341262773),X64Word_create(604807628,2007800933),X64Word_create(770255983,1495990901),X64Word_create(1249150122,1856431235),X64Word_create(1555081692,3175218132),X64Word_create(1996064986,2198950837),X64Word_create(2554220882,3999719339),X64Word_create(2821834349,766784016),X64Word_create(2952996808,2566594879),X64Word_create(3210313671,3203337956),X64Word_create(3336571891,1034457026),X64Word_create(3584528711,2466948901),X64Word_create(113926993,3758326383),X64Word_create(338241895,168717936),X64Word_create(666307205,1188179964),X64Word_create(773529912,1546045734),X64Word_create(1294757372,1522805485),X64Word_create(1396182291,2643833823),X64Word_create(1695183700,2343527390),X64Word_create(1986661051,1014477480),X64Word_create(2177026350,1206759142),X64Word_create(2456956037,344077627),X64Word_create(2730485921,1290863460),X64Word_create(2820302411,3158454273),X64Word_create(3259730800,3505952657),X64Word_create(3345764771,106217008),X64Word_create(3516065817,3606008344),X64Word_create(3600352804,1432725776),X64Word_create(4094571909,1467031594),X64Word_create(275423344,851169720),X64Word_create(430227734,3100823752),X64Word_create(506948616,1363258195),X64Word_create(659060556,3750685593),X64Word_create(883997877,3785050280),X64Word_create(958139571,3318307427),X64Word_create(1322822218,3812723403),X64Word_create(1537002063,2003034995),X64Word_create(1747873779,3602036899),X64Word_create(1955562222,1575990012),X64Word_create(2024104815,1125592928),X64Word_create(2227730452,2716904306),X64Word_create(2361852424,442776044),X64Word_create(2428436474,593698344),X64Word_create(2756734187,3733110249),X64Word_create(3204031479,2999351573),X64Word_create(3329325298,3815920427),X64Word_create(3391569614,3928383900),X64Word_create(3515267271,566280711),X64Word_create(3940187606,3454069534),X64Word_create(4118630271,4000239992),X64Word_create(116418474,1914138554),X64Word_create(174292421,2731055270),X64Word_create(289380356,3203993006),X64Word_create(460393269,320620315),X64Word_create(685471733,587496836),X64Word_create(852142971,1086792851),X64Word_create(1017036298,365543100),X64Word_create(1126000580,2618297676),X64Word_create(1288033470,3409855158),X64Word_create(1501505948,4234509866),X64Word_create(1607167915,987167468),X64Word_create(1816402316,1246189591)],p=[];!function(){for(var n=0;n<80;n++)p[n]=X64Word_create()}();var u=h.SHA512=i.extend({_doReset:function(){this._hash=new c.init([new d.init(1779033703,4089235720),new d.init(3144134277,2227873595),new d.init(1013904242,4271175723),new d.init(2773480762,1595750129),new d.init(1359893119,2917565137),new d.init(2600822924,725511199),new d.init(528734635,4215389547),new d.init(1541459225,327033209)])},_doProcessBlock:function(n,i){for(var s=this._hash.words,a=s[0],d=s[1],c=s[2],h=s[3],u=s[4],g=s[5],m=s[6],f=s[7],y=a.high,v=a.low,x=d.high,w=d.low,b=c.high,S=c.low,M=h.high,_=h.low,C=u.high,E=u.low,T=g.high,k=g.low,L=m.high,A=m.low,P=f.high,D=f.low,N=y,O=v,R=x,I=w,z=b,W=S,H=M,X=_,j=C,B=E,U=T,J=k,G=L,Y=A,Q=P,V=D,Z=0;Z<80;Z++){var K=p[Z];if(Z<16)var q=K.high=0|n[i+2*Z],$=K.low=0|n[i+2*Z+1];else{var ee=p[Z-15],te=ee.high,ne=ee.low,ie=(te>>>1|ne<<31)^(te>>>8|ne<<24)^te>>>7,re=(ne>>>1|te<<31)^(ne>>>8|te<<24)^(ne>>>7|te<<25),oe=p[Z-2],se=oe.high,ae=oe.low,de=(se>>>19|ae<<13)^(se<<3|ae>>>29)^se>>>6,ce=(ae>>>19|se<<13)^(ae<<3|se>>>29)^(ae>>>6|se<<26),he=p[Z-7],le=he.high,pe=he.low,ue=p[Z-16],ge=ue.high,me=ue.low;q=(q=(q=ie+le+(($=re+pe)>>>0<re>>>0?1:0))+de+(($+=ce)>>>0<ce>>>0?1:0))+ge+(($+=me)>>>0<me>>>0?1:0),K.high=q,K.low=$}var fe,ye=j&U^~j&G,ve=B&J^~B&Y,xe=N&R^N&z^R&z,we=O&I^O&W^I&W,be=(N>>>28|O<<4)^(N<<30|O>>>2)^(N<<25|O>>>7),Se=(O>>>28|N<<4)^(O<<30|N>>>2)^(O<<25|N>>>7),Me=(j>>>14|B<<18)^(j>>>18|B<<14)^(j<<23|B>>>9),_e=(B>>>14|j<<18)^(B>>>18|j<<14)^(B<<23|j>>>9),Ce=l[Z],Ee=Ce.high,Te=Ce.low,ke=Q+Me+((fe=V+_e)>>>0<V>>>0?1:0),Le=Se+we;Q=G,V=Y,G=U,Y=J,U=j,J=B,j=H+(ke=(ke=(ke=ke+ye+((fe+=ve)>>>0<ve>>>0?1:0))+Ee+((fe+=Te)>>>0<Te>>>0?1:0))+q+((fe+=$)>>>0<$>>>0?1:0))+((B=X+fe|0)>>>0<X>>>0?1:0)|0,H=z,X=W,z=R,W=I,R=N,I=O,N=ke+(be+xe+(Le>>>0<Se>>>0?1:0))+((O=fe+Le|0)>>>0<fe>>>0?1:0)|0}v=a.low=v+O,a.high=y+N+(v>>>0<O>>>0?1:0),w=d.low=w+I,d.high=x+R+(w>>>0<I>>>0?1:0),S=c.low=S+W,c.high=b+z+(S>>>0<W>>>0?1:0),_=h.low=_+X,h.high=M+H+(_>>>0<X>>>0?1:0),E=u.low=E+B,u.high=C+j+(E>>>0<B>>>0?1:0),k=g.low=k+J,g.high=T+U+(k>>>0<J>>>0?1:0),A=m.low=A+Y,m.high=L+G+(A>>>0<Y>>>0?1:0),D=f.low=D+V,f.high=P+Q+(D>>>0<V>>>0?1:0)},_doFinalize:function(){var n=this._data,i=n.words,s=8*this._nDataBytes,a=8*n.sigBytes;return i[a>>>5]|=128<<24-a%32,i[30+(a+128>>>10<<5)]=Math.floor(s/4294967296),i[31+(a+128>>>10<<5)]=s,n.sigBytes=4*i.length,this._process(),this._hash.toX32()},clone:function(){var n=i.clone.call(this);return n._hash=this._hash.clone(),n},blockSize:32});n.SHA512=i._createHelper(u),n.HmacSHA512=i._createHmacHelper(u)}(),s.SHA512)})),createCommonjsModule((function(n,i){var s,a,d;n.exports=(a=(s=p).lib.Base,d=s.enc.Utf8,void(s.algo.HMAC=a.extend({init:function(n,i){n=this._hasher=new n.init,"string"==typeof i&&(i=d.parse(i));var s=n.blockSize,a=4*s;i.sigBytes>a&&(i=n.finalize(i)),i.clamp();for(var c=this._oKey=i.clone(),h=this._iKey=i.clone(),l=c.words,p=h.words,u=0;u<s;u++)l[u]^=1549556828,p[u]^=909522486;c.sigBytes=h.sigBytes=a,this.reset()},reset:function(){var n=this._hasher;n.reset(),n.update(this._iKey)},update:function(n){return this._hasher.update(n),this},finalize:function(n){var i=this._hasher,s=i.finalize(n);return i.reset(),i.finalize(this._oKey.clone().concat(s))}})))})),createCommonjsModule((function(n,i){n.exports=p.HmacSHA512})));class EventHelper extends EventTarget{constructor(){super()}static getInstance(){return EventHelper.instance||(EventHelper.instance=new EventHelper),EventHelper.instance}emit(n,i){this.dispatchEvent(new CustomEvent(n,Object.assign({bubbles:!0,composed:!0},i?{detail:i}:void 0)))}emitLoaded(){this.emit(i.LOADED)}emitExported(n){this.emit(i.EXPORTED,n)}emitChange(n){this.emit(i.CHANGED,{canUndo:n.canUndo,canRedo:n.canRedo,canClear:!n.stack[n.stackIndex].isEmpty,stackIndex:n.stackIndex,stackLength:n.stack.length,isEmpty:n.stack[n.stackIndex].isEmpty})}emitIdle(n){this.emit(i.IDLE,n)}emitError(n){this.emit(i.ERROR,n)}emitClear(n){this.emit(i.CLEAR,n)}emitCleared(n){this.emit(i.CLEARED,n)}emitConvert(){this.emit(i.CONVERT)}emitImport(n,s){this.emit(i.IMPORT,{jiix:n,mimeType:s})}}class AbstractRecognizer{constructor(n,i){this.serverConfiguration=n,this.recognitionConfiguration=i,this.eventHelper=EventHelper.getInstance()}}class RestRecognizer extends AbstractRecognizer{constructor(n,i){super(n,i)}get url(){return`${this.serverConfiguration.scheme}://${this.serverConfiguration.host}/api/v4.0/iink/batch`}get postConfig(){switch(this.recognitionConfiguration.type){case"DIAGRAM":return{lang:this.recognitionConfiguration.lang,diagram:this.recognitionConfiguration.diagram,export:this.recognitionConfiguration.export};case"MATH":return{lang:this.recognitionConfiguration.lang,math:this.recognitionConfiguration.math,export:this.recognitionConfiguration.export};case"Raw Content":return{lang:this.recognitionConfiguration.lang,"raw-content":this.recognitionConfiguration.rawContent,export:this.recognitionConfiguration.export};case"TEXT":return{lang:this.recognitionConfiguration.lang,text:this.recognitionConfiguration.text,export:this.recognitionConfiguration.export};default:throw new Error(`get postConfig error Recognition type unkow "${this.recognitionConfiguration.type}"`)}}buildData(n){const i=[];n.strokeGroups.forEach((n=>{const s={penStyle:"{}"===JSON.stringify(n.penStyle)?void 0:l.penStyleToCSS(n.penStyle),strokes:n.strokes.map((n=>({x:n.x,y:n.y,t:n.t,p:n.p,pointerType:n.pointerType})))};i.push(s)}));const s="Raw Content"===this.recognitionConfiguration.type?"Raw Content":this.recognitionConfiguration.type.charAt(0).toUpperCase()+this.recognitionConfiguration.type.slice(1).toLowerCase();return{configuration:this.postConfig,xDPI:96,yDPI:96,contentType:s,height:n.height,width:n.width,strokeGroups:i}}post(n,i){return __awaiter(this,void 0,void 0,(function*(){const s=new Headers;s.append("Accept","application/json,"+i),s.append("applicationKey",this.serverConfiguration.applicationKey),s.append("hmac",function computeHmac(n,i,s){return new g(n,i+s).toString(u)}(JSON.stringify(n),this.serverConfiguration.applicationKey,this.serverConfiguration.hmacKey)),s.append("Content-Type","application/json");const a={method:"POST",headers:s,body:JSON.stringify(n)},d=new Request(this.url,a),c=yield fetch(d);if(c.ok){let n;switch(c.headers.get("content-type")){case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"image/png":case"image/jpeg":n=yield c.blob();break;case"application/json":n=yield c.json();break;case"application/vnd.myscript.jiix":n=yield c.clone().json().catch((()=>__awaiter(this,void 0,void 0,(function*(){return yield c.text()}))));break;default:n=yield c.text()}return n}throw yield c.json()}))}callPostMessage(n,i){return __awaiter(this,void 0,void 0,(function*(){const s=this.buildData(n);return n.updatePositionSent(),this.post(s,i).then((s=>(this.handleSuccess(n,s,i),n))).catch((n=>(this.handleError(n),n)))}))}handleSuccess(n,i,s){n.updatePositionReceived(),n.rawResults.exports=i;const a={};a[s]=i,n.exports?Object.assign(n.exports,a):n.exports=a}handleError(i){let s=i.message;i.code||(s=n.CANT_ESTABLISH);const a=new Error(s);throw a.name=i.code||"",this.eventHelper.emitError(a),a}export(n,i){return __awaiter(this,void 0,void 0,(function*(){if(n.isEmpty)return Promise.resolve(n);n.idle=!1;let s=i||[];if(!s.length)switch(this.recognitionConfiguration.type){case"DIAGRAM":s=this.recognitionConfiguration.diagram.mimeTypes;break;case"MATH":s=this.recognitionConfiguration.math.mimeTypes;break;case"Raw Content":s=this.recognitionConfiguration.rawContent.mimeTypes;break;case"TEXT":s=this.recognitionConfiguration.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.recognitionConfiguration.type}" is unknown.\n Possible types are:\n -DIAGRAM\n -MATH\n -Raw Content\n -TEXT`)}if(!s.length)return Promise.reject(new Error("Export failed, no mimeTypes define in recognition configuration"));const a=s.filter((i=>!n.exports||!n.exports[i]));return yield Promise.all(a.map((i=>this.callPostMessage(n,i)))),n.idle=!0,this.eventHelper.emitIdle(n),n}))}resize(n){return __awaiter(this,void 0,void 0,(function*(){return this.export(n)}))}}class RestBehaviors{constructor(n){this.grabber=new PointerEventGrabber(n.grabber),this.stroker=new QuadraticCanvasStroker,this.renderer=new CanvasRenderer(n.rendering),this.recognizer=new RestRecognizer(n.server,n.recognition)}init(n){return this.grabber.attach(n),this.renderer.init(n),Promise.resolve(!0)}export(n,i){return this.recognizer.export(n,i)}}class BehaviorsManager{constructor(n,i){this.overrideDefaultBehaviors(n,i)}overrideDefaultBehaviors(n,i){const s=new RestBehaviors(n);this.behaviors=Object.assign(s,i)}init(n){return this.behaviors.init(n)}}const m={server:{protocol:"WEBSOCKET",scheme:"https",host:"cloud.myscript.com",applicationKey:"",hmacKey:"",useWindowLocation:!1,websocket:{pingEnabled:!0,pingDelay:3e4,maxPingLostCount:10,autoReconnect:!0,maxRetryCount:2,fileChunkSize:3e5}},recognition:{type:"TEXT",alwaysConnected:!0,lang:"en_US",gesture:{enable:!0},export:{"image-resolution":300,jiix:{"bounding-box":!1,strokes:!1,text:{chars:!1,words:!0}}},renderer:{debug:{"draw-text-boxes":!1,"draw-image-boxes":!1}},math:{mimeTypes:["application/x-latex"],solver:{enable:!0,"fractional-part-digits":3,"decimal-separator":".","rounding-mode":"half up","angle-unit":"deg"},margin:{bottom:10,left:15,right:15,top:10},eraser:{"erase-precisely":!1},"undo-redo":{mode:"stroke"}},text:{guides:{enable:!0},mimeTypes:["text/plain"],margin:{top:20,left:10,right:10,bottom:10},eraser:{"erase-precisely":!1}},diagram:{mimeTypes:["application/vnd.myscript.jiix"],eraser:{"erase-precisely":!1}},rawContent:{mimeTypes:["application/vnd.myscript.jiix"],recognition:{text:!0,shape:!1},eraser:{"erase-precisely":!1}}},grabber:{listenerOptions:{capture:!1,passive:!0},xyFloatPrecision:0,timestampFloatPrecision:0},rendering:{minHeight:100,minWidth:100,smartGuide:{enable:!1,fadeOut:{enable:!1,duration:1e4}}},triggers:{exportContent:"POINTER_UP",exportContentDelay:1e3,resizeTriggerDelay:100},events:{processDelay:10},"undo-redo":{maxStackSize:10}};class Configuration{constructor(n){this.events=JSON.parse(JSON.stringify(m.events)),this.grabber=JSON.parse(JSON.stringify(m.grabber)),this.recognition=JSON.parse(JSON.stringify(m.recognition)),this.rendering=JSON.parse(JSON.stringify(m.rendering)),this.server=JSON.parse(JSON.stringify(m.server)),this.triggers=JSON.parse(JSON.stringify(m.triggers)),this.overrideDefaultConfiguration(n)}mergeDeep(n,...i){const isObject=n=>n&&"object"==typeof n&&!Array.isArray(n);if(!i.length)return n;const s=i.shift();if(isObject(n)&&isObject(s))for(const i in s)isObject(s[i])?(n[i]||Object.assign(n,{[i]:{}}),this.mergeDeep(n[i],s[i])):Object.assign(n,{[i]:s[i]});return this.mergeDeep(n,...i)}overrideDefaultConfiguration(n){var i,s,a,d,c,h,l,p,u;this.events=this.mergeDeep({},m.events,null==n?void 0:n.events),this.grabber=this.mergeDeep({},m.grabber,null==n?void 0:n.grabber),this.recognition=this.mergeDeep({},m.recognition,null==n?void 0:n.recognition),this.rendering=this.mergeDeep({},m.rendering,null==n?void 0:n.rendering),this.server=this.mergeDeep({},m.server,null==n?void 0:n.server),this.triggers=this.mergeDeep({},m.triggers,null==n?void 0:n.triggers),this["undo-redo"]=this.mergeDeep({},m["undo-redo"],null==n?void 0:n["undo-redo"]),this.recognition.text.mimeTypes=(null===(s=null===(i=null==n?void 0:n.recognition)||void 0===i?void 0:i.text)||void 0===s?void 0:s.mimeTypes)||m.recognition.text.mimeTypes,this.recognition.math.mimeTypes=(null===(d=null===(a=null==n?void 0:n.recognition)||void 0===a?void 0:a.math)||void 0===d?void 0:d.mimeTypes)||m.recognition.math.mimeTypes,this.recognition.diagram.mimeTypes=(null===(h=null===(c=null==n?void 0:n.recognition)||void 0===c?void 0:c.diagram)||void 0===h?void 0:h.mimeTypes)||m.recognition.diagram.mimeTypes,this.recognition.rawContent.mimeTypes=(null===(p=null===(l=null==n?void 0:n.recognition)||void 0===l?void 0:l.rawContent)||void 0===p?void 0:p.mimeTypes)||m.recognition.rawContent.mimeTypes,(null===(u=this.server)||void 0===u?void 0:u.useWindowLocation)&&(this.server.scheme=window.location.protocol.indexOf("s")>-1?"https":"http",this.server.host=window.location.host),"REST"===this.server.protocol&&"POINTER_UP"===this.triggers.exportContent&&(this.triggers.exportContent="QUIET_PERIOD",this.triggers.exportContentDelay=Math.max(this.triggers.exportContentDelay,50)),"WEBSOCKET"===this.server.protocol&&"TEXT"===this.recognition.type?this.rendering.smartGuide.enable&&!this.recognition.text.mimeTypes.includes("application/vnd.myscript.jiix")&&this.recognition.text.mimeTypes.push("application/vnd.myscript.jiix"):this.rendering.smartGuide.enable=!1}}class Stroke{constructor(n,i,s="pen"){this.type="stroke",this.pointerId=i,this.pointerType=s,this.x=[],this.y=[],this.t=[],this.p=[],this.l=[],this.color=n.color,this.width=n.width,this["-myscript-pen-width"]=n["-myscript-pen-width"],this["-myscript-pen-fill-style"]=n["-myscript-pen-fill-style"],this["-myscript-pen-fill-color"]=n["-myscript-pen-fill-color"]}}class Model{constructor(n,i,s=(new Date).getTime()){this.rawStrokes=[],this.strokeGroups=[],this.positions={lastSentPosition:-1,lastReceivedPosition:-1,lastRenderedPosition:-1},this.defaultSymbols=[],this.rawResults={convert:void 0,exports:void 0},this.creationTime=s,this.modificationDate=s,this.width=n,this.height=i,this.idle=!0,this.isEmpty=!0}computeDistance(n,i){const s=Math.sqrt(Math.pow(n.y-i.y,2)+Math.pow(n.x-i.x,2));return isNaN(s)?0:s}computeLength(n,i,s){const a=s+this.computeDistance(n,i);return isNaN(a)?0:a}computePressure(n,i,s){let a=1;const d=this.computeDistance(n,i),c=this.computeLength(n,i,s);0===c?a=.5:d===c?a=1:d<10?a=.2+Math.pow(.1*d,.4):d>c-10&&(a=.2+Math.pow(.1*(c-d),.4));const h=a*Math.max(.1,1-.1*Math.sqrt(d));return isNaN(h)?.5:Math.round(100*h)/100}filterPointByAcquisitionDelta(n,i){const s=2+n["-myscript-pen-width"]/4;return 0===n.x.length||0===n.y.length||Math.abs(n.x[n.x.length-1]-i.x)>=s||Math.abs(n.y[n.y.length-1]-i.y)>=s}addPoint(n,i){if(this.filterPointByAcquisitionDelta(n,i)){const s={x:n.x[n.x.length-1],y:n.y[n.y.length-1],p:n.p[n.p.length-1],t:n.t[n.t.length-1]},a=n.l[n.l.length-1];n.x.push(i.x),n.y.push(i.y),n.t.push(i.t),n.p.push(this.computePressure(i,s,a)),n.l.push(this.computeLength(i,s,a))}}addStroke(n){this.rawStrokes.push(n)}extractPendingStrokes(n){return n=n||this.positions.lastReceivedPosition+1,this.rawStrokes.slice(n)}addStrokeToGroup(n,i){const s=this.strokeGroups.length-1;if(this.strokeGroups[s]&&(a=this.strokeGroups[s].penStyle,d=i,a["-myscript-pen-fill-color"]===d["-myscript-pen-fill-color"]&&a["-myscript-pen-fill-style"]===d["-myscript-pen-fill-style"]&&a["-myscript-pen-width"]===d["-myscript-pen-width"]&&a.color===d.color&&a.width===d.width))this.strokeGroups[s].strokes.push(n);else{const s={penStyle:i,strokes:[n]};this.strokeGroups.push(s)}var a,d;this.isEmpty=!1}initCurrentStroke(n,i,s,a,d=96){if(a["-myscript-pen-width"]){const n=a["-myscript-pen-width"]*d/25.4;a.width=n/2}this.modificationDate=(new Date).getTime(),this.exports=void 0,this.currentStroke=new Stroke(a,i,s),this.addPoint(this.currentStroke,n)}appendToCurrentStroke(n){this.currentStroke&&this.addPoint(this.currentStroke,n)}endCurrentStroke(n,i){this.currentStroke&&(this.addPoint(this.currentStroke,n),this.addStroke(this.currentStroke),this.addStrokeToGroup(this.currentStroke,i),this.currentStroke=void 0)}updatePositionSent(n=this.rawStrokes.length-1){this.positions.lastSentPosition=n}updatePositionReceived(){this.positions.lastReceivedPosition=this.positions.lastSentPosition}updatePositionRendered(n=(this.recognizedSymbols?this.recognizedSymbols.length-1:-1)){this.positions.lastRenderedPosition=n}resetPositionRenderer(){this.positions.lastRenderedPosition=-1}resetPositions(){this.positions.lastSentPosition=-1,this.positions.lastReceivedPosition=-1}getClone(){const n=new Model(this.width,this.height,this.creationTime);return n.modificationDate=JSON.parse(JSON.stringify(this.modificationDate)),n.defaultSymbols=JSON.parse(JSON.stringify(this.defaultSymbols)),n.currentStroke=this.currentStroke?JSON.parse(JSON.stringify(this.currentStroke)):void 0,n.rawStrokes=JSON.parse(JSON.stringify(this.rawStrokes)),n.strokeGroups=JSON.parse(JSON.stringify(this.strokeGroups)),n.positions=JSON.parse(JSON.stringify(this.positions)),n.exports=this.exports?JSON.parse(JSON.stringify(this.exports)):void 0,n.rawResults.convert=this.rawResults.convert?JSON.parse(JSON.stringify(this.rawResults.convert)):void 0,n.rawResults.exports=this.rawResults.exports?JSON.parse(JSON.stringify(this.rawResults.exports)):void 0,n.recognizedSymbols=this.recognizedSymbols?JSON.parse(JSON.stringify(this.recognizedSymbols)):void 0,n.idle=this.idle,n.isEmpty=this.isEmpty,n}clear(){this.modificationDate=(new Date).getTime(),this.currentStroke=void 0,this.rawStrokes=[],this.strokeGroups=[],this.positions.lastSentPosition=-1,this.positions.lastReceivedPosition=-1,this.positions.lastRenderedPosition=-1,this.recognizedSymbols=void 0,this.exports=void 0,this.rawResults.convert=void 0,this.rawResults.exports=void 0,this.idle=!0,this.isEmpty=!0}}const f={color:"#000000",width:0,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},y={ink:{color:"#000000",width:1,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},".math":{"font-family":"STIXGeneral"},".math-solved":{"font-family":"STIXGeneral",color:"#A8A8A8FF"},".text":{"font-family":"MyScriptInter","font-size":10}};class StyleManager{constructor(n,i){this.overrideDefaultPenStyle(n),this.overrideDefaultTheme(i)}get penStyle(){return this._penStyle}get theme(){return this._theme}overrideDefaultPenStyle(n){const i=Object.assign(Object.assign({},f),n||{});this._penStyle=i}overrideDefaultTheme(n){const i=Object.assign(Object.assign({},y),n||{});this._theme=i}}class UndoRedoContext{constructor(n){this.stackIndex=0,this.stack=[n.getClone()],this.canRedo=!1,this.canUndo=!1}}class UndoRedoManager{constructor(n,i){this.configuration=n,this.context=new UndoRedoContext(i)}get events(){return EventHelper.getInstance()}updateCanUndoRedo(){this.context.canRedo=this.context.stack.length-1>this.context.stackIndex,this.context.canUndo=this.context.stackIndex>0}addModelToStack(n){this.context.stackIndex+1<this.context.stack.length&&this.context.stack.splice(this.context.stackIndex+1),this.context.stackIndex++,this.context.stack.push(n.getClone()),this.context.stack.length>this.configuration.maxStackSize&&(this.context.stack.shift(),this.context.stackIndex--),this.updateCanUndoRedo(),this.events.emitChange(this.context)}updateModelInStack(n){const i=this.context.stack.findIndex((i=>i.modificationDate===n.modificationDate));i>-1&&this.context.stack.splice(i,1,n.getClone())}undo(){return this.context.canUndo&&(this.context.stackIndex--,this.updateCanUndoRedo(),this.events.emitChange(this.context)),this.context.stack[this.context.stackIndex].getClone()}redo(){return this.context.canRedo&&(this.context.stackIndex++,this.updateCanUndoRedo(),this.events.emitChange(this.context)),this.context.stack[this.context.stackIndex].getClone()}reset(n){this.context=new UndoRedoContext(n),this.events.emitChange(this.context)}}var v;!function styleInject(n,i){void 0===i&&(i={});var s=i.insertAt;if(n&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css","top"===s&&a.firstChild?a.insertBefore(d,a.firstChild):a.appendChild(d),d.styleSheet?d.styleSheet.cssText=n:d.appendChild(document.createTextNode(n))}}("/* @import url(../node_modules/perfect-scrollbar/css/perfect-scrollbar.css); */\n\n.ms-editor {\n    position: relative;\n    z-index: 20;\n    color: #1A9FFF;\n    font-family: sans-serif;\n}\n\n.ms-editor.erasing {\n    cursor: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEsSURBVDiNrdO7SgNBFMbx/3fmCbQ1tunDIayFBvFSKxbxBfSdBPEBtLIWb3Ebl4R9AQWLkE70CWbHZl1Eg2iSr5vL+c1hhhFTMhwOdyX1gQ2gVU+PgTyldNHtdq+/1+jroCiKtpmdSupNO6ApkgZmdtzpdJ5+QGVZ9qqqugSWfkO+5F3SnrvnDVQURTuE8PgP5DNvkjJ3fzaAEMLJDAjAclVVZwCqL/ZqBqSJme2YpMN5EIAYY9+A9XkhST0DVuaFgJYtAAGoDJgsAJoYkM+rSHqwlNL5Ajq6EMBoNLoBtmbsZuDumwYQYzwCXmdw3oAjAAPIsuxF0kG98GdE0r67PzcQgLvnIYQ14P4PyF39WZuH0rRdZVluxxj7kjaA1Xp6nFLKzezc3W+/13wAItdV6XjME1AAAAAASUVORK5CYII=') 10 10, auto;\n}\n\n.ms-editor canvas,\n.ms-editor svg {\n    z-index: 15;\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 100%;\n}\n\n.ms-editor canvas.ms-rendering-canvas {\n    z-index: 10;\n    pointer-events: none;\n    background-image: linear-gradient(to right, #F5F6F7 1px, transparent 1px),\n    linear-gradient(to bottom, #F5F6F7 1px, transparent 1px);\n    background-size: 18px 18px;\n}\n\n.ms-editor svg {\n    z-index: 10;\n    pointer-events: none;\n}\n.ms-editor svg[data-layer=\"BACKGROUND\"] {\n    z-index: 9;\n}\n\n.ms-editor .loader {\n    z-index: 30;\n    position: absolute;\n    width: 120px;\n    height: 120px;\n    top: calc(50% - 60px);\n    left: calc(50% - 60px);\n    border: 16px solid #F5F6F7;\n    border-radius: 50%;\n    border-top-color: #1A9FFF;\n    -webkit-animation: spin 2s linear infinite;\n    animation: spin 2s linear infinite;\n}\n\n.ms-editor .error-msg {\n    z-index: 25;\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    top: calc(50% - 100px);\n    left: calc(50% - 100px);\n    font-size: 16px;\n    text-align: center;\n    word-wrap: break-word;\n}\n\n.ms-editor .error-msg::before {\n    content: url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCA3Ni41IDYxMiA0NTkiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPgogICAgPHBhdGggZmlsbD0iIzFBOUZGRiIgZD0iTTQ5NC43LDIyOS41Yy0xNy44NTEtODYuNy05NC4zNTEtMTUzLTE4OC43LTE1M2MtMzguMjUsMC03My45NSwxMC4yLTEwMiwzMC42bDM4LjI1LDM4LjI1IGMxNy44NS0xMi43NSw0MC44LTE3Ljg1LDYzLjc1LTE3Ljg1Yzc2LjUsMCwxNDAuMjUsNjMuNzUsMTQwLjI1LDE0MC4yNXYxMi43NWgzOC4yNWM0My4zNSwwLDc2LjUsMzMuMTUsNzYuNSw3Ni41IGMwLDI4LjA1LTE1LjMsNTMuNTUtNDAuOCw2Ni4zbDM4LjI1LDM4LjI1QzU5MS42LDQzOC42LDYxMiw0MDAuMzUsNjEyLDM1N0M2MTIsMjkwLjcsNTU4LjQ1LDIzNC42LDQ5NC43LDIyOS41eiBNNzYuNSwxMDkuNjUgbDcxLjQsNjguODVDNjYuMywxODMuNiwwLDI0OS45LDAsMzMxLjVjMCw4NC4xNSw2OC44NSwxNTMsMTUzLDE1M2gyOTguMzVsNTEsNTFsMzMuMTUtMzMuMTVMMTA5LjY1LDc2LjVMNzYuNSwxMDkuNjV6IE0xOTYuMzUsMjI5LjVsMjA0LDIwNEgxNTNjLTU2LjEsMC0xMDItNDUuOS0xMDItMTAyYzAtNTYuMSw0NS45LTEwMiwxMDItMTAySDE5Ni4zNXoiIC8+Cjwvc3ZnPgo=);\n}\n\n.ms-editor .smartguide {\n    position: absolute;\n    z-index: 40;\n    font-size: 16px;\n}\n\n.ms-editor .smartguide.smartguide-in {\n    visibility: visible !important;\n    transition: opacity 0.5s;\n    opacity: 1;\n}\n\n.ms-editor .smartguide.smartguide-out {\n    transition: opacity 1s, visibility 1s;\n    visibility: hidden !important;\n    opacity: 0;\n}\n\n.ms-editor .smartguide .tag-icon {\n    padding: 0 18px;\n    border: 1px solid #959DA6;\n    font-weight: bold;\n    font-size: large;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 48px;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n}\n\n.ms-editor .smartguide .ellipsis {\n    cursor: pointer;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 38px;\n    padding: 0 8px;\n    font-weight: bold;\n    font-size: x-large;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .ellipsis:active {\n    background-color: #e0e0e0;\n}\n\n.ms-editor .smartguide .prompter-text-container {\n    background-color: rgba(255, 255, 255, 0.9);\n    height: 48px;\n    line-height: 48px;\n    overflow: hidden;\n    white-space: nowrap;\n    display: block;\n    text-align: left;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 30;\n    color: #bfbfbf;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .prompter-text-container > div > span {\n    cursor: pointer;\n    display: inline-block;\n}\n\n.ms-editor .smartguide .prompter-text-container .prompter-text {\n    margin-left: 12px;\n}\n\n.ms-editor .smartguide .prompter-text-container .prompter-text .added-word {\n    animation: 0.1s linear word-added,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .prompter-text-container .prompter-text .modified-word {\n    animation: 0.1s linear word-modified,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .candidates {\n    color: black;\n    flex-direction: column;\n    text-align: center;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    box-shadow: 2px 2px 12px #BDBDBD, -2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n    z-index: 100;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .candidates > span {\n    cursor: pointer;\n    padding: 2px 20px;\n}\n\n.ms-editor .smartguide .candidates > span:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .candidates > span:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .candidates .selected-word {\n    font-weight: bold;\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .more-menu {\n    flex-direction: column;\n    margin-right: 12px;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    z-index: 100;\n    box-shadow: 2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button {\n    color: black;\n    font-size: 16px;\n    cursor: pointer;\n    box-sizing: border-box;\n    background: transparent;\n    border: none;\n    padding: 0 24px;\n    margin: 0;\n    height: 40px;\n    outline: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .ps__rail-x {\n    top: 32px !important;\n}\n\n/** Stroke **/\n\n.ms-editor .removed-stroke {\n    opacity: 0;\n    transition: opacity 0.1s ease-in-out;\n}\n\n.ms-editor .added-stroke {\n    animation: 0.2s opacity-appear;\n}\n\n@keyframes color-input {\n    0% {\n        color: black;\n    }\n    100% {\n        color: #bfbfbf;\n    }\n}\n\n@keyframes word-added {\n    0% {\n        transform: translate(5px, 0);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes word-modified {\n    0% {\n        transform: translate(0, 5px);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes opacity-appear {\n    0% {\n        opacity: 0;\n    }\n    100% {\n        opacity : 1;\n    }\n}\n\n@keyframes spin {\n    0% {\n        transform: rotate(0deg);\n    }\n    100% {\n        transform: rotate(360deg);\n    }\n}\n\n@-webkit-keyframes spin {\n    0% {\n        -webkit-transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n    }\n}\n"),function(n){n.Mouse="mouse",n.Pen="pen",n.Touche="touch",n.Eraser="eraser"}(v||(v={}));class Editor{constructor(n,s){this._initialized=!1,this.debug=!1,this._wrapperHTML=n,this._wrapperHTML.classList.add((null==s?void 0:s.globalClassCss)||"ms-editor"),this._loaderHTML=document.createElement("div"),this._loaderHTML.classList.add("loader"),this._loaderHTML=this._wrapperHTML.appendChild(this._loaderHTML),this._loaderHTML.style.display="initial",this._errorHTML=document.createElement("div"),this._errorHTML.classList.add("error-msg"),this._errorHTML=this._wrapperHTML.appendChild(this._errorHTML),this._errorHTML.style.display="none",this._mode=v.Pen,this.model=new Model(this._wrapperHTML.clientWidth,this._wrapperHTML.clientHeight),this._styleManager=new StyleManager(null==s?void 0:s.penStyle,null==s?void 0:s.theme),this._configuration=new Configuration(null==s?void 0:s.configuration),this._undoRedoManager=new UndoRedoManager(this.configuration["undo-redo"],this.model.getClone()),this._behaviorsManager=new BehaviorsManager(this.configuration,null==s?void 0:s.behaviors),this._behaviorsManager.init(this._wrapperHTML).then((()=>__awaiter(this,void 0,void 0,(function*(){this.grabber.onPointerDown=(n,i)=>this.pointerDown(n,i),this.grabber.onPointerMove=(n,i)=>this.pointerMove(n,i),this.grabber.onPointerUp=(n,i)=>this.pointerUp(n,i),this.events.addEventListener(i.ERROR,(n=>this.handleError(n))),this.events.addEventListener(i.CLEAR,this.clear),this.events.addEventListener(i.IMPORT,this.import),this._initialized=!0,this._wrapperHTML.editor=this})))).catch((n=>{this.showError(n),this.events.emitError(n)})).finally((()=>{this._loaderHTML.style.display="none",this.events.emitLoaded()}))}get initialized(){return this._initialized}get configuration(){return this._configuration}set configuration(n){this.clear(),this._configuration.overrideDefaultConfiguration(n),this._undoRedoManager=new UndoRedoManager(this.configuration["undo-redo"],this.model.getClone()),this._behaviorsManager.overrideDefaultBehaviors(this._configuration),this._behaviorsManager.init(this._wrapperHTML).then((()=>__awaiter(this,void 0,void 0,(function*(){this.grabber.onPointerDown=(n,i)=>this.pointerDown(n,i),this.grabber.onPointerMove=(n,i)=>this.pointerMove(n,i),this.grabber.onPointerUp=(n,i)=>this.pointerUp(n,i),this.events.addEventListener(i.ERROR,(n=>this.handleError(n))),this.events.addEventListener(i.CLEAR,this.clear),this.events.addEventListener(i.IMPORT,this.import),this._initialized=!0,this._wrapperHTML.editor=this})))).catch((n=>{this.showError(n),this.events.emitError(n)})).finally((()=>{this._loaderHTML.style.display="none",this.events.emitLoaded()}))}get grabber(){return this._behaviorsManager.behaviors.grabber}get stroker(){return this._behaviorsManager.behaviors.stroker}get renderer(){return this._behaviorsManager.behaviors.renderer}get theme(){return this._styleManager.theme}get penStyle(){return this._styleManager.penStyle}get mode(){return this._mode}get events(){return EventHelper.getInstance()}get recognizer(){return this._behaviorsManager.behaviors.recognizer}showError(n){if(this._errorHTML.style.display="initial",this._errorHTML.innerText=n.message,this.debug){const i=document.createElement("p");i.innerHTML=n.name,this._errorHTML.prepend(i);const s=document.createElement("p");s.style.width="50vw",s.style.marginLeft="calc(-25vw + 100px)",s.innerHTML=n.stack||"",this._errorHTML.appendChild(s)}}handleError(n){const i=n,s=null==i?void 0:i.detail;this.showError(s)}pointerDown(n,i){var s,a;const d=n.target;if((null==d?void 0:d.id)===this._wrapperHTML.id||(null===(s=null==d?void 0:d.classList)||void 0===s?void 0:s.contains("ms-canvas"))){let{pointerType:s}=n;this._mode===v.Eraser&&(s=v.Eraser);const d=Object.assign({},null===(a=this.theme)||void 0===a?void 0:a.ink,this.penStyle);this.model.initCurrentStroke(i,n.pointerId,s,d),this.renderer.drawCurrentStroke(this.model,this.stroker)}}pointerMove(n,i){this.model.appendToCurrentStroke(i),this.renderer.drawCurrentStroke(this.model,this.stroker)}pointerUp(n,i){if(this.model.endCurrentStroke(i,this.penStyle),this._undoRedoManager.addModelToStack(this.model),this.renderer.drawModel(this.model,this.stroker),"DEMAND"!==this.configuration.triggers.exportContent){const n=this.configuration.triggers.exportContentDelay;clearTimeout(this._exportTimer);const i=this.model.getClone();this._exportTimer=setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){try{yield this.recognizer.export(i),this._undoRedoManager.updateModelInStack(i),this.model.modificationDate===i.modificationDate&&(this.model.exports=i.exports),this.events.emitExported(i.exports)}catch(n){this.showError(n)}}))),n)}}setMode(n){this._mode=n,this._mode===v.Eraser?this._wrapperHTML.classList.add("erasing"):(document.body.style.cursor="initial",this._wrapperHTML.classList.remove("erasing"))}clear(){this.model.clear(),this._undoRedoManager.addModelToStack(this.model),this.renderer.drawModel(this.model,this.stroker),this.events.emitExported(this.model.exports),this.events.emitCleared(this.model)}undo(){return __awaiter(this,void 0,void 0,(function*(){return this.model=this._undoRedoManager.undo(),this.renderer.drawModel(this.model,this.stroker),yield this.recognizer.export(this.model),this._undoRedoManager.updateModelInStack(this.model),this.events.emitExported(this.model.exports),this.model}))}redo(){return __awaiter(this,void 0,void 0,(function*(){return this.model=this._undoRedoManager.redo(),this.renderer.drawModel(this.model,this.stroker),yield this.recognizer.export(this.model),this._undoRedoManager.updateModelInStack(this.model),this.events.emitExported(this.model.exports),this.model}))}resize(){this.model.width=this._wrapperHTML.clientWidth,this.model.height=this._wrapperHTML.clientHeight,this.renderer.resize(this.model,this.stroker),this.model.strokeGroups.length&&(window.clearTimeout(this._resizeTimer),this._resizeTimer=setTimeout((()=>{this.recognizer.resize(this.model)}),this.configuration.triggers.resizeTriggerDelay))}export(n){return __awaiter(this,void 0,void 0,(function*(){return this.recognizer.export(this.model,n)}))}import(n){if(this.recognizer.import){const i=n;if(null==i?void 0:i.detail){const n=i.detail.jiix,s=i.detail.mimeType;this.recognizer.import(n,s)}}}}function getAvailableLanguageList(n){var i,s;return __awaiter(this,void 0,void 0,(function*(){if((null===(i=null==n?void 0:n.server)||void 0===i?void 0:i.scheme)&&(null===(s=null==n?void 0:n.server)||void 0===s?void 0:s.host)){const i=n.server;return(yield fetch(`${i.scheme}://${i.host}/api/v4.0/iink/availableLanguageList`)).json()}return Promise.reject("Cannot get languages ! Please check your server configuration!")}))}export{Editor,getAvailableLanguageList};
//# sourceMappingURL=iink.esm.js.map
