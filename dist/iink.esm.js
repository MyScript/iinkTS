import{randomUUID as i}from"crypto";function __awaiter(i,n,s,a){return new(s||(s=Promise))((function(l,d){function fulfilled(i){try{step(a.next(i))}catch(i){d(i)}}function rejected(i){try{step(a.throw(i))}catch(i){d(i)}}function step(i){i.done?l(i.value):function adopt(i){return i instanceof s?i:new s((function(n){n(i)}))}(i.value).then(fulfilled,rejected)}step((a=a.apply(i,n||[])).next())}))}function __classPrivateFieldGet(i,n,s,a){if("a"===s&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?i!==n||!a:!n.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?a:"a"===s?a.call(i):a?a.value:n.get(i)}function __classPrivateFieldSet(i,n,s,a,l){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!l)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?i!==n||!l:!n.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?l.call(i,s):l?l.value=s:n.set(i,s),s}const n="Application credentials are invalid. Please check or regenerate your application key and hmackey.",s="An unknown error has occurred.",a="MyScript recognition server is not reachable. Please reload once you are connected.",l="Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.",d="MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.",c="MyScript recognition server terminated the connection due to a protocol error.",h="MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)",p="MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).",u="MyScript recognition server terminated the connection because it received a message that violates its policy.",v="MyScript recognition server terminated the connection because a data frame was received that is too large.",g="MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.",m="MyScript recognition server terminated the connection because it is restarting.",_="MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.",f="MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.",y="MyScript recognition server connection was closed due to a failure to perform a TLS handshake",P="idle",w="changed",x="imported",S="exported",b="converted",k="loaded",G="clear",M="cleared",C="import",E="convert",T="notif",L="error",A="ws_part_change",I="ws_content_change",W="ws_svg_patch",D="ws_exported",N="ws_error",z="ws_initialized",R="ws_connected",j="connection_active",O="ws_disconnected",H="CLOSE_RECOGNIZER",B="application/vnd.myscript.jiix";class PointerEventGrabber{constructor(i){this.prevent=i=>i.preventDefault(),this.pointerDownHandler=i=>{if(0===i.button&&1===i.buttons&&(this.activePointerId=i.pointerId,this.onPointerDown)){const n=this.extractPoint(i);this.onPointerDown(i,n)}},this.pointerMoveHandler=i=>{if(null!=this.activePointerId&&this.activePointerId===i.pointerId&&this.onPointerMove){const n=this.extractPoint(i);this.onPointerMove(i,n)}},this.pointerUpHandler=i=>{if(null!=this.activePointerId&&this.activePointerId===i.pointerId&&(this.activePointerId=void 0,i.stopPropagation(),this.onPointerUp)){const n=this.extractPoint(i);this.onPointerUp(i,n)}},this.setConfiguration(i)}roundFloat(i,n){if(n>=0){const s=Math.pow(10,n);return Math.round(i/s)*s}return i}extractPoint(i){let n,s;({clientX:n,clientY:s}="changedTouches"in i?i.changedTouches[0]:i);const a=this.domElement.getBoundingClientRect();return{x:this.roundFloat(n-a.left-this.domElement.clientLeft,this.configuration.xyFloatPrecision),y:this.roundFloat(s-a.top-this.domElement.clientTop,this.configuration.xyFloatPrecision),t:this.roundFloat(Date.now(),this.configuration.timestampFloatPrecision),p:i.pressure||1}}setConfiguration(i){this.configuration=i}attach(i){this.domElement&&this.detach(),this.domElement=i,this.domElement.addEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("touchmove",this.prevent),document.documentElement.addEventListener("pointerdown",(()=>{}))}detach(){var i,n,s,a,l,d,c;null===(i=this.domElement)||void 0===i||i.removeEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),null===(n=this.domElement)||void 0===n||n.removeEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),null===(s=this.domElement)||void 0===s||s.removeEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),null===(a=this.domElement)||void 0===a||a.removeEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),null===(l=this.domElement)||void 0===l||l.removeEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),null===(d=this.domElement)||void 0===d||d.removeEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),null===(c=this.domElement)||void 0===c||c.removeEventListener("touchmove",this.prevent),document.documentElement.removeEventListener("pointerdown",(()=>{}))}}const X={table:"table",shape:"shape",recognizedShape:"recognizedShape",ellipse:"ellipse",line:"line"};function phi(i){let n=(i+Math.PI)%(2*Math.PI)-Math.PI;return n<-Math.PI&&(n+=2*Math.PI),n}function drawArrowHead(i,n,s,a){const l=phi(s+Math.PI*(7/8)),d=phi(s-Math.PI*(7/8));i.save();try{i.fillStyle=i.strokeStyle,i.moveTo(n.x,n.y),i.beginPath(),i.lineTo(n.x+a*Math.cos(l),n.y+a*Math.sin(l)),i.lineTo(n.x+a*Math.cos(d),n.y+a*Math.sin(d)),i.lineTo(n.x,n.y),i.fill()}finally{i.restore()}}function drawShapeEllipse(i,n){const s=function drawEllipseArc(i,n){const{centerPoint:s,maxRadius:a,minRadius:l,orientation:d,startAngle:c,sweepAngle:h}=n;let p=Math.cos(d),u=Math.sin(d),v=p,g=u;p*=a,v*=l,u*=a,g*=l;const m=Math.floor(Math.abs(h)/.02),_=[];i.save();try{i.beginPath();for(let n=0;n<=m;n++){const d=c+n/m*h,f=Math.atan2(Math.sin(d)/l,Math.cos(d)/a),y=Math.cos(f),P=Math.sin(f),w=s.x+p*y-g*P,x=s.y+v*P+u*y;0===n?i.moveTo(w,x):i.lineTo(w,x),0!==n&&n!==m||_.push({x:w,y:x})}i.stroke()}finally{i.restore()}return _}(i,n);"ARROW_HEAD"===(null==n?void 0:n.beginDecoration)&&drawArrowHead(i,s[0],n.beginTangentAngle,12),"ARROW_HEAD"===(null==n?void 0:n.endDecoration)&&drawArrowHead(i,s[1],n.endTangentAngle,12)}function drawLine(i,n,s){i.save();try{i.beginPath(),i.moveTo(n.x,n.y),i.lineTo(s.x,s.y),i.stroke()}finally{i.restore()}}function drawShapeSymbol(i,n){i.save();try{if(i.lineWidth=n.width,i.strokeStyle=n.color,n.elementType)switch(n.elementType){case X.shape:const s=n;drawShapeSymbol(i,s.candidates[s.selectedCandidateIndex]);break;case X.table:n.lines.forEach((n=>drawShapeSymbol(i,n)));break;case X.line:const a=n;drawLine(i,a.data.p1,a.data.p2)}else switch(n.type){case X.ellipse:drawShapeEllipse(i,n);break;case X.line:!function drawShapeLine(i,n){drawLine(i,n.firstPoint,n.lastPoint),"ARROW_HEAD"===n.beginDecoration&&drawArrowHead(i,n.firstPoint,n.beginTangentAngle,12),"ARROW_HEAD"===n.endDecoration&&drawArrowHead(i,n.lastPoint,n.endTangentAngle,12)}(i,n);break;case X.recognizedShape:n.primitives.forEach((n=>drawShapeSymbol(i,n)))}}finally{i.restore()}}const $={inputCharacter:"inputCharacter",char:"char",string:"string",textLine:"textLine"};function drawTextLine(i,n){!function drawText(i,n,s){i.save();try{i.font=`${s.textHeight}px serif`,i.textAlign="CENTER"===s.justificationType?"center":"left",i.textBaseline="bottom",i.fillStyle=i.strokeStyle,i.fillText(n,s.topLeftPoint.x,s.topLeftPoint.y+s.height)}finally{i.restore()}}(i,n.label,n.data),n.underlineList.forEach((s=>{!function drawUnderline(i,n,s,a){const l=a.width/s.length;drawLine(i,{x:a.topLeftPoint.x+n.data.firstCharacter*l,y:a.topLeftPoint.y+a.height},{x:a.topLeftPoint.x+n.data.lastCharacter*l,y:a.topLeftPoint.y+a.height})}(i,s,n.label,n.data)}))}function computeLinksPoints(i,n,s){const a=i.p*s;return[{x:i.x-Math.sin(n)*a,y:i.y+Math.cos(n)*a},{x:i.x+Math.sin(n)*a,y:i.y-Math.cos(n)*a}]}function computeMiddlePoint(i,n){return{x:(n.x+i.x)/2,y:(n.y+i.y)/2,p:(n.p+i.p)/2,t:(n.t+i.t)/2}}function computeAxeAngle(i,n){return Math.atan2(n.y-i.y,n.x-i.x)}class CanvasQuadraticStroker{renderArc(i,n,s){i.arc(n.x,n.y,s,0,2*Math.PI,!0)}renderLine(i,n,s,a){const l=computeLinksPoints(n,computeAxeAngle(n,s),a),d=computeLinksPoints(s,computeAxeAngle(n,s),a);i.moveTo(l[0].x,l[0].y),i.lineTo(d[0].x,d[0].y),i.lineTo(d[1].x,d[1].y),i.lineTo(l[1].x,l[1].y)}renderFinal(i,n,s,a){const l=computeAxeAngle(n,s),d=computeLinksPoints(s,l,a);i.moveTo(d[0].x,d[0].y);for(let n=1;n<=6;n++){const d=l-n*Math.PI/6;i.lineTo(s.x-s.p*a*Math.sin(d),s.y+s.p*a*Math.cos(d))}}renderQuadratic(i,n,s,a,l){const d=computeLinksPoints(n,computeAxeAngle(n,a),l),c=computeLinksPoints(s,computeAxeAngle(a,s),l),h=computeLinksPoints(a,computeAxeAngle(n,s),l);i.moveTo(d[0].x,d[0].y),i.quadraticCurveTo(h[0].x,h[0].y,c[0].x,c[0].y),i.lineTo(c[1].x,c[1].y),i.quadraticCurveTo(h[1].x,h[1].y,d[1].x,d[1].y)}getPointByIndex(i,n){return{x:i.x[n]||0,y:i.y[n]||0,t:i.t[n]||0,p:i.p[n]||0}}drawStroke(i,n){const s=n.x.length,a=n.width>0?n.width:i.lineWidth,l=n.color?n.color:i.strokeStyle,d=this.getPointByIndex(n,0),c=s-2;i.save();try{if(i.beginPath(),s<3)this.renderArc(i,d,.6*a);else{this.renderArc(i,d,a*d.p);const l=computeMiddlePoint(d,this.getPointByIndex(n,1));this.renderLine(i,d,l,a);for(let s=0;s<c;s++){const l=computeMiddlePoint(this.getPointByIndex(n,s),this.getPointByIndex(n,s+1)),d=computeMiddlePoint(this.getPointByIndex(n,s+1),this.getPointByIndex(n,s+2)),c=this.getPointByIndex(n,s+1);this.renderQuadratic(i,l,d,c,a)}const h=computeMiddlePoint(this.getPointByIndex(n,s-2),this.getPointByIndex(n,s-1)),p=this.getPointByIndex(n,s-1);this.renderLine(i,h,p,a);const u=this.getPointByIndex(n,s-2),v=this.getPointByIndex(n,s-1);this.renderFinal(i,u,v,a)}i.closePath(),void 0!==l&&(i.fillStyle=l,i.fill()),i.save()}finally{i.restore()}}}class CanvasRenderer{constructor(i){this.config=i,this.stroker=new CanvasQuadraticStroker}createCanvas(i,n){const s=document.createElement("canvas");return s.id=n,s.classList.add(n),s.classList.add("ms-canvas"),i.appendChild(s),s}resizeContent(){const i=window.devicePixelRatio;[this.context.renderingCanvas,this.context.capturingCanvas].forEach((n=>{var s;const a=n.parentNode,l=Math.max(this.config.minWidth,a.clientWidth),d=Math.max(this.config.minHeight,a.clientHeight);n.width=l*i,n.height=d*i,null===(s=n.getContext("2d"))||void 0===s||s.scale(i,i),n.style.width=`${l}px`,n.style.height=`${d}px`}))}drawSymbol(i,n){const s=n.elementType||n.type;"stroke"===s?function drawStroke(i,n,s){s&&n&&"eraser"!==n.pointerType&&s.drawStroke(i,n)}(i,n,this.stroker):Object.keys($).includes(s)?function drawTextSymbol(i,n){i.save();try{i.lineWidth=n.width,i.strokeStyle=n.color,(n.elementType||n.type)===$.textLine&&drawTextLine(i,n)}finally{i.restore()}}(i,n):Object.keys(X).includes(s)&&drawShapeSymbol(i,n)}init(i){const n=this.createCanvas(i,"ms-rendering-canvas"),s=this.createCanvas(i,"ms-capture-canvas");this.context={parent:i,renderingCanvas:n,renderingCanvasContext:n.getContext("2d"),capturingCanvas:s,capturingCanvasContext:s.getContext("2d")},this.resizeContent()}drawModel(i){var n;null===(n=this.context.renderingCanvasContext)||void 0===n||n.clearRect(0,0,this.context.renderingCanvas.width,this.context.renderingCanvas.height);const s=[...i.defaultSymbols,...i.rawStrokes];s.forEach((i=>this.drawSymbol(this.context.renderingCanvasContext,i))),this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),i.updatePositionRendered(s.length)}drawPendingStroke(i){this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),i&&"eraser"!==(null==i?void 0:i.pointerType)&&this.stroker.drawStroke(this.context.capturingCanvasContext,i)}resize(i){this.resizeContent(),this.drawModel(i)}destroy(){this.context.parent&&(this.context.parent.innerHTML="")}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function createCommonjsModule(i,n){return i(n={exports:{}},n.exports),n.exports}var U=createCommonjsModule((function(i,n){i.exports=function(i){function e(s){if(n[s])return n[s].exports;var a=n[s]={i:s,l:!1,exports:{}};return i[s].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=i,e.c=n,e.i=function(i){return i},e.d=function(i,n,s){e.o(i,n)||Object.defineProperty(i,n,{configurable:!1,enumerable:!0,get:s})},e.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(n,"a",n),n},e.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},e.p="",e(e.s=1)}([function(i,n,s){function o(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},l=function t(i){var n=this;o(this,t),this.toJSON=function(i){if("string"!=typeof i)return console.error("Need a CSS string but given ",void 0===i?"undefined":a(i),i),"Not a valid CSS..!";var s={},l=void 0,d=void 0,c=void 0;try{i.split("{").forEach((function(i){if(d=i.trim())if(-1===d.indexOf("}"))s[d]={},l=d;else{d.substring(0,d.indexOf("}")).split(";").forEach((function(i){(c=i.split(":"))&&2===c.length&&(s[l][c[0].trim().replace(/^\"|\"$/g,"")]=n._trimSemiColon(c[1].trim().replace(/^\"|\"$/g,"")))}));try{(l=d.split("}")[1].trim())&&(s[l]={})}catch(i){}}}))}catch(i){return"Not a valid CSS..!"}return s},this.toCSS=function(i){if("object"!==(void 0===i?"undefined":a(i)))return console.error("Need a JSON object but given ",void 0===i?"undefined":a(i),i),"Not a valid JSON..!";var n="";try{for(var s in i)if(i.hasOwnProperty(s)){for(var l in n+=s+" {\n",i[s])i[s].hasOwnProperty(l)&&(n+=l+": "+i[s][l]+";\n");n+="}\n"}}catch(i){return"Not a valid JSON..!"}return n},this._trimSemiColon=function(i){return";"===i.slice(-1)?i.slice(0,n.length-1):i}};n.default=l},function(i,n,s){i.exports=s(0).default}])})),J=function unwrapExports(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}(U);U.JsonCSS;const V=new J;var Z,q,Q,Y,K,ee,te,ie,ne,se,re,oe,ae,le,de,ce,he,pe,ue,ve,ge,me,_e,fe,ye,Pe,we,xe,Se,be,Fe,ke={themeToCSS(i){let n=V.toCSS(i);return n=n.replace(/[\r\n]+/gm,""),n},themeToJSON(i){const n=V.toJSON(i);return n[".text"]["font-size"]=Number(n[".text"]["font-size"]),n.ink["-myscript-pen-width"]=Number(n.ink["-myscript-pen-width"]),n.ink.width=Number(n.ink.width),n},penStyleToCSS(i){let n=V.toCSS({css:i});return n=n.substring(6,n.length-3),n=n.replace(/[\r\n]+/gm,""),n},penStyleToJSON(i){const n=V.toJSON(`css {${i}}`).css;return n.width=Number(n.width),n["-myscript-pen-width"]=Number(n["-myscript-pen-width"]),n}},Ge=createCommonjsModule((function(i,n){var s;i.exports=(s=s||function(i,n){var s=Object.create||function(){function F(){}return function(i){var n;return F.prototype=i,n=new F,F.prototype=null,n}}(),a={},l=a.lib={},d=l.Base={extend:function(i){var n=s(this);return i&&n.mixIn(i),n.hasOwnProperty("init")&&this.init!==n.init||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var n in i)i.hasOwnProperty(n)&&(this[n]=i[n]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}},c=l.WordArray=d.extend({init:function(i,s){i=this.words=i||[],this.sigBytes=s!=n?s:4*i.length},toString:function(i){return(i||p).stringify(this)},concat:function(i){var n=this.words,s=i.words,a=this.sigBytes,l=i.sigBytes;if(this.clamp(),a%4)for(var d=0;d<l;d++){var c=s[d>>>2]>>>24-d%4*8&255;n[a+d>>>2]|=c<<24-(a+d)%4*8}else for(d=0;d<l;d+=4)n[a+d>>>2]=s[d>>>2];return this.sigBytes+=l,this},clamp:function(){var n=this.words,s=this.sigBytes;n[s>>>2]&=4294967295<<32-s%4*8,n.length=i.ceil(s/4)},clone:function(){var i=d.clone.call(this);return i.words=this.words.slice(0),i},random:function(n){for(var s,a=[],r=function(n){var s=987654321,a=4294967295;return function(){var l=((s=36969*(65535&s)+(s>>16)&a)<<16)+(n=18e3*(65535&n)+(n>>16)&a)&a;return l/=4294967296,(l+=.5)*(i.random()>.5?1:-1)}},l=0;l<n;l+=4){var d=r(4294967296*(s||i.random()));s=987654071*d(),a.push(4294967296*d()|0)}return new c.init(a,n)}}),h=a.enc={},p=h.Hex={stringify:function(i){for(var n=i.words,s=i.sigBytes,a=[],l=0;l<s;l++){var d=n[l>>>2]>>>24-l%4*8&255;a.push((d>>>4).toString(16)),a.push((15&d).toString(16))}return a.join("")},parse:function(i){for(var n=i.length,s=[],a=0;a<n;a+=2)s[a>>>3]|=parseInt(i.substr(a,2),16)<<24-a%8*4;return new c.init(s,n/2)}},u=h.Latin1={stringify:function(i){for(var n=i.words,s=i.sigBytes,a=[],l=0;l<s;l++){var d=n[l>>>2]>>>24-l%4*8&255;a.push(String.fromCharCode(d))}return a.join("")},parse:function(i){for(var n=i.length,s=[],a=0;a<n;a++)s[a>>>2]|=(255&i.charCodeAt(a))<<24-a%4*8;return new c.init(s,n)}},v=h.Utf8={stringify:function(i){try{return decodeURIComponent(escape(u.stringify(i)))}catch(i){throw new Error("Malformed UTF-8 data")}},parse:function(i){return u.parse(unescape(encodeURIComponent(i)))}},g=l.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(i){"string"==typeof i&&(i=v.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(n){var s=this._data,a=s.words,l=s.sigBytes,d=this.blockSize,h=l/(4*d),p=(h=n?i.ceil(h):i.max((0|h)-this._minBufferSize,0))*d,u=i.min(4*p,l);if(p){for(var v=0;v<p;v+=d)this._doProcessBlock(a,v);var g=a.splice(0,p);s.sigBytes-=u}return new c.init(g,u)},clone:function(){var i=d.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0});l.Hasher=g.extend({cfg:d.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){return i&&this._append(i),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(n,s){return new i.init(s).finalize(n)}},_createHmacHelper:function(i){return function(n,s){return new m.HMAC.init(i,s).finalize(n)}}});var m=a.algo={};return a}(Math),s)})),Me=createCommonjsModule((function(i,n){i.exports=Ge.enc.Hex})),Ce=(createCommonjsModule((function(i,n){var s,a,l,d,c,h,p;i.exports=(l=(a=p=Ge).lib,d=l.Base,c=l.WordArray,(h=a.x64={}).Word=d.extend({init:function(i,n){this.high=i,this.low=n}}),h.WordArray=d.extend({init:function(i,n){i=this.words=i||[],this.sigBytes=n!=s?n:8*i.length},toX32:function(){for(var i=this.words,n=i.length,s=[],a=0;a<n;a++){var l=i[a];s.push(l.high),s.push(l.low)}return c.create(s,this.sigBytes)},clone:function(){for(var i=d.clone.call(this),n=i.words=this.words.slice(0),s=n.length,a=0;a<s;a++)n[a]=n[a].clone();return i}}),p)})),createCommonjsModule((function(i,n){var s;i.exports=(s=Ge,function(){var i=s,n=i.lib.Hasher,a=i.x64,l=a.Word,d=a.WordArray,c=i.algo;function X64Word_create(){return l.create.apply(l,arguments)}var h=[X64Word_create(1116352408,3609767458),X64Word_create(1899447441,602891725),X64Word_create(3049323471,3964484399),X64Word_create(3921009573,2173295548),X64Word_create(961987163,4081628472),X64Word_create(1508970993,3053834265),X64Word_create(2453635748,2937671579),X64Word_create(2870763221,3664609560),X64Word_create(3624381080,2734883394),X64Word_create(310598401,1164996542),X64Word_create(607225278,1323610764),X64Word_create(1426881987,3590304994),X64Word_create(1925078388,4068182383),X64Word_create(2162078206,991336113),X64Word_create(2614888103,633803317),X64Word_create(3248222580,3479774868),X64Word_create(3835390401,2666613458),X64Word_create(4022224774,944711139),X64Word_create(264347078,2341262773),X64Word_create(604807628,2007800933),X64Word_create(770255983,1495990901),X64Word_create(1249150122,1856431235),X64Word_create(1555081692,3175218132),X64Word_create(1996064986,2198950837),X64Word_create(2554220882,3999719339),X64Word_create(2821834349,766784016),X64Word_create(2952996808,2566594879),X64Word_create(3210313671,3203337956),X64Word_create(3336571891,1034457026),X64Word_create(3584528711,2466948901),X64Word_create(113926993,3758326383),X64Word_create(338241895,168717936),X64Word_create(666307205,1188179964),X64Word_create(773529912,1546045734),X64Word_create(1294757372,1522805485),X64Word_create(1396182291,2643833823),X64Word_create(1695183700,2343527390),X64Word_create(1986661051,1014477480),X64Word_create(2177026350,1206759142),X64Word_create(2456956037,344077627),X64Word_create(2730485921,1290863460),X64Word_create(2820302411,3158454273),X64Word_create(3259730800,3505952657),X64Word_create(3345764771,106217008),X64Word_create(3516065817,3606008344),X64Word_create(3600352804,1432725776),X64Word_create(4094571909,1467031594),X64Word_create(275423344,851169720),X64Word_create(430227734,3100823752),X64Word_create(506948616,1363258195),X64Word_create(659060556,3750685593),X64Word_create(883997877,3785050280),X64Word_create(958139571,3318307427),X64Word_create(1322822218,3812723403),X64Word_create(1537002063,2003034995),X64Word_create(1747873779,3602036899),X64Word_create(1955562222,1575990012),X64Word_create(2024104815,1125592928),X64Word_create(2227730452,2716904306),X64Word_create(2361852424,442776044),X64Word_create(2428436474,593698344),X64Word_create(2756734187,3733110249),X64Word_create(3204031479,2999351573),X64Word_create(3329325298,3815920427),X64Word_create(3391569614,3928383900),X64Word_create(3515267271,566280711),X64Word_create(3940187606,3454069534),X64Word_create(4118630271,4000239992),X64Word_create(116418474,1914138554),X64Word_create(174292421,2731055270),X64Word_create(289380356,3203993006),X64Word_create(460393269,320620315),X64Word_create(685471733,587496836),X64Word_create(852142971,1086792851),X64Word_create(1017036298,365543100),X64Word_create(1126000580,2618297676),X64Word_create(1288033470,3409855158),X64Word_create(1501505948,4234509866),X64Word_create(1607167915,987167468),X64Word_create(1816402316,1246189591)],p=[];!function(){for(var i=0;i<80;i++)p[i]=X64Word_create()}();var u=c.SHA512=n.extend({_doReset:function(){this._hash=new d.init([new l.init(1779033703,4089235720),new l.init(3144134277,2227873595),new l.init(1013904242,4271175723),new l.init(2773480762,1595750129),new l.init(1359893119,2917565137),new l.init(2600822924,725511199),new l.init(528734635,4215389547),new l.init(1541459225,327033209)])},_doProcessBlock:function(i,n){for(var s=this._hash.words,a=s[0],l=s[1],d=s[2],c=s[3],u=s[4],v=s[5],g=s[6],m=s[7],_=a.high,f=a.low,y=l.high,P=l.low,w=d.high,x=d.low,S=c.high,b=c.low,k=u.high,G=u.low,M=v.high,C=v.low,E=g.high,T=g.low,L=m.high,A=m.low,I=_,W=f,D=y,N=P,z=w,R=x,j=S,O=b,H=k,B=G,X=M,$=C,U=E,J=T,V=L,Z=A,q=0;q<80;q++){var Q=p[q];if(q<16)var Y=Q.high=0|i[n+2*q],K=Q.low=0|i[n+2*q+1];else{var ee=p[q-15],te=ee.high,ie=ee.low,ne=(te>>>1|ie<<31)^(te>>>8|ie<<24)^te>>>7,se=(ie>>>1|te<<31)^(ie>>>8|te<<24)^(ie>>>7|te<<25),re=p[q-2],oe=re.high,ae=re.low,le=(oe>>>19|ae<<13)^(oe<<3|ae>>>29)^oe>>>6,de=(ae>>>19|oe<<13)^(ae<<3|oe>>>29)^(ae>>>6|oe<<26),ce=p[q-7],he=ce.high,pe=ce.low,ue=p[q-16],ve=ue.high,ge=ue.low;Y=(Y=(Y=ne+he+((K=se+pe)>>>0<se>>>0?1:0))+le+((K+=de)>>>0<de>>>0?1:0))+ve+((K+=ge)>>>0<ge>>>0?1:0),Q.high=Y,Q.low=K}var me,_e=H&X^~H&U,fe=B&$^~B&J,ye=I&D^I&z^D&z,Pe=W&N^W&R^N&R,we=(I>>>28|W<<4)^(I<<30|W>>>2)^(I<<25|W>>>7),xe=(W>>>28|I<<4)^(W<<30|I>>>2)^(W<<25|I>>>7),Se=(H>>>14|B<<18)^(H>>>18|B<<14)^(H<<23|B>>>9),be=(B>>>14|H<<18)^(B>>>18|H<<14)^(B<<23|H>>>9),Fe=h[q],ke=Fe.high,Ge=Fe.low,Me=V+Se+((me=Z+be)>>>0<Z>>>0?1:0),Ce=xe+Pe;V=U,Z=J,U=X,J=$,X=H,$=B,H=j+(Me=(Me=(Me=Me+_e+((me+=fe)>>>0<fe>>>0?1:0))+ke+((me+=Ge)>>>0<Ge>>>0?1:0))+Y+((me+=K)>>>0<K>>>0?1:0))+((B=O+me|0)>>>0<O>>>0?1:0)|0,j=z,O=R,z=D,R=N,D=I,N=W,I=Me+(we+ye+(Ce>>>0<xe>>>0?1:0))+((W=me+Ce|0)>>>0<me>>>0?1:0)|0}f=a.low=f+W,a.high=_+I+(f>>>0<W>>>0?1:0),P=l.low=P+N,l.high=y+D+(P>>>0<N>>>0?1:0),x=d.low=x+R,d.high=w+z+(x>>>0<R>>>0?1:0),b=c.low=b+O,c.high=S+j+(b>>>0<O>>>0?1:0),G=u.low=G+B,u.high=k+H+(G>>>0<B>>>0?1:0),C=v.low=C+$,v.high=M+X+(C>>>0<$>>>0?1:0),T=g.low=T+J,g.high=E+U+(T>>>0<J>>>0?1:0),A=m.low=A+Z,m.high=L+V+(A>>>0<Z>>>0?1:0)},_doFinalize:function(){var i=this._data,n=i.words,s=8*this._nDataBytes,a=8*i.sigBytes;return n[a>>>5]|=128<<24-a%32,n[30+(a+128>>>10<<5)]=Math.floor(s/4294967296),n[31+(a+128>>>10<<5)]=s,i.sigBytes=4*n.length,this._process(),this._hash.toX32()},clone:function(){var i=n.clone.call(this);return i._hash=this._hash.clone(),i},blockSize:32});i.SHA512=n._createHelper(u),i.HmacSHA512=n._createHmacHelper(u)}(),s.SHA512)})),createCommonjsModule((function(i,n){var s,a,l;i.exports=(a=(s=Ge).lib.Base,l=s.enc.Utf8,void(s.algo.HMAC=a.extend({init:function(i,n){i=this._hasher=new i.init,"string"==typeof n&&(n=l.parse(n));var s=i.blockSize,a=4*s;n.sigBytes>a&&(n=i.finalize(n)),n.clamp();for(var d=this._oKey=n.clone(),c=this._iKey=n.clone(),h=d.words,p=c.words,u=0;u<s;u++)h[u]^=1549556828,p[u]^=909522486;d.sigBytes=c.sigBytes=a,this.reset()},reset:function(){var i=this._hasher;i.reset(),i.update(this._iKey)},update:function(i){return this._hasher.update(i),this},finalize:function(i){var n=this._hasher,s=n.finalize(i);return n.reset(),n.finalize(this._oKey.clone().concat(s))}})))})),createCommonjsModule((function(i,n){i.exports=Ge.HmacSHA512})));function computeHmac(i,n,s){return new Ce(i,n+s).toString(Me)}class AbstractRecognizer{constructor(i,n){this.serverConfiguration=i,this.recognitionConfiguration=n}}class RestRecognizer extends AbstractRecognizer{constructor(i,n){super(i,n)}get url(){return`${this.serverConfiguration.scheme}://${this.serverConfiguration.host}/api/v4.0/iink/batch`}get postConfig(){switch(this.recognitionConfiguration.type){case"DIAGRAM":return{lang:this.recognitionConfiguration.lang,diagram:this.recognitionConfiguration.diagram,export:this.recognitionConfiguration.export};case"MATH":return{lang:this.recognitionConfiguration.lang,math:this.recognitionConfiguration.math,export:this.recognitionConfiguration.export};case"Raw Content":return{lang:this.recognitionConfiguration.lang,"raw-content":this.recognitionConfiguration["raw-content"],export:this.recognitionConfiguration.export};case"TEXT":return{lang:this.recognitionConfiguration.lang,text:this.recognitionConfiguration.text,export:this.recognitionConfiguration.export};default:throw new Error(`get postConfig error Recognition type unkow "${this.recognitionConfiguration.type}"`)}}buildData(i){const n=[];i.strokeGroups.forEach((i=>{const s={penStyle:"{}"===JSON.stringify(i.penStyle)?void 0:ke.penStyleToCSS(i.penStyle),strokes:i.strokes.map((i=>({x:i.x,y:i.y,t:i.t,p:i.p,pointerType:i.pointerType})))};n.push(s)}));const s="Raw Content"===this.recognitionConfiguration.type?"Raw Content":this.recognitionConfiguration.type.charAt(0).toUpperCase()+this.recognitionConfiguration.type.slice(1).toLowerCase();return{configuration:this.postConfig,xDPI:96,yDPI:96,contentType:s,height:i.height,width:i.width,strokeGroups:n}}post(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=new Headers;s.append("Accept","application/json,"+n),s.append("applicationKey",this.serverConfiguration.applicationKey),s.append("hmac",computeHmac(JSON.stringify(i),this.serverConfiguration.applicationKey,this.serverConfiguration.hmacKey)),s.append("Content-Type","application/json");const a={method:"POST",headers:s,body:JSON.stringify(i)},l=new Request(this.url,a),d=yield fetch(l);if(d.ok){let i;switch(d.headers.get("content-type")){case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"image/png":case"image/jpeg":i=yield d.blob();break;case"application/json":i=yield d.json();break;case"application/vnd.myscript.jiix":i=yield d.clone().json().catch((()=>__awaiter(this,void 0,void 0,(function*(){return yield d.text()}))));break;default:i=yield d.text()}return i}throw yield d.json()}))}tryFetch(i,a){return __awaiter(this,void 0,void 0,(function*(){return this.post(i,a).then((i=>{const n={};return n[a]=i,n})).catch((i=>{let a=i.message||s;i.code?"access.not.granted"===i.code&&(a=n):a=l;throw new Error(a)}))}))}getMimeTypes(i){let n=i||[];if(!n.length)switch(this.recognitionConfiguration.type){case"DIAGRAM":n=this.recognitionConfiguration.diagram.mimeTypes;break;case"MATH":n=this.recognitionConfiguration.math.mimeTypes;break;case"Raw Content":n=["application/vnd.myscript.jiix"];break;case"TEXT":n=this.recognitionConfiguration.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.recognitionConfiguration.type}" is unknown.\n Possible types are:\n -DIAGRAM\n -MATH\n -Raw Content\n -TEXT`)}return n}convert(i,n,s){return __awaiter(this,void 0,void 0,(function*(){const a=i.getClone();a.updatePositionSent();const l=this.getMimeTypes(s),d=this.buildData(a);d.conversionState=n;const c=l.map((i=>this.tryFetch(d,i)));return(yield Promise.all(c)).forEach((i=>{a.converts=Object.assign(a.converts||{},i)})),a.updatePositionReceived(),a}))}exportModel(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=this.buildData(i);return this.tryFetch(s,n)}))}export(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=i.getClone();if(s.updatePositionSent(),s.isEmpty)return Promise.resolve(s);const a=this.getMimeTypes(n);if(!a.length)return Promise.reject(new Error("Export failed, no mimeTypes define in recognition configuration"));const l=a.filter((i=>!s.exports||!s.exports[i]));return(yield Promise.all(l.map((i=>this.exportModel(s,i))))).forEach((i=>{s.exports=Object.assign(s.exports||{},i)})),s.updatePositionReceived(),s}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){return this.export(i)}))}}class DeferredPromise{constructor(){this.isFullFilled=!1,this.isPending=!0,this.promise=new Promise(((i,n)=>{this.reject=i=>__awaiter(this,void 0,void 0,(function*(){return this.isFullFilled=!0,this.isPending=!1,n(i)})),this.resolve=n=>__awaiter(this,void 0,void 0,(function*(){return this.isFullFilled=!0,this.isPending=!1,i(n)}))}))}}class GlobalEvent extends EventTarget{constructor(){super(),Z.add(this)}static getInstance(){return __classPrivateFieldGet(GlobalEvent,q,"f",Q)||__classPrivateFieldSet(GlobalEvent,q,new GlobalEvent,"f",Q),__classPrivateFieldGet(GlobalEvent,q,"f",Q)}emitLoaded(){__classPrivateFieldGet(this,Z,"m",Y).call(this,k)}emitExported(i){__classPrivateFieldGet(this,Z,"m",Y).call(this,S,i)}emitChange(i){__classPrivateFieldGet(this,Z,"m",Y).call(this,w,{canUndo:i.canUndo,canRedo:i.canRedo,canClear:!i.stack[i.stackIndex].isEmpty,stackIndex:i.stackIndex,stackLength:i.stack.length,isEmpty:i.stack[i.stackIndex].isEmpty})}emitIdle(i){__classPrivateFieldGet(this,Z,"m",Y).call(this,P,i)}emitError(i){__classPrivateFieldGet(this,Z,"m",Y).call(this,L,i)}emitNotif(i,n){__classPrivateFieldGet(this,Z,"m",Y).call(this,T,{message:i,timeout:n})}emitClear(){__classPrivateFieldGet(this,Z,"m",Y).call(this,G)}emitCleared(i){__classPrivateFieldGet(this,Z,"m",Y).call(this,M,i)}emitConvert(){__classPrivateFieldGet(this,Z,"m",Y).call(this,E,exports)}emitConverted(i){__classPrivateFieldGet(this,Z,"m",Y).call(this,b,i)}emitImport(i,n){__classPrivateFieldGet(this,Z,"m",Y).call(this,C,{jiix:i,mimeType:n})}emitImported(i){__classPrivateFieldGet(this,Z,"m",Y).call(this,x,i)}}q=GlobalEvent,Z=new WeakSet,Y=function _GlobalEvent_emit(i,n){this.dispatchEvent(new CustomEvent(i,Object.assign({bubbles:!0,composed:!0},n?{detail:n}:void 0)))},Q={value:void 0};class UndoRedoContext{constructor(i){this.stackIndex=0,this.stack=[i.getClone()],this.canRedo=!1,this.canUndo=!1}}class UndoRedoManager{constructor(i,n){this.configuration=i,this.context=new UndoRedoContext(n)}get globalEvent(){return GlobalEvent.getInstance()}updateCanUndoRedo(){this.context.canRedo=this.context.stack.length-1>this.context.stackIndex,this.context.canUndo=this.context.stackIndex>0}getLastModel(){return this.context.stack[this.context.stack.length-1]}getModelFromModificationDate(i){return this.context.stack.find((n=>n.modificationDate===i))}addModelToStack(i){this.context.stackIndex+1<this.context.stack.length&&this.context.stack.splice(this.context.stackIndex+1),this.context.stackIndex++,this.context.stack.push(i.getClone()),this.context.stack.length>this.configuration.maxStackSize&&(this.context.stack.shift(),this.context.stackIndex--),this.updateCanUndoRedo(),this.globalEvent.emitChange(this.context)}updateModelInStack(i){const n=this.context.stack.findIndex((n=>n.modificationDate===i.modificationDate));n>-1&&(this.context.stack.splice(n,1,i.getClone()),this.globalEvent.emitChange(this.context))}undo(){return this.context.canUndo&&(this.context.stackIndex--,this.updateCanUndoRedo(),this.globalEvent.emitChange(this.context)),this.context.stack[this.context.stackIndex].getClone()}redo(){return this.context.canRedo&&(this.context.stackIndex++,this.updateCanUndoRedo(),this.globalEvent.emitChange(this.context)),this.context.stack[this.context.stackIndex].getClone()}reset(i){this.context=new UndoRedoContext(i),this.globalEvent.emitChange(this.context)}}class RestBehaviors{constructor(i,n){K.add(this),ee.set(this,void 0),te.set(this,void 0),ie.set(this,void 0),this.grabber=new PointerEventGrabber(i.grabber),this.renderer=new CanvasRenderer(i.rendering),this.recognizer=new RestRecognizer(i.server,i.recognition),this.undoRedoManager=new UndoRedoManager(i["undo-redo"],n.getClone()),__classPrivateFieldSet(this,ee,i.triggers,"f"),this.initalise=new DeferredPromise}get globalEvent(){return GlobalEvent.getInstance()}init(i){return __awaiter(this,void 0,void 0,(function*(){return this.grabber.attach(i),this.renderer.init(i),this.initalise.resolve(),this.initalise.promise}))}drawCurrentStroke(i){this.renderer.drawPendingStroke(i.currentStroke)}updateModelRendering(i){return __awaiter(this,void 0,void 0,(function*(){return this.renderer.drawModel(i),this.export(i)}))}export(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=new DeferredPromise;if(this.undoRedoManager.addModelToStack(i),"DEMAND"!==__classPrivateFieldGet(this,ee,"f").exportContent){clearTimeout(__classPrivateFieldGet(this,ie,"f"));let a=i.getClone();__classPrivateFieldSet(this,ie,setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){try{a=yield __classPrivateFieldGet(this,K,"m",ne).call(this,a,n),this.undoRedoManager.updateModelInStack(a),i.modificationDate===a.modificationDate&&(i.exports=a.exports),s.resolve(i)}catch(i){s.reject(i)}}))),__classPrivateFieldGet(this,ee,"f").exportContentDelay),"f")}else s.resolve(i);return s.promise}))}convert(i,n,s){return __awaiter(this,void 0,void 0,(function*(){return this.recognizer.convert(i,n,s)}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){if(this.renderer.resize(i),i.strokeGroups.length){const n=new DeferredPromise;return clearTimeout(__classPrivateFieldGet(this,te,"f")),__classPrivateFieldSet(this,te,setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){const s=yield this.recognizer.resize(i);n.resolve(s)}))),__classPrivateFieldGet(this,ee,"f").resizeTriggerDelay),"f"),n.promise}return Promise.resolve(i)}))}undo(){return __awaiter(this,void 0,void 0,(function*(){const i=this.undoRedoManager.undo();this.renderer.drawModel(i);const n=yield __classPrivateFieldGet(this,K,"m",ne).call(this,i);return this.undoRedoManager.updateModelInStack(n),n}))}redo(){return __awaiter(this,void 0,void 0,(function*(){const i=this.undoRedoManager.redo();this.renderer.drawModel(i);const n=yield __classPrivateFieldGet(this,K,"m",ne).call(this,i);return this.undoRedoManager.updateModelInStack(n),n}))}clear(i){return __awaiter(this,void 0,void 0,(function*(){const n=i.getClone();return n.clear(),this.undoRedoManager.addModelToStack(n),this.renderer.drawModel(n),n.modificationDate=(new Date).getTime(),this.globalEvent.emitCleared(n),this.globalEvent.emitExported(n.exports),n}))}destroy(i){return __awaiter(this,void 0,void 0,(function*(){return this.grabber.detach(),this.renderer.destroy(),this.undoRedoManager.reset(i),this.globalEvent.emitCleared(i),this.globalEvent.emitExported(i.exports),Promise.resolve()}))}}ee=new WeakMap,te=new WeakMap,ie=new WeakMap,K=new WeakSet,ne=function _RestBehaviors__export(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=yield this.recognizer.export(i,n);return this.globalEvent.emitExported(null==s?void 0:s.exports),s}))};class WSEvent extends EventTarget{constructor(){super(),se.set(this,void 0),__classPrivateFieldSet(this,se,new AbortController,"f")}emit(i,n){this.dispatchEvent(new CustomEvent(i,Object.assign({bubbles:!0,composed:!0},n?{detail:n}:void 0)))}emitInitialized(){this.emit(z)}emitConnected(){this.emit(R)}emitConnectionActive(){this.emit(j)}addConnectionActiveListener(i){this.addEventListener(j,(()=>i()),{signal:__classPrivateFieldGet(this,se,"f").signal})}emitDisconnected(i){this.emit(O,i)}addDisconnectedListener(i){this.addEventListener(O,(n=>i(n.detail)),{signal:__classPrivateFieldGet(this,se,"f").signal})}emitPartChange(i){this.emit(A,i)}addPartChangeListener(i){this.addEventListener(A,(n=>i(n.detail)),{signal:__classPrivateFieldGet(this,se,"f").signal})}emitContentChange(i){this.emit(I,i)}addContentChangeListener(i){this.addEventListener(I,(n=>i(n.detail)),{signal:__classPrivateFieldGet(this,se,"f").signal})}emitSVGPatch(i){this.emit(W,i)}addSVGPatchListener(i){this.addEventListener(W,(n=>i(n.detail)),{signal:__classPrivateFieldGet(this,se,"f").signal})}emitExported(i){this.emit(D,i)}addExportListener(i){this.addEventListener(D,(n=>i(n.detail)),{signal:__classPrivateFieldGet(this,se,"f").signal})}emitError(i){this.emit(N,i)}addErrorListener(i){this.addEventListener(N,(n=>i(n.detail)),{signal:__classPrivateFieldGet(this,se,"f").signal})}clearListeners(){__classPrivateFieldGet(this,se,"f").abort()}}se=new WeakMap;class WSRecognizer extends AbstractRecognizer{constructor(i,n){super(i,n),this.pingCount=0,this.reconnectionCount=0,re.set(this,void 0),this.wsEvent=new WSEvent}get url(){return`${"https"===this.serverConfiguration.scheme?"wss":"ws"}://${this.serverConfiguration.host}/api/v4.0/iink/document`}get mimeTypes(){switch(this.recognitionConfiguration.type.toLocaleLowerCase()){case"text":return this.recognitionConfiguration.text.mimeTypes;case"math":return this.recognitionConfiguration.math.mimeTypes;case"diagram":return this.recognitionConfiguration.diagram.mimeTypes;default:return[]}}infinitePing(){this.pingCount++,this.serverConfiguration.websocket.maxPingLostCount<this.pingCount?this.close(1e3,"PING_LOST"):this.socket.readyState<=1&&setTimeout((()=>{this.socket.readyState<=1&&(this.socket.send(JSON.stringify({type:"ping"})),this.infinitePing())}),this.serverConfiguration.websocket.pingDelay)}openCallback(){this.wsEvent.emitConnected();const i={type:this.sessionId?"restoreIInkSession":"newContentPackage",iinkSessionId:this.sessionId,applicationKey:this.serverConfiguration.applicationKey,xDpi:96,yDpi:96,viewSizeHeight:this.viewSizeHeight,viewSizeWidth:this.viewSizeWidth};this.send(i)}closeCallback(i){let n="";if(!this.currentErrorCode){switch(i.code){case 1e3:break;case 1001:n=d;break;case 1002:n=c;break;case 1003:n=h;break;case 1006:n=a;break;case 1007:n=p;break;case 1008:n=u;break;case 1009:n=v;break;case 1011:n=g;break;case 1012:n=m;break;case 1013:n=_;break;case 1014:n=f;break;case 1015:n=y;break;default:n=l}n&&this.wsEvent.emitError(new Error(n))}this.wsEvent.emitDisconnected(i)}manageHMACChallengeMessage(i){const n=i;n.hmacChallenge&&this.send({type:"hmac",hmac:computeHmac(n.hmacChallenge,this.serverConfiguration.applicationKey,this.serverConfiguration.hmacKey)}),n.iinkSessionId&&(this.sessionId=n.iinkSessionId)}manageContentPackageDescriptionMessage(){this.reconnectionCount=0,this.send(Object.assign(Object.assign({},this.recognitionConfiguration),{type:"configuration"})),this.currentPartId?this.send({type:"openContentPart",id:this.currentPartId,mimeTypes:this.mimeTypes}):this.send({type:"newContentPart",contentType:this.recognitionConfiguration.type,mimeTypes:this.mimeTypes})}managePartChangeMessage(i){const n=i;this.currentPartId=n.partId,this.wsEvent.emitPartChange(n)}manageContentChangeMessage(i){const n=i;this.wsEvent.emitContentChange(n)}manageExportMessage(i){const n=i;this.wsEvent.emitExported(n)}manageSVGPatchMessage(i){const n=i;this.wsEvent.emitSVGPatch(n)}manageErrorMessage(i){var a,l;const d=i;this.currentErrorCode=(null===(a=d.data)||void 0===a?void 0:a.code)||d.code;let c=(null===(l=d.data)||void 0===l?void 0:l.message)||d.message||s;"access.not.granted"===this.currentErrorCode&&(c=n),this.wsEvent.emitError(new Error(c))}messageCallback(i){var n;this.currentErrorCode=void 0;const s=JSON.parse(i.data);if("pong"!==s.type)switch(this.pingCount=0,s.type){case"ack":this.manageHMACChallengeMessage(s);break;case"contentPackageDescription":this.manageContentPackageDescriptionMessage();break;case"partChanged":this.managePartChangeMessage(s);break;case"newPart":this.wsEvent.emitConnectionActive();break;case"contentChanged":this.manageContentChangeMessage(s);break;case"exported":this.manageExportMessage(s);break;case"svgPatch":this.manageSVGPatchMessage(s);break;case"error":this.manageErrorMessage(s);break;case"fileChunkAck":null===(n=__classPrivateFieldGet(this,re,"f"))||void 0===n||n.resolve(s)}}init(i,n){try{this.viewSizeHeight=i,this.viewSizeWidth=n,this.socket=new WebSocket(this.url),this.serverConfiguration.websocket.pingEnabled&&this.infinitePing(),this.socket.onopen=()=>this.openCallback(),this.socket.onclose=i=>this.closeCallback(i),this.socket.onmessage=i=>this.messageCallback(i),this.wsEvent.emitInitialized()}catch(i){new Error(l).name=i.code||"CANT_ESTABLISH",this.wsEvent.emitError(i)}}canReconnect(){return this.serverConfiguration.websocket.autoReconnect&&this.reconnectionCount<=this.serverConfiguration.websocket.maxRetryCount&&(!this.currentErrorCode||!["api.invalid.format","access.not.granted"].includes(this.currentErrorCode.toString()))}addStrokes(i){const n=i.extractPendingStrokes();0!==n.length&&this.send({type:"addStrokes",strokes:n.map((i=>({pointerType:i.pointerType,pointerId:i.pointerId,x:i.x,y:i.y,t:i.t,p:i.p})))})}send(i){if(this.socket.readyState!==this.socket.OPEN)throw this.socket.removeEventListener("close",this.closeCallback),this.socket.removeEventListener("message",this.messageCallback),this.socket.removeEventListener("open",this.openCallback),new Error(O);this.socket.send(JSON.stringify(i))}close(i,n){this.socket.readyState!==this.socket.OPEN&&this.socket.readyState!==this.socket.CONNECTING||this.socket.close(i,n)}export(i,n){return __awaiter(this,void 0,void 0,(function*(){let s=n||[];if(!s.length)switch(this.recognitionConfiguration.type){case"DIAGRAM":s=this.recognitionConfiguration.diagram.mimeTypes;break;case"MATH":s=this.recognitionConfiguration.math.mimeTypes;break;case"Raw Content":s=["application/vnd.myscript.jiix"];break;case"TEXT":s=this.recognitionConfiguration.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.recognitionConfiguration.type}" is unknown.\n Possible types are:\n -DIAGRAM\n -MATH\n -Raw Content\n -TEXT`)}if(!s.length)return Promise.reject(new Error("Export failed, no mimeTypes define in recognition configuration"));const a={type:"export",partId:this.currentPartId,mimeTypes:s};return this.send(a),i}))}import(n,s){return __awaiter(this,void 0,void 0,(function*(){const a=this.serverConfiguration.websocket.fileChunkSize,l=i();__classPrivateFieldSet(this,re,new DeferredPromise,"f");const readBlob=i=>{const n=new FileReader;return new Promise(((s,a)=>{n.onloadend=i=>{var n;return s(null===(n=i.target)||void 0===n?void 0:n.result)},n.onerror=()=>a(),n.readAsText(i)}))},d={type:"importFile",importFileId:l,mimeType:s};this.send(d);for(let i=0;i<n.size;i+=a){const s=n.slice(i,a,n.type),d={type:"fileChunk",importFileId:l,data:yield readBlob(s),lastChunk:i+a>n.size};this.send(d)}return __classPrivateFieldGet(this,re,"f").promise}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){this.viewSizeHeight=i.height,this.viewSizeWidth=i.width;const n={type:"changeViewSize",height:this.viewSizeHeight,width:this.viewSizeWidth};return this.send(n),Promise.resolve(i)}))}convert(i){const n={type:"convert",conversionState:i};this.send(n)}undo(){this.send({type:"undo"})}redo(){this.send({type:"redo"})}clear(){this.send({type:"clear"})}}re=new WeakMap;class SVGQuadraticStroker{getArcPath(i,n){return[`M ${i.x},${i.y}`,`m ${-n},0`,`a ${n},${n} 0 1 0 ${2*n},0`,`a ${n},${n} 0 1 0 ${-2*n},0`].join(" ")}getLinePath(i,n,s){const a=computeLinksPoints(i,computeAxeAngle(i,n),s),l=computeLinksPoints(n,computeAxeAngle(i,n),s);return[`M ${a[0].x},${a[0].y}`,`L ${l[0].x},${l[0].y}`,`L ${l[1].x},${l[1].y}`,`L ${a[1].x},${a[1].y}`].join(" ")}getFinalPath(i,n,s){const a=computeAxeAngle(i,n),l=computeLinksPoints(n,a,s),d=[`M ${l[0].x},${l[0].y}`];for(let i=1;i<=6;i++){const l=a-i*(Math.PI/6);d.push(`L ${n.x-n.p*s*Math.sin(l)},${n.y+n.p*s*Math.cos(l)}`)}return d.join(" ")}getQuadraticPath(i,n,s,a){const l=computeLinksPoints(i,computeAxeAngle(i,s),a),d=computeLinksPoints(n,computeAxeAngle(s,n),a),c=computeLinksPoints(s,computeAxeAngle(i,n),a);return[`M ${l[0].x},${l[0].y}`,`Q ${c[0].x},${c[0].y} ${d[0].x},${d[0].y}`,`L ${d[1].x},${d[1].y}`,`Q ${c[1].x},${c[1].y} ${l[1].x},${l[1].y}`].join(" ")}getPointByIndex(i,n){return{x:i.x[n]||0,y:i.y[n]||0,t:i.t[n]||0,p:i.p[n]||0}}buildSVGPath(i){const n=i.x.length,s=i.width,a=n-2,l=this.getPointByIndex(i,0),d=[];if(n<3)d.push(this.getArcPath(l,.6*s));else{d.push(this.getArcPath(l,s*l.p)),d.push(this.getLinePath(l,computeMiddlePoint(l,this.getPointByIndex(i,1)),s));for(let n=0;n<a;n++){const a=computeMiddlePoint(this.getPointByIndex(i,n),this.getPointByIndex(i,n+1)),l=computeMiddlePoint(this.getPointByIndex(i,n+1),this.getPointByIndex(i,n+2)),c=this.getPointByIndex(i,n+1);d.push(this.getQuadraticPath(a,l,c,s))}const c=this.getPointByIndex(i,n-2),h=this.getPointByIndex(i,n-1);d.push(this.getLinePath(computeMiddlePoint(c,h),h,s)),d.push(this.getFinalPath(c,h,s))}return d.join(" ")}drawStroke(i,n){const s=this.buildSVGPath(n),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.classList.add("pending-stroke"),a.setAttribute("id",n.id),a.setAttribute("color",n.color);const l=`fill:${n.color};stroke:transparent;`;a.setAttribute("style",l),a.setAttribute("d",`${s}Z`),i.appendChild(a)}drawErasingStroke(i,n){n.width=20;const s=this.buildSVGPath(n),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.classList.add("erasing-stroke"),a.setAttribute("id",n.id);a.setAttribute("style","fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;"),a.setAttribute("d",`${s}Z`),i.appendChild(a)}}class SVGRenderer{constructor(i){oe.add(this),this.config=i,this.stroker=new SVGQuadraticStroker}init(i){i.style.fontSize="10px",this.context={parent:i}}updateLayer(i,n){switch(n.type){case"REPLACE_ALL":__classPrivateFieldGet(this,oe,"m",le).call(this,i,n);break;case"REPLACE_ELEMENT":__classPrivateFieldGet(this,oe,"m",de).call(this,n);break;case"APPEND_CHILD":__classPrivateFieldGet(this,oe,"m",ce).call(this,i,n);break;case"REMOVE_ELEMENT":__classPrivateFieldGet(this,oe,"m",pe).call(this,n);break;case"REMOVE_CHILD":__classPrivateFieldGet(this,oe,"m",he).call(this,n);break;case"INSERT_BEFORE":__classPrivateFieldGet(this,oe,"m",ue).call(this,n);break;case"SET_ATTRIBUTE":__classPrivateFieldGet(this,oe,"m",ve).call(this,n);break;case"REMOVE_ATTRIBUTE":__classPrivateFieldGet(this,oe,"m",ge).call(this,n)}}updatesLayer(i,n){n.forEach((n=>this.updateLayer(i,n)))}clearPendingStroke(){const i=this.context.parent.querySelector("#pendingStrokes");i&&(i.innerHTML="")}drawPendingStroke(i){if(i){const n=this.context.parent.querySelector("#pendingStrokes");if(n){const s=n.querySelector(`#${null==i?void 0:i.id}`);s&&s.remove(),__classPrivateFieldGet(this,oe,"m",ae).call(this,n,i)}}}resize(i){const n=this.context.parent.getBoundingClientRect(),s=this.context.parent.querySelectorAll("svg"),a=Math.max(n.width,i.width),l=Math.max(n.height,i.height);s.forEach((i=>{i.setAttribute("viewBox",`0 0 ${a}, ${l}`),i.setAttribute("width",`${a}px`),i.setAttribute("height",`${l}px`)}))}destroy(){this.context.parent&&(this.context.parent.innerHTML="")}}oe=new WeakSet,ae=function _SVGRenderer_drawStroke(i,n){"ERASER"===n.pointerType?this.stroker.drawErasingStroke(i,n):this.stroker.drawStroke(i,n)},le=function _SVGRenderer_replaceAll(i,n){const s=this.context.parent.querySelector(`svg[data-layer="${i}"]`);null==s||s.remove(),this.context.parent.insertAdjacentHTML("beforeend",n.svg);const a=this.context.parent.querySelector(`svg[data-layer="${i}"]`);if("MODEL"===i){const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.id="pendingStrokes",a.appendChild(i)}},de=function _SVGRenderer_replaceElement(i){const n=this.context.parent.querySelector(`#${i.id}`);if(n){const s=n.parentNode;null==n||n.remove(),null==s||s.insertAdjacentHTML("beforeend",i.svg)}},ce=function _SVGRenderer_appendChild(i,n){const s=n.parentId?`#${n.parentId}`:`svg[data-layer="${i}"]`,a=this.context.parent.querySelector(s);null==a||a.insertAdjacentHTML("beforeend",n.svg)},he=function _SVGRenderer_removeChild(i){var n;null===(n=this.context.parent.querySelector(`#${i.parentId} > *:nth-child(${i.index+1})`))||void 0===n||n.remove()},pe=function _SVGRenderer_removeElement(i){const n=this.context.parent.querySelector(`#${i.id}`);n&&(i.id.includes("s")||i.id.includes("MODEL")?n.remove():(n.setAttribute("class","removed-stroke"),setTimeout((()=>{null==n||n.remove()}),100)))},ue=function _SVGRenderer_insertBefore(i){const n=this.context.parent.querySelector(`#${i.refId}`);null==n||n.insertAdjacentHTML("beforebegin",i.svg)},ve=function _SVGRenderer_setAttribute(i){const n=i.id?`#${i.id}`:"svg",s=this.context.parent.querySelector(n);null==s||s.setAttribute(i.name,i.value)},ge=function _SVGRenderer_removeAttribute(i){const n=i.id?`#${i.id}`:"svg",s=this.context.parent.querySelector(n);null==s||s.removeAttribute(i.name)};class WSBehaviors{constructor(i,n){me.set(this,void 0),_e.set(this,void 0),fe.set(this,void 0),ye.set(this,void 0),Pe.set(this,void 0),we.set(this,void 0),xe.set(this,void 0),Se.set(this,void 0),be.set(this,void 0),Fe.set(this,void 0),this.onConnectionActive=()=>{this.initalise.resolve()},this.onContentChange=()=>{var i,n,s,a;null===(i=__classPrivateFieldGet(this,xe,"f"))||void 0===i||i.resolve(),null===(n=__classPrivateFieldGet(this,Se,"f"))||void 0===n||n.resolve(),null===(s=__classPrivateFieldGet(this,be,"f"))||void 0===s||s.resolve(),null===(a=__classPrivateFieldGet(this,Fe,"f"))||void 0===a||a.resolve()},this.onSVGPatch=i=>{this.renderer.updatesLayer(i.layer,i.updates)},this.onError=i=>{this.initalise.isPending&&this.initalise.reject(i),this.globalEvent.emitError(i)},this.onExport=i=>{var n,s,a,l;null===(n=__classPrivateFieldGet(this,we,"f"))||void 0===n||n.resolve(i.exports),null===(s=__classPrivateFieldGet(this,Pe,"f"))||void 0===s||s.resolve(i.exports),null===(a=__classPrivateFieldGet(this,fe,"f"))||void 0===a||a.resolve(i.exports),null===(l=__classPrivateFieldGet(this,ye,"f"))||void 0===l||l.resolve(i.exports),this.globalEvent.emitExported(i.exports)},this.onDisconnected=i=>{var n,s,a,l,d,c,h,p,u,v,g,m,_,f,y,P;const w=new Error(i.reason);w.name=i.code.toString(),this.initalise.isPending&&(1e3===i.code?this.initalise.resolve():this.initalise.reject(w)),(null===(n=__classPrivateFieldGet(this,Pe,"f"))||void 0===n?void 0:n.isPending)&&(null===(s=__classPrivateFieldGet(this,Pe,"f"))||void 0===s||s.reject(w)),(null===(a=__classPrivateFieldGet(this,fe,"f"))||void 0===a?void 0:a.isPending)&&(null===(l=__classPrivateFieldGet(this,fe,"f"))||void 0===l||l.reject(w)),(null===(d=__classPrivateFieldGet(this,ye,"f"))||void 0===d?void 0:d.isPending)&&(null===(c=__classPrivateFieldGet(this,ye,"f"))||void 0===c||c.reject(w)),(null===(h=__classPrivateFieldGet(this,we,"f"))||void 0===h?void 0:h.isPending)&&(null===(p=__classPrivateFieldGet(this,we,"f"))||void 0===p||p.reject(w)),(null===(u=__classPrivateFieldGet(this,xe,"f"))||void 0===u?void 0:u.isPending)&&(null===(v=__classPrivateFieldGet(this,xe,"f"))||void 0===v||v.reject(w)),(null===(g=__classPrivateFieldGet(this,Se,"f"))||void 0===g?void 0:g.isPending)&&(null===(m=__classPrivateFieldGet(this,Se,"f"))||void 0===m||m.reject(w)),(null===(_=__classPrivateFieldGet(this,be,"f"))||void 0===_?void 0:_.isPending)&&(null===(f=__classPrivateFieldGet(this,be,"f"))||void 0===f||f.reject(w)),(null===(y=__classPrivateFieldGet(this,Fe,"f"))||void 0===y?void 0:y.isPending)&&(null===(P=__classPrivateFieldGet(this,Fe,"f"))||void 0===P||P.reject(w))},this.grabber=new PointerEventGrabber(i.grabber),this.renderer=new SVGRenderer(i.rendering),this.recognizer=new WSRecognizer(i.server,i.recognition),this.undoRedoManager=new UndoRedoManager(i["undo-redo"],n.getClone()),__classPrivateFieldSet(this,me,i.triggers,"f"),this.initalise=new DeferredPromise}get globalEvent(){return GlobalEvent.getInstance()}init(i){const n=this.undoRedoManager.getLastModel();return this.grabber.attach(i),this.renderer.init(i),this.recognizer.init(n.height,n.width),this.recognizer.wsEvent.addConnectionActiveListener(this.onConnectionActive),this.recognizer.wsEvent.addContentChangeListener(this.onContentChange),this.recognizer.wsEvent.addSVGPatchListener(this.onSVGPatch),this.recognizer.wsEvent.addExportListener(this.onExport),this.recognizer.wsEvent.addDisconnectedListener(this.onDisconnected),this.recognizer.wsEvent.addErrorListener(this.onError),this.initalise.promise}drawCurrentStroke(i){const n=i.currentStroke;n&&(n.id=`pendingStroke-${i.rawStrokes.length}`,this.renderer.drawPendingStroke(n))}updateModelRendering(i){return __awaiter(this,void 0,void 0,(function*(){yield this.initalise.promise,i.updatePositionSent(),this.undoRedoManager.addModelToStack(i),__classPrivateFieldSet(this,Pe,new DeferredPromise,"f"),this.recognizer.addStrokes(i);const n=yield __classPrivateFieldGet(this,Pe,"f").promise;return i.updatePositionReceived(),i.exports?Object.assign(i.exports,n):i.exports=n,this.undoRedoManager.updateModelInStack(i),this.renderer.clearPendingStroke(),__classPrivateFieldSet(this,Pe,void 0,"f"),i}))}export(i,n){return __awaiter(this,void 0,void 0,(function*(){yield this.initalise.promise,this.undoRedoManager.addModelToStack(i),__classPrivateFieldSet(this,fe,new DeferredPromise,"f"),yield this.recognizer.export(i,n);const s=yield __classPrivateFieldGet(this,fe,"f").promise;return i.updatePositionReceived(),i.exports?Object.assign(i.exports,s):i.exports=s,this.undoRedoManager.updateModelInStack(i),__classPrivateFieldSet(this,fe,void 0,"f"),i}))}convert(i,n){return __awaiter(this,void 0,void 0,(function*(){yield this.initalise.promise,this.undoRedoManager.addModelToStack(i),__classPrivateFieldSet(this,ye,new DeferredPromise,"f"),this.recognizer.convert(n);const s=yield __classPrivateFieldGet(this,ye,"f").promise;return i.updatePositionReceived(),i.converts?Object.assign(i.converts,s):i.converts=s,this.undoRedoManager.updateModelInStack(i),__classPrivateFieldSet(this,ye,void 0,"f"),i}))}import(i,n,s){return __awaiter(this,void 0,void 0,(function*(){yield this.initalise.promise,this.undoRedoManager.addModelToStack(i),__classPrivateFieldSet(this,we,new DeferredPromise,"f"),this.recognizer.import(n,s);const a=yield __classPrivateFieldGet(this,we,"f").promise;return i.updatePositionReceived(),i.exports?Object.assign(i.exports,a):i.exports=a,this.undoRedoManager.updateModelInStack(i),__classPrivateFieldSet(this,we,void 0,"f"),i}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){return yield this.initalise.promise,this.renderer.resize(i),__classPrivateFieldSet(this,xe,new DeferredPromise,"f"),clearTimeout(__classPrivateFieldGet(this,_e,"f")),__classPrivateFieldSet(this,_e,setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){this.recognizer.resize(i)}))),__classPrivateFieldGet(this,me,"f").resizeTriggerDelay),"f"),yield __classPrivateFieldGet(this,xe,"f").promise,__classPrivateFieldSet(this,xe,void 0,"f"),i}))}undo(){return __awaiter(this,void 0,void 0,(function*(){return yield this.initalise.promise,__classPrivateFieldSet(this,Se,new DeferredPromise,"f"),this.recognizer.undo(),yield __classPrivateFieldGet(this,Se,"f").promise,__classPrivateFieldSet(this,Se,void 0,"f"),this.undoRedoManager.undo()}))}redo(){return __awaiter(this,void 0,void 0,(function*(){return yield this.initalise.promise,__classPrivateFieldSet(this,be,new DeferredPromise,"f"),this.recognizer.redo(),yield __classPrivateFieldGet(this,be,"f").promise,__classPrivateFieldSet(this,be,void 0,"f"),this.undoRedoManager.redo()}))}clear(i){var n;return __awaiter(this,void 0,void 0,(function*(){yield this.initalise.promise,__classPrivateFieldSet(this,Fe,new DeferredPromise,"f"),this.recognizer.clear();const s=i.getClone();return s.clear(),this.undoRedoManager.addModelToStack(s),yield null===(n=__classPrivateFieldGet(this,Fe,"f"))||void 0===n?void 0:n.promise,__classPrivateFieldSet(this,Fe,void 0,"f"),s}))}destroy(){return __awaiter(this,void 0,void 0,(function*(){return this.grabber.detach(),this.renderer.destroy(),this.recognizer.close(1e3,H),Promise.resolve()}))}}me=new WeakMap,_e=new WeakMap,fe=new WeakMap,ye=new WeakMap,Pe=new WeakMap,we=new WeakMap,xe=new WeakMap,Se=new WeakMap,be=new WeakMap,Fe=new WeakMap;class BehaviorsManager{constructor(i,n,s){this.overrideDefaultBehaviors(i,n,s)}overrideDefaultBehaviors(i,n,s){let a;this.behaviors&&this.behaviors.destroy(n),a="REST"===i.server.protocol?new RestBehaviors(i,n):new WSBehaviors(i,n),this.behaviors=Object.assign(a,s)}init(i){return this.behaviors.init(i)}}const Ee={server:{protocol:"WEBSOCKET",scheme:"https",host:"webdemoapi.myscript.com",applicationKey:"",hmacKey:"",useWindowLocation:!1,websocket:{pingEnabled:!0,pingDelay:3e4,maxPingLostCount:10,autoReconnect:!0,maxRetryCount:2,fileChunkSize:3e5}},recognition:{type:"TEXT",alwaysConnected:!0,lang:"en_US",gesture:{enable:!0},export:{"image-resolution":300,jiix:{"bounding-box":!1,strokes:!1,text:{chars:!1,words:!0}}},renderer:{debug:{"draw-text-boxes":!1,"draw-image-boxes":!1}},math:{mimeTypes:["application/x-latex"],solver:{enable:!0,"fractional-part-digits":3,"decimal-separator":".","rounding-mode":"half up","angle-unit":"deg"},margin:{bottom:10,left:15,right:15,top:10},eraser:{"erase-precisely":!1},"undo-redo":{mode:"stroke"}},text:{guides:{enable:!0},mimeTypes:["application/vnd.myscript.jiix"],margin:{top:20,left:10,right:10,bottom:10},eraser:{"erase-precisely":!1}},diagram:{mimeTypes:["application/vnd.myscript.jiix"],eraser:{"erase-precisely":!1}},"raw-content":{recognition:{text:!0,shape:!1},eraser:{"erase-precisely":!1}}},grabber:{listenerOptions:{capture:!1,passive:!0},xyFloatPrecision:0,timestampFloatPrecision:0},rendering:{minHeight:100,minWidth:100,smartGuide:{enable:!0,fadeOut:{enable:!0,duration:5e3}}},triggers:{exportContent:"POINTER_UP",exportContentDelay:1e3,resizeTriggerDelay:100},events:{processDelay:10},"undo-redo":{maxStackSize:10}};class Configuration{constructor(i){this.events=JSON.parse(JSON.stringify(Ee.events)),this.grabber=JSON.parse(JSON.stringify(Ee.grabber)),this.recognition=JSON.parse(JSON.stringify(Ee.recognition)),this.rendering=JSON.parse(JSON.stringify(Ee.rendering)),this.server=JSON.parse(JSON.stringify(Ee.server)),this.triggers=JSON.parse(JSON.stringify(Ee.triggers)),this.overrideDefaultConfiguration(i)}mergeDeep(i,...n){const isObject=i=>i&&"object"==typeof i&&!Array.isArray(i);if(!n.length)return i;const s=n.shift();if(isObject(i)&&isObject(s))for(const n in s)isObject(s[n])?(i[n]||Object.assign(i,{[n]:{}}),this.mergeDeep(i[n],s[n])):Object.assign(i,{[n]:s[n]});return this.mergeDeep(i,...n)}overrideDefaultConfiguration(i){var n,s,a,l,d,c,h;const p=JSON.parse(JSON.stringify(Ee));this.events=this.mergeDeep({},p.events,null==i?void 0:i.events),this.grabber=this.mergeDeep({},p.grabber,null==i?void 0:i.grabber),this.recognition=this.mergeDeep({},p.recognition,null==i?void 0:i.recognition),this.rendering=this.mergeDeep({},p.rendering,null==i?void 0:i.rendering),this.server=this.mergeDeep({},p.server,null==i?void 0:i.server),this.triggers=this.mergeDeep({},p.triggers,null==i?void 0:i.triggers),this["undo-redo"]=this.mergeDeep({},p["undo-redo"],null==i?void 0:i["undo-redo"]),this.recognition.text.mimeTypes=(null===(s=null===(n=null==i?void 0:i.recognition)||void 0===n?void 0:n.text)||void 0===s?void 0:s.mimeTypes)||p.recognition.text.mimeTypes,this.recognition.math.mimeTypes=(null===(l=null===(a=null==i?void 0:i.recognition)||void 0===a?void 0:a.math)||void 0===l?void 0:l.mimeTypes)||p.recognition.math.mimeTypes,this.recognition.diagram.mimeTypes=(null===(c=null===(d=null==i?void 0:i.recognition)||void 0===d?void 0:d.diagram)||void 0===c?void 0:c.mimeTypes)||p.recognition.diagram.mimeTypes,(null===(h=this.server)||void 0===h?void 0:h.useWindowLocation)&&(this.server.scheme=window.location.protocol.indexOf("s")>-1?"https":"http",this.server.host=window.location.host),"REST"===this.server.protocol&&"POINTER_UP"===this.triggers.exportContent&&(this.triggers.exportContent="QUIET_PERIOD",this.triggers.exportContentDelay=Math.max(this.triggers.exportContentDelay,50)),"WEBSOCKET"===this.server.protocol&&"TEXT"===this.recognition.type?this.rendering.smartGuide.enable&&!this.recognition.text.mimeTypes.includes("application/vnd.myscript.jiix")&&this.recognition.text.mimeTypes.push("application/vnd.myscript.jiix"):this.rendering.smartGuide.enable=!1}}class Stroke{constructor(i,n,s="pen"){this.type="stroke",this.pointerId=n,this.pointerType=s,this.x=[],this.y=[],this.t=[],this.p=[],this.l=[],this.color=i.color,this.width=i.width,this["-myscript-pen-width"]=i["-myscript-pen-width"],this["-myscript-pen-fill-style"]=i["-myscript-pen-fill-style"],this["-myscript-pen-fill-color"]=i["-myscript-pen-fill-color"]}}class Model{constructor(i,n,s=(new Date).getTime()){this.rawStrokes=[],this.strokeGroups=[],this.positions={lastSentPosition:-1,lastReceivedPosition:-1,lastRenderedPosition:-1},this.defaultSymbols=[],this.creationTime=s,this.modificationDate=s,this.width=i,this.height=n,this.idle=!0,this.isEmpty=!0}computeDistance(i,n){const s=Math.sqrt(Math.pow(i.y-n.y,2)+Math.pow(i.x-n.x,2));return isNaN(s)?0:s}computeLength(i,n,s){const a=s+this.computeDistance(i,n);return isNaN(a)?0:a}computePressure(i,n,s){let a=1;const l=this.computeDistance(i,n),d=this.computeLength(i,n,s);0===d?a=.5:l===d?a=1:l<10?a=.2+Math.pow(.1*l,.4):l>d-10&&(a=.2+Math.pow(.1*(d-l),.4));const c=a*Math.max(.1,1-.1*Math.sqrt(l));return isNaN(c)?.5:Math.round(100*c)/100}filterPointByAcquisitionDelta(i,n){const s=2+i["-myscript-pen-width"]/4;return 0===i.x.length||0===i.y.length||Math.abs(i.x[i.x.length-1]-n.x)>=s||Math.abs(i.y[i.y.length-1]-n.y)>=s}addPoint(i,n){if(this.filterPointByAcquisitionDelta(i,n)){const s={x:i.x[i.x.length-1],y:i.y[i.y.length-1],p:i.p[i.p.length-1],t:i.t[i.t.length-1]},a=i.l[i.l.length-1];i.x.push(n.x),i.y.push(n.y),i.t.push(n.t),i.p.push(this.computePressure(n,s,a)),i.l.push(this.computeLength(n,s,a))}}addStroke(i){this.rawStrokes.push(i)}extractPendingStrokes(i=this.positions.lastReceivedPosition+1){return this.rawStrokes.slice(i)}addStrokeToGroup(i,n){const s=this.strokeGroups.length-1;if(this.strokeGroups[s]&&(a=this.strokeGroups[s].penStyle,l=n,a["-myscript-pen-fill-color"]===l["-myscript-pen-fill-color"]&&a["-myscript-pen-fill-style"]===l["-myscript-pen-fill-style"]&&a["-myscript-pen-width"]===l["-myscript-pen-width"]&&a.color===l.color&&a.width===l.width))this.strokeGroups[s].strokes.push(i);else{const s={penStyle:n,strokes:[i]};this.strokeGroups.push(s)}var a,l;this.isEmpty=!1}initCurrentStroke(i,n,s,a,l=96){if(a["-myscript-pen-width"]){const i=a["-myscript-pen-width"]*l/25.4;a.width=i/2}this.modificationDate=(new Date).getTime(),this.exports=void 0,this.converts=void 0,this.currentStroke=new Stroke(a,n,s),this.addPoint(this.currentStroke,i)}appendToCurrentStroke(i){this.currentStroke&&this.addPoint(this.currentStroke,i)}endCurrentStroke(i,n){this.currentStroke&&(this.addPoint(this.currentStroke,i),this.addStroke(this.currentStroke),this.addStrokeToGroup(this.currentStroke,n),this.currentStroke=void 0)}extractPendingRecognizedSymbols(i=this.positions.lastRenderedPosition+1){return this.recognizedSymbols?this.recognizedSymbols.slice(i):[]}updatePositionSent(i=this.rawStrokes.length-1){this.positions.lastSentPosition=i}updatePositionReceived(){this.positions.lastReceivedPosition=this.positions.lastSentPosition}updatePositionRendered(i=(this.recognizedSymbols?this.recognizedSymbols.length-1:-1)){this.positions.lastRenderedPosition=i}resetPositionRenderer(){this.positions.lastRenderedPosition=-1}resetPositions(){this.positions.lastSentPosition=-1,this.positions.lastReceivedPosition=-1}getClone(){const i=new Model(this.width,this.height,this.creationTime);return i.modificationDate=JSON.parse(JSON.stringify(this.modificationDate)),i.defaultSymbols=JSON.parse(JSON.stringify(this.defaultSymbols)),i.currentStroke=this.currentStroke?JSON.parse(JSON.stringify(this.currentStroke)):void 0,i.rawStrokes=JSON.parse(JSON.stringify(this.rawStrokes)),i.strokeGroups=JSON.parse(JSON.stringify(this.strokeGroups)),i.positions=JSON.parse(JSON.stringify(this.positions)),i.exports=this.exports?JSON.parse(JSON.stringify(this.exports)):void 0,i.converts=this.converts?JSON.parse(JSON.stringify(this.converts)):void 0,i.recognizedSymbols=this.recognizedSymbols?JSON.parse(JSON.stringify(this.recognizedSymbols)):void 0,i.idle=this.idle,i.isEmpty=this.isEmpty,i}clear(){this.modificationDate=(new Date).getTime(),this.currentStroke=void 0,this.rawStrokes=[],this.strokeGroups=[],this.positions.lastSentPosition=-1,this.positions.lastReceivedPosition=-1,this.positions.lastRenderedPosition=-1,this.recognizedSymbols=void 0,this.exports=void 0,this.converts=void 0,this.idle=!0,this.isEmpty=!0}}const Te={color:"#000000",width:0,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},Le={ink:{color:"#000000",width:1,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},".math":{"font-family":"STIXGeneral"},".math-solved":{"font-family":"STIXGeneral",color:"#A8A8A8FF"},".text":{"font-family":"MyScriptInter","font-size":10}};var Ae,Ie,We,De,Ne,ze,Re,je,Oe,He,Be,Xe,$e,Ue,Je,Ve,Ze,qe,Qe,Ye,Ke,et,tt,it,nt,st,rt,ot,at,lt,dt,ct,ht,pt,ut,vt,gt,mt,_t,ft;class StyleManager{constructor(i,n){Ae.set(this,void 0),Ie.set(this,void 0),this.overrideDefaultPenStyle(i),this.overrideDefaultTheme(n)}get penStyle(){return __classPrivateFieldGet(this,Ae,"f")}get theme(){return __classPrivateFieldGet(this,Ie,"f")}overrideDefaultPenStyle(i){const n=Object.assign(Object.assign({},Te),i||{});__classPrivateFieldSet(this,Ae,n,"f")}overrideDefaultTheme(i){const n=Object.assign(Object.assign({},Le),i||{});__classPrivateFieldSet(this,Ie,n,"f")}}Ae=new WeakMap,Ie=new WeakMap;class SmartGuide{constructor(){We.add(this),De.set(this,void 0),Ne.set(this,void 0),ze.set(this,void 0),Re.set(this,void 0),je.set(this,void 0),Oe.set(this,void 0),He.set(this,void 0),Be.set(this,void 0),Xe.set(this,void 0),$e.set(this,void 0),Ue.set(this,void 0),Je.set(this,void 0),at.set(this,(i=>{var n,s,a,l,d;const c=parseInt(i.id.replace("word-","").replace(this.uuid,"")),h=null===(n=this.jiix)||void 0===n?void 0:n.words;if(this.wordToChange=h[c],this.wordToChange&&(this.wordToChange.id=c.toString(),__classPrivateFieldGet(this,Oe,"f").innerHTML="",null===(s=this.wordToChange)||void 0===s?void 0:s.candidates)){__classPrivateFieldGet(this,Oe,"f").style.display="flex",this.wordToChange.candidates.forEach(((i,n)=>{var s;(null===(s=this.wordToChange)||void 0===s?void 0:s.label)===i?__classPrivateFieldGet(this,Oe,"f").innerHTML+=`<span id="cdt-${n}${this.uuid}" class="selected-word">${i}</span>`:__classPrivateFieldGet(this,Oe,"f").innerHTML+=`<span id="cdt-${n}${this.uuid}">${i}</span>`}));const n=48,s=i.getBoundingClientRect().left-60;__classPrivateFieldGet(this,Oe,"f").style.top=`${n}px`,__classPrivateFieldGet(this,Oe,"f").style.left=`${s}px`;const c=null===(l=null===(a=i.parentNode)||void 0===a?void 0:a.parentNode)||void 0===l?void 0:l.parentNode;c&&c.insertBefore(__classPrivateFieldGet(this,Oe,"f"),null===(d=i.parentNode)||void 0===d?void 0:d.parentNode)}})),ht.set(this,(i=>{i.preventDefault(),i.stopPropagation(),__classPrivateFieldGet(this,Je,"f")?__classPrivateFieldGet(this,We,"m",ct).call(this):__classPrivateFieldGet(this,We,"m",dt).call(this),__classPrivateFieldGet(this,We,"m",lt).call(this)})),pt.set(this,(i=>{i.preventDefault(),i.stopPropagation(),this.globalEvent.emitConvert(),__classPrivateFieldGet(this,We,"m",ct).call(this)})),ut.set(this,(i=>__awaiter(this,void 0,void 0,(function*(){i.preventDefault(),i.stopPropagation();try{__classPrivateFieldGet(this,We,"m",ct).call(this);let i="Nothing to copy";__classPrivateFieldGet(this,ze,"f").innerText&&(i=`"${__classPrivateFieldGet(this,ze,"f").innerText}" copied to clipboard`,yield navigator.clipboard.writeText(__classPrivateFieldGet(this,ze,"f").innerText)),this.globalEvent.emitNotif(i)}catch(i){this.globalEvent.emitError(i)}})))),vt.set(this,(i=>{i.preventDefault(),i.stopPropagation(),this.globalEvent.emitClear(),__classPrivateFieldGet(this,We,"m",ct).call(this)})),gt.set(this,(i=>{var n,s,a,l;i.preventDefault(),i.stopPropagation();const d=i.target.innerText;this.jiix&&d!==(null===(n=this.wordToChange)||void 0===n?void 0:n.label)&&(null===(a=null===(s=this.wordToChange)||void 0===s?void 0:s.candidates)||void 0===a?void 0:a.includes(d))&&(this.jiix.words[parseInt(null===(l=this.wordToChange)||void 0===l?void 0:l.id)].label=d,this.globalEvent.emitImport(this.jiix,B)),__classPrivateFieldGet(this,Oe,"f").style.display="none"})),mt.set(this,(i=>{i.preventDefault(),i.stopPropagation(),__classPrivateFieldGet(this,We,"m",ct).call(this);const n=i.target;n.id!==__classPrivateFieldGet(this,ze,"f").id?__classPrivateFieldGet(this,at,"f").call(this,n):__classPrivateFieldGet(this,We,"m",lt).call(this)})),_t.set(this,(()=>{__classPrivateFieldGet(this,We,"m",lt).call(this),__classPrivateFieldGet(this,We,"m",ct).call(this)})),this.uuid=i(),this.margin={bottom:0,left:0,right:0,top:0},__classPrivateFieldGet(this,We,"m",Ve).call(this),__classPrivateFieldGet(this,We,"m",Ze).call(this),__classPrivateFieldGet(this,We,"m",qe).call(this),__classPrivateFieldGet(this,We,"m",Qe).call(this),__classPrivateFieldGet(this,We,"m",Ye).call(this),__classPrivateFieldGet(this,We,"m",Ke).call(this),__classPrivateFieldGet(this,We,"m",et).call(this),__classPrivateFieldGet(this,We,"m",tt).call(this),__classPrivateFieldGet(this,We,"m",it).call(this),__classPrivateFieldGet(this,We,"m",nt).call(this)}get globalEvent(){return GlobalEvent.getInstance()}init(i,n,s){i.appendChild(__classPrivateFieldGet(this,De,"f")),__classPrivateFieldGet(this,De,"f").appendChild(__classPrivateFieldGet(this,je,"f")),__classPrivateFieldGet(this,Ne,"f").appendChild(__classPrivateFieldGet(this,ze,"f")),__classPrivateFieldGet(this,De,"f").appendChild(__classPrivateFieldGet(this,Ne,"f")),__classPrivateFieldGet(this,De,"f").appendChild(__classPrivateFieldGet(this,Re,"f")),__classPrivateFieldGet(this,He,"f").appendChild(__classPrivateFieldGet(this,Be,"f")),__classPrivateFieldGet(this,He,"f").appendChild(__classPrivateFieldGet(this,Xe,"f")),__classPrivateFieldGet(this,He,"f").appendChild(__classPrivateFieldGet(this,$e,"f")),__classPrivateFieldGet(this,De,"f").appendChild(__classPrivateFieldGet(this,He,"f")),__classPrivateFieldGet(this,He,"f").classList.add("close"),__classPrivateFieldSet(this,Je,!1,"f"),__classPrivateFieldGet(this,De,"f").appendChild(__classPrivateFieldGet(this,Oe,"f")),__classPrivateFieldGet(this,Oe,"f").style.display="none",this.margin=n,this.renderingConfiguration=s,__classPrivateFieldGet(this,We,"m",ft).call(this),__classPrivateFieldGet(this,We,"m",rt).call(this),this.renderingConfiguration.smartGuide.fadeOut.enable&&__classPrivateFieldGet(this,We,"m",st).call(this,this.renderingConfiguration.smartGuide.fadeOut.duration),this.resize()}resize(){const i=3.779527559,n=this.margin.top*i,s=this.margin.left*i,a=this.margin.right*i,l=n-45.354330708;__classPrivateFieldGet(this,De,"f").style.top=`${l}px`,__classPrivateFieldGet(this,De,"f").style.left=`${s}px`,__classPrivateFieldGet(this,De,"f").style.right=`${a}px`;let d=__classPrivateFieldGet(this,je,"f").offsetWidth;__classPrivateFieldGet(this,Ne,"f").style.marginLeft=`${d}px`,__classPrivateFieldGet(this,Ne,"f").style.width=__classPrivateFieldGet(this,De,"f").clientWidth-__classPrivateFieldGet(this,je,"f").offsetWidth-__classPrivateFieldGet(this,Re,"f").offsetHeight+"px",d+=__classPrivateFieldGet(this,Ne,"f").offsetWidth,__classPrivateFieldGet(this,He,"f").style.left=`${d-__classPrivateFieldGet(this,He,"f").offsetWidth+__classPrivateFieldGet(this,Re,"f").offsetWidth}px`,__classPrivateFieldGet(this,He,"f").style.top=`${__classPrivateFieldGet(this,Re,"f").offsetHeight}px`,__classPrivateFieldGet(this,Re,"f").style.left=`${d}px`}update(i){var n,s;this.jiix=i;const createWordSpan=(i,n)=>{const s=document.createElement("span");return s.id=`word-${i}${this.uuid}`,n?s.textContent=n.label:s.innerHTML="&nbsp;",s};(()=>{var i;if(__classPrivateFieldGet(this,ze,"f").innerHTML="",null===(i=this.jiix)||void 0===i?void 0:i.words){const i=this.jiix.words,n=document.createDocumentFragment();i.forEach(((s,a)=>{var l,d;if(" "===s.label||s.label.includes("\n"))n.appendChild(createWordSpan(a));else if(a!==i.length-1)n.appendChild(createWordSpan(a,s));else{__classPrivateFieldGet(this,ze,"f").appendChild(n),this.lastWord&&(this.lastWord=s);const i=createWordSpan(a,s);(null===(l=this.lastWord)||void 0===l?void 0:l.candidates)!==s.candidates&&(null===(d=this.lastWord)||void 0===d?void 0:d.label)!==s.label?(i.classList.add("added-word"),__classPrivateFieldGet(this,ze,"f").appendChild(i),__classPrivateFieldGet(this,Ne,"f").scrollLeft=i.offsetLeft,this.lastWord=s):(__classPrivateFieldGet(this,ze,"f").appendChild(i),__classPrivateFieldGet(this,Ne,"f").scrollLeft=i.offsetLeft)}}))}})(),(null===(s=null===(n=this.jiix)||void 0===n?void 0:n.words)||void 0===s?void 0:s.length)&&__classPrivateFieldGet(this,We,"m",rt).call(this)}clear(){__classPrivateFieldGet(this,ze,"f").innerHTML="",__classPrivateFieldGet(this,Oe,"f").innerHTML="",__classPrivateFieldGet(this,We,"m",ot).call(this)}}De=new WeakMap,Ne=new WeakMap,ze=new WeakMap,Re=new WeakMap,je=new WeakMap,Oe=new WeakMap,He=new WeakMap,Be=new WeakMap,Xe=new WeakMap,$e=new WeakMap,Ue=new WeakMap,Je=new WeakMap,at=new WeakMap,ht=new WeakMap,pt=new WeakMap,ut=new WeakMap,vt=new WeakMap,gt=new WeakMap,mt=new WeakMap,_t=new WeakMap,We=new WeakSet,Ve=function _SmartGuide_createWrapperElement(){__classPrivateFieldSet(this,De,document.createElement("div"),"f"),__classPrivateFieldGet(this,De,"f").id=`smartguide-${this.uuid}`,__classPrivateFieldGet(this,De,"f").classList.add("smartguide")},Ze=function _SmartGuide_createPrompterContainerElement(){__classPrivateFieldSet(this,Ne,document.createElement("div"),"f"),__classPrivateFieldGet(this,Ne,"f").id=`prompter-container-${this.uuid}`,__classPrivateFieldGet(this,Ne,"f").classList.add("prompter-container")},qe=function _SmartGuide_createPrompterTextElement(){__classPrivateFieldSet(this,ze,document.createElement("div"),"f"),__classPrivateFieldGet(this,ze,"f").id=`prompter-text-${this.uuid}`,__classPrivateFieldGet(this,ze,"f").classList.add("prompter-text"),__classPrivateFieldGet(this,ze,"f").setAttribute("touch-action","none")},Qe=function _SmartGuide_createEllipsisElement(){__classPrivateFieldSet(this,Re,document.createElement("div"),"f"),__classPrivateFieldGet(this,Re,"f").id=`ellipsis-${this.uuid}`,__classPrivateFieldGet(this,Re,"f").classList.add("ellipsis"),__classPrivateFieldGet(this,Re,"f").innerHTML="..."},Ye=function _SmartGuide_createTagElement(){__classPrivateFieldSet(this,je,document.createElement("div"),"f"),__classPrivateFieldGet(this,je,"f").id=`tag-icon-${this.uuid}`,__classPrivateFieldGet(this,je,"f").classList.add("tag-icon"),__classPrivateFieldGet(this,je,"f").innerHTML="&#182;"},Ke=function _SmartGuide_createCandidatesElement(){__classPrivateFieldSet(this,Oe,document.createElement("div"),"f"),__classPrivateFieldGet(this,Oe,"f").id=`candidates-${this.uuid}`,__classPrivateFieldGet(this,Oe,"f").classList.add("candidates")},et=function _SmartGuide_createMoreMenuElement(){__classPrivateFieldSet(this,He,document.createElement("div"),"f"),__classPrivateFieldGet(this,He,"f").id=`more-menu-${this.uuid}`,__classPrivateFieldGet(this,He,"f").classList.add("more-menu")},tt=function _SmartGuide_createConvertElement(){__classPrivateFieldSet(this,Be,document.createElement("button"),"f"),__classPrivateFieldGet(this,Be,"f").id=`convert-${this.uuid}`,__classPrivateFieldGet(this,Be,"f").classList.add("options-label-button"),__classPrivateFieldGet(this,Be,"f").innerHTML="Convert"},it=function _SmartGuide_createCopyElement(){__classPrivateFieldSet(this,Xe,document.createElement("button"),"f"),__classPrivateFieldGet(this,Xe,"f").id=`copy-${this.uuid}`,__classPrivateFieldGet(this,Xe,"f").classList.add("options-label-button"),__classPrivateFieldGet(this,Xe,"f").innerHTML="Copy"},nt=function _SmartGuide_createDeleteElement(){__classPrivateFieldSet(this,$e,document.createElement("button"),"f"),__classPrivateFieldGet(this,$e,"f").id=`delete-${this.uuid}`,__classPrivateFieldGet(this,$e,"f").classList.add("options-label-button"),__classPrivateFieldGet(this,$e,"f").innerHTML="Delete"},st=function _SmartGuide_initFadeOutObserver(i=3e3){new MutationObserver((n=>{n.forEach((()=>{clearTimeout(__classPrivateFieldGet(this,Ue,"f")),("none"!==__classPrivateFieldGet(this,Oe,"f").style.display||__classPrivateFieldGet(this,Je,"f"))&&(document.contains(__classPrivateFieldGet(this,Oe,"f"))||document.contains(__classPrivateFieldGet(this,He,"f")))||__classPrivateFieldSet(this,Ue,setTimeout((()=>{__classPrivateFieldGet(this,We,"m",ot).call(this)}),i),"f")}))})).observe(__classPrivateFieldGet(this,De,"f"),{childList:!0,subtree:!0,attributes:!0})},rt=function _SmartGuide_show(){__classPrivateFieldGet(this,De,"f").classList.remove("smartguide-out"),__classPrivateFieldGet(this,De,"f").classList.add("smartguide-in")},ot=function _SmartGuide_hide(){__classPrivateFieldGet(this,De,"f").classList.add("smartguide-out"),__classPrivateFieldGet(this,De,"f").classList.remove("smartguide-in")},lt=function _SmartGuide_hideCandidates(){__classPrivateFieldGet(this,Oe,"f").style.display="none"},dt=function _SmartGuide_openMenu(){__classPrivateFieldGet(this,He,"f").classList.add("open"),__classPrivateFieldGet(this,He,"f").classList.remove("close"),__classPrivateFieldSet(this,Je,!0,"f")},ct=function _SmartGuide_closeMenu(){__classPrivateFieldGet(this,He,"f").classList.add("close"),__classPrivateFieldGet(this,He,"f").classList.remove("open"),__classPrivateFieldSet(this,Je,!1,"f")},ft=function _SmartGuide_addListeners(){__classPrivateFieldGet(this,Re,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,ht,"f").call(this,i))),__classPrivateFieldGet(this,Be,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,pt,"f").call(this,i))),__classPrivateFieldGet(this,Xe,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,ut,"f").call(this,i))),__classPrivateFieldGet(this,$e,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,vt,"f").call(this,i))),__classPrivateFieldGet(this,ze,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,mt,"f").call(this,i))),__classPrivateFieldGet(this,Oe,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,gt,"f").call(this,i))),document.addEventListener("pointerdown",(()=>__classPrivateFieldGet(this,_t,"f").call(this)))};var yt,Pt,wt,xt,St,bt,Ft,kt,Gt,Mt,Ct,Et,Tt,Lt,At,It,Wt,Dt,Nt,zt,Rt,jt,Ot,Ht,Bt,Xt;!function styleInject(i,n){void 0===n&&(n={});var s=n.insertAt;if(i&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css","top"===s&&a.firstChild?a.insertBefore(l,a.firstChild):a.appendChild(l),l.styleSheet?l.styleSheet.cssText=i:l.appendChild(document.createTextNode(i))}}('/* @import url(../node_modules/perfect-scrollbar/css/perfect-scrollbar.css); */\n\n.ms-editor {\n    position: relative;\n    z-index: 20;\n    color: #1A9FFF;\n    font-family: sans-serif;\n}\n\n.ms-editor.erasing {\n    cursor: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEsSURBVDiNrdO7SgNBFMbx/3fmCbQ1tunDIayFBvFSKxbxBfSdBPEBtLIWb3Ebl4R9AQWLkE70CWbHZl1Eg2iSr5vL+c1hhhFTMhwOdyX1gQ2gVU+PgTyldNHtdq+/1+jroCiKtpmdSupNO6ApkgZmdtzpdJ5+QGVZ9qqqugSWfkO+5F3SnrvnDVQURTuE8PgP5DNvkjJ3fzaAEMLJDAjAclVVZwCqL/ZqBqSJme2YpMN5EIAYY9+A9XkhST0DVuaFgJYtAAGoDJgsAJoYkM+rSHqwlNL5Ajq6EMBoNLoBtmbsZuDumwYQYzwCXmdw3oAjAAPIsuxF0kG98GdE0r67PzcQgLvnIYQ14P4PyF39WZuH0rRdZVluxxj7kjaA1Xp6nFLKzezc3W+/13wAItdV6XjME1AAAAAASUVORK5CYII=\') 10 10, auto;\n}\n\n.ms-editor canvas,\n.ms-editor svg {\n    z-index: 15;\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 100%;\n}\n\n.ms-editor canvas.ms-rendering-canvas {\n    z-index: 10;\n    pointer-events: none;\n    background-image: linear-gradient(to right, #F5F6F7 1px, transparent 1px),\n    linear-gradient(to bottom, #F5F6F7 1px, transparent 1px);\n    background-size: 18px 18px;\n}\n\n.ms-editor svg {\n    z-index: 10;\n    pointer-events: none;\n}\n.ms-editor svg[data-layer="BACKGROUND"] {\n    z-index: 9;\n}\n\n.ms-editor .loader {\n    z-index: 30;\n    position: absolute;\n    width: 120px;\n    height: 120px;\n    top: calc(50% - 60px);\n    left: calc(50% - 60px);\n    border: 16px solid #F5F6F7;\n    border-radius: 50%;\n    border-top-color: #1A9FFF;\n    -webkit-animation: spin 2s linear infinite;\n    animation: spin 2s linear infinite;\n}\n\n.ms-editor .message {\n    z-index: 25;\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    top: calc(50% - 100px);\n    left: calc(50% - 100px);\n    font-size: 16px;\n    text-align: center;\n    word-wrap: break-word;\n}\n\n.ms-editor .error-msg::before {\n    content: url("data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCA3Ni41IDYxMiA0NTkiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPgogICAgPHBhdGggZmlsbD0iIzFBOUZGRiIgZD0iTTQ5NC43LDIyOS41Yy0xNy44NTEtODYuNy05NC4zNTEtMTUzLTE4OC43LTE1M2MtMzguMjUsMC03My45NSwxMC4yLTEwMiwzMC42bDM4LjI1LDM4LjI1IGMxNy44NS0xMi43NSw0MC44LTE3Ljg1LDYzLjc1LTE3Ljg1Yzc2LjUsMCwxNDAuMjUsNjMuNzUsMTQwLjI1LDE0MC4yNXYxMi43NWgzOC4yNWM0My4zNSwwLDc2LjUsMzMuMTUsNzYuNSw3Ni41IGMwLDI4LjA1LTE1LjMsNTMuNTUtNDAuOCw2Ni4zbDM4LjI1LDM4LjI1QzU5MS42LDQzOC42LDYxMiw0MDAuMzUsNjEyLDM1N0M2MTIsMjkwLjcsNTU4LjQ1LDIzNC42LDQ5NC43LDIyOS41eiBNNzYuNSwxMDkuNjUgbDcxLjQsNjguODVDNjYuMywxODMuNiwwLDI0OS45LDAsMzMxLjVjMCw4NC4xNSw2OC44NSwxNTMsMTUzLDE1M2gyOTguMzVsNTEsNTFsMzMuMTUtMzMuMTVMMTA5LjY1LDc2LjVMNzYuNSwxMDkuNjV6IE0xOTYuMzUsMjI5LjVsMjA0LDIwNEgxNTNjLTU2LjEsMC0xMDItNDUuOS0xMDItMTAyYzAtNTYuMSw0NS45LTEwMiwxMDItMTAySDE5Ni4zNXoiIC8+Cjwvc3ZnPgo=");\n}\n\n.ms-editor .info-msg::before {\n    content: "";\n    background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmlld0JveD0iMCAwIDI0IDI0IgogIGZpbGw9Im5vbmUiCiAgc3Ryb2tlPSIjMUE5RkZGIgogIHN0cm9rZS13aWR0aD0iMiIKICBzdHJva2UtbGluZWNhcD0icm91bmQiCiAgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIKPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiAvPgogIDxsaW5lIHgxPSIxMiIgeTE9IjE2IiB4Mj0iMTIiIHkyPSIxMiIgLz4KICA8bGluZSB4MT0iMTIiIHkxPSI4IiB4Mj0iMTIuMDEiIHkyPSI4IiAvPgo8L3N2Zz4=");;\n    background-size: 100% 100%;\n    display: block;\n    margin: auto;\n    padding-bottom: 10px;\n    height: 25px;\n    width:25px;\n}\n\n.ms-editor .smartguide {\n    position: absolute;\n    z-index: 40;\n    font-size: 16px;\n}\n\n.ms-editor .smartguide.smartguide-in {\n    visibility: visible !important;\n    transition: opacity 0.5s;\n    opacity: 1;\n}\n\n.ms-editor .smartguide.smartguide-out {\n    transition: opacity 1s, visibility 1s;\n    visibility: hidden !important;\n    opacity: 0;\n}\n\n.ms-editor .smartguide .tag-icon {\n    padding: 0 18px;\n    border: 1px solid #959DA6;\n    font-weight: bold;\n    font-size: large;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 48px;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n}\n\n.ms-editor .smartguide .ellipsis {\n    cursor: pointer;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 38px;\n    padding: 0 8px;\n    font-weight: bold;\n    font-size: x-large;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .ellipsis:active {\n    background-color: #e0e0e0;\n}\n\n.ms-editor .smartguide .prompter-container {\n    background-color: rgba(255, 255, 255, 0.9);\n    height: 48px;\n    line-height: 48px;\n    overflow: hidden;\n    white-space: nowrap;\n    display: block;\n    text-align: left;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 30;\n    color: #bfbfbf;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .prompter-container > div > span {\n    cursor: pointer;\n    display: inline-block;\n}\n\n.ms-editor .smartguide .prompter-container .prompter-text {\n    margin-left: 12px;\n}\n\n.ms-editor .smartguide .prompter-container .prompter-text .added-word {\n    animation: 0.1s linear word-added,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .prompter-container .prompter-text .modified-word {\n    animation: 0.1s linear word-modified,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .candidates {\n    color: black;\n    flex-direction: column;\n    text-align: center;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    box-shadow: 2px 2px 12px #BDBDBD, -2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n    z-index: 100;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .candidates > span {\n    cursor: pointer;\n    padding: 2px 20px;\n}\n\n.ms-editor .smartguide .candidates > span:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .candidates > span:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .candidates .selected-word {\n    font-weight: bold;\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .more-menu {\n    display: flex;\n    flex-direction: column;\n    margin-right: 12px;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    z-index: 100;\n    box-shadow: 2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n    overflow: hidden;\n    transition: max-height 2s ease-out, opacity 1s, visibility 0.5s linear;\n}\n.ms-editor .smartguide .more-menu.open {\n    max-height: 500px;\n    visibility: visible;\n    opacity: 1;\n}\n.ms-editor .smartguide .more-menu.close {\n    max-height: 0;\n    visibility: hidden;\n    opacity: 0;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button {\n    color: black;\n    font-size: 16px;\n    cursor: pointer;\n    box-sizing: border-box;\n    background: transparent;\n    border: none;\n    padding: 0 24px;\n    margin: 0;\n    height: 40px;\n    outline: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .ps__rail-x {\n    top: 32px !important;\n}\n\n/** Stroke **/\n\n.ms-editor .removed-stroke {\n    opacity: 0;\n    transition: opacity 0.1s ease-in-out;\n}\n\n.ms-editor .added-stroke {\n    animation: 0.2s opacity-appear;\n}\n\n@keyframes color-input {\n    0% {\n        color: black;\n    }\n    100% {\n        color: #bfbfbf;\n    }\n}\n\n@keyframes word-added {\n    0% {\n        transform: translate(5px, 0);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes word-modified {\n    0% {\n        transform: translate(0, 5px);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes opacity-appear {\n    0% {\n        opacity: 0;\n    }\n    100% {\n        opacity : 1;\n    }\n}\n\n@keyframes spin {\n    0% {\n        transform: rotate(0deg);\n    }\n    100% {\n        transform: rotate(360deg);\n    }\n}\n\n@-webkit-keyframes spin {\n    0% {\n        -webkit-transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n    }\n}\n'),function(i){i.Mouse="mouse",i.Pen="pen",i.Touche="touch",i.Eraser="eraser"}(Xt||(Xt={}));class Editor{constructor(i,n){yt.add(this),Pt.set(this,void 0),wt.set(this,void 0),xt.set(this,void 0),St.set(this,void 0),bt.set(this,void 0),Ft.set(this,void 0),kt.set(this,void 0),Gt.set(this,!1),this.debug=!1,this.wrapperHTML=i,this.wrapperHTML.classList.add((null==n?void 0:n.globalClassCss)||"ms-editor"),__classPrivateFieldSet(this,Pt,document.createElement("div"),"f"),__classPrivateFieldGet(this,Pt,"f").classList.add("loader"),__classPrivateFieldSet(this,Pt,this.wrapperHTML.appendChild(__classPrivateFieldGet(this,Pt,"f")),"f"),__classPrivateFieldGet(this,Pt,"f").style.display="initial",__classPrivateFieldSet(this,wt,document.createElement("div"),"f"),__classPrivateFieldGet(this,wt,"f").classList.add("message"),__classPrivateFieldSet(this,wt,this.wrapperHTML.appendChild(__classPrivateFieldGet(this,wt,"f")),"f"),__classPrivateFieldGet(this,wt,"f").style.display="none",__classPrivateFieldSet(this,kt,Xt.Pen,"f"),__classPrivateFieldSet(this,bt,new StyleManager(null==n?void 0:n.penStyle,null==n?void 0:n.theme),"f"),__classPrivateFieldSet(this,xt,new Configuration(null==n?void 0:n.configuration),"f"),__classPrivateFieldSet(this,Ft,new SmartGuide,"f");const s=Math.max(this.wrapperHTML.clientWidth,this.configuration.rendering.minWidth),a=Math.max(this.wrapperHTML.clientHeight,this.configuration.rendering.minHeight);this.model=new Model(s,a),__classPrivateFieldSet(this,St,new BehaviorsManager(this.configuration,this.model,null==n?void 0:n.behaviors),"f"),__classPrivateFieldGet(this,yt,"m",At).call(this),__classPrivateFieldGet(this,yt,"m",Lt).call(this),__classPrivateFieldGet(this,yt,"m",Dt).call(this)}get initialized(){return __classPrivateFieldGet(this,Gt,"f")}get configuration(){return __classPrivateFieldGet(this,xt,"f")}set configuration(i){__classPrivateFieldGet(this,xt,"f").overrideDefaultConfiguration(i),this.model.clear(),this.model.height=Math.max(this.wrapperHTML.clientHeight,__classPrivateFieldGet(this,xt,"f").rendering.minHeight),this.model.width=Math.max(this.wrapperHTML.clientWidth,__classPrivateFieldGet(this,xt,"f").rendering.minWidth),__classPrivateFieldGet(this,St,"f").overrideDefaultBehaviors(__classPrivateFieldGet(this,xt,"f"),this.model),__classPrivateFieldGet(this,yt,"m",At).call(this),__classPrivateFieldGet(this,yt,"m",Lt).call(this)}get mode(){return __classPrivateFieldGet(this,kt,"f")}get events(){return GlobalEvent.getInstance()}setMode(i){__classPrivateFieldSet(this,kt,i,"f"),__classPrivateFieldGet(this,kt,"f")===Xt.Eraser?this.wrapperHTML.classList.add("erasing"):(document.body.style.cursor="initial",this.wrapperHTML.classList.remove("erasing"))}undo(){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,yt,"a",Mt).undo(),this.model}))}redo(){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,yt,"a",Mt).redo(),this.model}))}clear(){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,yt,"a",Mt).clear(this.model),this.model}))}resize(){return __awaiter(this,void 0,void 0,(function*(){return this.configuration.rendering.smartGuide.enable&&__classPrivateFieldGet(this,Ft,"f").resize(),this.model.height=Math.max(this.wrapperHTML.clientHeight,this.configuration.rendering.minHeight),this.model.width=Math.max(this.wrapperHTML.clientWidth,this.configuration.rendering.minWidth),this.model=yield __classPrivateFieldGet(this,yt,"a",Mt).resize(this.model),this.model}))}export(i){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,yt,"a",Mt).export(this.model,i),this.model}))}convert(i){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,yt,"a",Mt).convert(this.model,null==i?void 0:i.conversionState,null==i?void 0:i.mimeTypes),this.events.emitConverted(this.model.converts),this.model}))}import(i,n){var s;return __awaiter(this,void 0,void 0,(function*(){return __classPrivateFieldGet(this,yt,"a",Mt).import?(this.model=yield __classPrivateFieldGet(this,yt,"a",Mt).import(this.model,i,n),this.events.emitImported(null===(s=this.model.exports)||void 0===s?void 0:s["application/vnd.myscript.jiix"]),this.model):Promise.reject("Import impossible, behaviors has no import function")}))}}function getAvailableLanguageList(i){var n,s;return __awaiter(this,void 0,void 0,(function*(){if((null===(n=null==i?void 0:i.server)||void 0===n?void 0:n.scheme)&&(null===(s=null==i?void 0:i.server)||void 0===s?void 0:s.host)){const n=i.server;return(yield fetch(`${n.scheme}://${n.host}/api/v4.0/iink/availableLanguageList`)).json()}return Promise.reject("Cannot get languages ! Please check your server configuration!")}))}Pt=new WeakMap,wt=new WeakMap,xt=new WeakMap,St=new WeakMap,bt=new WeakMap,Ft=new WeakMap,kt=new WeakMap,Gt=new WeakMap,yt=new WeakSet,Mt=function _Editor_behaviors_get(){return __classPrivateFieldGet(this,St,"f").behaviors},Ct=function _Editor_grabber_get(){return __classPrivateFieldGet(this,St,"f").behaviors.grabber},Et=function _Editor_theme_get(){return __classPrivateFieldGet(this,bt,"f").theme},Tt=function _Editor_penStyle_get(){return __classPrivateFieldGet(this,bt,"f").penStyle},Lt=function _Editor_initializeSmartGuide(){if(this.configuration.rendering.smartGuide.enable){let i;switch(this.configuration.recognition.type){case"TEXT":i=this.configuration.recognition.text.margin;break;case"MATH":i=this.configuration.recognition.math.margin;break;default:i={top:20,left:10,right:10,bottom:10}}__classPrivateFieldGet(this,Ft,"f").init(this.wrapperHTML,i,this.configuration.rendering)}else __classPrivateFieldGet(this,Ft,"f").clear()},At=function _Editor_initalizeBehaviors(){__classPrivateFieldGet(this,St,"f").init(this.wrapperHTML).then((()=>__awaiter(this,void 0,void 0,(function*(){__classPrivateFieldGet(this,yt,"a",Ct).onPointerDown=(i,n)=>__classPrivateFieldGet(this,yt,"m",Ot).call(this,i,n),__classPrivateFieldGet(this,yt,"a",Ct).onPointerMove=(i,n)=>__classPrivateFieldGet(this,yt,"m",Ht).call(this,i,n),__classPrivateFieldGet(this,yt,"a",Ct).onPointerUp=(i,n)=>__classPrivateFieldGet(this,yt,"m",Bt).call(this,i,n),__classPrivateFieldSet(this,Gt,!0,"f"),this.wrapperHTML.editor=this,this.events.emitLoaded()})))).catch((i=>{__classPrivateFieldSet(this,Gt,!1,"f"),__classPrivateFieldGet(this,yt,"m",It).call(this,i),this.events.emitError(i)})).finally((()=>{__classPrivateFieldGet(this,Pt,"f").style.display="none"}))},It=function _Editor_showError(i){if(__classPrivateFieldGet(this,wt,"f").style.display="initial",__classPrivateFieldGet(this,wt,"f").classList.add("error-msg"),__classPrivateFieldGet(this,wt,"f").classList.remove("info-msg"),__classPrivateFieldGet(this,wt,"f").innerText=i.message,this.debug){const n=document.createElement("p");n.innerHTML=i.name,__classPrivateFieldGet(this,wt,"f").prepend(n);const s=document.createElement("p");s.style.width="50vw",s.style.marginLeft="calc(-25vw + 100px)",s.innerHTML=i.stack||"",__classPrivateFieldGet(this,wt,"f").appendChild(s)}},Wt=function _Editor_showNotif(i,n=1e3){__classPrivateFieldGet(this,wt,"f").style.display="initial",__classPrivateFieldGet(this,wt,"f").classList.add("info-msg"),__classPrivateFieldGet(this,wt,"f").classList.remove("error-msg"),__classPrivateFieldGet(this,wt,"f").innerText=i,setTimeout((()=>{__classPrivateFieldGet(this,wt,"f").style.display="none"}),n)},Dt=function _Editor_addListeners(){this.events.addEventListener(E,(()=>this.convert({conversionState:"DIGITAL_EDIT"}))),this.events.addEventListener(G,(()=>this.clear())),this.events.addEventListener(L,(i=>__classPrivateFieldGet(this,yt,"m",jt).call(this,i))),this.events.addEventListener(C,(i=>__classPrivateFieldGet(this,yt,"m",Rt).call(this,i))),this.events.addEventListener(S,(i=>__classPrivateFieldGet(this,yt,"m",zt).call(this,i))),this.events.addEventListener(T,(i=>__classPrivateFieldGet(this,yt,"m",Nt).call(this,i)))},Nt=function _Editor_onNotif(i){const n=i.detail;__classPrivateFieldGet(this,yt,"m",Wt).call(this,n.message,n.timeout)},zt=function _Editor_onExport(i){if(this.configuration.rendering.smartGuide.enable){const n=i.detail;if(n["application/vnd.myscript.jiix"]){const i=n["application/vnd.myscript.jiix"];__classPrivateFieldGet(this,Ft,"f").update(JSON.parse(i))}}},Rt=function _Editor_onImport(i){const n=i,s=n.detail.jiix,a=n.detail.mimeType;this.import(new Blob([JSON.stringify(s)],{type:a}),a)},jt=function _Editor_onError(i){const n=i,s=null==n?void 0:n.detail;__classPrivateFieldGet(this,yt,"m",It).call(this,s)},Ot=function _Editor_onPointerDown(i,n){var s,a;const l=i.target;if((null==l?void 0:l.id)===this.wrapperHTML.id||(null===(s=null==l?void 0:l.classList)||void 0===s?void 0:s.contains("ms-canvas"))){let{pointerType:s}=i;__classPrivateFieldGet(this,kt,"f")===Xt.Eraser&&(s=Xt.Eraser);const l=Object.assign({},null===(a=__classPrivateFieldGet(this,yt,"a",Et))||void 0===a?void 0:a.ink,__classPrivateFieldGet(this,yt,"a",Tt));this.model.initCurrentStroke(n,i.pointerId,s,l),__classPrivateFieldGet(this,yt,"a",Mt).drawCurrentStroke(this.model)}},Ht=function _Editor_onPointerMove(i,n){this.model.appendToCurrentStroke(n),__classPrivateFieldGet(this,yt,"a",Mt).drawCurrentStroke(this.model)},Bt=function _Editor_onPointerUp(i,n){this.model.endCurrentStroke(n,__classPrivateFieldGet(this,yt,"a",Tt)),__classPrivateFieldGet(this,yt,"a",Mt).updateModelRendering(this.model).then((i=>this.model=i)).catch((i=>__classPrivateFieldGet(this,yt,"m",It).call(this,i)))};export{Editor,getAvailableLanguageList};
//# sourceMappingURL=iink.esm.js.map
