!function(i,n){i&&!i.getElementById("livereloadscript")&&((n=i.createElement("script")).async=1,n.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",n.id="livereloadscript",i.getElementsByTagName("head")[0].appendChild(n))}(self.document),function(i,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((i="undefined"!=typeof globalThis?globalThis:i||self).iink={})}(this,(function(i){"use strict";function __awaiter(i,n,s,a){return new(s||(s=Promise))((function(c,d){function fulfilled(i){try{step(a.next(i))}catch(i){d(i)}}function rejected(i){try{step(a.throw(i))}catch(i){d(i)}}function step(i){i.done?c(i.value):function adopt(i){return i instanceof s?i:new s((function(n){n(i)}))}(i.value).then(fulfilled,rejected)}step((a=a.apply(i,n||[])).next())}))}const n={ABNORMAL_CLOSURE:"MyScript recognition server is not reachable. Please reload once you are connected.",WRONG_CREDENTIALS:"Application credentials are invalid. Please check or regenerate your application key and hmackey.",TOO_OLD:"Session is too old. Max Session Duration Reached.",NO_ACTIVITY:"Session closed due to no activity.",UNKNOW:"An unknown error has occurred.",CANT_ESTABLISH:"Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.",GOING_AWAY:"MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.",PROTOCOL_ERROR:"MyScript recognition server terminated the connection due to a protocol error.",UNSUPPORTED_DATA:"MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)",INVALID_FRAME_PAULOAD:"MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).",POLICY_VIOLATION:"MyScript recognition server terminated the connection because it received a message that violates its policy.",MESSAGE_TOO_BIG:"MyScript recognition server terminated the connection because a data frame was received that is too large.",INTERNAL_ERROR:"MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.",SERVICE_RESTART:"MyScript recognition server terminated the connection because it is restarting.",TRY_AGAIN:"MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.",BAD_GATEWAY:"MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.",TLS_HANDSHAKE:"MyScript recognition server connection was closed due to a failure to perform a TLS handshake"},s={IDLE:"idle",CHANGED:"changed",IMPORTED:"imported",EXPORTED:"exported",CONVERTED:"converted",RENDERED:"rendered",LOADED:"loaded",UNDO:"undo",REDO:"redo",CLEAR:"clear",CLEARED:"cleared",IMPORT:"import",SUPPORTED_IMPORT_MIMETYPES:"supportedImportMimeTypes",EXPORT:"export",CONVERT:"convert",ERROR:"error"},a="part_change",c="content_change",d="patch",h="ws_exported",l="initialized",p="connected",u="connection_active",g="disconnected";var m=n;class PointerEventGrabber{constructor(i){this.prevent=i=>i.preventDefault(),this.pointerDownHandler=i=>{if(0===i.button&&1===i.buttons&&(this.activePointerId=i.pointerId,this.onPointerDown)){const n=this.extractPoint(i);this.onPointerDown(i,n)}},this.pointerMoveHandler=i=>{if(null!=this.activePointerId&&this.activePointerId===i.pointerId&&this.onPointerMove){const n=this.extractPoint(i);this.onPointerMove(i,n)}},this.pointerUpHandler=i=>{if(null!=this.activePointerId&&this.activePointerId===i.pointerId&&(this.activePointerId=void 0,i.stopPropagation(),this.onPointerUp)){const n=this.extractPoint(i);this.onPointerUp(i,n)}},this.setConfiguration(i)}roundFloat(i,n){if(n>=0){const s=Math.pow(10,n);return Math.round(i/s)*s}return i}extractPoint(i){let n,s;({clientX:n,clientY:s}="changedTouches"in i?i.changedTouches[0]:i);const a=this.domElement.getBoundingClientRect();return{x:this.roundFloat(n-a.left-this.domElement.clientLeft,this.configuration.xyFloatPrecision),y:this.roundFloat(s-a.top-this.domElement.clientTop,this.configuration.xyFloatPrecision),t:this.roundFloat(Date.now(),this.configuration.timestampFloatPrecision),p:i.pressure||1}}setConfiguration(i){this.configuration=i}attach(i){this.domElement&&this.detach(),this.domElement=i,this.domElement.addEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("touchmove",this.prevent),document.documentElement.addEventListener("pointerdown",(()=>{}))}detach(){this.domElement.removeEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("touchmove",this.prevent),document.documentElement.removeEventListener("pointerdown",(()=>{}))}}const v={table:"table",shape:"shape",recognizedShape:"recognizedShape",ellipse:"ellipse",line:"line"};function phi(i){let n=(i+Math.PI)%(2*Math.PI)-Math.PI;return n<-Math.PI&&(n+=2*Math.PI),n}function drawArrowHead(i,n,s,a){const c=phi(s+Math.PI*(7/8)),d=phi(s-Math.PI*(7/8));i.save();try{i.fillStyle=i.strokeStyle,i.moveTo(n.x,n.y),i.beginPath(),i.lineTo(n.x+a*Math.cos(c),n.y+a*Math.sin(c)),i.lineTo(n.x+a*Math.cos(d),n.y+a*Math.sin(d)),i.lineTo(n.x,n.y),i.fill()}finally{i.restore()}}function drawShapeEllipse(i,n){const s=function drawEllipseArc(i,n){const{centerPoint:s,maxRadius:a,minRadius:c,orientation:d,startAngle:h,sweepAngle:l}=n;let p=Math.cos(d),u=Math.sin(d),g=p,m=u;p*=a,g*=c,u*=a,m*=c;const v=Math.floor(Math.abs(l)/.02),f=[];i.save();try{i.beginPath();for(let n=0;n<=v;n++){const d=h+n/v*l,y=Math.atan2(Math.sin(d)/c,Math.cos(d)/a),w=Math.cos(y),x=Math.sin(y),b=s.x+p*w-m*x,C=s.y+g*x+u*w;0===n?i.moveTo(b,C):i.lineTo(b,C),0!==n&&n!==v||f.push({x:b,y:C})}i.stroke()}finally{i.restore()}return f}(i,n);"ARROW_HEAD"===(null==n?void 0:n.beginDecoration)&&drawArrowHead(i,s[0],n.beginTangentAngle,12),"ARROW_HEAD"===(null==n?void 0:n.endDecoration)&&drawArrowHead(i,s[1],n.endTangentAngle,12)}function drawLine(i,n,s){i.save();try{i.beginPath(),i.moveTo(n.x,n.y),i.lineTo(s.x,s.y),i.stroke()}finally{i.restore()}}function drawShapeSymbol(i,n){i.save();try{if(i.lineWidth=n.width,i.strokeStyle=n.color,n.elementType)switch(n.elementType){case v.shape:const s=n;drawShapeSymbol(i,s.candidates[s.selectedCandidateIndex]);break;case v.table:n.lines.forEach((n=>drawShapeSymbol(i,n)));break;case v.line:const a=n;drawLine(i,a.data.p1,a.data.p2)}else switch(n.type){case v.ellipse:drawShapeEllipse(i,n);break;case v.line:!function drawShapeLine(i,n){drawLine(i,n.firstPoint,n.lastPoint),"ARROW_HEAD"===n.beginDecoration&&drawArrowHead(i,n.firstPoint,n.beginTangentAngle,12),"ARROW_HEAD"===n.endDecoration&&drawArrowHead(i,n.lastPoint,n.endTangentAngle,12)}(i,n);break;case v.recognizedShape:n.primitives.forEach((n=>drawShapeSymbol(i,n)))}}finally{i.restore()}}const f={inputCharacter:"inputCharacter",char:"char",string:"string",textLine:"textLine"};function drawTextLine(i,n){!function drawText(i,n,s){i.save();try{i.font=`${s.textHeight}px serif`,i.textAlign="CENTER"===s.justificationType?"center":"left",i.textBaseline="bottom",i.fillStyle=i.strokeStyle,i.fillText(n,s.topLeftPoint.x,s.topLeftPoint.y+s.height)}finally{i.restore()}}(i,n.label,n.data),n.underlineList.forEach((s=>{!function drawUnderline(i,n,s,a){const c=a.width/s.length;drawLine(i,{x:a.topLeftPoint.x+n.data.firstCharacter*c,y:a.topLeftPoint.y+a.height},{x:a.topLeftPoint.x+n.data.lastCharacter*c,y:a.topLeftPoint.y+a.height})}(i,s,n.label,n.data)}))}class CanvasRenderer{constructor(i){this.config=i}createCanvas(i,n){const s=document.createElement("canvas");return s.id=n,s.classList.add(n),s.classList.add("ms-canvas"),i.appendChild(s),s}resizeContent(){const i=window.devicePixelRatio;[this.context.renderingCanvas,this.context.capturingCanvas].forEach((n=>{var s,a,c;const d=n.parentNode,h=Math.max(null===(s=this.context)||void 0===s?void 0:s.minWidth,d.clientWidth),l=Math.max(null===(a=this.context)||void 0===a?void 0:a.minHeight,d.clientHeight);n.width=h*i,n.height=l*i,null===(c=n.getContext("2d"))||void 0===c||c.scale(i,i),n.style.width=`${h}px`,n.style.height=`${l}px`}))}drawSymbol(i,n,s){const a=n.elementType||n.type;"stroke"===a?function drawStroke(i,n,s){s&&n&&"eraser"!==n.pointerType&&s.drawStroke(i,n)}(i,n,s):Object.keys(f).includes(a)?function drawTextSymbol(i,n){i.save();try{i.lineWidth=n.width,i.strokeStyle=n.color,(n.elementType||n.type)===f.textLine&&drawTextLine(i,n)}finally{i.restore()}}(i,n):Object.keys(v).includes(a)&&drawShapeSymbol(i,n)}init(i){const n=this.createCanvas(i,"ms-rendering-canvas"),s=this.createCanvas(i,"ms-capture-canvas");this.context={minHeight:this.config.minHeight||0,minWidth:this.config.minWidth||0,renderingCanvas:n,renderingCanvasContext:n.getContext("2d"),capturingCanvas:s,capturingCanvasContext:s.getContext("2d")},this.resizeContent()}drawModel(i,n){var s;null===(s=this.context.renderingCanvasContext)||void 0===s||s.clearRect(0,0,this.context.renderingCanvas.width,this.context.renderingCanvas.height);const a=[...i.defaultSymbols];i.recognizedSymbols?(a.push(...i.recognizedSymbols),a.push(...i.extractPendingStrokes())):a.push(...i.rawStrokes),a.forEach((i=>this.drawSymbol(this.context.renderingCanvasContext,i,n))),this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),i.updatePositionRendered(a.length)}drawCurrentStroke(i,n){const s=i.currentStroke;this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),n&&s&&"eraser"!==(null==s?void 0:s.pointerType)&&n.drawStroke(this.context.capturingCanvasContext,s)}resize(i,n){this.resizeContent(),this.drawModel(i,n)}destroy(i){i.removeChild(this.context.renderingCanvas),i.removeChild(this.context.capturingCanvas)}}function computeLinksPoints(i,n,s){const a=i.p*s;return[{x:i.x-Math.sin(n)*a,y:i.y+Math.cos(n)*a},{x:i.x+Math.sin(n)*a,y:i.y-Math.cos(n)*a}]}function computeMiddlePoint(i,n){return{x:(n.x+i.x)/2,y:(n.y+i.y)/2,p:(n.p+i.p)/2,t:(n.t+i.t)/2}}function computeAxeAngle(i,n){return Math.atan2(n.y-i.y,n.x-i.x)}class QuadraticCanvasStroker{renderArc(i,n,s){i.arc(n.x,n.y,s,0,2*Math.PI,!0)}renderLine(i,n,s,a){const c=computeLinksPoints(n,computeAxeAngle(n,s),a),d=computeLinksPoints(s,computeAxeAngle(n,s),a);i.moveTo(c[0].x,c[0].y),i.lineTo(d[0].x,d[0].y),i.lineTo(d[1].x,d[1].y),i.lineTo(c[1].x,c[1].y)}renderFinal(i,n,s,a){const c=computeAxeAngle(n,s),d=computeLinksPoints(s,c,a);i.moveTo(d[0].x,d[0].y);for(let n=1;n<=6;n++){const d=c-n*Math.PI/6;i.lineTo(s.x-s.p*a*Math.sin(d),s.y+s.p*a*Math.cos(d))}}renderQuadratic(i,n,s,a,c){const d=computeLinksPoints(n,computeAxeAngle(n,a),c),h=computeLinksPoints(s,computeAxeAngle(a,s),c),l=computeLinksPoints(a,computeAxeAngle(n,s),c);i.moveTo(d[0].x,d[0].y),i.quadraticCurveTo(l[0].x,l[0].y,h[0].x,h[0].y),i.lineTo(h[1].x,h[1].y),i.quadraticCurveTo(l[1].x,l[1].y,d[1].x,d[1].y)}getPointByIndex(i,n){return{x:i.x[n]||0,y:i.y[n]||0,t:i.t[n]||0,p:i.p[n]||0}}drawStroke(i,n){const s=n.x.length,a=n.width>0?n.width:i.lineWidth,c=n.color?n.color:i.strokeStyle,d=this.getPointByIndex(n,0),h=s-2;i.save();try{if(i.beginPath(),s<3)this.renderArc(i,d,.6*a);else{this.renderArc(i,d,a*d.p);const c=computeMiddlePoint(d,this.getPointByIndex(n,1));this.renderLine(i,d,c,a);for(let s=0;s<h;s++){const c=computeMiddlePoint(this.getPointByIndex(n,s),this.getPointByIndex(n,s+1)),d=computeMiddlePoint(this.getPointByIndex(n,s+1),this.getPointByIndex(n,s+2)),h=this.getPointByIndex(n,s+1);this.renderQuadratic(i,c,d,h,a)}const l=computeMiddlePoint(this.getPointByIndex(n,s-2),this.getPointByIndex(n,s-1)),p=this.getPointByIndex(n,s-1);this.renderLine(i,l,p,a);const u=this.getPointByIndex(n,s-2),g=this.getPointByIndex(n,s-1);this.renderFinal(i,u,g,a)}i.closePath(),void 0!==c&&(i.fillStyle=c,i.fill()),i.save()}finally{i.restore()}}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function createCommonjsModule(i,n){return i(n={exports:{}},n.exports),n.exports}var y=createCommonjsModule((function(i,n){i.exports=function(i){function e(s){if(n[s])return n[s].exports;var a=n[s]={i:s,l:!1,exports:{}};return i[s].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=i,e.c=n,e.i=function(i){return i},e.d=function(i,n,s){e.o(i,n)||Object.defineProperty(i,n,{configurable:!1,enumerable:!0,get:s})},e.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(n,"a",n),n},e.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},e.p="",e(e.s=1)}([function(i,n,s){function o(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},c=function t(i){var n=this;o(this,t),this.toJSON=function(i){if("string"!=typeof i)return console.error("Need a CSS string but given ",void 0===i?"undefined":a(i),i),"Not a valid CSS..!";var s={},c=void 0,d=void 0,h=void 0;try{i.split("{").forEach((function(i){if(d=i.trim())if(-1===d.indexOf("}"))s[d]={},c=d;else{d.substring(0,d.indexOf("}")).split(";").forEach((function(i){(h=i.split(":"))&&2===h.length&&(s[c][h[0].trim().replace(/^\"|\"$/g,"")]=n._trimSemiColon(h[1].trim().replace(/^\"|\"$/g,"")))}));try{(c=d.split("}")[1].trim())&&(s[c]={})}catch(i){}}}))}catch(i){return"Not a valid CSS..!"}return s},this.toCSS=function(i){if("object"!==(void 0===i?"undefined":a(i)))return console.error("Need a JSON object but given ",void 0===i?"undefined":a(i),i),"Not a valid JSON..!";var n="";try{for(var s in i)if(i.hasOwnProperty(s)){for(var c in n+=s+" {\n",i[s])i[s].hasOwnProperty(c)&&(n+=c+": "+i[s][c]+";\n");n+="}\n"}}catch(i){return"Not a valid JSON..!"}return n},this._trimSemiColon=function(i){return";"===i.slice(-1)?i.slice(0,n.length-1):i}};n.default=c},function(i,n,s){i.exports=s(0).default}])})),w=function unwrapExports(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}(y);y.JsonCSS;const x=new w;var b={themeToCSS(i){let n=x.toCSS(i);return n=n.replace(/[\r\n]+/gm,""),n},themeToJSON(i){const n=x.toJSON(i);return n[".text"]["font-size"]=Number(n[".text"]["font-size"]),n.ink["-myscript-pen-width"]=Number(n.ink["-myscript-pen-width"]),n.ink.width=Number(n.ink.width),n},penStyleToCSS(i){let n=x.toCSS({css:i});return n=n.substring(6,n.length-3),n=n.replace(/[\r\n]+/gm,""),n},penStyleToJSON(i){const n=x.toJSON(`css {${i}}`).css;return n.width=Number(n.width),n["-myscript-pen-width"]=Number(n["-myscript-pen-width"]),n}},C=createCommonjsModule((function(i,n){var s;i.exports=(s=s||function(i,n){var s=Object.create||function(){function F(){}return function(i){var n;return F.prototype=i,n=new F,F.prototype=null,n}}(),a={},c=a.lib={},d=c.Base={extend:function(i){var n=s(this);return i&&n.mixIn(i),n.hasOwnProperty("init")&&this.init!==n.init||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var n in i)i.hasOwnProperty(n)&&(this[n]=i[n]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}},h=c.WordArray=d.extend({init:function(i,s){i=this.words=i||[],this.sigBytes=s!=n?s:4*i.length},toString:function(i){return(i||p).stringify(this)},concat:function(i){var n=this.words,s=i.words,a=this.sigBytes,c=i.sigBytes;if(this.clamp(),a%4)for(var d=0;d<c;d++){var h=s[d>>>2]>>>24-d%4*8&255;n[a+d>>>2]|=h<<24-(a+d)%4*8}else for(d=0;d<c;d+=4)n[a+d>>>2]=s[d>>>2];return this.sigBytes+=c,this},clamp:function(){var n=this.words,s=this.sigBytes;n[s>>>2]&=4294967295<<32-s%4*8,n.length=i.ceil(s/4)},clone:function(){var i=d.clone.call(this);return i.words=this.words.slice(0),i},random:function(n){for(var s,a=[],r=function(n){var s=987654321,a=4294967295;return function(){var c=((s=36969*(65535&s)+(s>>16)&a)<<16)+(n=18e3*(65535&n)+(n>>16)&a)&a;return c/=4294967296,(c+=.5)*(i.random()>.5?1:-1)}},c=0;c<n;c+=4){var d=r(4294967296*(s||i.random()));s=987654071*d(),a.push(4294967296*d()|0)}return new h.init(a,n)}}),l=a.enc={},p=l.Hex={stringify:function(i){for(var n=i.words,s=i.sigBytes,a=[],c=0;c<s;c++){var d=n[c>>>2]>>>24-c%4*8&255;a.push((d>>>4).toString(16)),a.push((15&d).toString(16))}return a.join("")},parse:function(i){for(var n=i.length,s=[],a=0;a<n;a+=2)s[a>>>3]|=parseInt(i.substr(a,2),16)<<24-a%8*4;return new h.init(s,n/2)}},u=l.Latin1={stringify:function(i){for(var n=i.words,s=i.sigBytes,a=[],c=0;c<s;c++){var d=n[c>>>2]>>>24-c%4*8&255;a.push(String.fromCharCode(d))}return a.join("")},parse:function(i){for(var n=i.length,s=[],a=0;a<n;a++)s[a>>>2]|=(255&i.charCodeAt(a))<<24-a%4*8;return new h.init(s,n)}},g=l.Utf8={stringify:function(i){try{return decodeURIComponent(escape(u.stringify(i)))}catch(i){throw new Error("Malformed UTF-8 data")}},parse:function(i){return u.parse(unescape(encodeURIComponent(i)))}},m=c.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(i){"string"==typeof i&&(i=g.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(n){var s=this._data,a=s.words,c=s.sigBytes,d=this.blockSize,l=c/(4*d),p=(l=n?i.ceil(l):i.max((0|l)-this._minBufferSize,0))*d,u=i.min(4*p,c);if(p){for(var g=0;g<p;g+=d)this._doProcessBlock(a,g);var m=a.splice(0,p);s.sigBytes-=u}return new h.init(m,u)},clone:function(){var i=d.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0});c.Hasher=m.extend({cfg:d.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){return i&&this._append(i),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(n,s){return new i.init(s).finalize(n)}},_createHmacHelper:function(i){return function(n,s){return new v.HMAC.init(i,s).finalize(n)}}});var v=a.algo={};return a}(Math),s)})),S=createCommonjsModule((function(i,n){i.exports=C.enc.Hex})),E=(createCommonjsModule((function(i,n){var s,a,c,d,h,l,p;i.exports=(c=(a=p=C).lib,d=c.Base,h=c.WordArray,(l=a.x64={}).Word=d.extend({init:function(i,n){this.high=i,this.low=n}}),l.WordArray=d.extend({init:function(i,n){i=this.words=i||[],this.sigBytes=n!=s?n:8*i.length},toX32:function(){for(var i=this.words,n=i.length,s=[],a=0;a<n;a++){var c=i[a];s.push(c.high),s.push(c.low)}return h.create(s,this.sigBytes)},clone:function(){for(var i=d.clone.call(this),n=i.words=this.words.slice(0),s=n.length,a=0;a<s;a++)n[a]=n[a].clone();return i}}),p)})),createCommonjsModule((function(i,n){var s;i.exports=(s=C,function(){var i=s,n=i.lib.Hasher,a=i.x64,c=a.Word,d=a.WordArray,h=i.algo;function X64Word_create(){return c.create.apply(c,arguments)}var l=[X64Word_create(1116352408,3609767458),X64Word_create(1899447441,602891725),X64Word_create(3049323471,3964484399),X64Word_create(3921009573,2173295548),X64Word_create(961987163,4081628472),X64Word_create(1508970993,3053834265),X64Word_create(2453635748,2937671579),X64Word_create(2870763221,3664609560),X64Word_create(3624381080,2734883394),X64Word_create(310598401,1164996542),X64Word_create(607225278,1323610764),X64Word_create(1426881987,3590304994),X64Word_create(1925078388,4068182383),X64Word_create(2162078206,991336113),X64Word_create(2614888103,633803317),X64Word_create(3248222580,3479774868),X64Word_create(3835390401,2666613458),X64Word_create(4022224774,944711139),X64Word_create(264347078,2341262773),X64Word_create(604807628,2007800933),X64Word_create(770255983,1495990901),X64Word_create(1249150122,1856431235),X64Word_create(1555081692,3175218132),X64Word_create(1996064986,2198950837),X64Word_create(2554220882,3999719339),X64Word_create(2821834349,766784016),X64Word_create(2952996808,2566594879),X64Word_create(3210313671,3203337956),X64Word_create(3336571891,1034457026),X64Word_create(3584528711,2466948901),X64Word_create(113926993,3758326383),X64Word_create(338241895,168717936),X64Word_create(666307205,1188179964),X64Word_create(773529912,1546045734),X64Word_create(1294757372,1522805485),X64Word_create(1396182291,2643833823),X64Word_create(1695183700,2343527390),X64Word_create(1986661051,1014477480),X64Word_create(2177026350,1206759142),X64Word_create(2456956037,344077627),X64Word_create(2730485921,1290863460),X64Word_create(2820302411,3158454273),X64Word_create(3259730800,3505952657),X64Word_create(3345764771,106217008),X64Word_create(3516065817,3606008344),X64Word_create(3600352804,1432725776),X64Word_create(4094571909,1467031594),X64Word_create(275423344,851169720),X64Word_create(430227734,3100823752),X64Word_create(506948616,1363258195),X64Word_create(659060556,3750685593),X64Word_create(883997877,3785050280),X64Word_create(958139571,3318307427),X64Word_create(1322822218,3812723403),X64Word_create(1537002063,2003034995),X64Word_create(1747873779,3602036899),X64Word_create(1955562222,1575990012),X64Word_create(2024104815,1125592928),X64Word_create(2227730452,2716904306),X64Word_create(2361852424,442776044),X64Word_create(2428436474,593698344),X64Word_create(2756734187,3733110249),X64Word_create(3204031479,2999351573),X64Word_create(3329325298,3815920427),X64Word_create(3391569614,3928383900),X64Word_create(3515267271,566280711),X64Word_create(3940187606,3454069534),X64Word_create(4118630271,4000239992),X64Word_create(116418474,1914138554),X64Word_create(174292421,2731055270),X64Word_create(289380356,3203993006),X64Word_create(460393269,320620315),X64Word_create(685471733,587496836),X64Word_create(852142971,1086792851),X64Word_create(1017036298,365543100),X64Word_create(1126000580,2618297676),X64Word_create(1288033470,3409855158),X64Word_create(1501505948,4234509866),X64Word_create(1607167915,987167468),X64Word_create(1816402316,1246189591)],p=[];!function(){for(var i=0;i<80;i++)p[i]=X64Word_create()}();var u=h.SHA512=n.extend({_doReset:function(){this._hash=new d.init([new c.init(1779033703,4089235720),new c.init(3144134277,2227873595),new c.init(1013904242,4271175723),new c.init(2773480762,1595750129),new c.init(1359893119,2917565137),new c.init(2600822924,725511199),new c.init(528734635,4215389547),new c.init(1541459225,327033209)])},_doProcessBlock:function(i,n){for(var s=this._hash.words,a=s[0],c=s[1],d=s[2],h=s[3],u=s[4],g=s[5],m=s[6],v=s[7],f=a.high,y=a.low,w=c.high,x=c.low,b=d.high,C=d.low,S=h.high,E=h.low,_=u.high,k=u.low,M=g.high,T=g.low,A=m.high,P=m.low,L=v.high,D=v.low,O=f,N=y,I=w,R=x,z=b,W=C,H=S,X=E,B=_,j=k,U=M,G=T,J=A,Y=P,V=L,K=D,Q=0;Q<80;Q++){var Z=p[Q];if(Q<16)var q=Z.high=0|i[n+2*Q],$=Z.low=0|i[n+2*Q+1];else{var ee=p[Q-15],te=ee.high,ie=ee.low,ne=(te>>>1|ie<<31)^(te>>>8|ie<<24)^te>>>7,re=(ie>>>1|te<<31)^(ie>>>8|te<<24)^(ie>>>7|te<<25),oe=p[Q-2],se=oe.high,ae=oe.low,ce=(se>>>19|ae<<13)^(se<<3|ae>>>29)^se>>>6,de=(ae>>>19|se<<13)^(ae<<3|se>>>29)^(ae>>>6|se<<26),he=p[Q-7],le=he.high,pe=he.low,ue=p[Q-16],ge=ue.high,me=ue.low;q=(q=(q=ne+le+(($=re+pe)>>>0<re>>>0?1:0))+ce+(($+=de)>>>0<de>>>0?1:0))+ge+(($+=me)>>>0<me>>>0?1:0),Z.high=q,Z.low=$}var ve,fe=B&U^~B&J,ye=j&G^~j&Y,we=O&I^O&z^I&z,xe=N&R^N&W^R&W,be=(O>>>28|N<<4)^(O<<30|N>>>2)^(O<<25|N>>>7),Ce=(N>>>28|O<<4)^(N<<30|O>>>2)^(N<<25|O>>>7),Se=(B>>>14|j<<18)^(B>>>18|j<<14)^(B<<23|j>>>9),Ee=(j>>>14|B<<18)^(j>>>18|B<<14)^(j<<23|B>>>9),_e=l[Q],ke=_e.high,Me=_e.low,Te=V+Se+((ve=K+Ee)>>>0<K>>>0?1:0),Ae=Ce+xe;V=J,K=Y,J=U,Y=G,U=B,G=j,B=H+(Te=(Te=(Te=Te+fe+((ve+=ye)>>>0<ye>>>0?1:0))+ke+((ve+=Me)>>>0<Me>>>0?1:0))+q+((ve+=$)>>>0<$>>>0?1:0))+((j=X+ve|0)>>>0<X>>>0?1:0)|0,H=z,X=W,z=I,W=R,I=O,R=N,O=Te+(be+we+(Ae>>>0<Ce>>>0?1:0))+((N=ve+Ae|0)>>>0<ve>>>0?1:0)|0}y=a.low=y+N,a.high=f+O+(y>>>0<N>>>0?1:0),x=c.low=x+R,c.high=w+I+(x>>>0<R>>>0?1:0),C=d.low=C+W,d.high=b+z+(C>>>0<W>>>0?1:0),E=h.low=E+X,h.high=S+H+(E>>>0<X>>>0?1:0),k=u.low=k+j,u.high=_+B+(k>>>0<j>>>0?1:0),T=g.low=T+G,g.high=M+U+(T>>>0<G>>>0?1:0),P=m.low=P+Y,m.high=A+J+(P>>>0<Y>>>0?1:0),D=v.low=D+K,v.high=L+V+(D>>>0<K>>>0?1:0)},_doFinalize:function(){var i=this._data,n=i.words,s=8*this._nDataBytes,a=8*i.sigBytes;return n[a>>>5]|=128<<24-a%32,n[30+(a+128>>>10<<5)]=Math.floor(s/4294967296),n[31+(a+128>>>10<<5)]=s,i.sigBytes=4*n.length,this._process(),this._hash.toX32()},clone:function(){var i=n.clone.call(this);return i._hash=this._hash.clone(),i},blockSize:32});i.SHA512=n._createHelper(u),i.HmacSHA512=n._createHmacHelper(u)}(),s.SHA512)})),createCommonjsModule((function(i,n){var s,a,c;i.exports=(a=(s=C).lib.Base,c=s.enc.Utf8,void(s.algo.HMAC=a.extend({init:function(i,n){i=this._hasher=new i.init,"string"==typeof n&&(n=c.parse(n));var s=i.blockSize,a=4*s;n.sigBytes>a&&(n=i.finalize(n)),n.clamp();for(var d=this._oKey=n.clone(),h=this._iKey=n.clone(),l=d.words,p=h.words,u=0;u<s;u++)l[u]^=1549556828,p[u]^=909522486;d.sigBytes=h.sigBytes=a,this.reset()},reset:function(){var i=this._hasher;i.reset(),i.update(this._iKey)},update:function(i){return this._hasher.update(i),this},finalize:function(i){var n=this._hasher,s=n.finalize(i);return n.reset(),n.finalize(this._oKey.clone().concat(s))}})))})),createCommonjsModule((function(i,n){i.exports=C.HmacSHA512})));function computeHmac(i,n,s){return new E(i,n+s).toString(S)}class GlobalEvent extends EventTarget{constructor(){super()}static getInstance(){return GlobalEvent.instance||(GlobalEvent.instance=new GlobalEvent),GlobalEvent.instance}emit(i,n){this.dispatchEvent(new CustomEvent(i,Object.assign({bubbles:!0,composed:!0},n?{detail:n}:void 0)))}emitLoaded(){this.emit(s.LOADED)}emitExported(i){this.emit(s.EXPORTED,i)}emitChange(i){this.emit(s.CHANGED,{canUndo:i.canUndo,canRedo:i.canRedo,canClear:!i.stack[i.stackIndex].isEmpty,stackIndex:i.stackIndex,stackLength:i.stack.length,isEmpty:i.stack[i.stackIndex].isEmpty})}emitIdle(i){this.emit(s.IDLE,i)}emitError(i){this.emit(s.ERROR,i)}emitClear(i){this.emit(s.CLEAR,i)}emitCleared(i){this.emit(s.CLEARED,i)}emitConvert(){this.emit(s.CONVERT)}emitImport(i,n){this.emit(s.IMPORT,{jiix:i,mimeType:n})}}class AbstractRecognizer{constructor(i,n){this.serverConfiguration=i,this.recognitionConfiguration=n}get globalEvent(){return GlobalEvent.getInstance()}init(i,n){}}class RestRecognizer extends AbstractRecognizer{constructor(i,n){super(i,n)}get url(){return`${this.serverConfiguration.scheme}://${this.serverConfiguration.host}/api/v4.0/iink/batch`}get postConfig(){switch(this.recognitionConfiguration.type){case"DIAGRAM":return{lang:this.recognitionConfiguration.lang,diagram:this.recognitionConfiguration.diagram,export:this.recognitionConfiguration.export};case"MATH":return{lang:this.recognitionConfiguration.lang,math:this.recognitionConfiguration.math,export:this.recognitionConfiguration.export};case"Raw Content":return{lang:this.recognitionConfiguration.lang,"raw-content":this.recognitionConfiguration.rawContent,export:this.recognitionConfiguration.export};case"TEXT":return{lang:this.recognitionConfiguration.lang,text:this.recognitionConfiguration.text,export:this.recognitionConfiguration.export};default:throw new Error(`get postConfig error Recognition type unkow "${this.recognitionConfiguration.type}"`)}}buildData(i){const n=[];i.strokeGroups.forEach((i=>{const s={penStyle:"{}"===JSON.stringify(i.penStyle)?void 0:b.penStyleToCSS(i.penStyle),strokes:i.strokes.map((i=>({x:i.x,y:i.y,t:i.t,p:i.p,pointerType:i.pointerType})))};n.push(s)}));const s="Raw Content"===this.recognitionConfiguration.type?"Raw Content":this.recognitionConfiguration.type.charAt(0).toUpperCase()+this.recognitionConfiguration.type.slice(1).toLowerCase();return{configuration:this.postConfig,xDPI:96,yDPI:96,contentType:s,height:i.height,width:i.width,strokeGroups:n}}post(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=new Headers;s.append("Accept","application/json,"+n),s.append("applicationKey",this.serverConfiguration.applicationKey),s.append("hmac",computeHmac(JSON.stringify(i),this.serverConfiguration.applicationKey,this.serverConfiguration.hmacKey)),s.append("Content-Type","application/json");const a={method:"POST",headers:s,body:JSON.stringify(i)},c=new Request(this.url,a),d=yield fetch(c);if(d.ok){let i;switch(d.headers.get("content-type")){case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"image/png":case"image/jpeg":i=yield d.blob();break;case"application/json":i=yield d.json();break;case"application/vnd.myscript.jiix":i=yield d.clone().json().catch((()=>__awaiter(this,void 0,void 0,(function*(){return yield d.text()}))));break;default:i=yield d.text()}return i}throw yield d.json()}))}callPostMessage(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=this.buildData(i);return this.post(s,n).then((i=>{const s={};return s[n]=i,s})).catch((i=>{let n=i.message;i.code||(n=m.CANT_ESTABLISH);const s=new Error(n);throw s.name=i.code||"",this.globalEvent.emitError(s),s}))}))}export(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=i.getClone();if(s.updatePositionSent(),s.isEmpty)return Promise.resolve(s);let a=n||[];if(!a.length)switch(this.recognitionConfiguration.type){case"DIAGRAM":a=this.recognitionConfiguration.diagram.mimeTypes;break;case"MATH":a=this.recognitionConfiguration.math.mimeTypes;break;case"Raw Content":a=this.recognitionConfiguration.rawContent.mimeTypes;break;case"TEXT":a=this.recognitionConfiguration.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.recognitionConfiguration.type}" is unknown.\n Possible types are:\n -DIAGRAM\n -MATH\n -Raw Content\n -TEXT`)}if(!a.length)return Promise.reject(new Error("Export failed, no mimeTypes define in recognition configuration"));const c=a.filter((i=>!s.exports||!s.exports[i])),d=yield Promise.all(c.map((i=>this.callPostMessage(s,i))));return s.updatePositionReceived(),d.forEach((i=>{s.exports=Object.assign(s.exports||{},i)})),s}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){return this.export(i)}))}}class DeferredPromise{constructor(){this.isFullFilled=!1,this.isPending=!0,this.promise=new Promise(((i,n)=>{this.reject=i=>__awaiter(this,void 0,void 0,(function*(){return this.isFullFilled=!0,this.isPending=!1,n(i)})),this.resolve=n=>__awaiter(this,void 0,void 0,(function*(){return this.isFullFilled=!0,this.isPending=!1,i(n)}))}))}}class UndoRedoContext{constructor(i){this.stackIndex=0,this.stack=[i.getClone()],this.canRedo=!1,this.canUndo=!1}}class UndoRedoManager{constructor(i,n){this.configuration=i,this.context=new UndoRedoContext(n)}get events(){return GlobalEvent.getInstance()}updateCanUndoRedo(){this.context.canRedo=this.context.stack.length-1>this.context.stackIndex,this.context.canUndo=this.context.stackIndex>0}addModelToStack(i){this.context.stackIndex+1<this.context.stack.length&&this.context.stack.splice(this.context.stackIndex+1),this.context.stackIndex++,this.context.stack.push(i.getClone()),this.context.stack.length>this.configuration.maxStackSize&&(this.context.stack.shift(),this.context.stackIndex--),this.updateCanUndoRedo(),this.events.emitChange(this.context)}updateModelInStack(i){const n=this.context.stack.findIndex((n=>n.modificationDate===i.modificationDate));n>-1&&(this.context.stack.splice(n,1,i.getClone()),this.events.emitChange(this.context))}undo(){return this.context.canUndo&&(this.context.stackIndex--,this.updateCanUndoRedo(),this.events.emitChange(this.context)),this.context.stack[this.context.stackIndex].getClone()}redo(){return this.context.canRedo&&(this.context.stackIndex++,this.updateCanUndoRedo(),this.events.emitChange(this.context)),this.context.stack[this.context.stackIndex].getClone()}reset(i){this.context=new UndoRedoContext(i),this.events.emitChange(this.context)}}class RestBehaviors{constructor(i,n){this.grabber=new PointerEventGrabber(i.grabber),this.stroker=new QuadraticCanvasStroker,this.renderer=new CanvasRenderer(i.rendering),this.recognizer=new RestRecognizer(i.server,i.recognition),this.undoRedoManager=new UndoRedoManager(i["undo-redo"],n.getClone()),this._triggerConfiguration=i.triggers,this.initalise=new DeferredPromise}get globalEvents(){return GlobalEvent.getInstance()}_export(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=yield this.recognizer.export(i,n);return this.globalEvents.emitExported(null==s?void 0:s.exports),s}))}init(i){return this.grabber.attach(i),this.renderer.init(i),this.initalise.resolve(),this.initalise.promise}drawCurrentStroke(i){this.renderer.drawCurrentStroke(i,this.stroker)}drawModel(i){this.renderer.drawModel(i,this.stroker)}export(i,n){return __awaiter(this,void 0,void 0,(function*(){const s=new DeferredPromise;if(this.undoRedoManager.addModelToStack(i),"DEMAND"!==this._triggerConfiguration.exportContent){clearTimeout(this._exportTimer);let a=i.getClone();this._exportTimer=setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){a=yield this._export(a,n),this.undoRedoManager.updateModelInStack(a),i.modificationDate===a.modificationDate&&(i.exports=a.exports),s.resolve(i)}))),this._triggerConfiguration.exportContentDelay)}else s.resolve(i);return s.promise}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){if(this.renderer.resize(i,this.stroker),i.strokeGroups.length){const n=new DeferredPromise;return clearTimeout(this._resizeTimer),this._resizeTimer=setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){const s=yield this.recognizer.resize(i);n.resolve(s)}))),this._triggerConfiguration.resizeTriggerDelay),n.promise}return Promise.resolve(i)}))}undo(){return __awaiter(this,void 0,void 0,(function*(){const i=this.undoRedoManager.undo();this.drawModel(i);const n=yield this._export(i);return this.undoRedoManager.updateModelInStack(n),n}))}redo(){return __awaiter(this,void 0,void 0,(function*(){const i=this.undoRedoManager.redo();this.drawModel(i);const n=yield this._export(i);return this.undoRedoManager.updateModelInStack(n),n}))}clear(i){return __awaiter(this,void 0,void 0,(function*(){const n=i.getClone();return n.clear(),this.undoRedoManager.addModelToStack(n),this.drawModel(n),n.modificationDate=(new Date).getTime(),console.log("myModel.exports: ",n.exports),this.globalEvents.emitExported(n.exports),this.globalEvents.emitCleared(n),n}))}}class WSEvent extends EventTarget{constructor(){super(),this.abortController=new AbortController}emit(i,n){this.dispatchEvent(new CustomEvent(i,Object.assign({bubbles:!0,composed:!0},n?{detail:n}:void 0)))}emitInitialized(){this.emit(l)}emitConnected(){this.emit(p)}emitConnectionActive(){this.emit(u)}addConnectionActiveListener(i){this.addEventListener(u,(()=>i()),{signal:this.abortController.signal})}emitDisconnected(i){this.emit(g,i)}addDisconnectedListener(i){this.addEventListener(g,(n=>i(n.detail)),{signal:this.abortController.signal})}emitPartChange(i){this.emit(a,i)}addPartChangeListener(i){this.addEventListener(a,(n=>i(n.detail)),{signal:this.abortController.signal})}emitContentChange(i){this.emit(c,i)}addContentChangeListener(i){this.addEventListener(c,(n=>i(n.detail)),{signal:this.abortController.signal})}emitPatch(i){this.emit(d,i)}addPatchListener(i){this.addEventListener(d,(n=>i(n.detail)),{signal:this.abortController.signal})}emitExported(i){this.emit(h,i)}addExportListener(i){this.addEventListener(h,(n=>i(n.detail)),{signal:this.abortController.signal})}clearListeners(){this.abortController.abort()}}class WSRecognizer extends AbstractRecognizer{constructor(i,n){super(i,n),this.pingCount=0,this.reconnectionCount=0,this.wsEvent=new WSEvent}get url(){return`${"https"===this.serverConfiguration.scheme?"wss":"ws"}://${this.serverConfiguration.host}/api/v4.0/iink/document`}get mimeTypes(){switch(this.recognitionConfiguration.type.toLocaleLowerCase()){case"text":return this.recognitionConfiguration.text.mimeTypes;case"math":return this.recognitionConfiguration.math.mimeTypes;case"raw-content":return this.recognitionConfiguration.rawContent.mimeTypes;case"diagram":return this.recognitionConfiguration.diagram.mimeTypes;default:return[]}}infinitePing(){this.pingCount++,this.serverConfiguration.websocket.maxPingLostCount<this.pingCount?this.close(1e3,"PING_LOST"):this.socket.readyState<=1&&setTimeout((()=>{this.socket.readyState<=1&&(this.socket.send(JSON.stringify({type:"ping"})),this.infinitePing())}),this.serverConfiguration.websocket.pingDelay)}openCallback(){this.wsEvent.emitConnected();const i={type:this.sessionId?"restoreIInkSession":"newContentPackage",iinkSessionId:this.sessionId,applicationKey:this.serverConfiguration.applicationKey,xDpi:96,yDpi:96,viewSizeHeight:this.viewSizeHeight,viewSizeWidth:this.viewSizeWidth};this.send(i)}closeCallback(i){let s="";if(!this.currentErrorCode){switch(i.code){case 1e3:break;case 1001:s=n.GOING_AWAY;break;case 1002:s=n.PROTOCOL_ERROR;break;case 1003:case 1005:s=n.UNSUPPORTED_DATA;break;case 1006:s=n.ABNORMAL_CLOSURE;break;case 1007:s=n.INVALID_FRAME_PAULOAD;break;case 1008:s=n.POLICY_VIOLATION;break;case 1009:s=n.MESSAGE_TOO_BIG;break;case 1011:s=n.INTERNAL_ERROR;break;case 1012:s=n.SERVICE_RESTART;break;case 1013:s=n.TRY_AGAIN;break;case 1014:s=n.BAD_GATEWAY;break;case 1015:s=n.TLS_HANDSHAKE;break;default:s=n.CANT_ESTABLISH}s&&this.globalEvent.emitError(new Error(s)),this.wsEvent.emitDisconnected(i)}}errorCallback(i){this.globalEvent.emitError(new Error(i.type))}manageHMACChallengeMessage(i){const n=i;n.hmacChallenge&&this.send({type:"hmac",hmac:computeHmac(n.hmacChallenge,this.serverConfiguration.applicationKey,this.serverConfiguration.hmacKey)}),n.iinkSessionId&&(this.sessionId=n.iinkSessionId)}manageContentPackageDescriptionMessage(){this.reconnectionCount=0,this.send(Object.assign(Object.assign({},this.recognitionConfiguration),{type:"configuration"})),this.currentPartId?this.send({type:"openContentPart",id:this.currentPartId,mimeTypes:this.mimeTypes}):this.send({type:"newContentPart",contentType:this.recognitionConfiguration.type,mimeTypes:this.mimeTypes})}managePartChangeMessage(i){const n=i;this.currentPartId=n.partId,this.wsEvent.emitPartChange(n)}manageContentChangeMessage(i){const n=i;this.wsEvent.emitContentChange(n)}manageExportMessage(i){const n=i;this.wsEvent.emitExported(n)}managePatchMessage(i){const n=i;this.wsEvent.emitPatch(n)}manageErrorMessage(i){var s,a;const c=i;this.currentErrorCode=(null===(s=c.data)||void 0===s?void 0:s.code)||c.code;let d=(null===(a=c.data)||void 0===a?void 0:a.message)||c.message;switch(this.currentErrorCode){case"no.activity":d=n.NO_ACTIVITY;break;case"api.invalid.format":d=c.message;break;case"access.not.granted":d=n.WRONG_CREDENTIALS;break;case"session.too.old":d=n.TOO_OLD;break;default:d||(d=n.UNKNOW)}this.globalEvent.emitError(new Error(d))}messageCallback(i){this.currentErrorCode=void 0;const n=JSON.parse(i.data);if("pong"!==n.type)switch(this.pingCount=0,n.type){case"ack":this.manageHMACChallengeMessage(n);break;case"contentPackageDescription":this.manageContentPackageDescriptionMessage();break;case"partChanged":this.managePartChangeMessage(n);break;case"newPart":this.wsEvent.emitConnectionActive();break;case"contentChanged":this.manageContentChangeMessage(n);break;case"exported":this.manageExportMessage(n);break;case"svgPatch":this.managePatchMessage(n);break;case"error":this.manageErrorMessage(n)}}init(i,s){try{this.viewSizeHeight=i,this.viewSizeWidth=s,this.socket=new WebSocket(this.url),this.serverConfiguration.websocket.pingEnabled&&this.infinitePing(),this.socket.onopen=()=>this.openCallback(),this.socket.onclose=i=>this.closeCallback(i),this.socket.onerror=i=>this.errorCallback(i),this.socket.onmessage=i=>this.messageCallback(i),this.wsEvent.emitInitialized()}catch(i){new Error(n.CANT_ESTABLISH).name=i.code||"CANT_ESTABLISH",this.globalEvent.emitError(i)}}canReconnect(){return this.socket&&this.serverConfiguration.websocket.autoReconnect&&this.reconnectionCount<=this.serverConfiguration.websocket.maxRetryCount&&(!this.currentErrorCode||!["api.invalid.format","access.not.granted"].includes(this.currentErrorCode.toString()))}shouldAttemptReconnect(){return this.reconnectionCount++,this.canReconnect()}addStrokes(i){const n=i.extractPendingStrokes();0!==n.length&&this.send({type:"addStrokes",strokes:n.map((i=>({pointerType:i.pointerType,pointerId:i.pointerId,x:i.x,y:i.y,t:i.t,p:i.p})))})}send(i){if(this.socket.readyState!==this.socket.OPEN)throw this.socket.removeEventListener("close",this.closeCallback),this.socket.removeEventListener("error",this.errorCallback),this.socket.removeEventListener("message",this.messageCallback),this.socket.removeEventListener("open",this.openCallback),new Error(g);this.socket.send(JSON.stringify(i))}close(i,n){this.socket.readyState!==this.socket.OPEN&&this.socket.readyState!==this.socket.CONNECTING||this.socket.close(i,n)}export(i,n){return __awaiter(this,void 0,void 0,(function*(){let s=n||[];if(!s.length)switch(this.recognitionConfiguration.type){case"DIAGRAM":s=this.recognitionConfiguration.diagram.mimeTypes;break;case"MATH":s=this.recognitionConfiguration.math.mimeTypes;break;case"Raw Content":s=this.recognitionConfiguration.rawContent.mimeTypes;break;case"TEXT":s=this.recognitionConfiguration.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.recognitionConfiguration.type}" is unknown.\n Possible types are:\n -DIAGRAM\n -MATH\n -Raw Content\n -TEXT`)}if(!s.length)return Promise.reject(new Error("Export failed, no mimeTypes define in recognition configuration"));const a={type:"export",partId:this.currentPartId,mimeTypes:s};return this.send(a),i}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){this.viewSizeHeight=i.height,this.viewSizeWidth=i.width;const n={type:"changeViewSize",partId:this.currentPartId,height:this.viewSizeHeight,width:this.viewSizeWidth};return this.send(n),Promise.resolve(i)}))}}class Stroke{constructor(i,n,s="pen"){this.type="stroke",this.pointerId=n,this.pointerType=s,this.x=[],this.y=[],this.t=[],this.p=[],this.l=[],this.color=i.color,this.width=i.width,this["-myscript-pen-width"]=i["-myscript-pen-width"],this["-myscript-pen-fill-style"]=i["-myscript-pen-fill-style"],this["-myscript-pen-fill-color"]=i["-myscript-pen-fill-color"]}}class Model{constructor(i,n,s=(new Date).getTime()){this.rawStrokes=[],this.strokeGroups=[],this.positions={lastSentPosition:-1,lastReceivedPosition:-1,lastRenderedPosition:-1},this.defaultSymbols=[],this.rawResults={convert:void 0,exports:void 0},this.creationTime=s,this.modificationDate=s,this.width=i,this.height=n,this.idle=!0,this.isEmpty=!0}computeDistance(i,n){const s=Math.sqrt(Math.pow(i.y-n.y,2)+Math.pow(i.x-n.x,2));return isNaN(s)?0:s}computeLength(i,n,s){const a=s+this.computeDistance(i,n);return isNaN(a)?0:a}computePressure(i,n,s){let a=1;const c=this.computeDistance(i,n),d=this.computeLength(i,n,s);0===d?a=.5:c===d?a=1:c<10?a=.2+Math.pow(.1*c,.4):c>d-10&&(a=.2+Math.pow(.1*(d-c),.4));const h=a*Math.max(.1,1-.1*Math.sqrt(c));return isNaN(h)?.5:Math.round(100*h)/100}filterPointByAcquisitionDelta(i,n){const s=2+i["-myscript-pen-width"]/4;return 0===i.x.length||0===i.y.length||Math.abs(i.x[i.x.length-1]-n.x)>=s||Math.abs(i.y[i.y.length-1]-n.y)>=s}addPoint(i,n){if(this.filterPointByAcquisitionDelta(i,n)){const s={x:i.x[i.x.length-1],y:i.y[i.y.length-1],p:i.p[i.p.length-1],t:i.t[i.t.length-1]},a=i.l[i.l.length-1];i.x.push(n.x),i.y.push(n.y),i.t.push(n.t),i.p.push(this.computePressure(n,s,a)),i.l.push(this.computeLength(n,s,a))}}addStroke(i){this.rawStrokes.push(i)}extractPendingStrokes(i){return i=i||this.positions.lastReceivedPosition+1,this.rawStrokes.slice(i)}addStrokeToGroup(i,n){const s=this.strokeGroups.length-1;if(this.strokeGroups[s]&&(a=this.strokeGroups[s].penStyle,c=n,a["-myscript-pen-fill-color"]===c["-myscript-pen-fill-color"]&&a["-myscript-pen-fill-style"]===c["-myscript-pen-fill-style"]&&a["-myscript-pen-width"]===c["-myscript-pen-width"]&&a.color===c.color&&a.width===c.width))this.strokeGroups[s].strokes.push(i);else{const s={penStyle:n,strokes:[i]};this.strokeGroups.push(s)}var a,c;this.isEmpty=!1}initCurrentStroke(i,n,s,a,c=96){if(a["-myscript-pen-width"]){const i=a["-myscript-pen-width"]*c/25.4;a.width=i/2}this.modificationDate=(new Date).getTime(),this.exports=void 0,this.currentStroke=new Stroke(a,n,s),this.addPoint(this.currentStroke,i)}appendToCurrentStroke(i){this.currentStroke&&this.addPoint(this.currentStroke,i)}endCurrentStroke(i,n){this.currentStroke&&(this.addPoint(this.currentStroke,i),this.addStroke(this.currentStroke),this.addStrokeToGroup(this.currentStroke,n),this.currentStroke=void 0)}updatePositionSent(i=this.rawStrokes.length-1){this.positions.lastSentPosition=i}updatePositionReceived(){this.positions.lastReceivedPosition=this.positions.lastSentPosition}updatePositionRendered(i=(this.recognizedSymbols?this.recognizedSymbols.length-1:-1)){this.positions.lastRenderedPosition=i}resetPositionRenderer(){this.positions.lastRenderedPosition=-1}resetPositions(){this.positions.lastSentPosition=-1,this.positions.lastReceivedPosition=-1}getClone(){const i=new Model(this.width,this.height,this.creationTime);return i.modificationDate=JSON.parse(JSON.stringify(this.modificationDate)),i.defaultSymbols=JSON.parse(JSON.stringify(this.defaultSymbols)),i.currentStroke=this.currentStroke?JSON.parse(JSON.stringify(this.currentStroke)):void 0,i.rawStrokes=JSON.parse(JSON.stringify(this.rawStrokes)),i.strokeGroups=JSON.parse(JSON.stringify(this.strokeGroups)),i.positions=JSON.parse(JSON.stringify(this.positions)),i.exports=this.exports?JSON.parse(JSON.stringify(this.exports)):void 0,i.rawResults.convert=this.rawResults.convert?JSON.parse(JSON.stringify(this.rawResults.convert)):void 0,i.rawResults.exports=this.rawResults.exports?JSON.parse(JSON.stringify(this.rawResults.exports)):void 0,i.recognizedSymbols=this.recognizedSymbols?JSON.parse(JSON.stringify(this.recognizedSymbols)):void 0,i.idle=this.idle,i.isEmpty=this.isEmpty,i}clear(){this.modificationDate=(new Date).getTime(),this.currentStroke=void 0,this.rawStrokes=[],this.strokeGroups=[],this.positions.lastSentPosition=-1,this.positions.lastReceivedPosition=-1,this.positions.lastRenderedPosition=-1,this.recognizedSymbols=void 0,this.exports=void 0,this.rawResults.convert=void 0,this.rawResults.exports=void 0,this.idle=!0,this.isEmpty=!0}}class WSBehaviors{constructor(i){this.onConnectionActive=()=>{this.initalise.resolve()},this.onPartChange=i=>{console.log("onPartChange evt:",i)},this.onContentChange=i=>{var n;console.log("onContentChange evt:",i),null===(n=this.addStrokeDeffered)||void 0===n||n.resolve({})},this.onPatch=i=>{console.log("onContentChange evt:",i)},this.onExport=i=>{var n;console.log("WSBehaviors => callback on WSExported exportMessage: ",i),null===(n=this.exportDeffered)||void 0===n||n.resolve(i.exports),this.globalEvents.emitExported(i.exports)},this.onDisconnected=i=>{if(this.initalise.isPending)if(1e3===i.code)this.initalise.resolve();else{const n=new Error(i.reason);n.name=i.code.toString(),this.initalise.reject(n)}},this.grabber=new PointerEventGrabber(i.grabber),this.stroker=new QuadraticCanvasStroker,this.renderer=new CanvasRenderer(i.rendering),this.recognizer=new WSRecognizer(i.server,i.recognition),this.initalise=new DeferredPromise}get globalEvents(){return GlobalEvent.getInstance()}init(i,n){return this.grabber.attach(i),this.renderer.init(i),this.recognizer.init(n.height,n.width),this.recognizer.wsEvent.addConnectionActiveListener(this.onConnectionActive),this.recognizer.wsEvent.addPartChangeListener(this.onPartChange),this.recognizer.wsEvent.addContentChangeListener(this.onContentChange),this.recognizer.wsEvent.addPatchListener(this.onPatch),this.recognizer.wsEvent.addExportListener(this.onExport),this.recognizer.wsEvent.addDisconnectedListener(this.onDisconnected),this.initalise.promise}drawCurrentStroke(i){this.renderer.drawCurrentStroke(i,this.stroker)}drawModel(i){this.renderer.drawModel(i,this.stroker)}addStrokes(i){return __awaiter(this,void 0,void 0,(function*(){return yield this.initalise.promise,this.addStrokeDeffered=new DeferredPromise,console.log("WSBehaviors => addStrokes model: ",i),this.recognizer.addStrokes(i),yield this.addStrokeDeffered.promise,this.addStrokeDeffered=void 0,i}))}export(i,n){return __awaiter(this,void 0,void 0,(function*(){yield this.initalise.promise,this.exportDeffered=new DeferredPromise,yield this.recognizer.export(i,n);const s=yield this.exportDeffered.promise;return i.updatePositionReceived(),i.exports?Object.assign(i.exports,s):i.exports=s,this.exportDeffered=void 0,i}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){return yield this.initalise.promise,this.recognizer.resize(i)}))}undo(){return __awaiter(this,void 0,void 0,(function*(){return yield this.initalise.promise,new Model(1,1)}))}redo(){return __awaiter(this,void 0,void 0,(function*(){return yield this.initalise.promise,new Model(1,1)}))}clear(i){return __awaiter(this,void 0,void 0,(function*(){yield this.initalise.promise;const n=i.getClone();return n.clear(),n}))}}class BehaviorsManager{constructor(i,n,s){this.overrideDefaultBehaviors(i,n,s)}overrideDefaultBehaviors(i,n,s){let a;a="REST"===i.server.protocol?new RestBehaviors(i,n):new WSBehaviors(i),this.behaviors=Object.assign(a,s)}init(i,n){return this.behaviors.init(i,n)}}const _={server:{protocol:"WEBSOCKET",scheme:"https",host:"webdemoapi.myscript.com",applicationKey:"",hmacKey:"",useWindowLocation:!1,websocket:{pingEnabled:!0,pingDelay:3e4,maxPingLostCount:10,autoReconnect:!0,maxRetryCount:2,fileChunkSize:3e5}},recognition:{type:"TEXT",alwaysConnected:!0,lang:"en_US",gesture:{enable:!0},export:{"image-resolution":300,jiix:{"bounding-box":!1,strokes:!1,text:{chars:!1,words:!0}}},renderer:{debug:{"draw-text-boxes":!1,"draw-image-boxes":!1}},math:{mimeTypes:["application/x-latex"],solver:{enable:!0,"fractional-part-digits":3,"decimal-separator":".","rounding-mode":"half up","angle-unit":"deg"},margin:{bottom:10,left:15,right:15,top:10},eraser:{"erase-precisely":!1},"undo-redo":{mode:"stroke"}},text:{guides:{enable:!0},mimeTypes:["text/plain"],margin:{top:20,left:10,right:10,bottom:10},eraser:{"erase-precisely":!1}},diagram:{mimeTypes:["application/vnd.myscript.jiix"],eraser:{"erase-precisely":!1}},rawContent:{mimeTypes:["application/vnd.myscript.jiix"],recognition:{text:!0,shape:!1},eraser:{"erase-precisely":!1}}},grabber:{listenerOptions:{capture:!1,passive:!0},xyFloatPrecision:0,timestampFloatPrecision:0},rendering:{minHeight:100,minWidth:100,smartGuide:{enable:!1,fadeOut:{enable:!1,duration:1e4}}},triggers:{exportContent:"POINTER_UP",exportContentDelay:1e3,resizeTriggerDelay:100},events:{processDelay:10},"undo-redo":{maxStackSize:10}};class Configuration{constructor(i){this.events=JSON.parse(JSON.stringify(_.events)),this.grabber=JSON.parse(JSON.stringify(_.grabber)),this.recognition=JSON.parse(JSON.stringify(_.recognition)),this.rendering=JSON.parse(JSON.stringify(_.rendering)),this.server=JSON.parse(JSON.stringify(_.server)),this.triggers=JSON.parse(JSON.stringify(_.triggers)),this.overrideDefaultConfiguration(i)}mergeDeep(i,...n){const isObject=i=>i&&"object"==typeof i&&!Array.isArray(i);if(!n.length)return i;const s=n.shift();if(isObject(i)&&isObject(s))for(const n in s)isObject(s[n])?(i[n]||Object.assign(i,{[n]:{}}),this.mergeDeep(i[n],s[n])):Object.assign(i,{[n]:s[n]});return this.mergeDeep(i,...n)}overrideDefaultConfiguration(i){var n,s,a,c,d,h,l,p,u;this.events=this.mergeDeep({},_.events,null==i?void 0:i.events),this.grabber=this.mergeDeep({},_.grabber,null==i?void 0:i.grabber),this.recognition=this.mergeDeep({},_.recognition,null==i?void 0:i.recognition),this.rendering=this.mergeDeep({},_.rendering,null==i?void 0:i.rendering),this.server=this.mergeDeep({},_.server,null==i?void 0:i.server),this.triggers=this.mergeDeep({},_.triggers,null==i?void 0:i.triggers),this["undo-redo"]=this.mergeDeep({},_["undo-redo"],null==i?void 0:i["undo-redo"]),this.recognition.text.mimeTypes=(null===(s=null===(n=null==i?void 0:i.recognition)||void 0===n?void 0:n.text)||void 0===s?void 0:s.mimeTypes)||_.recognition.text.mimeTypes,this.recognition.math.mimeTypes=(null===(c=null===(a=null==i?void 0:i.recognition)||void 0===a?void 0:a.math)||void 0===c?void 0:c.mimeTypes)||_.recognition.math.mimeTypes,this.recognition.diagram.mimeTypes=(null===(h=null===(d=null==i?void 0:i.recognition)||void 0===d?void 0:d.diagram)||void 0===h?void 0:h.mimeTypes)||_.recognition.diagram.mimeTypes,this.recognition.rawContent.mimeTypes=(null===(p=null===(l=null==i?void 0:i.recognition)||void 0===l?void 0:l.rawContent)||void 0===p?void 0:p.mimeTypes)||_.recognition.rawContent.mimeTypes,(null===(u=this.server)||void 0===u?void 0:u.useWindowLocation)&&(this.server.scheme=window.location.protocol.indexOf("s")>-1?"https":"http",this.server.host=window.location.host),"REST"===this.server.protocol&&"POINTER_UP"===this.triggers.exportContent&&(this.triggers.exportContent="QUIET_PERIOD",this.triggers.exportContentDelay=Math.max(this.triggers.exportContentDelay,50)),"WEBSOCKET"===this.server.protocol&&"TEXT"===this.recognition.type?this.rendering.smartGuide.enable&&!this.recognition.text.mimeTypes.includes("application/vnd.myscript.jiix")&&this.recognition.text.mimeTypes.push("application/vnd.myscript.jiix"):this.rendering.smartGuide.enable=!1}}const k={color:"#000000",width:0,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},M={ink:{color:"#000000",width:1,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},".math":{"font-family":"STIXGeneral"},".math-solved":{"font-family":"STIXGeneral",color:"#A8A8A8FF"},".text":{"font-family":"MyScriptInter","font-size":10}};class StyleManager{constructor(i,n){this.overrideDefaultPenStyle(i),this.overrideDefaultTheme(n)}get penStyle(){return this._penStyle}get theme(){return this._theme}overrideDefaultPenStyle(i){const n=Object.assign(Object.assign({},k),i||{});this._penStyle=n}overrideDefaultTheme(i){const n=Object.assign(Object.assign({},M),i||{});this._theme=n}}var T;!function styleInject(i,n){void 0===n&&(n={});var s=n.insertAt;if(i&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css","top"===s&&a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c),c.styleSheet?c.styleSheet.cssText=i:c.appendChild(document.createTextNode(i))}}("/* @import url(../node_modules/perfect-scrollbar/css/perfect-scrollbar.css); */\n\n.ms-editor {\n    position: relative;\n    z-index: 20;\n    color: #1A9FFF;\n    font-family: sans-serif;\n}\n\n.ms-editor.erasing {\n    cursor: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEsSURBVDiNrdO7SgNBFMbx/3fmCbQ1tunDIayFBvFSKxbxBfSdBPEBtLIWb3Ebl4R9AQWLkE70CWbHZl1Eg2iSr5vL+c1hhhFTMhwOdyX1gQ2gVU+PgTyldNHtdq+/1+jroCiKtpmdSupNO6ApkgZmdtzpdJ5+QGVZ9qqqugSWfkO+5F3SnrvnDVQURTuE8PgP5DNvkjJ3fzaAEMLJDAjAclVVZwCqL/ZqBqSJme2YpMN5EIAYY9+A9XkhST0DVuaFgJYtAAGoDJgsAJoYkM+rSHqwlNL5Ajq6EMBoNLoBtmbsZuDumwYQYzwCXmdw3oAjAAPIsuxF0kG98GdE0r67PzcQgLvnIYQ14P4PyF39WZuH0rRdZVluxxj7kjaA1Xp6nFLKzezc3W+/13wAItdV6XjME1AAAAAASUVORK5CYII=') 10 10, auto;\n}\n\n.ms-editor canvas,\n.ms-editor svg {\n    z-index: 15;\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 100%;\n}\n\n.ms-editor canvas.ms-rendering-canvas {\n    z-index: 10;\n    pointer-events: none;\n    background-image: linear-gradient(to right, #F5F6F7 1px, transparent 1px),\n    linear-gradient(to bottom, #F5F6F7 1px, transparent 1px);\n    background-size: 18px 18px;\n}\n\n.ms-editor svg {\n    z-index: 10;\n    pointer-events: none;\n}\n.ms-editor svg[data-layer=\"BACKGROUND\"] {\n    z-index: 9;\n}\n\n.ms-editor .loader {\n    z-index: 30;\n    position: absolute;\n    width: 120px;\n    height: 120px;\n    top: calc(50% - 60px);\n    left: calc(50% - 60px);\n    border: 16px solid #F5F6F7;\n    border-radius: 50%;\n    border-top-color: #1A9FFF;\n    -webkit-animation: spin 2s linear infinite;\n    animation: spin 2s linear infinite;\n}\n\n.ms-editor .error-msg {\n    z-index: 25;\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    top: calc(50% - 100px);\n    left: calc(50% - 100px);\n    font-size: 16px;\n    text-align: center;\n    word-wrap: break-word;\n}\n\n.ms-editor .error-msg::before {\n    content: url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCA3Ni41IDYxMiA0NTkiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPgogICAgPHBhdGggZmlsbD0iIzFBOUZGRiIgZD0iTTQ5NC43LDIyOS41Yy0xNy44NTEtODYuNy05NC4zNTEtMTUzLTE4OC43LTE1M2MtMzguMjUsMC03My45NSwxMC4yLTEwMiwzMC42bDM4LjI1LDM4LjI1IGMxNy44NS0xMi43NSw0MC44LTE3Ljg1LDYzLjc1LTE3Ljg1Yzc2LjUsMCwxNDAuMjUsNjMuNzUsMTQwLjI1LDE0MC4yNXYxMi43NWgzOC4yNWM0My4zNSwwLDc2LjUsMzMuMTUsNzYuNSw3Ni41IGMwLDI4LjA1LTE1LjMsNTMuNTUtNDAuOCw2Ni4zbDM4LjI1LDM4LjI1QzU5MS42LDQzOC42LDYxMiw0MDAuMzUsNjEyLDM1N0M2MTIsMjkwLjcsNTU4LjQ1LDIzNC42LDQ5NC43LDIyOS41eiBNNzYuNSwxMDkuNjUgbDcxLjQsNjguODVDNjYuMywxODMuNiwwLDI0OS45LDAsMzMxLjVjMCw4NC4xNSw2OC44NSwxNTMsMTUzLDE1M2gyOTguMzVsNTEsNTFsMzMuMTUtMzMuMTVMMTA5LjY1LDc2LjVMNzYuNSwxMDkuNjV6IE0xOTYuMzUsMjI5LjVsMjA0LDIwNEgxNTNjLTU2LjEsMC0xMDItNDUuOS0xMDItMTAyYzAtNTYuMSw0NS45LTEwMiwxMDItMTAySDE5Ni4zNXoiIC8+Cjwvc3ZnPgo=);\n}\n\n.ms-editor .smartguide {\n    position: absolute;\n    z-index: 40;\n    font-size: 16px;\n}\n\n.ms-editor .smartguide.smartguide-in {\n    visibility: visible !important;\n    transition: opacity 0.5s;\n    opacity: 1;\n}\n\n.ms-editor .smartguide.smartguide-out {\n    transition: opacity 1s, visibility 1s;\n    visibility: hidden !important;\n    opacity: 0;\n}\n\n.ms-editor .smartguide .tag-icon {\n    padding: 0 18px;\n    border: 1px solid #959DA6;\n    font-weight: bold;\n    font-size: large;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 48px;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n}\n\n.ms-editor .smartguide .ellipsis {\n    cursor: pointer;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 38px;\n    padding: 0 8px;\n    font-weight: bold;\n    font-size: x-large;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .ellipsis:active {\n    background-color: #e0e0e0;\n}\n\n.ms-editor .smartguide .prompter-text-container {\n    background-color: rgba(255, 255, 255, 0.9);\n    height: 48px;\n    line-height: 48px;\n    overflow: hidden;\n    white-space: nowrap;\n    display: block;\n    text-align: left;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 30;\n    color: #bfbfbf;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .prompter-text-container > div > span {\n    cursor: pointer;\n    display: inline-block;\n}\n\n.ms-editor .smartguide .prompter-text-container .prompter-text {\n    margin-left: 12px;\n}\n\n.ms-editor .smartguide .prompter-text-container .prompter-text .added-word {\n    animation: 0.1s linear word-added,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .prompter-text-container .prompter-text .modified-word {\n    animation: 0.1s linear word-modified,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .candidates {\n    color: black;\n    flex-direction: column;\n    text-align: center;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    box-shadow: 2px 2px 12px #BDBDBD, -2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n    z-index: 100;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .candidates > span {\n    cursor: pointer;\n    padding: 2px 20px;\n}\n\n.ms-editor .smartguide .candidates > span:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .candidates > span:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .candidates .selected-word {\n    font-weight: bold;\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .more-menu {\n    flex-direction: column;\n    margin-right: 12px;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    z-index: 100;\n    box-shadow: 2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button {\n    color: black;\n    font-size: 16px;\n    cursor: pointer;\n    box-sizing: border-box;\n    background: transparent;\n    border: none;\n    padding: 0 24px;\n    margin: 0;\n    height: 40px;\n    outline: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .ps__rail-x {\n    top: 32px !important;\n}\n\n/** Stroke **/\n\n.ms-editor .removed-stroke {\n    opacity: 0;\n    transition: opacity 0.1s ease-in-out;\n}\n\n.ms-editor .added-stroke {\n    animation: 0.2s opacity-appear;\n}\n\n@keyframes color-input {\n    0% {\n        color: black;\n    }\n    100% {\n        color: #bfbfbf;\n    }\n}\n\n@keyframes word-added {\n    0% {\n        transform: translate(5px, 0);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes word-modified {\n    0% {\n        transform: translate(0, 5px);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes opacity-appear {\n    0% {\n        opacity: 0;\n    }\n    100% {\n        opacity : 1;\n    }\n}\n\n@keyframes spin {\n    0% {\n        transform: rotate(0deg);\n    }\n    100% {\n        transform: rotate(360deg);\n    }\n}\n\n@-webkit-keyframes spin {\n    0% {\n        -webkit-transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n    }\n}\n"),function(i){i.Mouse="mouse",i.Pen="pen",i.Touche="touch",i.Eraser="eraser"}(T||(T={}));i.Editor=class Editor{constructor(i,n){this._initialized=!1,this.debug=!1,this._wrapperHTML=i,this._wrapperHTML.classList.add((null==n?void 0:n.globalClassCss)||"ms-editor"),this._loaderHTML=document.createElement("div"),this._loaderHTML.classList.add("loader"),this._loaderHTML=this._wrapperHTML.appendChild(this._loaderHTML),this._loaderHTML.style.display="initial",this._errorHTML=document.createElement("div"),this._errorHTML.classList.add("error-msg"),this._errorHTML=this._wrapperHTML.appendChild(this._errorHTML),this._errorHTML.style.display="none",this._mode=T.Pen,this._styleManager=new StyleManager(null==n?void 0:n.penStyle,null==n?void 0:n.theme),this._configuration=new Configuration(null==n?void 0:n.configuration);const s=Math.max(this._wrapperHTML.clientWidth,this.configuration.rendering.minWidth),a=Math.max(this._wrapperHTML.clientHeight,this.configuration.rendering.minHeight);this.model=new Model(s,a),this._behaviorsManager=new BehaviorsManager(this.configuration,this.model,null==n?void 0:n.behaviors),this.initalizeBehaviors()}get initialized(){return this._initialized}get configuration(){return this._configuration}set configuration(i){this.clear(),this._configuration.overrideDefaultConfiguration(i),this.model.height=Math.max(this._wrapperHTML.clientHeight,this._configuration.rendering.minHeight),this.model.width=Math.max(this._wrapperHTML.clientWidth,this._configuration.rendering.minWidth),this._behaviorsManager.overrideDefaultBehaviors(this._configuration,this.model),this.initalizeBehaviors()}get behaviors(){return this._behaviorsManager.behaviors}get grabber(){return this._behaviorsManager.behaviors.grabber}get theme(){return this._styleManager.theme}get penStyle(){return this._styleManager.penStyle}get mode(){return this._mode}get events(){return GlobalEvent.getInstance()}initalizeBehaviors(){this._behaviorsManager.init(this._wrapperHTML,this.model).then((()=>__awaiter(this,void 0,void 0,(function*(){this.grabber.onPointerDown=(i,n)=>this.pointerDown(i,n),this.grabber.onPointerMove=(i,n)=>this.pointerMove(i,n),this.grabber.onPointerUp=(i,n)=>this.pointerUp(i,n),this.events.addEventListener(s.ERROR,(i=>this.handleError(i))),this.events.addEventListener(s.CLEAR,this.clear),this._initialized=!0,this._wrapperHTML.editor=this,this.events.emitLoaded()})))).catch((i=>{this._initialized=!1,this.showError(i),this.events.emitError(i)})).finally((()=>{this._loaderHTML.style.display="none"}))}showError(i){if(this._errorHTML.style.display="initial",this._errorHTML.innerText=i.message,this.debug){const n=document.createElement("p");n.innerHTML=i.name,this._errorHTML.prepend(n);const s=document.createElement("p");s.style.width="50vw",s.style.marginLeft="calc(-25vw + 100px)",s.innerHTML=i.stack||"",this._errorHTML.appendChild(s)}}handleError(i){const n=i,s=null==n?void 0:n.detail;this.showError(s)}pointerDown(i,n){var s,a;const c=i.target;if((null==c?void 0:c.id)===this._wrapperHTML.id||(null===(s=null==c?void 0:c.classList)||void 0===s?void 0:s.contains("ms-canvas"))){let{pointerType:s}=i;this._mode===T.Eraser&&(s=T.Eraser);const c=Object.assign({},null===(a=this.theme)||void 0===a?void 0:a.ink,this.penStyle);this.model.initCurrentStroke(n,i.pointerId,s,c),this.behaviors.drawCurrentStroke(this.model)}}pointerMove(i,n){this.model.appendToCurrentStroke(n),this.behaviors.drawCurrentStroke(this.model)}pointerUp(i,n){return __awaiter(this,void 0,void 0,(function*(){this.model.endCurrentStroke(n,this.penStyle),this.behaviors.drawModel(this.model);try{this.behaviors.addStrokes?this.model=yield this.behaviors.addStrokes(this.model):this.model=yield this.behaviors.export(this.model)}catch(i){this.showError(i)}}))}setMode(i){this._mode=i,this._mode===T.Eraser?this._wrapperHTML.classList.add("erasing"):(document.body.style.cursor="initial",this._wrapperHTML.classList.remove("erasing"))}undo(){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield this.behaviors.undo(),this.model}))}redo(){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield this.behaviors.redo(),this.model}))}clear(){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield this.behaviors.clear(this.model),this.model}))}resize(){return __awaiter(this,void 0,void 0,(function*(){return this.model.height=Math.max(this._wrapperHTML.clientHeight,this.configuration.rendering.minHeight),this.model.width=Math.max(this._wrapperHTML.clientWidth,this.configuration.rendering.minWidth),this.model=yield this.behaviors.resize(this.model),this.model}))}export(i){return __awaiter(this,void 0,void 0,(function*(){return this.behaviors.export(this.model,i)}))}},i.getAvailableLanguageList=function getAvailableLanguageList(i){var n,s;return __awaiter(this,void 0,void 0,(function*(){if((null===(n=null==i?void 0:i.server)||void 0===n?void 0:n.scheme)&&(null===(s=null==i?void 0:i.server)||void 0===s?void 0:s.host)){const n=i.server;return(yield fetch(`${n.scheme}://${n.host}/api/v4.0/iink/availableLanguageList`)).json()}return Promise.reject("Cannot get languages ! Please check your server configuration!")}))},Object.defineProperty(i,"__esModule",{value:!0})}));
//# sourceMappingURL=iink.min.js.map
