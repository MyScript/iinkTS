!function(i,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((i="undefined"!=typeof globalThis?globalThis:i||self).iink={})}(this,(function(i){"use strict";function __awaiter(i,s,n,a){return new(n||(n=Promise))((function(l,d){function fulfilled(i){try{step(a.next(i))}catch(i){d(i)}}function rejected(i){try{step(a.throw(i))}catch(i){d(i)}}function step(i){i.done?l(i.value):function adopt(i){return i instanceof n?i:new n((function(s){s(i)}))}(i.value).then(fulfilled,rejected)}step((a=a.apply(i,s||[])).next())}))}function __classPrivateFieldGet(i,s,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof s?i!==s||!a:!s.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(i):a?a.value:s.get(i)}function __classPrivateFieldSet(i,s,n,a,l){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!l)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof s?i!==s||!l:!s.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?l.call(i,n):l?l.value=n:s.set(i,n),n}const s={WRONG_CREDENTIALS:"Application credentials are invalid. Please check or regenerate your application key and hmackey.",UNKNOW:"An unknown error has occurred.",ABNORMAL_CLOSURE:"MyScript recognition server is not reachable. Please reload once you are connected.",CANT_ESTABLISH:"Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.",GOING_AWAY:"MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.",PROTOCOL_ERROR:"MyScript recognition server terminated the connection due to a protocol error.",UNSUPPORTED_DATA:"MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)",INVALID_FRAME_PAULOAD:"MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).",POLICY_VIOLATION:"MyScript recognition server terminated the connection because it received a message that violates its policy.",MESSAGE_TOO_BIG:"MyScript recognition server terminated the connection because a data frame was received that is too large.",INTERNAL_ERROR:"MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.",SERVICE_RESTART:"MyScript recognition server terminated the connection because it is restarting.",TRY_AGAIN:"MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.",BAD_GATEWAY:"MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.",TLS_HANDSHAKE:"MyScript recognition server connection was closed due to a failure to perform a TLS handshake"},n={CHANGED:"changed",CLEAR:"clear",CLEARED:"cleared",CONVERT:"convert",CONVERTED:"converted",ERROR:"error",EXPORTED:"exported",IMPORT:"import",IMPORTED:"imported",IDLE:"idle",LOADED:"loaded",NOTIF:"notif",RENDERED:"rendered"},a="ws_part_change",l="ws_content_change",d="ws_svg_patch",c="ws_exported",h="ws_error",p="ws_initialized",u="ws_connected",v="connection_active",g="ws_disconnected",m="CLOSE_RECOGNIZER",_={JIIX:"application/vnd.myscript.jiix",TEXT:"text/plain",LATEX:"application/x-latex",MATHML:"application/mathml+xml",SVG:"image/svg+xml",OFFICE_DOCUMENT:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};var f={Error:s,EventType:n,Exports:_};class PointerEventGrabber{constructor(i){this.prevent=i=>i.preventDefault(),this.pointerDownHandler=i=>{if(0===i.button&&1===i.buttons&&(this.activePointerId=i.pointerId,this.onPointerDown)){const s=this.extractPoint(i);this.onPointerDown(i,s)}},this.pointerMoveHandler=i=>{if(null!=this.activePointerId&&this.activePointerId===i.pointerId&&this.onPointerMove){const s=this.extractPoint(i);this.onPointerMove(i,s)}},this.pointerUpHandler=i=>{if(null!=this.activePointerId&&this.activePointerId===i.pointerId&&(this.activePointerId=void 0,i.stopPropagation(),this.onPointerUp)){const s=this.extractPoint(i);this.onPointerUp(i,s)}},this.setConfiguration(i)}roundFloat(i,s){if(s>=0){const n=Math.pow(10,s);return Math.round(i/n)*n}return i}extractPoint(i){let s,n;({clientX:s,clientY:n}="changedTouches"in i?i.changedTouches[0]:i);const a=this.domElement.getBoundingClientRect();return{x:this.roundFloat(s-a.left-this.domElement.clientLeft,this.configuration.xyFloatPrecision),y:this.roundFloat(n-a.top-this.domElement.clientTop,this.configuration.xyFloatPrecision),t:this.roundFloat(Date.now(),this.configuration.timestampFloatPrecision),p:i.pressure||1}}setConfiguration(i){this.configuration=i}attach(i){this.domElement&&this.detach(),this.domElement=i,this.domElement.addEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("touchmove",this.prevent),document.documentElement.addEventListener("pointerdown",(()=>{}))}detach(){var i,s,n,a,l,d,c;null===(i=this.domElement)||void 0===i||i.removeEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),null===(s=this.domElement)||void 0===s||s.removeEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),null===(n=this.domElement)||void 0===n||n.removeEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),null===(a=this.domElement)||void 0===a||a.removeEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),null===(l=this.domElement)||void 0===l||l.removeEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),null===(d=this.domElement)||void 0===d||d.removeEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),null===(c=this.domElement)||void 0===c||c.removeEventListener("touchmove",this.prevent),document.documentElement.removeEventListener("pointerdown",(()=>{}))}}const y={table:"table",shape:"shape",recognizedShape:"recognizedShape",ellipse:"ellipse",line:"line"};function phi(i){let s=(i+Math.PI)%(2*Math.PI)-Math.PI;return s<-Math.PI&&(s+=2*Math.PI),s}function drawArrowHead(i,s,n,a){const l=phi(n+Math.PI*(7/8)),d=phi(n-Math.PI*(7/8));i.save();try{i.fillStyle=i.strokeStyle,i.moveTo(s.x,s.y),i.beginPath(),i.lineTo(s.x+a*Math.cos(l),s.y+a*Math.sin(l)),i.lineTo(s.x+a*Math.cos(d),s.y+a*Math.sin(d)),i.lineTo(s.x,s.y),i.fill()}finally{i.restore()}}function drawShapeEllipse(i,s){const n=function drawEllipseArc(i,s){const{centerPoint:n,maxRadius:a,minRadius:l,orientation:d,startAngle:c,sweepAngle:h}=s;let p=Math.cos(d),u=Math.sin(d),v=p,g=u;p*=a,v*=l,u*=a,g*=l;const m=Math.floor(Math.abs(h)/.02),_=[];i.save();try{i.beginPath();for(let s=0;s<=m;s++){const d=c+s/m*h,f=Math.atan2(Math.sin(d)/l,Math.cos(d)/a),y=Math.cos(f),P=Math.sin(f),w=n.x+p*y-g*P,x=n.y+v*P+u*y;0===s?i.moveTo(w,x):i.lineTo(w,x),0!==s&&s!==m||_.push({x:w,y:x})}i.stroke()}finally{i.restore()}return _}(i,s);"ARROW_HEAD"===(null==s?void 0:s.beginDecoration)&&drawArrowHead(i,n[0],s.beginTangentAngle,12),"ARROW_HEAD"===(null==s?void 0:s.endDecoration)&&drawArrowHead(i,n[1],s.endTangentAngle,12)}function drawLine(i,s,n){i.save();try{i.beginPath(),i.moveTo(s.x,s.y),i.lineTo(n.x,n.y),i.stroke()}finally{i.restore()}}function drawShapeSymbol(i,s){i.save();try{if(i.lineWidth=s.width,i.strokeStyle=s.color,s.elementType)switch(s.elementType){case y.shape:const n=s;drawShapeSymbol(i,n.candidates[n.selectedCandidateIndex]);break;case y.table:s.lines.forEach((s=>drawShapeSymbol(i,s)));break;case y.line:const a=s;drawLine(i,a.data.p1,a.data.p2)}else switch(s.type){case y.ellipse:drawShapeEllipse(i,s);break;case y.line:!function drawShapeLine(i,s){drawLine(i,s.firstPoint,s.lastPoint),"ARROW_HEAD"===s.beginDecoration&&drawArrowHead(i,s.firstPoint,s.beginTangentAngle,12),"ARROW_HEAD"===s.endDecoration&&drawArrowHead(i,s.lastPoint,s.endTangentAngle,12)}(i,s);break;case y.recognizedShape:s.primitives.forEach((s=>drawShapeSymbol(i,s)))}}finally{i.restore()}}const P={inputCharacter:"inputCharacter",char:"char",string:"string",textLine:"textLine"};function drawTextLine(i,s){!function drawText(i,s,n){i.save();try{i.font=`${n.textHeight}px serif`,i.textAlign="CENTER"===n.justificationType?"center":"left",i.textBaseline="bottom",i.fillStyle=i.strokeStyle,i.fillText(s,n.topLeftPoint.x,n.topLeftPoint.y+n.height)}finally{i.restore()}}(i,s.label,s.data),s.underlineList.forEach((n=>{!function drawUnderline(i,s,n,a){const l=a.width/n.length;drawLine(i,{x:a.topLeftPoint.x+s.data.firstCharacter*l,y:a.topLeftPoint.y+a.height},{x:a.topLeftPoint.x+s.data.lastCharacter*l,y:a.topLeftPoint.y+a.height})}(i,n,s.label,s.data)}))}function computeLinksPoints(i,s,n){const a=i.p*n;return[{x:i.x-Math.sin(s)*a,y:i.y+Math.cos(s)*a},{x:i.x+Math.sin(s)*a,y:i.y-Math.cos(s)*a}]}function computeMiddlePoint(i,s){return{x:(s.x+i.x)/2,y:(s.y+i.y)/2,p:(s.p+i.p)/2,t:(s.t+i.t)/2}}function computeAxeAngle(i,s){return Math.atan2(s.y-i.y,s.x-i.x)}class CanvasQuadraticStroker{renderArc(i,s,n){i.arc(s.x,s.y,n,0,2*Math.PI,!0)}renderLine(i,s,n,a){const l=computeLinksPoints(s,computeAxeAngle(s,n),a),d=computeLinksPoints(n,computeAxeAngle(s,n),a);i.moveTo(l[0].x,l[0].y),i.lineTo(d[0].x,d[0].y),i.lineTo(d[1].x,d[1].y),i.lineTo(l[1].x,l[1].y)}renderFinal(i,s,n,a){const l=computeAxeAngle(s,n),d=computeLinksPoints(n,l,a);i.moveTo(d[0].x,d[0].y);for(let s=1;s<=6;s++){const d=l-s*Math.PI/6;i.lineTo(n.x-n.p*a*Math.sin(d),n.y+n.p*a*Math.cos(d))}}renderQuadratic(i,s,n,a,l){const d=computeLinksPoints(s,computeAxeAngle(s,a),l),c=computeLinksPoints(n,computeAxeAngle(a,n),l),h=computeLinksPoints(a,computeAxeAngle(s,n),l);i.moveTo(d[0].x,d[0].y),i.quadraticCurveTo(h[0].x,h[0].y,c[0].x,c[0].y),i.lineTo(c[1].x,c[1].y),i.quadraticCurveTo(h[1].x,h[1].y,d[1].x,d[1].y)}getPointByIndex(i,s){return{x:i.x[s]||0,y:i.y[s]||0,t:i.t[s]||0,p:i.p[s]||0}}drawStroke(i,s){const n=s.x.length,a=s.width>0?s.width:i.lineWidth,l=s.color?s.color:i.strokeStyle,d=this.getPointByIndex(s,0),c=n-2;i.save();try{if(i.beginPath(),n<3)this.renderArc(i,d,.6*a);else{this.renderArc(i,d,a*d.p);const l=computeMiddlePoint(d,this.getPointByIndex(s,1));this.renderLine(i,d,l,a);for(let n=0;n<c;n++){const l=computeMiddlePoint(this.getPointByIndex(s,n),this.getPointByIndex(s,n+1)),d=computeMiddlePoint(this.getPointByIndex(s,n+1),this.getPointByIndex(s,n+2)),c=this.getPointByIndex(s,n+1);this.renderQuadratic(i,l,d,c,a)}const h=computeMiddlePoint(this.getPointByIndex(s,n-2),this.getPointByIndex(s,n-1)),p=this.getPointByIndex(s,n-1);this.renderLine(i,h,p,a);const u=this.getPointByIndex(s,n-2),v=this.getPointByIndex(s,n-1);this.renderFinal(i,u,v,a)}i.closePath(),void 0!==l&&(i.fillStyle=l,i.fill()),i.save()}finally{i.restore()}}}class CanvasRenderer{constructor(i){this.config=i,this.stroker=new CanvasQuadraticStroker}createCanvas(i,s){const n=document.createElement("canvas");return n.id=s,n.classList.add(s),n.classList.add("ms-canvas"),i.appendChild(n),n}resizeContent(){const i=window.devicePixelRatio;[this.context.renderingCanvas,this.context.capturingCanvas].forEach((s=>{var n;const a=s.parentNode,l=Math.max(this.config.minWidth,a.clientWidth),d=Math.max(this.config.minHeight,a.clientHeight);s.width=l*i,s.height=d*i,null===(n=s.getContext("2d"))||void 0===n||n.scale(i,i),s.style.width=`${l}px`,s.style.height=`${d}px`}))}drawSymbol(i,s){const n=s.elementType||s.type;"stroke"===n?function drawStroke(i,s,n){n&&s&&"eraser"!==s.pointerType&&n.drawStroke(i,s)}(i,s,this.stroker):Object.keys(P).includes(n)?function drawTextSymbol(i,s){i.save();try{i.lineWidth=s.width,i.strokeStyle=s.color,(s.elementType||s.type)===P.textLine&&drawTextLine(i,s)}finally{i.restore()}}(i,s):Object.keys(y).includes(n)&&drawShapeSymbol(i,s)}init(i){const s=this.createCanvas(i,"ms-rendering-canvas"),n=this.createCanvas(i,"ms-capture-canvas");this.context={parent:i,renderingCanvas:s,renderingCanvasContext:s.getContext("2d"),capturingCanvas:n,capturingCanvasContext:n.getContext("2d")},this.resizeContent()}drawModel(i){var s;null===(s=this.context.renderingCanvasContext)||void 0===s||s.clearRect(0,0,this.context.renderingCanvas.width,this.context.renderingCanvas.height);const n=[...i.defaultSymbols,...i.rawStrokes];n.forEach((i=>this.drawSymbol(this.context.renderingCanvasContext,i))),this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),i.updatePositionRendered(n.length)}drawPendingStroke(i){this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),i&&"eraser"!==(null==i?void 0:i.pointerType)&&this.stroker.drawStroke(this.context.capturingCanvasContext,i)}resize(i){this.resizeContent(),this.drawModel(i)}destroy(){this.context.parent&&(this.context.parent.innerHTML="")}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function createCommonjsModule(i,s){return i(s={exports:{}},s.exports),s.exports}var w=createCommonjsModule((function(i,s){i.exports=function(i){function e(n){if(s[n])return s[n].exports;var a=s[n]={i:n,l:!1,exports:{}};return i[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var s={};return e.m=i,e.c=s,e.i=function(i){return i},e.d=function(i,s,n){e.o(i,s)||Object.defineProperty(i,s,{configurable:!1,enumerable:!0,get:n})},e.n=function(i){var s=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(s,"a",s),s},e.o=function(i,s){return Object.prototype.hasOwnProperty.call(i,s)},e.p="",e(e.s=1)}([function(i,s,n){function o(i,s){if(!(i instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(s,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},l=function t(i){var s=this;o(this,t),this.toJSON=function(i){if("string"!=typeof i)return console.error("Need a CSS string but given ",void 0===i?"undefined":a(i),i),"Not a valid CSS..!";var n={},l=void 0,d=void 0,c=void 0;try{i.split("{").forEach((function(i){if(d=i.trim())if(-1===d.indexOf("}"))n[d]={},l=d;else{d.substring(0,d.indexOf("}")).split(";").forEach((function(i){(c=i.split(":"))&&2===c.length&&(n[l][c[0].trim().replace(/^\"|\"$/g,"")]=s._trimSemiColon(c[1].trim().replace(/^\"|\"$/g,"")))}));try{(l=d.split("}")[1].trim())&&(n[l]={})}catch(i){}}}))}catch(i){return"Not a valid CSS..!"}return n},this.toCSS=function(i){if("object"!==(void 0===i?"undefined":a(i)))return console.error("Need a JSON object but given ",void 0===i?"undefined":a(i),i),"Not a valid JSON..!";var s="";try{for(var n in i)if(i.hasOwnProperty(n)){for(var l in s+=n+" {\n",i[n])i[n].hasOwnProperty(l)&&(s+=l+": "+i[n][l]+";\n");s+="}\n"}}catch(i){return"Not a valid JSON..!"}return s},this._trimSemiColon=function(i){return";"===i.slice(-1)?i.slice(0,s.length-1):i}};s.default=l},function(i,s,n){i.exports=n(0).default}])})),x=function unwrapExports(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}(w);w.JsonCSS;const S=new x;var b,E,C,G,M,k,T,L,A,I,D,R,N,W,O,z,j,H,B,X,$,U,J,V,Y,Z,K,q,Q,ee,te,ie,se={themeToCSS:i=>S.toCSS(i),themeToJSON(i){const s=S.toJSON(i);return s[".text"]["font-size"]=Number(s[".text"]["font-size"]),s.ink["-myscript-pen-width"]=Number(s.ink["-myscript-pen-width"]),s.ink.width=Number(s.ink.width),s},penStyleToCSS(i){let s=S.toCSS({css:i});return s=s.substring(6,s.length-3),s},penStyleToJSON(i){const s=S.toJSON(`css {${i}}`).css;return s.width?s.width=Number(s.width):delete s.width,s["-myscript-pen-width"]?s["-myscript-pen-width"]=Number(s["-myscript-pen-width"]):delete s["-myscript-pen-width"],s}},ne=createCommonjsModule((function(i,s){var n;i.exports=(n=n||function(i,s){var n=Object.create||function(){function F(){}return function(i){var s;return F.prototype=i,s=new F,F.prototype=null,s}}(),a={},l=a.lib={},d=l.Base={extend:function(i){var s=n(this);return i&&s.mixIn(i),s.hasOwnProperty("init")&&this.init!==s.init||(s.init=function(){s.$super.init.apply(this,arguments)}),s.init.prototype=s,s.$super=this,s},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var s in i)i.hasOwnProperty(s)&&(this[s]=i[s]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}},c=l.WordArray=d.extend({init:function(i,n){i=this.words=i||[],this.sigBytes=n!=s?n:4*i.length},toString:function(i){return(i||p).stringify(this)},concat:function(i){var s=this.words,n=i.words,a=this.sigBytes,l=i.sigBytes;if(this.clamp(),a%4)for(var d=0;d<l;d++){var c=n[d>>>2]>>>24-d%4*8&255;s[a+d>>>2]|=c<<24-(a+d)%4*8}else for(d=0;d<l;d+=4)s[a+d>>>2]=n[d>>>2];return this.sigBytes+=l,this},clamp:function(){var s=this.words,n=this.sigBytes;s[n>>>2]&=4294967295<<32-n%4*8,s.length=i.ceil(n/4)},clone:function(){var i=d.clone.call(this);return i.words=this.words.slice(0),i},random:function(s){for(var n,a=[],r=function(s){var n=987654321,a=4294967295;return function(){var l=((n=36969*(65535&n)+(n>>16)&a)<<16)+(s=18e3*(65535&s)+(s>>16)&a)&a;return l/=4294967296,(l+=.5)*(i.random()>.5?1:-1)}},l=0;l<s;l+=4){var d=r(4294967296*(n||i.random()));n=987654071*d(),a.push(4294967296*d()|0)}return new c.init(a,s)}}),h=a.enc={},p=h.Hex={stringify:function(i){for(var s=i.words,n=i.sigBytes,a=[],l=0;l<n;l++){var d=s[l>>>2]>>>24-l%4*8&255;a.push((d>>>4).toString(16)),a.push((15&d).toString(16))}return a.join("")},parse:function(i){for(var s=i.length,n=[],a=0;a<s;a+=2)n[a>>>3]|=parseInt(i.substr(a,2),16)<<24-a%8*4;return new c.init(n,s/2)}},u=h.Latin1={stringify:function(i){for(var s=i.words,n=i.sigBytes,a=[],l=0;l<n;l++){var d=s[l>>>2]>>>24-l%4*8&255;a.push(String.fromCharCode(d))}return a.join("")},parse:function(i){for(var s=i.length,n=[],a=0;a<s;a++)n[a>>>2]|=(255&i.charCodeAt(a))<<24-a%4*8;return new c.init(n,s)}},v=h.Utf8={stringify:function(i){try{return decodeURIComponent(escape(u.stringify(i)))}catch(i){throw new Error("Malformed UTF-8 data")}},parse:function(i){return u.parse(unescape(encodeURIComponent(i)))}},g=l.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(i){"string"==typeof i&&(i=v.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(s){var n=this._data,a=n.words,l=n.sigBytes,d=this.blockSize,h=l/(4*d),p=(h=s?i.ceil(h):i.max((0|h)-this._minBufferSize,0))*d,u=i.min(4*p,l);if(p){for(var v=0;v<p;v+=d)this._doProcessBlock(a,v);var g=a.splice(0,p);n.sigBytes-=u}return new c.init(g,u)},clone:function(){var i=d.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0});l.Hasher=g.extend({cfg:d.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){return i&&this._append(i),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(s,n){return new i.init(n).finalize(s)}},_createHmacHelper:function(i){return function(s,n){return new m.HMAC.init(i,n).finalize(s)}}});var m=a.algo={};return a}(Math),n)})),re=createCommonjsModule((function(i,s){i.exports=ne.enc.Hex})),oe=(createCommonjsModule((function(i,s){var n,a,l,d,c,h,p;i.exports=(l=(a=p=ne).lib,d=l.Base,c=l.WordArray,(h=a.x64={}).Word=d.extend({init:function(i,s){this.high=i,this.low=s}}),h.WordArray=d.extend({init:function(i,s){i=this.words=i||[],this.sigBytes=s!=n?s:8*i.length},toX32:function(){for(var i=this.words,s=i.length,n=[],a=0;a<s;a++){var l=i[a];n.push(l.high),n.push(l.low)}return c.create(n,this.sigBytes)},clone:function(){for(var i=d.clone.call(this),s=i.words=this.words.slice(0),n=s.length,a=0;a<n;a++)s[a]=s[a].clone();return i}}),p)})),createCommonjsModule((function(i,s){var n;i.exports=(n=ne,function(){var i=n,s=i.lib.Hasher,a=i.x64,l=a.Word,d=a.WordArray,c=i.algo;function X64Word_create(){return l.create.apply(l,arguments)}var h=[X64Word_create(1116352408,3609767458),X64Word_create(1899447441,602891725),X64Word_create(3049323471,3964484399),X64Word_create(3921009573,2173295548),X64Word_create(961987163,4081628472),X64Word_create(1508970993,3053834265),X64Word_create(2453635748,2937671579),X64Word_create(2870763221,3664609560),X64Word_create(3624381080,2734883394),X64Word_create(310598401,1164996542),X64Word_create(607225278,1323610764),X64Word_create(1426881987,3590304994),X64Word_create(1925078388,4068182383),X64Word_create(2162078206,991336113),X64Word_create(2614888103,633803317),X64Word_create(3248222580,3479774868),X64Word_create(3835390401,2666613458),X64Word_create(4022224774,944711139),X64Word_create(264347078,2341262773),X64Word_create(604807628,2007800933),X64Word_create(770255983,1495990901),X64Word_create(1249150122,1856431235),X64Word_create(1555081692,3175218132),X64Word_create(1996064986,2198950837),X64Word_create(2554220882,3999719339),X64Word_create(2821834349,766784016),X64Word_create(2952996808,2566594879),X64Word_create(3210313671,3203337956),X64Word_create(3336571891,1034457026),X64Word_create(3584528711,2466948901),X64Word_create(113926993,3758326383),X64Word_create(338241895,168717936),X64Word_create(666307205,1188179964),X64Word_create(773529912,1546045734),X64Word_create(1294757372,1522805485),X64Word_create(1396182291,2643833823),X64Word_create(1695183700,2343527390),X64Word_create(1986661051,1014477480),X64Word_create(2177026350,1206759142),X64Word_create(2456956037,344077627),X64Word_create(2730485921,1290863460),X64Word_create(2820302411,3158454273),X64Word_create(3259730800,3505952657),X64Word_create(3345764771,106217008),X64Word_create(3516065817,3606008344),X64Word_create(3600352804,1432725776),X64Word_create(4094571909,1467031594),X64Word_create(275423344,851169720),X64Word_create(430227734,3100823752),X64Word_create(506948616,1363258195),X64Word_create(659060556,3750685593),X64Word_create(883997877,3785050280),X64Word_create(958139571,3318307427),X64Word_create(1322822218,3812723403),X64Word_create(1537002063,2003034995),X64Word_create(1747873779,3602036899),X64Word_create(1955562222,1575990012),X64Word_create(2024104815,1125592928),X64Word_create(2227730452,2716904306),X64Word_create(2361852424,442776044),X64Word_create(2428436474,593698344),X64Word_create(2756734187,3733110249),X64Word_create(3204031479,2999351573),X64Word_create(3329325298,3815920427),X64Word_create(3391569614,3928383900),X64Word_create(3515267271,566280711),X64Word_create(3940187606,3454069534),X64Word_create(4118630271,4000239992),X64Word_create(116418474,1914138554),X64Word_create(174292421,2731055270),X64Word_create(289380356,3203993006),X64Word_create(460393269,320620315),X64Word_create(685471733,587496836),X64Word_create(852142971,1086792851),X64Word_create(1017036298,365543100),X64Word_create(1126000580,2618297676),X64Word_create(1288033470,3409855158),X64Word_create(1501505948,4234509866),X64Word_create(1607167915,987167468),X64Word_create(1816402316,1246189591)],p=[];!function(){for(var i=0;i<80;i++)p[i]=X64Word_create()}();var u=c.SHA512=s.extend({_doReset:function(){this._hash=new d.init([new l.init(1779033703,4089235720),new l.init(3144134277,2227873595),new l.init(1013904242,4271175723),new l.init(2773480762,1595750129),new l.init(1359893119,2917565137),new l.init(2600822924,725511199),new l.init(528734635,4215389547),new l.init(1541459225,327033209)])},_doProcessBlock:function(i,s){for(var n=this._hash.words,a=n[0],l=n[1],d=n[2],c=n[3],u=n[4],v=n[5],g=n[6],m=n[7],_=a.high,f=a.low,y=l.high,P=l.low,w=d.high,x=d.low,S=c.high,b=c.low,E=u.high,C=u.low,G=v.high,M=v.low,k=g.high,T=g.low,L=m.high,A=m.low,I=_,D=f,R=y,N=P,W=w,O=x,z=S,j=b,H=E,B=C,X=G,$=M,U=k,J=T,V=L,Y=A,Z=0;Z<80;Z++){var K=p[Z];if(Z<16)var q=K.high=0|i[s+2*Z],Q=K.low=0|i[s+2*Z+1];else{var ee=p[Z-15],te=ee.high,ie=ee.low,se=(te>>>1|ie<<31)^(te>>>8|ie<<24)^te>>>7,ne=(ie>>>1|te<<31)^(ie>>>8|te<<24)^(ie>>>7|te<<25),re=p[Z-2],oe=re.high,ae=re.low,le=(oe>>>19|ae<<13)^(oe<<3|ae>>>29)^oe>>>6,de=(ae>>>19|oe<<13)^(ae<<3|oe>>>29)^(ae>>>6|oe<<26),ce=p[Z-7],he=ce.high,pe=ce.low,ue=p[Z-16],ve=ue.high,ge=ue.low;q=(q=(q=se+he+((Q=ne+pe)>>>0<ne>>>0?1:0))+le+((Q+=de)>>>0<de>>>0?1:0))+ve+((Q+=ge)>>>0<ge>>>0?1:0),K.high=q,K.low=Q}var me,_e=H&X^~H&U,fe=B&$^~B&J,ye=I&R^I&W^R&W,Pe=D&N^D&O^N&O,we=(I>>>28|D<<4)^(I<<30|D>>>2)^(I<<25|D>>>7),xe=(D>>>28|I<<4)^(D<<30|I>>>2)^(D<<25|I>>>7),Se=(H>>>14|B<<18)^(H>>>18|B<<14)^(H<<23|B>>>9),be=(B>>>14|H<<18)^(B>>>18|H<<14)^(B<<23|H>>>9),Ee=h[Z],Fe=Ee.high,Ce=Ee.low,Ge=V+Se+((me=Y+be)>>>0<Y>>>0?1:0),Me=xe+Pe;V=U,Y=J,U=X,J=$,X=H,$=B,H=z+(Ge=(Ge=(Ge=Ge+_e+((me+=fe)>>>0<fe>>>0?1:0))+Fe+((me+=Ce)>>>0<Ce>>>0?1:0))+q+((me+=Q)>>>0<Q>>>0?1:0))+((B=j+me|0)>>>0<j>>>0?1:0)|0,z=W,j=O,W=R,O=N,R=I,N=D,I=Ge+(we+ye+(Me>>>0<xe>>>0?1:0))+((D=me+Me|0)>>>0<me>>>0?1:0)|0}f=a.low=f+D,a.high=_+I+(f>>>0<D>>>0?1:0),P=l.low=P+N,l.high=y+R+(P>>>0<N>>>0?1:0),x=d.low=x+O,d.high=w+W+(x>>>0<O>>>0?1:0),b=c.low=b+j,c.high=S+z+(b>>>0<j>>>0?1:0),C=u.low=C+B,u.high=E+H+(C>>>0<B>>>0?1:0),M=v.low=M+$,v.high=G+X+(M>>>0<$>>>0?1:0),T=g.low=T+J,g.high=k+U+(T>>>0<J>>>0?1:0),A=m.low=A+Y,m.high=L+V+(A>>>0<Y>>>0?1:0)},_doFinalize:function(){var i=this._data,s=i.words,n=8*this._nDataBytes,a=8*i.sigBytes;return s[a>>>5]|=128<<24-a%32,s[30+(a+128>>>10<<5)]=Math.floor(n/4294967296),s[31+(a+128>>>10<<5)]=n,i.sigBytes=4*s.length,this._process(),this._hash.toX32()},clone:function(){var i=s.clone.call(this);return i._hash=this._hash.clone(),i},blockSize:32});i.SHA512=s._createHelper(u),i.HmacSHA512=s._createHmacHelper(u)}(),n.SHA512)})),createCommonjsModule((function(i,s){var n,a,l;i.exports=(a=(n=ne).lib.Base,l=n.enc.Utf8,void(n.algo.HMAC=a.extend({init:function(i,s){i=this._hasher=new i.init,"string"==typeof s&&(s=l.parse(s));var n=i.blockSize,a=4*n;s.sigBytes>a&&(s=i.finalize(s)),s.clamp();for(var d=this._oKey=s.clone(),c=this._iKey=s.clone(),h=d.words,p=c.words,u=0;u<n;u++)h[u]^=1549556828,p[u]^=909522486;d.sigBytes=c.sigBytes=a,this.reset()},reset:function(){var i=this._hasher;i.reset(),i.update(this._iKey)},update:function(i){return this._hasher.update(i),this},finalize:function(i){var s=this._hasher,n=s.finalize(i);return s.reset(),s.finalize(this._oKey.clone().concat(n))}})))})),createCommonjsModule((function(i,s){i.exports=ne.HmacSHA512})));function computeHmac(i,s,n){return new oe(i,s+n).toString(re)}class AbstractRecognizer{constructor(i,s){this.serverConfiguration=i,this.recognitionConfiguration=s}}class RestRecognizer extends AbstractRecognizer{constructor(i,s){super(i,s)}get url(){return`${this.serverConfiguration.scheme}://${this.serverConfiguration.host}/api/v4.0/iink/batch`}get postConfig(){switch(this.recognitionConfiguration.type){case"DIAGRAM":return{lang:this.recognitionConfiguration.lang,diagram:this.recognitionConfiguration.diagram,export:this.recognitionConfiguration.export};case"MATH":return{lang:this.recognitionConfiguration.lang,math:this.recognitionConfiguration.math,export:this.recognitionConfiguration.export};case"Raw Content":return{lang:this.recognitionConfiguration.lang,"raw-content":this.recognitionConfiguration["raw-content"],export:this.recognitionConfiguration.export};case"TEXT":return{lang:this.recognitionConfiguration.lang,text:this.recognitionConfiguration.text,export:this.recognitionConfiguration.export};default:throw new Error(`get postConfig error Recognition type unkow "${this.recognitionConfiguration.type}"`)}}buildData(i){const s=[];i.strokeGroups.forEach((i=>{const n={penStyle:"{}"===JSON.stringify(i.penStyle)?void 0:se.penStyleToCSS(i.penStyle),strokes:i.strokes.map((i=>({x:i.x,y:i.y,t:i.t,p:i.p,pointerType:i.pointerType})))};s.push(n)}));const n="Raw Content"===this.recognitionConfiguration.type?"Raw Content":this.recognitionConfiguration.type.charAt(0).toUpperCase()+this.recognitionConfiguration.type.slice(1).toLowerCase();return{configuration:this.postConfig,xDPI:96,yDPI:96,contentType:n,height:i.height,width:i.width,strokeGroups:s}}post(i,s){return __awaiter(this,void 0,void 0,(function*(){const n=new Headers;n.append("Accept","application/json,"+s),n.append("applicationKey",this.serverConfiguration.applicationKey),n.append("hmac",computeHmac(JSON.stringify(i),this.serverConfiguration.applicationKey,this.serverConfiguration.hmacKey)),n.append("Content-Type","application/json");const a={method:"POST",headers:n,body:JSON.stringify(i)},l=new Request(this.url,a),d=yield fetch(l);if(d.ok){let i;switch(d.headers.get("content-type")){case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"image/png":case"image/jpeg":i=yield d.blob();break;case"application/json":i=yield d.json();break;case"application/vnd.myscript.jiix":i=yield d.clone().json().catch((()=>__awaiter(this,void 0,void 0,(function*(){return yield d.text()}))));break;default:i=yield d.text()}return i}throw yield d.json()}))}tryFetch(i,n){return __awaiter(this,void 0,void 0,(function*(){return this.post(i,n).then((i=>{const s={};return s[n]=i,s})).catch((i=>{let n=i.message||s.UNKNOW;i.code?"access.not.granted"===i.code&&(n=s.WRONG_CREDENTIALS):n=s.CANT_ESTABLISH;throw new Error(n)}))}))}getMimeTypes(i){let s=i||[];if(!s.length)switch(this.recognitionConfiguration.type){case"DIAGRAM":s=this.recognitionConfiguration.diagram.mimeTypes;break;case"MATH":s=this.recognitionConfiguration.math.mimeTypes;break;case"Raw Content":s=["application/vnd.myscript.jiix"];break;case"TEXT":s=this.recognitionConfiguration.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.recognitionConfiguration.type}" is unknown.\n Possible types are:\n -DIAGRAM\n -MATH\n -Raw Content\n -TEXT`)}return s}convert(i,s,n){return __awaiter(this,void 0,void 0,(function*(){const a=i.getClone();a.updatePositionSent();const l=this.getMimeTypes(n),d=this.buildData(a);d.conversionState=s;const c=l.map((i=>this.tryFetch(d,i)));return(yield Promise.all(c)).forEach((i=>{a.converts=Object.assign(a.converts||{},i)})),a.updatePositionReceived(),a}))}exportModel(i,s){return __awaiter(this,void 0,void 0,(function*(){const n=this.buildData(i);return this.tryFetch(n,s)}))}export(i,s){return __awaiter(this,void 0,void 0,(function*(){const n=i.getClone();if(n.updatePositionSent(),n.isEmpty)return Promise.resolve(n);const a=this.getMimeTypes(s);if(!a.length)return Promise.reject(new Error("Export failed, no mimeTypes define in recognition configuration"));const l=a.filter((i=>!n.exports||!n.exports[i]));return(yield Promise.all(l.map((i=>this.exportModel(n,i))))).forEach((i=>{n.exports=Object.assign(n.exports||{},i)})),n.updatePositionReceived(),n}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){return this.export(i)}))}}class DeferredPromise{constructor(){this.isFullFilled=!1,this.isPending=!0,this.promise=new Promise(((i,s)=>{this.reject=i=>__awaiter(this,void 0,void 0,(function*(){return this.isFullFilled=!0,this.isPending=!1,s(i)})),this.resolve=s=>__awaiter(this,void 0,void 0,(function*(){return this.isFullFilled=!0,this.isPending=!1,i(s)}))}))}}class GlobalEvent extends EventTarget{constructor(){super(),b.add(this)}static getInstance(){return __classPrivateFieldGet(GlobalEvent,E,"f",C)||__classPrivateFieldSet(GlobalEvent,E,new GlobalEvent,"f",C),__classPrivateFieldGet(GlobalEvent,E,"f",C)}emitLoaded(){__classPrivateFieldGet(this,b,"m",G).call(this,n.LOADED)}emitExported(i){__classPrivateFieldGet(this,b,"m",G).call(this,n.EXPORTED,i)}emitChange(i){__classPrivateFieldGet(this,b,"m",G).call(this,n.CHANGED,{canUndo:i.canUndo,canRedo:i.canRedo,canClear:!i.stack[i.stackIndex].isEmpty,stackIndex:i.stackIndex,stackLength:i.stack.length,isEmpty:i.stack[i.stackIndex].isEmpty})}emitIdle(i){__classPrivateFieldGet(this,b,"m",G).call(this,n.IDLE,i)}emitError(i){__classPrivateFieldGet(this,b,"m",G).call(this,n.ERROR,i)}emitNotif(i,s){__classPrivateFieldGet(this,b,"m",G).call(this,n.NOTIF,{message:i,timeout:s})}emitClear(){__classPrivateFieldGet(this,b,"m",G).call(this,n.CLEAR)}emitCleared(i){__classPrivateFieldGet(this,b,"m",G).call(this,n.CLEARED,i)}emitConvert(){__classPrivateFieldGet(this,b,"m",G).call(this,n.CONVERT,i)}emitConverted(i){__classPrivateFieldGet(this,b,"m",G).call(this,n.CONVERTED,i)}emitImport(i,s){__classPrivateFieldGet(this,b,"m",G).call(this,n.IMPORT,{jiix:i,mimeType:s})}emitImported(i){__classPrivateFieldGet(this,b,"m",G).call(this,n.IMPORTED,i)}}E=GlobalEvent,b=new WeakSet,G=function _GlobalEvent_emit(i,s){this.dispatchEvent(new CustomEvent(i,Object.assign({bubbles:!0,composed:!0},s?{detail:s}:void 0)))},C={value:void 0};class UndoRedoContext{constructor(i){this.stackIndex=0,this.stack=[i.getClone()],this.canRedo=!1,this.canUndo=!1}}class UndoRedoManager{constructor(i,s){this.configuration=i,this.context=new UndoRedoContext(s)}get globalEvent(){return GlobalEvent.getInstance()}updateCanUndoRedo(){this.context.canRedo=this.context.stack.length-1>this.context.stackIndex,this.context.canUndo=this.context.stackIndex>0}getLastModel(){return this.context.stack[this.context.stack.length-1]}getModelFromModificationDate(i){return this.context.stack.find((s=>s.modificationDate===i))}addModelToStack(i){this.context.stackIndex+1<this.context.stack.length&&this.context.stack.splice(this.context.stackIndex+1),this.context.stackIndex++,this.context.stack.push(i.getClone()),this.context.stack.length>this.configuration.maxStackSize&&(this.context.stack.shift(),this.context.stackIndex--),this.updateCanUndoRedo(),this.globalEvent.emitChange(this.context)}updateModelInStack(i){const s=this.context.stack.findIndex((s=>s.modificationDate===i.modificationDate));s>-1&&(this.context.stack.splice(s,1,i.getClone()),this.globalEvent.emitChange(this.context))}undo(){return this.context.canUndo&&(this.context.stackIndex--,this.updateCanUndoRedo(),this.globalEvent.emitChange(this.context)),this.context.stack[this.context.stackIndex].getClone()}redo(){return this.context.canRedo&&(this.context.stackIndex++,this.updateCanUndoRedo(),this.globalEvent.emitChange(this.context)),this.context.stack[this.context.stackIndex].getClone()}reset(i){this.context=new UndoRedoContext(i),this.globalEvent.emitChange(this.context)}}class RestBehaviors{constructor(i,s){M.add(this),k.set(this,void 0),T.set(this,void 0),L.set(this,void 0),this.grabber=new PointerEventGrabber(i.grabber),this.renderer=new CanvasRenderer(i.rendering),this.recognizer=new RestRecognizer(i.server,i.recognition),this.undoRedoManager=new UndoRedoManager(i["undo-redo"],s.getClone()),__classPrivateFieldSet(this,k,i.triggers,"f"),this.initialized=new DeferredPromise}get globalEvent(){return GlobalEvent.getInstance()}init(i){return __awaiter(this,void 0,void 0,(function*(){return this.grabber.attach(i),this.renderer.init(i),this.initialized.resolve(),this.initialized.promise}))}drawCurrentStroke(i){this.renderer.drawPendingStroke(i.currentStroke)}updateModelRendering(i){return __awaiter(this,void 0,void 0,(function*(){return this.renderer.drawModel(i),this.export(i)}))}export(i,s){return __awaiter(this,void 0,void 0,(function*(){const n=new DeferredPromise;if(this.undoRedoManager.addModelToStack(i),"DEMAND"!==__classPrivateFieldGet(this,k,"f").exportContent){clearTimeout(__classPrivateFieldGet(this,L,"f"));let a=i.getClone();__classPrivateFieldSet(this,L,setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){try{a=yield __classPrivateFieldGet(this,M,"m",A).call(this,a,s),this.undoRedoManager.updateModelInStack(a),i.modificationDate===a.modificationDate&&(i.exports=a.exports),n.resolve(i)}catch(i){n.reject(i)}}))),__classPrivateFieldGet(this,k,"f").exportContentDelay),"f")}else n.resolve(i);return n.promise}))}convert(i,s,n){return __awaiter(this,void 0,void 0,(function*(){return this.recognizer.convert(i,s,n)}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){if(this.renderer.resize(i),i.strokeGroups.length){const s=new DeferredPromise;return clearTimeout(__classPrivateFieldGet(this,T,"f")),__classPrivateFieldSet(this,T,setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){const n=yield this.recognizer.resize(i);s.resolve(n)}))),__classPrivateFieldGet(this,k,"f").resizeTriggerDelay),"f"),s.promise}return Promise.resolve(i)}))}undo(){return __awaiter(this,void 0,void 0,(function*(){const i=this.undoRedoManager.undo();this.renderer.drawModel(i);const s=yield __classPrivateFieldGet(this,M,"m",A).call(this,i);return this.undoRedoManager.updateModelInStack(s),s}))}redo(){return __awaiter(this,void 0,void 0,(function*(){const i=this.undoRedoManager.redo();this.renderer.drawModel(i);const s=yield __classPrivateFieldGet(this,M,"m",A).call(this,i);return this.undoRedoManager.updateModelInStack(s),s}))}clear(i){return __awaiter(this,void 0,void 0,(function*(){const s=i.getClone();return s.clear(),this.undoRedoManager.addModelToStack(s),this.renderer.drawModel(s),s.modificationDate=(new Date).getTime(),this.globalEvent.emitCleared(s),this.globalEvent.emitExported(s.exports),s}))}destroy(i){return __awaiter(this,void 0,void 0,(function*(){return this.grabber.detach(),this.renderer.destroy(),this.undoRedoManager.reset(i),this.globalEvent.emitCleared(i),this.globalEvent.emitExported(i.exports),Promise.resolve()}))}}k=new WeakMap,T=new WeakMap,L=new WeakMap,M=new WeakSet,A=function _RestBehaviors__export(i,s){return __awaiter(this,void 0,void 0,(function*(){const n=yield this.recognizer.export(i,s);return this.globalEvent.emitExported(null==n?void 0:n.exports),n}))};class WSEvent extends EventTarget{constructor(){super(),I.set(this,void 0),__classPrivateFieldSet(this,I,new AbortController,"f")}emit(i,s){this.dispatchEvent(new CustomEvent(i,Object.assign({bubbles:!0,composed:!0},s?{detail:s}:void 0)))}emitInitialized(){this.emit(p)}emitConnected(){this.emit(u)}emitConnectionActive(){this.emit(v)}addConnectionActiveListener(i){this.addEventListener(v,(()=>i()),{signal:__classPrivateFieldGet(this,I,"f").signal})}emitDisconnected(i){this.emit(g,i)}addDisconnectedListener(i){this.addEventListener(g,(s=>i(s.detail)),{signal:__classPrivateFieldGet(this,I,"f").signal})}emitPartChange(i){this.emit(a,i)}addPartChangeListener(i){this.addEventListener(a,(s=>i(s.detail)),{signal:__classPrivateFieldGet(this,I,"f").signal})}emitContentChange(i){this.emit(l,i)}addContentChangeListener(i){this.addEventListener(l,(s=>i(s.detail)),{signal:__classPrivateFieldGet(this,I,"f").signal})}emitSVGPatch(i){this.emit(d,i)}addSVGPatchListener(i){this.addEventListener(d,(s=>i(s.detail)),{signal:__classPrivateFieldGet(this,I,"f").signal})}emitExported(i){this.emit(c,i)}addExportListener(i){this.addEventListener(c,(s=>i(s.detail)),{signal:__classPrivateFieldGet(this,I,"f").signal})}emitError(i){this.emit(h,i)}addErrorListener(i){this.addEventListener(h,(s=>i(s.detail)),{signal:__classPrivateFieldGet(this,I,"f").signal})}clearListeners(){__classPrivateFieldGet(this,I,"f").abort()}}I=new WeakMap;class WSRecognizer extends AbstractRecognizer{constructor(i,s){super(i,s),this.pingCount=0,this.reconnectionCount=0,D.set(this,void 0),this.wsEvent=new WSEvent}get url(){return`${"https"===this.serverConfiguration.scheme?"wss":"ws"}://${this.serverConfiguration.host}/api/v4.0/iink/document`}get mimeTypes(){switch(this.recognitionConfiguration.type.toLocaleLowerCase()){case"text":return this.recognitionConfiguration.text.mimeTypes;case"math":return this.recognitionConfiguration.math.mimeTypes;case"diagram":return this.recognitionConfiguration.diagram.mimeTypes;default:return[]}}infinitePing(){this.pingCount++,this.serverConfiguration.websocket.maxPingLostCount<this.pingCount?this.close(1e3,"PING_LOST"):this.socket.readyState<=1&&setTimeout((()=>{this.socket.readyState<=1&&(this.socket.send(JSON.stringify({type:"ping"})),this.infinitePing())}),this.serverConfiguration.websocket.pingDelay)}openCallback(){this.wsEvent.emitConnected();const i={type:this.sessionId?"restoreIInkSession":"newContentPackage",iinkSessionId:this.sessionId,applicationKey:this.serverConfiguration.applicationKey,xDpi:96,yDpi:96,viewSizeHeight:this.viewSizeHeight,viewSizeWidth:this.viewSizeWidth};this.send(i)}closeCallback(i){let n="";if(!this.currentErrorCode){switch(i.code){case 1e3:break;case 1001:n=s.GOING_AWAY;break;case 1002:n=s.PROTOCOL_ERROR;break;case 1003:n=s.UNSUPPORTED_DATA;break;case 1006:n=s.ABNORMAL_CLOSURE;break;case 1007:n=s.INVALID_FRAME_PAULOAD;break;case 1008:n=s.POLICY_VIOLATION;break;case 1009:n=s.MESSAGE_TOO_BIG;break;case 1011:n=s.INTERNAL_ERROR;break;case 1012:n=s.SERVICE_RESTART;break;case 1013:n=s.TRY_AGAIN;break;case 1014:n=s.BAD_GATEWAY;break;case 1015:n=s.TLS_HANDSHAKE;break;default:n=s.CANT_ESTABLISH}n&&this.wsEvent.emitError(new Error(n))}this.wsEvent.emitDisconnected(i)}manageHMACChallengeMessage(i){const s=i;s.hmacChallenge&&this.send({type:"hmac",hmac:computeHmac(s.hmacChallenge,this.serverConfiguration.applicationKey,this.serverConfiguration.hmacKey)}),s.iinkSessionId&&(this.sessionId=s.iinkSessionId)}manageContentPackageDescriptionMessage(){this.reconnectionCount=0,this.send(Object.assign(Object.assign({},this.recognitionConfiguration),{type:"configuration"})),this.currentPartId?this.send({type:"openContentPart",id:this.currentPartId,mimeTypes:this.mimeTypes}):this.send({type:"newContentPart",contentType:this.recognitionConfiguration.type,mimeTypes:this.mimeTypes})}managePartChangeMessage(i){const s=i;this.currentPartId=s.partId,this.wsEvent.emitPartChange(s)}manageContentChangeMessage(i){const s=i;this.wsEvent.emitContentChange(s)}manageExportMessage(i){const s=i;this.wsEvent.emitExported(s)}manageSVGPatchMessage(i){const s=i;this.wsEvent.emitSVGPatch(s)}manageErrorMessage(i){var n,a;const l=i;this.currentErrorCode=(null===(n=l.data)||void 0===n?void 0:n.code)||l.code;let d=(null===(a=l.data)||void 0===a?void 0:a.message)||l.message||s.UNKNOW;"access.not.granted"===this.currentErrorCode&&(d=s.WRONG_CREDENTIALS),this.wsEvent.emitError(new Error(d))}messageCallback(i){var s;this.currentErrorCode=void 0;const n=JSON.parse(i.data);if("pong"!==n.type)switch(this.pingCount=0,n.type){case"ack":this.manageHMACChallengeMessage(n);break;case"contentPackageDescription":this.manageContentPackageDescriptionMessage();break;case"partChanged":this.managePartChangeMessage(n);break;case"newPart":this.wsEvent.emitConnectionActive();break;case"contentChanged":this.manageContentChangeMessage(n);break;case"exported":this.manageExportMessage(n);break;case"svgPatch":this.manageSVGPatchMessage(n);break;case"error":this.manageErrorMessage(n);break;case"fileChunkAck":null===(s=__classPrivateFieldGet(this,D,"f"))||void 0===s||s.resolve(n)}}init(i,n){try{this.viewSizeHeight=i,this.viewSizeWidth=n,this.socket=new WebSocket(this.url),this.serverConfiguration.websocket.pingEnabled&&this.infinitePing(),this.socket.onopen=()=>this.openCallback(),this.socket.onclose=i=>this.closeCallback(i),this.socket.onmessage=i=>this.messageCallback(i),this.wsEvent.emitInitialized()}catch(i){new Error(s.CANT_ESTABLISH).name=i.code||"CANT_ESTABLISH",this.wsEvent.emitError(i)}}canReconnect(){return this.serverConfiguration.websocket.autoReconnect&&this.reconnectionCount<=this.serverConfiguration.websocket.maxRetryCount&&(!this.currentErrorCode||!["api.invalid.format","access.not.granted"].includes(this.currentErrorCode.toString()))}addStrokes(i){const s=i.extractPendingStrokes();0!==s.length&&this.send({type:"addStrokes",strokes:s.map((i=>({pointerType:i.pointerType,pointerId:i.pointerId,x:i.x,y:i.y,t:i.t,p:i.p})))})}send(i){if(this.socket.readyState!==this.socket.OPEN)throw this.socket.removeEventListener("close",this.closeCallback),this.socket.removeEventListener("message",this.messageCallback),this.socket.removeEventListener("open",this.openCallback),new Error(g);this.socket.send(JSON.stringify(i))}close(i,s){this.socket.readyState!==this.socket.OPEN&&this.socket.readyState!==this.socket.CONNECTING||this.socket.close(i,s)}setPenStyle(i){const s={type:"setPenStyle",style:se.penStyleToCSS(i)};this.send(s)}setPenStyleClasses(i){const s={type:"setPenStyleClasses",styleClasses:i};this.send(s)}setTheme(i){const s={type:"setTheme",theme:se.themeToCSS(i)};this.send(s)}export(i,s){return __awaiter(this,void 0,void 0,(function*(){let n=s||[];if(!n.length)switch(this.recognitionConfiguration.type){case"DIAGRAM":n=this.recognitionConfiguration.diagram.mimeTypes;break;case"MATH":n=this.recognitionConfiguration.math.mimeTypes;break;case"Raw Content":n=["application/vnd.myscript.jiix"];break;case"TEXT":n=this.recognitionConfiguration.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.recognitionConfiguration.type}" is unknown.\n Possible types are:\n -DIAGRAM\n -MATH\n -Raw Content\n -TEXT`)}if(!n.length)return Promise.reject(new Error("Export failed, no mimeTypes define in recognition configuration"));const a={type:"export",partId:this.currentPartId,mimeTypes:n};return this.send(a),i}))}import(i,s){return __awaiter(this,void 0,void 0,(function*(){const n=this.serverConfiguration.websocket.fileChunkSize,a=Math.random().toString(10).substring(2,6);__classPrivateFieldSet(this,D,new DeferredPromise,"f");const readBlob=i=>{const s=new FileReader;return new Promise(((n,a)=>{s.onloadend=i=>{var s;return n(null===(s=i.target)||void 0===s?void 0:s.result)},s.onerror=()=>a(),s.readAsText(i)}))},l={type:"importFile",importFileId:a,mimeType:s};this.send(l);for(let s=0;s<i.size;s+=n){const l=i.slice(s,n,i.type),d={type:"fileChunk",importFileId:a,data:yield readBlob(l),lastChunk:s+n>i.size};this.send(d)}return __classPrivateFieldGet(this,D,"f").promise}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){this.viewSizeHeight=i.height,this.viewSizeWidth=i.width;const s={type:"changeViewSize",height:this.viewSizeHeight,width:this.viewSizeWidth};return this.send(s),Promise.resolve(i)}))}convert(i){const s={type:"convert",conversionState:i};this.send(s)}undo(){this.send({type:"undo"})}redo(){this.send({type:"redo"})}clear(){this.send({type:"clear"})}}D=new WeakMap;class SVGQuadraticStroker{getArcPath(i,s){return[`M ${i.x},${i.y}`,`m ${-s},0`,`a ${s},${s} 0 1 0 ${2*s},0`,`a ${s},${s} 0 1 0 ${-2*s},0`].join(" ")}getLinePath(i,s,n){const a=computeLinksPoints(i,computeAxeAngle(i,s),n),l=computeLinksPoints(s,computeAxeAngle(i,s),n);return[`M ${a[0].x},${a[0].y}`,`L ${l[0].x},${l[0].y}`,`L ${l[1].x},${l[1].y}`,`L ${a[1].x},${a[1].y}`].join(" ")}getFinalPath(i,s,n){const a=computeAxeAngle(i,s),l=computeLinksPoints(s,a,n),d=[`M ${l[0].x},${l[0].y}`];for(let i=1;i<=6;i++){const l=a-i*(Math.PI/6);d.push(`L ${s.x-s.p*n*Math.sin(l)},${s.y+s.p*n*Math.cos(l)}`)}return d.join(" ")}getQuadraticPath(i,s,n,a){const l=computeLinksPoints(i,computeAxeAngle(i,n),a),d=computeLinksPoints(s,computeAxeAngle(n,s),a),c=computeLinksPoints(n,computeAxeAngle(i,s),a);return[`M ${l[0].x},${l[0].y}`,`Q ${c[0].x},${c[0].y} ${d[0].x},${d[0].y}`,`L ${d[1].x},${d[1].y}`,`Q ${c[1].x},${c[1].y} ${l[1].x},${l[1].y}`].join(" ")}getPointByIndex(i,s){return{x:i.x[s]||0,y:i.y[s]||0,t:i.t[s]||0,p:i.p[s]||0}}buildSVGPath(i){const s=i.x.length,n=i.width,a=s-2,l=this.getPointByIndex(i,0),d=[];if(s<3)d.push(this.getArcPath(l,.6*n));else{d.push(this.getArcPath(l,n*l.p)),d.push(this.getLinePath(l,computeMiddlePoint(l,this.getPointByIndex(i,1)),n));for(let s=0;s<a;s++){const a=computeMiddlePoint(this.getPointByIndex(i,s),this.getPointByIndex(i,s+1)),l=computeMiddlePoint(this.getPointByIndex(i,s+1),this.getPointByIndex(i,s+2)),c=this.getPointByIndex(i,s+1);d.push(this.getQuadraticPath(a,l,c,n))}const c=this.getPointByIndex(i,s-2),h=this.getPointByIndex(i,s-1);d.push(this.getLinePath(computeMiddlePoint(c,h),h,n)),d.push(this.getFinalPath(c,h,n))}return d.join(" ")}drawStroke(i,s){const n=this.buildSVGPath(s),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.classList.add("pending-stroke"),a.setAttribute("id",s.id),a.setAttribute("color",s.color);const l=`fill:${s.color};stroke:transparent;`;a.setAttribute("style",l),a.setAttribute("d",`${n}Z`),i.appendChild(a)}drawErasingStroke(i,s){s.width=20;const n=this.buildSVGPath(s),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.classList.add("erasing-stroke"),a.setAttribute("id",s.id);a.setAttribute("style","fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;"),a.setAttribute("d",`${n}Z`),i.appendChild(a)}}class SVGRenderer{constructor(i){R.add(this),this.config=i,this.stroker=new SVGQuadraticStroker}init(i){i.style.fontSize="10px",this.context={parent:i}}updateLayer(i,s){switch(s.type){case"REPLACE_ALL":__classPrivateFieldGet(this,R,"m",W).call(this,i,s);break;case"REPLACE_ELEMENT":__classPrivateFieldGet(this,R,"m",O).call(this,s);break;case"APPEND_CHILD":__classPrivateFieldGet(this,R,"m",z).call(this,i,s);break;case"REMOVE_ELEMENT":__classPrivateFieldGet(this,R,"m",H).call(this,s);break;case"REMOVE_CHILD":__classPrivateFieldGet(this,R,"m",j).call(this,s);break;case"INSERT_BEFORE":__classPrivateFieldGet(this,R,"m",B).call(this,s);break;case"SET_ATTRIBUTE":__classPrivateFieldGet(this,R,"m",X).call(this,s);break;case"REMOVE_ATTRIBUTE":__classPrivateFieldGet(this,R,"m",$).call(this,s)}}updatesLayer(i,s){s.forEach((s=>this.updateLayer(i,s)))}clearPendingStroke(){const i=this.context.parent.querySelector("#pendingStrokes");i&&(i.innerHTML="")}drawPendingStroke(i){if(i){const s=this.context.parent.querySelector("#pendingStrokes");if(s){const n=s.querySelector(`#${null==i?void 0:i.id}`);n&&n.remove(),__classPrivateFieldGet(this,R,"m",N).call(this,s,i)}}}resize(i){const s=this.context.parent.getBoundingClientRect(),n=this.context.parent.querySelectorAll("svg"),a=Math.max(s.width,i.width),l=Math.max(s.height,i.height);n.forEach((i=>{i.setAttribute("viewBox",`0 0 ${a}, ${l}`),i.setAttribute("width",`${a}px`),i.setAttribute("height",`${l}px`)}))}destroy(){this.context.parent&&(this.context.parent.innerHTML="")}}R=new WeakSet,N=function _SVGRenderer_drawStroke(i,s){"ERASER"===s.pointerType?this.stroker.drawErasingStroke(i,s):this.stroker.drawStroke(i,s)},W=function _SVGRenderer_replaceAll(i,s){const n=this.context.parent.querySelector(`svg[data-layer="${i}"]`);null==n||n.remove(),this.context.parent.insertAdjacentHTML("beforeend",s.svg);const a=this.context.parent.querySelector(`svg[data-layer="${i}"]`);if("MODEL"===i){const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.id="pendingStrokes",a.appendChild(i)}},O=function _SVGRenderer_replaceElement(i){const s=this.context.parent.querySelector(`#${i.id}`);if(s){const n=s.parentNode;null==s||s.remove(),null==n||n.insertAdjacentHTML("beforeend",i.svg)}},z=function _SVGRenderer_appendChild(i,s){const n=s.parentId?`#${s.parentId}`:`svg[data-layer="${i}"]`,a=this.context.parent.querySelector(n);null==a||a.insertAdjacentHTML("beforeend",s.svg)},j=function _SVGRenderer_removeChild(i){var s;null===(s=this.context.parent.querySelector(`#${i.parentId} > *:nth-child(${i.index+1})`))||void 0===s||s.remove()},H=function _SVGRenderer_removeElement(i){const s=this.context.parent.querySelector(`#${i.id}`);s&&(i.id.includes("s")||i.id.includes("MODEL")?s.remove():(s.setAttribute("class","removed-stroke"),setTimeout((()=>{null==s||s.remove()}),100)))},B=function _SVGRenderer_insertBefore(i){const s=this.context.parent.querySelector(`#${i.refId}`);null==s||s.insertAdjacentHTML("beforebegin",i.svg)},X=function _SVGRenderer_setAttribute(i){const s=i.id?`#${i.id}`:"svg",n=this.context.parent.querySelector(s);null==n||n.setAttribute(i.name,i.value)},$=function _SVGRenderer_removeAttribute(i){const s=i.id?`#${i.id}`:"svg",n=this.context.parent.querySelector(s);null==n||n.removeAttribute(i.name)};class WSBehaviors{constructor(i,s){U.set(this,void 0),J.set(this,void 0),V.set(this,void 0),Y.set(this,void 0),Z.set(this,void 0),K.set(this,void 0),q.set(this,void 0),Q.set(this,void 0),ee.set(this,void 0),te.set(this,void 0),ie.set(this,void 0),this.onConnectionActive=()=>{this.initialized.resolve()},this.onContentChange=()=>{var i,s,n,a;null===(i=__classPrivateFieldGet(this,Q,"f"))||void 0===i||i.resolve(),null===(s=__classPrivateFieldGet(this,ee,"f"))||void 0===s||s.resolve(),null===(n=__classPrivateFieldGet(this,te,"f"))||void 0===n||n.resolve(),null===(a=__classPrivateFieldGet(this,ie,"f"))||void 0===a||a.resolve()},this.onSVGPatch=i=>{this.renderer.updatesLayer(i.layer,i.updates)},this.onError=i=>{this.initialized.isPending&&this.initialized.reject(i),this.globalEvent.emitError(i)},this.onExport=i=>{var s,n,a,l;null===(s=__classPrivateFieldGet(this,q,"f"))||void 0===s||s.resolve(i.exports),null===(n=__classPrivateFieldGet(this,K,"f"))||void 0===n||n.resolve(i.exports),null===(a=__classPrivateFieldGet(this,Y,"f"))||void 0===a||a.resolve(i.exports),null===(l=__classPrivateFieldGet(this,Z,"f"))||void 0===l||l.resolve(i.exports),clearTimeout(__classPrivateFieldGet(this,J,"f")),__classPrivateFieldSet(this,J,setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){this.globalEvent.emitExported(i.exports)}))),__classPrivateFieldGet(this,U,"f").exportContentDelay),"f")},this.onDisconnected=i=>{var s,n,a,l,d,c,h,p,u,v,g,m,_,f,y,P;const w=new Error(i.reason);w.name=i.code.toString(),this.initialized.isPending&&(1e3===i.code?this.initialized.resolve():this.initialized.reject(w)),(null===(s=__classPrivateFieldGet(this,K,"f"))||void 0===s?void 0:s.isPending)&&(null===(n=__classPrivateFieldGet(this,K,"f"))||void 0===n||n.reject(w)),(null===(a=__classPrivateFieldGet(this,Y,"f"))||void 0===a?void 0:a.isPending)&&(null===(l=__classPrivateFieldGet(this,Y,"f"))||void 0===l||l.reject(w)),(null===(d=__classPrivateFieldGet(this,Z,"f"))||void 0===d?void 0:d.isPending)&&(null===(c=__classPrivateFieldGet(this,Z,"f"))||void 0===c||c.reject(w)),(null===(h=__classPrivateFieldGet(this,q,"f"))||void 0===h?void 0:h.isPending)&&(null===(p=__classPrivateFieldGet(this,q,"f"))||void 0===p||p.reject(w)),(null===(u=__classPrivateFieldGet(this,Q,"f"))||void 0===u?void 0:u.isPending)&&(null===(v=__classPrivateFieldGet(this,Q,"f"))||void 0===v||v.reject(w)),(null===(g=__classPrivateFieldGet(this,ee,"f"))||void 0===g?void 0:g.isPending)&&(null===(m=__classPrivateFieldGet(this,ee,"f"))||void 0===m||m.reject(w)),(null===(_=__classPrivateFieldGet(this,te,"f"))||void 0===_?void 0:_.isPending)&&(null===(f=__classPrivateFieldGet(this,te,"f"))||void 0===f||f.reject(w)),(null===(y=__classPrivateFieldGet(this,ie,"f"))||void 0===y?void 0:y.isPending)&&(null===(P=__classPrivateFieldGet(this,ie,"f"))||void 0===P||P.reject(w))},this.grabber=new PointerEventGrabber(i.grabber),this.renderer=new SVGRenderer(i.rendering),this.recognizer=new WSRecognizer(i.server,i.recognition),this.undoRedoManager=new UndoRedoManager(i["undo-redo"],s.getClone()),__classPrivateFieldSet(this,U,i.triggers,"f"),this.initialized=new DeferredPromise}get globalEvent(){return GlobalEvent.getInstance()}init(i){const s=this.undoRedoManager.getLastModel();return this.grabber.attach(i),this.renderer.init(i),this.recognizer.init(s.height,s.width),this.recognizer.wsEvent.addConnectionActiveListener(this.onConnectionActive),this.recognizer.wsEvent.addContentChangeListener(this.onContentChange),this.recognizer.wsEvent.addSVGPatchListener(this.onSVGPatch),this.recognizer.wsEvent.addExportListener(this.onExport),this.recognizer.wsEvent.addDisconnectedListener(this.onDisconnected),this.recognizer.wsEvent.addErrorListener(this.onError),this.initialized.promise}setPenStyle(i){this.recognizer.setPenStyle(i)}setPenStyleClasses(i){this.recognizer.setPenStyleClasses(i)}setTheme(i){this.recognizer.setTheme(i)}drawCurrentStroke(i){const s=i.currentStroke;s&&(s.id=`pendingStroke-${i.rawStrokes.length}`,this.renderer.drawPendingStroke(s))}updateModelRendering(i){return __awaiter(this,void 0,void 0,(function*(){yield this.initialized.promise,i.updatePositionSent(),this.undoRedoManager.addModelToStack(i),__classPrivateFieldSet(this,K,new DeferredPromise,"f"),this.recognizer.addStrokes(i);const s=yield __classPrivateFieldGet(this,K,"f").promise;return i.updatePositionReceived(),i.exports?Object.assign(i.exports,s):i.exports=s,this.undoRedoManager.updateModelInStack(i),this.renderer.clearPendingStroke(),__classPrivateFieldSet(this,K,void 0,"f"),i}))}export(i,s){return __awaiter(this,void 0,void 0,(function*(){yield this.initialized.promise,this.undoRedoManager.addModelToStack(i),__classPrivateFieldSet(this,Y,new DeferredPromise,"f"),yield this.recognizer.export(i,s);const n=yield __classPrivateFieldGet(this,Y,"f").promise;return i.updatePositionReceived(),i.exports?Object.assign(i.exports,n):i.exports=n,this.undoRedoManager.updateModelInStack(i),__classPrivateFieldSet(this,Y,void 0,"f"),i}))}convert(i,s){return __awaiter(this,void 0,void 0,(function*(){yield this.initialized.promise,this.undoRedoManager.addModelToStack(i),__classPrivateFieldSet(this,Z,new DeferredPromise,"f"),this.recognizer.convert(s);const n=yield __classPrivateFieldGet(this,Z,"f").promise;return i.updatePositionReceived(),i.converts?Object.assign(i.converts,n):i.converts=n,this.undoRedoManager.updateModelInStack(i),__classPrivateFieldSet(this,Z,void 0,"f"),i}))}import(i,s,n){return __awaiter(this,void 0,void 0,(function*(){yield this.initialized.promise,this.undoRedoManager.addModelToStack(i),__classPrivateFieldSet(this,q,new DeferredPromise,"f"),this.recognizer.import(s,n);const a=yield __classPrivateFieldGet(this,q,"f").promise;return i.updatePositionReceived(),i.exports?Object.assign(i.exports,a):i.exports=a,this.undoRedoManager.updateModelInStack(i),__classPrivateFieldSet(this,q,void 0,"f"),i}))}resize(i){return __awaiter(this,void 0,void 0,(function*(){return yield this.initialized.promise,this.renderer.resize(i),__classPrivateFieldSet(this,Q,new DeferredPromise,"f"),clearTimeout(__classPrivateFieldGet(this,V,"f")),__classPrivateFieldSet(this,V,setTimeout((()=>__awaiter(this,void 0,void 0,(function*(){this.recognizer.resize(i)}))),__classPrivateFieldGet(this,U,"f").resizeTriggerDelay),"f"),yield __classPrivateFieldGet(this,Q,"f").promise,__classPrivateFieldSet(this,Q,void 0,"f"),i}))}undo(){return __awaiter(this,void 0,void 0,(function*(){return yield this.initialized.promise,__classPrivateFieldSet(this,ee,new DeferredPromise,"f"),this.recognizer.undo(),yield __classPrivateFieldGet(this,ee,"f").promise,__classPrivateFieldSet(this,ee,void 0,"f"),this.undoRedoManager.undo()}))}redo(){return __awaiter(this,void 0,void 0,(function*(){return yield this.initialized.promise,__classPrivateFieldSet(this,te,new DeferredPromise,"f"),this.recognizer.redo(),yield __classPrivateFieldGet(this,te,"f").promise,__classPrivateFieldSet(this,te,void 0,"f"),this.undoRedoManager.redo()}))}clear(i){var s;return __awaiter(this,void 0,void 0,(function*(){yield this.initialized.promise,__classPrivateFieldSet(this,ie,new DeferredPromise,"f"),this.recognizer.clear();const n=i.getClone();return n.clear(),this.undoRedoManager.addModelToStack(n),yield null===(s=__classPrivateFieldGet(this,ie,"f"))||void 0===s?void 0:s.promise,__classPrivateFieldSet(this,ie,void 0,"f"),n}))}destroy(){return __awaiter(this,void 0,void 0,(function*(){return this.grabber.detach(),this.renderer.destroy(),this.recognizer.close(1e3,m),Promise.resolve()}))}}U=new WeakMap,J=new WeakMap,V=new WeakMap,Y=new WeakMap,Z=new WeakMap,K=new WeakMap,q=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap,ie=new WeakMap;class BehaviorsManager{constructor(i,s,n){this.overrideDefaultBehaviors(i,s,n)}overrideDefaultBehaviors(i,s,n){let a;this.behaviors&&this.behaviors.destroy(s),a="REST"===i.server.protocol?new RestBehaviors(i,s):new WSBehaviors(i,s),this.behaviors=Object.assign(a,n)}init(i){return this.behaviors.init(i)}}const ae={protocol:"WEBSOCKET",scheme:"https",host:"webdemoapi.myscript.com",applicationKey:"",hmacKey:"",useWindowLocation:!1,websocket:{pingEnabled:!0,pingDelay:3e4,maxPingLostCount:10,autoReconnect:!0,maxRetryCount:2,fileChunkSize:3e5}},le={type:"TEXT",alwaysConnected:!0,lang:"en_US",gesture:{enable:!0},export:{"image-resolution":300,jiix:{"bounding-box":!1,strokes:!1,text:{chars:!1,words:!0}}},renderer:{debug:{"draw-text-boxes":!1,"draw-image-boxes":!1}},math:{mimeTypes:["application/x-latex"],solver:{enable:!0,"fractional-part-digits":3,"decimal-separator":".","rounding-mode":"half up","angle-unit":"deg"},margin:{bottom:10,left:15,right:15,top:10},eraser:{"erase-precisely":!1},"undo-redo":{mode:"stroke"}},text:{guides:{enable:!0},mimeTypes:["application/vnd.myscript.jiix"],margin:{top:20,left:10,right:10,bottom:10},eraser:{"erase-precisely":!1}},diagram:{mimeTypes:["application/vnd.myscript.jiix"],eraser:{"erase-precisely":!1}},"raw-content":{recognition:{text:!0,shape:!1},eraser:{"erase-precisely":!1}}},de={listenerOptions:{capture:!1,passive:!0},xyFloatPrecision:0,timestampFloatPrecision:0},ce={minHeight:100,minWidth:100,smartGuide:{enable:!0,fadeOut:{enable:!0,duration:5e3}}},he={exportContent:"POINTER_UP",exportContentDelay:1e3,resizeTriggerDelay:100},pe={processDelay:10},ue={maxStackSize:10},ve={server:ae,recognition:le,grabber:de,rendering:ce,triggers:he,events:pe,"undo-redo":ue};class Configuration{constructor(i){this.events=JSON.parse(JSON.stringify(ve.events)),this.grabber=JSON.parse(JSON.stringify(ve.grabber)),this.recognition=JSON.parse(JSON.stringify(ve.recognition)),this.rendering=JSON.parse(JSON.stringify(ve.rendering)),this.server=JSON.parse(JSON.stringify(ve.server)),this.triggers=JSON.parse(JSON.stringify(ve.triggers)),this.overrideDefaultConfiguration(i)}mergeDeep(i,...s){const isObject=i=>i&&"object"==typeof i&&!Array.isArray(i);if(!s.length)return i;const n=s.shift();if(isObject(i)&&isObject(n))for(const s in n)isObject(n[s])?(i[s]||Object.assign(i,{[s]:{}}),this.mergeDeep(i[s],n[s])):Object.assign(i,{[s]:n[s]});return this.mergeDeep(i,...s)}overrideDefaultConfiguration(i){var s,n,a,l,d,c,h;const p=JSON.parse(JSON.stringify(ve));this.events=this.mergeDeep({},p.events,null==i?void 0:i.events),this.grabber=this.mergeDeep({},p.grabber,null==i?void 0:i.grabber),this.recognition=this.mergeDeep({},p.recognition,null==i?void 0:i.recognition),this.rendering=this.mergeDeep({},p.rendering,null==i?void 0:i.rendering),this.server=this.mergeDeep({},p.server,null==i?void 0:i.server),this.triggers=this.mergeDeep({},p.triggers,null==i?void 0:i.triggers),this["undo-redo"]=this.mergeDeep({},p["undo-redo"],null==i?void 0:i["undo-redo"]),this.recognition.text.mimeTypes=(null===(n=null===(s=null==i?void 0:i.recognition)||void 0===s?void 0:s.text)||void 0===n?void 0:n.mimeTypes)||p.recognition.text.mimeTypes,this.recognition.math.mimeTypes=(null===(l=null===(a=null==i?void 0:i.recognition)||void 0===a?void 0:a.math)||void 0===l?void 0:l.mimeTypes)||p.recognition.math.mimeTypes,this.recognition.diagram.mimeTypes=(null===(c=null===(d=null==i?void 0:i.recognition)||void 0===d?void 0:d.diagram)||void 0===c?void 0:c.mimeTypes)||p.recognition.diagram.mimeTypes,(null===(h=this.server)||void 0===h?void 0:h.useWindowLocation)&&(this.server.scheme=window.location.protocol.indexOf("s")>-1?"https":"http",this.server.host=window.location.host),"REST"===this.server.protocol&&"POINTER_UP"===this.triggers.exportContent&&(this.triggers.exportContent="QUIET_PERIOD",this.triggers.exportContentDelay=Math.max(this.triggers.exportContentDelay,50)),"WEBSOCKET"===this.server.protocol&&"TEXT"===this.recognition.type?this.rendering.smartGuide.enable&&!this.recognition.text.mimeTypes.includes("application/vnd.myscript.jiix")&&this.recognition.text.mimeTypes.push("application/vnd.myscript.jiix"):this.rendering.smartGuide.enable=!1}}class Stroke{constructor(i,s,n="pen"){this.type="stroke",this.pointerId=s,this.pointerType=n,this.x=[],this.y=[],this.t=[],this.p=[],this.l=[],this.color=i.color,this.width=i.width,this["-myscript-pen-width"]=i["-myscript-pen-width"],this["-myscript-pen-fill-style"]=i["-myscript-pen-fill-style"],this["-myscript-pen-fill-color"]=i["-myscript-pen-fill-color"]}}class Model{constructor(i,s,n=(new Date).getTime()){this.rawStrokes=[],this.strokeGroups=[],this.positions={lastSentPosition:-1,lastReceivedPosition:-1,lastRenderedPosition:-1},this.defaultSymbols=[],this.creationTime=n,this.modificationDate=n,this.width=i,this.height=s,this.idle=!0,this.isEmpty=!0}computeDistance(i,s){const n=Math.sqrt(Math.pow(i.y-s.y,2)+Math.pow(i.x-s.x,2));return isNaN(n)?0:n}computeLength(i,s,n){const a=n+this.computeDistance(i,s);return isNaN(a)?0:a}computePressure(i,s,n){let a=1;const l=this.computeDistance(i,s),d=this.computeLength(i,s,n);0===d?a=.5:l===d?a=1:l<10?a=.2+Math.pow(.1*l,.4):l>d-10&&(a=.2+Math.pow(.1*(d-l),.4));const c=a*Math.max(.1,1-.1*Math.sqrt(l));return isNaN(c)?.5:Math.round(100*c)/100}filterPointByAcquisitionDelta(i,s){const n=2+(i["-myscript-pen-width"]||0)/4;return 0===i.x.length||0===i.y.length||Math.abs(i.x[i.x.length-1]-s.x)>=n||Math.abs(i.y[i.y.length-1]-s.y)>=n}addPoint(i,s){if(this.filterPointByAcquisitionDelta(i,s)){const n={x:i.x[i.x.length-1],y:i.y[i.y.length-1],p:i.p[i.p.length-1],t:i.t[i.t.length-1]},a=i.l[i.l.length-1];i.x.push(s.x),i.y.push(s.y),i.t.push(s.t),i.p.push(this.computePressure(s,n,a)),i.l.push(this.computeLength(s,n,a))}}addStroke(i){this.rawStrokes.push(i)}extractPendingStrokes(i=this.positions.lastReceivedPosition+1){return this.rawStrokes.slice(i)}addStrokeToGroup(i,s){const n=this.strokeGroups.length-1;if(this.strokeGroups[n]&&(a=this.strokeGroups[n].penStyle,l=s,a["-myscript-pen-fill-color"]===l["-myscript-pen-fill-color"]&&a["-myscript-pen-fill-style"]===l["-myscript-pen-fill-style"]&&a["-myscript-pen-width"]===l["-myscript-pen-width"]&&a.color===l.color&&a.width===l.width))this.strokeGroups[n].strokes.push(i);else{const n={penStyle:s,strokes:[i]};this.strokeGroups.push(n)}var a,l;this.isEmpty=!1}initCurrentStroke(i,s,n,a,l=96){if(a["-myscript-pen-width"]){const i=a["-myscript-pen-width"]*l/25.4;a.width=i/2}this.modificationDate=(new Date).getTime(),this.exports=void 0,this.converts=void 0,this.currentStroke=new Stroke(a,s,n),this.addPoint(this.currentStroke,i)}appendToCurrentStroke(i){this.currentStroke&&this.addPoint(this.currentStroke,i)}endCurrentStroke(i,s){this.currentStroke&&(this.addPoint(this.currentStroke,i),this.addStroke(this.currentStroke),this.addStrokeToGroup(this.currentStroke,s),this.currentStroke=void 0)}extractPendingRecognizedSymbols(i=this.positions.lastRenderedPosition+1){return this.recognizedSymbols?this.recognizedSymbols.slice(i):[]}updatePositionSent(i=this.rawStrokes.length-1){this.positions.lastSentPosition=i}updatePositionReceived(){this.positions.lastReceivedPosition=this.positions.lastSentPosition}updatePositionRendered(i=(this.recognizedSymbols?this.recognizedSymbols.length-1:-1)){this.positions.lastRenderedPosition=i}resetPositionRenderer(){this.positions.lastRenderedPosition=-1}resetPositions(){this.positions.lastSentPosition=-1,this.positions.lastReceivedPosition=-1}getClone(){const i=new Model(this.width,this.height,this.creationTime);return i.modificationDate=JSON.parse(JSON.stringify(this.modificationDate)),i.defaultSymbols=JSON.parse(JSON.stringify(this.defaultSymbols)),i.currentStroke=this.currentStroke?JSON.parse(JSON.stringify(this.currentStroke)):void 0,i.rawStrokes=JSON.parse(JSON.stringify(this.rawStrokes)),i.strokeGroups=JSON.parse(JSON.stringify(this.strokeGroups)),i.positions=JSON.parse(JSON.stringify(this.positions)),i.exports=this.exports?JSON.parse(JSON.stringify(this.exports)):void 0,i.converts=this.converts?JSON.parse(JSON.stringify(this.converts)):void 0,i.recognizedSymbols=this.recognizedSymbols?JSON.parse(JSON.stringify(this.recognizedSymbols)):void 0,i.idle=this.idle,i.isEmpty=this.isEmpty,i}clear(){this.modificationDate=(new Date).getTime(),this.currentStroke=void 0,this.rawStrokes=[],this.strokeGroups=[],this.positions.lastSentPosition=-1,this.positions.lastReceivedPosition=-1,this.positions.lastRenderedPosition=-1,this.recognizedSymbols=void 0,this.exports=void 0,this.converts=void 0,this.idle=!0,this.isEmpty=!0}}const ge={},me={ink:{color:"#000000",width:1,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},".math":{"font-family":"STIXGeneral"},".math-solved":{"font-family":"STIXGeneral",color:"#A8A8A8FF"},".text":{"font-family":"MyScriptInter","font-size":10}};var _e,fe,ye,Pe,we,xe,Se,be,Ee,Fe,Ce,Ge,Me,ke,Te,Le,Ae,Ie,De,Re,Ne,We,Oe,ze,je,He,Be,Xe,$e,Ue,Je,Ve,Ye,Ze,Ke,qe,Qe,et,tt,it;class StyleManager{get penStyle(){return __classPrivateFieldGet(this,_e,"f")}get theme(){return __classPrivateFieldGet(this,fe,"f")}constructor(i,s){_e.set(this,void 0),fe.set(this,void 0),this.penStyleClasses="",this.overrideDefaultPenStyle(i),this.overrideDefaultTheme(s)}overrideDefaultPenStyle(i){__classPrivateFieldSet(this,_e,Object.assign({},ge,i||{}),"f")}overrideDefaultTheme(i){__classPrivateFieldSet(this,fe,Object.assign({},me,i||{}),"f")}}_e=new WeakMap,fe=new WeakMap;class SmartGuide{constructor(){ye.add(this),Pe.set(this,void 0),we.set(this,void 0),xe.set(this,void 0),Se.set(this,void 0),be.set(this,void 0),Ee.set(this,void 0),Fe.set(this,void 0),Ce.set(this,void 0),Ge.set(this,void 0),Me.set(this,void 0),ke.set(this,void 0),Te.set(this,void 0),$e.set(this,(i=>{var s,n,a,l,d;const c=parseInt(i.id.replace("word-","").replace(this.uuid,"")),h=null===(s=this.jiix)||void 0===s?void 0:s.words;if(this.wordToChange=h[c],this.wordToChange&&(this.wordToChange.id=c.toString(),__classPrivateFieldGet(this,Ee,"f").innerHTML="",null===(n=this.wordToChange)||void 0===n?void 0:n.candidates)){__classPrivateFieldGet(this,Ee,"f").style.display="flex",this.wordToChange.candidates.forEach(((i,s)=>{var n;(null===(n=this.wordToChange)||void 0===n?void 0:n.label)===i?__classPrivateFieldGet(this,Ee,"f").innerHTML+=`<span id="cdt-${s}${this.uuid}" class="selected-word">${i}</span>`:__classPrivateFieldGet(this,Ee,"f").innerHTML+=`<span id="cdt-${s}${this.uuid}">${i}</span>`}));const s=48,n=i.getBoundingClientRect().left-60;__classPrivateFieldGet(this,Ee,"f").style.top=`${s}px`,__classPrivateFieldGet(this,Ee,"f").style.left=`${n}px`;const c=null===(l=null===(a=i.parentNode)||void 0===a?void 0:a.parentNode)||void 0===l?void 0:l.parentNode;c&&c.insertBefore(__classPrivateFieldGet(this,Ee,"f"),null===(d=i.parentNode)||void 0===d?void 0:d.parentNode)}})),Ye.set(this,(i=>{i.preventDefault(),i.stopPropagation(),__classPrivateFieldGet(this,Te,"f")?__classPrivateFieldGet(this,ye,"m",Ve).call(this):__classPrivateFieldGet(this,ye,"m",Je).call(this),__classPrivateFieldGet(this,ye,"m",Ue).call(this)})),Ze.set(this,(i=>{i.preventDefault(),i.stopPropagation(),this.globalEvent.emitConvert(),__classPrivateFieldGet(this,ye,"m",Ve).call(this)})),Ke.set(this,(i=>__awaiter(this,void 0,void 0,(function*(){i.preventDefault(),i.stopPropagation();try{__classPrivateFieldGet(this,ye,"m",Ve).call(this);let i="Nothing to copy";__classPrivateFieldGet(this,xe,"f").innerText&&(i=`"${__classPrivateFieldGet(this,xe,"f").innerText}" copied to clipboard`,yield navigator.clipboard.writeText(__classPrivateFieldGet(this,xe,"f").innerText)),this.globalEvent.emitNotif(i)}catch(i){this.globalEvent.emitError(i)}})))),qe.set(this,(i=>{i.preventDefault(),i.stopPropagation(),this.globalEvent.emitClear(),__classPrivateFieldGet(this,ye,"m",Ve).call(this)})),Qe.set(this,(i=>{var s,n,a,l;i.preventDefault(),i.stopPropagation();const d=i.target.innerText;this.jiix&&d!==(null===(s=this.wordToChange)||void 0===s?void 0:s.label)&&(null===(a=null===(n=this.wordToChange)||void 0===n?void 0:n.candidates)||void 0===a?void 0:a.includes(d))&&(this.jiix.words[parseInt(null===(l=this.wordToChange)||void 0===l?void 0:l.id)].label=d,this.globalEvent.emitImport(this.jiix,_.JIIX)),__classPrivateFieldGet(this,Ee,"f").style.display="none"})),et.set(this,(i=>{i.preventDefault(),i.stopPropagation(),__classPrivateFieldGet(this,ye,"m",Ve).call(this);const s=i.target;s.id!==__classPrivateFieldGet(this,xe,"f").id?__classPrivateFieldGet(this,$e,"f").call(this,s):__classPrivateFieldGet(this,ye,"m",Ue).call(this)})),tt.set(this,(()=>{__classPrivateFieldGet(this,ye,"m",Ue).call(this),__classPrivateFieldGet(this,ye,"m",Ve).call(this)})),this.uuid=Math.random().toString(10).substring(2,12),this.margin={bottom:0,left:0,right:0,top:0},__classPrivateFieldGet(this,ye,"m",Le).call(this),__classPrivateFieldGet(this,ye,"m",Ae).call(this),__classPrivateFieldGet(this,ye,"m",Ie).call(this),__classPrivateFieldGet(this,ye,"m",De).call(this),__classPrivateFieldGet(this,ye,"m",Re).call(this),__classPrivateFieldGet(this,ye,"m",Ne).call(this),__classPrivateFieldGet(this,ye,"m",We).call(this),__classPrivateFieldGet(this,ye,"m",Oe).call(this),__classPrivateFieldGet(this,ye,"m",ze).call(this),__classPrivateFieldGet(this,ye,"m",je).call(this)}get globalEvent(){return GlobalEvent.getInstance()}init(i,s,n){i.appendChild(__classPrivateFieldGet(this,Pe,"f")),__classPrivateFieldGet(this,Pe,"f").appendChild(__classPrivateFieldGet(this,be,"f")),__classPrivateFieldGet(this,we,"f").appendChild(__classPrivateFieldGet(this,xe,"f")),__classPrivateFieldGet(this,Pe,"f").appendChild(__classPrivateFieldGet(this,we,"f")),__classPrivateFieldGet(this,Pe,"f").appendChild(__classPrivateFieldGet(this,Se,"f")),__classPrivateFieldGet(this,Fe,"f").appendChild(__classPrivateFieldGet(this,Ce,"f")),__classPrivateFieldGet(this,Fe,"f").appendChild(__classPrivateFieldGet(this,Ge,"f")),__classPrivateFieldGet(this,Fe,"f").appendChild(__classPrivateFieldGet(this,Me,"f")),__classPrivateFieldGet(this,Pe,"f").appendChild(__classPrivateFieldGet(this,Fe,"f")),__classPrivateFieldGet(this,Fe,"f").classList.add("close"),__classPrivateFieldSet(this,Te,!1,"f"),__classPrivateFieldGet(this,Pe,"f").appendChild(__classPrivateFieldGet(this,Ee,"f")),__classPrivateFieldGet(this,Ee,"f").style.display="none",this.margin=s,this.renderingConfiguration=n,__classPrivateFieldGet(this,ye,"m",it).call(this),__classPrivateFieldGet(this,ye,"m",Be).call(this),this.renderingConfiguration.smartGuide.fadeOut.enable&&__classPrivateFieldGet(this,ye,"m",He).call(this,this.renderingConfiguration.smartGuide.fadeOut.duration),this.resize()}resize(){const i=3.779527559,s=this.margin.top*i,n=this.margin.left*i,a=this.margin.right*i,l=s-45.354330708;__classPrivateFieldGet(this,Pe,"f").style.top=`${l}px`,__classPrivateFieldGet(this,Pe,"f").style.left=`${n}px`,__classPrivateFieldGet(this,Pe,"f").style.right=`${a}px`;let d=__classPrivateFieldGet(this,be,"f").offsetWidth;__classPrivateFieldGet(this,we,"f").style.marginLeft=`${d}px`,__classPrivateFieldGet(this,we,"f").style.width=__classPrivateFieldGet(this,Pe,"f").clientWidth-__classPrivateFieldGet(this,be,"f").offsetWidth-__classPrivateFieldGet(this,Se,"f").offsetHeight+"px",d+=__classPrivateFieldGet(this,we,"f").offsetWidth,__classPrivateFieldGet(this,Fe,"f").style.left=`${d-__classPrivateFieldGet(this,Fe,"f").offsetWidth+__classPrivateFieldGet(this,Se,"f").offsetWidth}px`,__classPrivateFieldGet(this,Fe,"f").style.top=`${__classPrivateFieldGet(this,Se,"f").offsetHeight}px`,__classPrivateFieldGet(this,Se,"f").style.left=`${d}px`}update(i){var s,n;this.jiix=i;const createWordSpan=(i,s)=>{const n=document.createElement("span");return n.id=`word-${i}${this.uuid}`,s?n.textContent=s.label:n.innerHTML="&nbsp;",n};(()=>{var i;if(__classPrivateFieldGet(this,xe,"f").innerHTML="",null===(i=this.jiix)||void 0===i?void 0:i.words){const i=this.jiix.words,s=document.createDocumentFragment();i.forEach(((n,a)=>{var l,d;if(" "===n.label||n.label.includes("\n"))s.appendChild(createWordSpan(a));else if(a!==i.length-1)s.appendChild(createWordSpan(a,n));else{__classPrivateFieldGet(this,xe,"f").appendChild(s),this.lastWord&&(this.lastWord=n);const i=createWordSpan(a,n);(null===(l=this.lastWord)||void 0===l?void 0:l.candidates)!==n.candidates&&(null===(d=this.lastWord)||void 0===d?void 0:d.label)!==n.label?(i.classList.add("added-word"),__classPrivateFieldGet(this,xe,"f").appendChild(i),__classPrivateFieldGet(this,we,"f").scrollLeft=i.offsetLeft,this.lastWord=n):(__classPrivateFieldGet(this,xe,"f").appendChild(i),__classPrivateFieldGet(this,we,"f").scrollLeft=i.offsetLeft)}}))}})(),(null===(n=null===(s=this.jiix)||void 0===s?void 0:s.words)||void 0===n?void 0:n.length)&&__classPrivateFieldGet(this,ye,"m",Be).call(this)}clear(){__classPrivateFieldGet(this,xe,"f").innerHTML="",__classPrivateFieldGet(this,Ee,"f").innerHTML="",__classPrivateFieldGet(this,ye,"m",Xe).call(this)}}Pe=new WeakMap,we=new WeakMap,xe=new WeakMap,Se=new WeakMap,be=new WeakMap,Ee=new WeakMap,Fe=new WeakMap,Ce=new WeakMap,Ge=new WeakMap,Me=new WeakMap,ke=new WeakMap,Te=new WeakMap,$e=new WeakMap,Ye=new WeakMap,Ze=new WeakMap,Ke=new WeakMap,qe=new WeakMap,Qe=new WeakMap,et=new WeakMap,tt=new WeakMap,ye=new WeakSet,Le=function _SmartGuide_createWrapperElement(){__classPrivateFieldSet(this,Pe,document.createElement("div"),"f"),__classPrivateFieldGet(this,Pe,"f").id=`smartguide-${this.uuid}`,__classPrivateFieldGet(this,Pe,"f").classList.add("smartguide")},Ae=function _SmartGuide_createPrompterContainerElement(){__classPrivateFieldSet(this,we,document.createElement("div"),"f"),__classPrivateFieldGet(this,we,"f").id=`prompter-container-${this.uuid}`,__classPrivateFieldGet(this,we,"f").classList.add("prompter-container")},Ie=function _SmartGuide_createPrompterTextElement(){__classPrivateFieldSet(this,xe,document.createElement("div"),"f"),__classPrivateFieldGet(this,xe,"f").id=`prompter-text-${this.uuid}`,__classPrivateFieldGet(this,xe,"f").classList.add("prompter-text"),__classPrivateFieldGet(this,xe,"f").setAttribute("touch-action","none")},De=function _SmartGuide_createEllipsisElement(){__classPrivateFieldSet(this,Se,document.createElement("div"),"f"),__classPrivateFieldGet(this,Se,"f").id=`ellipsis-${this.uuid}`,__classPrivateFieldGet(this,Se,"f").classList.add("ellipsis"),__classPrivateFieldGet(this,Se,"f").innerHTML="..."},Re=function _SmartGuide_createTagElement(){__classPrivateFieldSet(this,be,document.createElement("div"),"f"),__classPrivateFieldGet(this,be,"f").id=`tag-icon-${this.uuid}`,__classPrivateFieldGet(this,be,"f").classList.add("tag-icon"),__classPrivateFieldGet(this,be,"f").innerHTML="&#182;"},Ne=function _SmartGuide_createCandidatesElement(){__classPrivateFieldSet(this,Ee,document.createElement("div"),"f"),__classPrivateFieldGet(this,Ee,"f").id=`candidates-${this.uuid}`,__classPrivateFieldGet(this,Ee,"f").classList.add("candidates")},We=function _SmartGuide_createMoreMenuElement(){__classPrivateFieldSet(this,Fe,document.createElement("div"),"f"),__classPrivateFieldGet(this,Fe,"f").id=`more-menu-${this.uuid}`,__classPrivateFieldGet(this,Fe,"f").classList.add("more-menu")},Oe=function _SmartGuide_createConvertElement(){__classPrivateFieldSet(this,Ce,document.createElement("button"),"f"),__classPrivateFieldGet(this,Ce,"f").id=`convert-${this.uuid}`,__classPrivateFieldGet(this,Ce,"f").classList.add("options-label-button"),__classPrivateFieldGet(this,Ce,"f").innerHTML="Convert"},ze=function _SmartGuide_createCopyElement(){__classPrivateFieldSet(this,Ge,document.createElement("button"),"f"),__classPrivateFieldGet(this,Ge,"f").id=`copy-${this.uuid}`,__classPrivateFieldGet(this,Ge,"f").classList.add("options-label-button"),__classPrivateFieldGet(this,Ge,"f").innerHTML="Copy"},je=function _SmartGuide_createDeleteElement(){__classPrivateFieldSet(this,Me,document.createElement("button"),"f"),__classPrivateFieldGet(this,Me,"f").id=`delete-${this.uuid}`,__classPrivateFieldGet(this,Me,"f").classList.add("options-label-button"),__classPrivateFieldGet(this,Me,"f").innerHTML="Delete"},He=function _SmartGuide_initFadeOutObserver(i=3e3){new MutationObserver((s=>{s.forEach((()=>{clearTimeout(__classPrivateFieldGet(this,ke,"f")),("none"!==__classPrivateFieldGet(this,Ee,"f").style.display||__classPrivateFieldGet(this,Te,"f"))&&(document.contains(__classPrivateFieldGet(this,Ee,"f"))||document.contains(__classPrivateFieldGet(this,Fe,"f")))||__classPrivateFieldSet(this,ke,setTimeout((()=>{__classPrivateFieldGet(this,ye,"m",Xe).call(this)}),i),"f")}))})).observe(__classPrivateFieldGet(this,Pe,"f"),{childList:!0,subtree:!0,attributes:!0})},Be=function _SmartGuide_show(){__classPrivateFieldGet(this,Pe,"f").classList.remove("smartguide-out"),__classPrivateFieldGet(this,Pe,"f").classList.add("smartguide-in")},Xe=function _SmartGuide_hide(){__classPrivateFieldGet(this,Pe,"f").classList.add("smartguide-out"),__classPrivateFieldGet(this,Pe,"f").classList.remove("smartguide-in")},Ue=function _SmartGuide_hideCandidates(){__classPrivateFieldGet(this,Ee,"f").style.display="none"},Je=function _SmartGuide_openMenu(){__classPrivateFieldGet(this,Fe,"f").classList.add("open"),__classPrivateFieldGet(this,Fe,"f").classList.remove("close"),__classPrivateFieldSet(this,Te,!0,"f")},Ve=function _SmartGuide_closeMenu(){__classPrivateFieldGet(this,Fe,"f").classList.add("close"),__classPrivateFieldGet(this,Fe,"f").classList.remove("open"),__classPrivateFieldSet(this,Te,!1,"f")},it=function _SmartGuide_addListeners(){__classPrivateFieldGet(this,Se,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,Ye,"f").call(this,i))),__classPrivateFieldGet(this,Ce,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,Ze,"f").call(this,i))),__classPrivateFieldGet(this,Ge,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,Ke,"f").call(this,i))),__classPrivateFieldGet(this,Me,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,qe,"f").call(this,i))),__classPrivateFieldGet(this,xe,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,et,"f").call(this,i))),__classPrivateFieldGet(this,Ee,"f").addEventListener("pointerdown",(i=>__classPrivateFieldGet(this,Qe,"f").call(this,i))),document.addEventListener("pointerdown",(()=>__classPrivateFieldGet(this,tt,"f").call(this)))};var st,nt,rt,ot,at,lt,dt,ct,ht,pt,ut,vt,gt,mt,_t,ft,yt,Pt,wt,xt,St,bt,Et,Ft,Ct;!function styleInject(i,s){void 0===s&&(s={});var n=s.insertAt;if(i&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css","top"===n&&a.firstChild?a.insertBefore(l,a.firstChild):a.appendChild(l),l.styleSheet?l.styleSheet.cssText=i:l.appendChild(document.createTextNode(i))}}('/* @import url(../node_modules/perfect-scrollbar/css/perfect-scrollbar.css); */\n\n.ms-editor {\n    position: relative;\n    z-index: 20;\n    color: #1A9FFF;\n    font-family: sans-serif;\n}\n\n.ms-editor.erasing {\n    cursor: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEsSURBVDiNrdO7SgNBFMbx/3fmCbQ1tunDIayFBvFSKxbxBfSdBPEBtLIWb3Ebl4R9AQWLkE70CWbHZl1Eg2iSr5vL+c1hhhFTMhwOdyX1gQ2gVU+PgTyldNHtdq+/1+jroCiKtpmdSupNO6ApkgZmdtzpdJ5+QGVZ9qqqugSWfkO+5F3SnrvnDVQURTuE8PgP5DNvkjJ3fzaAEMLJDAjAclVVZwCqL/ZqBqSJme2YpMN5EIAYY9+A9XkhST0DVuaFgJYtAAGoDJgsAJoYkM+rSHqwlNL5Ajq6EMBoNLoBtmbsZuDumwYQYzwCXmdw3oAjAAPIsuxF0kG98GdE0r67PzcQgLvnIYQ14P4PyF39WZuH0rRdZVluxxj7kjaA1Xp6nFLKzezc3W+/13wAItdV6XjME1AAAAAASUVORK5CYII=\') 10 10, auto;\n}\n\n.ms-editor canvas,\n.ms-editor svg {\n    z-index: 15;\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 100%;\n}\n\n.ms-editor canvas.ms-rendering-canvas {\n    z-index: 10;\n    pointer-events: none;\n    background-image: linear-gradient(to right, #F5F6F7 1px, transparent 1px),\n    linear-gradient(to bottom, #F5F6F7 1px, transparent 1px);\n    background-size: 18px 18px;\n}\n\n.ms-editor svg {\n    z-index: 10;\n    pointer-events: none;\n}\n.ms-editor svg[data-layer="BACKGROUND"] {\n    z-index: 9;\n}\n\n.ms-editor .loader {\n    z-index: 30;\n    position: absolute;\n    width: 120px;\n    height: 120px;\n    top: calc(50% - 60px);\n    left: calc(50% - 60px);\n    border: 16px solid #F5F6F7;\n    border-radius: 50%;\n    border-top-color: #1A9FFF;\n    -webkit-animation: spin 2s linear infinite;\n    animation: spin 2s linear infinite;\n}\n\n.ms-editor .message {\n    z-index: 25;\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    top: calc(50% - 100px);\n    left: calc(50% - 100px);\n    font-size: 16px;\n    text-align: center;\n    word-wrap: break-word;\n}\n\n.ms-editor .error-msg::before {\n    content: url("data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCA3Ni41IDYxMiA0NTkiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPgogICAgPHBhdGggZmlsbD0iIzFBOUZGRiIgZD0iTTQ5NC43LDIyOS41Yy0xNy44NTEtODYuNy05NC4zNTEtMTUzLTE4OC43LTE1M2MtMzguMjUsMC03My45NSwxMC4yLTEwMiwzMC42bDM4LjI1LDM4LjI1IGMxNy44NS0xMi43NSw0MC44LTE3Ljg1LDYzLjc1LTE3Ljg1Yzc2LjUsMCwxNDAuMjUsNjMuNzUsMTQwLjI1LDE0MC4yNXYxMi43NWgzOC4yNWM0My4zNSwwLDc2LjUsMzMuMTUsNzYuNSw3Ni41IGMwLDI4LjA1LTE1LjMsNTMuNTUtNDAuOCw2Ni4zbDM4LjI1LDM4LjI1QzU5MS42LDQzOC42LDYxMiw0MDAuMzUsNjEyLDM1N0M2MTIsMjkwLjcsNTU4LjQ1LDIzNC42LDQ5NC43LDIyOS41eiBNNzYuNSwxMDkuNjUgbDcxLjQsNjguODVDNjYuMywxODMuNiwwLDI0OS45LDAsMzMxLjVjMCw4NC4xNSw2OC44NSwxNTMsMTUzLDE1M2gyOTguMzVsNTEsNTFsMzMuMTUtMzMuMTVMMTA5LjY1LDc2LjVMNzYuNSwxMDkuNjV6IE0xOTYuMzUsMjI5LjVsMjA0LDIwNEgxNTNjLTU2LjEsMC0xMDItNDUuOS0xMDItMTAyYzAtNTYuMSw0NS45LTEwMiwxMDItMTAySDE5Ni4zNXoiIC8+Cjwvc3ZnPgo=");\n}\n\n.ms-editor .info-msg::before {\n    content: "";\n    background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmlld0JveD0iMCAwIDI0IDI0IgogIGZpbGw9Im5vbmUiCiAgc3Ryb2tlPSIjMUE5RkZGIgogIHN0cm9rZS13aWR0aD0iMiIKICBzdHJva2UtbGluZWNhcD0icm91bmQiCiAgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIKPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiAvPgogIDxsaW5lIHgxPSIxMiIgeTE9IjE2IiB4Mj0iMTIiIHkyPSIxMiIgLz4KICA8bGluZSB4MT0iMTIiIHkxPSI4IiB4Mj0iMTIuMDEiIHkyPSI4IiAvPgo8L3N2Zz4=");;\n    background-size: 100% 100%;\n    display: block;\n    margin: auto;\n    padding-bottom: 10px;\n    height: 25px;\n    width:25px;\n}\n\n.ms-editor .smartguide {\n    position: absolute;\n    z-index: 40;\n    font-size: 16px;\n}\n\n.ms-editor .smartguide.smartguide-in {\n    visibility: visible !important;\n    transition: opacity 0.5s;\n    opacity: 1;\n}\n\n.ms-editor .smartguide.smartguide-out {\n    transition: opacity 1s, visibility 1s;\n    visibility: hidden !important;\n    opacity: 0;\n}\n\n.ms-editor .smartguide .tag-icon {\n    padding: 0 18px;\n    border: 1px solid #959DA6;\n    font-weight: bold;\n    font-size: large;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 48px;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n}\n\n.ms-editor .smartguide .ellipsis {\n    cursor: pointer;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 38px;\n    padding: 0 8px;\n    font-weight: bold;\n    font-size: x-large;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .ellipsis:active {\n    background-color: #e0e0e0;\n}\n\n.ms-editor .smartguide .prompter-container {\n    background-color: rgba(255, 255, 255, 0.9);\n    height: 48px;\n    line-height: 48px;\n    overflow: hidden;\n    white-space: nowrap;\n    display: block;\n    text-align: left;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 30;\n    color: #bfbfbf;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .prompter-container > div > span {\n    cursor: pointer;\n    display: inline-block;\n}\n\n.ms-editor .smartguide .prompter-container .prompter-text {\n    margin-left: 12px;\n}\n\n.ms-editor .smartguide .prompter-container .prompter-text .added-word {\n    animation: 0.1s linear word-added,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .prompter-container .prompter-text .modified-word {\n    animation: 0.1s linear word-modified,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .candidates {\n    color: black;\n    flex-direction: column;\n    text-align: center;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    box-shadow: 2px 2px 12px #BDBDBD, -2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n    z-index: 100;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .candidates > span {\n    cursor: pointer;\n    padding: 2px 20px;\n}\n\n.ms-editor .smartguide .candidates > span:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .candidates > span:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .candidates .selected-word {\n    font-weight: bold;\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .more-menu {\n    display: flex;\n    flex-direction: column;\n    margin-right: 12px;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    z-index: 100;\n    box-shadow: 2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n    overflow: hidden;\n    transition: max-height 1s ease-out, opacity 1s, visibility 0.5s linear;\n}\n.ms-editor .smartguide .more-menu.open {\n    max-height: 500px;\n    visibility: visible;\n    opacity: 1;\n}\n.ms-editor .smartguide .more-menu.close {\n    max-height: 0;\n    visibility: hidden;\n    opacity: 0;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button {\n    color: black;\n    font-size: 16px;\n    cursor: pointer;\n    box-sizing: border-box;\n    background: transparent;\n    border: none;\n    padding: 0 24px;\n    margin: 0;\n    height: 40px;\n    outline: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .ps__rail-x {\n    top: 32px !important;\n}\n\n/** Stroke **/\n\n.ms-editor .removed-stroke {\n    opacity: 0;\n    transition: opacity 0.1s ease-in-out;\n}\n\n.ms-editor .added-stroke {\n    animation: 0.2s opacity-appear;\n}\n\n@keyframes color-input {\n    0% {\n        color: black;\n    }\n    100% {\n        color: #bfbfbf;\n    }\n}\n\n@keyframes word-added {\n    0% {\n        transform: translate(5px, 0);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes word-modified {\n    0% {\n        transform: translate(0, 5px);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes opacity-appear {\n    0% {\n        opacity: 0;\n    }\n    100% {\n        opacity : 1;\n    }\n}\n\n@keyframes spin {\n    0% {\n        transform: rotate(0deg);\n    }\n    100% {\n        transform: rotate(360deg);\n    }\n}\n\n@-webkit-keyframes spin {\n    0% {\n        -webkit-transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n    }\n}\n'),i.EditorMode=void 0,(Ct=i.EditorMode||(i.EditorMode={})).Writing="writing",Ct.Erasing="erasing";nt=new WeakMap,rt=new WeakMap,ot=new WeakMap,at=new WeakMap,lt=new WeakMap,dt=new WeakMap,ct=new WeakMap,ht=new WeakMap,pt=new WeakMap,st=new WeakSet,ut=function _Editor_behaviors_get(){return __classPrivateFieldGet(this,at,"f").behaviors},vt=function _Editor_grabber_get(){return __classPrivateFieldGet(this,at,"f").behaviors.grabber},gt=function _Editor_initializeSmartGuide(){if(this.configuration.rendering.smartGuide.enable){let i;switch(this.configuration.recognition.type){case"TEXT":i=this.configuration.recognition.text.margin;break;case"MATH":i=this.configuration.recognition.math.margin;break;default:i={top:20,left:10,right:10,bottom:10}}__classPrivateFieldGet(this,ct,"f").init(this.wrapperHTML,i,this.configuration.rendering)}else __classPrivateFieldGet(this,ct,"f").clear()},mt=function _Editor_initalizeBehaviors(){__classPrivateFieldGet(this,at,"f").init(this.wrapperHTML).then((()=>__awaiter(this,void 0,void 0,(function*(){__classPrivateFieldGet(this,st,"a",vt).onPointerDown=(i,s)=>__classPrivateFieldGet(this,st,"m",bt).call(this,i,s),__classPrivateFieldGet(this,st,"a",vt).onPointerMove=(i,s)=>__classPrivateFieldGet(this,st,"m",Et).call(this,i,s),__classPrivateFieldGet(this,st,"a",vt).onPointerUp=(i,s)=>__classPrivateFieldGet(this,st,"m",Ft).call(this,i,s),__classPrivateFieldGet(this,st,"a",ut).setPenStyle&&__classPrivateFieldGet(this,st,"a",ut).setPenStyle(this.penStyle),__classPrivateFieldGet(this,st,"a",ut).setTheme&&__classPrivateFieldGet(this,st,"a",ut).setTheme(this.theme),__classPrivateFieldGet(this,st,"a",ut).setPenStyleClasses&&__classPrivateFieldGet(this,st,"a",ut).setPenStyleClasses(this.penStyleClasses),this.wrapperHTML.editor=this,__classPrivateFieldGet(this,pt,"f").resolve(!0),this.events.emitLoaded()})))).catch((i=>{__classPrivateFieldGet(this,pt,"f").resolve(!1),__classPrivateFieldGet(this,st,"m",_t).call(this,i),this.events.emitError(i)})).finally((()=>{__classPrivateFieldGet(this,nt,"f").style.display="none"}))},_t=function _Editor_showError(i){if(__classPrivateFieldGet(this,rt,"f").style.display="initial",__classPrivateFieldGet(this,rt,"f").classList.add("error-msg"),__classPrivateFieldGet(this,rt,"f").classList.remove("info-msg"),__classPrivateFieldGet(this,rt,"f").innerText=i.message,this.debug){const s=document.createElement("p");s.innerHTML=i.name,__classPrivateFieldGet(this,rt,"f").prepend(s);const n=document.createElement("p");n.style.width="50vw",n.style.marginLeft="calc(-25vw + 100px)",n.innerHTML=i.stack||"",__classPrivateFieldGet(this,rt,"f").appendChild(n)}},ft=function _Editor_showNotif(i,s=1e3){__classPrivateFieldGet(this,rt,"f").style.display="initial",__classPrivateFieldGet(this,rt,"f").classList.add("info-msg"),__classPrivateFieldGet(this,rt,"f").classList.remove("error-msg"),__classPrivateFieldGet(this,rt,"f").innerText=i,setTimeout((()=>{__classPrivateFieldGet(this,rt,"f").style.display="none"}),s)},yt=function _Editor_addListeners(){this.events.addEventListener(n.CONVERT,(()=>this.convert({conversionState:"DIGITAL_EDIT"}))),this.events.addEventListener(n.CLEAR,(()=>this.clear())),this.events.addEventListener(n.ERROR,(i=>__classPrivateFieldGet(this,st,"m",St).call(this,i))),this.events.addEventListener(n.IMPORT,(i=>__classPrivateFieldGet(this,st,"m",xt).call(this,i))),this.events.addEventListener(n.EXPORTED,(i=>__classPrivateFieldGet(this,st,"m",wt).call(this,i))),this.events.addEventListener(n.NOTIF,(i=>__classPrivateFieldGet(this,st,"m",Pt).call(this,i)))},Pt=function _Editor_onNotif(i){const s=i.detail;__classPrivateFieldGet(this,st,"m",ft).call(this,s.message,s.timeout)},wt=function _Editor_onExport(i){if(this.configuration.rendering.smartGuide.enable){const s=i.detail;if(s["application/vnd.myscript.jiix"]){const i=s["application/vnd.myscript.jiix"];__classPrivateFieldGet(this,ct,"f").update(JSON.parse(i))}}},xt=function _Editor_onImport(i){const s=i,n=s.detail.jiix,a=s.detail.mimeType;this.import(new Blob([JSON.stringify(n)],{type:a}),a)},St=function _Editor_onError(i){const s=i,n=null==s?void 0:s.detail;__classPrivateFieldGet(this,st,"m",_t).call(this,n)},bt=function _Editor_onPointerDown(s,n){var a,l;const d=s.target;if((null==d?void 0:d.id)===this.wrapperHTML.id||(null===(a=null==d?void 0:d.classList)||void 0===a?void 0:a.contains("ms-canvas"))){let{pointerType:a}=s;__classPrivateFieldGet(this,ht,"f")===i.EditorMode.Erasing&&(a="eraser");const d=Object.assign({},null===(l=this.theme)||void 0===l?void 0:l.ink,__classPrivateFieldGet(this,dt,"f"));this.model.initCurrentStroke(n,s.pointerId,a,d),__classPrivateFieldGet(this,st,"a",ut).drawCurrentStroke(this.model)}},Et=function _Editor_onPointerMove(i,s){this.model.appendToCurrentStroke(s),__classPrivateFieldGet(this,st,"a",ut).drawCurrentStroke(this.model)},Ft=function _Editor_onPointerUp(i,s){this.model.endCurrentStroke(s,this.penStyle),__classPrivateFieldGet(this,st,"a",ut).updateModelRendering(this.model).then((i=>this.model=i)).catch((i=>__classPrivateFieldGet(this,st,"m",_t).call(this,i)))},i.Constants=f,i.DefaultConfiguration=ve,i.DefaultEventsConfiguration=pe,i.DefaultGrabberConfiguration=de,i.DefaultPenStyle=ge,i.DefaultRecognitionConfiguration=le,i.DefaultRenderingConfiguration=ce,i.DefaultServerConfiguration=ae,i.DefaultTheme=me,i.DefaultTriggerConfiguration=he,i.DefaultUndoRedoConfiguration=ue,i.Editor=class Editor{constructor(s,n){st.add(this),nt.set(this,void 0),rt.set(this,void 0),ot.set(this,void 0),at.set(this,void 0),lt.set(this,void 0),dt.set(this,void 0),ct.set(this,void 0),ht.set(this,void 0),pt.set(this,void 0),this.debug=!1,__classPrivateFieldSet(this,pt,new DeferredPromise,"f"),this.wrapperHTML=s,this.wrapperHTML.classList.add((null==n?void 0:n.globalClassCss)||"ms-editor"),__classPrivateFieldSet(this,nt,document.createElement("div"),"f"),__classPrivateFieldGet(this,nt,"f").classList.add("loader"),__classPrivateFieldGet(this,nt,"f").style.display="initial",this.wrapperHTML.appendChild(__classPrivateFieldGet(this,nt,"f")),__classPrivateFieldSet(this,rt,document.createElement("div"),"f"),__classPrivateFieldGet(this,rt,"f").classList.add("message"),__classPrivateFieldGet(this,rt,"f").style.display="none",this.wrapperHTML.appendChild(__classPrivateFieldGet(this,rt,"f")),__classPrivateFieldSet(this,ht,i.EditorMode.Writing,"f"),__classPrivateFieldSet(this,lt,new StyleManager(null==n?void 0:n.penStyle,null==n?void 0:n.theme),"f"),__classPrivateFieldSet(this,dt,__classPrivateFieldGet(this,lt,"f").penStyle,"f"),__classPrivateFieldSet(this,ot,new Configuration(null==n?void 0:n.configuration),"f"),__classPrivateFieldSet(this,ct,new SmartGuide,"f");const a=Math.max(this.wrapperHTML.clientWidth,this.configuration.rendering.minWidth),l=Math.max(this.wrapperHTML.clientHeight,this.configuration.rendering.minHeight);this.model=new Model(a,l),__classPrivateFieldSet(this,at,new BehaviorsManager(this.configuration,this.model,null==n?void 0:n.behaviors),"f"),__classPrivateFieldGet(this,st,"m",mt).call(this),__classPrivateFieldGet(this,st,"m",gt).call(this),__classPrivateFieldGet(this,st,"m",yt).call(this)}get initializationPromise(){return __classPrivateFieldGet(this,pt,"f").promise}get configuration(){return __classPrivateFieldGet(this,ot,"f")}set configuration(i){__classPrivateFieldSet(this,pt,new DeferredPromise,"f"),__classPrivateFieldGet(this,ot,"f").overrideDefaultConfiguration(i),this.model.clear(),this.model.height=Math.max(this.wrapperHTML.clientHeight,__classPrivateFieldGet(this,ot,"f").rendering.minHeight),this.model.width=Math.max(this.wrapperHTML.clientWidth,__classPrivateFieldGet(this,ot,"f").rendering.minWidth),__classPrivateFieldGet(this,at,"f").overrideDefaultBehaviors(__classPrivateFieldGet(this,ot,"f"),this.model),__classPrivateFieldGet(this,st,"m",mt).call(this),__classPrivateFieldGet(this,st,"m",gt).call(this)}get mode(){return __classPrivateFieldGet(this,ht,"f")}set mode(s){if("WEBSOCKET"!==__classPrivateFieldGet(this,ot,"f").server.protocol)throw new Error("set Editor.mode only available in WEBSOCKET");__classPrivateFieldSet(this,ht,s,"f"),__classPrivateFieldGet(this,ht,"f")===i.EditorMode.Erasing?this.wrapperHTML.classList.add("erasing"):(document.body.style.cursor="initial",this.wrapperHTML.classList.remove("erasing"))}get events(){return GlobalEvent.getInstance()}get theme(){return __classPrivateFieldGet(this,lt,"f").theme}set theme(i){__classPrivateFieldGet(this,lt,"f").overrideDefaultTheme(i),__classPrivateFieldGet(this,st,"a",ut).setTheme&&__classPrivateFieldGet(this,st,"a",ut).setTheme(this.theme)}get penStyleClasses(){return __classPrivateFieldGet(this,lt,"f").penStyleClasses}set penStyleClasses(i){__classPrivateFieldGet(this,lt,"f").penStyleClasses=i,__classPrivateFieldSet(this,dt,this.theme[`.${this.penStyleClasses}`],"f"),__classPrivateFieldGet(this,st,"a",ut).setPenStyleClasses&&__classPrivateFieldGet(this,st,"a",ut).setPenStyleClasses(i)}get penStyle(){return __classPrivateFieldGet(this,lt,"f").penStyle}set penStyle(i){__classPrivateFieldGet(this,lt,"f").overrideDefaultPenStyle(i),__classPrivateFieldSet(this,dt,this.penStyle,"f"),__classPrivateFieldGet(this,st,"a",ut).setPenStyle&&__classPrivateFieldGet(this,st,"a",ut).setPenStyle(this.penStyle)}undo(){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,st,"a",ut).undo(),this.model}))}redo(){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,st,"a",ut).redo(),this.model}))}clear(){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,st,"a",ut).clear(this.model),this.model}))}resize(){return __awaiter(this,void 0,void 0,(function*(){return this.configuration.rendering.smartGuide.enable&&__classPrivateFieldGet(this,ct,"f").resize(),this.model.height=Math.max(this.wrapperHTML.clientHeight,this.configuration.rendering.minHeight),this.model.width=Math.max(this.wrapperHTML.clientWidth,this.configuration.rendering.minWidth),this.model=yield __classPrivateFieldGet(this,st,"a",ut).resize(this.model),this.model}))}export(i){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,st,"a",ut).export(this.model,i),this.model}))}convert(i){return __awaiter(this,void 0,void 0,(function*(){return this.model=yield __classPrivateFieldGet(this,st,"a",ut).convert(this.model,null==i?void 0:i.conversionState,null==i?void 0:i.mimeTypes),this.events.emitConverted(this.model.converts),this.model}))}import(i,s){var n;return __awaiter(this,void 0,void 0,(function*(){return __classPrivateFieldGet(this,st,"a",ut).import?(this.model=yield __classPrivateFieldGet(this,st,"a",ut).import(this.model,i,s),this.events.emitImported(null===(n=this.model.exports)||void 0===n?void 0:n["application/vnd.myscript.jiix"]),this.model):Promise.reject("Import impossible, behaviors has no import function")}))}},i.RestBehaviors=RestBehaviors,i.WSBehaviors=WSBehaviors,i.getAvailableLanguageList=function getAvailableLanguageList(i){var s,n;return __awaiter(this,void 0,void 0,(function*(){if((null===(s=null==i?void 0:i.server)||void 0===s?void 0:s.scheme)&&(null===(n=null==i?void 0:i.server)||void 0===n?void 0:n.host)){const s=i.server;return(yield fetch(`${s.scheme}://${s.host}/api/v4.0/iink/availableLanguageList`)).json()}return Promise.reject("Cannot get languages ! Please check your server configuration!")}))},Object.defineProperty(i,"__esModule",{value:!0})}));
//# sourceMappingURL=iink.min.js.map
