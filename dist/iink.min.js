!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).iink={})}(this,(function(e){"use strict";function __awaiter(e,t,n,i){return new(n||(n=Promise))((function(o,r){function fulfilled(e){try{step(i.next(e))}catch(e){r(e)}}function rejected(e){try{step(i.throw(e))}catch(e){r(e)}}function step(e){e.done?o(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))}class PointerEventGrabber{constructor(e){this.prevent=e=>e.preventDefault(),this.pointerDownHandler=e=>{if(0===e.button&&1===e.buttons&&(this.activePointerId=e.pointerId,this.onPointerDown)){const t=this.extractPoint(e);this.onPointerDown(e,t)}},this.pointerMoveHandler=e=>{if(null!=this.activePointerId&&this.activePointerId===e.pointerId&&this.onPointerMove){const t=this.extractPoint(e);this.onPointerMove(e,t)}},this.pointerUpHandler=e=>{if(null!=this.activePointerId&&this.activePointerId===e.pointerId&&(this.activePointerId=void 0,e.stopPropagation(),this.onPointerUp)){const t=this.extractPoint(e);this.onPointerUp(e,t)}},this.setConfiguration(e)}roundFloat(e,t){if(t>=0){const n=Math.pow(10,t);return Math.round(e/n)*n}return e}extractPoint(e){let t,n;({clientX:t,clientY:n}="changedTouches"in e?e.changedTouches[0]:e);const i=this.domElement.getBoundingClientRect();return{x:this.roundFloat(t-i.left-this.domElement.clientLeft,this.configuration.xyFloatPrecision),y:this.roundFloat(n-i.top-this.domElement.clientTop,this.configuration.xyFloatPrecision),t:this.roundFloat(Date.now(),this.configuration.timestampFloatPrecision),p:e.pressure}}setConfiguration(e){this.configuration=e}attach(e){this.domElement&&this.detach(),this.domElement=e,this.domElement.addEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.addEventListener("touchmove",this.prevent),document.documentElement.addEventListener("pointerdown",(()=>{}))}detach(){this.domElement.removeEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointerout",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.domElement.removeEventListener("touchmove",this.prevent),document.documentElement.removeEventListener("pointerdown",(()=>{}))}}const t={table:"table",shape:"shape",recognizedShape:"recognizedShape",ellipse:"ellipse",line:"line"};function phi(e){let t=(e+Math.PI)%(2*Math.PI)-Math.PI;return t<-Math.PI&&(t+=2*Math.PI),t}function drawArrowHead(e,t,n,i){const o=phi(n+Math.PI*(7/8)),r=phi(n-Math.PI*(7/8));e.save();try{e.fillStyle=e.strokeStyle,e.moveTo(t.x,t.y),e.beginPath(),e.lineTo(t.x+i*Math.cos(o),t.y+i*Math.sin(o)),e.lineTo(t.x+i*Math.cos(r),t.y+i*Math.sin(r)),e.lineTo(t.x,t.y),e.fill()}finally{e.restore()}}function drawShapeEllipse(e,t){const n=function drawEllipseArc(e,t){const{centerPoint:n,maxRadius:i,minRadius:o,orientation:r,startAngle:s,sweepAngle:a}=t;let d=Math.cos(r),l=Math.sin(r),c=d,h=l;d*=i,c*=o,l*=i,h*=o;const p=Math.floor(Math.abs(a)/.02),u=[];e.save();try{e.beginPath();for(let t=0;t<=p;t++){const r=s+t/p*a,m=Math.atan2(Math.sin(r)/o,Math.cos(r)/i),g=Math.cos(m),y=Math.sin(m),v=n.x+d*g-h*y,x=n.y+c*y+l*g;0===t?e.moveTo(v,x):e.lineTo(v,x),0!==t&&t!==p||u.push({x:v,y:x})}e.stroke()}finally{e.restore()}return u}(e,t);"ARROW_HEAD"===(null==t?void 0:t.beginDecoration)&&drawArrowHead(e,n[0],t.beginTangentAngle,12),"ARROW_HEAD"===(null==t?void 0:t.endDecoration)&&drawArrowHead(e,n[1],t.endTangentAngle,12)}function drawLine(e,t,n){e.save();try{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke()}finally{e.restore()}}function drawShapeSymbol(e,n){e.save();try{if(e.lineWidth=n.width,e.strokeStyle=n.color,n.elementType)switch(n.elementType){case t.shape:const i=n;drawShapeSymbol(e,i.candidates[i.selectedCandidateIndex]);break;case t.table:n.lines.forEach((t=>drawShapeSymbol(e,t)));break;case t.line:const o=n;drawLine(e,o.data.p1,o.data.p2)}else switch(n.type){case t.ellipse:drawShapeEllipse(e,n);break;case t.line:!function drawShapeLine(e,t){drawLine(e,t.firstPoint,t.lastPoint),"ARROW_HEAD"===t.beginDecoration&&drawArrowHead(e,t.firstPoint,t.beginTangentAngle,12),"ARROW_HEAD"===t.endDecoration&&drawArrowHead(e,t.lastPoint,t.endTangentAngle,12)}(e,n);break;case t.recognizedShape:n.primitives.forEach((t=>drawShapeSymbol(e,t)))}}finally{e.restore()}}const n={inputCharacter:"inputCharacter",char:"char",string:"string",textLine:"textLine"};function drawTextLine(e,t){!function drawText(e,t,n){e.save();try{e.font=`${n.textHeight}px serif`,e.textAlign="CENTER"===n.justificationType?"center":"left",e.textBaseline="bottom",e.fillStyle=e.strokeStyle,e.fillText(t,n.topLeftPoint.x,n.topLeftPoint.y+n.height)}finally{e.restore()}}(e,t.label,t.data),t.underlineList.forEach((n=>{!function drawUnderline(e,t,n,i){const o=i.width/n.length;drawLine(e,{x:i.topLeftPoint.x+t.data.firstCharacter*o,y:i.topLeftPoint.y+i.height},{x:i.topLeftPoint.x+t.data.lastCharacter*o,y:i.topLeftPoint.y+i.height})}(e,n,t.label,t.data)}))}class CanvasRenderer{constructor(e){this.config=e}createCanvas(e,t){const n=document.createElement("canvas");return n.classList.add(t),n.classList.add("ms-canvas"),e.appendChild(n),n}resizeContent(){[this.context.renderingCanvas,this.context.capturingCanvas].forEach((e=>{var t,n,i;const o=e.parentNode,r=Math.max(null===(t=this.context)||void 0===t?void 0:t.minWidth,o.clientWidth),s=Math.max(null===(n=this.context)||void 0===n?void 0:n.minHeight,o.clientHeight);e.width=r*window.devicePixelRatio,e.height=s*window.devicePixelRatio,e.style.width=`${r}px`,e.style.height=`${s}px`,null===(i=e.getContext("2d"))||void 0===i||i.scale(1,1)}))}drawSymbol(e,i,o){const r=i.elementType||i.type;"stroke"===r?function drawStroke(e,t,n){n&&t&&"eraser"!==t.pointerType&&n.drawStroke(e,t)}(e,i,o):Object.keys(n).includes(r)?function drawTextSymbol(e,t){e.save();try{e.lineWidth=t.width,e.strokeStyle=t.color,(t.elementType||t.type)===n.textLine&&drawTextLine(e,t)}finally{e.restore()}}(e,i):Object.keys(t).includes(r)&&drawShapeSymbol(e,i)}init(e){const t=this.createCanvas(e,"ms-rendering-canvas"),n=this.createCanvas(e,"ms-capture-canvas");this.context={minHeight:this.config.minHeight||0,minWidth:this.config.minWidth||0,renderingCanvas:t,renderingCanvasContext:t.getContext("2d"),capturingCanvas:n,capturingCanvasContext:n.getContext("2d")},this.resizeContent()}drawModel(e,t){var n;null===(n=this.context.renderingCanvasContext)||void 0===n||n.clearRect(0,0,this.context.renderingCanvas.width,this.context.renderingCanvas.height);const i=[...e.defaultSymbols];e.recognizedSymbols?(i.push(...e.recognizedSymbols),i.push(...e.extractPendingStrokes())):i.push(...e.rawStrokes),i.forEach((e=>this.drawSymbol(this.context.renderingCanvasContext,e,t))),this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height)}drawCurrentStroke(e,t){const n=e.currentStroke;this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),t&&n&&"eraser"!==(null==n?void 0:n.pointerType)&&t.drawStroke(this.context.capturingCanvasContext,n)}resize(e,t){this.resizeContent(),this.drawModel(e,t)}destroy(e){e.removeChild(this.context.renderingCanvas),e.removeChild(this.context.capturingCanvas)}}function computeLinksPoints(e,t,n){const i=e.p*n;return[{x:e.x-Math.sin(t)*i,y:e.y+Math.cos(t)*i},{x:e.x+Math.sin(t)*i,y:e.y-Math.cos(t)*i}]}function computeMiddlePoint(e,t){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2,p:(t.p+e.p)/2,t:(t.t+e.t)/2}}function computeAxeAngle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}class QuadraticCanvasStroker{renderArc(e,t,n){e.arc(t.x,t.y,n,0,2*Math.PI,!0)}renderLine(e,t,n,i){const o=computeLinksPoints(t,computeAxeAngle(t,n),i),r=computeLinksPoints(n,computeAxeAngle(t,n),i);e.moveTo(o[0].x,o[0].y),e.lineTo(r[0].x,r[0].y),e.lineTo(r[1].x,r[1].y),e.lineTo(o[1].x,o[1].y)}renderFinal(e,t,n,i){const o=computeAxeAngle(t,n),r=computeLinksPoints(n,o,i);e.moveTo(r[0].x,r[0].y);for(let t=1;t<=6;t++){const r=o-t*Math.PI/6;e.lineTo(n.x-n.p*i*Math.sin(r),n.y+n.p*i*Math.cos(r))}}renderQuadratic(e,t,n,i,o){const r=computeLinksPoints(t,computeAxeAngle(t,i),o),s=computeLinksPoints(n,computeAxeAngle(i,n),o),a=computeLinksPoints(i,computeAxeAngle(t,n),o);e.moveTo(r[0].x,r[0].y),e.quadraticCurveTo(a[0].x,a[0].y,s[0].x,s[0].y),e.lineTo(s[1].x,s[1].y),e.quadraticCurveTo(a[1].x,a[1].y,r[1].x,r[1].y)}getPointByIndex(e,t){return{x:e.x[t]||0,y:e.y[t]||0,t:e.t[t]||0,p:e.p[t]||0}}drawStroke(e,t){const n=t.x.length,i=t.width>0?t.width:e.lineWidth,o=t.color?t.color:e.strokeStyle,r=this.getPointByIndex(t,0),s=n-2;e.save();try{if(e.beginPath(),n<3)this.renderArc(e,r,.6*i);else{this.renderArc(e,r,i*r.p);const o=computeMiddlePoint(r,this.getPointByIndex(t,1));this.renderLine(e,r,o,i);for(let n=0;n<s;n++){const o=computeMiddlePoint(this.getPointByIndex(t,n),this.getPointByIndex(t,n+1)),r=computeMiddlePoint(this.getPointByIndex(t,n+1),this.getPointByIndex(t,n+2)),s=this.getPointByIndex(t,n+1);this.renderQuadratic(e,o,r,s,i)}const a=computeMiddlePoint(this.getPointByIndex(t,n-2),this.getPointByIndex(t,n-1)),d=this.getPointByIndex(t,n-1);this.renderLine(e,a,d,i);const l=this.getPointByIndex(t,n-2),c=this.getPointByIndex(t,n-1);this.renderFinal(e,l,c,i)}e.closePath(),void 0!==o&&(e.fillStyle=o,e.fill()),e.save()}finally{e.restore()}}}class RestBehaviors{constructor(e){this.grabber=new PointerEventGrabber(e.grabber),this.stroker=new QuadraticCanvasStroker,this.renderer=new CanvasRenderer(e.rendering)}init(e){return this.grabber.attach(e),this.renderer.init(e),Promise.resolve(!0)}}class BehaviorsManager{constructor(e,t){this.overrideDefaultBehaviors(e,t)}overrideDefaultBehaviors(e,t){const n=new RestBehaviors(e);this.behaviors=Object.assign(n,t)}init(e){return this.behaviors.init(e)}}const i={protocol:"WEBSOCKET",scheme:"https",host:"cloud.myscript.com",applicationKey:"",hmacKey:"",useWindowLocation:!1,websocket:{pingEnabled:!0,pingDelay:3e4,maxPingLostCount:10,autoReconnect:!0,maxRetryCount:2,fileChunkSize:3e5}},o={type:"TEXT",alwaysConnected:!0,replaceMimeTypes:!1,lang:"en_US",gesture:{enable:!0},export:{"image-resolution":300,jiix:{"bounding-box":!1,strokes:!1,text:{chars:!1,words:!0}}},renderer:{debug:{"draw-text-boxes":!1,"draw-image-boxes":!1}},math:{mimeTypes:["application/x-latex"],solver:{enable:!0,"fractional-part-digits":3,"decimal-separator":".","rounding-mode":"half up","angle-unit":"deg"},margin:{bottom:10,left:15,right:15,top:10},eraser:{"erase-precisely":!1},"undo-redo":{mode:"stroke"}},text:{guides:{enable:!0},mimeTypes:["text/plain"],margin:{top:20,left:10,right:10,bottom:10},eraser:{"erase-precisely":!1}},diagram:{mimeTypes:["application/vnd.myscript.jiix"],eraser:{"erase-precisely":!1}},rawContent:{mimeTypes:["application/vnd.myscript.jiix"],recognition:{text:!0,shape:!1},eraser:{"erase-precisely":!1}}},r={listenerOptions:{capture:!1,passive:!0},xyFloatPrecision:0,timestampFloatPrecision:0},s={minHeight:100,minWidth:100,smartGuide:{enable:!1,fadeOut:{enable:!1,duration:1e4}}},a={exportContent:"QUIET_PERIOD",exportContentDelay:1e3,resizeTriggerDelay:10},d={processDelay:10};class Configuration{constructor(e){this.events=JSON.parse(JSON.stringify(d)),this.grabber=JSON.parse(JSON.stringify(r)),this.recognition=JSON.parse(JSON.stringify(o)),this.rendering=JSON.parse(JSON.stringify(s)),this.server=JSON.parse(JSON.stringify(i)),this.triggers=JSON.parse(JSON.stringify(a)),this.overrideDefaultConfiguration(e)}mergeDeep(e,...t){const isObject=e=>e&&"object"==typeof e&&!Array.isArray(e);if(!t.length)return e;const n=t.shift();if(isObject(e)&&isObject(n))for(const t in n)isObject(n[t])?(e[t]||Object.assign(e,{[t]:{}}),this.mergeDeep(e[t],n[t])):Object.assign(e,{[t]:n[t]});return this.mergeDeep(e,...t)}overrideDefaultConfiguration(e){var t,n,l,c,h,p,u,m,g;e&&(this.events=this.mergeDeep({},d,null==e?void 0:e.events),this.grabber=this.mergeDeep({},r,null==e?void 0:e.grabber),this.recognition=this.mergeDeep({},o,null==e?void 0:e.recognition),this.rendering=this.mergeDeep({},s,null==e?void 0:e.rendering),this.server=this.mergeDeep({},i,null==e?void 0:e.server),this.triggers=this.mergeDeep({},a,null==e?void 0:e.triggers),(null===(t=this.server)||void 0===t?void 0:t.useWindowLocation)&&(this.server.scheme=window.location.protocol.indexOf("s")>-1?"https":"http",this.server.host=window.location.host),this.recognition.replaceMimeTypes&&(this.recognition.text.mimeTypes=(null===(l=null===(n=null==e?void 0:e.recognition)||void 0===n?void 0:n.text)||void 0===l?void 0:l.mimeTypes)||["application/vnd.myscript.jiix"],this.recognition.math.mimeTypes=(null===(h=null===(c=null==e?void 0:e.recognition)||void 0===c?void 0:c.math)||void 0===h?void 0:h.mimeTypes)||["application/vnd.myscript.jiix"],this.recognition.diagram.mimeTypes=(null===(u=null===(p=null==e?void 0:e.recognition)||void 0===p?void 0:p.diagram)||void 0===u?void 0:u.mimeTypes)||["application/vnd.myscript.jiix"],this.recognition.rawContent.mimeTypes=(null===(g=null===(m=null==e?void 0:e.recognition)||void 0===m?void 0:m.rawContent)||void 0===g?void 0:g.mimeTypes)||["application/vnd.myscript.jiix"])),"WEBSOCKET"===this.server.protocol&&"TEXT"===this.recognition.type?this.rendering.smartGuide.enable&&!this.recognition.text.mimeTypes.includes("application/vnd.myscript.jiix")&&this.recognition.text.mimeTypes.push("application/vnd.myscript.jiix"):this.rendering.smartGuide.enable=!1}}!function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}("/* @import url(../node_modules/perfect-scrollbar/css/perfect-scrollbar.css); */\n\n.ms-editor {\n    position: relative;\n    z-index: 20;\n    color: #1A9FFF;\n    font-family: sans-serif;\n}\n\n.ms-editor.erasing {\n    cursor: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEsSURBVDiNrdO7SgNBFMbx/3fmCbQ1tunDIayFBvFSKxbxBfSdBPEBtLIWb3Ebl4R9AQWLkE70CWbHZl1Eg2iSr5vL+c1hhhFTMhwOdyX1gQ2gVU+PgTyldNHtdq+/1+jroCiKtpmdSupNO6ApkgZmdtzpdJ5+QGVZ9qqqugSWfkO+5F3SnrvnDVQURTuE8PgP5DNvkjJ3fzaAEMLJDAjAclVVZwCqL/ZqBqSJme2YpMN5EIAYY9+A9XkhST0DVuaFgJYtAAGoDJgsAJoYkM+rSHqwlNL5Ajq6EMBoNLoBtmbsZuDumwYQYzwCXmdw3oAjAAPIsuxF0kG98GdE0r67PzcQgLvnIYQ14P4PyF39WZuH0rRdZVluxxj7kjaA1Xp6nFLKzezc3W+/13wAItdV6XjME1AAAAAASUVORK5CYII=') 10 10, auto;\n}\n\n.ms-editor canvas,\n.ms-editor svg {\n    z-index: 15;\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 100%;\n}\n\n.ms-editor canvas.ms-rendering-canvas {\n    z-index: 10;\n    pointer-events: none;\n    background-image: linear-gradient(to right, #F5F6F7 1px, transparent 1px),\n    linear-gradient(to bottom, #F5F6F7 1px, transparent 1px);\n    background-size: 18px 18px;\n}\n\n.ms-editor svg {\n    z-index: 10;\n    pointer-events: none;\n}\n.ms-editor svg[data-layer=\"BACKGROUND\"] {\n    z-index: 9;\n}\n\n.ms-editor .loader {\n    z-index: 30;\n    position: absolute;\n    width: 120px;\n    height: 120px;\n    top: calc(50% - 60px);\n    left: calc(50% - 60px);\n    border: 16px solid #F5F6F7;\n    border-radius: 50%;\n    border-top-color: #1A9FFF;\n    -webkit-animation: spin 2s linear infinite;\n    animation: spin 2s linear infinite;\n}\n\n.ms-editor .error-msg {\n    z-index: 25;\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    top: calc(50% - 100px);\n    left: calc(50% - 100px);\n    font-size: 16px;\n    text-align: center;\n    word-wrap: break-word;\n}\n\n.ms-editor .error-msg::before {\n    content: url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCA3Ni41IDYxMiA0NTkiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPgogICAgPHBhdGggZmlsbD0iIzFBOUZGRiIgZD0iTTQ5NC43LDIyOS41Yy0xNy44NTEtODYuNy05NC4zNTEtMTUzLTE4OC43LTE1M2MtMzguMjUsMC03My45NSwxMC4yLTEwMiwzMC42bDM4LjI1LDM4LjI1IGMxNy44NS0xMi43NSw0MC44LTE3Ljg1LDYzLjc1LTE3Ljg1Yzc2LjUsMCwxNDAuMjUsNjMuNzUsMTQwLjI1LDE0MC4yNXYxMi43NWgzOC4yNWM0My4zNSwwLDc2LjUsMzMuMTUsNzYuNSw3Ni41IGMwLDI4LjA1LTE1LjMsNTMuNTUtNDAuOCw2Ni4zbDM4LjI1LDM4LjI1QzU5MS42LDQzOC42LDYxMiw0MDAuMzUsNjEyLDM1N0M2MTIsMjkwLjcsNTU4LjQ1LDIzNC42LDQ5NC43LDIyOS41eiBNNzYuNSwxMDkuNjUgbDcxLjQsNjguODVDNjYuMywxODMuNiwwLDI0OS45LDAsMzMxLjVjMCw4NC4xNSw2OC44NSwxNTMsMTUzLDE1M2gyOTguMzVsNTEsNTFsMzMuMTUtMzMuMTVMMTA5LjY1LDc2LjVMNzYuNSwxMDkuNjV6IE0xOTYuMzUsMjI5LjVsMjA0LDIwNEgxNTNjLTU2LjEsMC0xMDItNDUuOS0xMDItMTAyYzAtNTYuMSw0NS45LTEwMiwxMDItMTAySDE5Ni4zNXoiIC8+Cjwvc3ZnPgo=);\n}\n\n.ms-editor .smartguide {\n    position: absolute;\n    z-index: 40;\n    font-size: 16px;\n}\n\n.ms-editor .smartguide.smartguide-in {\n    visibility: visible !important;\n    transition: opacity 0.5s;\n    opacity: 1;\n}\n\n.ms-editor .smartguide.smartguide-out {\n    transition: opacity 1s, visibility 1s;\n    visibility: hidden !important;\n    opacity: 0;\n}\n\n.ms-editor .smartguide .tag-icon {\n    padding: 0 18px;\n    border: 1px solid #959DA6;\n    font-weight: bold;\n    font-size: large;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 48px;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n}\n\n.ms-editor .smartguide .ellipsis {\n    cursor: pointer;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 31;\n    height: 48px;\n    line-height: 38px;\n    padding: 0 8px;\n    font-weight: bold;\n    font-size: x-large;\n    background-color: rgba(255, 255, 255, 0.9);\n    color: #959DA6;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .ellipsis:active {\n    background-color: #e0e0e0;\n}\n\n.ms-editor .smartguide .prompter-text-container {\n    background-color: rgba(255, 255, 255, 0.9);\n    height: 48px;\n    line-height: 48px;\n    overflow: hidden;\n    white-space: nowrap;\n    display: block;\n    text-align: left;\n    border-bottom: 1px solid #959DA6;\n    position: absolute;\n    z-index: 30;\n    color: #bfbfbf;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .prompter-text-container > div > span {\n    cursor: pointer;\n    display: inline-block;\n}\n\n.ms-editor .smartguide .prompter-text-container .prompter-text {\n    margin-left: 12px;\n}\n\n.ms-editor .smartguide .prompter-text-container .prompter-text .added-word {\n    animation: 0.1s linear word-added,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .prompter-text-container .prompter-text .modified-word {\n    animation: 0.1s linear word-modified,\n    3s ease-in-out color-input;\n}\n\n.ms-editor .smartguide .candidates {\n    color: black;\n    flex-direction: column;\n    text-align: center;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    box-shadow: 2px 2px 12px #BDBDBD, -2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n    z-index: 100;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .candidates > span {\n    cursor: pointer;\n    padding: 2px 20px;\n}\n\n.ms-editor .smartguide .candidates > span:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .candidates > span:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .candidates .selected-word {\n    font-weight: bold;\n    background-color: #E0E0E0;\n}\n\n.ms-editor .smartguide .more-menu {\n    flex-direction: column;\n    margin-right: 12px;\n    line-height: 30px;\n    border-radius: 3px;\n    position: absolute;\n    z-index: 100;\n    box-shadow: 2px 2px 12px #BDBDBD;\n    background-color: #F5F5F5;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button {\n    color: black;\n    font-size: 16px;\n    cursor: pointer;\n    box-sizing: border-box;\n    background: transparent;\n    border: none;\n    padding: 0 24px;\n    margin: 0;\n    height: 40px;\n    outline: none;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:hover {\n    background-color: #EEEEEE;\n}\n\n.ms-editor .smartguide .more-menu .options-label-button:active {\n    background-color: #E0E0E0;\n}\n\n.ms-editor .ps__rail-x {\n    top: 32px !important;\n}\n\n/** Stroke **/\n\n.ms-editor .removed-stroke {\n    opacity: 0;\n    transition: opacity 0.1s ease-in-out;\n}\n\n.ms-editor .added-stroke {\n    animation: 0.2s opacity-appear;\n}\n\n@keyframes color-input {\n    0% {\n        color: black;\n    }\n    100% {\n        color: #bfbfbf;\n    }\n}\n\n@keyframes word-added {\n    0% {\n        transform: translate(5px, 0);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes word-modified {\n    0% {\n        transform: translate(0, 5px);\n    }\n    100% {\n        transform: none;\n    }\n}\n\n@keyframes opacity-appear {\n    0% {\n        opacity: 0;\n    }\n    100% {\n        opacity : 1;\n    }\n}\n\n@keyframes spin {\n    0% {\n        transform: rotate(0deg);\n    }\n    100% {\n        transform: rotate(360deg);\n    }\n}\n\n@-webkit-keyframes spin {\n    0% {\n        -webkit-transform: rotate(0deg);\n    }\n    100% {\n        -webkit-transform: rotate(360deg);\n    }\n}\n");class Stroke{constructor(e,t,n="pen"){this.type="stroke",this.pointerId=t,this.pointerType=n,this.x=[],this.y=[],this.t=[],this.p=[],this.color=e.color,this.width=e.width,this["-myscript-pen-width"]=e["-myscript-pen-width"],this["-myscript-pen-fill-style"]=e["-myscript-pen-fill-style"],this["-myscript-pen-fill-color"]=e["-myscript-pen-fill-color"]}}class Model{constructor(e,t){this.rawStrokes=[],this.strokeGroups=[],this.lastPositions={lastSentPosition:-1,lastReceivedPosition:-1,lastRenderedPosition:-1},this.defaultSymbols=[],this.rawResults={convert:void 0,exports:void 0},this.creationTime=(new Date).getTime(),this.width=e,this.height=t}filterPointByAcquisitionDelta(e,t){const n=2+e["-myscript-pen-width"]/4;return 0===e.x.length||0===e.y.length||Math.abs(e.x[e.x.length-1]-t.x)>=n||Math.abs(e.y[e.y.length-1]-t.y)>=n}addPoint(e,t){this.filterPointByAcquisitionDelta(e,t)&&(e.x.push(t.x),e.y.push(t.y),e.t.push(t.t),e.p.push(t.p))}addStroke(e){this.rawStrokes.push(e)}extractPendingStrokes(e){return e=e||this.lastPositions.lastReceivedPosition+1,this.rawStrokes.slice(e)}addStrokeToGroup(e,t){const n=this.strokeGroups.length-1;if(this.strokeGroups[n]&&(i=this.strokeGroups[n].penStyle,o=t,i["-myscript-pen-fill-color"]===o["-myscript-pen-fill-color"]&&i["-myscript-pen-fill-style"]===o["-myscript-pen-fill-style"]&&i["-myscript-pen-width"]===o["-myscript-pen-width"]&&i.color===o.color&&i.width===o.width))this.strokeGroups[n].strokes.push(e);else{const n={penStyle:t,strokes:[e]};this.strokeGroups.push(n)}var i,o}initCurrentStroke(e,t,n,i,o=96){if(i["-myscript-pen-width"]){const e=i["-myscript-pen-width"]*o/25.4;i.width=e/2}this.currentStroke=new Stroke(i,t,n),this.addPoint(this.currentStroke,e)}appendToCurrentStroke(e){this.currentStroke&&this.addPoint(this.currentStroke,e)}endCurrentStroke(e,t){this.currentStroke&&(this.addPoint(this.currentStroke,e),this.addStroke(this.currentStroke),this.addStrokeToGroup(this.currentStroke,t),this.currentStroke=void 0)}clear(){this.currentStroke=void 0,this.rawStrokes=[],this.strokeGroups=[],this.lastPositions.lastSentPosition=-1,this.lastPositions.lastReceivedPosition=-1,this.lastPositions.lastRenderedPosition=-1,this.recognizedSymbols=void 0,this.exports=void 0,this.rawResults.convert=void 0,this.rawResults.exports=void 0}}const l={color:"#000000",width:0,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},c={ink:{color:"#000000",width:1,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},".math":{"font-family":"STIXGeneral"},".math-solved":{"font-family":"STIXGeneral",color:"#A8A8A8FF"},".text":{"font-family":"MyScriptInter","font-size":10}};class StyleManager{constructor(e,t){this.penStyle=this.overrideDefaultPenStyle(e),this.theme=this.overrideDefaultTheme(t)}overrideDefaultPenStyle(e){return Object.assign(Object.assign({},l),e||{})}overrideDefaultTheme(e){return Object.assign(Object.assign({},c),e||{})}}var h;!function(e){e.Mouse="mouse",e.Pen="pen",e.Touche="touch",e.Eraser="eraser"}(h||(h={}));e.Editor=class Editor{constructor(e,t){this.debug=!1,this._wrapperHTML=e,this._wrapperHTML.classList.add((null==t?void 0:t.globalClassCss)||"ms-editor"),this._loaderHTML=document.createElement("div"),this._loaderHTML.classList.add("loader"),this._loaderHTML=this._wrapperHTML.appendChild(this._loaderHTML),this._loaderHTML.style.display="initial",this._errorHTML=document.createElement("div"),this._errorHTML.classList.add("error-msg"),this._errorHTML=this._wrapperHTML.appendChild(this._errorHTML),this._errorHTML.style.display="none",this._mode=h.Pen,this.model=new Model(this._wrapperHTML.clientWidth,this._wrapperHTML.clientHeight),this._styleManager=new StyleManager(null==t?void 0:t.penStyle,null==t?void 0:t.theme),this._configuration=new Configuration(null==t?void 0:t.configuration),this._behaviorsManager=new BehaviorsManager(this.configuration,null==t?void 0:t.behaviors),this._behaviorsManager.init(this._wrapperHTML).then((()=>__awaiter(this,void 0,void 0,(function*(){this.grabber.onPointerDown=(e,t)=>this.pointerDown(e,t),this.grabber.onPointerMove=(e,t)=>this.pointerMove(e,t),this.grabber.onPointerUp=(e,t)=>this.pointerUp(e,t)})))).catch((e=>{this.showError(e)})).finally((()=>{this._loaderHTML.style.display="none"}))}get configuration(){return this._configuration}set configuration(e){this.clear(),this._configuration?this._configuration.overrideDefaultConfiguration(e):this._configuration=new Configuration(e)}get grabber(){return this._behaviorsManager.behaviors.grabber}get stroker(){return this._behaviorsManager.behaviors.stroker}get renderer(){return this._behaviorsManager.behaviors.renderer}get theme(){return this._styleManager.theme}get penStyle(){return this._styleManager.penStyle}get mode(){return this._mode}showError(e){if(this._errorHTML.style.display="initial",this._errorHTML.innerText=e.message,this.debug){const t=document.createElement("p");t.innerHTML=e.name,this._errorHTML.prepend(t);const n=document.createElement("p");n.style.width="50vw",n.style.marginLeft="calc(-25vw + 100px)",n.innerHTML=e.stack||"",this._errorHTML.appendChild(n)}}pointerDown(e,t){var n,i;const o=e.target;if((null==o?void 0:o.id)===this._wrapperHTML.id||(null===(n=null==o?void 0:o.classList)||void 0===n?void 0:n.contains("ms-canvas"))){let{pointerType:n}=e;this._mode===h.Eraser&&(n=h.Eraser);const o=Object.assign({},null===(i=this.theme)||void 0===i?void 0:i.ink,this.penStyle);this.model.initCurrentStroke(t,e.pointerId,n,o),this.renderer.drawCurrentStroke(this.model,this.stroker)}}pointerMove(e,t){this.model.appendToCurrentStroke(t),this.renderer.drawCurrentStroke(this.model,this.stroker)}pointerUp(e,t){this.model.endCurrentStroke(t,this.penStyle),this.renderer.drawModel(this.model,this.stroker)}setMode(e){this._mode=e,this._mode===h.Eraser?this._wrapperHTML.classList.add("erasing"):(document.body.style.cursor="initial",this._wrapperHTML.classList.remove("erasing"))}clear(){this.model.clear(),this.renderer.drawModel(this.model,this.stroker)}resize(){this.model.width=this._wrapperHTML.clientWidth,this.model.height=this._wrapperHTML.clientHeight,this.renderer.resize(this.model,this.stroker)}},e.getAvailableLanguageList=function getAvailableLanguageList(e){var t,n;return __awaiter(this,void 0,void 0,(function*(){if((null===(t=null==e?void 0:e.server)||void 0===t?void 0:t.scheme)&&(null===(n=null==e?void 0:e.server)||void 0===n?void 0:n.host)){const t=e.server;return(yield fetch(`${t.scheme}://${t.host}/api/v4.0/iink/availableLanguageList`)).json()}return Promise.reject("Cannot get languages ! Please check your server configuration!")}))},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=iink.min.js.map
