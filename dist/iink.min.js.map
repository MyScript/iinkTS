{"version":3,"file":"iink.min.js","sources":["../src/Constants.ts","../src/utils/DeferredPromise.ts","../src/utils/math.ts","../src/utils/geometry.ts","../src/utils/version.ts","../src/utils/crypto.ts","../src/utils/units.ts","../src/utils/uuid.ts","../src/utils/object.ts","../src/utils/language.ts","../src/utils/quadratics.ts","../src/utils/infos.ts","../src/logger/logger.ts","../src/logger/LoggerManager.ts","../src/logger/LoggerConfiguration.ts","../src/editor/EditorEvent.ts","../src/model/Export.ts","../src/editor/EditorLayer.ts","../src/editor/AbstractEditor.ts","../src/symbol/Box.ts","../src/style/Style.ts","../src/style/PenStyle.ts","../src/style/Theme.ts","../node_modules/json-css/lib/jsoncss.min.js","../src/style/StyleHelper.ts","../src/style/StyleManager.ts","../src/symbol/IIDecorator.ts","../src/symbol/Symbol.ts","../src/symbol/geometry/IIEdge.ts","../src/symbol/geometry/IIShape.ts","../src/symbol/recognized/IIRecognizedBase.ts","../src/transform/Matrix.ts","../src/symbol/IISymbolBase.ts","../src/symbol/Point.ts","../src/symbol/geometry/IIEdgeArc.ts","../src/symbol/geometry/IIEdgeLine.ts","../src/symbol/geometry/IIEdgePolyLine.ts","../src/symbol/geometry/IIShapeCircle.ts","../src/symbol/geometry/IIShapeEllipse.ts","../src/symbol/geometry/IIShapePolygon.ts","../src/symbol/IIStroke.ts","../src/symbol/recognized/IIRecognizedArc.ts","../src/symbol/recognized/IIRecognizedCircle.ts","../src/symbol/recognized/IIRecognizedEllipse.ts","../src/symbol/recognized/IIRecognizedLine.ts","../src/symbol/recognized/IIRecognizedPolyLine.ts","../src/symbol/recognized/IIRecognizedPolygon.ts","../src/symbol/recognized/IIRecognizedText.ts","../src/symbol/IISymbolGroup.ts","../src/symbol/IIText.ts","../src/symbol/IIEraser.ts","../src/symbol/Stroke.ts","../src/model/Model.ts","../src/model/IIModel.ts","../src/recognizer/ServerConfiguration.ts","../src/recognizer/recognition/EraserConfiguration.ts","../src/recognizer/recognition/DiagramConfiguration.ts","../src/recognizer/recognition/ExportConfiguration.ts","../src/recognizer/recognition/MarginConfiguration.ts","../src/recognizer/recognition/MathConfiguration.ts","../src/recognizer/recognition/RawContentConfiguration.ts","../src/recognizer/recognition/RecognitionRendererConfiguration.ts","../src/recognizer/recognition/TextConfiguration.ts","../src/recognizer/recognition/TextConfigurationV2.ts","../src/recognizer/recognition/ShapeConfiguration.ts","../src/recognizer/RecognizerEvent.ts","../src/recognizer/RecognizerError.ts","../src/recognizer/RecognizerHTTPV1Configuration.ts","../src/recognizer/RecognizerHTTPV1.ts","../src/recognizer/RecognizerHTTPV2Configuration.ts","../src/recognizer/RecognizerHTTPV2.ts","../src/recognizer/RecognizerWebSocketMessage.ts","../src/recognizer/RecognizerWebSocketConfiguration.ts","../src/recognizer/RecognizerWebSocket.ts","../src/recognizer/RecognizerWebSocketSSRConfiguration.ts","../src/recognizer/RecognizerWebSocketSSR.ts","../src/renderer/canvas/CanvasRendererShape.ts","../src/renderer/canvas/CanvasRendererStroke.ts","../src/renderer/canvas/CanvasRendererText.ts","../src/renderer/canvas/CanvasRenderer.ts","../src/renderer/svg/IISVGRendererConst.ts","../src/renderer/svg/SVGBuilder.ts","../src/renderer/svg/IISVGRendererEdgeUtil.ts","../src/renderer/svg/IISVGRendererEraserUtil.ts","../src/renderer/svg/IISVGRendererDecoratorUtil.ts","../src/renderer/svg/IISVGRendererShapeUtil.ts","../src/renderer/svg/IISVGRendererStrokeUtil.ts","../src/renderer/svg/IISVGRendererTextUtil.ts","../src/renderer/svg/IISVGRendererRecognizedUtil.ts","../src/renderer/svg/IISVGRendererGroupUtil.ts","../src/renderer/svg/IISVGRenderer.ts","../src/renderer/svg/SVGStroker.ts","../src/renderer/svg/InteractiveInkSSRSVGRenderer.ts","../src/renderer/RendererConfiguration.ts","../src/manager/IIConversionManager.ts","../src/manager/IIResizeManager.ts","../src/manager/IIRotationManager.ts","../src/grabber/GrabberConfiguration.ts","../src/grabber/PointerEventGrabber.ts","../src/manager/IISelectionManager.ts","../src/manager/IITextManager.ts","../src/manager/IITranslateManager.ts","../src/manager/IIWriteManager.ts","../src/manager/IIEraseManager.ts","../src/manager/IIDebugSVGManager.ts","../src/manager/IIMoveManager.ts","../src/history/HistoryContext.ts","../src/history/HistoryManager.ts","../src/history/IIHistoryManager.ts","../src/history/HistoryConfiguration.ts","../src/menu/IIMenu.ts","../src/gesture/Gesture.ts","../src/gesture/GestureConfiguration.ts","../src/gesture/IIGestureManager.ts","../src/menu/IIMenuSub.ts","../src/menu/IIMenuAction.ts","../src/menu/IIMenuTool.ts","../src/menu/IIMenuStyle.ts","../src/menu/IIMenuContext.ts","../src/menu/MenuConfiguration.ts","../src/menu/IIMenuManager.ts","../src/snap/IISnapConfiguration.ts","../src/snap/IISnapManager.ts","../src/editor/InteractiveInkEditorConfiguration.ts","../src/editor/InteractiveInkEditor.ts","../src/editor/EditorTriggerConfiguration.ts","../src/editor/InkEditorDeprecatedConfiguration.ts","../src/editor/InkEditorDeprecated.ts","../src/smartguide/InteractiveInkSSRSmartGuide.ts","../src/editor/InteractiveInkSSREditorConfiguration.ts","../src/editor/InteractiveInkSSREditor.ts","../src/editor/InkEditorConfiguration.ts","../src/editor/InkEditor.ts","../src/editor/Editor.ts","../src/recognizer/recognition/ConvertionConfiguration.ts","../src/utils/font.ts"],"sourcesContent":["/**\n * @group Editor\n * @summary\n * List the possibilities of interactions\n */\nexport enum EditorTool\n{\n  Write = \"write\",\n  Erase = \"erase\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Select = \"select\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Move = \"move\"\n}\n\n/**\n * @group Editor\n * @summary\n * List all the shapes that can be drawn\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum EditorWriteTool\n{\n  Pencil = \"pencil\",\n  Rectangle = \"rectangle\",\n  Rhombus = \"rhombus\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Line = \"line\",\n  Arrow = \"arrow\",\n  DoubleArrow = \"double-arrow\",\n}\n\n/**\n * @group Renderer\n * @summary\n * List all svg elements roles\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum SvgElementRole\n{\n  Guide = \"guide\",\n  InteractElementsGroup = \"interact-elements-group\",\n  Translate = \"translate\",\n  Resize = \"resize\",\n  Rotate = \"rotate\",\n}\n\n/**\n * @group Renderer\n * @summary\n * List all svg elements resize direction\n * @remarks\n * only usable in the case of offscreen\n */\nexport const enum ResizeDirection\n{\n  North = \"n-resize\",\n  East = \"e-resize\",\n  South = \"s-resize\",\n  West = \"w-resize\",\n  NorthEast = \"ne-resize\",\n  NorthWest = \"nw-resize\",\n  SouthEast = \"se-resize\",\n  SouthWest = \"sw-resize\"\n}\n\n/**\n * @group Renderer\n */\nexport const SELECTION_MARGIN = 10 as const\n","\n/**\n * @group Utils\n */\nexport class DeferredPromise<T> {\n  promise: Promise<T>\n  resolve!: (value: T) => void\n  reject!: (value: Error | string) => void\n\n  isFullFilled: boolean\n  isPending: boolean\n\n\n  constructor()\n  {\n    this.isFullFilled = false\n    this.isPending = true\n\n    this.promise = new Promise((resolve, reject) =>\n    {\n      this.reject = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return reject(v)\n      }\n      this.resolve = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return resolve(v as T)\n      }\n    })\n  }\n}\n","/**\n * @group Utils\n */\nexport function isValidNumber(x: unknown): boolean\n{\n  if (x === undefined || x === null) return false\n  return !isNaN(parseFloat(x.toString())) && isFinite(+x)\n}\n/**\n * @group Utils\n */\nexport function isBetween(val: number, min: number, max: number): boolean\n{\n  return val >= min && val <= max\n}\n\n/**\n * @group Utils\n */\nexport function computeAverage(arr: number[]): number\n{\n  return arr.reduce((p, c) => p + c, 0) / (arr.length || 1)\n}\n","import { TBox, TPoint, TSegment } from \"../symbol\"\nimport { isBetween } from \"./math\"\n\n/**\n * @group Utils\n */\nexport function computeDistance(p1: TPoint, p2: TPoint): number\n{\n  const distance = Math.hypot(p2.y - p1.y, p2.x - p1.x)\n  return isNaN(distance) ? 0 : distance\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleAxeRadian(begin: TPoint, end: TPoint): number\n{\n  return Math.atan2(end.y - begin.y, end.x - begin.x)\n}\n\n/**\n * @group Utils\n */\nexport function createPointsOnSegment(p1: TPoint, p2: TPoint, spaceBetweenPoint = 1): TPoint[]\n{\n  const points: TPoint[] = []\n  const globalDistance = computeDistance(p1, p2)\n  let spaceWithP1 = spaceBetweenPoint\n  while (spaceWithP1 < globalDistance) {\n    const p = {\n      x: p1.x + (spaceWithP1 * (p2.x - p1.x)) / globalDistance,\n      y: p1.y + (spaceWithP1 * (p2.y - p1.y)) / globalDistance\n    }\n    points.push(p)\n    spaceWithP1 += spaceBetweenPoint\n  }\n  return points\n}\n\n/**\n * @group Utils\n */\nexport function scalaire(v1: TPoint, v2: TPoint): number\n{\n  return v1.x * v2.x + v1.y * v2.y\n}\n\n/**\n * @group Utils\n */\nexport function computeNearestPointOnSegment(p: TPoint, seg: TSegment): TPoint\n{\n  const vectP1P = { x: p.x - seg.p1.x, y: p.y - seg.p1.y }\n  const vectP1P2 = { x: seg.p2.x - seg.p1.x, y: seg.p2.y - seg.p1.y }\n  if (vectP1P2.x === 0 && vectP1P2.y === 0) {\n    return seg.p1\n  }\n  const scalaireP1P_P1P2 = scalaire(vectP1P, vectP1P2)\n  const scalaireP1P2_P1P2 = scalaire(vectP1P2, vectP1P2)\n\n  const t = Math.min(1, Math.max(0, scalaireP1P_P1P2 / scalaireP1P2_P1P2))\n  return { x: seg.p1.x + (vectP1P2.x * t), y: seg.p1.y + (vectP1P2.y * t) }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsideBox(point: TPoint, box: TBox): boolean\n{\n  return isBetween(point.x, box.x, box.x + box.width) && isBetween(point.y, box.y, box.y + box.height)\n}\n\n/**\n * @group Utils\n */\nexport function convertRadianToDegree(radian: number): number\n{\n  return +((radian % (2 * Math.PI)) / Math.PI * 180).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function convertDegreeToRadian(degree: number): number\n{\n  return +((degree % 360) / 180 * Math.PI).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function computeRotatedPoint(point: TPoint, center: TPoint, radian: number): TPoint\n{\n  const dx = point.x - center.x\n  const dy = point.y - center.y\n  const cos = Math.cos(radian)\n  const sin = Math.sin(radian)\n  return {\n    x: +(center.x + cos * dx - sin * dy).toFixed(3),\n    y: +(center.y + sin * dx + cos * dy).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computePointOnEllipse(center: TPoint, radiusX: number, radiusY: number, phi: number, theta: number): TPoint\n{\n  const cosPhi = Math.cos(phi)\n  const sinPhi = Math.sin(phi)\n\n  const M = Math.abs(radiusX) * Math.cos(theta)\n  const N = Math.abs(radiusY) * Math.sin(theta)\n\n  return {\n    x: +(center.x + cosPhi * M - sinPhi * N).toFixed(3),\n    y: +(center.y + sinPhi * M + cosPhi * N).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computeDistanceBetweenPointAndSegment(p: TPoint, seg: TSegment): number\n{\n  return computeDistance(p, computeNearestPointOnSegment(p, seg))\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectionBetween2Segment(seg1: TSegment, seg2: TSegment): TPoint | undefined\n{\n\n  if (seg1.p1.x === seg2.p1.x && seg1.p1.y === seg2.p1.y) return seg1.p1\n  if (seg1.p1.x === seg2.p2.x && seg1.p1.y === seg2.p2.y) return seg1.p1\n\n  if (seg1.p2.x === seg2.p1.x && seg1.p2.y === seg2.p1.y) return seg1.p2\n  if (seg1.p2.x === seg2.p2.x && seg1.p2.y === seg2.p2.y) return seg1.p2\n\n  const S1dx = seg1.p2.x - seg1.p1.x\n  const S1dy = seg1.p2.y - seg1.p1.y\n\n  const S2dx = seg2.p2.x - seg2.p1.x\n  const S2dy = seg2.p2.y - seg2.p1.y\n\n  const S1S2dx = seg1.p1.x - seg2.p1.x\n  const S1S2dy = seg1.p1.y - seg2.p1.y\n\n  const ua_t = S2dx * S1S2dy - S2dy * S1S2dx\n  const ub_t = S1dx * S1S2dy - S1dy * S1S2dx\n  const u_b = S2dy * S1dx - S2dx * S1dy\n\n  if (ua_t === 0 || ub_t === 0 || u_b === 0) return\n\n  const ua = ua_t / u_b\n  const ub = ub_t / u_b\n  if (isBetween(ua, 0, 1) && isBetween(ub, 0, 1)) {\n    return {\n      x: seg1.p1.x + ua * S1dx,\n      y: seg1.p1.y + ua * S1dy\n    }\n  }\n  return\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectBetweenSegmentAndCircle(seg: TSegment, c: TPoint, r: number): TPoint[]\n{\n  const result: TPoint[] = []\n\n  const a = Math.pow(seg.p2.x - seg.p1.x, 2) + Math.pow(seg.p2.y - seg.p1.y, 2)\n  const b = 2 * ((seg.p2.x - seg.p1.x) * (seg.p1.x - c.x) + (seg.p2.y - seg.p1.y) * (seg.p1.y - c.y))\n  const cc = Math.pow(c.x, 2) + Math.pow(c.y, 2) + Math.pow(seg.p1.x, 2) + Math.pow(seg.p1.y, 2) - 2 * (c.x * seg.p1.x + c.y * seg.p1.y) - Math.pow(r, 2)\n  const deter = Math.pow(b, 2) - 4 * a * cc\n\n  if (deter <= 0) return []\n\n  const e = Math.sqrt(deter)\n  const u1 = (-b + e) / (2 * a)\n  const u2 = (-b - e) / (2 * a)\n\n  if ((u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1)) {\n    return result\n  }\n\n  if (isBetween(u1, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u1 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u1 + seg.p1.y\n    })\n  }\n\n  if (isBetween(u2, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u2 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u2 + seg.p1.y\n    })\n  }\n\n  return result\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleRadian(p1: TPoint, center: TPoint, p2: TPoint): number\n{\n  const p1c = Math.sqrt(Math.pow(center.x - p1.x, 2) + Math.pow(center.y - p1.y, 2))\n  const p2c = Math.sqrt(Math.pow(center.x - p2.x, 2) + Math.pow(center.y - p2.y, 2))\n  const p1p2 = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2))\n  return Math.acos((p2c * p2c + p1c * p1c - p1p2 * p1p2) / (2 * p2c * p1c))\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoints(points1: TPoint[], points2: TPoint[]): { p1: TPoint, p2: TPoint }\n{\n  let p1 = points1[0]\n  let p2 = points2[0]\n  let minDistance = Number.MAX_SAFE_INTEGER\n  points1.forEach(_p1 =>\n  {\n    points2.forEach(_p2 =>\n    {\n      const d = computeDistance(_p1, _p2)\n      if (minDistance > d) {\n        minDistance = d\n        p1 = _p1\n        p2 = _p2\n      }\n    })\n  })\n  return { p1, p2 }\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoint(points: TPoint[], point: TPoint): { point?: TPoint, index: number }\n{\n  let minDistance = Number.MAX_SAFE_INTEGER\n  let closest: TPoint | undefined\n  let index = -1\n  points.forEach((p, i) =>\n  {\n    const d = computeDistance(p, point)\n    if (minDistance > d) {\n      minDistance = d\n      closest = p\n      index = i\n    }\n  })\n  return {\n    point: closest,\n    index\n  }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsidePolygon(point: TPoint, points: TPoint[])\n{\n  let inside = false\n  for (let i = 0, j = points.length - 1; i < points.length; j = i++) {\n    const p1 = points[i]\n    const p2 = points[j]\n    const intersect = ((p1.y > point.y) != (p2.y > point.y))\n      && (point.x < (p2.x - p1.x) * (point.y - p1.y) / (p2.y - p1.y) + p1.x)\n    if (intersect) inside = !inside\n  }\n\n  return inside\n}\n","\n/**\n * @group Utils\n */\nexport const isVersionSuperiorOrEqual = (source: string, target: string): boolean =>\n{\n  const sourceParts = source.split(\".\")\n  const targetParts = target.split(\".\")\n\n  for (let i = 0; i < targetParts.length; i++) {\n    const a = Number(targetParts[i])\n    const b = Number(sourceParts[i])\n    if (a > b) return false\n    if (a < b) return true\n  }\n  return true\n}\n","/**\n * @group Utils\n */\nexport async function computeHmac(message: string, applicationKey: string, hmacKey: string): Promise<string>\n{\n  const enc = new TextEncoder()\n  const messageEncoded = enc.encode(message)\n  const keyEncoded = enc.encode(applicationKey + hmacKey)\n\n  const key = await crypto.subtle.importKey(\n    \"raw\",\n    keyEncoded,\n    {\n      name: \"HMAC\",\n      hash: { name: \"SHA-512\" }\n    },\n    false,\n    [\"sign\"]\n  )\n\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    key,\n    messageEncoded\n  )\n\n  const buffer = new Uint8Array(signature)\n  return Array.prototype.map.call(buffer, x => x.toString(16).padStart(2, \"0\")).join(\"\")\n}\n","import { TBox } from \"../symbol\"\n\n/**\n * @group Utils\n */\nexport function convertMillimeterToPixel(mm: number): number\n{\n  return +(mm * 96 / 25.4).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertPixelToMillimeter(px: number): number\n{\n  return +(px / 96 * 25.4).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertBoundingBoxMillimeterToPixel(box?: TBox): TBox\n{\n  if (!box) {\n    return { height: 0, width: 0, x: 0, y: 0}\n  }\n  return {\n    x: convertMillimeterToPixel(box.x),\n    y: convertMillimeterToPixel(box.y),\n    width: convertMillimeterToPixel(box.width),\n    height: convertMillimeterToPixel(box.height),\n  }\n}\n","\n/**\n * @group Utils\n */\nexport function createUUID(): string\n{\n  let dt = Date.now()\n  const uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c)\n  {\n    const r = (dt + Math.random() * 16) % 16 | 0\n    dt = Math.floor(dt / 16)\n    return (c == \"x\" ? r : (r & 0x3 | 0x8)).toString(16)\n  })\n  return uuid\n}\n","\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const mergeDeep = (target: any, ...sources: any[]): any =>\n{\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const isObject = (item: any) =>\n  {\n    return (item && typeof item === \"object\" && !Array.isArray(item))\n  }\n  if (!sources.length) return target\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, { [key]: {} })\n        }\n        mergeDeep(target[key], source[key])\n      }\n      else if (Array.isArray(target[key]) && Array.isArray(source[key])) {\n        target[key] = target[key].concat(source[key])\n      }\n      else {\n        Object.assign(target, { [key]: source[key] })\n      }\n    }\n  }\n  else if (Array.isArray(target) && Array.isArray(source)) {\n    target = target.concat(source)\n  }\n  else if (source) {\n    target = source\n  }\n\n  return mergeDeep(target, ...sources)\n}\n\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isDeepEqual = (object1: any, object2: any) =>\n{\n  const objKeys1 = Object.keys(object1)\n  const objKeys2 = Object.keys(object2)\n\n  if (objKeys1.length !== objKeys2.length) return false\n\n  for (const key of objKeys1) {\n    const value1 = object1[key]\n    const value2 = object2[key]\n\n    const isObjects = isObject(value1) && isObject(value2)\n\n    if (\n      (isObjects && !isDeepEqual(value1, value2)) ||\n      (!isObjects && value1 !== value2)\n    ) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst isObject = (object: any) =>\n{\n  return object && typeof object === \"object\"\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableLanguageList(configuration: PartialDeep<{ server: TServerHTTPConfiguration }>): Promise<{ result: { [key: string]: string } }>\n{\n  if (configuration?.server?.scheme && configuration?.server?.host) {\n    const serverConfig = configuration.server\n    const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/availableLanguageList`)\n    return response.json()\n  } else {\n    return Promise.reject(\"Failed to get languages: configuration.server.scheme & configuration.server.host are required!\")\n  }\n}\n","import { TPoint, TPointer } from \"../symbol\"\n\n/**\n * @group Utils\n */\nexport function computeLinksPointers(point: TPointer, angle: number, width: number): TPoint[]\n{\n  const radius = point.p * width\n  return [\n    {\n      x: +(point.x - (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y + (Math.cos(angle) * radius)).toFixed(3)\n    },\n    {\n      x: +(point.x + (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y - (Math.cos(angle) * radius)).toFixed(3),\n    }\n  ]\n}\n\n/**\n * @group Utils\n */\nexport function computeMiddlePointer(point1: TPointer, point2: TPointer): TPointer\n{\n  return {\n    x: +((point2.x + point1.x) / 2).toFixed(3),\n    y: +((point2.y + point1.y) / 2).toFixed(3),\n    p: +((point2.p + point1.p) / 2).toFixed(3),\n    t: +((point2.t + point1.t) / 2).toFixed(3),\n  }\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport type TApiInfos = {\n  version: string,\n  gitCommit: string,\n  nativeVersion: string\n}\n\n/**\n * @group Utils\n */\nexport async function getApiInfos(configuration?: PartialDeep<{ server: TServerHTTPConfiguration }>): Promise<TApiInfos>\n{\n  try {\n    if (!configuration?.server?.scheme && !configuration?.server?.host) {\n      return Promise.reject(\"Failed to get infos: configuration.server.scheme & configuration.server.host are required!\")\n    }\n    const response = await fetch(`${ configuration.server.scheme }://${ configuration.server.host }/api/v4.0/iink/version`)\n    if (response.ok) {\n      const version = await response.json() as TApiInfos\n      return version\n    }\n    else {\n      //latest version published before this endpoint\n      return { version: \"3.1.3\", gitCommit: \"unknown\", nativeVersion: \"<=3.1.1\" }\n    }\n\n  } catch {\n    //latest version published before this endpoint\n    return { version: \"3.1.3\", gitCommit: \"7e148bd566438ca77dc83cb4edcc6ed0f51a8a15\", nativeVersion: \"<=3.1.1\" }\n   }\n\n}\n","/**\n * @group Logger\n */\nexport enum LoggerLevel\n{\n  DEBUG = \"1\",\n  INFO = \"2\",\n  WARN = \"3\",\n  ERROR = \"4\"\n}\n\n/**\n * @group Logger\n */\nexport enum LoggerCategory\n{\n  EDITOR = \"EDITOR\",\n  RECOGNIZER = \"RECOGNIZER\",\n  GRABBER = \"GRABBER\",\n  GESTURE = \"GESTURE\",\n  EDITOR_EVENT = \"EDITOR_EVENT\",\n  MODEL = \"MODEL\",\n  RENDERER = \"RENDERER\",\n  SMARTGUIDE = \"SMARTGUIDE\",\n  STYLE = \"STYLE\",\n  HISTORY = \"HISTORY\",\n  SYMBOL = \"SYMBOL\",\n  WRITE = \"WRITE\",\n  TRANSFORMER = \"TRANSFORMER\",\n  CONVERTER = \"CONVERTER\",\n  SELECTION = \"SELECTION\",\n  SVGDEBUG = \"SVGDEBUG\",\n  MENU = \"MENU\"\n}\n\n/**\n * @group Logger\n */\nexport class Logger\n{\n  category: LoggerCategory\n  level: LoggerLevel\n\n  constructor(category: LoggerCategory, level: LoggerLevel)\n  {\n    this.category = category\n    this.level = level\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  debug(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.DEBUG >= this.level) {\n      const dataLog = {\n        level: \"debug\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.debug(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  info(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.INFO >= this.level) {\n      const dataLog = {\n        level: \"info\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.info(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  warn(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.WARN >= this.level) {\n      const dataLog = {\n        level: \"warn\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.warn(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  error(functionName: string, ...error: any)\n  {\n    const dataLog = {\n      level: \"error\",\n      from: `${ this.category }.${ functionName }`,\n      message: error,\n    }\n    console.error(dataLog)\n  }\n}\n","import { TLoggerConfiguration } from \"./LoggerConfiguration\"\nimport { Logger, LoggerCategory, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport class LoggerManager\n{\n  static #loggerMap: Map<LoggerCategory, Logger> = new Map()\n\n  static getLogger(name: LoggerCategory): Logger\n  {\n    if (!this.#loggerMap.has(name)) {\n      this.#loggerMap.set(name, new Logger(name, LoggerLevel.ERROR))\n    }\n    return this.#loggerMap.get(name) as Logger\n  }\n\n  static setLoggerLevel(config: TLoggerConfiguration)\n  {\n    Object.keys(config).forEach((lc) =>\n    {\n      LoggerManager.getLogger(lc as LoggerCategory).level = config[lc as LoggerCategory]\n    })\n  }\n}\n","import { LoggerCategory, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport type TLoggerConfiguration = {\n  [key in keyof typeof LoggerCategory]: LoggerLevel\n}\n\n/**\n * @group Logger\n * @source\n */\nexport const DefaultLoggerConfiguration: TLoggerConfiguration = {\n  [LoggerCategory.EDITOR]: LoggerLevel.ERROR,\n  [LoggerCategory.RECOGNIZER]: LoggerLevel.ERROR,\n  [LoggerCategory.GRABBER]: LoggerLevel.ERROR,\n  [LoggerCategory.RENDERER]: LoggerLevel.ERROR,\n  [LoggerCategory.EDITOR_EVENT]: LoggerLevel.ERROR,\n  [LoggerCategory.MODEL]: LoggerLevel.ERROR,\n  [LoggerCategory.SYMBOL]: LoggerLevel.ERROR,\n  [LoggerCategory.SMARTGUIDE]: LoggerLevel.ERROR,\n  [LoggerCategory.GESTURE]: LoggerLevel.ERROR,\n  [LoggerCategory.STYLE]: LoggerLevel.ERROR,\n  [LoggerCategory.HISTORY]: LoggerLevel.ERROR,\n  [LoggerCategory.TRANSFORMER]: LoggerLevel.ERROR,\n  [LoggerCategory.CONVERTER]: LoggerLevel.ERROR,\n  [LoggerCategory.WRITE]: LoggerLevel.ERROR,\n  [LoggerCategory.SELECTION]: LoggerLevel.ERROR,\n  [LoggerCategory.SVGDEBUG]: LoggerLevel.ERROR,\n  [LoggerCategory.MENU]: LoggerLevel.ERROR,\n}\n","import { EditorTool } from \"../Constants\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport { TExport } from \"../model\"\nimport { IIStroke, TIISymbol, TSymbol } from \"../symbol\"\nimport { THistoryContext } from \"../history\"\nimport { TGestureType } from \"../gesture\"\n\n/**\n * @group Editor\n * @remarks Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"EditorEventName\" raised by using\n * ```ts\n * editor.event.addEventListener(EditorEventName.CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum EditorEventName\n{\n  /**\n   * @remarks event emitted when history has changed i.e. the context of undo-redo\n   */\n  CHANGED = \"changed\",\n  /**\n   * @remarks event emitted when clearing is complete\n   */\n  CLEARED = \"cleared\",\n  /**\n   * @remarks event emitted after the conversion is complete\n   */\n  CONVERTED = \"converted\",\n  /**\n   * @remarks event emitted when the editor encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @remarks event emitted on click on pointer events\n   */\n  POINTEREVENTS = \"pointer_events\",\n  /**\n   * @remarks event emitted after\n   */\n  NOTIF = \"notif\",\n  /**\n   * @remarks event emitted after the end of the export\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @remarks event emitted after the end of the import\n   */\n  IMPORTED = \"imported\",\n  /**\n   * @remarks event emitted when the server is idle after a job\n   */\n  IDLE = \"idle\",\n  /**\n   * @remarks event emitted after full editor initialization\n   */\n  LOADED = \"loaded\",\n  /**\n   * @remarks event emitted session opened\n   */\n  SESSION_OPENED = \"session-opened\",\n  /**\n   * @remarks event emitted after selection change\n   */\n  SELECTED = \"selected\",\n  /**\n   * @remarks event emitted after tool change\n   */\n  TOOL_CHANGED = \"tool-changed\",\n  /**\n   * @remarks event emitted after mode change\n   */\n  UI_UPDATED = \"ui-updated\",\n  /**\n   * @remarks event emitted after stroke synchronized with jiix\n   */\n  SYNCHRONIZED = \"synchronized\",\n  /**\n   * @remarks event emitted after applying a gesture\n   */\n  GESTURED = \"gestured\"\n}\n\n/**\n * @group Editor\n */\nexport class EditorEvent extends EventTarget\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.EDITOR_EVENT);\n  protected abortController: AbortController\n  element: Element\n\n  constructor(element: Element)\n  {\n    super()\n    this.#logger.info(\"constructor\", { element })\n    this.abortController = new AbortController()\n    this.element = element\n  }\n\n  removeAllListeners(): void\n  {\n    this.#logger.info(\"removeAllListeners\")\n    this.abortController.abort()\n    this.abortController = new AbortController()\n  }\n\n  protected emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n    this.element?.dispatchEvent(evt)\n  }\n\n  emitSessionOpened(sessionId: string): void\n  {\n    this.#logger.info(\"emitSessionOpened\")\n    this.emit(EditorEventName.SESSION_OPENED, sessionId)\n  }\n  addSessionOpenedListener(callback: (sessionId: string) => void): void\n  {\n    this.#logger.info(\"addSessionOpenedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SESSION_OPENED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as string),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitLoaded(): void\n  {\n    this.#logger.info(\"emitLoaded\")\n    this.emit(EditorEventName.LOADED)\n  }\n  addLoadedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addLoadedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.LOADED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitNotif(notif: { message: string; timeout?: number }): void\n  {\n    this.#logger.info(\"emitNotif\", { notif })\n    this.emit(EditorEventName.NOTIF, notif)\n  }\n  addNotifListener(callback: (notif: { message: string; timeout?: number }) => void): void\n  {\n    this.#logger.info(\"addNotifListener\", { callback })\n    this.addEventListener(\n      EditorEventName.NOTIF,\n      (evt: unknown) => callback((evt as CustomEvent).detail as { message: string; timeout?: number }),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitError(err: Error): void\n  {\n    this.#logger.info(\"emitError\", { err })\n    this.emit(EditorEventName.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.#logger.info(\"addErrorListener\", { callback })\n    this.addEventListener(\n      EditorEventName.ERROR,\n      (evt: unknown) => callback((evt as CustomEvent).detail as Error),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitExported(exports: TExport): void\n  {\n    this.#logger.info(\"emitExported\", { exports })\n    this.emit(EditorEventName.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addExportedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.EXPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitChanged(undoRedoContext: THistoryContext): void\n  {\n    this.#logger.info(\"emitChanged\", { undoRedoContext })\n    this.emit(EditorEventName.CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n  addChangedListener(callback: (context: THistoryContext) => void): void\n  {\n    this.#logger.info(\"addChangedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as THistoryContext),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.#logger.info(\"emitIdle\", { idle })\n    this.emit(EditorEventName.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.#logger.info(\"addIdleListener\", { callback })\n    this.addEventListener(\n      EditorEventName.IDLE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as boolean),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitCleared(): void\n  {\n    this.#logger.info(\"emitCleared\")\n    this.emit(EditorEventName.CLEARED)\n  }\n  addClearedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addClearedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CLEARED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitConverted(exports: TExport): void\n  {\n    this.#logger.info(\"emitConverted\", { exports })\n    this.emit(EditorEventName.CONVERTED, exports)\n  }\n  addConvertedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addConvertedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CONVERTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitImported(exports: TExport): void\n  {\n    this.#logger.info(\"emitImported\", { exports })\n    this.emit(EditorEventName.IMPORTED, exports)\n  }\n  addImportedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addImportedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.IMPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSelected(symbols: TSymbol[]): void\n  {\n    this.#logger.info(\"emitSelected\")\n    this.emit(EditorEventName.SELECTED, symbols)\n  }\n  addSelectedListener(callback: (symbols: TIISymbol[]) => void): void\n  {\n    this.#logger.info(\"addSelectedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SELECTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TIISymbol[]),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitToolChanged(mode: EditorTool): void\n  {\n    this.#logger.info(\"emitToolChanged\")\n    this.emit(EditorEventName.TOOL_CHANGED, mode)\n  }\n  addToolChangedListener(callback: (mode: EditorTool) => void): void\n  {\n    this.#logger.info(\"addToolChangedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.TOOL_CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as EditorTool),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitUIpdated(): void\n  {\n    this.#logger.info(\"emitUIpdated\")\n    this.emit(EditorEventName.UI_UPDATED)\n  }\n  addUIpdatedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addUIpdatedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.UI_UPDATED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSynchronized(): void\n  {\n    this.#logger.info(\"emitSynchronized\")\n    this.emit(EditorEventName.SYNCHRONIZED)\n  }\n  addSynchronizedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addSynchronizedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SYNCHRONIZED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitGestured(gesture: { gestureType: TGestureType, stroke: IIStroke }): void\n  {\n    this.#logger.info(\"emitSynchronized\")\n    this.emit(EditorEventName.GESTURED, gesture)\n  }\n  addGesturedListener(callback: (gesture: { gestureType: TGestureType, stroke: IIStroke }) => void): void\n  {\n    this.#logger.info(\"addSynchronizedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.GESTURED,\n      (evt) => callback((evt as CustomEvent).detail as { gestureType: TGestureType, stroke: IIStroke }),\n      { signal: this.abortController.signal }\n    )\n  }\n}\n","import { EdgeDecoration, TBox, TPoint } from \"../symbol\"\n\n/**\n * @group Exports\n * @remarks List all supported MIME types for export. Please note, the MIME types supported depend on the recognition type configured\n */\nexport enum ExportType\n{\n  JIIX = \"application/vnd.myscript.jiix\",\n  TEXT = \"text/plain\",\n  LATEX = \"application/x-latex\",\n  MATHML = \"application/mathml+xml\",\n  SVG = \"image/svg+xml\",\n  OFFICE_DOCUMENT = \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix  Element type}\n */\nexport enum JIIXELementType\n{\n  Text = \"Text\",\n  Node = \"Node\",\n  Edge = \"Edge\",\n  RawContent = \"Raw Content\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#diagram-item-blocks | Element node kind}\n */\nexport enum JIIXNodeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Rectangle = \"rectangle\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Polygon = \"polygon\",\n  Rhombus = \"rhombus\",\n}\n\n/**\n * @group Exports\n */\nexport enum JIIXEdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#stroke-item | Stroke item}\n */\nexport type TJIIXStrokeItem = {\n  type: \"stroke\"\n  id: string\n  \"full-id\"?: string\n  timestamp?: string\n  X?: number[]\n  Y?: number[]\n  F?: number[]\n  T?: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXBase = {\n  \"bounding-box\"?: TBox\n  items?: TJIIXStrokeItem[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXElementBase<T = string> = TJIIXBase & {\n  id: string\n  type: T\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#word-object | Word object}\n */\nexport type TJIIXWord = TJIIXBase & {\n  id?: string\n  label: string\n  candidates?: string[]\n  \"first-char\"?: number\n  \"last-char\"?: number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#character-object | Character object}\n */\nexport type TJIIXChar = TJIIXBase & {\n  label: string\n  candidates?: string[]\n  word: number\n  grid: TPoint[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXLine = {\n  \"baseline-y\": number\n  \"first-char\"?: number\n  \"last-char\"?: number\n  \"x-height\": number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXTextElement = TJIIXElementBase<JIIXELementType.Text> & {\n  id: string\n  \"bounding-box\"?: TBox\n  label: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n  lines?: TJIIXLine[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Node> & {\n  id: string\n  kind: K\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeCircle = TJIIXNodeElementBase<JIIXNodeKind.Circle> & {\n  id: string\n  cx: number\n  cy: number\n  r: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeEllipse = TJIIXNodeElementBase<JIIXNodeKind.Ellipse> & {\n  id: string\n  cx: number\n  cy: number\n  rx: number\n  ry: number\n  orientation: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRectangle = TJIIXNodeElementBase<JIIXNodeKind.Rectangle> & {\n  id: string\n  height: number\n  width: number\n  x: number\n  y: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeTriangle = TJIIXNodeElementBase<JIIXNodeKind.Triangle> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeParrallelogram = TJIIXNodeElementBase<JIIXNodeKind.Parallelogram> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodePolygon = TJIIXNodeElementBase<JIIXNodeKind.Polygon> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRhombus = TJIIXNodeElementBase<JIIXNodeKind.Rhombus> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElement =\n  TJIIXNodeCircle |\n  TJIIXNodeEllipse |\n  TJIIXNodeRectangle |\n  TJIIXNodeTriangle |\n  TJIIXNodeParrallelogram |\n  TJIIXNodePolygon |\n  TJIIXNodeRhombus\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Edge> & {\n  kind: K\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#line-item | Element line}\n */\nexport type TJIIXEdgeLine = TJIIXEdgeElementBase<JIIXEdgeKind.Line> & {\n  x1: number\n  x2: number\n  y1: number\n  y2: number\n  p1Decoration?: EdgeDecoration\n  p2Decoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgePolyEdge = TJIIXEdgeElementBase<JIIXEdgeKind.PolyEdge> & {\n  edges: TJIIXEdgeLine[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix/#arc-item | Element arc}\n */\nexport type TJIIXEdgeArc = TJIIXEdgeElementBase<JIIXEdgeKind.Arc> & {\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  startAngle: number,\n  sweepAngle: number\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElement =\n  TJIIXEdgeLine |\n  TJIIXEdgePolyEdge |\n  TJIIXEdgeArc\n\n/**\n * @group Exports\n * @remarks {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/web/jiix | Exports}\n */\nexport type TJIIXElement =\n  TJIIXTextElement |\n  TJIIXNodeElement |\n  TJIIXEdgeElement\n\n/**\n * @group Exports\n */\nexport type TJIIXExport = {\n  type: string\n  id: string\n  \"bounding-box\"?: TBox\n  version: string\n  elements?: TJIIXElement[]\n  label?: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n}\n\n/**\n * @group Exports\n * @remarks\n * List all supported MIME types for export.\n *\n * Attention the MIME types supported depend on the {@link TRecognitionType | type of recognition}\n *\n * {@link https://developer.preprod.myscript.com/docs/interactive-ink/latest/reference/jiix | Documentation}\n */\nexport type TExport = {\n  /** @hidden */\n  [key: string]: unknown\n  /**\n   * @remarks vnd.myscript.jiix is used for text and raw-content exports\n   */\n  \"application/vnd.myscript.jiix\"?: TJIIXExport\n  /**\n   * @remarks text/plain is only use for text export\n   */\n  \"text/plain\"?: string\n  /**\n   * @remarks x-latex is only use for math export\n   * @see {@link https://katex.org/docs/browser.html | katex} to render\n   */\n  \"application/x-latex\"?: string\n  /**\n   * @remarks mathml+xml is only use for math export\n   * @see {@link https://www.w3.org/Math/whatIsMathML.html | Mathematical Markup Language}\n   */\n  \"application/mathml+xml\"?: string\n  /**\n   * @remarks svg+xml is only use for diagram export\n   */\n  \"image/svg+xml\"?: string\n  /**\n   * @remarks vnd.openxmlformats-officedocument.presentationml.presentation is only use for diagram export\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Blob | Blob}\n   */\n  \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"?: Blob\n}\n","\nimport style from \"../iink.css\"\n/**\n * @group Editor\n */\nexport type EditorLayerUIInfoModal = {\n  root: HTMLDivElement,\n  text: HTMLParagraphElement\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUIMessage = {\n  root: HTMLDivElement\n  overlay: HTMLDivElement\n  modal: EditorLayerUIInfoModal\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUIState = {\n  root: HTMLDivElement\n  busy: HTMLDivElement\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUI = {\n  root: HTMLDivElement\n  loader: HTMLDivElement\n  message: EditorLayerUIMessage\n  state: EditorLayerUIState\n}\n\n/**\n * @group Editor\n */\nexport class EditorLayer\n{\n  root: HTMLElement\n  ui: EditorLayerUI\n  rendering: HTMLElement\n\n  onCloseModal?: (inError?: boolean) => void\n\n  constructor(root: HTMLElement, rootClassCss: string = \"ms-editor\")\n  {\n    this.root = root\n    this.root.classList.add(rootClassCss)\n    this.rendering = this.createLayerRender()\n    this.ui = this.createLayerUI()\n  }\n\n  render(): void\n  {\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    this.root.prepend(styleElement)\n\n    this.root.appendChild(this.rendering)\n    this.root.appendChild(this.ui.root)\n  }\n\n  createLoader(): HTMLDivElement\n  {\n    const loaderHTML = document.createElement(\"div\")\n    loaderHTML.classList.add(\"loader\")\n    loaderHTML.style.display = \"none\"\n    return loaderHTML\n  }\n  showLoader(): void\n  {\n    this.ui.loader.style.display = \"block\"\n  }\n  hideLoader(): void\n  {\n    this.ui.loader.style.display = \"none\"\n  }\n\n  createMessageOverlay(): HTMLDivElement\n  {\n    const overlay = document.createElement(\"div\")\n    overlay.classList.add(\"message-overlay\")\n    return overlay\n  }\n  closeMessageModal(): void\n  {\n    this.onCloseModal?.(this.ui.message.modal.root.classList.contains(\"error-msg\"))\n    this.hideMessageModal()\n  }\n\n  hideMessageModal(): void\n  {\n    this.ui.message.root.style.display = \"none\"\n    this.ui.message.modal.text.innerText = \"\"\n    this.ui.message.modal.root.classList.remove(\"error-msg\")\n    this.ui.message.modal.root.classList.remove(\"info-msg\")\n  }\n  createMessageModal(): EditorLayerUIInfoModal\n  {\n    const element = document.createElement(\"div\")\n    element.classList.add(\"message-modal\")\n\n    const closeBtn = document.createElement(\"button\")\n    closeBtn.classList.add(\"ms-button\", \"close\")\n    closeBtn.addEventListener(\"pointerup\", this.closeMessageModal.bind(this))\n    element.appendChild(closeBtn)\n\n    const text = document.createElement(\"p\")\n    element.appendChild(text)\n    return { root: element, text }\n  }\n  createMessage(): EditorLayerUIMessage\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"message-container\")\n    root.style.display = \"none\"\n\n    const overlay = this.createMessageOverlay()\n    root.appendChild(overlay)\n\n    const modal = this.createMessageModal()\n    root.appendChild(modal.root)\n\n    return {\n      root,\n      overlay,\n      modal\n    }\n  }\n  showMessageInfo(notif: { message: string, timeout?: number })\n  {\n    this.ui.message.modal.root.classList.add(\"info-msg\")\n    this.ui.message.modal.root.classList.remove(\"error-msg\")\n    this.ui.message.root.style.display = \"block\"\n    this.ui.message.modal.text.innerText = notif.message\n    setTimeout(() =>\n    {\n      this.closeMessageModal()\n    }, notif.timeout || 2500)\n  }\n  showMessageError(err: Error | string)\n  {\n    this.ui.message.modal.root.classList.add(\"error-msg\")\n    this.ui.message.modal.root.classList.remove(\"info-msg\")\n    this.ui.message.root.style.display = \"block\"\n    this.ui.message.modal.text.innerText = typeof err === \"string\" ? err : err.message\n  }\n\n  createBusy(): HTMLDivElement\n  {\n    const busy = document.createElement(\"div\")\n    busy.classList.add(\"busy\")\n    return busy\n  }\n  createState(): EditorLayerUIState\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"state\")\n    root.style.display = \"none\"\n\n    const busy = this.createBusy()\n    root.appendChild(busy)\n\n    return {\n      root,\n      busy\n    }\n  }\n  showState(): void\n  {\n    this.ui.state.root.style.display = \"block\"\n  }\n  hideState(): void\n  {\n    this.ui.state.root.style.display = \"none\"\n  }\n  updateState(idle: boolean): void\n  {\n    if (idle) {\n      this.hideState()\n    }\n    else {\n      this.showState()\n    }\n  }\n\n  createLayerUI(): EditorLayerUI\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"ms-layer-ui\")\n\n    const loader = this.createLoader()\n    root.appendChild(loader)\n\n    const message = this.createMessage()\n    root.appendChild(message.root)\n\n    const state = this.createState()\n    root.appendChild(state.root)\n\n    return {\n      root,\n      loader,\n      message,\n      state\n    }\n  }\n\n  createLayerRender(): HTMLDivElement\n  {\n    const render = document.createElement(\"div\")\n    render.classList.add(\"ms-layer-rendering\")\n    return render\n  }\n\n  destroy(): void\n  {\n    while (this.root.lastChild) {\n      this.root.removeChild(this.root.lastChild)\n    }\n  }\n}\n","import { getApiInfos, PartialDeep, TApiInfos } from \"../utils\"\nimport {\n  LoggerCategory,\n  LoggerManager,\n  DefaultLoggerConfiguration,\n  TLoggerConfiguration\n} from \"../logger\"\nimport { TServerHTTPConfiguration } from \"../recognizer\"\nimport { EditorEvent } from \"./EditorEvent\"\nimport { EditorLayer } from \"./EditorLayer\"\n\n/**\n * @hidden\n * @group Editor\n */\nexport type TEditorConfiguration = {\n  logger: TLoggerConfiguration\n}\n\n/**\n * @group Editor\n * @remarks \"INKV1\" is deprecated use \"INKV2\" instead.\n */\nexport type EditorType = \"INTERACTIVEINK\" | \"INKV1\" | \"INTERACTIVEINKSSR\" | \"INKV2\"\n\n/**\n * @hidden\n * @group Editor\n */\nexport type EditorOptionsBase = {\n  configuration: TEditorConfiguration\n  override?: {\n    cssClass?: string\n  }\n}\n\n/**\n * @hidden\n * @group Editor\n */\nexport abstract class AbstractEditor\n{\n  logger = LoggerManager.getLogger(LoggerCategory.EDITOR)\n  layers: EditorLayer\n  event: EditorEvent\n  info?: TApiInfos\n\n  #loggerConfiguration!: TLoggerConfiguration\n\n  constructor(rootElement: HTMLElement, options?: PartialDeep<EditorOptionsBase>)\n  {\n    this.loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, options?.configuration?.logger)\n    this.logger.info(\"constructor\", { rootElement, options })\n\n    this.event = new EditorEvent(rootElement)\n    this.layers = new EditorLayer(rootElement, options?.override?.cssClass || \"ms-editor\")\n\n    //@ts-ignore\n    rootElement.editor = this\n  }\n\n  get loggerConfiguration(): TLoggerConfiguration\n  {\n    return this.#loggerConfiguration\n  }\n\n  set loggerConfiguration(loggerConfig: TLoggerConfiguration)\n  {\n    this.#loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, loggerConfig)\n    LoggerManager.setLoggerLevel(this.#loggerConfiguration)\n  }\n\n  abstract initialize(): Promise<void>\n\n  abstract clear(): Promise<void>\n\n  abstract destroy(): Promise<void>\n\n  async loadInfo(server: TServerHTTPConfiguration): Promise<TApiInfos>\n  {\n    if (!this.info) {\n      this.info = await getApiInfos({ server })\n    }\n    return this.info\n  }\n}\n","import { isBetween } from \"../utils\"\nimport { TPoint, TSegment } from \"./Point\"\n\n/**\n * @group Symbol\n */\nexport type TBox = {\n  x: number,\n  y: number,\n  width: number,\n  height: number\n}\n\n/**\n * @group Symbol\n */\nexport class Box implements TBox\n{\n  x: number\n  y: number\n  width: number\n  height: number\n\n  constructor(boundindBox: TBox)\n  {\n    if (boundindBox.width < 0) throw new Error(\"width must be positive\")\n    if (boundindBox.height < 0) throw new Error(\"height must be positive\")\n    this.height = boundindBox.height\n    this.width = boundindBox.width\n    this.x = boundindBox.x\n    this.y = boundindBox.y\n  }\n\n  static createFromBoxes(boxes: TBox[]): Box\n  {\n    if (!boxes?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    const x = Math.min(...boxes.map(b => b.x))\n    const width = Math.max(...boxes.map(b => b.x + b.width)) - x\n    const y = Math.min(...boxes.map(b => b.y))\n    const height = Math.max(...boxes.map(b => b.y + b.height)) - y\n    return new Box({ x, y, width, height })\n  }\n\n  static createFromPoints(points: TPoint[]): Box\n  {\n    if (!points?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    const x = Math.min(...points.map(p => p.x))\n    const width = Math.max(...points.map(p => p.x)) - x\n    const y = Math.min(...points.map(p => p.y))\n    const height = Math.max(...points.map(p => p.y)) - y\n    return new Box({ x, y, width, height })\n  }\n\n  static getCorners(box: TBox): TPoint[]\n  {\n    return [\n      { x: box.x, y: box.y },\n      { x: box.x + box.width, y: box.y },\n      { x: box.x + box.width, y: box.y + box.height },\n      { x: box.x, y: box.y + box.height }\n    ]\n  }\n\n  static getCenter(box: TBox): TPoint\n  {\n    return { x: box.x + box.width / 2, y: box.y + box.height / 2 }\n  }\n\n  static getSides(box: TBox): TSegment[]\n  {\n    const vertices = Box.getCorners(box)\n    return vertices.map((p, i) =>\n    {\n      if (i === 3) {\n        return { p1: vertices[0], p2: p }\n      }\n      else {\n        return { p1: p, p2: vertices[i + 1] }\n      }\n    })\n  }\n\n  static isContained(box: TBox, wrapper: TBox): boolean\n  {\n    return isBetween(box.x, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.x + box.width, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.y, wrapper.y, wrapper.y + wrapper.height) &&\n      isBetween(box.y + box.height, wrapper.y, wrapper.y + wrapper.height)\n  }\n\n  static containsPoint(box: TBox, point: TPoint): boolean\n  {\n    return isBetween(point.x, box.x, box.x + box.width) &&\n      isBetween(point.y, box.y, box.y + box.height)\n  }\n\n  static contains(box: TBox, child: TBox): boolean\n  {\n    return isBetween(child.x, box.x, box.x + box.width) &&\n      isBetween(child.x + child.width, box.x, box.x + box.width) &&\n      isBetween(child.y, box.y, box.y + box.height) &&\n      isBetween(child.y + child.height, box.y, box.y + box.height)\n  }\n\n  static overlaps(box1: TBox, box2: TBox): boolean\n  {\n    if (box1.x > box2.x + box2.width) return false\n    if (box1.x + box1.width < box2.x) return false\n    if (box1.y > box2.y + box2.height) return false\n    if (box1.y + box1.height < box2.y) return false\n\n    return true\n  }\n\n  get xMin(): number\n  {\n    return this.x\n  }\n\n  get xMid(): number\n  {\n    return this.x + this.width / 2\n  }\n\n  get xMax(): number\n  {\n    return this.x + this.width\n  }\n\n  get yMin(): number\n  {\n    return this.y\n  }\n\n  get yMid(): number\n  {\n    return this.y + this.height / 2\n  }\n\n  get yMax(): number\n  {\n    return this.y + this.height\n  }\n\n  get corners(): TPoint[]\n  {\n    return Box.getCorners(this)\n  }\n\n  get center(): TPoint\n  {\n    return Box.getCenter(this)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      ...this.corners,\n      this.center\n    ]\n  }\n\n  isContained(wrapper: TBox): boolean\n  {\n    return Box.isContained(this, wrapper)\n  }\n\n  contains(child: TBox): boolean\n  {\n    return Box.contains(this, child)\n  }\n\n  containsPoint(point: TPoint): boolean\n  {\n    return Box.containsPoint(this, point)\n  }\n\n  overlaps(boundaries: TBox): boolean\n  {\n    return Box.overlaps(this, boundaries)\n  }\n}\n","/**\n * @group Style\n * @property {String} color=#000000 Color (supported formats rgb() rgba() hsl() hsla() #rgb #rgba #rrggbb #rrggbbaa)\n * @property {String} width in px\n\n */\nexport type TStyle = {\n  [key: string]: string | number | undefined\n  width: number\n  color: string\n  opacity?: number\n  fill?: string\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultStyle: TStyle = {\n  width: 2,\n  color: \"#000000\",\n//   opacity: 1,\n//   fill: \"transparent\",\n} as const\n","import { PartialDeep } from \"../utils\"\nimport { TStyle } from \"./Style\"\n\n/**\n * @group Style\n * @property {String} -myscript-pen-width=1 Width of strokes and primitives in mm (no other unit is supported yet)\n * @property {String} -myscript-pen-fill-style=none\n * @property {String} -myscript-pen-fill-color=#FFFFFF00 Color filled inside the area delimited by strokes and primitives\n */\nexport type TPenStyle = PartialDeep<TStyle> & {\n  \"-myscript-pen-width\"?: number\n  \"-myscript-pen-fill-style\"?: string\n  \"-myscript-pen-fill-color\"?: string\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultPenStyle: TPenStyle = {\n}\n","import { TPenStyle } from \"./PenStyle\"\n\n/**\n * @group Style\n */\nexport type TThemeMath = {\n  \"font-family\": string\n}\n\n/**\n * @group Style\n */\nexport type TThemeMathSolved = {\n  \"font-family\": string\n  color: string\n}\n\n/**\n * @group Style\n */\nexport type TThemeText = {\n  \"font-family\": string,\n  \"font-size\": number\n}\n\n/**\n * @group Style\n */\nexport type TTheme = {\n  ink: TPenStyle\n  \".math\": TThemeMath\n  \".math-solved\": TThemeMathSolved\n  \".text\": TThemeText\n  [key: string]: unknown\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultTheme: TTheme = {\n  ink: {\n    color: \"#000000\",\n    width: 1,\n    \"-myscript-pen-width\": 1,\n    \"-myscript-pen-fill-style\": \"none\",\n    \"-myscript-pen-fill-color\": \"#FFFFFF00\"\n  },\n  \".math\": {\n    \"font-family\": \"STIXGeneral\"\n  },\n  \".math-solved\": {\n    \"font-family\": \"STIXGeneral\",\n    color: \"#A8A8A8FF\"\n  },\n  \".text\": {\n    \"font-family\": \"MyScriptInter\",\n    \"font-size\": 10\n  }\n}\n","!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.JsonCSS=e():t.JsonCSS=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,\"a\",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p=\"\",e(e.s=1)}([function(t,e,n){\"use strict\";function o(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(e,\"__esModule\",{value:!0});var r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},i=function t(e){var n=this;o(this,t),this.toJSON=function(t){if(\"string\"!=typeof t)return console.error(\"Need a CSS string but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid CSS..!\";var e={},o=void 0,i=void 0,u=void 0;try{t.split(\"{\").forEach(function(t){if(i=t.trim())if(-1===i.indexOf(\"}\"))e[i]={},o=i;else{i.substring(0,i.indexOf(\"}\")).split(\";\").forEach(function(t){(u=t.split(\":\"))&&2===u.length&&(e[o][u[0].trim().replace(/^\\\"|\\\"$/g,\"\")]=n._trimSemiColon(u[1].trim().replace(/^\\\"|\\\"$/g,\"\")))});try{o=i.split(\"}\")[1].trim(),o&&(e[o]={})}catch(t){}}})}catch(t){return\"Not a valid CSS..!\"}return e},this.toCSS=function(t){if(\"object\"!==(void 0===t?\"undefined\":r(t)))return console.error(\"Need a JSON object but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid JSON..!\";var e=\"\";try{for(var n in t)if(t.hasOwnProperty(n)){e+=n+\" {\\n\";for(var o in t[n])t[n].hasOwnProperty(o)&&(e+=o+\": \"+t[n][o]+\";\\n\");e+=\"}\\n\"}}catch(t){return\"Not a valid JSON..!\"}return e},this._trimSemiColon=function(t){return\";\"===t.slice(-1)?t.slice(0,n.length-1):t}};e.default=i},function(t,e,n){\"use strict\";t.exports=n(0).default}])});","import JsonCSS from \"json-css\"\nimport { TTheme } from \"./Theme\"\nimport { TPenStyle } from \"./PenStyle\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst parser: any = new JsonCSS()\n\n/**\n * @group Style\n */\nexport const StyleHelper = {\n  themeToCSS(json: TTheme): string\n  {\n    return parser.toCSS(json) as string\n    // css = css.replace( /[\\r\\n]+/gm, \"\" )\n    // return css\n  },\n  themeToJSON(style: string): TTheme\n  {\n    const theme = parser.toJSON(style) as TTheme\n    theme[\".text\"][\"font-size\"] = Number(theme[\".text\"][\"font-size\"])\n    theme.ink[\"-myscript-pen-width\"] = Number(theme.ink[\"-myscript-pen-width\"])\n    theme.ink.width = Number(theme.ink.width)\n    return theme\n  },\n  penStyleToCSS (penStyle: TPenStyle): string {\n    let css = parser.toCSS({ css: penStyle }) as string\n    css = css.substring(6, css.length - 3)\n    return css\n  },\n  penStyleToJSON (penStyleString: string): TPenStyle {\n    const penStyle = parser.toJSON(`css {${penStyleString}}`).css as TPenStyle\n    if (penStyle.width) {\n      penStyle.width = Number(penStyle.width)\n    } else {\n      delete penStyle.width\n    }\n    if (penStyle[\"-myscript-pen-width\"]) {\n      penStyle[\"-myscript-pen-width\"] = Number(penStyle[\"-myscript-pen-width\"])\n    } else {\n      delete penStyle[\"-myscript-pen-width\"]\n    }\n    return penStyle\n  },\n\n  stringToJSON(style: string): {[key: string]: string}\n  {\n    return parser.toJSON(`css {${style}}`).css\n  },\n  JSONToString(style: {[key: string]: string}): string\n  {\n    return Object.entries(style).map(([k, v]) => `${k}:${v}`).join(\";\")\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { DefaultPenStyle, TPenStyle } from \"./PenStyle\"\nimport { DefaultTheme, TTheme } from \"./Theme\"\n\n/**\n * @group Style\n */\nexport class StyleManager\n{\n  #penStyle!: TPenStyle\n  #theme!: TTheme\n  #penStyleClasses!: string\n  #currentPenStyle!: TPenStyle\n  #logger =  LoggerManager.getLogger(LoggerCategory.STYLE)\n\n  constructor(penStyle?: PartialDeep<TPenStyle>, theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"constructor\", { penStyle, theme })\n    this.setTheme(theme)\n    this.setPenStyleClasses()\n    this.setPenStyle(penStyle)\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.#currentPenStyle || this.#penStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.#penStyle\n  }\n  setPenStyle(style?: PartialDeep<TPenStyle>)\n  {\n    this.#logger.info(\"setPenStyle\", { style })\n    this.#penStyle = mergeDeep(structuredClone(DefaultPenStyle), style || {}) as TPenStyle\n    this.#currentPenStyle = style || (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyle\", this.#currentPenStyle)\n  }\n\n  get theme(): TTheme\n  {\n    return this.#theme\n  }\n  setTheme(theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.#theme = mergeDeep(structuredClone(DefaultTheme), theme || {}) as TTheme\n    this.#logger.debug(\"setTheme\", this.#theme)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.#penStyleClasses\n  }\n  setPenStyleClasses(penStyleClass = \"\")\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClass })\n    this.#penStyleClasses = penStyleClass\n    this.#currentPenStyle = (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyleClasses\", this.#currentPenStyle)\n  }\n\n}\n","import { createUUID, mergeDeep, PartialDeep } from \"../utils\"\nimport { DefaultStyle, TStyle } from \"../style\"\n\n/**\n * @group Symbol\n */\nexport enum DecoratorKind\n{\n  Highlight = \"highlight\",\n  Surround = \"surround\",\n  Underline = \"underline\",\n  Strikethrough = \"strikethrough\",\n}\n\n/**\n * @group Symbol\n */\nexport class IIDecorator\n{\n  id: string\n  kind: DecoratorKind\n  style: TStyle\n\n  constructor(kind: DecoratorKind, style: PartialDeep<TStyle>)\n  {\n    this.id = `${ kind }-${ createUUID() }`\n    this.style = structuredClone(mergeDeep({}, DefaultStyle ,style))\n    this.kind = kind\n  }\n\n  clone(): IIDecorator\n  {\n    const clone = new IIDecorator(this.kind, structuredClone(this.style))\n    clone.id = this.id\n    return clone\n  }\n\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\n\n/**\n * @group Symbol\n */\nexport enum SymbolType\n{\n  Stroke = \"stroke\",\n  Group = \"group\",\n  Shape = \"shape\",\n  Edge = \"edge\",\n  Text = \"text\",\n  Eraser = \"eraser\",\n  Recognized = \"recognized\"\n}\n\n/**\n * @group Symbol\n */\nexport interface TSymbol {\n  id: string\n  creationTime: number\n  modificationDate: number\n  type: string\n  style: PartialDeep<TStyle>\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum EdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Symbol\n */\nexport enum EdgeDecoration\n{\n  Arrow = \"arrow-head\"\n}\n\n/**\n * @group Symbol\n */\nexport abstract class OIEdgeBase<K = EdgeKind> extends IISymbolBase<SymbolType.Edge>\n{\n  readonly kind: K\n  readonly isClosed = false\n\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n\n  constructor(\n    kind: K,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Edge, style)\n    this.kind = kind\n\n    this.startDecoration = startDecoration\n    this.endDecoration = endDecoration\n  }\n\n  abstract get vertices(): TPoint[]\n\n  get bounds(): Box\n  {\n    const bb = Box.createFromPoints(this.vertices)\n    bb.x -= SELECTION_MARGIN / 2\n    bb.y -= SELECTION_MARGIN / 2\n    bb.height += SELECTION_MARGIN\n    bb.width += SELECTION_MARGIN\n    if (this.startDecoration || this.endDecoration) {\n      bb.x -= ((this.style.width || 1) * 2.5)\n      bb.y -= ((this.style.width || 1) * 2.5)\n      bb.height += ((this.style.width || 1) * 5)\n      bb.width += ((this.style.width || 1) * 5)\n    }\n    return bb\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.vertices\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  abstract clone(): OIEdgeBase\n}\n","import { TStyle } from \"../../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum ShapeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygon = \"polygon\",\n  Table = \"table\"\n}\n\n/**\n * @group Symbol\n */\nexport abstract class OIShapeBase<K = ShapeKind> extends IISymbolBase<SymbolType.Shape>\n{\n  readonly kind: K\n  readonly isClosed = true\n\n  constructor(kind: K, style?: PartialDeep<TStyle>)\n  {\n    super(SymbolType.Shape, style)\n    this.kind = kind\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IIStroke } from \"../IIStroke\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum RecognizedKind\n{\n  Text = \"text\",\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygone = \"polygone\",\n}\n\n/**\n * @group Symbol\n */\nexport abstract class IIRecognizedBase<K = RecognizedKind> extends IISymbolBase<SymbolType.Recognized>\n{\n  readonly kind: K\n\n  strokes: IIStroke[]\n\n  constructor(\n    kind: K,\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Recognized, style)\n    this.kind = kind\n    this.strokes = strokes\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.strokes.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.strokes.map(c => c.bounds))\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.strokes.forEach(child => child.style = Object.assign({}, child.style, this.style))\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.strokes.some(s => s.overlaps(box))\n  }\n\n  containsStroke(strokeId: string): boolean\n  {\n    return this.strokes.some(s => s.id === strokeId)\n  }\n\n  removeStrokes(strokeIds: string[]): IIStroke[]\n  {\n    const strokeRemoved = this.strokes.filter(s => strokeIds.includes(s.id))\n    this.strokes = this.strokes.filter(s => !strokeIds.includes(s.id))\n    return strokeRemoved\n  }\n}\n","import { TPoint } from \"../symbol\"\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport type TMatrixTransform = {\n  /**\n   * @remarks scaling x\n   */\n  xx: number,\n  /**\n   * @remarks shearing x\n   */\n  yx: number,\n  /**\n   * @remarks translation x\n   */\n  tx: number,\n  /**\n   * @remarks shearing y\n   */\n  xy: number,\n  /**\n   * @remarks scaling y\n   */\n  yy: number,\n  /**\n   * @remarks translation y\n   */\n  ty: number,\n}\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport class MatrixTransform implements TMatrixTransform\n{\n  xx: number\n  yx: number\n  xy: number\n  yy: number\n  tx: number\n  ty: number\n\n  constructor(xx: number, yx: number, xy: number, yy: number, tx: number, ty: number)\n  {\n    this.xx = xx\n    this.yx = yx\n    this.xy = xy\n    this.yy = yy\n    this.tx = tx\n    this.ty = ty\n  }\n\n  static identity(): MatrixTransform\n  {\n    return new MatrixTransform(1, 0, 0, 1, 0, 0)\n  }\n\n  static applyToPoint(mat: TMatrixTransform, point: TPoint): TPoint\n  {\n    return {\n      x: mat.xx * point.x + mat.xy * point.y + mat.tx,\n      y: mat.yx * point.x + mat.yy * point.y + mat.ty,\n    }\n  }\n\n  static rotation(mat: TMatrixTransform): number\n  {\n    let rotation\n\n    if (mat.xx !== 0 || mat.xy !== 0) {\n      const hypotAc = Math.hypot(mat.xx, mat.xy)\n      rotation = Math.acos(mat.xx / hypotAc) * (mat.xy > 0 ? -1 : 1)\n    } else if (mat.yx !== 0 || mat.yy !== 0) {\n      const hypotBd = Math.hypot(mat.yx, mat.yy)\n      rotation = Math.PI / 2 + Math.acos(mat.yx / hypotBd) * (mat.yy > 0 ? -1 : 1)\n    } else {\n      rotation = 0\n    }\n\n    return rotation\n  }\n\n  static toCssString(matrix: TMatrixTransform): string\n  {\n    return `matrix(${ matrix.xx }, ${ matrix.yx }, ${ matrix.xy }, ${ matrix.yy }, ${ matrix.tx }, ${ matrix.ty })`\n  }\n\n\tinvert() {\n\t\tconst { xx, yx, xy, yy, tx, ty } = this\n\t\tconst denom = xx * yy - yx * xy\n\t\tthis.xx = yy / denom\n\t\tthis.yx = yx / -denom\n\t\tthis.xy = xy / -denom\n\t\tthis.yy = xx / denom\n\t\tthis.tx = (yy * tx - xy * ty) / -denom\n\t\tthis.ty = (yx * tx - xx * ty) / denom\n\t\treturn this\n\t}\n\n  multiply(m: TMatrixTransform): MatrixTransform\n  {\n    const { xx, yx, xy, yy, tx, ty } = this\n    this.xx = xx * m.xx + xy * m.yx\n    this.yx = yx * m.xx + yy * m.yx\n    this.xy = xx * m.xy + xy * m.yy\n    this.yy = yx * m.xy + yy * m.yy\n    this.tx = xx * m.tx + xy * m.ty + tx\n    this.ty = yx * m.tx + yy * m.ty + ty\n    return this\n  }\n\n  translate(tx: number, ty: number): MatrixTransform\n  {\n    return this.multiply({ xx: 1, yx: 0, xy: 0, yy: 1, tx, ty })\n  }\n\n  rotate(radian: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    const cosAngle = Math.round(Math.cos(radian) * 1000) / 1000\n    const sinAngle = Math.round(Math.sin(radian) * 1000) / 1000\n    this.multiply({\n      xx: cosAngle,\n      yx: sinAngle,\n      xy: -sinAngle,\n      yy: cosAngle,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  scale(x: number, y: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    this.multiply({\n      xx: x,\n      yx: 0,\n      xy: 0,\n      yy: y,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  applyToPoint(point: TPoint): TPoint\n  {\n    return MatrixTransform.applyToPoint(this, point)\n  }\n\n  clone(): MatrixTransform\n  {\n    return new MatrixTransform(this.xx, this.yx, this.xy, this.yy, this.tx, this.ty)\n  }\n\n  toCssString(): string\n  {\n    return MatrixTransform.toCssString(this)\n  }\n\n}\n","import { PartialDeep, createUUID, findIntersectionBetween2Segment } from \"../utils\"\nimport { TBox } from \"./Box\"\nimport { TPoint, TSegment } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { MatrixTransform } from \"../transform\"\n\n/**\n * @group Symbol\n */\nexport abstract class IISymbolBase<T extends string = SymbolType> implements TSymbol\n{\n  readonly type: T\n  abstract readonly isClosed: boolean\n  style: TStyle\n\n  id: string\n  creationTime: number\n  modificationDate: number\n  selected: boolean\n  deleting: boolean\n  transform: MatrixTransform\n\n  constructor(type: T, style?: PartialDeep<TStyle>)\n  {\n    this.type = type\n    this.id = `${ this.type }-${ createUUID() }`\n\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.selected = false\n    this.deleting = false\n\n    this.transform = MatrixTransform.identity()\n\n    this.style = Object.assign({}, DefaultStyle, style)\n    if (this.style.opacity) {\n      this.style.opacity = +this.style.opacity\n    }\n    this.style.width = +this.style.width\n  }\n\n  abstract get vertices(): TPoint[]\n\n  abstract get snapPoints(): TPoint[]\n\n  get edges(): TSegment[]\n  {\n    if (this.isClosed) {\n      return this.vertices.map((p, i) =>\n      {\n        if (i === this.vertices.length - 1) {\n          return { p1: p, p2: this.vertices[0] }\n        }\n        else {\n          return { p1: p, p2: this.vertices[i + 1] }\n        }\n      })\n    }\n    else {\n      return this.vertices.slice(0, -1).map((p, i) =>\n      {\n        return { p1: p, p2: this.vertices[i + 1] }\n      })\n    }\n  }\n\n  abstract overlaps(box: TBox): boolean\n\n  abstract clone(): IISymbolBase\n\n  abstract toJSON(): PartialDeep<IISymbolBase>\n\n  isIntersected(seg: TSegment): boolean\n  {\n    return this.edges.some(edge =>\n    {\n      return findIntersectionBetween2Segment(edge, seg)\n    })\n  }\n}\n","import { PartialDeep, isValidNumber } from \"../utils\"\n\n/**\n * @group Symbol\n */\nexport type TPoint = {\n  x: number\n  y: number\n}\n\n/**\n * @group Symbol\n */\nexport type TPointer = TPoint & {\n  t: number\n  p: number\n}\n\n/**\n * @group Symbol\n */\nexport type TSegment = {\n  p1: TPoint\n  p2: TPoint\n}\n\n/**\n * @group Symbol\n */\nexport function isValidPoint(p?: PartialDeep<TPoint>): boolean\n{\n  if (!p) return false\n  if (!isValidNumber(p.x)) return false\n  if (!isValidNumber(p.y)) return false\n  return true\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, computePointOnEllipse, isValidNumber } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgeArc extends OIEdgeBase<EdgeKind.Arc>\n{\n  center: TPoint\n  startAngle: number\n  sweepAngle: number\n  radiusX: number\n  radiusY: number\n  phi: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    startAngle: number,\n    sweepAngle: number,\n    radiusX: number,\n    radiusY: number,\n    phi: number,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>,\n  )\n  {\n    super(EdgeKind.Arc, startDecoration, endDecoration, style)\n    this.center = center\n    this.startAngle = startAngle\n    this.sweepAngle = sweepAngle\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.phi = phi\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.startAngle }-${ this.sweepAngle }-${ this.radiusX }-${ this.radiusY }-${ this.phi }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const length = Math.abs(this.sweepAngle) * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbVertices = Math.max(8, Math.round(length / SELECTION_MARGIN))\n    const angleStep = this.sweepAngle / nbVertices\n    const v: TPoint[] = []\n    const endAngle = this.startAngle + this.sweepAngle\n    if (this.sweepAngle > 0) {\n      for (let angle = this.startAngle; angle < endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    } else {\n      for (let angle = this.startAngle; angle > endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    }\n    v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, endAngle))\n    return v\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      this.vertices[0],\n      this.vertices.at(-1)!\n    ]\n  }\n\n  clone(): IIEdgeArc\n  {\n    const clone = new IIEdgeArc(\n      structuredClone(this.center),\n      this.startAngle,\n      this.sweepAngle,\n      this.radiusX,\n      this.radiusY,\n      this.phi,\n      this.startDecoration,\n      this.endDecoration,\n      structuredClone(this.style)\n    )\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgeArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      startAngle: this.startAngle,\n      sweepAngle: this.sweepAngle,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      phi: this.phi,\n      startDecoration: this.startDecoration,\n      style: this.style,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgeArc>): IIEdgeArc\n  {\n    if (!isValidPoint(partial?.center)) throw new Error(`Unable to create a arc, center point is invalid`)\n    if (!isValidNumber(partial?.startAngle)) throw new Error(`Unable to create a arc, startAngle is invalid`)\n    if (!isValidNumber(partial?.sweepAngle)) throw new Error(`Unable to create a arc, sweepAngle is invalid`)\n    if (!isValidNumber(partial?.radiusX)) throw new Error(`Unable to create a arc, radiusX is invalid`)\n    if (!isValidNumber(partial?.radiusY)) throw new Error(`Unable to create a arc, radiusY is invalid`)\n    const arc = new IIEdgeArc(\n      partial?.center as TPoint,\n      partial.startAngle!,\n      partial.sweepAngle!,\n      partial.radiusX!,\n      partial.radiusY!,\n      partial.phi || 0,\n      partial.startDecoration,\n      partial.endDecoration,\n      partial.style\n    )\n    if (partial.id) {\n      arc.id = partial.id\n    }\n    return arc\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgeLine extends OIEdgeBase<EdgeKind.Line>\n{\n  start: TPoint\n  end: TPoint\n\n  constructor(\n    start: TPoint,\n    end: TPoint,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.Line, startDecoration, endDecoration, style)\n    this.start = start\n    this.end = end\n  }\n\n  get vertices(): TPoint[]\n  {\n    return [\n      this.start,\n      this.end\n    ]\n  }\n\n  clone(): IIEdgeLine\n  {\n    const clone = new IIEdgeLine(structuredClone(this.start), structuredClone(this.end), this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgeLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      start: this.start,\n      end: this.end,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgeLine>): IIEdgeLine\n  {\n    if (!isValidPoint(partial?.start)) throw new Error(`Unable to create a arc, start point is invalid`)\n    if (!isValidPoint(partial?.end)) throw new Error(`Unable to create a arc, end point is invalid`)\n    const line = new IIEdgeLine(partial?.start as TPoint, partial?.end as TPoint, partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      line.id = partial.id\n    }\n    return line\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgePolyLine extends OIEdgeBase<EdgeKind.PolyEdge>\n{\n  points: TPoint[]\n\n  constructor(\n    points: TPoint[],\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.PolyEdge, startDecoration, endDecoration, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  clone(): IIEdgePolyLine\n  {\n    const clone = new IIEdgePolyLine(structuredClone(this.points),this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgePolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgePolyLine>): IIEdgePolyLine\n  {\n    if (!partial?.points?.map(p => isValidPoint(p))) throw new Error(`Unable to create a PolyLine, points are invalid`)\n    const polyline = new IIEdgePolyLine(partial?.points as TPoint[], partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      polyline.id = partial.id\n    }\n    return polyline\n  }\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, findIntersectBetweenSegmentAndCircle, isValidNumber, computeRotatedPoint } from \"../../utils\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box, TBox } from \"../Box\"\n\n/**\n * @group Symbol\n */\nexport class IIShapeCircle extends OIShapeBase<ShapeKind.Circle>\n{\n  center: TPoint\n  radius: number\n  protected _vertices: Map<string, TPoint[]>\n  protected _bounds: Map<string, Box>\n\n  constructor(\n    center: TPoint,\n    radius: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Circle, style)\n    this.center = center\n    this.radius = radius\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n    this._bounds = new Map<string, Box>()\n    this._bounds.set(this.verticesId, this.computedBondingBox())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radius }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const firstPoint: TPoint = {\n      x: this.center.x,\n      y: this.radius + this.center.y\n    }\n    const perimeter = 2 * Math.PI * this.radius\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    const points: TPoint[] = []\n    for (let i = 0; i < nbPoint; i++) {\n      const rad = 2 * Math.PI * (i / nbPoint)\n      points.push(computeRotatedPoint(firstPoint, this.center, rad))\n    }\n    return points\n  }\n\n  protected computedBondingBox(): Box\n  {\n    const boundingBox: TBox = {\n      x: this.center.x - this.radius,\n      y: this.center.y - this.radius,\n      height: this.radius * 2,\n      width: this.radius * 2\n    }\n    return new Box(boundingBox)\n  }\n\n  get bounds(): Box\n  {\n    if (!this._bounds.has(this.verticesId)) {\n      this._bounds.set(this.verticesId, this.computedBondingBox())\n    }\n    return this._bounds.get(this.verticesId)!\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      Box.getSides(box).some(seg => findIntersectBetweenSegmentAndCircle(seg, this.center, this.radius).length)\n  }\n\n  clone(): IIShapeCircle\n  {\n    const clone = new IIShapeCircle(structuredClone(this.center), this.radius, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapeCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      radius: this.radius,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapeCircle\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    const radius = Math.min(width, height) / 2\n    return new IIShapeCircle(center, radius, style)\n  }\n\n  static updateBetweenPoints(circle: IIShapeCircle, origin: TPoint, target: TPoint): IIShapeCircle\n  {\n    circle.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    circle.radius = Math.min(width, height) / 2\n    return circle\n  }\n\n  static create(partial: PartialDeep<IIShapeCircle>): IIShapeCircle\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create circle, center is invalid`)\n    if (!isValidNumber(partial.radius)) throw new Error(`Unable to create circle, radius is undefined`)\n    const circle = new IIShapeCircle(partial.center as TPoint, partial.radius!, partial.style)\n    if (partial.id) {\n      circle.id = partial.id\n    }\n    return circle\n  }\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, computePointOnEllipse, findIntersectionBetween2Segment, isValidNumber, } from \"../../utils\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box, TBox } from \"../Box\"\n\n/**\n * @group Symbol\n */\nexport class IIShapeEllipse extends OIShapeBase<ShapeKind.Ellipse>\n{\n  center: TPoint\n  radiusX: number\n  radiusY: number\n  orientation: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    radiusX: number,\n    radiusY: number,\n    orientation: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Ellipse, style)\n    this.center = center\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.orientation = orientation\n    this._vertices = new Map<string, TPoint[]>()\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radiusX }-${ this.radiusY }-${ this.orientation }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const points: TPoint[] = []\n    const perimeter = 2 * Math.PI * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    for (let i = 0; i < nbPoint; i++) {\n      const theta = 2 * Math.PI * (i / nbPoint)\n      points.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.orientation, theta))\n    }\n\n    return points\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBox): boolean\n  {\n\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): IIShapeEllipse\n  {\n    const clone = new IIShapeEllipse(structuredClone(this.center), this.radiusX, this.radiusY, this.orientation, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapeEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      orientation: this.orientation,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapeEllipse\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const radiusX = Math.abs(origin.x - target.x) / 2\n    const radiusY = Math.abs(origin.y - target.y) / 2\n    return new IIShapeEllipse(center, radiusX, radiusY, 0, style)\n  }\n\n  static updateBetweenPoints(ellipse: IIShapeEllipse, origin: TPoint, target: TPoint): IIShapeEllipse\n  {\n    ellipse.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    ellipse.radiusX = Math.abs(origin.x - target.x) / 2\n    ellipse.radiusY = Math.abs(origin.y - target.y) / 2\n    return ellipse\n  }\n\n  static create(partial: PartialDeep<IIShapeEllipse>): IIShapeEllipse\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create ellipse, center is undefined`)\n    if (!isValidNumber(partial.radiusX)) throw new Error(`Unable to create ellipse, radiusX is undefined`)\n    if (!isValidNumber(partial.radiusY)) throw new Error(`Unable to create ellipse, radiusY is undefined`)\n    const ellipse = new IIShapeEllipse(partial.center as TPoint, partial.radiusX!, partial.radiusY!, partial.orientation || 0, partial.style)\n    if (partial.id) {\n      ellipse.id = partial.id\n    }\n    return ellipse\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box } from \"../Box\"\nimport { PartialDeep } from \"../../utils\"\n\n/**\n * @group Symbol\n */\nexport class IIShapePolygon extends OIShapeBase<ShapeKind.Polygon>\n{\n  points: TPoint[]\n\n  constructor(points: TPoint[], style?: PartialDeep<TStyle>)\n  {\n    super(ShapeKind.Polygon, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  clone(): IIShapePolygon\n  {\n    const clone = new IIShapePolygon(structuredClone(this.points), structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapePolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n    }\n  }\n\n  static create(partial: PartialDeep<IIShapePolygon>): IIShapePolygon\n  {\n    if (!partial?.points || partial?.points?.length < 3) throw new Error(`Unable to create polygon at least 3 points required`)\n    if (partial?.points?.some(p => !isValidPoint(p))) throw new Error(`Unable to create a polygon, one or more points are invalid`)\n    const polygon = new IIShapePolygon(partial.points as TPoint[], partial.style)\n    if (partial.id) {\n      polygon.id = partial.id\n    }\n    return polygon\n  }\n\n  static createTriangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateTriangleBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    poly.points = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createParallelogramBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateParallelogramBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRectangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateRectangleBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRhombusBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n\n  static updateRhombusBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, computeDistance, getClosestPoint } from \"../utils\"\nimport { TStroke, TStrokeToSend } from \"./Stroke\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\n\n/**\n * @group Symbol\n */\nexport class IIStroke extends IISymbolBase<SymbolType.Stroke>\n{\n  readonly isClosed = false\n\n  pointerType: string\n  length: number\n  decorators: IIDecorator[]\n  pointers: Array<TPointer>\n\n  constructor(style?: PartialDeep<TStyle>, pointerType = \"pen\")\n  {\n    super(SymbolType.Stroke, style)\n\n    this.pointerType = pointerType\n    this.pointers = []\n    this.decorators = []\n    this.length = 0\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  static split(strokeToSplit: IIStroke, i: number): { before: IIStroke, after: IIStroke }\n  {\n    const before = new IIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    before.pointers = strokeToSplit.pointers.slice(0, i)\n\n    const after = new IIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    after.pointers = strokeToSplit.pointers.slice(i)\n\n    return { before, after }\n  }\n\n  static substract(stroke: IIStroke, partStroke: IIStroke): { before?: IIStroke, after?: IIStroke }\n  {\n    if (!partStroke.length) return { before: stroke }\n    const result: { before?: IIStroke, after?: IIStroke } = {}\n    const lastPointBeforeStroke = {\n      x: partStroke.pointers[0].x as number,\n      y: partStroke.pointers[0].y as number\n    }\n    const closestLastPointBeforeStroke = getClosestPoint(stroke.pointers, lastPointBeforeStroke)\n    if (closestLastPointBeforeStroke.index > -1) {\n      const newStrokes = IIStroke.split(stroke, closestLastPointBeforeStroke.index)\n      result.before = newStrokes.before\n      result.after = newStrokes.after\n    }\n    const strokeAfter = result.after || stroke\n    const firstPointAfterStroke = {\n      x: partStroke.pointers.at(-1)!.x as number,\n      y: partStroke.pointers.at(-1)!.y as number\n    }\n    const closestFirstPointStrokeAfter = getClosestPoint(strokeAfter.pointers, firstPointAfterStroke)\n    if (closestFirstPointStrokeAfter.index > -1) {\n      const newStrokes = IIStroke.split(strokeAfter, closestFirstPointStrokeAfter.index)\n      result.after = newStrokes.after\n    }\n    if (!result.before?.pointers.length) result.before = undefined\n    if (!result.after?.pointers.length) result.after = undefined\n    return result\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  protected computePressure(distance: number): number\n  {\n    let ratio = 1.0\n    if (distance === this.length) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > this.length - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (this.length - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(point: TPointer): boolean\n  {\n    const lastPointer = this.pointers.at(-1)\n    const delta: number = (2 + ((this.style.width || 1) / 4))\n    return !lastPointer ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  addPointer(pointer: TPointer): void\n  {\n    if (this.filterPointByAcquisitionDelta(pointer)) {\n      const lastPointer = this.pointers.at(-1)\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      this.length += distance\n      pointer.p = this.computePressure(distance)\n      this.pointers.push(pointer)\n      this.modificationDate = Date.now()\n    }\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  clone(): IIStroke\n  {\n    const clone = new IIStroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p =>\n    {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n\n  toJSON(): PartialDeep<IIStroke>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      pointers: this.pointers,\n      style: this.style,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIStroke>): IIStroke\n  {\n    if (!partial.pointers?.length) {\n      throw new Error(`not pointers`)\n    }\n    const stroke = new IIStroke(partial.style, partial.pointerType)\n    if (partial.id) {\n      stroke.id = partial.id\n    }\n    const errors: string[] = []\n    let flag = true\n    partial.pointers?.forEach((pp, pIndex) =>\n    {\n      if (!pp) {\n        errors.push(`no pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`no x at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`no y at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.addPointer(pointer)\n      }\n    })\n\n    if (errors.length) {\n      throw new Error(errors.join(\" and \"))\n    }\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          stroke.decorators.push(new IIDecorator(d.kind, Object.assign({}, stroke.style, d.style)))\n        }\n      })\n    }\n    return stroke\n  }\n}\n\n/**\n * @group Symbol\n * @group Utils\n */\nexport function convertPartialStrokesToOIStrokes(json: PartialDeep<TStroke>[]): IIStroke[]\n{\n  const errors: string[] = []\n  const strokes: IIStroke[] = []\n  json.forEach((j, i) =>\n  {\n    try {\n      strokes.push(IIStroke.create(j as PartialDeep<IIStroke>))\n    } catch (e) {\n      errors.push(`stroke ${ i + 1 } has ${ (e as Error).message }`)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedArc extends IIRecognizedBase<RecognizedKind.Arc>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Arc, strokes, style)\n  }\n\n  clone(): IIRecognizedArc\n  {\n    const clone = new IIRecognizedArc(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedArc>): IIRecognizedArc\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n    const ws = new IIRecognizedArc(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedCircle extends IIRecognizedBase<RecognizedKind.Circle>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Circle, strokes, style)\n  }\n\n  clone(): IIRecognizedCircle\n  {\n    const clone = new IIRecognizedCircle(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedCircle>): IIRecognizedCircle\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedCircle(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedEllipse extends IIRecognizedBase<RecognizedKind.Ellipse>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Ellipse, strokes, style)\n  }\n\n  clone(): IIRecognizedEllipse\n  {\n    const clone = new IIRecognizedEllipse(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedEllipse>): IIRecognizedEllipse\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedEllipse(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedLine extends IIRecognizedBase<RecognizedKind.Line>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Line, strokes, style)\n  }\n\n  clone(): IIRecognizedLine\n  {\n    const clone = new IIRecognizedLine(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedLine>): IIRecognizedLine\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedLine(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedPolyLine extends IIRecognizedBase<RecognizedKind.PolyEdge>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.PolyEdge, strokes, style)\n  }\n\n  clone(): IIRecognizedPolyLine\n  {\n    const clone = new IIRecognizedPolyLine(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedPolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedPolyLine>): IIRecognizedPolyLine\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedPolyLine(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedPolygon extends IIRecognizedBase<RecognizedKind.Polygone>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Polygone, strokes, style)\n  }\n\n  clone(): IIRecognizedPolygon\n  {\n    const clone = new IIRecognizedPolygon(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedPolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedPolygon>): IIRecognizedPolygon\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedPolygon(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIDecorator } from \"../IIDecorator\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedText extends IIRecognizedBase<RecognizedKind.Text>\n{\n  readonly isClosed = false\n\n  decorators: IIDecorator[]\n\n  baseline: number\n  xHeight: number\n  label?: string\n\n  constructor(\n    strokes: IIStroke[],\n    lines: { baseline: number, xHeight: number },\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Text, strokes, style)\n    this.baseline = lines.baseline\n    this.xHeight = lines.xHeight\n    this.decorators = []\n  }\n\n  clone(): IIRecognizedText\n  {\n    const clone = new IIRecognizedText(this.strokes.map(s => s.clone()), { baseline: this.baseline, xHeight: this.xHeight }, structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.label = this.label\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      label: this.label,\n      baseline: this.baseline,\n      xHeight: this.xHeight,\n      strokes: JSON.parse(JSON.stringify(this.strokes)),\n      decorators: this.decorators.length ? JSON.parse(JSON.stringify(this.decorators)) : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedText>): IIRecognizedText\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n    const line = {\n      baseline: partial.baseline || 0,\n      xHeight: partial.xHeight || 0\n    }\n    const ws = new IIRecognizedText(strokes, line, partial.style)\n\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d =>\n      {\n        if (d?.kind) {\n          ws.decorators.push(new IIDecorator(d.kind, Object.assign({}, ws.style, d.style)))\n        }\n      })\n    }\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { TPoint } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\nimport { IIStroke } from \"./IIStroke\"\nimport { IIText } from \"./IIText\"\nimport { TIISymbol } from \".\"\n\n/**\n * @group Symbol\n */\nexport class IISymbolGroup extends IISymbolBase<SymbolType.Group>\n{\n  readonly isClosed = false\n\n  children: TIISymbol[]\n  decorators: IIDecorator[]\n\n  constructor(\n    children: TIISymbol[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Group, style)\n    this.children = children\n    this.decorators = []\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.children.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.children.map(c => c.bounds))\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.children.forEach(child => {\n      child.style = Object.assign({}, child.style, this.style)\n      switch (child.type) {\n        case SymbolType.Group:\n          child.updateChildrenStyle()\n          break\n        case SymbolType.Text:\n          child.chars.forEach(c =>\n          {\n            if (child.style.color) {\n              c.color = child.style.color\n            }\n          })\n          break\n        case SymbolType.Recognized:\n          child.updateChildrenStyle()\n          break\n      }\n\n    })\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.children.some(s => s.overlaps(box))\n  }\n\n  containsSymbol(strokeId: string): boolean\n  {\n    return IISymbolGroup.containsSymbol(this, strokeId)\n  }\n\n  containsOnlyStroke(): boolean\n  {\n    return IISymbolGroup.containsOnlyStroke(this)\n  }\n\n  extractText(): IIText[]\n  {\n    return IISymbolGroup.extractText(this)\n  }\n\n  extractStrokes(): IIStroke[]\n  {\n    return IISymbolGroup.extractStrokes(this)\n  }\n\n  removeChilds(symbolIds: string[]): IISymbolGroup\n  {\n    return IISymbolGroup.removeChilds(this, symbolIds)\n  }\n\n  static containsOnlyStroke(group: IISymbolGroup): boolean\n  {\n    return group.children.every(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        return IISymbolGroup.containsOnlyStroke(s as IISymbolGroup)\n      }\n      if (s.type === SymbolType.Stroke) {\n        return true\n      }\n      return false\n    })\n  }\n\n  static extractText(group: IISymbolGroup): IIText[]\n  {\n    const texts: IIText[] = []\n    group.children.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Text:\n          texts.push(s)\n          break;\n        case SymbolType.Group:\n          texts.push(...IISymbolGroup.extractText(s))\n          break;\n      }\n    })\n    return texts\n  }\n\n  static extractStrokes(group: IISymbolGroup): IIStroke[]\n  {\n    const strokes: IIStroke[] = []\n    group.children.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break;\n        case SymbolType.Recognized:\n          strokes.push(...s.strokes)\n          break;\n        case SymbolType.Group:\n          strokes.push(...IISymbolGroup.extractStrokes(s))\n          break;\n      }\n    })\n    return strokes\n  }\n\n  static containsSymbol(group: IISymbolGroup, symbolId: string): boolean\n  {\n    return group.children.some(symbol =>\n    {\n      if (symbol.id === symbolId) return true\n      if (symbol.type === SymbolType.Group) {\n        return IISymbolGroup.containsSymbol(symbol, symbolId)\n      }\n      else if (symbol.type === SymbolType.Recognized) {\n        return symbol.containsStroke(symbolId)\n      }\n      return false\n    })\n  }\n\n  static removeChilds(group: IISymbolGroup, symbolIds: string[]): IISymbolGroup\n  {\n    group.children = group.children.filter(s => !symbolIds.includes(s.id))\n    const symbolsToRemove = group.children.slice()\n    symbolsToRemove.forEach(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        if (!s.removeChilds(symbolIds).children.length) {\n          group.children = group.children.filter(s1 => s1.id !== s.id)\n        }\n      }\n      else if (s.type === SymbolType.Recognized) {\n        s.removeStrokes(symbolIds)\n        if (!s.strokes.length) {\n          group.removeChilds([s.id])\n        }\n      }\n    })\n    return group\n  }\n\n  clone(): IISymbolGroup\n  {\n    const clone = new IISymbolGroup(this.children.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<IISymbolGroup>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      children: JSON.parse(JSON.stringify(this.children)),\n      decorators: this.decorators.length ? JSON.parse(JSON.stringify(this.decorators)) : undefined\n    }\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, convertDegreeToRadian, findIntersectionBetween2Segment, isPointInsidePolygon, computeRotatedPoint } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\nimport { Box, TBox } from \"./Box\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\n\n/**\n * @group Symbol\n */\nexport type TIISymbolChar = {\n  id: string\n  label: string\n  fontSize: number\n  fontWeight: \"normal\" | \"bold\"\n  color: string\n  bounds: TBox\n}\n\n/**\n * @group Symbol\n */\nexport class IIText extends IISymbolBase<SymbolType.Text>\n{\n  readonly isClosed = true\n\n  point: TPoint\n  chars: TIISymbolChar[]\n  decorators: IIDecorator[]\n  bounds: Box\n  rotation?: {\n    degree: number,\n    center: TPoint\n  }\n\n  constructor(\n    chars: TIISymbolChar[],\n    point: TPoint,\n    bounds: TBox,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Text, style)\n    this.point = point\n    this.bounds = new Box(bounds)\n    this.chars = chars\n    this.decorators = []\n  }\n\n  get label(): string\n  {\n    return this.chars.map(c => c.label).join(\"\")\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return this.bounds.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    else {\n      return this.bounds.corners\n    }\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    const offsetY = this.bounds.yMax - this.point.y\n    const points = [\n      { x: this.bounds.x, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMax - offsetY },\n      { x: this.bounds.x, y: this.bounds.yMax - offsetY },\n      this.bounds.center\n    ]\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return points\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return points\n  }\n\n  protected getCharCorners(char: TIISymbolChar): TPoint[]\n  {\n    const boxBox = new Box(char.bounds)\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return boxBox.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return boxBox.corners\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.chars.forEach(c => {\n      if (this.style.color) {\n        c.color = this.style.color\n      }\n    })\n    this.modificationDate = Date.now()\n  }\n\n  updateChildrenFont( { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" }): void\n  {\n    this.chars.forEach(c => {\n      if (fontSize) {\n        c.fontSize = fontSize\n      }\n      if (fontWeight) {\n        c.fontWeight = fontWeight\n      }\n    })\n    this.modificationDate = Date.now()\n  }\n\n  getCharsOverlaps(points: TPoint[]): TIISymbolChar[]\n  {\n    return this.chars.filter(c =>\n    {\n      const charCorners = this.getCharCorners(c)\n      return points.some(p => isPointInsidePolygon(p, charCorners))\n    })\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.vertices.some(p => Box.containsPoint(box, p)) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): IIText\n  {\n    const clone = new IIText(structuredClone(this.chars), structuredClone(this.point), this.bounds, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.rotation = this.rotation ? structuredClone(this.rotation) : undefined\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      point: this.point,\n      chars: this.chars,\n      style: this.style,\n      rotation: this.rotation,\n      bounds: this.bounds,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIText>): IIText\n  {\n    if (!isValidPoint(partial?.point)) throw new Error(`Unable to create a IIText, point are invalid`)\n    if (!partial.chars?.length) throw new Error(`Unable to create a IIText, no chars`)\n    if (!partial.bounds) throw new Error(`Unable to create a IIText, no boundingBox`)\n    const text = new IIText(partial.chars as TIISymbolChar[], partial.point as TPoint, partial.bounds as TBox, partial.style)\n    if (partial.id) text.id = partial.id\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          text.decorators.push(new IIDecorator(d.kind, Object.assign({}, text.style, d.style)))\n        }\n      })\n    }\n    return text\n  }\n}\n","import { createUUID, PartialDeep } from \"../utils\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IISymbolBase } from \"./IISymbolBase\"\nimport { TStyle } from \"../style\"\n\nconst style: TStyle = {\n  color: \"grey\",\n  fill: \"none\",\n  width: 12,\n  opacity: 0.2\n}\n\n/**\n * @group Symbol\n */\nexport class IIEraser extends IISymbolBase<SymbolType.Eraser>\n{\n  readonly isClosed = false\n  pointers: TPointer[]\n\n  constructor()\n  {\n    super(SymbolType.Eraser, style)\n    this.id = `${ this.type }-${ createUUID() }`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.pointers = []\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return []\n  }\n\n  clone(): IISymbolBase\n  {\n    const clone = new IIEraser()\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    return clone\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  toJSON(): PartialDeep<IIEraser>\n  {\n    return {\n      id: this.id,\n      pointers: this.pointers,\n      style: this.style\n    }\n  }\n}\n","import { DefaultPenStyle, TPenStyle } from \"../style\"\nimport { PartialDeep, createUUID } from \"../utils\"\nimport { TPointer } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\n\n/**\n * @group Symbol\n */\nexport type TStrokeToSend = {\n  id: string\n  pointerType: string\n  x: number[]\n  y: number[]\n  t: number[]\n  p: number[]\n}\n\n/**\n * @group Symbol\n */\nexport type TStrokeGroupToSend = {\n  penStyle?: string\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Symbol\n */\nexport type TStroke = TSymbol & {\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n}\n\n/**\n * @group Symbol\n */\nexport type TStrokeGroup = {\n  penStyle: TPenStyle\n  strokes: Stroke[]\n}\n\n/**\n * @group Symbol\n */\nexport class Stroke implements TStroke\n{\n  type = SymbolType.Stroke\n  id: string\n  creationTime: number\n  modificationDate: number\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n\n  constructor(style: TPenStyle, pointerType = \"pen\")\n  {\n    this.id = `${this.type}-${createUUID()}`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.style = style\n    this.pointerType = pointerType\n    this.pointers = []\n    this.length = 0\n  }\n\n  clone(): Stroke\n  {\n    const clone = new Stroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p => {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n}\n\n/**\n * @group Symbol\n * @group Utils\n */\nexport function convertPartialStrokesToStrokes(json: PartialDeep<TStroke>[]): Stroke[]\n{\n  const errors: string[] = []\n  const strokes: Stroke[] = []\n  json.forEach((j, ji) => {\n    let flag = true\n    const stroke = new Stroke(j.style || DefaultPenStyle, j.pointerType)\n    if (j.id) stroke.id = j.id\n    if (!j.pointers?.length) {\n      errors.push(`stroke ${ji + 1} has not pointers`)\n      flag = false\n      return\n    }\n    j.pointers?.forEach((pp, pIndex) => {\n      if (!pp) {\n        errors.push(`stroke ${ji + 1} has no pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`stroke ${ji + 1} has no x at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`stroke ${ji + 1} has no y at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.pointers.push(pointer)\n      }\n    })\n    if (flag) {\n      strokes.push(stroke)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TPenStyle } from \"../style\"\nimport { computeDistance } from \"../utils\"\nimport { TExport } from \"./Export\"\nimport { Stroke, TPoint, TPointer } from \"../symbol\"\n\n/**\n * @group Model\n */\nexport type TRecognitionPositions = {\n  lastSentPosition: number\n  lastReceivedPosition: number\n}\n\n/**\n * @group Model\n */\nexport class Model\n{\n  readonly creationTime: number\n  modificationDate: number\n  positions: TRecognitionPositions\n  currentSymbol?: Stroke\n  symbols: Stroke[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.#logger.info(\"constructor\", { width, height, creationDate })\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.positions = {\n      lastSentPosition: 0,\n      lastReceivedPosition: 0\n    }\n    this.idle = true\n  }\n\n  protected computePressure(distance: number, globalDistance: number): number\n  {\n    let ratio = 1.0\n    if (distance === globalDistance) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > globalDistance - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (globalDistance - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(stroke: Stroke, point: TPointer, lastPointer?: TPointer): boolean\n  {\n    const delta: number = (2 + ((stroke.style[\"-myscript-pen-width\"] || 0) / 4))\n    return !lastPointer ||\n      stroke.pointers.length === 0 ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  getStrokeFromPoint(point: TPoint): Stroke[]\n  {\n    this.#logger.info(\"getStrokeFromPoint\", { point })\n    const isBetween = (val: number, min: number, max: number): boolean => (val >= min && val <= max)\n\n    const _strokeList: Stroke[] = []\n    this.symbols.forEach((stroke) =>\n    {\n      for (let i = 0; i < stroke.pointers.length; i++) {\n        const strokePointer = stroke.pointers[i]\n        if (\n          isBetween(strokePointer.x, point.x - 5, point.x + 5) &&\n          isBetween(strokePointer.y, point.y - 5, point.y + 5)\n        ) {\n          _strokeList.push(stroke)\n          break\n        }\n        else {\n          if (computeDistance(point, strokePointer) < 10) {\n            _strokeList.push(stroke)\n            break\n          }\n        }\n      }\n    })\n    this.#logger.debug(\"getStrokeFromPoint\", { strokes: _strokeList })\n    return _strokeList\n  }\n\n  addPoint(stroke: Stroke, pointer: TPointer): void\n  {\n    this.#logger.debug(\"addPoint\", { stroke, pointer })\n    const lastPointer = stroke.pointers.at(-1)\n    if (this.filterPointByAcquisitionDelta(stroke, pointer, lastPointer)) {\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      stroke.length += distance\n      pointer.p = this.computePressure(distance, stroke.length)\n      stroke.pointers.push(pointer)\n      stroke.modificationDate = Date.now()\n    }\n  }\n\n  addStroke(stroke: Stroke): void\n  {\n    this.#logger.info(\"addStroke\", { stroke })\n    this.symbols.push(stroke)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n  }\n\n  updateStroke(updatedStroke: Stroke): void\n  {\n    this.#logger.info(\"updateStroke\", { updatedStroke })\n    const strokeIndex = this.symbols.findIndex((s: Stroke): boolean => s.id === updatedStroke.id)\n    if (strokeIndex !== -1) {\n      updatedStroke.modificationDate = Date.now()\n      this.symbols.splice(strokeIndex, 1, updatedStroke)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateStroke\", this.symbols)\n  }\n\n  removeStroke(id: string): void\n  {\n    this.#logger.info(\"removeStroke\", { id })\n    const strokeIndex = this.symbols.findIndex(s => s.id === id)\n    if (strokeIndex !== -1) {\n      this.positions.lastSentPosition--\n      this.positions.lastReceivedPosition--\n      this.symbols.splice(strokeIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeStroke\", this.symbols)\n  }\n\n  removeStrokesFromPoint(point: TPoint): string[]\n  {\n    this.#logger.info(\"removeStrokesFromPoint\", { point })\n    const strokes = this.getStrokeFromPoint(point)\n    strokes.forEach(strokeToRemove =>\n    {\n      this.removeStroke(strokeToRemove.id)\n    })\n    this.#logger.debug(\"removeStrokesFromPoint\", strokes.map(s => s.id))\n    return strokes.map(s => s.id)\n  }\n\n  extractUnsentStrokes(): Stroke[]\n  {\n    return this.symbols.slice(this.positions.lastSentPosition)\n  }\n\n  initCurrentStroke(point: TPointer, pointerType: string, style: TPenStyle, dpi = 96): void\n  {\n    this.#logger.info(\"initCurrentStroke\", { point, pointerType, style, dpi })\n    if (style[\"-myscript-pen-width\"]) {\n      const pxWidth = (style[\"-myscript-pen-width\"] * dpi) / 25.4\n      style.width = pxWidth / 2\n    }\n    this.modificationDate = Date.now()\n    this.exports = undefined\n    this.currentSymbol = new Stroke(style, pointerType)\n    this.#logger.debug(\"initCurrentStroke\", this.currentSymbol)\n    this.addPoint(this.currentSymbol, point)\n  }\n\n  appendToCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"appendToCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n    }\n    this.#logger.debug(\"appendToCurrentStroke\", this.currentSymbol)\n  }\n\n  endCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"endCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n      this.addStroke(this.currentSymbol)\n      this.currentSymbol = undefined\n    }\n    this.#logger.debug(\"endCurrentStroke\", this.currentSymbol)\n  }\n\n  updatePositionSent(position: number = this.symbols.length): void\n  {\n    this.#logger.info(\"updatePositionSent\", { position })\n    this.positions.lastSentPosition = position\n    this.#logger.debug(\"updatePositionSent\", this.positions.lastSentPosition)\n  }\n\n  updatePositionReceived(): void\n  {\n    this.#logger.info(\"updatePositionReceived\")\n    this.positions.lastReceivedPosition = this.positions.lastSentPosition\n    this.#logger.debug(\"updatePositionReceived\", this.positions.lastReceivedPosition)\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  mergeConvert(converts: TExport)\n  {\n    this.#logger.info(\"mergeConvert\", { converts })\n    if (this.converts) {\n      Object.assign(this.converts, converts)\n    } else {\n      this.converts = converts\n    }\n    this.#logger.debug(\"mergeConvert\", this.converts)\n  }\n\n  clone(): Model\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new Model(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = JSON.parse(JSON.stringify(this.modificationDate))\n    clonedModel.currentSymbol = this.currentSymbol ? this.currentSymbol.clone() : undefined\n    clonedModel.symbols = this.symbols.map(s => s.clone())\n    clonedModel.positions = JSON.parse(JSON.stringify(this.positions))\n    clonedModel.exports = this.exports ? JSON.parse(JSON.stringify(this.exports)) : undefined\n    clonedModel.converts = this.converts ? JSON.parse(JSON.stringify(this.converts)) : undefined\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.currentSymbol = undefined\n    this.symbols = []\n    this.positions.lastSentPosition = 0\n    this.positions.lastReceivedPosition = 0\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport\n{\n  RecognizedKind,\n  SymbolType,\n  TIISymbol,\n} from \"../symbol\"\nimport { TExport } from \"./Export\"\n\n/**\n * @group Model\n */\nexport class IIModel\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n  readonly creationTime: number\n  modificationDate: number\n  currentSymbol?: TIISymbol\n  symbols: TIISymbol[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.symbols.filter(s => s.selected)\n  }\n\n  get symbolsToDelete(): TIISymbol[]\n  {\n    return this.symbols.filter(s => s.deleting)\n  }\n\n  selectSymbol(id: string): void\n  {\n    const symbol = this.symbols.find(s => s.id === id || (s.type === SymbolType.Group && s.containsSymbol(id)))\n    if (symbol) {\n      symbol.selected = true\n    }\n  }\n\n  unselectSymbol(id: string): void\n  {\n    const symbol = this.symbols.find(s => s.id === id)\n    if (symbol) {\n      symbol.selected = false\n    }\n  }\n\n  resetSelection(): void\n  {\n    this.symbols.forEach(s => s.selected = false)\n  }\n\n  getRootSymbol(id: string): TIISymbol | undefined\n  {\n    return this.symbols.find(s =>\n    {\n      if (s.id === id) return s\n      if (s.type === SymbolType.Group && s.containsSymbol(id)) {\n        return s\n      }\n      if (s.type === SymbolType.Recognized && s.containsStroke(id)) {\n        return s\n      }\n      return\n    })\n  }\n\n  getSymbolRowIndex(symbol: TIISymbol): number\n  {\n    return Math.round((symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text ? symbol.baseline : symbol.bounds.yMid) / this.rowHeight)\n  }\n\n  getSymbolsByRowOrdered(): { rowIndex: number, symbols: TIISymbol[] }[]\n  {\n    const rows: { rowIndex: number, symbols: TIISymbol[] }[] = []\n    this.symbols.forEach(s =>\n    {\n      const rowIndex = this.getSymbolRowIndex(s)\n      const row = rows.find(r => r.rowIndex === rowIndex)\n      if (row) {\n        row.symbols.push(s)\n      }\n      else {\n        rows.push({ rowIndex, symbols: [s] })\n      }\n    })\n    rows.forEach(r =>\n    {\n      r.symbols.sort((s1, s2) => s1.bounds.xMid - s2.bounds.xMid)\n    })\n    return rows.sort((r1, r2) => r1.rowIndex - r2.rowIndex)\n  }\n\n  roundToLineGuide(y: number): number\n  {\n    return Math.round(y / this.rowHeight) * this.rowHeight\n  }\n\n  isSymbolAbove(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) > this.getSymbolRowIndex(target)\n  }\n\n  isSymbolInRow(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) === this.getSymbolRowIndex(target)\n  }\n\n  isSymbolBelow(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) < this.getSymbolRowIndex(target)\n  }\n\n  getFirstSymbol(symbols: TIISymbol[]): TIISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (this.getSymbolRowIndex(previous) < this.getSymbolRowIndex(current)) {\n          return previous\n        }\n        else if (this.getSymbolRowIndex(previous) == this.getSymbolRowIndex(current) && previous.bounds.xMid < current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  getLastSymbol(symbols: TIISymbol[]): TIISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (this.getSymbolRowIndex(previous) > this.getSymbolRowIndex(current)) {\n          return previous\n        }\n        if (this.getSymbolRowIndex(previous) < this.getSymbolRowIndex(current)) {\n          return current\n        }\n        else if (previous.bounds.xMid > current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  addSymbol(symbol: TIISymbol): void\n  {\n    this.#logger.info(\"addSymbol\", { symbol })\n    const sIndex = this.symbols.findIndex(s => s.id === symbol.id)\n    if (sIndex > -1) {\n      throw new Error(`Symbol id already exist: ${ symbol.id }`)\n    }\n    this.symbols.push(symbol)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n    this.#logger.debug(\"addSymbol\", this.symbols)\n  }\n\n  updateSymbol(updatedSymbol: TIISymbol): void\n  {\n    this.#logger.info(\"updateSymbol\", { updatedSymbol })\n    const sIndex = this.symbols.findIndex(s => s.id === updatedSymbol.id)\n    if (sIndex !== -1) {\n      updatedSymbol.modificationDate = Date.now()\n      this.symbols.splice(sIndex, 1, updatedSymbol)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateSymbol\", this.symbols)\n  }\n\n  replaceSymbol(id: string, symbols: TIISymbol[]): void\n  {\n    const sIndex = this.symbols.findIndex(s => s.id === id)\n    if (sIndex !== -1) {\n      this.symbols.splice(sIndex, 1, ...symbols)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n  }\n\n  changeOrderSymbol(id: string, position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    const fromIndex = this.symbols.findIndex(s => s.id === id)\n    if (fromIndex > -1) {\n      let toIndex = fromIndex\n      switch (position) {\n        case \"first\":\n          toIndex = 0\n          break\n        case \"last\":\n          toIndex = this.symbols.length - 1\n          break\n        case \"forward\":\n          toIndex = Math.min(toIndex + 1, this.symbols.length - 1)\n          break\n        case \"backward\":\n          toIndex = Math.max(toIndex - 1, 0)\n          break\n      }\n      const sym = this.symbols.splice(fromIndex, 1)[0]\n      this.symbols.splice(toIndex, 0, sym)\n    }\n  }\n\n  removeSymbol(id: string): void\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    const symbolIndex = this.symbols.findIndex(s => s.id === id)\n    if (symbolIndex !== -1) {\n      this.symbols.splice(symbolIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeSymbol\", this.symbols)\n  }\n\n  extractDifferenceSymbols(model: IIModel): { added: TIISymbol[], removed: TIISymbol[] }\n  {\n    return {\n      added: this.symbols.filter(s1 => model.symbols.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1),\n      removed: model.symbols.filter(s1 => this.symbols.findIndex(s2 => s1.id === s2.id && s1.modificationDate === s2.modificationDate) === -1)\n    }\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  clone(): IIModel\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new IIModel(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = this.modificationDate\n    clonedModel.symbols = this.symbols.map(s =>\n    {\n      const c = s.clone()\n      c.selected = false\n      return c\n    })\n    clonedModel.exports = structuredClone(this.exports)\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.symbols = []\n    this.currentSymbol = undefined\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n\n  }\n}\n","/**\n * @group Recognizer\n */\nexport type TScheme = \"https\" | \"http\"\n\n/**\n * @group Recognizer\n */\nexport type TServerHTTPConfiguration = {\n  scheme: TScheme,\n  host: string\n  applicationKey: string\n  hmacKey: string\n  version?: string\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultServerHTTPConfiguration: TServerHTTPConfiguration = {\n  scheme: \"https\",\n  host: \"cloud.myscript.com\",\n  applicationKey: \"\",\n  hmacKey: \"\",\n  version: \"\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TServerWebsocketConfiguration = TServerHTTPConfiguration & {\n  websocket: {\n    pingEnabled: boolean\n    pingDelay: number\n    maxPingLostCount: number\n    autoReconnect: boolean\n    maxRetryCount: number\n    fileChunkSize: number\n  }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultServerWebsocketConfiguration: TServerWebsocketConfiguration = {\n  ...DefaultServerHTTPConfiguration,\n  websocket: {\n    pingEnabled: true,\n    pingDelay: 15000,\n    maxPingLostCount: 20,\n    autoReconnect: true,\n    maxRetryCount: 2,\n    fileChunkSize: 300000\n  }\n}\n","\n/**\n * @group Recognizer\n */\nexport type TEraserConfiguration = {\n  \"erase-precisely\": boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultEraserConfiguration: TEraserConfiguration = {\n  \"erase-precisely\": false\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TDiagramConvertConfiguration = {\n  types?: (\"text\" | \"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TDiagramConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  text?: TTextConfConfiguration\n  convert?: TDiagramConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDiagramConvertConfiguration: TDiagramConvertConfiguration = {\n  types: [\"text\", \"shape\"],\n  \"match-text-size\": true\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDiagramConfiguration: TDiagramConfiguration = {\n  convert: DefaultDiagramConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\n/**\n * @group Recognizer\n */\nexport type TImageViewportConfiguration = {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TImageConfiguration = {\n  guides: boolean\n  viewport: TImageViewportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TJiixConfiguration = {\n  \"bounding-box\": boolean\n  strokes: boolean\n  ids: boolean\n  \"full-stroke-ids\": boolean\n  text: {\n    chars: boolean\n    words: boolean\n    lines?: boolean\n  }\n  style?: boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultJiixConfiguration: TJiixConfiguration = {\n  \"bounding-box\": false,\n  strokes: false,\n  ids: false,\n  \"full-stroke-ids\": false,\n  text: {\n    chars: false,\n    words: true,\n    lines: false\n  },\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathMLFlavor = {\n  name: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathMLExport = {\n  flavor: TMathMLFlavor\n}\n\n/**\n * @group Recognizer\n */\nexport type TExportConfiguration = {\n  \"image-resolution\"?: number\n  image?: TImageConfiguration\n  jiix: TJiixConfiguration\n  mathml?: TMathMLExport\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultExportConfiguration: TExportConfiguration = {\n  \"image-resolution\": 300,\n  jiix: DefaultJiixConfiguration\n}\n","\n/**\n * @group Recognizer\n */\nexport type TMarginConfiguration = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMarginConfiguration: TMarginConfiguration = {\n  top: 20,\n  left: 10,\n  right: 10,\n  bottom: 10\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRoundingMode = \"half up\" | \"truncate\"\n\n/**\n * @group Recognizer\n */\nexport type TAngleUnit = \"deg\" | \"rad\"\n\n/**\n * @group Recognizer\n */\nexport type TSolverOptions = \"algebraic\" | \"numeric\"\n\n/**\n * @group Recognizer\n */\nexport type TSolverConfiguration = {\n  enable?: boolean\n  \"fractional-part-digits\"?: number\n  \"decimal-separator\"?: string\n  \"rounding-mode\"?: TRoundingMode\n  \"angle-unit\"?: TAngleUnit\n  options?: TSolverOptions\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultSolverConfiguration: TSolverConfiguration = {\n  enable: true,\n  \"fractional-part-digits\": 3,\n  \"decimal-separator\": \".\",\n  \"rounding-mode\": \"half up\",\n  \"angle-unit\": \"deg\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TUndoRedoMode = \"stroke\" | \"session\"\n\n/**\n * @group Recognizer\n */\nexport type TMathUndoRedoConfiguration = {\n  mode: TUndoRedoMode\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMathUndoRedoConfiguration: TMathUndoRedoConfiguration = {\n  mode: \"stroke\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathConfiguration = {\n  mimeTypes: (\"application/x-latex\" | \"application/mathml+xml\" | \"application/vnd.myscript.jiix\")[]\n  solver?: TSolverConfiguration\n  margin: TMarginConfiguration\n  \"undo-redo\"?: TMathUndoRedoConfiguration\n  customGrammar?: string\n  customGrammarId?: string\n  customGrammarContent?: string\n  eraser?: TEraserConfiguration\n  \"session-time\"?: number\n  \"recognition-timeout\"?: number\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMathConfiguration: TMathConfiguration = {\n  solver: DefaultSolverConfiguration,\n  margin: DefaultMarginConfiguration,\n  eraser: DefaultEraserConfiguration,\n  \"undo-redo\": DefaultMathUndoRedoConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRawContentConfiguration = {\n  text?: TTextConfConfiguration\n  \"session-time\"?: number\n  recognition: {\n    types: (\"text\" | \"shape\" | \"math\" | \"decoration\")[]\n  }\n  classification: {\n    types: (\"text\" | \"shape\" | \"math\" | \"decoration\" | \"drawing\")[]\n  }\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRawContentConfiguration: TRawContentConfiguration = {\n  recognition: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\"]\n  },\n  classification: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\", \"drawing\"]\n  },\n  eraser: DefaultEraserConfiguration,\n}\n","\n/**\n * @group Recognizer\n */\nexport type TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": boolean\n  \"draw-image-boxes\": boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDebugConfiguration: TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": false,\n  \"draw-image-boxes\": false\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionRendererConfiguration = {\n  debug: TRecognitionRendererDebugConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognitionRendererConfiguration: TRecognitionRendererConfiguration = {\n  debug: DefaultDebugConfiguration\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TTextGuidesConfiguration = {\n  enable: boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextGuidesConfiguration: TTextGuidesConfiguration = {\n  enable: true\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextConfiguration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides?: TTextGuidesConfiguration\n  configuration?: TTextConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextConfiguration: TTextConfiguration = {\n  guides: DefaultTextGuidesConfiguration,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TTextGuidesConfigurationV2 = {\n  enable: boolean,\n  \"line-gap-mm\"?: number,\n  \"origin-y-mm\"?: number,\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextGuidesConfigurationV2: TTextGuidesConfigurationV2 = {\n  enable: true,\n  \"line-gap-mm\": 100,\n  \"origin-y-mm\": 0,\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextRecognizerHTTPV2ConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextRecognizerHTTPV2Configuration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides: TTextGuidesConfigurationV2\n  configuration?: TTextRecognizerHTTPV2ConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTexConfigurationV2: TTextRecognizerHTTPV2Configuration = {\n  guides: DefaultTextGuidesConfigurationV2,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TShapeConvertConfiguration = {\n  types?: (\"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\nexport type TShapeBeautificationConfiguration = {\n    enable?: true\n}\n/**\n * @group Recognizer\n */\nexport type TShapeConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  convert?: TShapeConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n  beautification?: TShapeBeautificationConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultShapeConvertConfiguration: TShapeConvertConfiguration = {\n  types: [\"shape\"],\n  \"match-text-size\": true\n}\n\nexport const DefaultShapeBeautificationConfiguration: TShapeBeautificationConfiguration = {\n    enable: true\n  }\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultShapeConfiguration: TShapeConfiguration = {\n  convert: DefaultShapeConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n  beautification: DefaultShapeBeautificationConfiguration\n}\n","import { THistoryContext } from \"../history\"\nimport { TExport } from \"../model\"\nimport { TRecognizerWebSocketSSRMessageSVGPatch } from \"./RecognizerWebSocketSSRMessage\"\n\n/**\n * @group Recognizer\n * @summary\n * Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"RecognizerEventName\" raised by using\n * ```ts\n * recognizer.events.addEventListener(RecognizerEventName.CONTENT_CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum RecognizerEventName\n{\n  /**\n   * @summary event emitted at the start of connection initialization\n   */\n  START_INITIALIZATION = \"start-initialization\",\n  /**\n   * @summary event emitted after full recognizer initialization\n   */\n  END_INITIALIZATION = \"end-initialization\",\n  /**\n   * @summary event emitted after receiving an \"contentChanged\" message\n   */\n  CONTENT_CHANGED = \"content-changed\",\n  /**\n   * @summary event emitted after receiving an \"idle\" message\n   */\n  IDLE = \"idle\",\n  /**\n   * @summary event emitted after receiving an \"exported\" message\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @summary event emitted when the recognizer encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @remarks event emitted after connection closed\n   */\n  CONNECTION_CLOSE = \"connection-close\",\n  /**\n   * @summary\n   * event emitted after receiving an \"svgPatch\" message\n   * @remarks\n   * only usable in the case of websocket\n   */\n  SVG_PATCH = \"svg-patch\",\n  /**\n   * @summary event emitted session opened\n   */\n  SESSION_OPENED = \"session-opened\",\n\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerEvent extends EventTarget\n{\n  protected abortController: AbortController\n\n  constructor()\n  {\n    super()\n    this.abortController = new AbortController()\n  }\n\n  removeAllListeners(): void\n  {\n    this.abortController.abort()\n    this.abortController = new AbortController()\n  }\n\n  protected emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n  }\n\n  emitStartInitialization(): void\n  {\n    this.emit(RecognizerEventName.START_INITIALIZATION)\n  }\n  addStartInitialization(callback: () => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.START_INITIALIZATION,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitEndtInitialization(): void\n  {\n    this.emit(RecognizerEventName.END_INITIALIZATION)\n  }\n  addEndInitialization(callback: () => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.END_INITIALIZATION,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSessionOpened(sessionId: string): void\n  {\n    this.emit(RecognizerEventName.SESSION_OPENED, sessionId)\n  }\n  addSessionOpenedListener(callback: (sessionId: string) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.SESSION_OPENED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as string),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitContentChanged(undoRedoContext: THistoryContext): void\n  {\n    this.emit(RecognizerEventName.CONTENT_CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n  addContentChangedListener(callback: (context: THistoryContext) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.CONTENT_CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as THistoryContext),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.emit(RecognizerEventName.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.IDLE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as boolean),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitExported(exports: TExport): void\n  {\n    this.emit(RecognizerEventName.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.EXPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitError(err: Error): void\n  {\n    this.emit(RecognizerEventName.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.ERROR,\n      (evt: unknown) => callback((evt as CustomEvent).detail as Error),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitConnectionClose({ code, message }: { code: number, message?: string }): void\n  {\n    this.emit(RecognizerEventName.CONNECTION_CLOSE, { code, message })\n  }\n  addConnectionCloseListener(callback: ({ code, message }: { code: number, message?: string }) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.CONNECTION_CLOSE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as { code: number, message?: string }),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  /**\n   * @remarks only use in the case of websocket\n   */\n  emitSVGPatch(svgPatch: TRecognizerWebSocketSSRMessageSVGPatch): void\n  {\n    this.emit(RecognizerEventName.SVG_PATCH, svgPatch)\n  }\n  /**\n   * @remarks only usable in the case of websocket\n   */\n  addSVGPatchListener(callback:  (svgPatch: TRecognizerWebSocketSSRMessageSVGPatch) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.SVG_PATCH,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TRecognizerWebSocketSSRMessageSVGPatch),\n      { signal: this.abortController.signal }\n    )\n  }\n}\n","/**\n * @group Recognizer\n * @remarks List all errors generated by the backend with their descriptions\n */\nexport enum RecognizerError {\n  NO_ACTIVITY = \"Session closed due to no activity. Without a connection on your part, it will be permanently lost after an hour.\",\n  WRONG_CREDENTIALS = \"Application credentials are invalid. Please check or regenerate your application key and hmackey.\",\n  TOO_OLD = \"Session is too old. Max Session Duration Reached.\",\n  NO_SESSION_FOUND = \"No sessions found. Without activation for 1 hour, sessions are deleted from the server. To avoid losing your work, use the json export, then import it this will create a new session.\",\n  UNKNOW = \"An unknown error has occurred.\",\n  ABNORMAL_CLOSURE = \"MyScript recognition server is not reachable.\",\n  CANT_ESTABLISH = \"Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.\",\n  GOING_AWAY = \"MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.\",\n  PROTOCOL_ERROR = \"MyScript recognition server terminated the connection due to a protocol error.\",\n  UNSUPPORTED_DATA = \"MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)\",\n  INVALID_FRAME_PAYLOAD = \"MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).\",\n  POLICY_VIOLATION = \"MyScript recognition server terminated the connection because it received a message that violates its policy.\",\n  MESSAGE_TOO_BIG = \"MyScript recognition server terminated the connection because a data frame was received that is too large.\",\n  INTERNAL_ERROR = \"MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.\",\n  SERVICE_RESTART = \"MyScript recognition server terminated the connection because it is restarting.\",\n  TRY_AGAIN = \"MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.\",\n  BAD_GATEWAY = \"MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.\",\n  TLS_HANDSHAKE = \"MyScript recognition server connection was closed due to a failure to perform a TLS handshake\",\n}\n","import { isVersionSuperiorOrEqual, mergeDeep, PartialDeep } from \"../utils\"\nimport {\n  DefaultDiagramConfiguration,\n  DefaultExportConfiguration,\n  DefaultMathConfiguration,\n  DefaultRawContentConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultTextConfiguration,\n  TConvertionConfiguration,\n  TDiagramConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration\n} from \"./recognition\"\nimport { TRecognitionType } from \"./RecognitionConfiguration\"\nimport { DefaultServerHTTPConfiguration, TServerHTTPConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionHTTPV1Configuration = {\n  type: TRecognitionType\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  diagram: TDiagramConfiguration\n  \"raw-content\": TRawContentConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaulRecognitionHTTPV1ConfigurationConfiguration: TRecognitionHTTPV1Configuration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  diagram: DefaultDiagramConfiguration,\n  \"raw-content\": DefaultRawContentConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1Configuration = {\n  server: TServerHTTPConfiguration\n  recognition: TRecognitionHTTPV1Configuration\n}\n\n/**\n * @group Recognizer\n */\nexport const DefaultRecognizerHTTPV1Configuration: TRecognizerHTTPV1Configuration =\n{\n  server: DefaultServerHTTPConfiguration,\n  recognition: DefaulRecognitionHTTPV1ConfigurationConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport class RecognizerHTTPV1Configuration implements TRecognizerHTTPV1Configuration {\n  recognition: TRecognitionHTTPV1Configuration\n  server: TServerHTTPConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerHTTPV1Configuration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerHTTPV1Configuration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerHTTPV1Configuration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (configuration?.recognition?.diagram?.mimeTypes) {\n      this.recognition.diagram.mimeTypes = configuration.recognition.diagram.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    this.recognition.diagram.mimeTypes = [...new Set(this.recognition.diagram.mimeTypes)]\n\n    if (configuration?.recognition?.diagram?.convert?.types) {\n      this.recognition.diagram.convert!.types = configuration.recognition.diagram.convert.types as (\"text\" | \"shape\")[]\n    }\n\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration?.recognition?.[\"raw-content\"]?.recognition?.types as (\"text\" | \"shape\")[]\n    }\n    this.recognition[\"raw-content\"].recognition.types = [...new Set(this.recognition[\"raw-content\"].recognition.types.filter((type) => type !== \"decoration\"))]\n\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration?.recognition?.[\"raw-content\"]?.classification?.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TStrokeGroup, TStrokeGroupToSend } from \"../symbol\"\nimport { StyleHelper, TPenStyle } from \"../style\"\nimport { computeHmac, getApiInfos, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerHTTPV1Configuration, TRecognizerHTTPV1Configuration } from \"./RecognizerHTTPV1Configuration\"\nimport { TConverstionState } from \"./RecognitionConfiguration\"\nimport { TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TTextConfiguration } from \"./recognition\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1PostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1PostData = {\n  configuration: TRecognizerHTTPV1PostConfiguration,\n  xDPI: number,\n  yDPI: number,\n  contentType: string,\n  conversionState?: TConverstionState\n  height: number,\n  width: number,\n  strokeGroups: TStrokeGroupToSend[]\n}\n\n/**\n * @deprecated Use {@link RecognizerHTTPV2} instead.\n * @group Recognizer\n */\nexport class RecognizerHTTPV1\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  configuration: RecognizerHTTPV1Configuration\n\n  constructor(config: PartialDeep<TRecognizerHTTPV1Configuration>)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerHTTPV1Configuration(config)\n  }\n\n  get url()\n  {\n    return `${ this.configuration.server.scheme }://${ this.configuration.server.host }/api/v4.0/iink/batch`\n  }\n\n  get postConfig(): TRecognizerHTTPV1PostConfiguration\n  {\n    switch (this.configuration.recognition.type) {\n      case \"DIAGRAM\":\n        return {\n          lang: this.configuration.recognition.lang,\n          diagram: this.configuration.recognition.diagram,\n          export: this.configuration.recognition.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.configuration.recognition.lang,\n          math: this.configuration.recognition.math,\n          export: this.configuration.recognition.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.configuration.recognition.lang,\n          \"raw-content\": this.configuration.recognition[\"raw-content\"],\n          export: this.configuration.recognition.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.configuration.recognition.lang,\n          text: this.configuration.recognition.text,\n          export: this.configuration.recognition.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${ this.configuration.recognition.type }\"`)\n        break\n    }\n  }\n\n  protected buildData(model: Model): TRecognizerHTTPV1PostData\n  {\n    this.#logger.info(\"buildData\", { model })\n    const isPenStyleEqual = (ps1: TPenStyle, ps2: TPenStyle) =>\n    {\n      return ps1 && ps2 && ps1[\"-myscript-pen-fill-color\"] === ps2[\"-myscript-pen-fill-color\"] &&\n        ps1[\"-myscript-pen-fill-style\"] === ps2[\"-myscript-pen-fill-style\"] &&\n        ps1[\"-myscript-pen-width\"] === ps2[\"-myscript-pen-width\"] &&\n        ps1.color === ps2.color &&\n        ps1.width === ps2.width\n    }\n\n    const strokeGroupByPenStyle: TStrokeGroup[] = []\n    model.symbols.forEach((s) =>\n    {\n      const groupIndex = strokeGroupByPenStyle.findIndex(sg => isPenStyleEqual(sg.penStyle, s.style))\n      if (groupIndex > -1) {\n        strokeGroupByPenStyle[groupIndex].strokes.push(s)\n      } else {\n        strokeGroupByPenStyle.push({\n          penStyle: s.style,\n          strokes: [s]\n        })\n      }\n    })\n\n    const strokeGroupsToSend: TStrokeGroupToSend[] = []\n    strokeGroupByPenStyle.forEach((group: TStrokeGroup) =>\n    {\n      const newPenStyle = JSON.stringify(group.penStyle) === \"{}\" ? undefined : StyleHelper.penStyleToCSS(group.penStyle as TPenStyle)\n      const newGroup = {\n        penStyle: newPenStyle,\n        strokes: group.strokes.map(s => s.formatToSend())\n      }\n      strokeGroupsToSend.push(newGroup)\n    })\n\n    const contentType: string = this.configuration.recognition.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.configuration.recognition.type.charAt(0).toUpperCase() + this.configuration.recognition.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      xDPI: 96,\n      yDPI: 96,\n      contentType,\n      height: model.height,\n      width: model.width,\n      strokeGroups: strokeGroupsToSend\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown>\n  {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", \"application/json,\" + mimeType)\n    headers.append(\"applicationKey\", this.configuration.server.applicationKey)\n    try {\n      const hmac = await computeHmac(JSON.stringify(data), this.configuration.server.applicationKey, this.configuration.server.hmacKey)\n      headers.append(\"hmac\", hmac)\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n    if (isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"3.0.0\")\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.3.0\")) {\n      delete this.configuration.recognition.convert\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data)\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRecognizerHTTPV1PostData, mimeType: string): Promise<TExport | never>\n  {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) =>\n      {\n        const exports: TExport = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) =>\n      {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[]\n  {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"DIAGRAM\":\n          mimeTypes = this.configuration.recognition.diagram.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.configuration.recognition.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState, requestedMimeTypes })\n    const myModel = model.clone()\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    const dataToConcert = this.buildData(myModel)\n    dataToConcert.conversionState = conversionState\n    const promises = mimeTypes.map(mt => this.tryFetch(dataToConcert, mt))\n    const exports: TExport[] = await Promise.all(promises)\n    exports.forEach(e =>\n    {\n      myModel.mergeConvert(e)\n    })\n    this.#logger.debug(\"convert\", { model: myModel })\n    return myModel\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    const myModel = model.clone()\n    if (myModel.symbols.length === 0) {\n      return Promise.resolve(myModel)\n    }\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    if (!mimeTypes.length) {\n      this.#logger.error(\"export\", { model, requestedMimeTypes, \"Export failed, no mimeTypes define in recognition configuration\": String })\n      return Promise.reject(new Error(\"Export failed, no mimeTypes define in recognition configuration\"))\n    }\n    const mimeTypesRequiringExport: string[] = mimeTypes.filter(m => !myModel.exports || !myModel.exports[m])\n    const data = this.buildData(model)\n    const exports: TExport[] = await Promise.all(mimeTypesRequiringExport.map(mimeType => this.tryFetch(data, mimeType)))\n    exports.forEach(e =>\n    {\n      myModel.mergeExport(e)\n    })\n    this.#logger.debug(\"export\", { model: myModel })\n    return myModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    return this.export(model)\n  }\n\n}\n","import { mergeDeep, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport {\n  DefaultShapeConfiguration,\n  DefaultExportConfiguration,\n  DefaultMathConfiguration,\n  DefaultRawContentConfiguration,\n  DefaultTexConfigurationV2,\n  TConvertionConfiguration,\n  TShapeConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TTextRecognizerHTTPV2Configuration\n} from \"./recognition\"\nimport { TRecognitionType } from \"./RecognitionConfiguration\"\nimport { DefaultServerHTTPConfiguration, TServerHTTPConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2RecognitionConfiguration = {\n  type: TRecognitionType\n  lang: string\n  math: TMathConfiguration\n  text: TTextRecognizerHTTPV2Configuration\n  shape: TShapeConfiguration\n  \"raw-content\": TRawContentConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerHTTPV2RecognitionConfiguration: TRecognizerHTTPV2RecognitionConfiguration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  shape: DefaultShapeConfiguration,\n  \"raw-content\": DefaultRawContentConfiguration,\n  text: DefaultTexConfigurationV2,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2Configuration = {\n  server: TServerHTTPConfiguration\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport const DefaultRecognizerHTTPV2Configuration: TRecognizerHTTPV2Configuration =\n{\n  server: DefaultServerHTTPConfiguration,\n  recognition: DefaultRecognizerHTTPV2RecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport class RecognizerHTTPV2Configuration implements TRecognizerHTTPV2Configuration {\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n  server: TServerHTTPConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerHTTPV2Configuration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerHTTPV2Configuration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerHTTPV2Configuration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (configuration?.recognition?.shape?.mimeTypes) {\n      this.recognition.shape.mimeTypes = configuration.recognition.shape.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    this.recognition.shape.mimeTypes = [...new Set(this.recognition.shape.mimeTypes)]\n\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration?.recognition?.[\"raw-content\"]?.recognition?.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration?.recognition?.[\"raw-content\"]?.classification?.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TExport, TJIIXExport } from \"../model\"\nimport { TStroke, TStrokeToSend } from \"../symbol\"\nimport { computeHmac, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerHTTPV2Configuration, TRecognizerHTTPV2Configuration } from \"./RecognizerHTTPV2Configuration\"\nimport { TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TTextConfiguration } from \"./recognition\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2PostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2PostData = {\n  scaleX: number,\n  scaleY: number,\n  configuration: TRecognizerHTTPV2PostConfiguration,\n  contentType: string,\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerHTTPV2 {\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  protected configuration: RecognizerHTTPV2Configuration\n\n  constructor(config: PartialDeep<TRecognizerHTTPV2Configuration>) {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerHTTPV2Configuration(config)\n  }\n\n  get url() {\n    return `${this.configuration.server.scheme}://${this.configuration.server.host}/api/v4.0/iink/recognize`\n  }\n\n  get postConfig(): TRecognizerHTTPV2PostConfiguration {\n    switch (this.configuration.recognition.type) {\n      case \"SHAPE\":\n        return {\n          lang: this.configuration.recognition.lang,\n          diagram: this.configuration.recognition.shape,\n          export: this.configuration.recognition.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.configuration.recognition.lang,\n          math: this.configuration.recognition.math,\n          export: this.configuration.recognition.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.configuration.recognition.lang,\n          \"raw-content\": this.configuration.recognition[\"raw-content\"],\n          export: this.configuration.recognition.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.configuration.recognition.lang,\n          text: this.configuration.recognition.text,\n          export: this.configuration.recognition.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${this.configuration.recognition.type}\"`)\n        break\n    }\n  }\n\n  protected formatStrokes(strokes: TStroke[]): TStrokeToSend[] {\n    return strokes.map(s => {\n      return {\n        id: s.id,\n        pointerType: s.pointerType,\n        p: s.pointers.map(p => p.p),\n        t: s.pointers.map(p => p.t),\n        x: s.pointers.map(p => p.x),\n        y: s.pointers.map(p => p.y)\n      }\n    })\n  }\n\n  protected buildData(strokes: TStroke[]): TRecognizerHTTPV2PostData {\n    this.#logger.info(\"buildData\", { strokes })\n\n    const contentType: string = this.configuration.recognition.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.configuration.recognition.type.charAt(0).toUpperCase() + this.configuration.recognition.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      scaleX: 0.265,\n      scaleY: 0.265,\n      contentType,\n      strokes: this.formatStrokes(strokes)\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown> {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", mimeType)\n    headers.append(\"applicationKey\", this.configuration.server.applicationKey)\n    try {\n      const hmac = await computeHmac(JSON.stringify(data), this.configuration.server.applicationKey, this.configuration.server.hmacKey)\n      headers.append(\"hmac\", hmac)\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n\n    if (this.configuration.server.version && isVersionSuperiorOrEqual(this.configuration.server.version, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"3.0.0\")\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data)\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRecognizerHTTPV2PostData, mimeType: string): Promise<TExport | never> {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) => {\n        const exports: TExport = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) => {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[] {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"SHAPE\":\n          mimeTypes = this.configuration.recognition.shape.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${this.configuration.recognition.type}\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT\\n -SHAPE`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async send(strokes: TStroke[]): Promise<TExport> {\n    this.#logger.info(\"send\", strokes)\n    let recognition: TExport = {}\n\n    if (strokes.length === 0) {\n      return Promise.resolve(recognition)\n    }\n    if (this.configuration.recognition.type) {\n      const mimeTypes = this.getMimeTypes()\n      if (!mimeTypes.length) {\n        const error = new Error(\"send failed, no mimeTypes define in recognition configuration\")\n        this.#logger.error(\"send\", error)\n        return Promise.reject(error)\n      }\n      const data = this.buildData(strokes)\n      const exports: TExport[] = await Promise.all(mimeTypes.map(mimeType => this.tryFetch(data, mimeType)))\n      exports.forEach(e => {\n        Object.assign(recognition, e)\n      })\n    }\n    else {\n      const data = this.buildData(strokes)\n      recognition = await this.tryFetch(data, \"application/vnd.myscript.jiix\")\n    }\n\n    this.#logger.debug(\"send\", recognition)\n    return recognition\n  }\n}\n","import { TGesture } from \"../gesture\"\nimport { TExport } from \"../model\"\n\n/**\n * @group Recognizer\n */\nexport enum TRecognizerWebSocketMessageType\n{\n  HMAC_Challenge = \"hmacChallenge\",\n  Authenticated = \"authenticated\",\n  SessionDescription = \"sessionDescription\",\n  NewPart = \"newPart\",\n  PartChanged = \"partChanged\",\n  ContentChanged = \"contentChanged\",\n  Idle = \"idle\",\n  Pong = \"pong\",\n  Exported = \"exported\",\n  GestureDetected = \"gestureDetected\",\n  ContextlessGesture = \"contextlessGesture\",\n  Error = \"error\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessage<T = string> = {\n  type: T\n  [key: string]: unknown\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageAuthenticated = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Authenticated>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageHMACChallenge = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.HMAC_Challenge> & {\n  hmacChallenge: string\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TInteractiveInkSessionDescriptionMessage = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.SessionDescription> & {\n  contentPartCount: number\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageNewPart = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.NewPart> & {\n  id: string\n  idx: null\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessagePartChange = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.PartChanged> & {\n  partIdx: number\n  partId: string\n  partCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageContentChange = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.ContentChanged> & {\n  partId: string\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  undoStackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageExport = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Exported> & {\n  partId: string\n  exports: TExport\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageGesture = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.GestureDetected> & TGesture\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageContextlessGesture = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.ContextlessGesture> & {\n  gestureType: \"none\" | \"scratch\" | \"left-right\" | \"right-left\" | \"bottom-top\" | \"top-bottom\" | \"surround\",\n  strokeId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessagePong = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Pong>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageIdle = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Idle>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageError = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Error> & {\n  code?: number | string\n  message?: string\n  data?: {\n    code: number | string\n    message: string\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageReceived =\n  TRecognizerWebSocketMessageAuthenticated |\n  TRecognizerWebSocketMessageHMACChallenge |\n  TInteractiveInkSessionDescriptionMessage |\n  TRecognizerWebSocketMessageNewPart |\n  TRecognizerWebSocketMessagePartChange |\n  TRecognizerWebSocketMessageContentChange |\n  TRecognizerWebSocketMessageExport |\n  TRecognizerWebSocketMessageGesture |\n  TRecognizerWebSocketMessageContextlessGesture |\n  TRecognizerWebSocketMessagePong |\n  TRecognizerWebSocketMessageIdle |\n  TRecognizerWebSocketMessageError\n","import { mergeDeep, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { TExportConfiguration, TTextConfConfiguration } from \"./recognition\"\nimport { DefaultServerWebsocketConfiguration, TServerWebsocketConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionWebSocketConfiguration = {\n  lang: string\n  export: TExportConfiguration\n  \"raw-content\": {\n    text?: TTextConfConfiguration\n    \"session-time\"?: number\n    recognition?: {\n      types: (\"text\" | \"shape\")[]\n    }\n    classification?: {\n      types: (\"text\" | \"shape\")[]\n    }\n    gestures?: (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n  }\n  gesture: {\n    enable: boolean,\n    ignoreGestureStrokes: boolean\n  }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognitionWebSocketConfiguration: TRecognitionWebSocketConfiguration = {\n  export: {\n    jiix: {\n      \"bounding-box\": true,\n      \"full-stroke-ids\": true,\n      ids: true,\n      strokes: false,\n      text: {\n        chars: true,\n        words: true,\n        lines: true\n      }\n    }\n  },\n  \"raw-content\": {\n    recognition: {\n      types: [\"text\", \"shape\"]\n    },\n    classification: {\n      types: [\"text\", \"shape\"]\n    },\n    gestures: [\"underline\", \"scratch-out\", \"join\", \"insert\", \"strike-through\", \"surround\"]\n  },\n  lang: \"en_US\",\n  gesture: {\n    enable: true,\n    ignoreGestureStrokes: false,\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketConfiguration = {\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketConfiguration: TRecognizerWebSocketConfiguration =\n{\n  server: DefaultServerWebsocketConfiguration,\n  recognition: DefaultRecognitionWebSocketConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketConfiguration implements TRecognizerWebSocketConfiguration\n{\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerWebSocketConfiguration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerWebSocketConfiguration.server, configuration?.server)\n\n    this.recognition = mergeDeep({}, DefaultRecognizerWebSocketConfiguration.recognition, configuration?.recognition)\n    this.recognition.export.jiix[\"full-stroke-ids\"] = true\n    this.recognition.export.jiix.ids = true\n    this.recognition.export.jiix.text.words = true\n    this.recognition.export.jiix.text.chars = true\n    this.recognition.export.jiix.text.lines = true\n    this.recognition.export.jiix[\"bounding-box\"] = true\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration.recognition[\"raw-content\"].recognition.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration.recognition[\"raw-content\"].classification.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.gestures) {\n      this.recognition[\"raw-content\"].gestures = configuration.recognition[\"raw-content\"].gestures as (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n    }\n    if (this.server.version && !isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n      delete this.recognition.export.jiix.text.lines\n      delete this.recognition[\"raw-content\"].classification\n    }\n  }\n}\n","import { TIIHistoryBackendChanges, THistoryContext } from \"../history\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TExport, TJIIXExport } from \"../model\"\nimport { IIStroke } from \"../symbol\"\nimport { TMatrixTransform } from \"../transform\"\nimport { computeHmac, mergeDeep, DeferredPromise, PartialDeep, isVersionSuperiorOrEqual, getApiInfos } from \"../utils\"\nimport\n{\n  TRecognizerWebSocketMessage,\n  TRecognizerWebSocketMessageContentChange,\n  TRecognizerWebSocketMessageContextlessGesture,\n  TRecognizerWebSocketMessageError,\n  TRecognizerWebSocketMessageExport,\n  TRecognizerWebSocketMessageGesture,\n  TRecognizerWebSocketMessageHMACChallenge,\n  TRecognizerWebSocketMessageNewPart,\n  TRecognizerWebSocketMessagePartChange,\n  TRecognizerWebSocketMessageReceived,\n  TRecognizerWebSocketMessageType,\n  TInteractiveInkSessionDescriptionMessage\n} from \"./RecognizerWebSocketMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport PingWorker from \"web-worker:../worker/ping.worker.ts\"\nimport { RecognizerEvent } from \"./RecognizerEvent\"\nimport { RecognizerWebSocketConfiguration, TRecognizerWebSocketConfiguration } from \"./RecognizerWebSocketConfiguration\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------- Client --------------------------------------------------------------- Server ---------------\n * { type: \"authenticate\" }                           ==================>\n *                                                    <==================       { type: \"hmacChallenge\" }\n * { type: \"hmac\" }                                   ==================>\n *                                                    <==================       { type: \"authenticated\" }\n * { type: \"initSession\" | \"restoreSession\" }         ==================>\n *                                                    <==================       { type: \"sessionDescription\" }\n * { type: \"newContentPart\" | \"openContentPart\" }     ==================>\n *                                                    <==================       { type: \"partChanged\" }\n * { type: \"addStrokes\" }                             ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"transform\" }                              ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"eraseStrokes\" }                           ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n */\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocket\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  protected socket!: WebSocket\n  protected pingWorker?: Worker\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected sessionId?: string\n  protected currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected addStrokeDeferred?: DeferredPromise<TRecognizerWebSocketMessageGesture | undefined>\n  protected contextlessGestureDeferred: Map<string, DeferredPromise<TRecognizerWebSocketMessageContextlessGesture>>\n  protected transformStrokeDeferred?: DeferredPromise<void>\n  protected eraseStrokeDeferred?: DeferredPromise<void>\n  protected replaceStrokeDeferred?: DeferredPromise<void>\n  protected exportDeferredMap: Map<string, DeferredPromise<TExport>>\n  protected closeDeferred?: DeferredPromise<void>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<void>\n  protected redoDeferred?: DeferredPromise<void>\n  protected clearDeferred?: DeferredPromise<void>\n\n  configuration: RecognizerWebSocketConfiguration\n  initialized: DeferredPromise<void>\n  url: string\n  event: RecognizerEvent\n\n  constructor(config: PartialDeep<TRecognizerWebSocketConfiguration>, event?: RecognizerEvent)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerWebSocketConfiguration(config)\n    const scheme = (this.configuration.server.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.configuration.server.host }/api/v4.0/iink/offscreen?applicationKey=${ this.configuration.server.applicationKey }`\n\n    this.event = event || new RecognizerEvent()\n    this.initialized = new DeferredPromise<void>()\n    this.exportDeferredMap = new Map()\n    this.contextlessGestureDeferred = new Map()\n  }\n\n  get mimeTypes(): string[]\n  {\n    return [\"application/vnd.myscript.jiix\"]\n  }\n\n  async #send(message: TRecognizerWebSocketMessage): Promise<void>\n  {\n    if (!this.socket) {\n      throw new Error(\"Recognizer must be initilized\")\n    }\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.socket.send(JSON.stringify(message))\n    }\n    else {\n      throw new Error(`Can not send message: ${message.type}, connection not ready, state: ${ this.socket.readyState }`)\n    }\n  }\n\n  protected rejectDeferredPending(error: Error | string): void\n  {\n    this.initialized.reject(error)\n    this.addStrokeDeferred?.reject(error)\n    this.transformStrokeDeferred?.reject(error)\n    this.eraseStrokeDeferred?.reject(error)\n    this.replaceStrokeDeferred?.reject(error)\n    this.undoDeferred?.reject(error)\n    this.redoDeferred?.reject(error)\n    this.clearDeferred?.reject(error)\n    Array.from(this.contextlessGestureDeferred.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    Array.from(this.exportDeferredMap.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    this.waitForIdleDeferred?.reject(error)\n  }\n\n  protected resetAllDeferred(): void\n  {\n    this.initialized = new DeferredPromise<void>()\n    this.addStrokeDeferred = undefined\n    this.contextlessGestureDeferred.clear()\n    this.transformStrokeDeferred = undefined\n    this.eraseStrokeDeferred = undefined\n    this.replaceStrokeDeferred = undefined\n    this.exportDeferredMap.clear()\n    this.waitForIdleDeferred = undefined\n    this.closeDeferred = undefined\n  }\n\n  protected clearSocketListener(): void\n  {\n    this.socket.removeEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.removeEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.removeEventListener(\"message\", this.messageCallback.bind(this))\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    this.#logger.info(\"closeCallback\", { evt })\n    let message = evt.reason\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    this.clearSocketListener()\n    this.closeDeferred?.resolve()\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message)\n      this.event.emitError(error)\n      this.rejectDeferredPending(message)\n    }\n    this.pingWorker?.terminate()\n    this.resetAllDeferred()\n  }\n\n  protected openCallback(): void\n  {\n    this.reconnectionCount = 0\n    this.#send({\n      type: \"authenticate\",\n      \"myscript-client-name\": \"iink-ts\",\n      \"myscript-client-version\": \"3.0.0\",\n    })\n  }\n\n  protected async manageHMACChallenge(hmacChallengeMessage: TRecognizerWebSocketMessageHMACChallenge): Promise<void>\n  {\n    this.#send({\n      type: \"hmac\",\n      hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.configuration.server.applicationKey, this.configuration.server.hmacKey)\n    })\n  }\n\n  protected initPing(): void\n  {\n    this.pingWorker = new PingWorker()\n    this.pingWorker.postMessage({\n      pingDelay: this.configuration.server.websocket.pingDelay,\n    })\n    this.pingWorker.onmessage = () =>\n    {\n      if (this.socket.readyState <= 1) {\n        if (this.pingCount < this.configuration.server.websocket.maxPingLostCount) {\n          this.send({ type: \"ping\" })\n        }\n        else {\n          this.close(1000, \"MAXIMUM_PING_REACHED\")\n          this.pingWorker?.terminate()\n        }\n        this.pingCount++\n      }\n    }\n  }\n\n  protected manageAuthenticated(): void\n  {\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n      delete this.configuration.recognition[\"raw-content\"].classification\n    }\n    const pixelTomm = 25.4 / 96\n    this.#send({\n      type: this.sessionId ? \"restoreSession\" : \"initSession\",\n      iinkSessionId: this.sessionId,\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      configuration: this.configuration.recognition\n    })\n  }\n\n  protected manageSessionDescriptionMessage(sessionDescriptionMessage: TInteractiveInkSessionDescriptionMessage): void\n  {\n    if (sessionDescriptionMessage.iinkSessionId) {\n      this.sessionId = sessionDescriptionMessage.iinkSessionId\n      this.event.emitSessionOpened(this.sessionId)\n    }\n    if (this.currentPartId) {\n      this.#send({ type: \"openContentPart\", id: this.currentPartId })\n    }\n    else {\n      this.#send({ type: \"newContentPart\", contentType: \"Raw Content\", mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected manageNewPartMessage(newPartMessage: TRecognizerWebSocketMessageNewPart): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = newPartMessage.id\n  }\n\n  protected managePartChangeMessage(partChangeMessage: TRecognizerWebSocketMessagePartChange): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = partChangeMessage.partId\n  }\n\n  protected manageContentChangedMessage(contentChangeMessage: TRecognizerWebSocketMessageContentChange): void\n  {\n    this.initialized.resolve()\n    this.replaceStrokeDeferred?.resolve()\n    this.transformStrokeDeferred?.resolve()\n    this.eraseStrokeDeferred?.resolve()\n    this.undoDeferred?.resolve()\n    this.redoDeferred?.resolve()\n    this.clearDeferred?.resolve()\n    this.event.emitContentChanged({\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canRedo,\n    } as THistoryContext)\n  }\n\n  protected manageExportMessage(exportMessage: TRecognizerWebSocketMessageExport): void\n  {\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n\n    Object.keys(exportMessage.exports)\n      .forEach(key =>\n      {\n        if (this.exportDeferredMap.has(key)) {\n          this.exportDeferredMap.get(key)!.resolve(exportMessage.exports)\n        }\n      })\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected manageWaitForIdle(): void\n  {\n    this.waitForIdleDeferred?.resolve()\n    this.event.emitIdle(true)\n  }\n\n  protected manageErrorMessage(errorMessage: TRecognizerWebSocketMessageError): void\n  {\n    this.currentErrorCode = errorMessage.data?.code || errorMessage.code\n    let message = errorMessage.data?.message || errorMessage.message || RecognizerError.UNKNOW\n\n    if (this.currentErrorCode === \"no.activity\") {\n      this.rejectDeferredPending(message)\n      this.event.emitConnectionClose({ code: 1000,  message: RecognizerError.NO_ACTIVITY })\n    }\n    else {\n      switch (this.currentErrorCode) {\n        case \"access.not.granted\":\n          message = RecognizerError.WRONG_CREDENTIALS\n          break\n        case \"session.too.old\":\n          message = RecognizerError.TOO_OLD\n          break\n        case \"restore.session.not.found\":\n          message = RecognizerError.NO_SESSION_FOUND\n          break\n      }\n      this.rejectDeferredPending(message)\n      this.event.emitError(new Error(message))\n    }\n  }\n\n  protected manageGestureDetected(gestureMessage: TRecognizerWebSocketMessageGesture): void\n  {\n    this.addStrokeDeferred?.resolve(gestureMessage)\n  }\n\n  protected manageContextlessGesture(gestureMessage: TRecognizerWebSocketMessageContextlessGesture): void\n  {\n    this.contextlessGestureDeferred.get(gestureMessage.strokeId)?.resolve(gestureMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.currentErrorCode = undefined\n    try {\n      const websocketMessage: TRecognizerWebSocketMessageReceived = JSON.parse(message.data)\n      if (websocketMessage.type === TRecognizerWebSocketMessageType.Pong) {\n        return\n      }\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case TRecognizerWebSocketMessageType.HMAC_Challenge:\n          this.manageHMACChallenge(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Authenticated:\n          this.manageAuthenticated()\n          break\n        case TRecognizerWebSocketMessageType.SessionDescription:\n          this.manageSessionDescriptionMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.NewPart:\n          this.manageNewPartMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.PartChanged:\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.ContentChanged:\n          this.manageContentChangedMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Exported:\n          this.manageExportMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.GestureDetected:\n          this.manageGestureDetected(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.ContextlessGesture:\n          this.manageContextlessGesture(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Error:\n          this.manageErrorMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Idle:\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage }\".`)\n          break\n      }\n    }\n    catch {\n      this.event.emitError(new Error(message.data))\n    }\n  }\n\n  async newSession(config: PartialDeep<TRecognizerWebSocketConfiguration>): Promise<void>\n  {\n    await this.close(1000, \"new-session\")\n    this.configuration = mergeDeep({}, this.configuration, config)\n    this.sessionId = undefined\n    this.currentPartId = undefined\n    await this.init()\n  }\n\n  async init(): Promise<void>\n  {\n    this.event.emitStartInitialization()\n    if (this.currentErrorCode === \"restore.session.not.found\") {\n      this.currentErrorCode = undefined\n      this.sessionId = undefined\n      this.currentPartId = undefined\n    }\n    this.initialized = new DeferredPromise<void>()\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n    this.socket = new WebSocket(this.url)\n    this.clearSocketListener()\n    this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n    await this.initialized.promise\n    if (this.configuration.server.websocket.pingEnabled) {\n      this.pingCount = 0\n      this.initPing()\n    }\n    this.event.emitEndtInitialization()\n  }\n\n  async send(message: TRecognizerWebSocketMessage): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n\n    switch (this.socket.readyState) {\n      case this.socket.CONNECTING:\n      case this.socket.OPEN:\n        await this.initialized.promise\n        this.#send(message)\n        return Promise.resolve()\n      case this.socket.CLOSING:\n      case this.socket.CLOSED:\n        if (this.configuration.server.websocket.autoReconnect) {\n          this.reconnectionCount++\n          if (this.configuration.server.websocket.maxRetryCount > this.reconnectionCount) {\n            await this.init()\n            await this.waitForIdle()\n            return this.#send(message)\n          }\n          else {\n            return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n          }\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. Connection closed and automatic reconnection disabled\"))\n        }\n        break\n    }\n  }\n\n  protected buildAddStrokesMessage(strokes: IIStroke[], processGestures = true): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"addStrokes\",\n      processGestures,\n      strokes: strokes.map(s => s.formatToSend())\n    }\n  }\n  async addStrokes(strokes: IIStroke[], processGestures = true): Promise<TRecognizerWebSocketMessageGesture | undefined>\n  {\n    this.addStrokeDeferred = new DeferredPromise<TRecognizerWebSocketMessageGesture | undefined>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve(undefined)\n      return this.addStrokeDeferred?.promise\n    }\n    await this.send(this.buildAddStrokesMessage(strokes, processGestures))\n    return this.addStrokeDeferred?.promise\n  }\n\n  protected buildReplaceStrokesMessage(oldStrokeIds: string[], newStrokes: IIStroke[]): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"replaceStrokes\",\n      oldStrokeIds,\n      newStrokes: newStrokes.map(s => s.formatToSend())\n    }\n  }\n  async replaceStrokes(oldStrokeIds: string[], newStrokes: IIStroke[]): Promise<void>\n  {\n    this.replaceStrokeDeferred = new DeferredPromise<void>()\n    if (oldStrokeIds.length === 0) {\n      this.replaceStrokeDeferred.resolve()\n      return this.replaceStrokeDeferred?.promise\n    }\n    await this.send(this.buildReplaceStrokesMessage(oldStrokeIds, newStrokes))\n    return this.replaceStrokeDeferred?.promise\n  }\n\n  protected buildTransformTranslateMessage(strokeIds: string[], tx: number, ty: number): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"TRANSLATE\",\n      strokeIds,\n      tx,\n      ty\n    }\n  }\n  async transformTranslate(strokeIds: string[], tx: number, ty: number): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformTranslateMessage(strokeIds, tx, ty))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformRotateMessage(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"ROTATE\",\n      strokeIds,\n      angle,\n      x0,\n      y0\n    }\n  }\n  async transformRotate(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformRotateMessage(strokeIds, angle, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformScaleMessage(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"SCALE\",\n      strokeIds,\n      scaleX,\n      scaleY,\n      x0,\n      y0\n    }\n  }\n  async transformScale(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformScaleMessage(strokeIds, scaleX, scaleY, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformMatrixMessage(strokeIds: string[], matrix: TMatrixTransform): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"MATRIX\",\n      strokeIds,\n      ...matrix\n    }\n  }\n  async transformMatrix(strokeIds: string[], matrix: TMatrixTransform): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformMatrixMessage(strokeIds, matrix))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildEraseStrokesMessage(strokeIds: string[]): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"eraseStrokes\",\n      strokeIds\n    }\n  }\n  async eraseStrokes(strokeIds: string[]): Promise<void>\n  {\n    this.eraseStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.eraseStrokeDeferred.resolve()\n      return this.eraseStrokeDeferred?.promise\n    }\n    await this.send(this.buildEraseStrokesMessage(strokeIds))\n    return this.eraseStrokeDeferred?.promise\n  }\n\n  async recognizeGesture(stroke: IIStroke): Promise<TRecognizerWebSocketMessageContextlessGesture | undefined>\n  {\n    if (!stroke) {\n      return\n    }\n    this.contextlessGestureDeferred.set(stroke.id, new DeferredPromise<TRecognizerWebSocketMessageContextlessGesture>())\n    const pixelTomm = 25.4 / 96\n    await this.send({\n      type: \"contextlessGesture\",\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      stroke: stroke.formatToSend()\n    })\n    return this.contextlessGestureDeferred.get(stroke.id)!.promise\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    if (!this.waitForIdleDeferred || this.waitForIdleDeferred.isFullFilled) {\n      this.waitForIdleDeferred = new DeferredPromise<void>()\n    }\n    const message: TRecognizerWebSocketMessage = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  protected buildUndoRedoChanges(changes: TIIHistoryBackendChanges): TRecognizerWebSocketMessage[]\n  {\n    const changesMessages: TRecognizerWebSocketMessage[] = []\n    if (changes.added?.length) {\n      changesMessages.push(this.buildAddStrokesMessage(changes.added, false))\n    }\n    if (changes.erased?.length) {\n      changesMessages.push(this.buildEraseStrokesMessage(changes.erased.map(s => s.id)))\n    }\n    if (changes.replaced?.newStrokes.length) {\n      changesMessages.push(this.buildReplaceStrokesMessage(changes.replaced.oldStrokes.map(s => s.id), changes.replaced.newStrokes))\n    }\n    if (changes.matrix?.strokes.length) {\n      changesMessages.push(this.buildTransformMatrixMessage(changes.matrix.strokes.map(s => s.id), changes.matrix.matrix))\n    }\n    if (changes.translate?.length) {\n      changes.translate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformTranslateMessage(tr.strokes.map(s => s.id), tr.tx, tr.ty))\n      })\n    }\n    if (changes.rotate?.length) {\n      changes.rotate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformRotateMessage(tr.strokes.map(s => s.id), tr.angle, tr.center.x, tr.center.y))\n      })\n    }\n    if (changes.scale?.length) {\n      changes.scale.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformScaleMessage(tr.strokes.map(s => s.id), tr.scaleX, tr.scaleY, tr.origin.x, tr.origin.y))\n      })\n    }\n    return changesMessages\n  }\n\n  async undo(actions: TIIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.undoDeferred = new DeferredPromise<void>()\n    const message: TRecognizerWebSocketMessage = {\n      type: \"undo\",\n      changes\n    }\n    await this.send(message)\n    return this.undoDeferred?.promise\n  }\n\n  async redo(actions: TIIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.redoDeferred = new DeferredPromise<void>()\n\n    const message: TRecognizerWebSocketMessage = {\n      type: \"redo\",\n      changes\n    }\n    await this.send(message)\n    return this.redoDeferred?.promise\n  }\n\n  async export(requestedMimeTypes?: string[]): Promise<TExport>\n  {\n    const mimeTypes: string[] = requestedMimeTypes || this.mimeTypes.slice()\n    await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)?.promise))\n    mimeTypes.forEach(mt =>\n    {\n      this.exportDeferredMap.set(mt, new DeferredPromise<TExport>())\n    })\n\n    const message: TRecognizerWebSocketMessage = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports = await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)!.promise))\n    return Object.assign({}, ...exports)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.clearDeferred = new DeferredPromise<void>()\n    await this.send({\n      type: \"clear\"\n    })\n    return this.clearDeferred?.promise\n  }\n\n  async close(code: number, reason: string): Promise<void>\n  {\n    this.resetAllDeferred()\n    this.closeDeferred = new DeferredPromise<void>()\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.socket.close(code, reason)\n    }\n    else {\n      this.closeDeferred.resolve()\n    }\n    await this.closeDeferred.promise\n  }\n\n  async destroy(): Promise<void>\n  {\n    if (this.socket) {\n      await this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { isVersionSuperiorOrEqual, mergeDeep, PartialDeep } from \"../utils\"\nimport {\n  DefaultExportConfiguration,\n  DefaultMathConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultTextConfiguration,\n  TConvertionConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration\n} from \"./recognition\"\nimport { TRecognitionType } from \"./RecognitionConfiguration\"\nimport { DefaultServerWebsocketConfiguration, TServerWebsocketConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketSSRRecognitionConfiguration = {\n  type: Omit<TRecognitionType, \"DIAGRAM\" | \"Raw Content\">\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketSSRRecognitionConfiguration: TRecognizerWebSocketSSRRecognitionConfiguration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketSSRConfiguration = {\n  server: TServerWebsocketConfiguration\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketSSRConfiguration: TRecognizerWebSocketSSRConfiguration =\n{\n  server: DefaultServerWebsocketConfiguration,\n  recognition: DefaultRecognizerWebSocketSSRRecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketSSRConfiguration implements TRecognizerWebSocketSSRConfiguration\n{\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n  server: TServerWebsocketConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerWebSocketSSRConfiguration>) {\n    this.server = mergeDeep({}, DefaultRecognizerWebSocketSSRConfiguration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerWebSocketSSRConfiguration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { Stroke } from \"../symbol\"\nimport { StyleHelper, TPenStyle, TTheme } from \"../style\"\nimport { THistoryContext } from \"../history\"\nimport { DeferredPromise, PartialDeep, computeHmac, getApiInfos, isVersionSuperiorOrEqual } from \"../utils\"\nimport\n{\n  TRecognizerWebSocketSSRMessage,\n  TRecognizerWebSocketSSRMessageContentChange,\n  TRecognizerWebSocketSSRMessageError,\n  TRecognizerWebSocketSSRMessageExport,\n  TRecognizerWebSocketSSRMessageHMACChallenge,\n  TRecognizerWebSocketSSRMessagePartChange,\n  TRecognizerWebSocketSSRMessageSVGPatch\n} from \"./RecognizerWebSocketSSRMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerEvent } from \"./RecognizerEvent\"\nimport { TRecognizerWebSocketSSRConfiguration, RecognizerWebSocketSSRConfiguration } from \"./RecognizerWebSocketSSRConfiguration\"\nimport { TConverstionState } from \"./RecognitionConfiguration\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------------------- Client --------------------------------------------------- Server ----------------------------------\n * init: send newContentPackage or restoreIInkSession           ==================>\n *                                                              <==================       ack\n * answer ack:\n *  send the hmac (if enable)                                   ==================>\n *  send the configuration                                      ==================>\n *                                                              <==================       contentPackageDescription\n * answer contentPackageDescription:\n *  send newContentPart or openContentPart                      ==================>\n *                                                              <==================        partChanged\n *                                                              <==================        contentChanged\n *                                                              <==================        newPart\n *                                                              <==================        svgPatch\n *\n * setPenStyle (send the parameters)                            ==================>\n * setTheme (send the parameters)                               ==================>\n * setPenStyleClasses (send the parameters)                     ==================>\n *                                                              <==================        svgPatch\n * addStrokes (send the strokes ) ============>\n *                                                              <==================        update\n */\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketSSR\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  protected socket!: WebSocket\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected viewSizeHeight!: number\n  protected viewSizeWidth!: number\n  protected sessionId?: string\n  // contentPartCount = 0\n  currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected penStyle?: TPenStyle\n  protected penStyleClasses?: string\n  protected theme?: TTheme\n\n  protected connected?: DeferredPromise<void>\n  protected ackDeferred?: DeferredPromise<void>\n  protected addStrokeDeferred?: DeferredPromise<TExport>\n  protected exportDeferred?: DeferredPromise<TExport>\n  protected convertDeferred?: DeferredPromise<TExport>\n  protected importDeferred?: DeferredPromise<TExport>\n  protected resizeDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<TExport>\n  protected redoDeferred?: DeferredPromise<TExport>\n  protected clearDeferred?: DeferredPromise<TExport>\n  protected importPointEventsDeferred?: DeferredPromise<TExport>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n\n  configuration: TRecognizerWebSocketSSRConfiguration\n  initialized: DeferredPromise<void>\n  url: string\n  event: RecognizerEvent\n\n  constructor(config?: PartialDeep<TRecognizerWebSocketSSRConfiguration>)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerWebSocketSSRConfiguration(config)\n    const scheme = (this.configuration.server.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.configuration.server.host }/api/v4.0/iink/document?applicationKey=${ this.configuration.server.applicationKey }`\n    this.event = new RecognizerEvent()\n    this.initialized = new DeferredPromise<void>()\n  }\n\n  get mimeTypes(): string[]\n  {\n    switch (this.configuration.recognition.type.toLocaleLowerCase()) {\n      case \"text\":\n        return this.configuration.recognition.text.mimeTypes\n      case \"math\":\n        return this.configuration.recognition.math.mimeTypes\n      default:\n        throw new Error(`Unauthorized recognition type: \"${ this.configuration.recognition.type }\"`)\n    }\n  }\n\n  protected infinitePing(): void\n  {\n    this.pingCount++\n    if (this.configuration.server.websocket.maxPingLostCount < this.pingCount) {\n      this.socket.close(1000, \"MAXIMUM_PING_REACHED\")\n    } else if (this.socket.readyState <= 1) {\n      setTimeout(() =>\n      {\n        if (this.socket.readyState <= 1) {\n          this.socket.send(JSON.stringify({ type: \"ping\" }))\n          this.infinitePing()\n        }\n      }, this.configuration.server.websocket.pingDelay)\n    }\n  }\n\n  protected openCallback(): void\n  {\n    this.connected?.resolve()\n    const params: TRecognizerWebSocketSSRMessage = {\n      type: this.sessionId ? \"restoreIInkSession\" : \"newContentPackage\",\n      iinkSessionId: this.sessionId,\n      applicationKey: this.configuration.server.applicationKey,\n      xDpi: 96,\n      yDpi: 96,\n      viewSizeHeight: this.viewSizeHeight,\n      viewSizeWidth: this.viewSizeWidth\n    }\n    if (isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.0.4\")) {\n      params[\"myscript-client-name\"] = \"iink-ts\"\n      params[\"myscript-client-version\"] = \"3.0.0\"\n    }\n    this.send(params)\n  }\n\n  protected rejectDeferredPending(error: Error): void\n  {\n    if (this.connected?.isPending) {\n      this.connected?.reject(error)\n    }\n    if (this.initialized.isPending) {\n      this.initialized.reject(error)\n    }\n    if (this.addStrokeDeferred?.isPending) {\n      this.addStrokeDeferred?.reject(error)\n    }\n    if (this.exportDeferred?.isPending) {\n      this.exportDeferred?.reject(error)\n    }\n    if (this.importPointEventsDeferred?.isPending) {\n      this.importPointEventsDeferred?.reject(error)\n    }\n    if (this.convertDeferred?.isPending) {\n      this.convertDeferred?.reject(error)\n    }\n    if (this.importDeferred?.isPending) {\n      this.importDeferred?.reject(error)\n    }\n    if (this.resizeDeferred?.isPending) {\n      this.resizeDeferred?.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred?.reject(error)\n    }\n    if (this.undoDeferred?.isPending) {\n      this.undoDeferred?.reject(error)\n    }\n    if (this.redoDeferred?.isPending) {\n      this.redoDeferred?.reject(error)\n    }\n    if (this.clearDeferred?.isPending) {\n      this.clearDeferred.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred.reject(error)\n    }\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    let message = \"\"\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          this.#logger.warn(\"closeCallback\", \"unknow CloseEvent.code\", { evt })\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message || evt.reason)\n      this.rejectDeferredPending(error)\n      this.event.emitError(error)\n    }\n  }\n\n  protected async manageAckMessage(websocketMessage: TRecognizerWebSocketSSRMessage): Promise<void>\n  {\n    this.#logger.info(\"manageAckMessage\", { websocketMessage })\n    const hmacChallengeMessage = websocketMessage as TRecognizerWebSocketSSRMessageHMACChallenge\n    if (hmacChallengeMessage.hmacChallenge) {\n      this.send({\n        type: \"hmac\",\n        hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.configuration.server.applicationKey, this.configuration.server.hmacKey)\n      })\n    }\n    if (hmacChallengeMessage.iinkSessionId) {\n      this.sessionId = hmacChallengeMessage.iinkSessionId\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.3.0\")) {\n      delete this.configuration.recognition.convert\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n    }\n    this.send({ ...this.configuration.recognition, type: \"configuration\" })\n    this.ackDeferred?.resolve()\n  }\n\n  protected async manageContentPackageDescriptionMessage(): Promise<void>\n  {\n    this.reconnectionCount = 0\n    await this.ackDeferred?.promise\n    this.#logger.info(\"manageContentPackageDescriptionMessage\")\n    if (this.currentPartId) {\n      this.send({ type: \"openContentPart\", id: this.currentPartId, mimeTypes: this.mimeTypes })\n    }\n    else {\n      this.send({ type: \"newContentPart\", contentType: this.configuration.recognition.type, mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected managePartChangeMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"managePartChangeMessage\", { websocketMessage })\n    const partChangeMessage = websocketMessage as TRecognizerWebSocketSSRMessagePartChange\n    this.currentPartId = partChangeMessage.partId\n    this.initialized.resolve()\n  }\n\n  protected manageExportMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageExportMessage\", { websocketMessage })\n    const exportMessage = websocketMessage as TRecognizerWebSocketSSRMessageExport\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n    this.initialized.resolve()\n    this.addStrokeDeferred?.resolve(exportMessage.exports)\n    this.exportDeferred?.resolve(exportMessage.exports)\n    this.convertDeferred?.resolve(exportMessage.exports)\n    this.importDeferred?.resolve(exportMessage.exports)\n    this.undoDeferred?.resolve(exportMessage.exports)\n    this.redoDeferred?.resolve(exportMessage.exports)\n    this.clearDeferred?.resolve(exportMessage.exports)\n    this.importPointEventsDeferred?.resolve(exportMessage.exports)\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected async manageWaitForIdle(): Promise<void>\n  {\n    this.event.emitIdle(true)\n    this.waitForIdleDeferred?.resolve()\n  }\n\n  protected manageErrorMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    const err = websocketMessage as TRecognizerWebSocketSSRMessageError\n    this.currentErrorCode = err.data?.code || err.code\n    let message = err.data?.message || err.message || RecognizerError.UNKNOW\n\n    switch (this.currentErrorCode) {\n      case \"no.activity\":\n        message = RecognizerError.NO_ACTIVITY\n        break\n      case \"access.not.granted\":\n        message = RecognizerError.WRONG_CREDENTIALS\n        break\n      case \"session.too.old\":\n        message = RecognizerError.TOO_OLD\n        break\n    }\n    const error = new Error(message)\n    this.rejectDeferredPending(error)\n    this.event.emitError(error)\n  }\n\n  protected manageContentChangeMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageContentChangeMessage\", { websocketMessage })\n    const contentChangeMessage = websocketMessage as TRecognizerWebSocketSSRMessageContentChange\n    const context: THistoryContext = {\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canUndo,\n      empty: contentChangeMessage.empty,\n      stackIndex: contentChangeMessage.undoStackIndex,\n      possibleUndoCount: contentChangeMessage.possibleUndoCount,\n    }\n    this.event.emitContentChanged(context)\n  }\n\n  protected manageSVGPatchMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageSVGPatchMessage\", { websocketMessage })\n    this.resizeDeferred?.resolve()\n    const svgPatchMessage = websocketMessage as TRecognizerWebSocketSSRMessageSVGPatch\n    this.event.emitSVGPatch(svgPatchMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.#logger.debug(\"messageCallback\", { message })\n    this.currentErrorCode = undefined\n    const websocketMessage: TRecognizerWebSocketSSRMessage = JSON.parse(message.data)\n    if (websocketMessage.type !== \"pong\") {\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case \"ack\":\n          this.manageAckMessage(websocketMessage)\n          break\n        case \"contentPackageDescription\":\n          this.manageContentPackageDescriptionMessage()\n          break\n        case \"partChanged\":\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case \"newPart\":\n          this.initialized.resolve()\n          break\n        case \"contentChanged\":\n          this.manageContentChangeMessage(websocketMessage)\n          break\n        case \"exported\":\n          this.manageExportMessage(websocketMessage)\n          break\n        case \"svgPatch\":\n          this.manageSVGPatchMessage(websocketMessage)\n          break\n        case \"error\":\n          this.manageErrorMessage(websocketMessage)\n          break\n        case \"idle\":\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage.type }\".`)\n      }\n    }\n  }\n\n  async init(height: number, width: number): Promise<void>\n  {\n    try {\n      this.event.emitStartInitialization()\n      this.#logger.info(\"init\", { height, width })\n      this.destroy()\n\n      if (!this.configuration.server.version) {\n        this.configuration.server.version = (await getApiInfos(this.configuration)).version\n      }\n      this.connected = new DeferredPromise<void>()\n      this.initialized = new DeferredPromise<void>()\n      this.ackDeferred = new DeferredPromise<void>()\n      this.viewSizeHeight = height\n      this.viewSizeWidth = width\n      this.pingCount = 0\n      this.socket = new WebSocket(this.url)\n\n      if (this.configuration.server.websocket.pingEnabled) {\n        this.infinitePing()\n      }\n\n      this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n      this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n      this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n      this.event.emitEndtInitialization()\n      await this.connected.promise\n      await this.initialized.promise\n    } catch (err: unknown) {\n      this.rejectDeferredPending(err as Error)\n      return this.initialized.promise\n    }\n  }\n\n  async send(message: TRecognizerWebSocketSSRMessage): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n    await this.connected?.promise\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.#logger.debug(\"send\", { message })\n      this.socket.send(JSON.stringify(message))\n      return Promise.resolve()\n    } else {\n      if (this.socket.readyState != this.socket.CONNECTING && this.configuration.server.websocket.autoReconnect) {\n        this.reconnectionCount++\n        if (this.configuration.server.websocket.maxRetryCount >= this.reconnectionCount) {\n          this.#logger.debug(\"send\", `try to reconnect number: ${ this.reconnectionCount }.`)\n          await this.init(this.viewSizeHeight, this.viewSizeWidth)\n          await this.setPenStyle(this.penStyle as TPenStyle)\n          await this.setPenStyleClasses(this.penStyleClasses as string)\n          await this.setTheme(this.theme as TTheme)\n          return this.send(message)\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n        }\n      }\n    }\n  }\n\n  async addStrokes(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"addStrokes\", { strokes })\n    await this.initialized.promise\n    this.addStrokeDeferred = new DeferredPromise<TExport>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve({} as TExport)\n    }\n    else {\n      await this.send({\n        type: \"addStrokes\",\n        strokes: strokes.map(s => s.formatToSend())\n      })\n    }\n    return this.addStrokeDeferred?.promise\n  }\n\n  async setPenStyle(penStyle: TPenStyle): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    await this.initialized.promise\n    this.penStyle = penStyle\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setPenStyle\",\n      style: StyleHelper.penStyleToCSS(penStyle)\n    }\n    return this.send(message)\n  }\n\n  async setPenStyleClasses(penStyleClasses: string): Promise<void>\n  {\n    await this.initialized.promise\n    this.penStyleClasses = penStyleClasses\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setPenStyleClasses\",\n      styleClasses: penStyleClasses\n    }\n    return this.send(message)\n  }\n\n  async setTheme(theme: TTheme): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    await this.initialized.promise\n    this.theme = theme\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setTheme\",\n      theme: StyleHelper.themeToCSS(theme)\n    }\n    return this.send(message)\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    await this.initialized.promise\n    this.exportDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.configuration.recognition.type }\" is unknown.\\n Possible types are:\\n -MATH\\n -TEXT`)\n      }\n    }\n\n    if (!mimeTypes.length) {\n      return Promise.reject(new Error(`Export failed, no mimeTypes define in recognition ${ this.configuration.recognition.type } configuration`))\n    }\n\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports: TExport = await this.exportDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(exports)\n    this.#logger.debug(\"export\", { model: localModel })\n    return localModel\n  }\n\n  async import(model: Model, data: Blob, mimeType?: string): Promise<Model>\n  {\n    this.#logger.info(\"import\", { data, mimeType })\n    await this.initialized.promise\n    const localModel = model.clone()\n    const chunkSize = this.configuration.server.websocket.fileChunkSize\n    const importFileId = Math.random().toString(10).substring(2, 6)\n    this.importDeferred = new DeferredPromise<TExport>()\n    const readBlob = (blob: Blob): Promise<string | never> =>\n    {\n      const fileReader = new FileReader()\n      return new Promise((resolve, reject) =>\n      {\n        fileReader.onloadend = (ev) => resolve(ev.target?.result as string)\n        fileReader.onerror = () => reject()\n        fileReader.readAsText(blob)\n      })\n    }\n\n    const importFileMessage: TRecognizerWebSocketSSRMessage = {\n      type: \"importFile\",\n      importFileId,\n      mimeType\n    }\n    await this.send(importFileMessage)\n    for (let i = 0; i < data.size; i += chunkSize) {\n      const blobPart = data.slice(i, i + chunkSize, data.type)\n      const partFileString = await readBlob(blobPart)\n      const fileChuckMessage: TRecognizerWebSocketSSRMessage = {\n        type: \"fileChunk\",\n        importFileId,\n        data: partFileString,\n        lastChunk: i + chunkSize > data.size\n      }\n      await this.send(fileChuckMessage)\n    }\n    const exports = await this.importDeferred?.promise\n    this.importDeferred = undefined\n    localModel.mergeExport(exports)\n    return localModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    await this.initialized.promise\n    this.resizeDeferred = new DeferredPromise<void>()\n    const localModel = model.clone()\n    this.viewSizeHeight = localModel.height\n    this.viewSizeWidth = localModel.width\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"changeViewSize\",\n      height: this.viewSizeHeight,\n      width: this.viewSizeWidth,\n    }\n    await this.send(message)\n    await this.resizeDeferred?.promise\n    return localModel\n  }\n\n  async importPointEvents(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"importPointsEvents\", { strokes })\n    await this.initialized.promise\n    this.importPointEventsDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"pointerEvents\",\n      events: strokes.map(s => s.formatToSend())\n    }\n    await this.send(message)\n    return this.importPointEventsDeferred?.promise\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState })\n    await this.initialized.promise\n    this.convertDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"convert\",\n      conversionState\n    }\n    await this.send(message)\n    const myExportConverted: TExport = await this.convertDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeConvert(myExportConverted)\n    this.#logger.debug(\"convert\", { model: localModel })\n    return localModel\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    await this.initialized.promise\n    this.waitForIdleDeferred = new DeferredPromise<void>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  async undo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"undo\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    this.undoDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"undo\",\n    }\n    await this.send(message)\n    const undoExports = await this.undoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(undoExports)\n    this.#logger.debug(\"undo\", { model: localModel })\n    this.undoDeferred = undefined\n    return localModel\n  }\n\n  async redo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"redo\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    this.redoDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"redo\",\n    }\n    await this.send(message)\n    const redoExports = await this.redoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(redoExports)\n    this.#logger.debug(\"redo\", { model: redoExports })\n    this.redoDeferred = undefined\n    return localModel\n  }\n\n  async clear(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"clear\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    localModel.modificationDate = Date.now()\n    this.clearDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"clear\",\n    }\n    await this.send(message)\n    const clearExports = await this.clearDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(clearExports)\n    this.clearDeferred = undefined\n    this.#logger.info(\"clear\", { model: localModel })\n    return localModel\n  }\n\n  close(code: number, reason: string): void\n  {\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.#logger.info(\"close\", { code, reason })\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.socket.close(code, reason)\n    }\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.connected = undefined\n    this.ackDeferred = undefined\n    this.addStrokeDeferred = undefined\n    this.exportDeferred = undefined\n    this.convertDeferred = undefined\n    this.importDeferred = undefined\n    this.importPointEventsDeferred = undefined\n    this.waitForIdleDeferred = undefined\n    this.resizeDeferred = undefined\n    this.undoDeferred = undefined\n    this.redoDeferred = undefined\n    this.clearDeferred = undefined\n    if (this.socket) {\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TPoint, TCanvasShapeEllipseSymbol, TCanvasShapeLineSymbol, TCanvasShapeTableSymbol, TSymbol } from \"../../symbol\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererShape\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  symbols = {\n    table: \"table\",\n    ellipse: \"ellipse\",\n    line: \"line\"\n  }\n\n  protected phi(angle: number): number\n  {\n    let returnedAngle = ((angle + Math.PI) % (Math.PI * 2)) - Math.PI\n    if (returnedAngle < -Math.PI) {\n      returnedAngle += Math.PI * 2\n    }\n    this.#logger.debug(\"phi\", { angle, returnedAngle })\n    return returnedAngle\n  }\n\n  protected drawEllipseArc(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol): TPoint[]\n  {\n    this.#logger.debug(\"drawEllipseArc\", { context2D, shapeEllipse })\n    const { centerPoint, maxRadius, minRadius, orientation, startAngle, sweepAngle } = shapeEllipse\n    const angleStep = 0.02\n    const z1 = Math.cos(orientation) * maxRadius\n    const z2 = Math.cos(orientation) * minRadius\n    const z3 = Math.sin(orientation) * maxRadius\n    const z4 = Math.sin(orientation) * minRadius\n    const n = Math.floor(Math.abs(sweepAngle) / angleStep)\n    const boundariesPoints = []\n    context2D.save()\n    try {\n      context2D.beginPath()\n      for (let i = 0; i <= n; i++) {\n        const angle = startAngle + ((i / n) * sweepAngle)\n        const alpha = Math.atan2(Math.sin(angle) / minRadius, Math.cos(angle) / maxRadius)\n        const cosAlpha = Math.cos(alpha)\n        const sinAlpha = Math.sin(alpha)\n        const x = (centerPoint.x + (z1 * cosAlpha)) - (z4 * sinAlpha)\n        const y = (centerPoint.y + (z2 * sinAlpha)) + (z3 * cosAlpha)\n        if (i === 0) {\n          context2D.moveTo(x, y)\n        } else {\n          context2D.lineTo(x, y)\n        }\n        if (i === 0 || i === n) {\n          boundariesPoints.push({ x, y })\n        }\n      }\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawEllipseArc\", { error })\n    } finally {\n      context2D.restore()\n    }\n    return boundariesPoints\n  }\n\n  protected drawLine(context2D: CanvasRenderingContext2D, p1: TPoint, p2: TPoint)\n  {\n    this.#logger.debug(\"drawLine\", { context2D, p1, p2 })\n    context2D.save()\n    try {\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawLine\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawArrowHead(context2D: CanvasRenderingContext2D, headPoint: TPoint, angle: number, length: number)\n  {\n    this.#logger.debug(\"drawArrowHead\", { context2D, headPoint, angle, length })\n    const alpha = this.phi(angle + (Math.PI * (7 / 8)))\n    const beta = this.phi(angle - (Math.PI * (7 / 8)))\n    context2D.save()\n    try {\n      context2D.fillStyle = context2D.strokeStyle\n\n      context2D.moveTo(headPoint.x, headPoint.y)\n      context2D.beginPath()\n      context2D.lineTo(headPoint.x + (length * Math.cos(alpha)), headPoint.y + (length * Math.sin(alpha)))\n      context2D.lineTo(headPoint.x + (length * Math.cos(beta)), headPoint.y + (length * Math.sin(beta)))\n      context2D.lineTo(headPoint.x, headPoint.y)\n      context2D.fill()\n    } catch(error) {\n      this.#logger.error(\"drawArrowHead\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawShapeEllipse(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol)\n  {\n    this.#logger.debug(\"drawShapeEllipse\", { context2D, shapeEllipse })\n    const points = this.drawEllipseArc(context2D, shapeEllipse)\n\n    if (shapeEllipse?.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[0], shapeEllipse.beginTangentAngle, 12.0)\n    }\n    if (shapeEllipse?.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[1], shapeEllipse.endTangentAngle, 12.0)\n    }\n  }\n\n  protected drawShapeLine(context2D: CanvasRenderingContext2D, shapeLine: TCanvasShapeLineSymbol)\n  {\n    this.#logger.debug(\"drawShapeLine\", { context2D, shapeLine })\n    this.drawLine(context2D, shapeLine.firstPoint, shapeLine.lastPoint)\n    if (shapeLine.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.firstPoint, shapeLine.beginTangentAngle, 12.0)\n    }\n    if (shapeLine.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.lastPoint, shapeLine.endTangentAngle, 12.0)\n    }\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.save()\n    context2D.lineWidth = symbol.style.width as number\n    context2D.strokeStyle = symbol.style.color as string\n\n    switch (symbol.type) {\n      case this.symbols.table: {\n        const tableSymbols = symbol as TCanvasShapeTableSymbol\n        tableSymbols.lines.forEach(line => this.drawLine(context2D, line.p1, line.p2))\n        break\n      }\n      case this.symbols.ellipse: {\n        this.drawShapeEllipse(context2D, symbol as TCanvasShapeEllipseSymbol)\n        break\n      }\n      case this.symbols.line: {\n        this.drawShapeLine(context2D, symbol as TCanvasShapeLineSymbol)\n        break\n      }\n      default:\n        this.#logger.warn(\"draw\", `${ symbol.type } not implemented`)\n        break\n    }\n  }\n\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Stroke, TPointer } from \"../../symbol\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererStroke\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  protected renderArc(context2d: CanvasRenderingContext2D, center: TPointer, radius: number): void\n  {\n    this.#logger.debug(\"renderArc\", { context2d, center, radius })\n    context2d.arc(center.x, center.y, radius, 0, Math.PI * 2, true)\n  }\n\n  protected renderLine(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderLine\", { context2d, begin, end, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.lineTo(linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.lineTo(linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  protected renderFinal(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderFinal\", { context2d, begin, end, width })\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    context2d.moveTo(linkPoints[0].x, linkPoints[0].y)\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - ((i * Math.PI) / ARCSPLIT)\n      context2d.lineTo(end.x - ((end.p * width) * Math.sin(newAngle)), end.y + (end.p * width * Math.cos(newAngle)))\n    }\n  }\n\n  protected renderQuadratic(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, ctrl: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderQuadratic\", { context2d, begin, end, ctrl, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, ctrl), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(ctrl, end), width)\n    const linkPoints3 = computeLinksPointers(ctrl, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.quadraticCurveTo(linkPoints3[0].x, linkPoints3[0].y, linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.quadraticCurveTo(linkPoints3[1].x, linkPoints3[1].y, linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  draw(context2d: CanvasRenderingContext2D, stroke: Stroke): void\n  {\n    this.#logger.info(\"draw\", { context2d, stroke })\n    const NUMBER_POINTS = stroke.pointers.length\n    const NUMBER_QUADRATICS = NUMBER_POINTS - 2\n    const width = (stroke.style.width as number) > 0 ? (stroke.style.width as number) : context2d.lineWidth\n    const color = (stroke.style.color as string) ? (stroke.style.color as string) : context2d.strokeStyle\n    const firstPoint = stroke.pointers[0] as TPointer\n\n    context2d.save()\n    try {\n      context2d.beginPath()\n      if (NUMBER_POINTS < 3) {\n        this.renderArc(context2d, firstPoint, width * 0.6)\n      } else {\n        this.renderArc(context2d, firstPoint, width * firstPoint.p)\n        const secondPoint: TPointer = computeMiddlePointer(firstPoint, stroke.pointers[1])\n        this.renderLine(context2d, firstPoint, secondPoint, width)\n\n        // Possibility to try this (the start looks better when the ink is large)\n        // var first = computeMiddlePoint(stroke.pointers[0], stroke.pointers[1]);\n        // context2d.arc(first.x, first.y, width * first.p, 0, Math.PI * 2, true);\n\n        for (let i = 0; i < NUMBER_QUADRATICS; i++) {\n          const begin: TPointer = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n          const end: TPointer = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n          const ctrl: TPointer = stroke.pointers[i + 1]\n          this.renderQuadratic(context2d, begin, end, ctrl, width)\n        }\n        const beginLine: TPointer = computeMiddlePointer(stroke.pointers[NUMBER_POINTS - 2], stroke.pointers[NUMBER_POINTS - 1])\n        const endLine: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderLine(context2d, beginLine, endLine, width)\n\n        const beginFinal: TPointer = stroke.pointers[NUMBER_POINTS - 2]\n        const endFinal: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderFinal(context2d, beginFinal, endFinal, width)\n      }\n      context2d.closePath()\n      if (color !== undefined) {\n        context2d.fillStyle = color\n        context2d.fill()\n      }\n      context2d.save()\n    }\n    catch (error) {\n      this.#logger.error(\"draw\", { error })\n    }\n    finally {\n      context2d.restore()\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TSymbol, TCanvasTextSymbol, TCanvasTextUnderlineSymbol, TCanvasUnderLineSymbol, TPoint } from \"../../symbol\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererText\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  symbols = {\n    char: \"char\",\n    string: \"string\",\n    textLine: \"textLine\"\n  }\n\n  protected drawUnderline(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol, underline: TCanvasUnderLineSymbol)\n  {\n    this.#logger.debug(\"#drawUnderline\", { context2D, textUnderline, underline })\n    context2D.save()\n    try {\n      const delta = textUnderline.data.width / textUnderline.label.length\n      const p1: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.firstCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      const p2: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.lastCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"#drawUnderline\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawText(context2D: CanvasRenderingContext2D, text: TCanvasTextSymbol)\n  {\n    this.#logger.debug(\"#drawText\", { context2D, text })\n    context2D.save()\n    try {\n      context2D.font = `${ text.data.textHeight }px serif`\n      context2D.textAlign = (text.data.justificationType === \"CENTER\") ? \"center\" : \"left\"\n      context2D.textBaseline = \"bottom\"\n      context2D.fillStyle = context2D.strokeStyle\n      context2D.fillText(text.label, text.data.topLeftPoint.x, (text.data.topLeftPoint.y + text.data.height))\n    } catch(error) {\n      this.#logger.error(\"#drawText\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawTextLine(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol)\n  {\n    this.#logger.debug(\"#drawTextLine\", { context2D, textUnderline })\n    this.drawText(context2D, textUnderline)\n    textUnderline.underlineList.forEach((underline) =>\n    {\n      this.drawUnderline(context2D, textUnderline, underline)\n    })\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.lineWidth = (symbol.style.width as number)\n    context2D.strokeStyle = (symbol.style.color as string)\n    switch (symbol.type) {\n      case this.symbols.char:\n      case this.symbols.string:\n        this.drawText(context2D, symbol as TCanvasTextSymbol)\n        break\n      case this.symbols.textLine:\n        this.drawTextLine(context2D, symbol as TCanvasTextUnderlineSymbol)\n        break\n      default:\n        this.#logger.warn(\"draw\", `${symbol.type} not implemented`)\n        break\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Model } from \"../../model\"\nimport { Stroke, TSymbol } from \"../../symbol\"\nimport { TRendererConfiguration } from \"../RendererConfiguration\"\nimport { CanvasRendererShape } from \"./CanvasRendererShape\"\nimport { CanvasRendererStroke } from \"./CanvasRendererStroke\"\nimport { CanvasRendererText } from \"./CanvasRendererText\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n  configuration: Omit<TRendererConfiguration, \"guides\">\n  strokeRenderer: CanvasRendererStroke\n  shapeRenderer: CanvasRendererShape\n  textRenderer: CanvasRendererText\n  context!: {\n    parent: HTMLElement\n    renderingCanvas: HTMLCanvasElement\n    renderingCanvasContext: CanvasRenderingContext2D\n    capturingCanvas: HTMLCanvasElement\n    capturingCanvasContext: CanvasRenderingContext2D\n  }\n\n  constructor(config: Omit<TRendererConfiguration, \"guides\">)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = config\n    this.strokeRenderer = new CanvasRendererStroke()\n    this.shapeRenderer = new CanvasRendererShape()\n    this.textRenderer = new CanvasRendererText()\n  }\n\n  protected createCanvas(type: string): HTMLCanvasElement\n  {\n    this.#logger.debug(\"createCanvas\", { type })\n    const canvas: HTMLCanvasElement = document.createElement(\"canvas\")\n    canvas.id = type\n    canvas.classList.add(type)\n    canvas.classList.add(\"ms-canvas\")\n    return canvas\n  }\n\n  protected resizeContent(): void\n  {\n    const pixelRatio: number = window.devicePixelRatio\n    const elements: HTMLCanvasElement[] = [this.context.renderingCanvas, this.context.capturingCanvas]\n    elements.forEach((canvas) =>\n    {\n      const domElement = canvas.parentNode as HTMLElement\n      const width = Math.max(this.configuration.minWidth, domElement.clientWidth)\n      const height = Math.max(this.configuration.minHeight, domElement.clientHeight)\n      canvas.width = width * pixelRatio\n      canvas.height = height * pixelRatio\n      canvas.getContext(\"2d\")?.scale(pixelRatio, pixelRatio)\n      canvas.style.width = `${ width }px`\n      canvas.style.height = `${ height }px`\n    })\n  }\n\n  protected drawSymbol(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    if (symbol.type === \"stroke\") {\n      const stroke = symbol as Stroke\n      if (stroke.pointerType !== \"eraser\") {\n        this.strokeRenderer.draw(context2D, stroke)\n      }\n    } else if (Object.keys(this.textRenderer.symbols).includes(symbol.type)) {\n      this.textRenderer.draw(context2D, symbol)\n    } else if (Object.keys(this.shapeRenderer.symbols).includes(symbol.type)) {\n      this.shapeRenderer.draw(context2D, symbol)\n    } else {\n      this.#logger.warn(\"drawSymbol\", `symbol type unknow: ${symbol.type}`)\n    }\n  }\n\n  init(element: HTMLElement, guide?: { x?: number, y?: number } ): void\n  {\n    this.#logger.info(\"init\", { element })\n    const renderingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-rendering-canvas\")\n    renderingCanvas.setAttribute(\"data-layer\", \"MODEL\")\n    if (guide) {\n      renderingCanvas.style.backgroundSize = `${guide.x || 1}px ${guide.y || 1}px`\n    }\n    element.appendChild(renderingCanvas)\n\n    const capturingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-capture-canvas\")\n    capturingCanvas.setAttribute(\"data-layer\", \"CAPTURE\")\n    element.appendChild(capturingCanvas)\n\n    this.context = {\n      parent: element,\n      renderingCanvas,\n      renderingCanvasContext: renderingCanvas.getContext(\"2d\") as CanvasRenderingContext2D,\n      capturingCanvas,\n      capturingCanvasContext: capturingCanvas.getContext(\"2d\") as CanvasRenderingContext2D\n    }\n\n    this.resizeContent()\n  }\n\n  drawModel(model: Model): void\n  {\n    this.#logger.info(\"drawModel\", { model })\n    this.context.renderingCanvasContext?.clearRect(0, 0, this.context.renderingCanvas.width, this.context.renderingCanvas.height)\n    model.symbols.forEach(symbol => this.drawSymbol(this.context.renderingCanvasContext, symbol))\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n  }\n\n  drawPendingStroke(stroke: Stroke | undefined): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n    if (stroke && stroke?.pointerType !== \"eraser\") {\n      this.strokeRenderer.draw(this.context.capturingCanvasContext, stroke)\n    }\n  }\n\n  resize(model: Model): void\n  {\n    this.#logger.info(\"resize\", { model })\n    this.resizeContent()\n    this.drawModel(model)\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    if (this.context.parent) {\n      this.context.parent.innerHTML = \"\"\n    }\n  }\n}\n","\n/**\n * @group Renderer\n */\nexport const IISVGRendererConst =\n{\n  arrowHeadStartMarker: \"arrow-head-start\",\n  arrowHeadEndMaker: \"arrow-head-end\",\n  selectionFilterId: \"selection-filter\",\n  removalFilterId: \"removal-filter\",\n  crossMarker: \"cross-marker\",\n  noSelection: \"pointer-events: none; -webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;\",\n}","import { TBox, TPoint } from \"../../symbol\"\n\nconst XMLNS = \"http://www.w3.org/2000/svg\"\n/**\n * @group Renderer\n */\nexport class SVGBuilder\n{\n  static createLayer(boundingBox: TBox, attrs: { [key: string]: string } = {}): SVGSVGElement\n  {\n    const svgEl = document.createElementNS(XMLNS, \"svg\")\n    svgEl.setAttribute(\"width\", `${ boundingBox.width }px`)\n    svgEl.setAttribute(\"height\", `${ boundingBox.height }px`)\n    svgEl.setAttribute(\"viewBox\", `${boundingBox.x}, ${boundingBox.y}, ${boundingBox. width }, ${ boundingBox.height }`)\n    Object.keys(attrs).forEach(k =>\n    {\n      svgEl.setAttribute(k, attrs[k])\n    })\n    return svgEl\n  }\n\n  static createFilter(id: string, attrs: { [key: string]: string } = {}): SVGFilterElement\n  {\n    const filter = document.createElementNS(XMLNS, \"filter\")\n    filter.id = id\n    Object.keys(attrs).forEach(k =>\n    {\n      filter.setAttribute(k, attrs[k])\n    })\n    return filter\n  }\n\n  static createDefs(): SVGDefsElement\n  {\n    return document.createElementNS(XMLNS, \"defs\")\n  }\n\n  static createMarker(id: string, attrs: { [key: string]: string } = {}): SVGMarkerElement\n  {\n    const marker = document.createElementNS(XMLNS, \"marker\")\n    marker.setAttribute(\"id\", id)\n    Object.keys(attrs).forEach(k =>\n    {\n      marker.setAttribute(k, attrs[k])\n    })\n    return marker\n  }\n\n  static createComponentTransfert(): SVGFEComponentTransferElement\n  {\n    return document.createElementNS(XMLNS, \"feComponentTransfer\")\n  }\n\n  static createDropShadow({ dx = 0, dy = 0, deviation = 0, color = \"#3e68ff\", opacity = 1 }): SVGFEDropShadowElement\n  {\n    const shadow = document.createElementNS(XMLNS, \"feDropShadow\")\n    shadow.setAttribute(\"dx\", dx.toString())\n    shadow.setAttribute(\"dy\", dy.toString())\n    shadow.setAttribute(\"stdDeviation\", deviation.toString())\n    shadow.setAttribute(\"flood-color\", color)\n    shadow.setAttribute(\"flood-opacity\", opacity.toString())\n    return shadow\n  }\n\n  static createTransfertFunctionTable(type: \"feFuncA\" | \"feFuncB\" | \"feFuncG\" | \"feFuncR\", values: string): SVGFEFuncAElement\n  {\n    const feFunc = document.createElementNS(XMLNS, type)\n    feFunc.setAttribute(\"type\", \"table\")\n    feFunc.setAttribute(\"tableValues\", values)\n    return feFunc\n  }\n\n  static createGroup(attrs: { [key: string]: string } = {}): SVGGElement\n  {\n    const groupEl = document.createElementNS(XMLNS, \"g\")\n    Object.keys(attrs).forEach(k =>\n    {\n      groupEl.setAttribute(k, attrs[k])\n    })\n    return groupEl\n  }\n\n  static createLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): SVGLineElement\n  {\n    const lineEl = document.createElementNS(XMLNS, \"line\")\n    lineEl.setAttribute(\"x1\", p1.x.toString())\n    lineEl.setAttribute(\"y1\", p1.y.toString())\n    lineEl.setAttribute(\"x2\", p2.x.toString())\n    lineEl.setAttribute(\"y2\", p2.y.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      lineEl.setAttribute(k, attrs[k])\n    })\n    return lineEl\n  }\n\n  static createCircle(p: TPoint, r: number, attrs: { [key: string]: string } = {}): SVGCircleElement\n  {\n    const circleEl = document.createElementNS(XMLNS, \"circle\")\n    circleEl.setAttribute(\"cx\", p.x.toString())\n    circleEl.setAttribute(\"cy\", p.y.toString())\n    circleEl.setAttribute(\"r\", r.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      circleEl.setAttribute(k, attrs[k])\n    })\n    return circleEl\n  }\n\n  static createPath(attrs: { [key: string]: string } = {}): SVGPathElement\n  {\n    const pathEl = document.createElementNS(XMLNS, \"path\")\n    Object.keys(attrs).forEach(k =>\n    {\n      pathEl.setAttribute(k, attrs[k])\n    })\n    return pathEl\n  }\n\n  static createPolygon(points: number[], attrs: { [key: string]: string } = {}): SVGPolylineElement\n  {\n    const polygonEl = document.createElementNS(XMLNS, \"polygon\")\n    polygonEl.setAttribute(\"points\", points.join(\",\"))\n    Object.keys(attrs).forEach(k =>\n    {\n      polygonEl.setAttribute(k, attrs[k])\n    })\n    return polygonEl\n  }\n\n  static createRect(box: TBox, attrs: { [key: string]: string } = {}): SVGRectElement\n  {\n    const rectEl = document.createElementNS(XMLNS, \"rect\")\n    rectEl.setAttribute(\"x\", box.x.toString())\n    rectEl.setAttribute(\"y\", box.y.toString())\n    rectEl.setAttribute(\"width\", box.width.toString())\n    rectEl.setAttribute(\"height\", box.height.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      rectEl.setAttribute(k, attrs[k])\n    })\n    return rectEl\n  }\n\n  static createTSpan(text: string, attrs: { [key: string]: string } = {}): SVGTSpanElement\n  {\n    const tSpanEl = document.createElementNS(XMLNS, \"tspan\")\n    tSpanEl.textContent = text\n    Object.keys(attrs).forEach(k =>\n    {\n      tSpanEl.setAttribute(k, attrs[k])\n    })\n    return tSpanEl\n  }\n\n  static createForeignObject(box: TBox, node: HTMLElement, attrs: { [key: string]: string } = {}): SVGForeignObjectElement\n  {\n    const objEl = document.createElementNS(XMLNS, \"foreignObject\")\n    objEl.setAttribute(\"x\", box.x.toString())\n    objEl.setAttribute(\"y\", box.y.toString())\n    objEl.setAttribute(\"width\", box.width.toString())\n    objEl.setAttribute(\"height\", box.height.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      objEl.setAttribute(k, attrs[k])\n    })\n    objEl.appendChild(node)\n    return objEl\n  }\n\n  static createText(p: TPoint, text: string, attrs: { [key: string]: string } = {}): SVGTextElement\n  {\n    const textEl = document.createElementNS(XMLNS, \"text\")\n    textEl.textContent = text\n    textEl.setAttribute(\"x\", p.x.toString())\n    textEl.setAttribute(\"y\", p.y.toString())\n    Object.keys(attrs).forEach(k =>\n    {\n      textEl.setAttribute(k, attrs[k])\n    })\n    return textEl\n  }\n}\n","import { EdgeDecoration, EdgeKind, IIEdgeArc, IIEdgeLine, IIEdgePolyLine, TIIEdge } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { IISVGRendererConst } from \"./IISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class IISVGRendererEdgeUtil\n{\n  static getLinePath(line: IIEdgeLine): string\n  {\n    return `M ${ line.start.x } ${ line.start.y } L ${ line.end.x } ${ line.end.y }`\n  }\n\n  static getPolyLinePath(line: IIEdgePolyLine): string\n  {\n    return `M ${ line.vertices[0].x } ${ line.vertices[0].y } ${ line.vertices.map(p => `L ${ p.x } ${ p.y }`).join(\" \") }`\n  }\n\n  static getArcPath(arc: IIEdgeArc): string\n  {\n    return `M ${ arc.vertices[0].x } ${ arc.vertices[0].y } Q ${ arc.vertices.map(p => `${ p.x } ${ p.y }`).join(\" \") }`\n  }\n\n  static getSVGPath(edge: TIIEdge): string\n  {\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        return IISVGRendererEdgeUtil.getLinePath(edge)\n      case EdgeKind.PolyEdge:\n        return IISVGRendererEdgeUtil.getPolyLinePath(edge)\n      case EdgeKind.Arc:\n        return IISVGRendererEdgeUtil.getArcPath(edge)\n      default:\n        throw new Error(`Can't getSVGPath for edge cause kind is unknow: \"${ JSON.stringify(edge) }\"`)\n    }\n  }\n\n  static getSVGElement(edge: TIIEdge): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": edge.id,\n      \"type\": edge.type,\n      \"kind\": edge.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (edge.selected) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.selectionFilterId })`\n    }\n    if (edge.deleting) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.removalFilterId })`\n    }\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": \"transparent\",\n      \"stroke\": edge.style.color || DefaultStyle.color!,\n      \"stroke-width\": (edge.style.width || DefaultStyle.width).toString(),\n      \"d\": IISVGRendererEdgeUtil.getSVGPath(edge),\n    }\n    if (edge.style.opacity) {\n      pathAttrs[\"opacity\"] = edge.style.opacity.toString()\n    }\n\n    if (edge.startDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-start\"] = `url(#${ IISVGRendererConst.arrowHeadStartMarker })`\n    }\n    if (edge.endDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-end\"] = `url(#${ IISVGRendererConst.arrowHeadEndMaker })`\n    }\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n    return group\n  }\n\n\n}","import { IIEraser, TPointer } from \"../../symbol\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class IISVGRendererEraserUtil\n{\n  static getSVGPath(eraser: IIEraser): string\n  {\n    if (eraser.pointers.length < 1) return \"\"\n\n    const firstPoint = eraser.pointers.at(0) as TPointer\n\n    const startPath = `M ${ firstPoint.x } ${ firstPoint.y }`\n\n    if (eraser.pointers.length === 1) {\n      const strokeWith = eraser.style.width || 4\n      return `${startPath} L ${ firstPoint.x  + strokeWith / 2 } ${ firstPoint.y }`\n    }\n\n    const middlePoints = eraser.pointers.slice(1)\n\n    return middlePoints.reduce((acc, point) => {\n      return `${ acc } L ${ point.x } ${ point.y }`\n    }, startPath)\n  }\n\n  static getSVGElement(eraser: IIEraser): SVGPathElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": eraser.id,\n      \"type\": \"eraser\",\n      \"stroke-width\": \"12\",\n      \"stroke\": \"grey\",\n      \"opacity\": \"0.2\",\n      \"shadowBlur\": \"5\",\n      \"stroke-linecap\": \"round\",\n      \"fill\": \"transparent\",\n      \"d\": IISVGRendererEraserUtil.getSVGPath(eraser)\n    }\n    return SVGBuilder.createPath(attrs)\n  }\n\n}","import { DecoratorKind, IIDecorator, RecognizedKind, SymbolType, TBox, TIISymbol } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class IISVGRendererDecoratorUtil\n{\n  static getSVGElement(decorator: IIDecorator, symbol: TIISymbol): SVGGeometryElement | undefined\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": decorator.id,\n      \"type\": \"decorator\",\n      \"kind\": decorator.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (decorator.style.opacity) {\n      attrs[\"opacity\"] = decorator.style.opacity.toString()\n    }\n    if (symbol.deleting) {\n      attrs[\"opacity\"] = ((decorator.style.opacity || 1) * 0.5).toString()\n    }\n\n    let element: SVGGeometryElement | undefined\n\n    switch (decorator.kind) {\n      case DecoratorKind.Highlight: {\n        attrs[\"opacity\"] = symbol.deleting ? \"0.25\" : \"0.5\"\n        attrs[\"stroke\"] = \"transparent\"\n        attrs[\"fill\"] = decorator.style.color || DefaultStyle.color!\n        const boundingBox: TBox = {\n          x: symbol.bounds.x - +(symbol.style.width || DefaultStyle.width),\n          y: symbol.bounds.y - +(symbol.style.width || DefaultStyle.width),\n          height: symbol.bounds.height + +(symbol.style.width || DefaultStyle.width) * 2,\n          width: symbol.bounds.width + +(symbol.style.width || DefaultStyle.width) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Surround: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const boundingBox: TBox = {\n          x: symbol.bounds.x - +(symbol.style.width || DefaultStyle.width),\n          y: symbol.bounds.y - +(symbol.style.width || DefaultStyle.width),\n          height: symbol.bounds.height + +(symbol.style.width || DefaultStyle.width) * 2,\n          width: symbol.bounds.width + +(symbol.style.width || DefaultStyle.width) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Strikethrough: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const p1 = {\n          x: symbol.bounds.xMin,\n          y: symbol.bounds.yMid\n        }\n        const p2 = {\n          x: symbol.bounds.xMax,\n          y: symbol.bounds.yMid\n        }\n        if (symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text) {\n          p1.y = symbol.baseline - symbol.xHeight / 2\n          p2.y = symbol.baseline - symbol.xHeight / 2\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n      case DecoratorKind.Underline: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const p1 = {\n          x: symbol.bounds.xMin,\n          y: symbol.bounds.yMax + +(symbol.style.width || DefaultStyle.width)\n        }\n        const p2 = {\n          x: symbol.bounds.xMax,\n          y: symbol.bounds.yMax + +(symbol.style.width || DefaultStyle.width)\n        }\n        if (symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text) {\n          p1.y = symbol.baseline + symbol.xHeight / 2\n          p2.y = symbol.baseline + symbol.xHeight / 2\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n    }\n\n    return element\n  }\n}","import { IIShapeCircle, IIShapeEllipse, IIShapePolygon, ShapeKind, TIIShape } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { convertRadianToDegree } from \"../../utils\"\nimport { IISVGRendererConst } from \"./IISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class IISVGRendererShapeUtil\n{\n  static getPolygonePath(polygon: IIShapePolygon): string\n  {\n    return `M ${polygon.points[0].x} ${polygon.points[0].y} ${polygon.points.slice(1).map(p => `L ${p.x} ${p.y}`).join(\" \")} Z`\n  }\n\n  static getCirclePath(circle: IIShapeCircle): string\n  {\n    return `M ${circle.center.x - circle.radius} ${circle.center.y} a ${circle.radius} ${circle.radius} 0 1 1 ${circle.radius * 2} 0 a ${circle.radius} ${circle.radius} 0 1 1 -${circle.radius * 2} 0 Z`\n  }\n\n  static getEllipsePath(ellipse: IIShapeEllipse): string\n  {\n    return `M ${ellipse.center.x - ellipse.radiusX} ${ellipse.center.y} a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 ${ellipse.radiusX * 2} 0 a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 -${ellipse.radiusX * 2} 0 Z`\n  }\n\n  static getSVGPath(shape: TIIShape): string\n  {\n    switch(shape.kind) {\n      case ShapeKind.Polygon:\n        return IISVGRendererShapeUtil.getPolygonePath(shape as IIShapePolygon)\n      case ShapeKind.Circle:\n        return IISVGRendererShapeUtil.getCirclePath(shape as IIShapeCircle)\n      case ShapeKind.Ellipse:\n        return IISVGRendererShapeUtil.getEllipsePath(shape as IIShapeEllipse)\n      default:\n        throw new Error(`Can't getSVGPath for shape cause kind is unknow: \"${ JSON.stringify(shape) }\"`)\n    }\n  }\n\n  static getSVGElement(shape: TIIShape): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": shape.id,\n      \"type\": shape.type,\n      \"kind\": shape.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (shape.selected) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.selectionFilterId })`\n    }\n    if (shape.deleting) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.removalFilterId })`\n    }\n\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": shape.style.fill || \"transparent\",\n      \"stroke\": shape.style.color || DefaultStyle.color!,\n      \"stroke-width\": (shape.style.width || DefaultStyle.width).toString(),\n      \"d\": IISVGRendererShapeUtil.getSVGPath(shape),\n    }\n    if (shape.style.opacity) {\n      pathAttrs[\"opacity\"] = shape.style.opacity.toString()\n    }\n    if (shape.kind === ShapeKind.Ellipse) {\n      pathAttrs.transform = `rotate(${ convertRadianToDegree(shape.orientation) }, ${shape.center.x}, ${shape.center.y})`\n    }\n\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n\n    return group\n  }\n}","import { DecoratorKind, IIStroke, TPointer } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\nimport { IISVGRendererDecoratorUtil } from \"./IISVGRendererDecoratorUtil\"\nimport { IISVGRendererConst } from \"./IISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class IISVGRendererStrokeUtil\n{\n\n  protected static getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x } ${ center.y }`,\n      `m ${ -radius } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ radius * 2 } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ -(radius * 2) } 0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x } ${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      const x = +(end.x - (end.p * width * Math.sin(newAngle))).toFixed(3)\n      const y = +(end.y + (end.p * width * Math.cos(newAngle))).toFixed(3)\n      parts.push(`L ${ x } ${ y }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected static getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x } ${ linkPoints3[0].y } ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x } ${ linkPoints3[1].y } ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  static getSVGPath(stroke: IIStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    if (!STROKE_LENGTH) return \"\"\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  static getSVGElement(stroke: IIStroke): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": stroke.id,\n      \"type\": \"stroke\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (stroke.selected) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.selectionFilterId })`\n    }\n    if (stroke.deleting) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.removalFilterId })`\n    }\n\n    const strokeGroup = SVGBuilder.createGroup(attrs)\n\n    const strokeAttrs: { [key: string]: string } = {\n      \"fill\": stroke.style.color || DefaultStyle.color!,\n      \"stroke-width\": stroke.style.width.toString(),\n      \"d\": IISVGRendererStrokeUtil.getSVGPath(stroke)\n    }\n    if (stroke.style.opacity) {\n      strokeAttrs.opacity = stroke.style.opacity.toString()\n    }\n    strokeGroup.append(SVGBuilder.createPath(strokeAttrs))\n\n    stroke.decorators.forEach(d =>\n    {\n      const deco = IISVGRendererDecoratorUtil.getSVGElement(d, stroke)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          strokeGroup.prepend(deco)\n        }\n        else {\n          strokeGroup.append(deco)\n        }\n      }\n    })\n\n    return strokeGroup\n  }\n\n}","import { DecoratorKind, IIText } from \"../../symbol\"\nimport { IISVGRendererDecoratorUtil } from \"./IISVGRendererDecoratorUtil\"\nimport { IISVGRendererConst } from \"./IISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class IISVGRendererTextUtil\n{\n  static getSVGElement(text: IIText): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": text.id,\n      \"type\": text.type,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"style\": IISVGRendererConst.noSelection,\n    }\n    if (text.style.opacity) {\n      attrs.opacity = text.style.opacity.toString()\n    }\n    if (text.rotation) {\n      attrs.transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n    }\n    if (text.selected) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.selectionFilterId })`\n    }\n    if (text.deleting) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.removalFilterId })`\n    }\n\n    const textGroup = SVGBuilder.createGroup(attrs)\n\n    const textElement = SVGBuilder.createText(text.point, \"\")\n\n    text.chars.forEach(c =>\n    {\n      const attrs: { [key: string]: string } = {\n        id: c.id,\n        fill: c.color,\n        \"font-size\": `${ c.fontSize }px`,\n        \"font-weight\": c.fontWeight.toString(),\n      }\n      textElement.appendChild(SVGBuilder.createTSpan(c.label, attrs))\n    })\n    textGroup.append(textElement)\n\n    text.decorators.forEach(d =>\n    {\n      const deco = IISVGRendererDecoratorUtil.getSVGElement(d, text)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          textGroup.prepend(deco)\n        }\n        else {\n          textGroup.append(deco)\n        }\n      }\n    })\n\n    return textGroup\n  }\n}","import { DecoratorKind, RecognizedKind, TIIRecognized } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { IISVGRendererDecoratorUtil } from \"./IISVGRendererDecoratorUtil\"\nimport { IISVGRendererStrokeUtil } from \"./IISVGRendererStrokeUtil\"\nimport { IISVGRendererConst } from \"./IISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class IISVGRendererRecognizedUtil\n{\n  static getSVGElement(recognizedSymbol: TIIRecognized): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": recognizedSymbol.id,\n      \"type\": recognizedSymbol.type,\n      \"kind\": recognizedSymbol.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": recognizedSymbol.style.color || DefaultStyle.color,\n      \"stroke-width\": (recognizedSymbol.style.width || DefaultStyle.width).toString(),\n    }\n    if (recognizedSymbol.style.opacity) {\n      attrs[\"opacity\"] = recognizedSymbol.style.opacity.toString()\n    }\n    if (recognizedSymbol.selected) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.selectionFilterId })`\n    }\n    if (recognizedSymbol.deleting) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    recognizedSymbol.strokes.forEach(s =>\n    {\n      groupEl.append(IISVGRendererStrokeUtil.getSVGElement(s))\n    })\n\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.decorators.forEach(d =>\n      {\n        const deco = IISVGRendererDecoratorUtil.getSVGElement(d, recognizedSymbol)\n        if (deco) {\n          if (d.kind === DecoratorKind.Highlight) {\n            groupEl.prepend(deco)\n          }\n          else {\n            groupEl.append(deco)\n          }\n        }\n      })\n    }\n\n    return groupEl\n  }\n\n}","import { DecoratorKind, IIEraser, IISymbolGroup, SymbolType, TIISymbol } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { IISVGRendererDecoratorUtil } from \"./IISVGRendererDecoratorUtil\"\nimport { IISVGRendererEdgeUtil } from \"./IISVGRendererEdgeUtil\"\nimport { IISVGRendererShapeUtil } from \"./IISVGRendererShapeUtil\"\nimport { IISVGRendererStrokeUtil } from \"./IISVGRendererStrokeUtil\"\nimport { IISVGRendererConst } from \"./IISVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\nimport { IISVGRendererTextUtil } from \"./IISVGRendererTextUtil\"\nimport { IISVGRendererRecognizedUtil } from \"./IISVGRendererRecognizedUtil\"\n\n/**\n * @group Renderer\n */\nexport class IISVGRendererGroupUtil\n{\n\n  static getChildElement(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined\n  {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = IISVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = IISVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = IISVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = IISVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = IISVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Recognized:\n        element = IISVGRendererRecognizedUtil.getSVGElement(symbol)\n        break\n    }\n    return element\n  }\n\n  static getSVGElement(symbolGroup: IISymbolGroup): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": symbolGroup.id,\n      \"type\": \"group\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": symbolGroup.style.color || DefaultStyle.color!,\n      \"stroke-width\": (symbolGroup.style.width || DefaultStyle.width).toString(),\n    }\n    if (symbolGroup.style.opacity) {\n      attrs[\"opacity\"] = symbolGroup.style.opacity.toString()\n    }\n    if (symbolGroup.selected) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.selectionFilterId })`\n    }\n    if (symbolGroup.deleting) {\n      attrs[\"filter\"] = `url(#${ IISVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    symbolGroup.children.forEach(sym =>\n    {\n      groupEl.append(IISVGRendererGroupUtil.getChildElement(sym)!)\n    })\n\n    symbolGroup.decorators.forEach(d =>\n    {\n      const deco = IISVGRendererDecoratorUtil.getSVGElement(d, symbolGroup)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          groupEl.prepend(deco)\n        }\n        else {\n          groupEl.append(deco)\n        }\n      }\n    })\n\n    return groupEl\n  }\n\n}","import { SvgElementRole } from \"../../Constants\"\nimport { getClosestPoints } from \"../../utils\"\nimport { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TIISymbol, TPoint, TBox, Box, IIEraser, SymbolType } from \"../../symbol\"\nimport { TIIRendererConfiguration } from \"../RendererConfiguration\"\nimport { IISVGRendererConst } from \"./IISVGRendererConst\"\nimport { IISVGRendererEdgeUtil } from \"./IISVGRendererEdgeUtil\"\nimport { IISVGRendererEraserUtil } from \"./IISVGRendererEraserUtil\"\nimport { IISVGRendererGroupUtil } from \"./IISVGRendererGroupUtil\"\nimport { IISVGRendererShapeUtil } from \"./IISVGRendererShapeUtil\"\nimport { IISVGRendererStrokeUtil } from \"./IISVGRendererStrokeUtil\"\nimport { IISVGRendererTextUtil } from \"./IISVGRendererTextUtil\"\nimport { IISVGRendererRecognizedUtil } from \"./IISVGRendererRecognizedUtil\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class IISVGRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n  groupGuidesId = \"guides-wrapper\"\n\n  configuration: TIIRendererConfiguration\n  parent!: HTMLElement\n  layer!: SVGSVGElement\n  definitionGroup!: SVGGElement\n\n  verticalGuides: number[] = []\n  horizontalGuides: number[] = []\n\n  constructor(configuration: TIIRendererConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected initLayer(): void\n  {\n    const width = Math.max(this.configuration.minWidth, this.parent.clientWidth)\n    const height = Math.max(this.configuration.minHeight, this.parent.clientHeight)\n    this.layer = SVGBuilder.createLayer({ x: 0, y: 0, width, height })\n    this.layer.style.setProperty(\"height\", \"auto\")\n    this.layer.style.setProperty(\"width\", \"auto\")\n    this.layer.appendChild(this.createSVGTools())\n    this.parent.style.setProperty(\"overflow\", \"auto\")\n    this.parent.appendChild(this.layer)\n  }\n\n  protected createDefs(): SVGDefsElement\n  {\n    const defs = SVGBuilder.createDefs()\n\n    const SIZE = 5\n    const REFX = SIZE - 1, REFY = SIZE / 2\n    const arrowHeadMarkerAttrs = {\n      style: IISVGRendererConst.noSelection,\n      fill: \"context-stroke\",\n      markerWidth: SIZE.toString(),\n      markerHeight: SIZE.toString(),\n      refX: REFX.toString(),\n      refY: REFY.toString(),\n    }\n\n    const arrowHeadStart = SVGBuilder.createMarker(IISVGRendererConst.arrowHeadStartMarker, { ...arrowHeadMarkerAttrs, orient: \"auto-start-reverse\" })\n    arrowHeadStart.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadStart)\n\n    const arrowHeadEnd = SVGBuilder.createMarker(IISVGRendererConst.arrowHeadEndMaker, { ...arrowHeadMarkerAttrs, orient: \"auto\" })\n    arrowHeadEnd.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadEnd)\n\n    const crossMarkerAttrs = {\n      style: IISVGRendererConst.noSelection,\n      markerWidth: \"5\",\n      markerHeight: \"5\",\n      refX: \"0\",\n      refY: \"0\",\n      viewBox: \"-5 -5 10 10\"\n    }\n    const cross = SVGBuilder.createMarker(IISVGRendererConst.crossMarker, crossMarkerAttrs)\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"white\", \"stroke-width\": \"3\" }))\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"context-stroke\", \"stroke-width\": \"2\" }))\n    defs.appendChild(cross)\n\n    return defs\n  }\n\n  protected createFilters(): SVGGElement\n  {\n    const filtersGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    const removalFilter = SVGBuilder.createFilter(IISVGRendererConst.removalFilterId, { filterUnits: \"userSpaceOnUse\" })\n    const bfeComponentTransfer = SVGBuilder.createComponentTransfert()\n    const bfeFuncA = SVGBuilder.createTransfertFunctionTable(\"feFuncA\", \"0 0.25\")\n    bfeComponentTransfer.appendChild(bfeFuncA)\n    removalFilter.appendChild(bfeComponentTransfer)\n    filtersGroup.appendChild(removalFilter)\n\n    const selectionFilter = SVGBuilder.createFilter(IISVGRendererConst.selectionFilterId, { filterUnits: \"userSpaceOnUse\" })\n    selectionFilter.appendChild(SVGBuilder.createDropShadow({ dx: -1, dy: -1, deviation: 1 }))\n    filtersGroup.appendChild(selectionFilter)\n\n    return filtersGroup\n  }\n\n  protected drawGuides(): void\n  {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    const height = Number(this.layer.getAttribute(\"height\")?.replace(\"px\", \"\"))\n    const width = Number(this.layer.getAttribute(\"width\")?.replace(\"px\", \"\"))\n    const offSet = this.configuration.guides.gap\n    const subOffSet = this.configuration.guides.gap / 5\n    const attrs = {\n      id: this.groupGuidesId,\n      stroke: \"grey\",\n      opacity: \"0.5\",\n      style: IISVGRendererConst.noSelection,\n      role: SvgElementRole.Guide\n    }\n    const guidesGroup = SVGBuilder.createGroup(attrs)\n    switch (this.configuration.guides.type) {\n      case \"line\":\n        for (let y = offSet; y < height; y += offSet) {\n          const begin: TPoint = { x: offSet, y }\n          const end: TPoint = { x: width - offSet, y }\n          this.horizontalGuides.push(y)\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: IISVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n        }\n        break\n      case \"grid\":\n        for (let y = 0; y < height; y += offSet) {\n          const begin: TPoint = { x: 0, y }\n          const end: TPoint = { x: width, y }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: IISVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.horizontalGuides.push(y)\n          for (let subY = y + subOffSet; subY < y + offSet; subY += subOffSet) {\n            this.horizontalGuides.push(subY)\n            const svgLine = SVGBuilder.createLine({ x: 0, y: subY }, { x: width, y: subY }, { \"stroke-width\": \"0.25\", style: IISVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        for (let x = 0; x < width; x += offSet) {\n          const begin: TPoint = { x, y: 0 }\n          const end: TPoint = { x, y: height }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: IISVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.verticalGuides.push(x)\n          for (let subX = x + subOffSet; subX < x + offSet; subX += subOffSet) {\n            this.verticalGuides.push(subX)\n            const svgLine = SVGBuilder.createLine({ x: subX, y: 0 }, { x: subX, y: height }, { \"stroke-width\": \"0.25\", style: IISVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        break\n      case \"point\":\n        for (let x = offSet; x < width; x += offSet) {\n          this.verticalGuides.push(x)\n          for (let y = offSet; y < height; y += offSet) {\n            this.horizontalGuides.push(y)\n            const svgPoint = SVGBuilder.createCircle({ x, y }, 1)\n            guidesGroup.appendChild(svgPoint)\n          }\n        }\n        break\n      default:\n        this.#logger.error(\"drawGuides\", `Guide type unknow: ${ this.configuration.guides.type }`)\n        break\n    }\n    this.horizontalGuides = [...new Set(this.horizontalGuides)]\n    this.verticalGuides = [...new Set(this.verticalGuides)]\n    this.definitionGroup.appendChild(guidesGroup)\n  }\n\n  protected removeGuides(): void\n  {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    this.layer.querySelector(`#${ this.groupGuidesId }`)?.remove()\n  }\n\n  protected createSVGTools(): SVGGElement\n  {\n    this.definitionGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    this.definitionGroup.appendChild(this.createDefs())\n    this.definitionGroup.appendChild(this.createFilters())\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n    return this.definitionGroup\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    this.parent = element\n    this.parent.oncontextmenu = () => false\n    this.initLayer()\n  }\n\n  getAttribute(id: string, name: string): string | undefined | null\n  {\n    const element = this.layer.querySelector(`#${ id }`) as HTMLElement | null\n    return element?.getAttribute(name)\n  }\n\n  setAttribute(id: string, name: string, value: string): void\n  {\n    const element = this.layer.querySelector(`#${ id }`) as HTMLElement | null\n    element?.setAttribute(name, value)\n  }\n\n  buildElementFromSymbol(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined\n  {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = IISVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Eraser:\n        element = IISVGRendererEraserUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = IISVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = IISVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = IISVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = IISVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Recognized:\n        element = IISVGRendererRecognizedUtil.getSVGElement(symbol)\n        break\n      default:\n        this.#logger.error(\"buildElementFromSymbol\", `symbol unknow: \"${ JSON.stringify(symbol) }\"`)\n    }\n    return element\n  }\n\n  prependElement(el: Element): void\n  {\n    this.layer.prepend(el)\n  }\n\n  changeOrderSymbol(symbolToMove: TIISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void\n  {\n    const moveEl = this.layer.querySelector(`#${ symbolToMove.id }`)\n    if (!moveEl) return\n    switch (position) {\n      case \"first\":\n        this.definitionGroup.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"last\":\n        this.layer.insertAdjacentElement(\"beforeend\", moveEl)\n        break\n      case \"forward\":\n        moveEl.nextElementSibling?.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"backward\":\n        if (moveEl.previousElementSibling !== this.definitionGroup) {\n          moveEl.previousElementSibling?.insertAdjacentElement(\"beforebegin\", moveEl)\n        }\n        break\n    }\n  }\n\n  appendElement(el: Element): void\n  {\n    this.layer.appendChild(el)\n  }\n\n  removeElement(id: string): void\n  {\n    this.#logger.debug(\"Element\", { id })\n    const oldStroke = this.layer.querySelector(`#${ id }`)\n    if (oldStroke) {\n      oldStroke.remove()\n    }\n  }\n\n  drawSymbol(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined\n  {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    const oldNode = this.layer.querySelector(`#${ symbol?.id }`)\n    const svgEl = this.buildElementFromSymbol(symbol)\n\n    if (svgEl) {\n      if (oldNode) {\n        oldNode.replaceWith(svgEl)\n      }\n      else {\n        this.layer.appendChild(svgEl)\n      }\n    }\n    return svgEl\n  }\n\n  replaceSymbol(id: string, symbols: TIISymbol[]): SVGGraphicsElement[] | undefined\n  {\n    this.#logger.debug(\"drawSymbol\", { symbols })\n    const oldNode = this.layer.querySelector(`#${ id }`)\n    const elements = symbols.map(s => this.buildElementFromSymbol(s)).filter(x => !!x) as SVGGraphicsElement[]\n\n    if (elements.length) {\n      if (oldNode) {\n        elements.forEach(e => oldNode.insertAdjacentElement(\"beforebegin\", e))\n        oldNode.remove()\n      }\n      else {\n        elements.forEach(e => this.layer.appendChild(e))\n      }\n    }\n    return elements\n  }\n\n  removeSymbol(id: string): void\n  {\n    this.#logger.debug(\"removeSymbol\", { id })\n    this.removeElement(id)\n  }\n\n  drawCircle(point: TPoint, radius: number, attrs: { [key: string]: string } = {}): void\n  {\n    this.#logger.info(\"drawCircle\", { point, radius, attrs })\n    this.layer.appendChild(SVGBuilder.createCircle(point, radius, attrs))\n  }\n\n  drawRect(box: TBox, attrs: { [key: string]: string } = {}): void\n  {\n    this.#logger.info(\"drawCircle\", { box, attrs })\n    this.layer.appendChild(SVGBuilder.createRect(box, attrs))\n  }\n\n  drawLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): void\n  {\n    this.#logger.info(\"drawLine\", { p1, p2, attrs })\n    this.layer.appendChild(SVGBuilder.createLine(p1, p2, attrs))\n  }\n\n  drawConnectionBetweenBox(id: string, box1: TBox, box2: TBox, attrs?: { [key: string]: string }): void\n  {\n    const points1: TPoint[] = new Box(box1).corners\n    const points2: TPoint[] = new Box(box2).corners\n    const { p1, p2 } = getClosestPoints(points1, points2)\n    const attrsLine = {\n      id,\n      fill: \"transparent\",\n      style: IISVGRendererConst.noSelection,\n      ...attrs\n    }\n    this.drawLine(p1, p2, attrsLine)\n  }\n\n  resize(height: number, width: number): void\n  {\n    this.#logger.info(\"resize\", { height, width })\n    this.layer.setAttribute(\"width\", `${ width }px`)\n    this.layer.setAttribute(\"height\", `${ height }px`)\n    this.layer.setAttribute(\"viewBox\", `0, 0, ${ width }, ${ height }`)\n    this.removeGuides()\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n  }\n\n  getElementById(id: string): SVGGraphicsElement | null\n  {\n    return this.layer.querySelector(`#${ id }`) as SVGGraphicsElement | null\n  }\n\n  getElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): NodeListOf<Element>\n  {\n    this.#logger.info(\"getElements\", { tagName, attrs })\n    let query = tagName || \"*\"\n    if (attrs) {\n      Object.keys(attrs).forEach(k =>\n      {\n        query += `[${ k }=${ attrs[k] }]`\n      })\n    }\n    return this.layer.querySelectorAll(query)\n  }\n\n  clearElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): void\n  {\n    this.#logger.info(\"clearElements\", { tagName, attrs })\n    this.getElements({ tagName, attrs })\n      .forEach(e => e.remove())\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    if (this.layer) {\n      while (this.layer.firstChild) {\n        this.layer.firstChild.remove()\n      }\n      this.layer.appendChild(this.createSVGTools())\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.layer) {\n      this.layer.remove()\n    }\n  }\n}","import { TPointer, TStroke } from \"../../symbol\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class SVGStroker\n{\n\n  protected getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x },${ center.y }`,\n      `m ${ -radius },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ radius * 2 },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ -(radius * 2) },0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x },${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      parts.push(`L ${ end.x - (end.p * width * Math.sin(newAngle)) },${ end.y + (end.p * width * Math.cos(newAngle)) }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x },${ linkPoints3[0].y } ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x },${ linkPoints3[1].y } ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected buildSVGPath(stroke: TStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  drawStroke(svgElement: SVGElement, stroke: TStroke, attrs?: { name: string, value: string }[]): void\n  {\n    const svgPathElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\")\n    svgPathElement.classList.add(\"pending-stroke\")\n    svgPathElement.setAttribute(\"id\", stroke.id)\n    svgPathElement.setAttribute(\"type\", stroke.pointerType)\n    attrs?.forEach(a =>\n    {\n      svgPathElement.setAttribute(a.name, a.value)\n    })\n    const svgPath = this.buildSVGPath(stroke)\n    svgPathElement.setAttribute(\"d\", `${ svgPath }Z`)\n    svgElement.appendChild(svgPathElement)\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Model } from \"../../model\"\nimport { TStroke } from \"../../symbol\"\nimport { TRendererConfiguration } from \"../RendererConfiguration\"\nimport { TUpdatePatch, TUpdatePatchAppendChild, TUpdatePatchInsertBefore, TUpdatePatchRemoveAttribut, TUpdatePatchRemoveChild, TUpdatePatchRemoveElement, TUpdatePatchReplaceAll, TUpdatePatchReplaceELement, TUpdatePatchSetAttribut } from \"../../recognizer\"\nimport { SVGStroker } from \"./SVGStroker\"\n\n/**\n * @group Renderer\n */\nexport class InteractiveInkSSRSVGRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  config: TRendererConfiguration\n  stroker: SVGStroker\n  context!: {\n    parent: HTMLElement\n  }\n\n  constructor(config: TRendererConfiguration)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.config = config\n    this.stroker = new SVGStroker()\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    element.style.fontSize = \"10px\"\n    this.context = {\n      parent: element\n    }\n  }\n\n  protected drawStroke(svgElement: SVGElement, stroke: TStroke)\n  {\n    let style: string\n    if (stroke.pointerType === \"eraser\") {\n      stroke.style.width = 12\n      style = \"fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;\"\n    } else {\n      style = `fill:${ stroke.style.color };stroke:transparent;`\n    }\n    this.stroker.drawStroke(svgElement, stroke, [{ name: \"style\", value: style }])\n  }\n\n  protected replaceAll(layerName: string, update: TUpdatePatchReplaceAll): void\n  {\n    const oldLayer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement | null\n    oldLayer?.remove()\n    this.context.parent.insertAdjacentHTML(\"beforeend\", update.svg)\n    const layer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement\n    if (layerName === \"MODEL\") {\n      const pendingStrokesGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n      pendingStrokesGroup.id = \"pendingStrokes\"\n      layer.appendChild(pendingStrokesGroup)\n    }\n  }\n\n  protected replaceElement(update: TUpdatePatchReplaceELement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`) as HTMLElement | null\n    if (elementToRemove) {\n      const parent = elementToRemove.parentNode as HTMLElement | null | undefined\n      elementToRemove?.remove()\n      parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n    }\n  }\n\n  protected appendChild(layerName: string, update: TUpdatePatchAppendChild): void\n  {\n    const parentSelector = update.parentId ? `#${ update.parentId }` : `svg[data-layer=\"${ layerName }\"]`\n    const parent = this.context.parent.querySelector(parentSelector) as HTMLElement\n    parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n  }\n\n  protected removeChild(update: TUpdatePatchRemoveChild): void\n  {\n    this.context.parent.querySelector(`#${ update.parentId } > *:nth-child(${ update.index + 1 })`)?.remove()\n  }\n\n  protected removeElement(update: TUpdatePatchRemoveElement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`)\n    if (elementToRemove) {\n      if (update.id.includes(\"s\") || update.id.includes(\"MODEL\")) {\n        elementToRemove.remove()\n      } else {\n        elementToRemove.setAttribute(\"class\", \"removed-stroke\")\n        setTimeout(() =>\n        {\n          elementToRemove?.remove()\n        }, 100)\n      }\n    }\n  }\n\n  protected insertBefore(update: TUpdatePatchInsertBefore): void\n  {\n    const parent = this.context.parent.querySelector(`#${ update.refId }`) as HTMLElement | null\n    parent?.insertAdjacentHTML(\"beforebegin\", update.svg)\n  }\n\n  protected setAttribute(update: TUpdatePatchSetAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.setAttribute(update.name, update.value)\n  }\n\n  protected removeAttribute(update: TUpdatePatchRemoveAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.removeAttribute(update.name)\n  }\n\n  updateLayer(layerName: string, update: TUpdatePatch): void\n  {\n    this.#logger.info(\"updateLayer\", { layerName, update })\n    switch (update.type) {\n      case \"REPLACE_ALL\":\n        this.replaceAll(layerName, update as TUpdatePatchReplaceAll)\n        break\n      case \"REPLACE_ELEMENT\":\n        this.replaceElement(update as TUpdatePatchReplaceELement)\n        break\n      case \"APPEND_CHILD\":\n        this.appendChild(layerName, update as TUpdatePatchAppendChild)\n        break\n      case \"REMOVE_ELEMENT\":\n        this.removeElement(update as TUpdatePatchRemoveElement)\n        break\n      case \"REMOVE_CHILD\":\n        this.removeChild(update as TUpdatePatchRemoveChild)\n        break\n      case \"INSERT_BEFORE\":\n        this.insertBefore(update as TUpdatePatchInsertBefore)\n        break\n      case \"SET_ATTRIBUTE\":\n        this.setAttribute(update as TUpdatePatchSetAttribut)\n        break\n      case \"REMOVE_ATTRIBUTE\":\n        this.removeAttribute(update as TUpdatePatchRemoveAttribut)\n        break\n      default:\n        this.#logger.warn(\"updateLayer\", `update.type unknow ${update.type}`)\n        break\n    }\n  }\n\n  updatesLayer(layerName: string, updates: TUpdatePatch[]): void\n  {\n    this.#logger.info(\"updatesLayer\", { layerName, updates })\n    updates.forEach(u => this.updateLayer(layerName, u))\n    this.clearPendingStroke()\n  }\n\n  clearPendingStroke(): void\n  {\n    this.#logger.info(\"clearPendingStroke\")\n    const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n    if (pendingStrokeGroup) {\n      pendingStrokeGroup.innerHTML = \"\"\n    }\n  }\n\n  drawPendingStroke(stroke: TStroke): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    if (stroke) {\n      const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n      if (pendingStrokeGroup) {\n        const oldStroke = pendingStrokeGroup.querySelector(`#${ stroke?.id }`)\n        if (oldStroke) {\n          oldStroke.remove()\n        }\n        this.drawStroke(pendingStrokeGroup, stroke)\n      }\n    }\n  }\n\n  clearErasingStrokes(): void\n  {\n    const erasingStrokeList = this.context.parent.querySelectorAll(\"[type=eraser]\") as NodeListOf<SVGElement>\n    erasingStrokeList.forEach(erasingStroke => {\n      erasingStroke.remove()\n    })\n  }\n\n  resize(model: Model): void\n  {\n    this.#logger.info(\"resize\", { model })\n    const rect = this.context.parent.getBoundingClientRect()\n    const svgList = this.context.parent.querySelectorAll(\"svg\")\n    const width = Math.max(rect.width, model.width)\n    const height = Math.max(rect.height, model.height)\n    svgList.forEach(svg =>\n    {\n      svg.setAttribute(\"viewBox\", `0 0 ${ width }, ${ height }`)\n      svg.setAttribute(\"width\", `${ width }px`)\n      svg.setAttribute(\"height\", `${ height }px`)\n    })\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\", { context: this.context })\n    if (this.context?.parent) {\n      this.context.parent.querySelectorAll(\"svg\").forEach(n => n.remove())\n    }\n  }\n}","\n/**\n * @group Renderer\n */\nexport type TGuidesConfiguration = {\n  enable: boolean,\n  gap: number\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultGuidesConfiguration: TGuidesConfiguration = {\n  enable: true,\n  gap: 50,\n}\n\n/**\n * @group Renderer\n */\nexport type TRendererConfiguration = {\n  minHeight: number\n  minWidth: number\n  guides: TGuidesConfiguration\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultRendererConfiguration: TRendererConfiguration = {\n  guides: DefaultGuidesConfiguration,\n  minHeight: 100,\n  minWidth: 100,\n}\n\n/**\n * @group Renderer\n */\nexport type TIIRendererConfiguration = TRendererConfiguration & {\n  guides: TGuidesConfiguration & {\n    type: \"line\" | \"grid\" | \"point\"\n  },\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultIIRendererConfiguration: TIIRendererConfiguration = {\n  guides: {\n    enable: true,\n    gap: 50,\n    type: \"point\"\n  },\n  minHeight: 100,\n  minWidth: 100,\n}\n","import { InteractiveInkEditor } from \"../editor\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport\n{\n  IIModel,\n  TJIIXChar,\n  TJIIXEdgeArc,\n  TJIIXEdgeElement,\n  JIIXEdgeKind,\n  TJIIXEdgeLine,\n  TJIIXEdgePolyEdge,\n  TJIIXExport,\n  TJIIXNodeCircle,\n  TJIIXNodeElement,\n  TJIIXNodeEllipse,\n  JIIXNodeKind,\n  TJIIXNodeParrallelogram,\n  TJIIXNodePolygon,\n  TJIIXNodeRectangle,\n  TJIIXNodeRhombus,\n  TJIIXNodeTriangle,\n  TJIIXTextElement,\n  TJIIXWord\n} from \"../model\"\nimport\n{\n  Box,\n  DecoratorKind,\n  IIDecorator,\n  IIEdgeArc,\n  IIEdgeLine,\n  IIEdgePolyLine,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIShapePolygon,\n  IIStroke,\n  IIText,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TIISymbolChar,\n  TPoint\n} from \"../symbol\"\nimport { RecognizedKind } from \"../symbol\"\nimport { computeAngleAxeRadian, computeAverage, convertBoundingBoxMillimeterToPixel, convertMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class IIConversionManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get configuration(): { size: number | \"auto\", weight: \"bold\" | \"normal\" | \"auto\" } {\n    return this.editor.configuration.fontStyle\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  protected computeFontSize(chars: TJIIXChar[]): number\n  {\n    if (chars.some(c => c[\"bounding-box\"])) {\n      const height = convertMillimeterToPixel(computeAverage(chars.map(c => c[\"bounding-box\"]?.height || 1)))\n      return Math.round(Math.round(height * this.rowHeight) / this.rowHeight / 2) * 2\n    }\n    return Math.round(this.rowHeight / 2)\n  }\n\n  buildChar(char: TJIIXChar, strokes: IIStroke[], fontSize: number): TIISymbolChar\n  {\n    const points = char.grid.map(p => ({\n      x: convertMillimeterToPixel(p.x),\n      y: convertMillimeterToPixel(p.y),\n    }))\n    let fontWeight = this.configuration.weight\n    if (fontWeight === \"auto\") {\n      fontWeight = (strokes[0].style.width || 1) > 2 ? \"bold\" : \"normal\"\n    }\n\n    const color = strokes[0].style.color || \"black\"\n    return {\n      id: `text-char-${ createUUID() }`,\n      label: char.label,\n      color,\n      fontSize,\n      fontWeight,\n      bounds: Box.createFromPoints(points)\n    }\n  }\n\n  buildText(word: TJIIXWord, chars: TJIIXChar[], strokes: IIStroke[], size: number | \"auto\"): IIText\n  {\n    const boundingBox = Box.createFromBoxes([convertBoundingBoxMillimeterToPixel(word[\"bounding-box\"])])\n    const charSymbols: TIISymbolChar[] = []\n    const charFontSize = size === \"auto\" ? this.computeFontSize(chars) : size\n\n    chars.forEach(char =>\n    {\n      const charStrokes = strokes.filter(s => char.items?.some(i => i[\"full-id\"] === s.id)) as IIStroke[]\n      if (charStrokes.length) {\n        charSymbols.push(this.buildChar(char, charStrokes, charFontSize))\n      }\n    })\n    const point: TPoint = {\n      x: boundingBox.xMin,\n      y: boundingBox.yMax\n    }\n    const text = new IIText(charSymbols, point, boundingBox, strokes[0].style)\n    const decorators = strokes.flatMap(s => s.decorators)\n    strokes.forEach(s =>\n    {\n      const sym = this.model.getRootSymbol(s.id)\n      if ((sym?.type === SymbolType.Recognized && sym.kind === RecognizedKind.Text) || sym?.type === SymbolType.Group) {\n        const hightlight = sym.decorators.find(d => d.kind === DecoratorKind.Highlight)\n        if (hightlight) decorators.push(hightlight)\n        const strikethrough = sym.decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n        if (strikethrough) decorators.push(strikethrough)\n        const surround = sym.decorators.find(d => d.kind === DecoratorKind.Surround)\n        if (surround) decorators.push(surround)\n        const underline = sym.decorators.find(d => d.kind === DecoratorKind.Underline)\n        if (underline) decorators.push(underline)\n      }\n    })\n    if (decorators.length) {\n      const hightlight = decorators.find(d => d.kind === DecoratorKind.Highlight)\n      if (hightlight) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Highlight, hightlight.style))\n      }\n      const strikethrough = decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n      if (strikethrough) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Strikethrough, strikethrough.style))\n      }\n      const surround = decorators.find(d => d.kind === DecoratorKind.Surround)\n      if (surround) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Surround, surround.style))\n      }\n      const underline = decorators.find(d => d.kind === DecoratorKind.Underline)\n      if (underline) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Underline, underline.style))\n      }\n    }\n\n    return text\n  }\n\n  convertText(text: TJIIXTextElement, strokes: IIStroke[], onlyText: boolean): { symbol: IIText, strokes: IIStroke[] }[] | undefined\n  {\n    if (!text.lines) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.lines = true\")\n    }\n    if (!text.words) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.words = true\")\n    }\n    if (!text.chars) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.chars = true\")\n    }\n    if (!text.chars.some(c => c.items)) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.strokes = true\")\n    }\n\n    const jiixWords = text.words as TJIIXWord[]\n    const jiixChars = text.chars as TJIIXChar[]\n\n    const result: { symbol: IIText, strokes: IIStroke[] }[] = []\n\n\n    let textFontSize = this.configuration.size\n    if (onlyText && textFontSize === \"auto\") {\n      textFontSize = Math.round(this.computeFontSize(jiixChars.filter(c => c.items?.length)) / 2) * 2\n    }\n    else if (this.configuration.size !== \"auto\") {\n      textFontSize = this.configuration.size * this.rowHeight\n    }\n\n    let isNewLine = false\n    let currentY = convertMillimeterToPixel(text.lines[0][\"baseline-y\"])\n    const leftX = convertMillimeterToPixel(text[\"bounding-box\"]?.x || 0)\n    let currentX = convertMillimeterToPixel(jiixWords[0][\"bounding-box\"]?.x || 0)\n    jiixWords.forEach(word =>\n    {\n      if (word.label === \" \") {\n        currentX += this.editor.texter.getSpaceWidth(result.at(-1)?.symbol.chars[0].fontSize|| (this.rowHeight / 2))\n        return\n      }\n      const wordStrokes = strokes.filter(s => word.items?.some(i => i[\"full-id\"] === s.id)) as IIStroke[]\n      if (wordStrokes.length) {\n        const chars = jiixChars.slice(word[\"first-char\"] as number, (word[\"last-char\"] || 0) + 1)\n        const wordSymbol = this.buildText(word, chars, wordStrokes, textFontSize)\n\n        if (onlyText) {\n          if (isNewLine) {\n            isNewLine = false\n            const nbRow = Math.round((wordSymbol.point.y - currentY) / this.rowHeight) || 1\n            currentY += nbRow * this.rowHeight\n            if (Math.abs(wordSymbol.point.x - leftX) < this.rowHeight) {\n              currentX = leftX\n            }\n            else {\n              currentX = wordSymbol.point.x\n            }\n          }\n          wordSymbol.point.x = currentX\n          wordSymbol.point.y = this.model.roundToLineGuide(currentY)\n        }\n\n        this.editor.texter.setBounds(wordSymbol)\n        currentX += wordSymbol.bounds.width\n        result.push({\n          symbol: wordSymbol,\n          strokes: wordStrokes\n        })\n      }\n      isNewLine = word.label === \"\\n\"\n    })\n\n    return result\n  }\n\n  buildCircle(circle: TJIIXNodeCircle, strokes: IIStroke[]): IIShapeCircle\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(circle.cx),\n      y: convertMillimeterToPixel(circle.cy)\n    }\n    return new IIShapeCircle(center, convertMillimeterToPixel(circle.r), strokes[0]?.style)\n  }\n\n  buildEllipse(ellipse: TJIIXNodeEllipse, strokes: IIStroke[]): IIShapeEllipse\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(ellipse.cx),\n      y: convertMillimeterToPixel(ellipse.cy),\n    }\n    return new IIShapeEllipse(center, convertMillimeterToPixel(ellipse.rx), convertMillimeterToPixel(ellipse.ry), ellipse.orientation, strokes[0]?.style)\n  }\n\n  buildRectangle(rectangle: TJIIXNodeRectangle, strokes: IIStroke[]): IIShapePolygon\n  {\n    const height = convertMillimeterToPixel(rectangle.height)\n    const width = convertMillimeterToPixel(rectangle.width)\n    const x = convertMillimeterToPixel(rectangle.x)\n    const y = convertMillimeterToPixel(rectangle.y)\n    const points: TPoint[] = [\n      { x, y },\n      { x: x + width, y },\n      { x: x + width, y: y + height },\n      { x, y: y + height }\n    ]\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildPolygon(polygon: TJIIXNodePolygon, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildRhombus(polygon: TJIIXNodeRhombus, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildTriangle(polygon: TJIIXNodeTriangle, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildParallelogram(polygon: TJIIXNodeParrallelogram, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  convertNode(node: TJIIXNodeElement, strokes: IIStroke[]): { symbol: TIIShape, strokes: IIStroke[] } | undefined\n  {\n    const associatedStroke = strokes.filter(s => node.items?.some(i => i[\"full-id\"] === s.id))\n    if (!associatedStroke.length) return\n\n    const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n\n    let shape: TIIShape\n    switch (node.kind) {\n      case JIIXNodeKind.Circle:\n        shape = this.buildCircle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Ellipse:\n        shape = this.buildEllipse(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rectangle:\n        shape = this.buildRectangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Triangle:\n        shape = this.buildTriangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Parallelogram:\n        shape = this.buildParallelogram(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Polygon:\n        shape = this.buildPolygon(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rhombus:\n        shape = this.buildRhombus(node, uniqStrokes)\n        break\n      default:\n        this.#logger.warn(\"convertNode\", `Conversion of Node with kind equal to ${ JSON.stringify(node) } is unknow`)\n        return\n    }\n    return { symbol: shape, strokes: uniqStrokes }\n  }\n\n  buildLine(line: TJIIXEdgeLine, strokes: IIStroke[]): IIEdgeLine\n  {\n    const point1: TPoint = { x: convertMillimeterToPixel(line.x1), y: convertMillimeterToPixel(line.y1) }\n    const point2: TPoint = { x: convertMillimeterToPixel(line.x2), y: convertMillimeterToPixel(line.y2) }\n    const angle = computeAngleAxeRadian(point1, point2)\n\n    if (Math.abs(angle % Math.PI) < 0.1) {\n      // to adjust the line with the horizontal\n      point1.y = +((point1.y + point2.y) / 2).toFixed(3)\n      point2.y = point1.y\n    }\n    else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n      // to adjust the line with the vertical\n      point1.x = +((point1.x + point2.x) / 2).toFixed(3)\n      point2.x = point1.x\n    }\n    return new IIEdgeLine(point1, point2, line.p1Decoration, line.p2Decoration, strokes[0]?.style)\n  }\n\n  buildPolyEdge(polyline: TJIIXEdgePolyEdge, strokes: IIStroke[]): IIEdgePolyLine\n  {\n    const start: TPoint = { x: convertMillimeterToPixel(polyline.edges[0].x1), y: convertMillimeterToPixel(polyline.edges[0].y1) }\n    const points = polyline.edges.map(e => ({ x: convertMillimeterToPixel(e.x2), y: convertMillimeterToPixel(e.y2) }))\n    points.unshift(start)\n    for (let index = 0; index < points.length - 1; index++) {\n      const p1 = points[index]\n      const p2 = points[index + 1]\n      const angle = computeAngleAxeRadian(p1, p2)\n      if (Math.abs(angle % Math.PI) < 0.1) {\n        p1.y = +((p1.y + p2.y) / 2).toFixed(3)\n        p2.y = p1.y\n      }\n      else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n        p1.x = +((p1.x + p2.x) / 2).toFixed(3)\n        p2.x = p1.x\n      }\n    }\n\n    return new IIEdgePolyLine(points, polyline.edges[0].p1Decoration, polyline.edges.at(-1)!.p2Decoration, strokes[0]?.style)\n  }\n\n  buildArc(arc: TJIIXEdgeArc, strokes: IIStroke[]): IIEdgeArc\n  {\n    const center: TPoint = { x: convertMillimeterToPixel(arc.cx), y: convertMillimeterToPixel(arc.cy) }\n    const radiusX = convertMillimeterToPixel(arc.rx)\n    const radiusY = convertMillimeterToPixel(arc.ry)\n    return new IIEdgeArc(center, arc.startAngle, arc.sweepAngle, radiusX, radiusY, arc.phi, arc.startDecoration, arc.endDecoration, strokes[0]?.style)\n  }\n\n  convertEdge(edge: TJIIXEdgeElement, strokes: IIStroke[]): { symbol: TIIEdge, strokes: IIStroke[] } | undefined\n  {\n    switch (edge.kind) {\n      case JIIXEdgeKind.Line: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildLine(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.Arc: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildArc(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.PolyEdge: {\n        const associatedStroke = strokes.filter(s => edge.edges.flatMap(e => e.items)?.some(i => i![\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildPolyEdge(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      default:\n        this.#logger.error(\"convertEdge\", `Conversion of Edge with kind equal to ${ JSON.stringify(edge) } is unknow`)\n        return\n    }\n  }\n\n  async apply(symbols: TIISymbol[] = []): Promise<void>\n  {\n    this.#logger.info(\"convert\")\n    if (!this.model.exports?.[\"application/vnd.myscript.jiix\"]) {\n      await this.editor.export([\"application/vnd.myscript.jiix\"])\n    }\n    this.editor.selector.removeSelectedGroup()\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"] as TJIIXExport\n    if (jiix?.elements?.length) {\n      const strokesToConvert = this.editor.extractStrokesFromSymbols(symbols.length ? symbols : this.model.symbols)\n\n      const onlyText = !jiix.elements?.some(e => e.type !== \"Text\")\n      const conversionResults: { symbol: TIISymbol, strokes: IIStroke[] }[] = []\n      jiix.elements.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            const conversion = this.convertText(el, strokesToConvert, onlyText)\n            if (conversion) {\n              conversionResults.push(...conversion)\n            }\n            break\n          }\n          case \"Node\": {\n            const conversion = this.convertNode(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          case \"Edge\": {\n            const conversion = this.convertEdge(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"buildConversions\", `Unknow jiix element type: ${ el.type }`)\n          }\n        }\n      })\n\n      this.editor.addSymbols(conversionResults.map(cs => cs.symbol), false)\n      this.editor.removeSymbols(conversionResults.flatMap(cs => cs.strokes.map(s => s.id)), false)\n      this.editor.history.push(this.model, { added: conversionResults.map(c => c.symbol), erased: conversionResults.flatMap(cs => cs.strokes) })\n    }\n  }\n}\n","import { ResizeDirection, SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIStroke,\n  IISymbolGroup,\n  IIText,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint,\n  TIIRecognized,\n  RecognizedKind\n} from \"../symbol\"\n\n/**\n * @group Manager\n */\nexport class IIResizeManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n\n  interactElementsGroup?: SVGElement\n  direction!: ResizeDirection\n  boundingBox!: Box\n  transformOrigin!: TPoint\n  keepRatio = false\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, origin: TPoint, scaleX: number, scaleY: number): IIStroke\n  {\n    this.#logger.debug(\"applyToStroke\", { stroke, origin, scaleX, scaleY })\n    stroke.pointers.forEach(p =>\n    {\n      p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n      p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, origin: TPoint, scaleX: number, scaleY: number): TIIShape\n  {\n    this.#logger.debug(\"applyToShape\", { shape, origin, scaleX, scaleY })\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        const cosPhi = Math.cos(shape.orientation)\n        const sinPhi = Math.sin(shape.orientation)\n        shape.center.x = +(shape.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(shape.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (shape.center.y - origin.y)).toFixed(3)\n        shape.radiusX = +(Math.abs(shape.radiusX * (scaleX * cosPhi - scaleY * sinPhi))).toFixed(3)\n        shape.radiusY = +(Math.abs(shape.radiusY * (scaleX * sinPhi + scaleY * cosPhi))).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.radius = +(shape.radius * (scaleX + scaleY) / 2).toFixed(3)\n        shape.center.x = +(origin.x + scaleX * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(origin.y + scaleY * (shape.center.y - origin.y)).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply resize on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, origin: TPoint, scaleX: number, scaleY: number): TIIEdge\n  {\n    this.#logger.debug(\"applyToEdge\", { edge, origin, scaleX, scaleY })\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        const cosPhi = Math.cos(edge.phi)\n        const sinPhi = Math.sin(edge.phi)\n        edge.center.x = +(edge.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (edge.center.x - origin.x)).toFixed(3)\n        edge.center.y = +(edge.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (edge.center.y - origin.y)).toFixed(3)\n        edge.radiusX = +(edge.radiusX * Math.abs(scaleX * cosPhi + scaleY * sinPhi)).toFixed(3)\n        edge.radiusY = +(edge.radiusY * Math.abs(scaleX * sinPhi + scaleY * cosPhi)).toFixed(3)\n\n        if (scaleX < 0) {\n          edge.startAngle = +(Math.PI - edge.startAngle).toFixed(3)\n          edge.sweepAngle *= -1\n        }\n        else if (scaleY < 0) {\n          edge.sweepAngle *= -1\n        }\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x = +(origin.x + scaleX * (edge.start.x - origin.x)).toFixed(3)\n        edge.start.y = +(origin.y + scaleY * (edge.start.y - origin.y)).toFixed(3)\n        edge.end.x = +(origin.x + scaleX * (edge.end.x - origin.x)).toFixed(3)\n        edge.end.y = +(origin.y + scaleY * (edge.end.y - origin.y)).toFixed(3)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n          return p\n        })\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply resize on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n  }\n\n  protected applyOnText(text: IIText, origin: TPoint, scaleX: number, scaleY: number): IIText\n  {\n    text.point.x = +(origin.x + scaleX * (text.point.x - origin.x)).toFixed(3)\n    text.point.y = +(origin.y + scaleY * (text.point.y - origin.y)).toFixed(3)\n\n    text.chars.forEach(c =>\n    {\n      c.fontSize = +(c.fontSize * (scaleX + scaleY) / 2).toFixed(3)\n    })\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, origin: TPoint, scaleX: number, scaleY: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, origin, scaleX, scaleY))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(recognizedSymbol: TIIRecognized, origin: TPoint, scaleX: number, scaleY: number): TIIRecognized\n  {\n    recognizedSymbol.strokes.forEach(s => this.applyToStroke(s, origin, scaleX, scaleY))\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.xHeight *= scaleY\n    }\n    return recognizedSymbol\n  }\n\n  applyToSymbol(symbol: TIISymbol, origin: TPoint, scaleX: number, scaleY: number): TIISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, scaleX, scaleY })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, origin, scaleX, scaleY)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, origin, scaleX, scaleY)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, origin, scaleX, scaleY)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, origin, scaleX, scaleY)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, origin, scaleX, scaleY)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, origin, scaleX, scaleY)\n      default:\n        throw new Error(`Can't apply resize on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.editor.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  scaleElement(id: string, sx: number, sy: number): void\n  {\n    this.#logger.info(\"scaleElement\", { id, sx, sy })\n    this.editor.renderer.setAttribute(id, \"transform\", `scale(${ sx },${ sy })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.direction = target.getAttribute(\"resize-direction\") as ResizeDirection\n\n    this.keepRatio = this.model.symbolsSelected.some(s => s.type === SymbolType.Text || (s.type === SymbolType.Shape && (s as TIIShape).kind === ShapeKind.Circle))\n\n    this.transformOrigin = origin\n    this.boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n    this.setTransformOrigin(this.interactElementsGroup!.id, this.transformOrigin.x, this.transformOrigin.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.transformOrigin.x, this.transformOrigin.y)\n    })\n  }\n\n  continue(point: TPoint): { scaleX: number, scaleY: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't resize, you must call start before\")\n    }\n    const localPoint = point\n    const horizontalResize = [\n      ResizeDirection.East,\n      ResizeDirection.NorthEast,\n      ResizeDirection.SouthEast,\n      ResizeDirection.West,\n      ResizeDirection.NorthWest,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const verticalResize = [\n      ResizeDirection.North,\n      ResizeDirection.NorthEast,\n      ResizeDirection.NorthWest,\n      ResizeDirection.South,\n      ResizeDirection.SouthEast,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const { x, y } = this.editor.snaps.snapResize(point, horizontalResize, verticalResize)\n    localPoint.x = x\n    localPoint.y = y\n\n    let deltaX = 0, deltaY = 0\n    if ([ResizeDirection.East, ResizeDirection.NorthEast, ResizeDirection.SouthEast].includes(this.direction)) {\n      deltaX = localPoint.x - this.boundingBox.xMax\n    }\n    else if ([ResizeDirection.West, ResizeDirection.NorthWest, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaX = this.boundingBox.xMin - localPoint.x\n    }\n\n    if ([ResizeDirection.North, ResizeDirection.NorthEast, ResizeDirection.NorthWest].includes(this.direction)) {\n      deltaY = this.boundingBox.yMin - localPoint.y\n    }\n    else if ([ResizeDirection.South, ResizeDirection.SouthEast, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaY = localPoint.y - this.boundingBox.yMax\n    }\n\n    let scaleX = this.boundingBox.width ? 1 + (deltaX / this.boundingBox.width) : 1\n    let scaleY = this.boundingBox.height ? 1 + (deltaY / this.boundingBox.height) : 1\n\n    if (this.keepRatio) {\n      if ([ResizeDirection.North, ResizeDirection.South].includes(this.direction)) {\n        scaleX = scaleY\n      }\n      else if ([ResizeDirection.East, ResizeDirection.West].includes(this.direction)) {\n        scaleY = scaleX\n      }\n      else {\n        scaleX = Math.max(scaleX, scaleY)\n        scaleY = scaleX\n      }\n    }\n    this.scaleElement(this.interactElementsGroup.id, scaleX, scaleY)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.scaleElement(s.id, scaleX, scaleY)\n    })\n    return {\n      scaleX,\n      scaleY\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { scaleX, scaleY } = this.continue(point)\n    this.editor.snaps.clearSnapToElementLines()\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.transformOrigin, scaleX, scaleY)\n      this.editor.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n\n    const strokesFromSymbols = this.editor.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.editor.recognizer.transformScale(strokesFromSymbols.map(s => s.id), scaleX, scaleY, this.transformOrigin.x, this.transformOrigin.y)\n    this.editor.history.push(this.model, { scale: [{ symbols: oldSymbols, origin: {...this.transformOrigin}, scaleX, scaleY }] })\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIStroke,\n  IISymbolGroup,\n  IIText,\n  TIIRecognized,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint\n} from \"../symbol\"\nimport { computeAngleRadian, convertDegreeToRadian, convertRadianToDegree, computeRotatedPoint } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class IIRotationManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n  interactElementsGroup?: SVGElement\n  center!: TPoint\n  origin!: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, center: TPoint, angleRad: number): IIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      const { x, y } = computeRotatedPoint(p, center, angleRad)\n      p.x = x\n      p.y = y\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, center: TPoint, angleRad: number): TIIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        shape.orientation = (shape.orientation + angleRad) % (2 * Math.PI)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          const { x, y } = computeRotatedPoint(p, center, angleRad)\n          p.x = x\n          p.y = y\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply rotate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, center: TPoint, angleRad: number): TIIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.phi = (edge.phi - angleRad) % (2 * Math.PI)\n        edge.center = computeRotatedPoint(edge.center, center, angleRad)\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start = computeRotatedPoint(edge.start, center, angleRad)\n        edge.end = computeRotatedPoint(edge.end, center, angleRad)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points = edge.points.map(p => computeRotatedPoint(p, center, angleRad))\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply rotate on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n    return edge\n  }\n\n  protected applyOnText(text: IIText, center: TPoint, angleRad: number): IIText\n  {\n    text.rotation = {\n      degree: convertRadianToDegree(angleRad) + (text.rotation?.degree || 0),\n      center: center\n    }\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, center: TPoint, angleRad: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, center, angleRad))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(strokeText: TIIRecognized, center: TPoint, angleRad: number): TIIRecognized\n  {\n    strokeText.strokes.forEach(s => this.applyToStroke(s, center, angleRad))\n    return strokeText\n  }\n\n  applyToSymbol(symbol: TIISymbol, center: TPoint, angleRad: number): TIISymbol\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, center, angleRad)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, center, angleRad)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, center, angleRad)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, center, angleRad)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, center, angleRad)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, center, angleRad)\n      default:\n        throw new Error(`Can't apply rotate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.editor.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  rotateElement(id: string, degree: number): void\n  {\n    this.#logger.info(\"rotateElement\", { id, degree })\n    this.editor.renderer.setAttribute(id, \"transform\", `rotate(${ degree })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    const boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n\n    this.center = {\n      x: boundingBox.xMin + boundingBox.width / 2,\n      y: boundingBox.yMid\n    }\n    this.origin = origin\n    this.setTransformOrigin(this.interactElementsGroup.id, this.center.x, this.center.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.center.x, this.center.y)\n    })\n  }\n\n  continue(point: TPoint): number\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't rotate, you must call start before\")\n    }\n    let angleDegree = Math.round(convertRadianToDegree(computeAngleRadian(this.origin, this.center, point)))\n\n    angleDegree = this.editor.snaps.snapRotation(angleDegree)\n\n    if (point.x - this.center.x < 0) {\n      angleDegree = 360 - angleDegree\n    }\n\n    this.rotateElement(this.interactElementsGroup.id, angleDegree)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.rotateElement(s.id, angleDegree)\n    })\n    return angleDegree\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const angleDegree = this.continue(point)\n    const angleRad = convertDegreeToRadian(angleDegree) % (2 * Math.PI)\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.center, angleRad)\n      this.editor.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n    const strokesFromSymbols = this.editor.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.editor.recognizer.transformRotate(strokesFromSymbols.map(s => s.id), angleRad, this.center.x, this.center.y)\n    this.editor.history.push(this.model, { rotate: [{ symbols: oldSymbols, angle: angleRad, center: {...this.center}, }] })\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n}\n","\n/**\n * @group Grabber\n */\nexport type TListenerConfiguration = {\n  capture: boolean\n  passive: boolean\n}\n\n/**\n * @group Grabber\n * @source\n */\nexport const DefaultListenerConfiguration: TListenerConfiguration = {\n  capture: false,\n  passive: true\n}\n\n/**\n * @group Grabber\n */\nexport type TGrabberConfiguration = {\n  listenerOptions: TListenerConfiguration\n  xyFloatPrecision: number\n  timestampFloatPrecision: number\n  delayLongTouch: number\n}\n\n/**\n * @group Grabber\n * @source\n */\nexport const DefaultGrabberConfiguration: TGrabberConfiguration = {\n  listenerOptions: DefaultListenerConfiguration,\n  xyFloatPrecision: 0,\n  timestampFloatPrecision: 0,\n  delayLongTouch: 500\n}\n","import { TGrabberConfiguration } from \"./GrabberConfiguration\"\nimport { LoggerCategory, LoggerLevel, LoggerManager } from \"../logger\"\nimport { TPointer } from \"../symbol\"\n\nexport type PointerInfo = {\n  clientX: number,\n  clientY: number,\n  isPrimary: boolean,\n  type: string,\n  pointerType: string,\n  target: HTMLElement,\n  pointer: TPointer,\n  button: number,\n  buttons: number\n}\n\n/**\n * @group Grabber\n */\nexport class PointerEventGrabber\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.GRABBER)\n\n  protected configuration: TGrabberConfiguration\n  protected layerCapture!: HTMLElement\n  protected capturing: boolean = false\n  protected pointerType?: string\n  protected prevent = (e: Event) => e.preventDefault()\n\n  onPointerDown?: (info: PointerInfo) => void\n  onPointerMove?: (info: PointerInfo) => void\n  onPointerUp?: (info: PointerInfo) => void\n  onContextMenu?: (info: PointerInfo) => void\n\n  constructor(configuration: TGrabberConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected roundFloat(oneFloat: number, requestedFloatPrecision: number): number\n  {\n    if (requestedFloatPrecision >= 0) {\n      const floatPrecision: number = Math.pow(10, requestedFloatPrecision)\n      return Math.round(oneFloat / floatPrecision) * floatPrecision\n    }\n    this.#logger.debug(\"roundFloat\", { oneFloat, requestedFloatPrecision })\n    return oneFloat\n  }\n\n  protected extractPointer(event: MouseEvent | TouchEvent): TPointer\n  {\n    let clientX: number, clientY: number\n    if (\"changedTouches\" in event) {\n      ({ clientX, clientY } = event.changedTouches[0])\n    } else {\n      ({ clientX, clientY } = event)\n    }\n    const rect: DOMRect = this.layerCapture.getBoundingClientRect()\n    const pointer = {\n      x: this.roundFloat(clientX - rect.left - this.layerCapture.clientLeft + this.layerCapture.scrollLeft, this.configuration.xyFloatPrecision),\n      y: this.roundFloat(clientY - rect.top - this.layerCapture.clientTop + this.layerCapture.scrollTop, this.configuration.xyFloatPrecision),\n      t: this.roundFloat(Date.now(), this.configuration.timestampFloatPrecision),\n      p: (event as PointerEvent).pressure,\n    }\n    this.#logger.debug(\"extractPointer\", { event, pointer })\n    return pointer\n  }\n\n  protected getPointerInfos(evt: PointerEvent): PointerInfo\n  {\n    return {\n      clientX: evt.clientX,\n      clientY: evt.clientY,\n      isPrimary: evt.isPrimary,\n      type: evt.type,\n      target: evt.target as HTMLElement,\n      pointerType: evt.pointerType,\n      pointer: this.extractPointer(evt),\n      button: evt.button,\n      buttons: evt.buttons\n    }\n  }\n\n  protected pointerDownHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerDownHandler\", pointerInfo)\n\n    // exit if not a left click or multi-touch\n    if (pointerInfo.button !== 0 || evt.buttons !== 1) {\n      return\n    }\n    this.capturing = true\n    this.pointerType = evt.pointerType\n\n    if (this.#logger.level === LoggerLevel.INFO) {\n      this.#logger.info(\"pointerDownHandler\", pointerInfo)\n    }\n\n    if (this.onPointerDown) {\n      this.onPointerDown(pointerInfo)\n    }\n  }\n\n  protected pointerMoveHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerMoveHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerMoveHandler\", pointerInfo)\n      }\n      if (this.onPointerMove) {\n        this.onPointerMove(pointerInfo)\n      }\n    }\n  }\n\n  protected pointerUpHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerUpHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerUpHandler\", pointerInfo)\n      }\n      this.pointerType = undefined\n      this.capturing = false\n      if (this.onPointerUp) {\n        this.onPointerUp(pointerInfo)\n      }\n    }\n  }\n\n  protected pointerOutHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerOutHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType && !this.layerCapture.contains(evt.target as HTMLElement)) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerOutHandler\", pointerInfo)\n      }\n      this.pointerType = undefined\n      this.capturing = false\n      if (this.onPointerUp) {\n        this.onPointerUp(pointerInfo)\n      }\n    }\n  }\n\n  protected contextMenuHandler = (evt: MouseEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt as PointerEvent)\n    this.#logger.debug(\"contextMenuHandler\", pointerInfo)\n    if (evt.target && this.onContextMenu){\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"contextMenuHandler\", pointerInfo)\n      }\n      this.onContextMenu(pointerInfo)\n    }\n  }\n\n  stopPointerEvent(): void\n  {\n    this.capturing = false\n    this.pointerType = undefined\n  }\n\n  attach(layerCapture: HTMLElement)\n  {\n    this.#logger.info(\"attach\", { domElement: layerCapture })\n    if (this.layerCapture) {\n      this.detach()\n    }\n    this.layerCapture = layerCapture\n    // The touch-action CSS property prevents the input from continuing.\n    // https://developer.mozilla.org/en-US/docs/Web/API/Element/pointercancel_event\n    this.layerCapture.style.setProperty(\"touch-action\", \"none\")\n    this.layerCapture.addEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n\n  detach()\n  {\n    this.#logger.info(\"detach\")\n    this.layerCapture?.style.removeProperty(\"touch-action\")\n    this.layerCapture?.removeEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n}\n","import { ResizeDirection, SELECTION_MARGIN, SvgElementRole } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, IIText, SymbolType, TBox, TIIEdge, TIISymbol, TPoint } from \"../symbol\"\nimport { IISVGRenderer, SVGBuilder } from \"../renderer\"\nimport { IIResizeManager } from \"./IIResizeManager\"\nimport { IIRotationManager } from \"./IIRotationManager\"\nimport { IITranslateManager } from \"./IITranslateManager\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\n\n/**\n * @group Manager\n */\nexport class IISelectionManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.SELECTION)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  #selectingId = \"selecting-rect\"\n  startSelectionPoint?: TPoint\n  endSelectionPoint?: TPoint\n  selectedGroup?: SVGGElement\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n    this.grabber.onContextMenu = this.onContextMenu.bind(this)\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): IISVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get rotator(): IIRotationManager\n  {\n    return this.editor.rotator\n  }\n\n  get translator(): IITranslateManager\n  {\n    return this.editor.translator\n  }\n\n  get resizer(): IIResizeManager\n  {\n    return this.editor.resizer\n  }\n\n  get selectionBox(): Box | undefined\n  {\n    if (this.startSelectionPoint && this.endSelectionPoint) {\n      return Box.createFromPoints([this.startSelectionPoint, this.endSelectionPoint])\n    }\n    return\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.removeSelectedGroup()\n    this.grabber.attach(layer)\n  }\n\n  detach(): void\n  {\n    this.removeSelectedGroup()\n    this.grabber.detach()\n  }\n\n  drawSelectingRect(box: TBox): void\n  {\n    this.clearSelectingRect()\n    const attrs = {\n      id: this.#selectingId,\n      fill: \"transparent\",\n      stroke: \"grey\",\n      opacity: \"0.25\",\n    }\n    this.renderer.appendElement(SVGBuilder.createRect(box, attrs))\n  }\n\n  clearSelectingRect(): void\n  {\n    this.renderer.clearElements({ attrs: { id: this.#selectingId } })\n  }\n\n  protected getPoint(ev: PointerEvent): TPoint\n  {\n    const { clientLeft, scrollLeft, clientTop, scrollTop } = this.renderer.parent\n    const rect: DOMRect = this.renderer.parent.getBoundingClientRect()\n    return {\n      x: ev.clientX - rect.left - clientLeft + scrollLeft,\n      y: ev.clientY - rect.top - clientTop + scrollTop,\n    }\n  }\n\n  protected createTranslateRect(box: TBox): SVGRectElement\n  {\n    const attrs = {\n      role: SvgElementRole.Translate,\n      style: \"cursor:move\",\n      fill: \"transparent\",\n      stroke: \"transparent\",\n    }\n    const boxWithMarge: TBox = {\n      height: box.height,\n      width: box.width,\n      x: box.x,\n      y: box.y\n    }\n    const translateEl = SVGBuilder.createRect(boxWithMarge, attrs)\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      this.renderer.layer.style.cursor = \"\"\n      this.resetSelectedGroup(this.model.symbolsSelected)\n    }\n\n    translateEl.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.hideInteractElements()\n      this.translator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n\n      this.renderer.layer.style.cursor = \"move\"\n    })\n    return translateEl\n  }\n\n  protected createRotateGroup(box: TBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Rotate,\n      \"vector-effect\": \"non-scaling-size\",\n      \"style\": \"cursor:pointer;\",\n      \"opacity\": \"1\",\n    })\n    const radius = 8\n    const center: TPoint = {\n      x: (box.x + box.width / 2),\n      y: box.y - 4 * SELECTION_MARGIN\n    }\n    const attrs1 = {\n      role: SvgElementRole.Rotate,\n      \"stroke-width\": \"2\",\n      \"stroke\": \"black\",\n      fill: \"white\",\n    }\n    group.appendChild(SVGBuilder.createCircle(center, radius, attrs1))\n\n    const attrs2 = {\n      role: SvgElementRole.Rotate,\n      fill: \"black\",\n    }\n\n    group.appendChild(SVGBuilder.createCircle(center, radius / 2, attrs2))\n    const attrs3 = {\n      role: SvgElementRole.Rotate,\n      stroke: \"black\",\n      \"stroke-width\": \"2\"\n    }\n    group.appendChild(SVGBuilder.createLine({ x: center.x, y: center.y + radius }, { x: center.x, y: box.y - SELECTION_MARGIN }, attrs3))\n\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      this.resetSelectedGroup(this.model.symbolsSelected)\n    }\n\n    group.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.hideInteractElements()\n      this.rotator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n    })\n    return group\n  }\n\n  protected createResizeGroup(box: TBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n    const P_NW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_NE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_SE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n    const P_SW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n\n    const bindEl = (el: SVGElement, transformOrigin: TPoint, cursor: string) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.continue(this.getPoint(ev))\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.end(this.getPoint(ev))\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n\n        this.renderer.layer.style.cursor = \"\"\n        this.resetSelectedGroup(this.model.symbolsSelected)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.hideInteractElements()\n        this.renderer.layer.style.cursor = cursor\n        this.resizer.start(ev.target as Element, transformOrigin)\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n\n    const sideResizeDefs = [\n      { direction: ResizeDirection.North, p1: P_NW, p2: P_NE, transformOrigin: { x: box.x + box.width / 2, y: box.y + box.height } },\n      { direction: ResizeDirection.East, p1: P_NE, p2: P_SE, transformOrigin: { x: box.x, y: box.y + box.height / 2 } },\n      { direction: ResizeDirection.South, p1: P_SW, p2: P_SE, transformOrigin: { x: box.x + box.width / 2, y: box.y } },\n      { direction: ResizeDirection.West, p1: P_NW, p2: P_SW, transformOrigin: { x: box.x + box.width, y: box.y + box.height / 2 } },\n    ]\n    sideResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        style: `cursor:${ def.direction };`\n      }\n      const lineResize = SVGBuilder.createLine(def.p1, def.p2, attrs)\n      bindEl(lineResize, def.transformOrigin, def.direction)\n      group.appendChild(lineResize)\n    })\n    const cornerResizeDefs = [\n      { direction: ResizeDirection.NorthWest, p: P_NW, transformOrigin: { x: box.x + box.width, y: box.y + box.height } },\n      { direction: ResizeDirection.NorthEast, p: P_NE, transformOrigin: { x: box.x, y: box.y + box.height } },\n      { direction: ResizeDirection.SouthEast, p: P_SE, transformOrigin: { x: box.x, y: box.y } },\n      { direction: ResizeDirection.SouthWest, p: P_SW, transformOrigin: { x: box.x + box.width, y: box.y } },\n    ]\n    cornerResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        \"stroke-width\": \"4\",\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        transform: \"scale(1, 1)\",\n        fill: \"white\",\n        style: `cursor:${ def.direction };`\n      }\n      const cornerResize = SVGBuilder.createCircle(def.p, 5, attrs)\n      bindEl(cornerResize, def.transformOrigin, def.direction)\n      group.appendChild(cornerResize)\n    })\n    return group\n  }\n\n  protected createInteractElementsGroup(symbols: TIISymbol[]): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractElementsGroup\", { symbols })\n\n    if (!symbols.length) return\n\n    const symbolElementMap = symbols.map(s =>\n    {\n      return {\n        symbol: s,\n        element: this.renderer.getElementById(s.id),\n      }\n    })\n\n    const box1 = Box.createFromBoxes(symbols.map(s =>\n    {\n      return {\n        x: s.bounds.x - (s.style.width || 1),\n        y: s.bounds.y - (s.style.width || 1),\n        height: s.bounds.height + (s.style.width || 1) * 2,\n        width: s.bounds.width + (s.style.width || 1) * 2,\n      }\n    }))\n\n    const box2 = Box.createFromPoints(symbols.flatMap(s => s.vertices))\n    const box = Box.createFromBoxes([box1, box2])\n\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(box))\n    surroundGroup.appendChild(this.createResizeGroup(box))\n    surroundGroup.appendChild(this.createRotateGroup(box))\n    const SURROUND_ATTRS = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"#3e68ff\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"4\",\n      \"vector-effect\": \"non-scaling-size\",\n      transform: \"rotate(0, 0, 0)\"\n    }\n    symbolElementMap.forEach(s =>\n    {\n      if (s.element) {\n        const bounds: TBox = {\n          x: s.symbol.bounds.x - (s.symbol.style.width || 1),\n          y: s.symbol.bounds.y - (s.symbol.style.width || 1),\n          height: s.symbol.bounds.height + (s.symbol.style.width || 1) * 2,\n          width: s.symbol.bounds.width + (s.symbol.style.width || 1) * 2,\n        }\n        if (s.symbol.type === SymbolType.Text) {\n          const t = s.symbol as IIText\n          SURROUND_ATTRS.transform = `rotate(${ t.rotation?.degree || 0 }, ${ t.rotation?.center.x || 0 }, ${ t.rotation?.center.y || 0 })`\n        }\n        else {\n          SURROUND_ATTRS.transform = \"rotate(0, 0, 0)\"\n        }\n        surroundGroup.prepend(SVGBuilder.createRect(bounds, SURROUND_ATTRS))\n      }\n    })\n    return surroundGroup\n  }\n\n  protected createEdgeResizeGroup(edge: TIIEdge): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n\n    const radius = 5\n    const attrs = {\n      role: SvgElementRole.Resize,\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n      fill: \"white\",\n      style: `cursor:grab;`\n    }\n    const bindEl = (el: SVGCircleElement, pointIndex: number) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        const point = this.getPoint(ev)\n        const { x, y } = this.editor.snaps.snapResize(point)\n        edge.vertices[pointIndex].x = x\n        edge.vertices[pointIndex].y = y\n        this.model.updateSymbol(edge)\n        this.renderer.drawSymbol(edge)\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        const point = this.getPoint(ev)\n        const { x, y } = this.editor.snaps.snapResize(point)\n        edge.vertices[pointIndex].x = x\n        edge.vertices[pointIndex].y = y\n        this.renderer.layer.style.cursor = \"\"\n        this.editor.updateSymbol(edge)\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n        this.editor.snaps.clearSnapToElementLines()\n        this.resetSelectedGroup(this.model.symbolsSelected)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        this.renderer.layer.style.cursor = \"grabbing\"\n        this.hideInteractElements()\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n    edge.vertices.forEach((p, i) =>\n    {\n      const pointEl = SVGBuilder.createCircle(p, radius, attrs)\n      bindEl(pointEl, i)\n      group.appendChild(pointEl)\n    })\n\n    return group\n  }\n\n  protected createInteractEdgeGroup(edge: TIIEdge): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractEdgeGroup\", { edge })\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(edge.bounds))\n    surroundGroup.appendChild(this.createEdgeResizeGroup(edge.clone()))\n    return surroundGroup\n  }\n\n  drawSelectedGroup(symbols: TIISymbol[]): void\n  {\n    if (!symbols.length) return\n    if (symbols.length === 1 && symbols[0].type === SymbolType.Edge) {\n      this.selectedGroup = this.createInteractEdgeGroup(symbols[0] as TIIEdge)\n    }\n    else {\n      this.selectedGroup = this.createInteractElementsGroup(symbols)\n    }\n    if (this.selectedGroup) {\n      this.renderer.layer.appendChild(this.selectedGroup)\n      const groupBox = this.selectedGroup.getBBox()\n      this.editor.menu.context.position.x = groupBox.x + groupBox.width / 2 - this.renderer.parent.clientLeft\n      this.editor.menu.context.position.y = groupBox.y + groupBox.height - this.renderer.parent.clientTop\n      this.editor.menu.context.show()\n    }\n    this.editor.menu.update()\n  }\n\n  resetSelectedGroup(symbols: TIISymbol[]): void\n  {\n    this.#logger.info(\"resetSelectedGroup\", { symbols })\n    this.removeSelectedGroup()\n    this.drawSelectedGroup(symbols)\n  }\n\n  removeSelectedGroup(): void\n  {\n    this.#logger.info(\"removeSelectedGroup\")\n    this.editor.menu.context.hide()\n    this.selectedGroup?.remove()\n    this.selectedGroup = undefined\n  }\n\n  hideInteractElements(): void\n  {\n    this.editor.menu.context.hide()\n    const query = `[role=${ SvgElementRole.Resize }],[role=${ SvgElementRole.Rotate }],[role=${ SvgElementRole.Translate }]`\n    this.selectedGroup?.querySelectorAll(query)\n      .forEach(el =>\n      {\n        el.setAttribute(\"visibility\", \"hidden\")\n      })\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.removeSelectedGroup()\n    this.startSelectionPoint = info.pointer\n    this.endSelectionPoint = info.pointer\n    this.drawSelectingRect(this.selectionBox!)\n  }\n\n  continue(info: PointerInfo): TIISymbol[]\n  {\n    if (!this.startSelectionPoint) {\n      throw new Error(\"You need to call startSelectionByBox before\")\n    }\n    this.endSelectionPoint = info.pointer\n    const updatedSymbols: TIISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (s.selected !== s.overlaps(this.selectionBox!)) {\n        s.selected = s.overlaps(this.selectionBox!)\n        updatedSymbols.push(s)\n        this.renderer.drawSymbol(s)\n      }\n    })\n    this.drawSelectingRect(this.selectionBox!)\n    return updatedSymbols\n  }\n\n  end(info: PointerInfo): TIISymbol[]\n  {\n    const updatedSymbols = this.continue(info)\n    this.startSelectionPoint = undefined\n    this.endSelectionPoint = undefined\n    this.clearSelectingRect()\n    this.drawSelectedGroup(this.model.symbolsSelected)\n    this.editor.event.emitSelected(this.model.symbolsSelected)\n    this.editor.menu.style.update()\n    return updatedSymbols\n  }\n\n  protected async onContextMenu(info: PointerInfo): Promise<void>\n  {\n    let found = false\n    let currentEl = info.target as HTMLElement | null\n    const symbolTypesAllowed = [SymbolType.Edge.toString(), SymbolType.Shape.toString(), SymbolType.Stroke.toString(), SymbolType.Text.toString()]\n    while (currentEl && currentEl.tagName !== \"svg\" && !found) {\n      if (symbolTypesAllowed.includes(currentEl.getAttribute(\"type\") as string)) {\n        found = true\n      }\n      else {\n        currentEl = currentEl.parentElement\n      }\n    }\n    this.editor.unselectAll()\n    if (currentEl?.id) {\n      this.model.selectSymbol(currentEl.id)\n      this.renderer.drawSymbol(this.model.symbolsSelected[0])\n      this.drawSelectedGroup(this.model.symbolsSelected)\n      this.editor.updateLayerUI()\n    }\n    else {\n      this.editor.menu.context.position.x = info.pointer.x + this.renderer.parent.clientLeft\n      this.editor.menu.context.position.y = info.pointer.y + this.renderer.parent.clientTop\n      this.editor.menu.context.show()\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, IIText, SymbolType, TIISymbol, TIISymbolChar } from \"../symbol\"\nimport { IISVGRenderer } from \"../renderer\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\n\n/**\n * @group Manager\n */\nexport class IITextManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get renderer(): IISVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected drawSymbolHidden(text: IIText): SVGGElement\n  {\n    const clone = text.clone()\n    clone.id = \"text-to-measure\"\n    clone.chars.forEach(c => c.id += \"-to-measure\")\n    clone.decorators = []\n    this.renderer.layer.querySelector(`#${ clone.id }`)?.remove()\n    const el = this.renderer.buildElementFromSymbol(clone)!\n    el.setAttribute(\"visibility\", \"hidden\")\n    this.renderer.prependElement(el)\n    return el\n  }\n\n  setCharsBounds(text: IIText, textGroupEl: SVGGElement): IIText\n  {\n    const textEl = textGroupEl.querySelector(\"text\")\n    if (textEl) {\n      for (let i = 0; i < textEl.getNumberOfChars(); i++) {\n        const char = text.chars.at(i)\n        if (char) {\n          const ext = textEl.getExtentOfChar(i)\n          char.bounds = new Box(ext)\n        }\n      }\n    }\n    return text\n  }\n\n  setBounds(text: IIText): void\n  {\n    const element = this.drawSymbolHidden(text)\n    text.bounds = this.getElementBoundingBox(element)\n    this.setCharsBounds(text, element)\n  }\n\n  getElementBoundingBox(textElement: SVGElement): Box\n  {\n    return new Box(textElement.querySelector(\"text\")!.getBBox({ stroke: true, markers: true, clipped: true, fill: true }))\n  }\n\n  getBoundingBox(text: IIText): Box\n  {\n    const element = this.drawSymbolHidden(text)\n    return this.getElementBoundingBox(element)\n  }\n\n  getSpaceWidth(fontSize: number): number\n  {\n    const boundingBox = new Box({ height: 0, width: 0, x: 0, y: 0 })\n    const charSymbol: TIISymbolChar = {\n      id: `text-char-space`,\n      label: \"-\",\n      color: \"\",\n      fontSize,\n      fontWeight: \"normal\",\n      bounds: boundingBox\n    }\n    return this.getBoundingBox(new IIText([charSymbol], { x: 0, y: 0 }, boundingBox))?.width as number\n  }\n\n  updateBounds(textSymbol: IIText): IIText\n  {\n    this.setBounds(textSymbol)\n    this.model.updateSymbol(textSymbol)\n    return textSymbol\n  }\n\n  moveTextAfter(text: IIText, tx: number): TIISymbol[] | undefined\n  {\n    const row = this.model.getSymbolsByRowOrdered().find(r => r.rowIndex === this.model.getSymbolRowIndex(text))\n    if (row) {\n      const textsAfter = row.symbols.filter(s => s.type === SymbolType.Text && s.bounds.xMid > text.bounds.xMid) as IIText[]\n      textsAfter.forEach(symbol => {\n        symbol.point.x += tx\n        this.updateBounds(symbol)\n        this.model.updateSymbol(symbol)\n        this.renderer.drawSymbol(symbol)\n      })\n      return textsAfter\n    }\n    return\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  EdgeKind,\n  IIStroke,\n  IIText,\n  IISymbolGroup,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint,\n  TIIRecognized,\n  RecognizedKind\n} from \"../symbol\"\n\n/**\n * @group Manager\n */\nexport class IITranslateManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n  interactElementsGroup?: SVGElement\n  transformOrigin!: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, tx: number, ty: number): IIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      p.x += tx\n      p.y += ty\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, tx: number, ty: number): TIIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse:\n      case ShapeKind.Circle: {\n        shape.center.x += tx\n        shape.center.y += ty\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply translate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, tx: number, ty: number): TIIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.center.x += tx\n        edge.center.y += ty\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x += tx\n        edge.start.y += ty\n        edge.end.x += tx\n        edge.end.y += ty\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return edge\n      }\n    }\n\n    return edge\n  }\n\n  protected applyOnText(text: IIText, tx: number, ty: number): IIText\n  {\n    if (text.rotation) {\n      text.rotation.center = { x: text.rotation.center.x + tx, y: text.rotation.center.y + ty }\n    }\n    text.point.x += tx\n    text.point.y += ty\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, tx: number, ty: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, tx, ty))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(recognizedSymbol: TIIRecognized, tx: number, ty: number): TIIRecognized\n  {\n    recognizedSymbol.strokes.forEach(s => this.applyToStroke(s, tx, ty))\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.baseline += ty\n    }\n    return recognizedSymbol\n  }\n\n  applyToSymbol(symbol: TIISymbol, tx: number, ty: number): TIISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, tx, ty })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, tx, ty)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, tx, ty)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, tx, ty)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, tx, ty)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, tx, ty)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, tx, ty)\n      default:\n        throw new Error(`Can't apply translate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  translate(symbols: TIISymbol[], tx: number, ty: number, addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"translate\", { symbols, tx, ty })\n    symbols.forEach(s =>\n    {\n      this.applyToSymbol(s, tx, ty)\n      this.model.updateSymbol(s)\n      this.editor.renderer.drawSymbol(s)\n    })\n    if (addToHistory) {\n      this.editor.history.push(this.model, { translate: [{ symbols: this.model.symbolsSelected, tx, ty }] })\n    }\n    const strokes = this.editor.extractStrokesFromSymbols(symbols)\n    return this.editor.recognizer.transformTranslate(strokes.map(s => s.id), tx, ty)\n  }\n\n  translateElement(id: string, tx: number, ty: number): void\n  {\n    this.#logger.info(\"translateElement\", { id, tx, ty })\n    this.editor.renderer.setAttribute(id, \"transform\", `translate(${ tx },${ ty })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { origin })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.transformOrigin = origin\n  }\n\n  continue(point: TPoint): { tx: number, ty: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't translate, you must call start before\")\n    }\n\n    let tx = point.x - this.transformOrigin.x\n    let ty = point.y - this.transformOrigin.y\n\n    const nudge = this.editor.snaps.snapTranslate(tx, ty)\n    tx = nudge.x\n    ty = nudge.y\n\n    this.translateElement(this.interactElementsGroup.id as string, tx, ty)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.translateElement(s.id as string, tx, ty)\n    })\n    return {\n      tx,\n      ty\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { tx, ty } = this.continue(point)\n    this.editor.snaps.clearSnapToElementLines()\n    this.translate(this.model.symbolsSelected, tx, ty)\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n\n}\n","import { SELECTION_MARGIN, EditorWriteTool } from \"../Constants\"\nimport { TGesture } from \"../gesture\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  EdgeDecoration,\n  EdgeKind,\n  IIEdgeLine,\n  IIShapePolygon,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIStroke,\n  SymbolType,\n  TIIEdge,\n  TIISymbol,\n  TPoint,\n  TPointer\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { IISVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { IIHistoryManager } from \"../history\"\nimport { IIGestureManager } from \"../gesture/IIGestureManager\"\nimport { IISnapManager } from \"../snap/IISnapManager\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\n\n\n/**\n * @group Manager\n */\nexport class IIWriteManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.WRITE)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  #tool: EditorWriteTool = EditorWriteTool.Pencil\n  detectGesture: boolean = true\n\n  currentSymbolOrigin?: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get tool(): EditorWriteTool\n  {\n    return this.#tool\n  }\n  set tool(wt: EditorWriteTool)\n  {\n    this.#tool = wt\n    if (wt !== EditorWriteTool.Pencil) {\n      this.editor.layers.root.classList.add(\"shape\")\n    }\n    else {\n      this.editor.layers.root.classList.remove(\"shape\")\n    }\n    this.editor.unselectAll()\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): IISVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get history(): IIHistoryManager\n  {\n    return this.editor.history\n  }\n\n  get gestureManager(): IIGestureManager\n  {\n    return this.editor.gesture\n  }\n\n  get snaps(): IISnapManager\n  {\n    return this.editor.snaps\n  }\n\n  get recognizer(): RecognizerWebSocket\n  {\n    return this.editor.recognizer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  protected needContextLessGesture(stroke: IIStroke): boolean\n  {\n    const strokeBoundsWithMargin = this.editor.getSymbolsBounds([stroke], 2 * SELECTION_MARGIN)\n    return this.detectGesture && this.model.symbols.some(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Recognized:\n        case SymbolType.Stroke:\n          return false\n        case SymbolType.Group:\n          if (s.containsOnlyStroke()) {\n            return false\n          }\n          else {\n            return s.bounds.overlaps(strokeBoundsWithMargin)\n          }\n        default:\n          return s.bounds.overlaps(strokeBoundsWithMargin)\n      }\n    })\n  }\n\n  protected createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol\n  {\n    this.#logger.debug(\"createCurrentSymbol\", { pointer, style, pointerType })\n\n    switch (this.tool) {\n      case EditorWriteTool.Pencil:\n        this.model.currentSymbol = new IIStroke(style, pointerType)\n        break\n      case EditorWriteTool.Rectangle:\n        this.model.currentSymbol = IIShapePolygon.createRectangleBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Triangle:\n        this.model.currentSymbol = IIShapePolygon.createTriangleBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Parallelogram:\n        this.model.currentSymbol = IIShapePolygon.createParallelogramBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Rhombus:\n        this.model.currentSymbol = IIShapePolygon.createRhombusBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Circle:\n        this.model.currentSymbol = IIShapeCircle.createBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Ellipse:\n        this.model.currentSymbol = IIShapeEllipse.createBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Line:\n      case EditorWriteTool.Arrow:\n      case EditorWriteTool.DoubleArrow: {\n        let startDecoration, endDecoration\n        if (this.tool === EditorWriteTool.Arrow) {\n          endDecoration = EdgeDecoration.Arrow\n        }\n        else if (this.tool === EditorWriteTool.DoubleArrow) {\n          startDecoration = EdgeDecoration.Arrow\n          endDecoration = EdgeDecoration.Arrow\n        }\n        this.model.currentSymbol = new IIEdgeLine(pointer, pointer, startDecoration, endDecoration, style)\n        break\n      }\n      default:\n        throw new Error(`Can't create symbol, tool is unknow: \"${ this.tool }\"`)\n    }\n    return this.updateCurrentSymbol(pointer)\n  }\n\n  protected updateCurrentSymbolShape(pointer: TPointer): void\n  {\n    switch (this.tool) {\n      case EditorWriteTool.Rectangle:\n        IIShapePolygon.updateRectangleBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Triangle:\n        IIShapePolygon.updateTriangleBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Parallelogram:\n        IIShapePolygon.updateParallelogramBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Rhombus:\n        IIShapePolygon.updateRhombusBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Circle:\n        IIShapeCircle.updateBetweenPoints(this.model.currentSymbol as IIShapeCircle, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Ellipse:\n        IIShapeEllipse.updateBetweenPoints(this.model.currentSymbol as IIShapeEllipse, this.currentSymbolOrigin!, pointer)\n        break\n    }\n  }\n\n  protected updateCurrentSymbolEdge(pointer: TPointer): void\n  {\n    const edge = this.model.currentSymbol as TIIEdge\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        edge.end = pointer\n        break\n    }\n  }\n\n  protected updateCurrentSymbol(pointer: TPointer): TIISymbol\n  {\n    this.#logger.debug(\"updateCurrentSymbol\", { pointer })\n    if (!this.model.currentSymbol) {\n      throw new Error(\"Can't update current symbol because currentSymbol is undefined\")\n    }\n\n    switch (this.model.currentSymbol.type) {\n      case SymbolType.Stroke:\n        this.model.currentSymbol!.addPointer(pointer)\n        break\n      case SymbolType.Shape:\n        this.updateCurrentSymbolShape(pointer)\n        break\n      case SymbolType.Edge:\n        this.updateCurrentSymbolEdge(pointer)\n        break\n    }\n    return this.model.currentSymbol\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.#logger.info(\"startWriting\", { info })\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.currentSymbolOrigin = localPointer\n    this.createCurrentSymbol(localPointer, this.editor.penStyle, info.pointerType)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    this.#logger.info(\"continueWriting\", { info })\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.updateCurrentSymbol(localPointer)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  protected async interactWithBackend(stroke: IIStroke): Promise<void>\n  {\n    const localStroke = stroke.clone()\n    let gestureFromContextLess: TGesture | undefined\n    if (this.needContextLessGesture(stroke)) {\n      gestureFromContextLess = await this.gestureManager.getGestureFromContextLess(localStroke)\n    }\n    if (gestureFromContextLess) {\n      this.history.pop()\n      this.recognizer.addStrokes([localStroke], this.detectGesture)\n      await this.gestureManager.apply(localStroke, gestureFromContextLess)\n    }\n    else {\n      const gesture = await this.recognizer.addStrokes([localStroke], this.detectGesture)\n      if (gesture) {\n        this.history.pop()\n        await this.gestureManager.apply(localStroke, gesture)\n      }\n    }\n  }\n\n  async end(info: PointerInfo): Promise<void>\n  {\n    this.#logger.info(\"finishWriting\", { info })\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    const localSymbol = this.updateCurrentSymbol(localPointer)\n    this.model.currentSymbol = undefined\n    this.currentSymbolOrigin = undefined\n    this.snaps.clearSnapToElementLines()\n\n    this.renderer.drawSymbol(localSymbol!)\n    this.model.addSymbol(localSymbol)\n    this.history.push(this.model, { added: [localSymbol] })\n\n    if (localSymbol.type === SymbolType.Stroke) {\n      await this.interactWithBackend(localSymbol)\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { IIEraser, TSegment } from \"../symbol\"\nimport { IISVGRenderer } from \"../renderer\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\n\n/**\n * @group Manager\n */\nexport class IIEraseManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.WRITE)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  currentEraser?: IIEraser\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): IISVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.#logger.info(\"startErase\", { info })\n    this.currentEraser = new IIEraser()\n    this.currentEraser.pointers.push(info.pointer)\n    this.renderer.drawSymbol(this.currentEraser!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    this.#logger.info(\"continueErase\", { info })\n    if (!this.currentEraser) {\n      throw new Error(\"Can't update current eraser because currentEraser is undefined\")\n    }\n    this.currentEraser.pointers.push(info.pointer)\n    this.renderer.drawSymbol(this.currentEraser)\n    const lastSeg: TSegment = {\n      p1: this.currentEraser.pointers.at(-1)!,\n      p2: this.currentEraser.pointers.at(-2)!\n    }\n    this.model.symbols.forEach(s => {\n      if (s.isIntersected(lastSeg))\n      {\n        s.deleting = true\n      }\n    })\n    this.model.symbolsToDelete.map(s => this.renderer.drawSymbol(s))\n  }\n\n  async end(info: PointerInfo): Promise<void>\n  {\n    this.#logger.info(\"finishErasing\", { info })\n    this.continue(info)\n\n    this.renderer.removeSymbol(this.currentEraser!.id)\n    this.editor.removeSymbols(this.model.symbolsToDelete.map(s => s.id))\n    this.currentEraser = undefined\n  }\n}\n","import { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IIModel, JIIXEdgeKind } from \"../model\"\nimport { Box, IIText, SymbolType, TBox, TIISymbol } from \"../symbol\"\nimport { IISVGRenderer, IISVGRendererConst, SVGBuilder } from \"../renderer\"\nimport { convertBoundingBoxMillimeterToPixel, createUUID } from \"../utils\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\n\n/**\n * @group Manager\n */\nexport class IIDebugSVGManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.SVGDEBUG)\n  #snapPointsVisibility = false\n  #verticesVisibility = false\n  #boundingBoxVisibility = false\n  #recognitionBoxVisibility = false\n  #recognitionItemBoxVisibility = false\n\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): IISVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get snapPointsVisibility(): boolean\n  {\n    return this.#snapPointsVisibility\n  }\n  set snapPointsVisibility(show: boolean)\n  {\n    this.#snapPointsVisibility = show\n    this.debugSnapPoints()\n  }\n\n  get verticesVisibility(): boolean\n  {\n    return this.#verticesVisibility\n  }\n  set verticesVisibility(show: boolean)\n  {\n    this.#verticesVisibility = show\n    this.debugVertices()\n  }\n\n  get boundingBoxVisibility(): boolean\n  {\n    return this.#boundingBoxVisibility\n  }\n  set boundingBoxVisibility(show: boolean)\n  {\n    this.#boundingBoxVisibility = show\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    this.#boundingBoxVisibility ? this.showBoundingBox() : this.hideBoundingBox()\n  }\n\n  get recognitionBoxVisibility(): boolean\n  {\n    return this.#recognitionBoxVisibility\n  }\n  set recognitionBoxVisibility(show: boolean)\n  {\n    this.#recognitionBoxVisibility = show\n    this.debugRecognitionBox()\n  }\n\n  get recognitionItemBoxVisibility(): boolean\n  {\n    return this.#recognitionItemBoxVisibility\n  }\n  set recognitionItemBoxVisibility(show: boolean)\n  {\n    this.#recognitionItemBoxVisibility = show\n    this.debugRecognitionItemBox()\n  }\n\n  protected showSnapPoints(): void\n  {\n    this.#logger.info(\"showSnapPoints\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" }))\n    }\n    this.model.symbols.forEach(s => s.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" })))\n  }\n  protected hideSnapPoints(): void\n  {\n    this.#logger.info(\"hideSnapPoints\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"snap-points\" } })\n  }\n  debugSnapPoints(): void\n  {\n    this.hideSnapPoints()\n    if (this.snapPointsVisibility) {\n      this.showSnapPoints()\n    }\n  }\n\n  protected showVertices(): void\n  {\n    this.#logger.info(\"showVertices\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" }))\n    }\n    this.model.symbols.forEach(s => s.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" })))\n  }\n  protected hideVertices(): void\n  {\n    this.#logger.info(\"hideVertices\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"vertices\" } })\n  }\n  debugVertices(): void\n  {\n    this.hideVertices()\n    if (this.verticesVisibility) {\n      this.showVertices()\n    }\n  }\n\n  protected drawBoundingBox(symbols: TIISymbol[]): void\n  {\n    const symbolAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"red\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"5 5\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    const charAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"orange\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"0 5 0\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    symbols.forEach(s =>\n    {\n      const symEl = this.renderer.getElementById(s.id)\n      if (symEl) {\n        if (s.type === SymbolType.Text) {\n          const text = s as IIText\n          let transform: string = \"\"\n          if (text.rotation) {\n            transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n          }\n          text.chars.forEach(c =>\n          {\n            const ca = {\n              ...charAttrs,\n              char: c.label,\n              transform\n            }\n            symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(c.bounds, ca))\n          })\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n            transform\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n        else {\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n      }\n    })\n  }\n  protected showBoundingBox(): void\n  {\n    this.#logger.info(\"showBoundingBox\")\n    if (this.model.currentSymbol) {\n      this.drawBoundingBox([this.model.currentSymbol])\n    }\n    this.drawBoundingBox(this.model.symbols)\n  }\n  protected hideBoundingBox(): void\n  {\n    this.#logger.info(\"hideBoundingBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"bounding-box\" } })\n  }\n  debugBoundingBox(): void\n  {\n    this.hideBoundingBox()\n    if (this.boundingBoxVisibility) {\n      this.showBoundingBox()\n    }\n  }\n\n  protected drawRecognitionBox(box: TBox, infos?: string[]): void\n  {\n    const COLOR = \"green\"\n    const TEXT_HEIGHT = 20\n    const recognitionGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-box\" })\n\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: IISVGRendererConst.noSelection })\n    recognitionGroup.appendChild(rect)\n\n    const infosGroup = SVGBuilder.createGroup({ id: `infos-group-${ createUUID() }` })\n    const infoX = box.x + box.width\n    let infoY = box.y + TEXT_HEIGHT / 2\n    infos?.forEach(w =>\n    {\n      infosGroup.appendChild(SVGBuilder.createText({ x: infoX, y: infoY }, w, { stroke: COLOR, style: IISVGRendererConst.noSelection }))\n      infoY += TEXT_HEIGHT\n    })\n    recognitionGroup.appendChild(infosGroup)\n    this.renderer.layer.appendChild(recognitionGroup)\n\n    const infosGroupBox = infosGroup.getBBox()\n    const rectBox = {\n      width: infosGroupBox.width + 10,\n      height: infosGroupBox.height + 10,\n      x: infosGroupBox.x - 5,\n      y: infosGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    infosGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(infosGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(infosGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(infosGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ infosGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ infosGroup.id }`, box, newRectBox, { stroke: COLOR, debug: \"recognition-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(infosGroup.id, \"originX\")) {\n        this.renderer.setAttribute(infosGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(infosGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n      this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    })\n  }\n\n  protected async showRecognitionBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBox\")\n    await this.editor.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBox\", { jiix })\n    if (jiix) {\n      if (!jiix[\"bounding-box\"]) {\n        this.#logger.warn(\"drawRecognitionBox\", \"You must to enabled configuration.recognition.exports[\\\"bounding-box\\\"]\")\n        return\n      }\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Node\": {\n            if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          case \"Text\": {\n            el.words?.forEach(w =>\n            {\n              if (w?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(w[\"bounding-box\"])\n                this.drawRecognitionBox(box, [`type: ${ el.type }`, `candidates: ${ JSON.stringify(w.candidates || []) }`])\n              }\n            })\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              const infos = [\n                `type: ${ el.type }`,\n                `kind: ${ el.kind }`,\n              ]\n              el.edges.forEach((e, i) =>\n              {\n                let inf = `edge-${ i }: [{ x1: ${ e.x1 }, y2: ${ e.y1 } },{ x2: ${ e.x2 }, y2: ${ e.y2 } }]`\n                if (e.p1Decoration) {\n                  inf += `, p1Decoration: ${ e.p1Decoration }`\n                }\n                if (e.p2Decoration) {\n                  inf += `, p2Decoration: ${ e.p2Decoration }`\n                }\n                infos.push(inf)\n              })\n              const box = convertBoundingBoxMillimeterToPixel(Box.createFromBoxes(el.edges.map(e => e[\"bounding-box\"] as TBox)))\n              this.drawRecognitionBox(box, infos)\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\", \"ports\", \"connected\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${ el.type }`)\n            break\n          }\n        }\n      })\n    }\n  }\n  protected clearRecognitionBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box-link\" } })\n  }\n  async debugRecognitionBox(): Promise<void>\n  {\n    this.clearRecognitionBox()\n    if (this.#recognitionBoxVisibility) {\n      this.showRecognitionBox()\n    }\n  }\n\n  protected drawRecognitionItemBox(box: TBox, label?: string, chars?: string[]): void\n  {\n    const COLOR = \"blue\"\n    const CHAR_SIZE = 14\n\n    const recognitionItemGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-item-box\" })\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: IISVGRendererConst.noSelection })\n    recognitionItemGroup.appendChild(rect)\n\n    const charX = box.x\n    let charY = box.y - CHAR_SIZE\n\n    const charsGroup = SVGBuilder.createGroup({ id: `chars-group-${ createUUID() }` })\n    if (label) {\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `label: ${ label }`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: IISVGRendererConst.noSelection }))\n    }\n    if (chars?.length) {\n      charY += CHAR_SIZE\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `[${ chars.join(\", \") }]`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: IISVGRendererConst.noSelection }))\n    }\n\n    recognitionItemGroup.appendChild(charsGroup)\n    this.renderer.layer.appendChild(recognitionItemGroup)\n\n    const charsGroupBox = charsGroup.getBBox()\n    const rectBox = {\n      width: charsGroupBox.width + 10,\n      height: charsGroupBox.height + 10,\n      x: charsGroupBox.x - 5,\n      y: charsGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    charsGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(charsGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(charsGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(charsGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ charsGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ charsGroup.id }`, box, newRectBox, { stroke: COLOR, debug: \"recognition-item-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(charsGroup.id, \"originX\")) {\n        this.renderer.setAttribute(charsGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(charsGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n    })\n    this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n\n  }\n  protected async showRecognitionItemBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBoxItem\")\n    await this.editor.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBoxItem\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            el.chars?.forEach(c =>\n            {\n              if (c?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(c[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, c.label, c.candidates)\n              }\n            })\n            break\n          }\n          case \"Node\": {\n            if (el?.[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              el.edges.forEach(e =>\n              {\n                const box = convertBoundingBoxMillimeterToPixel(e[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, e.kind)\n              })\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          default:\n            this.#logger.warn(\"drawRecognitionBoxItem\", `Unknow jiix element type: ${ el.type }`)\n            break\n        }\n      })\n    }\n  }\n  protected clearRecognitionItemBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBoxItem\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box-link\" } })\n  }\n  async debugRecognitionItemBox(): Promise<void>\n  {\n    this.clearRecognitionItemBox()\n    if (this.#recognitionItemBoxVisibility) {\n      this.showRecognitionItemBox()\n    }\n  }\n\n  apply(): void\n  {\n    this.debugBoundingBox()\n    this.debugVertices()\n    this.debugSnapPoints()\n    this.debugRecognitionBox()\n    this.debugRecognitionItemBox()\n  }\n}\n","import { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { IISVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class IIMoveManager\n{\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  origin?: {\n    left: number,\n    top: number,\n    x: number,\n    y: number\n  }\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): IISVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.origin = {\n      left: this.renderer.parent.scrollLeft,\n      top: this.renderer.parent.scrollTop,\n      x: info.clientX,\n      y: info.clientY,\n    }\n  }\n\n  continue(info: PointerInfo): void\n  {\n    if (!this.origin) {\n      throw new Error(\"Can't move cause origin is undefined\")\n    }\n    const dx = info.clientX - this.origin.x\n    const dy = info.clientY - this.origin.y\n\n    this.renderer.parent.scrollTop = this.origin.top - dy\n    this.renderer.parent.scrollLeft = this.origin.left - dx\n  }\n\n  end(info: PointerInfo): void\n  {\n    this.continue(info)\n    this.origin = undefined\n  }\n}\n","/**\n * @group History\n */\nexport type THistoryContext = {\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  stackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group History\n */\nexport const getInitialHistoryContext = (): THistoryContext => {\n  return {\n    stackIndex: 0,\n    possibleUndoCount: 0,\n    canRedo: false,\n    canUndo: false,\n    empty: true,\n  }\n}\n","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model } from \"../model\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\n\n/**\n * @group History\n */\nexport class HistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: Model[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].symbols.length === 0\n  }\n\n  push(model: Model): void\n  {\n    this.#logger.info(\"push\", { model })\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push(model.clone())\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  updateStack(model: Model): void\n  {\n    this.#logger.info(\"updateStack\", { model })\n    const index = this.stack.findIndex(m => m.modificationDate === model.modificationDate)\n    if (index > -1) {\n      this.stack.splice(index, 1, model.clone())\n    }\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  undo(): Model\n  {\n    this.#logger.info(\"undo\")\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"undo\", previousModel)\n    return previousModel\n  }\n\n  redo(): Model\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"redo\", nextModel)\n    return nextModel\n  }\n}\n","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { IIDecorator, IIStroke, TIISymbol, TPoint } from \"../symbol\"\nimport { TStyle } from \"../style\"\nimport { MatrixTransform, TMatrixTransform } from \"../transform\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\nimport { PartialDeep } from \"../utils\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\n\n/**\n * @group History\n */\nexport type TIIHistoryChanges = {\n  added?: TIISymbol[]\n  updated?: TIISymbol[]\n  erased?: TIISymbol[]\n  replaced?: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] }\n  matrix?: { symbols: TIISymbol[], matrix: TMatrixTransform }\n  translate?: { symbols: TIISymbol[], tx: number, ty: number }[]\n  scale?: { symbols: TIISymbol[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { symbols: TIISymbol[], angle: number, center: TPoint }[]\n  style?: { symbols: TIISymbol[], style?: PartialDeep<TStyle>, fontSize?: number }\n  order?: { symbols: TIISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\" }\n  decorator?: { symbol: TIISymbol, decorator: IIDecorator, added: boolean }[]\n  group?: { symbols: TIISymbol[] }\n  ungroup?: { group: TIISymbol }\n}\n\n/**\n * @group History\n * @remarks used to send messages to the backend on undo or redo\n */\nexport type TIIHistoryBackendChanges = {\n  added?: IIStroke[]\n  erased?: IIStroke[]\n  replaced?: { oldStrokes: IIStroke[], newStrokes: IIStroke[] }\n  matrix?: { strokes: IIStroke[], matrix: TMatrixTransform },\n  translate?: { strokes: IIStroke[], tx: number, ty: number }[]\n  scale?: { strokes: IIStroke[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { strokes: IIStroke[], angle: number, center: TPoint }[]\n}\n\n/**\n * @group History\n */\nexport type TIIHistoryStackItem = {\n  changes: TIIHistoryChanges\n  model: IIModel\n}\n\n/**\n * @group History\n */\nexport class IIHistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: TIIHistoryStackItem[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].model.symbols.length === 0\n  }\n\n  isChangesEmpty(changes: TIIHistoryChanges): boolean\n  {\n    return !(\n      changes.added?.length ||\n      changes.updated?.length ||\n      changes.erased?.length ||\n      changes.replaced?.oldSymbols.length ||\n      changes.matrix?.symbols.length ||\n      changes.translate?.length ||\n      changes.rotate?.length ||\n      changes.scale?.length ||\n      changes.style?.symbols?.length ||\n      changes.order?.symbols?.length ||\n      changes.decorator?.length ||\n      changes.group?.symbols.length ||\n      changes.ungroup?.group\n    )\n  }\n\n  init(model: IIModel): void\n  {\n    this.stack.push({ model: model.clone(), changes: {} })\n    this.event.emitChanged(this.context)\n  }\n\n  push(model: IIModel, changes: TIIHistoryChanges): void\n  {\n    this.#logger.info(\"push\", { model, changes })\n    if (this.isChangesEmpty(changes)) return\n\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push({ model: model.clone(), changes })\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  update(model: IIModel): void\n  {\n    this.#logger.info(\"pop\")\n    const stackIdx = this.stack.findIndex(s => s.model.modificationDate === model.modificationDate)\n    if (stackIdx > -1) {\n      this.stack[stackIdx].model = model\n      this.updateContext()\n    }\n  }\n\n  pop(): void\n  {\n    this.#logger.info(\"pop\")\n    this.stack.pop()\n    this.context.stackIndex = this.stack.length - 1\n    this.updateContext()\n  }\n\n  protected reverseChanges(changes: TIIHistoryChanges): TIIHistoryChanges\n  {\n    const reversedChanges: TIIHistoryChanges = {}\n    if (changes.added) {\n      reversedChanges.erased = changes.added\n    }\n    if (changes.erased) {\n      reversedChanges.added = changes.erased\n    }\n    if (changes.replaced) {\n      reversedChanges.replaced = {\n        newSymbols: changes.replaced.oldSymbols,\n        oldSymbols: changes.replaced.newSymbols\n      }\n    }\n    if (changes.matrix) {\n      reversedChanges.matrix = {\n        symbols: changes.matrix.symbols,\n        matrix: new MatrixTransform(changes.matrix.matrix.xx, changes.matrix.matrix.yx, changes.matrix.matrix.xy, changes.matrix.matrix.yy, changes.matrix.matrix.tx, changes.matrix.matrix.ty).invert()\n      }\n    }\n    if (changes.translate?.length) {\n      reversedChanges.translate = changes.translate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          tx: -tr.tx,\n          ty: -tr.ty,\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      reversedChanges.rotate = changes.rotate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          angle: 2 * Math.PI - tr.angle,\n          center: tr.center\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      reversedChanges.scale = changes.scale.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          origin: tr.origin,\n          scaleX: 1 / tr.scaleX,\n          scaleY: 1 / tr.scaleY\n        }\n      })\n    }\n\n    return reversedChanges\n  }\n\n  undo(): TIIHistoryStackItem\n  {\n    this.#logger.info(\"undo\")\n    const currentStackItem = this.stack[this.context.stackIndex]\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"undo\", previousStackItem)\n    return {\n      model: previousStackItem.model,\n      changes: this.reverseChanges(currentStackItem.changes)\n    }\n  }\n\n  redo(): TIIHistoryStackItem\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"redo\", nextStackItem)\n    return nextStackItem\n  }\n\n  clear(): void\n  {\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n}","\n/**\n * @group History\n */\nexport type THistoryConfiguration = {\n  maxStackSize: number\n}\n\n/**\n * @group History\n * @source\n */\nexport const DefaultHistoryConfiguration: THistoryConfiguration = {\n  maxStackSize: 100\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\n\n/**\n * @group Menu\n */\nexport type TMenuItem = {\n  id: string,\n  label: string,\n  type: \"button\" | \"checkbox\" | \"select\" | \"list\" | \"colors\"\n  disabled?: boolean\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButton = TMenuItem & {\n  type: \"button\"\n  icon?: string\n  callback: () => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButtonList = TMenuItem & {\n  type: \"list\"\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemColorList = TMenuItem & {\n  type: \"colors\"\n  initValue: string,\n  values: string[]\n  fill: boolean\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemBoolean = TMenuItem & {\n  type: \"checkbox\",\n  initValue: boolean | \"indeterminate\",\n  callback: (value: boolean) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemSelect = TMenuItem & {\n  type: \"select\",\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport abstract class IIMenu\n{\n  thicknessList = [\n    { label: \"S\", value: 1 },\n    { label: \"M\", value: 2 },\n    { label: \"L\", value: 4 },\n    { label: \"XL\", value: 8 },\n  ]\n\n  fontSizeList = [\n    { label: \"Auto\", value: \"auto\" },\n    { label: \"S\", value: 0.5 },\n    { label: \"M\", value: 0.75 },\n    { label: \"L\", value: 1 },\n  ]\n\n  fontWeightList = [\n    { label: \"Auto\", value: \"auto\" },\n    { label: \"Normal\", value: \"normal\" },\n    { label: \"Bold\", value: \"bold\" },\n  ]\n\n  colors = [\n    \"#000000\", \"#808080\", \"#ffffff\", \"transparent\",\n    \"#ff0000\", \"#ff6400\", \"#ffc800\", \"#ffff00\",\n    \"#0000ff\", \"#0064ff\", \"#00c8ff\", \"#00ffff\",\n    \"#008000\", \"#00af00\", \"#00e100\", \"#00ff00\"\n  ]\n\n  protected createWrapCollapsible(el: Node, title: string): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"collapsible-wrapper\")\n    const head = document.createElement(\"div\")\n    head.classList.add(\"collapsible-header\")\n    head.textContent = title\n    const btn = document.createElement(\"span\")\n    btn.classList.add(\"collapsible-header-icon\")\n    btn.innerHTML = ArrowDown\n    head.appendChild(btn)\n    head.style.setProperty(\"pointer\", \"cursor\")\n    const content = document.createElement(\"div\")\n    content.classList.add(\"collapsible-content\")\n    head.addEventListener(\"pointerup\", () => wrapper.classList.toggle(\"active\"))\n    wrapper.appendChild(head)\n    content.appendChild(el)\n    wrapper.appendChild(content)\n    return wrapper\n  }\n\n  protected createMenuItemBoolean(item: TMenuItemBoolean): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const checkbox = document.createElement(\"input\")\n    checkbox.id = item.id\n    checkbox.setAttribute(\"type\", \"checkbox\")\n    if (item.disabled) {\n      checkbox.disabled = true\n    }\n    if (item.initValue === \"indeterminate\") {\n      checkbox.indeterminate = true\n    } else {\n      checkbox.checked = item.initValue\n    }\n    checkbox.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).checked))\n    wrapper.appendChild(checkbox)\n    return wrapper\n  }\n\n  protected createMenuItemSelect(item: TMenuItemSelect): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const select = document.createElement(\"select\")\n    select.id = item.id\n    if (item.disabled) {\n      select.disabled = true\n    }\n    item.values.forEach(v =>\n    {\n      const selected = v.value === item.initValue\n      const opt = new Option(v.label, v.value.toString(), selected, selected)\n      select.appendChild(opt)\n    })\n    select.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).value))\n    wrapper.appendChild(select)\n    return wrapper\n  }\n\n  protected createMenuItemButton(item: TMenuItemButton): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.classList.add(\"ms-menu-item\", \"ms-menu-button\")\n    btn.innerHTML = item.icon || item.label\n    btn.addEventListener(\"pointerup\", item.callback)\n    return btn\n  }\n\n  protected createMenuItemButtonList(item: TMenuItemButtonList): HTMLElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    item.values.forEach((v) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${item.id}-${ v.value }-btn`\n      if (item.initValue === v.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.textContent = v.label\n      btn.addEventListener(\"pointerup\", () =>\n      {\n        item.callback(v.value)\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      wrapper.appendChild(btn)\n    })\n    return wrapper\n  }\n\n  protected createMenuItemColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    wrapper.appendChild(this.createColorList(item))\n    return wrapper\n  }\n\n  protected createColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const list = document.createElement(\"div\")\n    list.id = `${ item.id }-list`\n    list.classList.add(\"ms-menu-row\", \"color-list\")\n    item.values.forEach((color) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${ item.id }-${ color.replace(\"#\", \"\") }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      const colorEl = document.createElement(\"div\")\n      colorEl.classList.add(\"color\")\n      if (item.fill) {\n        colorEl.style.setProperty(\"background-color\", color)\n        colorEl.style.setProperty(\"border\", \"1px solid lightgrey\")\n      } else {\n        colorEl.style.setProperty(\"background-color\", \"transparent\")\n        colorEl.style.setProperty(\"border\", `3px solid ${ color }`)\n      }\n      if (color === \"#ffffff\") {\n        colorEl.style.setProperty(\"border\", \"1px solid black\")\n      }\n      if (color === \"transparent\") {\n        colorEl.style.setProperty(\"background-image\", \"linear-gradient(45deg, #AAA 10%, transparent 20%, #AAA 30%, transparent 40%, #AAA 50%, transparent 60%, #AAA 70%, transparent 80%, #AAA 90%, transparent 100%)\")\n      }\n      if (item.initValue === color) {\n        btn.classList.add(\"active\")\n      }\n      btn.appendChild(colorEl)\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        item.callback(color)\n        list.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      list!.appendChild(btn)\n    })\n    return list\n  }\n\n  protected createMenuItem(item: TMenuItem): HTMLElement\n  {\n    switch (item.type) {\n      case \"checkbox\":\n        return this.createMenuItemBoolean(item as TMenuItemBoolean)\n      case \"select\":\n        return this.createMenuItemSelect(item as TMenuItemSelect)\n      case \"list\":\n        return this.createMenuItemButtonList(item as TMenuItemButtonList)\n      case \"colors\":\n        return this.createMenuItemColorList(item as TMenuItemColorList)\n      case \"button\":\n      default:\n        return this.createMenuItemButton(item as TMenuItemButton)\n    }\n  }\n\n  abstract render(domElement: HTMLElement): void\n\n  abstract update(): void\n\n  abstract show(): void\n\n  abstract hide(): void\n\n  abstract destroy(): void\n}\n","\n/**\n * @group Gesture\n * @summary List all authorized gestures\n */\nexport type TGestureType = \"UNDERLINE\" | \"SCRATCH\" | \"JOIN\" | \"INSERT\" | \"STRIKETHROUGH\" | \"SURROUND\"\n\n/**\n * @group Gesture\n * @remarks\n *  when gestureType = \"INSERT\", subStrokes represent the two parts\n *  when gestureType = \"SCRATCH\", subStrokes represent the part to substract at the stroke corresponding fullStrokeId\n */\nexport type TGesture = {\n  gestureType: TGestureType\n  gestureStrokeId: string\n  strokeIds: string[]\n  strokeBeforeIds: string[]\n  strokeAfterIds: string[]\n  subStrokes?: { fullStrokeId: string, x: number[], y: number[] }[]\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on surround detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum SurroundAction\n{\n  Select = \"select\",\n  Surround = \"surround\",\n  Highlight = \"highlight\"\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on strikeThrough detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum StrikeThroughAction\n{\n  Erase = \"erase\",\n  Draw = \"draw\"\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on split detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum InsertAction\n{\n  /**\n   * @remarks Add line break on gesture place\n   */\n  LineBreak = \"line-break\",\n  /**\n   * @remarks Insert place in gesture place\n   */\n  Insert = \"insert\"\n}\n","import { InsertAction, StrikeThroughAction, SurroundAction } from \"./Gesture\"\n\n/**\n * @group Gesture\n * @source\n */\nexport type TGestureConfiguration = {\n  surround: SurroundAction\n  strikeThrough: StrikeThroughAction\n  insert: InsertAction\n}\n\n/**\n * @group Gesture\n * @source\n */\nexport const DefaultGestureConfiguration: TGestureConfiguration = {\n  surround: SurroundAction.Select,\n  strikeThrough: StrikeThroughAction.Draw,\n  insert: InsertAction.LineBreak\n}\n","import { EditorTool } from \"../Constants\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  IIDecorator,\n  IIStroke,\n  SymbolType,\n  IIText,\n  DecoratorKind,\n  IISymbolGroup,\n  TIISymbol,\n  Box,\n  TPoint,\n  IIRecognizedText,\n  RecognizedKind,\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { IISVGRenderer } from \"../renderer\"\nimport { IIHistoryManager, TIIHistoryChanges } from \"../history\"\nimport { computeAverage, isBetween, PartialDeep } from \"../utils\"\nimport { IITranslateManager } from \"../manager/IITranslateManager\"\nimport { IITextManager } from \"../manager/IITextManager\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { InsertAction, StrikeThroughAction, SurroundAction, TGesture } from \"./Gesture\"\nimport { DefaultGestureConfiguration, TGestureConfiguration } from \"./GestureConfiguration\"\n\n/**\n * @group Gesture\n */\nexport class IIGestureManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.GESTURE)\n\n  insertAction: InsertAction = InsertAction.LineBreak\n  surroundAction: SurroundAction = SurroundAction.Select\n  strikeThroughAction: StrikeThroughAction = StrikeThroughAction.Draw\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor, gestureAction?: PartialDeep<TGestureConfiguration>)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.surroundAction = gestureAction?.surround || DefaultGestureConfiguration.surround\n    this.strikeThroughAction = gestureAction?.strikeThrough || DefaultGestureConfiguration.strikeThrough\n    this.insertAction = gestureAction?.insert || DefaultGestureConfiguration.insert\n  }\n\n  get renderer(): IISVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get recognizer(): RecognizerWebSocket\n  {\n    return this.editor.recognizer\n  }\n\n  get translator(): IITranslateManager\n  {\n    return this.editor.translator\n  }\n\n  get texter(): IITextManager\n  {\n    return this.editor.texter\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get history(): IIHistoryManager\n  {\n    return this.editor.history\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get strokeSpaceWidth(): number\n  {\n    return this.editor.configuration.rendering.guides.gap * 2\n  }\n\n  async applySurroundGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"applySurroundGesture\", { gestureStroke, gesture })\n    const changes: TIIHistoryChanges = {}\n    const ids = this.model.symbols.filter(s => gestureStroke.bounds.contains(s.bounds)).map(s => s.id)\n    switch (this.surroundAction) {\n      case SurroundAction.Select: {\n        if (ids.length) {\n          this.editor.tool = EditorTool.Select\n          this.editor.select(ids)\n        }\n        break\n      }\n      case SurroundAction.Highlight: {\n        const symbolIds: string[] = []\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(sym.type) && !symbolIds.includes(sym.id)) {\n            const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const highlight = new IIDecorator(DecoratorKind.Highlight, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Highlight)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(highlight) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            symbolIds.push(symWithDec.id)\n            changes.decorator!.push({ symbol: symWithDec, decorator: highlight, added })\n          }\n        })\n        if (changes.decorator.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case SurroundAction.Surround: {\n        const symbolIds: string[] = []\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(sym.type) && !symbolIds.includes(sym.id)) {\n            const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const surround = new IIDecorator(DecoratorKind.Surround, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Surround)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(surround) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator!.push({ symbol: symWithDec, decorator: surround, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        this.history.push(this.model, changes)\n        break\n      }\n      default:\n        this.#logger.error(\"applySurroundGesture\", `Unknow surroundAction: ${ this.surroundAction }, values allowed are: ${ SurroundAction.Highlight }, ${ SurroundAction.Select }, ${ SurroundAction.Surround }`)\n        break\n    }\n    return\n  }\n\n  protected computeScratchOnStrokes(gesture: TGesture, stroke: IIStroke): IIStroke[]\n  {\n    const newStrokes: IIStroke[] = []\n    const partPointersToRemove = gesture.subStrokes?.find(ss => ss.fullStrokeId === stroke.id)\n    if (partPointersToRemove) {\n      const strokePartToErase = new IIStroke()\n      partPointersToRemove.x.forEach((x, i) => strokePartToErase.addPointer({ x, y: partPointersToRemove.y[i], p: 1, t: 1 }))\n      const subStrokes = IIStroke.substract(stroke, strokePartToErase)\n      if (subStrokes.before && subStrokes.before.pointers.length > 1) newStrokes.push(subStrokes.before)\n      if (subStrokes.after && subStrokes.after.pointers.length > 1) newStrokes.push(subStrokes.after)\n    }\n    return newStrokes\n  }\n\n  protected computeScratchOnText(gestureStroke: IIStroke, textSymbol: IIText): IIText | undefined\n  {\n    const charsToRemove = textSymbol.getCharsOverlaps(gestureStroke.pointers)\n    if (textSymbol.chars.length == charsToRemove.length) {\n      return\n    }\n    else {\n      charsToRemove.forEach(c =>\n      {\n        const cIndex = textSymbol.chars.findIndex(c1 => c1.id === c.id)\n        textSymbol.chars.splice(cIndex, 1)\n      })\n      this.texter.updateBounds(textSymbol)\n      return textSymbol\n    }\n  }\n\n  protected computeScratchOnSymbol(gestureStroke: IIStroke, gesture: TGesture, symbol: TIISymbol): { erased?: boolean, replaced?: TIISymbol[] }\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke: {\n        const strokesScratchedResult = this.computeScratchOnStrokes(gesture, symbol)\n        if (strokesScratchedResult.length) {\n          return {\n            replaced: strokesScratchedResult\n          }\n        }\n        else {\n          return { erased: true }\n        }\n      }\n      case SymbolType.Recognized: {\n        if (symbol.kind === RecognizedKind.Text) {\n          const childrenNotTouch = symbol.strokes.filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n          const childrenTouch = symbol.strokes.filter(s => gestureStroke.bounds.overlaps(s.bounds))\n          const results = childrenTouch.map(s =>\n          {\n            return {\n              symbol: s,\n              result: this.computeScratchOnStrokes(gesture, s)\n            }\n          })\n          if (childrenNotTouch.length === 0 && results.every(r => r.result.length === 0)) {\n            return { erased: true }\n          }\n          else {\n            const strokesToConserve: IIStroke[] = childrenNotTouch.concat(...results.flatMap(r => r.result))\n            const strokeText = new IIRecognizedText(strokesToConserve, { baseline: symbol.baseline, xHeight: symbol.xHeight }, symbol.style)\n            strokeText.decorators = symbol.decorators\n            return {\n              replaced: [strokeText]\n            }\n          }\n        }\n        return {}\n      }\n      case SymbolType.Group: {\n        const childrenNotTouch = symbol.children.filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n        const childrenTouch = symbol.children.filter(s => gestureStroke.bounds.overlaps(s.bounds))\n        const results = childrenTouch.map(s =>\n        {\n          return {\n            symbol: s,\n            result: this.computeScratchOnSymbol(gestureStroke, gesture, s)\n          }\n        })\n        if (childrenNotTouch.length === 0 && results.every(r => r.result.erased)) {\n          return { erased: true }\n        }\n        else {\n          const symbolsGroup: TIISymbol[] = childrenNotTouch\n          results.forEach(r =>\n          {\n            if (r.result.replaced) {\n              symbolsGroup.push(...r.result.replaced)\n            }\n          })\n          const newGroup = new IISymbolGroup(symbolsGroup, symbol.style)\n          newGroup.decorators = symbol.decorators\n          return {\n            replaced: [newGroup]\n          }\n        }\n      }\n      case SymbolType.Text: {\n        const textScratchedResult = this.computeScratchOnText(gestureStroke, symbol)\n        if (textScratchedResult) {\n          return {\n            replaced: [textScratchedResult]\n          }\n        }\n        else {\n          return {\n            erased: true\n          }\n        }\n      }\n      case SymbolType.Shape:\n      case SymbolType.Edge: {\n        return {\n          erased: true\n        }\n      }\n    }\n  }\n\n  async applyScratch(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyScratchGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyScratchGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n    const symbolsToUpdate: TIISymbol[] = []\n    const symbolsToErase: TIISymbol[] = []\n    const symbolsToReplace: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && !symbolsToErase.some(s => s.id === sym.id) && !symbolsToReplace.oldSymbols.some(s => s.id === sym.id)) {\n        const result = this.computeScratchOnSymbol(gestureStroke, gesture, sym)\n        if (result.erased) symbolsToErase.push(sym)\n        else if (result.replaced) {\n          symbolsToReplace.newSymbols.push(...result.replaced)\n          symbolsToReplace.oldSymbols.push(sym)\n        }\n      }\n    })\n\n    const promises: Promise<void | TIISymbol[]>[] = []\n    const changes: TIIHistoryChanges = {}\n    if (symbolsToUpdate.length) {\n      promises.push(this.editor.updateSymbols(symbolsToUpdate, false))\n      changes.updated = symbolsToUpdate\n    }\n\n    if (symbolsToErase.length) {\n      promises.push(this.editor.removeSymbols(symbolsToErase.map(s => s.id), false))\n      changes.erased = symbolsToErase\n    }\n\n    if (symbolsToReplace.newSymbols.length) {\n      changes.replaced = symbolsToReplace\n      promises.push(this.editor.replaceSymbols(symbolsToReplace.oldSymbols, symbolsToReplace.newSymbols, false))\n    }\n\n    this.history.push(this.model, changes)\n    await Promise.all(promises)\n  }\n\n  async applyJoinGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyJoinGesture\", { gestureStroke, gesture })\n\n    const symbolsAbove = this.model.symbols.filter(s => this.model.isSymbolAbove(gestureStroke, s))\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => s.bounds.xMax <= gestureStroke.bounds.xMid)\n    const symbolsOnGestureInRow = symbolsRow.filter(s => s.bounds.xMax > gestureStroke.bounds.xMid && s.bounds.xMin <= gestureStroke.bounds.xMid)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => s.bounds.xMin > gestureStroke.bounds.xMid)\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n    const changes: TIIHistoryChanges = {}\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    if (symbolsOnGestureInRow.length) {\n      const symbolToJoin = symbolsOnGestureInRow[0]\n      if (symbolToJoin?.type === SymbolType.Group) {\n        const children = symbolToJoin.children.map(c => c.clone())\n        const childBefore = children.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = children.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          const newGroup = new IISymbolGroup(children, symbolToJoin.style)\n          newGroup.decorators = symbolToJoin.decorators.map(d => d.clone())\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [newGroup]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n      else if (symbolToJoin?.type === SymbolType.Recognized) {\n        const strokeText = symbolToJoin.clone()\n        const childBefore = strokeText.strokes.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = strokeText.strokes.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [strokeText]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsAfterGestureInRow.length) {\n      const lastSymbBefore = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfter = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n\n      const lastXBefore = Math.max(...symbolsBeforeGestureInRow.map(s => s.bounds.xMax))\n      const firstXAfter = Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      const translateX = lastXBefore - firstXAfter\n\n      const lastSymbBeforeClone = lastSymbBefore.clone()\n      const firstSymbolAfterClone = firstSymbolAfter.clone()\n      this.translator.applyToSymbol(firstSymbolAfterClone, translateX, 0)\n      const symbolsToGroup = lastSymbBefore.type === SymbolType.Group ? (lastSymbBeforeClone as IISymbolGroup).children : [lastSymbBeforeClone]\n      symbolsToGroup.push(...(firstSymbolAfterClone.type === SymbolType.Group ? (firstSymbolAfterClone as IISymbolGroup).children : [firstSymbolAfterClone]))\n\n      if (symbolsToGroup.every(s => s.type === SymbolType.Text)) {\n        const texts = symbolsToGroup as IIText[]\n        const text = new IIText(texts.flatMap(s => s.chars), texts[0].point, Box.createFromBoxes(texts.map(t => t.bounds)))\n        this.texter.setBounds(text)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [text]\n        }\n      }\n      else if (symbolsToGroup.every(s => s.type === SymbolType.Recognized)) {\n        const strokeTexts = symbolsToGroup as IIRecognizedText[]\n        const strokeText = new IIRecognizedText(strokeTexts.flatMap(s => s.strokes), strokeTexts[0], strokeTexts[0].style)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [strokeText]\n        }\n      }\n      else {\n        const group = new IISymbolGroup(symbolsToGroup, lastSymbBefore.style)\n        if ([SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(lastSymbBefore.type)) {\n          (lastSymbBefore as IIStroke).decorators.forEach(d =>\n          {\n            group.decorators.push(new IIDecorator(d.kind, d.style))\n          })\n        }\n        if ([SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(firstSymbolAfter.type)) {\n          (firstSymbolAfter as IIStroke).decorators.forEach(d =>\n          {\n            if (!group.decorators.some(d1 => d1.kind == d.kind)) {\n              group.decorators.push(new IIDecorator(d.kind, d.style))\n            }\n          })\n        }\n\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [group]\n        }\n      }\n\n      const rest = symbolsAfterGestureInRow.filter(s => s.id !== firstSymbolAfter.id)\n      if (rest.length) {\n        translate.push({ symbols: rest, tx: translateX, ty: 0 })\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length) {\n      const lastSymbolBeforeGesture = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsBelow)\n      if (firstSymbolAfterGesture) {\n        if (this.model.roundToLineGuide(lastSymbolBeforeGesture.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const symbolInNextRow = symbolsBelow.filter(s => this.model.isSymbolInRow(firstSymbolAfterGesture, s))\n          if (symbolInNextRow.length) {\n            const translateX = lastSymbolBeforeGesture.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n            translate.push({ symbols: symbolInNextRow, tx: translateX, ty: -this.rowHeight })\n          }\n          const symbolsAfterNextRow = symbolsBelow.filter(s => this.model.isSymbolBelow(firstSymbolAfterGesture, s))\n          if (symbolsAfterNextRow.length) {\n            translate.push({ symbols: symbolsAfterNextRow, tx: 0, ty: -this.rowHeight })\n          }\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n      }\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n      const lastSymbolAbove = this.model.getLastSymbol(symbolsAbove)\n      if (lastSymbolAbove) {\n        if (this.model.roundToLineGuide(lastSymbolAbove.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const translateX = lastSymbolAbove.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: -this.rowHeight })\n        }\n        else {\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: 0, ty: -this.rowHeight })\n        }\n\n        if (symbolsBelow.length) {\n          translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsAfterGestureInRow.concat(...symbolsBelow), tx: 0, ty: -this.rowHeight })\n      }\n\n    }\n    if (changes.replaced?.oldSymbols.length) {\n      this.editor.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false)\n    }\n    if (translate.length) {\n      changes.translate = translate\n      Promise.all(translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n    }\n    this.history.push(this.model, changes)\n  }\n\n  protected createStrokesFromGestureSubStroke(strokeOrigin: IIStroke, subStrokes: { x: number[], y: number[] }[]): IIStroke[]\n  {\n    const strokes: IIStroke[] = []\n    if (subStrokes[0]) {\n      const subStroke = new IIStroke(strokeOrigin.style)\n      subStrokes![0].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![0].y[i],\n          p: strokeOrigin.pointers.at(i)?.p || 1,\n          t: strokeOrigin.pointers.at(i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    if (subStrokes[1]) {\n      const subStroke = new IIStroke(strokeOrigin.style)\n      subStrokes[1].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![1].y[i],\n          p: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.p || 1,\n          t: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    return strokes\n  }\n\n  protected computeSplitStroke(strokeOrigin: IIStroke, subStrokes: { x: number[], y: number[] }[]): { before?: IIStroke, after?: IIStroke }\n  {\n    let after: IIStroke | undefined\n    const newStrokes = this.createStrokesFromGestureSubStroke(strokeOrigin, subStrokes)\n\n    if (newStrokes[1]) {\n      after = newStrokes[1]\n      this.translator.applyToSymbol(after, this.strokeSpaceWidth, 0)\n    }\n    return {\n      before: newStrokes[0],\n      after\n    }\n  }\n\n  protected computeSplitStrokeInGroup(gestureStroke: IIStroke, group: IISymbolGroup, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): IISymbolGroup[]\n  {\n    const newGroups: IISymbolGroup[] = []\n    const symbolsBefore: TIISymbol[] = []\n    const symbolsAfter: TIISymbol[] = []\n\n    const strokeIdToSplit = subStrokes[0].fullStrokeId\n\n    group.children.forEach(gs =>\n    {\n      if (gs.id === strokeIdToSplit) {\n        const subStroke = this.computeSplitStroke(gs as IIStroke, subStrokes)\n        if (subStroke.before) {\n          symbolsBefore.push(subStroke.before)\n        }\n        if (subStroke.after) {\n          symbolsAfter.push(subStroke.after)\n        }\n      }\n      else if (gs.bounds.xMid < gestureStroke.bounds.xMid) {\n        symbolsBefore.push(gs)\n      }\n      else if (gs.bounds.xMid > gestureStroke.bounds.xMid) {\n        this.translator.applyToSymbol(gs, this.strokeSpaceWidth, 0)\n        symbolsAfter.push(gs)\n      }\n    })\n\n    if (symbolsBefore.length) {\n      newGroups.push(new IISymbolGroup(symbolsBefore, group.style))\n    }\n    if (symbolsAfter.length) {\n      newGroups.push(new IISymbolGroup(symbolsAfter, group.style))\n    }\n    return newGroups\n  }\n\n  protected computeChangesOnSplitStroke(gestureStroke: IIStroke, strokeIdToSplit: string, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolToSplit = this.model.getRootSymbol(strokeIdToSplit)\n    if (symbolToSplit?.type === SymbolType.Group) {\n      const newGroups = this.computeSplitStrokeInGroup(gestureStroke, symbolToSplit, subStrokes)\n      replaced.newSymbols.push(...newGroups)\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Stroke) {\n      const newStrokes = this.computeSplitStroke(symbolToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Recognized) {\n      const strokesToSplit = symbolToSplit.strokes.find(s => s.id === strokeIdToSplit)!\n      const strokesBefore = symbolToSplit.strokes.filter(s => s.id !== strokeIdToSplit && s.bounds.xMid < gestureStroke.bounds.xMid)\n      const strokesAfter = symbolToSplit.strokes.filter(s => s.id !== strokeIdToSplit && s.bounds.xMid > gestureStroke.bounds.xMid)\n      const newStrokes = this.computeSplitStroke(strokesToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(...strokesBefore, newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after, ...strokesAfter)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    if (symbolsAfterGestureInRow.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitGroup(gestureStroke: IIStroke, groupToSplit: IISymbolGroup): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const groupSymbolsBefore = groupToSplit.children.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const groupsSymbolsAfter = groupToSplit.children.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(groupToSplit)\n    if (groupSymbolsBefore.length) {\n      const groupBefore = new IISymbolGroup(groupSymbolsBefore.map(s => s.clone()), groupToSplit.style)\n      groupBefore.decorators = groupToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(groupBefore)\n    }\n    if (groupsSymbolsAfter.length) {\n      const grouAfter = new IISymbolGroup(groupsSymbolsAfter.map(s => s.clone()), groupToSplit.style)\n      grouAfter.decorators = groupToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(grouAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(grouAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== groupToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitStrokeText(gestureStroke: IIStroke, strokeTextToSplit: IIRecognizedText): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const strokesBefore = strokeTextToSplit.strokes.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const strokesAfter = strokeTextToSplit.strokes.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(strokeTextToSplit)\n    if (strokesBefore.length) {\n      const strokeTextBefore = new IIRecognizedText(strokesBefore.map(s => s.clone()), strokeTextToSplit, strokeTextToSplit.style)\n      strokeTextBefore.decorators = strokeTextToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(strokeTextBefore)\n    }\n    if (strokesAfter.length) {\n      const strokeTextAfter = new IIRecognizedText(strokesAfter.map(s => s.clone()), strokeTextToSplit, strokeTextToSplit.style)\n      strokeTextAfter.decorators = strokeTextToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(strokeTextAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(strokeTextAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== strokeTextToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitText(gestureStroke: IIStroke, textToSplit: IIText): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const charsBefore = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 <= gestureStroke.bounds.xMid)\n    const charsAfter = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 > gestureStroke.bounds.xMid)\n    const newTexts: IIText[] = []\n    if (charsBefore.length && charsAfter.length) {\n      const textBefore = new IIText(charsBefore, textToSplit.point, Box.createFromBoxes(charsBefore.map(c => c.bounds)))\n      this.texter.setBounds(textBefore)\n      newTexts.push(textBefore)\n      const pointAfter: TPoint = {\n        x: textBefore.point.x + textBefore.bounds.width + this.texter.getSpaceWidth(computeAverage(textBefore.chars.map(c => c.fontSize))),\n        y: textBefore.point.y\n      }\n      const textAfter = new IIText(charsAfter, pointAfter, Box.createFromBoxes(charsAfter.map(c => c.bounds)))\n      this.texter.setBounds(textAfter)\n      newTexts.push(textAfter)\n      replaced.newSymbols = newTexts\n      replaced.oldSymbols = [textToSplit]\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== gestureStroke.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  async applyInsertGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyInsertGesture\", { gestureStroke, gesture })\n\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n    const textToSplit = symbolsRow.find(s => s.type === SymbolType.Text && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IIText | undefined\n    const groupToSplit = symbolsRow.find(s => s.type === SymbolType.Group && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IISymbolGroup | undefined\n    const strokeTextToSplit = symbolsRow.find(s => s.type === SymbolType.Recognized && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IIRecognizedText | undefined\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid > s.bounds.xMax)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n\n    let changes: TIIHistoryChanges | undefined\n    if (gesture.strokeIds.length && gesture.subStrokes?.length) {\n      changes = this.computeChangesOnSplitStroke(gestureStroke, gesture.strokeIds[0], gesture.subStrokes)\n    }\n    else if (groupToSplit) {\n      changes = this.computeChangesOnSplitGroup(gestureStroke, groupToSplit)\n    }\n    else if (textToSplit) {\n      changes = this.computeChangesOnSplitText(gestureStroke, textToSplit)\n    }\n    else if (strokeTextToSplit) {\n      changes = this.computeChangesOnSplitStrokeText(gestureStroke, strokeTextToSplit)\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n      let translateX = 0\n      if (symbolsBeforeGestureInRow.length) {\n        translateX = Math.min(...symbolsBeforeGestureInRow.map(s => s.bounds.xMin)) - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      }\n\n      switch (this.insertAction) {\n        case InsertAction.LineBreak:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: this.rowHeight })\n          if (symbolsBelow.length) {\n            translate.push({ symbols: symbolsBelow, tx: 0, ty: this.rowHeight })\n          }\n          break\n        case InsertAction.Insert:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth * 2, ty: 0 })\n          break\n      }\n      changes = { translate }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsBelow.length && this.insertAction === InsertAction.LineBreak) {\n      changes = { translate: [{ symbols: symbolsBelow, tx: 0, ty: this.rowHeight }] }\n    }\n\n    if (changes) {\n      const promises: Promise<void>[] = []\n      if (changes.translate?.length) {\n        promises.push(...changes.translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n      }\n      if (changes.replaced?.newSymbols.length) {\n        promises.push(this.editor.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false))\n      }\n      this.history.push(this.model, changes)\n      await Promise.all(promises)\n    }\n  }\n\n  async applyUnderlineGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyUnderlineGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyUnderlineGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n\n    const changes: TIIHistoryChanges = { decorator: [] }\n    const symbolIds: string[] = []\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(sym.type) && !symbolIds.includes(sym.id)) {\n        const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n        const underline = new IIDecorator(DecoratorKind.Underline, this.editor.penStyle)\n        const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Underline)\n        const added = index === -1\n        // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n        added ? symWithDec.decorators.push(underline) : symWithDec.decorators.splice(index, 1)\n        this.model.updateSymbol(symWithDec)\n        this.renderer.drawSymbol(symWithDec)\n        changes.decorator?.push({ symbol: symWithDec, decorator: underline, added })\n        symbolIds.push(symWithDec.id)\n      }\n    })\n    if (changes.decorator?.length) {\n      this.history.push(this.model, changes)\n    }\n  }\n\n  async applyStrikeThroughGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void | TIISymbol[]>\n  {\n    this.#logger.debug(\"applyStrikeThroughGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyStrikeThroughGesture\", \"Unable to apply strikethrough because there are no strokes\")\n      return\n    }\n    switch (this.strikeThroughAction) {\n      case StrikeThroughAction.Draw: {\n        const changes: TIIHistoryChanges = { decorator: [] }\n        const symbolIds: string[] = []\n        gesture.strokeIds.forEach(id =>\n        {\n          const symbol = this.model.getRootSymbol(id)\n          if (symbol && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(symbol.type) && !symbolIds.includes(symbol.id)) {\n            const symWithDec = symbol as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const strikethrough = new IIDecorator(DecoratorKind.Strikethrough, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Strikethrough)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(strikethrough) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator?.push({ symbol: symWithDec, decorator: strikethrough, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        if (changes.decorator?.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case StrikeThroughAction.Erase: {\n        return this.editor.removeSymbols(gesture.strokeIds)\n      }\n      default:\n        this.#logger.warn(\"#applyStrikeThroughGesture\", `Unknow OnStrikeThrough: ${ this.strikeThroughAction }, values allowed are: ${ StrikeThroughAction.Draw }, ${ StrikeThroughAction.Erase }`)\n        break\n    }\n  }\n\n  async apply(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"apply\", { gestureStroke, gesture })\n    this.editor.updateSymbolsStyle([gestureStroke.id], { opacity: (gestureStroke.style.opacity || 1) / 2 }, false)\n    await this.editor.removeSymbol(gestureStroke.id, false)\n    await this.editor.synchronizeStrokesWithJIIX()\n    switch (gesture.gestureType) {\n      case \"UNDERLINE\":\n        await this.applyUnderlineGesture(gestureStroke, gesture)\n        break\n      case \"SCRATCH\":\n        await this.applyScratch(gestureStroke, gesture)\n        break\n      case \"JOIN\":\n        await this.applyJoinGesture(gestureStroke, gesture)\n        break\n      case \"INSERT\":\n        await this.applyInsertGesture(gestureStroke, gesture)\n        break\n      case \"STRIKETHROUGH\":\n        await this.applyStrikeThroughGesture(gestureStroke, gesture)\n        break\n      case \"SURROUND\":\n        await this.applySurroundGesture(gestureStroke, gesture)\n        break\n      default:\n        this.#logger.warn(\"apply\", `Gesture unknow: ${ gesture.gestureType }`)\n        break\n    }\n    this.editor.event.emitGestured({ gestureType: gesture.gestureType, stroke: gestureStroke })\n    this.editor.svgDebugger.apply()\n    return Promise.resolve()\n  }\n\n  async getGestureFromContextLess(gestureStroke: IIStroke): Promise<TGesture | undefined>\n  {\n    const gesture = await this.recognizer.recognizeGesture(gestureStroke)\n    if (!gesture) return\n    switch (gesture.gestureType) {\n      case \"surround\": {\n        const hasSymbolsToSurrond = this.model.symbols.some(s =>\n        {\n          if (s.id !== gestureStroke.id && gestureStroke.bounds.contains(s.bounds)) {\n            return this.surroundAction === SurroundAction.Select || [SymbolType.Group, SymbolType.Stroke, SymbolType.Text].includes(s.type)\n          }\n          return false\n        })\n        if (hasSymbolsToSurrond) {\n          return {\n            gestureType: \"SURROUND\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"left-right\":\n      case \"right-left\": {\n        const symbolsToUnderline = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id && [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height * 3 / 4, s.bounds.y + s.bounds.height * 5 / 4)\n        })\n        if (symbolsToUnderline.length) {\n          return {\n            gestureType: \"UNDERLINE\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToUnderline.map(s => s.id),\n          }\n        }\n        const symbolsToStrikeThrough = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id && [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height / 4, s.bounds.y + s.bounds.height * 3 / 4)\n        })\n        if (symbolsToStrikeThrough.length) {\n          return {\n            gestureType: \"STRIKETHROUGH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToStrikeThrough.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"scratch\": {\n        const symbolsToErase = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id &&\n            (\n              gestureStroke.bounds.overlaps(s.bounds) && [SymbolType.Stroke, SymbolType.Text, SymbolType.Group].includes(s.type) ||\n              gestureStroke.bounds.contains(s.bounds) && [SymbolType.Shape, SymbolType.Edge].includes(s.type)\n            )\n        })\n\n        if (symbolsToErase.length) {\n          return {\n            gestureType: \"SCRATCH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToErase.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"bottom-top\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"JOIN\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"top-bottom\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          [SymbolType.Text, SymbolType.Stroke, SymbolType.Group].includes(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"INSERT\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"none\":\n      default:\n        return\n    }\n  }\n}\n","/**\n * @group Menu\n */\nexport type TSubMenuParam =\n{\n  trigger: HTMLElement,\n  menuTitle?: string,\n  subMenu: HTMLElement,\n  position: \"top\" | \"left\" | \"right\" | \"right-top\" | \"bottom\" | \"bottom-left\" | \"bottom-right\"\n}\n\n/**\n * @group Menu\n */\nexport class IIMenuSub {\n  element: HTMLDivElement\n  content: HTMLElement\n\n  constructor(param : TSubMenuParam) {\n    this.element = document.createElement(\"div\")\n    this.element.classList.add(\"sub-menu\")\n    this.element.appendChild(param.trigger)\n    this.content = document.createElement(\"div\")\n    if(param.menuTitle) {\n      const menuTitleElement = document.createElement(\"h3\")\n      menuTitleElement.classList.add(\"ms-menu-title\")\n      menuTitleElement.textContent = param.menuTitle\n      this.content.appendChild(menuTitleElement)\n    }\n    this.content.classList.add(\"sub-menu-content\", param.position)\n    this.content.appendChild(param.subMenu)\n    this.element.appendChild(this.content)\n\n    param.trigger.addEventListener(\"pointerdown\", () => this.toggle())\n    document.addEventListener(\"pointerdown\", (e) => {\n      if (!this.element.contains(e.target as HTMLElement)) {\n        this.close()\n      }\n    })\n  }\n\n  open(): void {\n    this.content.classList.add(\"open\")\n  }\n\n  close(): void {\n    this.content.classList.remove(\"open\")\n  }\n\n  toggle(): void {\n    this.content.classList.toggle(\"open\")\n  }\n\n  unwrap(): void {\n    this.content.classList.remove(\"sub-menu-content\")\n    this.element.insertAdjacentElement(\"beforebegin\", this.content)\n    this.element.style.display = \"none\"\n  }\n\n  wrap(): void {\n    this.content.classList.add(\"sub-menu-content\")\n    this.element.appendChild(this.content)\n    this.element.style.display = \"block\"\n  }\n\n}\n","import menuIcon from \"../assets/svg/menu.svg\"\nimport languageIcon from \"../assets/svg/language.svg\"\nimport trashIcon from \"../assets/svg/trash.svg\"\nimport undoIcon from \"../assets/svg/undo.svg\"\nimport redoIcon from \"../assets/svg/redo.svg\"\nimport translateIcon from \"../assets/svg/translate.svg\"\nimport gestureIcon from \"../assets/svg/spock-hand-gesture.svg\"\nimport guideIcon from \"../assets/svg/orthogonal-view.svg\"\nimport snapIcon from \"../assets/svg/arrow-to-dot.svg\"\nimport debugIcon from \"../assets/svg/wolf.svg\"\nimport downloadIcon from \"../assets/svg/download.svg\"\nimport uploadIcon from \"../assets/svg/upload.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { IIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemButtonList, TMenuItemSelect } from \"./IIMenu\"\nimport { TIISymbol } from \"../symbol\"\nimport { InsertAction, StrikeThroughAction, SurroundAction } from \"../gesture\"\nimport { IIMenuSub, TSubMenuParam } from \"./IIMenuSub\"\nimport { getAvailableLanguageList, PartialDeep } from \"../utils\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuAction extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLElement\n  menuLanguage!: IIMenuSub\n  menuClear?: HTMLButtonElement\n  menuUndo?: HTMLButtonElement\n  menuRedo?: HTMLButtonElement\n  menuConvert?: HTMLButtonElement\n\n  guideGaps = [\n    { label: \"S\", value: \"25\" },\n    { label: \"M\", value: \"50\" },\n    { label: \"L\", value: \"100\" },\n    { label: \"XL\", value: \"150\" },\n  ]\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-action\")\n  {\n    super()\n    this.id = id\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get isMobile(): boolean\n  {\n    return this.editor.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuClear(): HTMLElement\n  {\n    this.menuClear = document.createElement(\"button\")\n    this.menuClear.id = `${ this.id }-clear`\n    this.menuClear.classList.add(\"ms-menu-button\", \"square\")\n    this.menuClear.innerHTML = trashIcon\n    this.menuClear.addEventListener(\"pointerup\", () =>\n    {\n      this.#logger.info(`${ this.id }.clear`)\n      this.editor.clear()\n    })\n    return this.menuClear\n  }\n\n  protected createMenuLanguage(): HTMLElement\n  {\n    const triggerBtn = document.createElement(\"button\")\n    triggerBtn.id = `${ this.id }-language-trigger`\n    triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n    triggerBtn.innerHTML = languageIcon\n\n    const select = document.createElement(\"select\")\n    select.classList.add(\"select-language\")\n    select.id = `${ this.id }-language`\n    getAvailableLanguageList(this.editor.configuration)\n      .then(json =>\n      {\n        const languages = json.result as { [key: string]: string }\n        Object.keys(languages).forEach(key =>\n        {\n          const selected = key === this.editor.configuration.recognition.lang\n          const opt = new Option(languages[key], key, selected, selected)\n          select.appendChild(opt)\n        })\n      })\n    select.addEventListener(\"change\", (e) =>\n    {\n      this.#logger.info(`${ this.id }.selectLanguage`)\n      const value = (e.target as HTMLInputElement).value\n      this.editor.changeLanguage(value)\n    })\n    const params: TSubMenuParam = {\n      trigger: triggerBtn,\n      subMenu: select,\n      position: \"bottom-right\"\n    }\n    this.menuLanguage = new IIMenuSub(params)\n    return this.menuLanguage.element\n  }\n\n  protected createMenuUndo(): HTMLElement\n  {\n    this.menuUndo = document.createElement(\"button\")\n    this.menuUndo.id = `${ this.id }-undo`\n    this.menuUndo.classList.add(\"ms-menu-button\", \"square\")\n    this.menuUndo.innerHTML = undoIcon\n    this.menuUndo.addEventListener(\"pointerup\", async () =>\n    {\n      this.#logger.info(`${ this.id }.undo`)\n      await this.editor.undo()\n    })\n    return this.menuUndo\n  }\n\n  protected createMenuRedo(): HTMLElement\n  {\n    this.menuRedo = document.createElement(\"button\")\n    this.menuRedo.id = `${ this.id }-redo`\n    this.menuRedo.classList.add(\"ms-menu-button\", \"square\")\n    this.menuRedo.innerHTML = redoIcon\n    this.menuRedo.addEventListener(\"pointerup\", async () =>\n    {\n      this.#logger.info(`${ this.id }.redo`)\n      await this.editor.redo()\n    })\n    return this.menuRedo\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.menuConvert = document.createElement(\"button\")\n    this.menuConvert.id = `${ this.id }-convert`\n    this.menuConvert.classList.add(\"ms-menu-button\", \"square\")\n    this.menuConvert.innerHTML = translateIcon\n    this.menuConvert.addEventListener(\"pointerup\", () =>\n    {\n      this.#logger.info(`${ this.id }.convert`)\n      this.editor.convert()\n    })\n    return this.menuConvert\n  }\n\n  protected createMenuGesture(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-gesture`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = gestureIcon\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const surroundActionValues: { label: string, value: string }[] = []\n    for (const key in SurroundAction) {\n      const value = SurroundAction[key as keyof typeof SurroundAction]\n      surroundActionValues.push({ label: key, value })\n    }\n    const strikeThroughActionValues: { label: string, value: string }[] = []\n    for (const key in StrikeThroughAction) {\n      const value = StrikeThroughAction[key as keyof typeof StrikeThroughAction]\n      strikeThroughActionValues.push({ label: key, value })\n    }\n    const splitActionValues: { label: string, value: string }[] = []\n    for (const key in InsertAction) {\n      const value = InsertAction[key as keyof typeof InsertAction]\n      splitActionValues.push({ label: key, value })\n    }\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-gesture-detect`,\n        label: \"Detect gesture\",\n        initValue: this.editor.writer.detectGesture,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-detect`, { value })\n          this.editor.writer.detectGesture = value\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-surround`,\n        label: \"On surround\",\n        values: surroundActionValues,\n        initValue: this.editor.gesture.surroundAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-surround`, { value })\n          this.editor.gesture.surroundAction = value as SurroundAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-strikethrough`,\n        label: \"On strikethrough\",\n        values: strikeThroughActionValues,\n        initValue: this.editor.gesture.strikeThroughAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-strikethrough`, { value })\n          this.editor.gesture.strikeThroughAction = value as StrikeThroughAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-insert`,\n        label: \"On insert\",\n        values: splitActionValues,\n        initValue: this.editor.gesture.insertAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-InsertAction`, { value })\n          this.editor.gesture.insertAction = value as InsertAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Gesture\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuGuide(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-guide`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = guideIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect | TMenuItemButtonList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-guide-enable`,\n        label: \"Show guide\",\n        initValue: this.editor.configuration.rendering.guides.enable,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-enable`, { value })\n          this.editor.configuration.rendering.guides.enable = value as boolean\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-guide-type`,\n        label: \"Guide style\",\n        values: [\n          { label: \"Line\", value: \"line\" },\n          { label: \"Grid\", value: \"grid\" },\n          { label: \"Point\", value: \"point\" },\n        ],\n        initValue: this.editor.configuration.rendering.guides.type,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-type`, { value })\n          this.editor.configuration.rendering.guides.type = value as (\"line\" | \"grid\" | \"point\")\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n      {\n        type: \"list\",\n        id: `${ this.id }-guide-size`,\n        label: \"Guide style\",\n        values: this.guideGaps,\n        initValue: this.editor.configuration.rendering.guides.gap.toString(),\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-size`, { value })\n          this.editor.configuration.rendering.guides.gap = +value\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Guide\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuSnap(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-snap`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = snapIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-guide`,\n        label: \"Snap to guide\",\n        initValue: this.editor.snaps.configuration.guide,\n        callback: (value) => this.editor.snaps.configuration.guide = value\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-element`,\n        label: \"Snap to element\",\n        initValue: this.editor.snaps.configuration.symbol,\n        callback: (value) => this.editor.snaps.configuration.symbol = value\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-snap-angle`,\n        label: \"Snap angle\",\n        values: [\n          { label: \"None\", value: \"0\" },\n          { label: \"10°\", value: \"10\" },\n          { label: \"30°\", value: \"30\" },\n          { label: \"45°\", value: \"45\" },\n          { label: \"90°\", value: \"90\" },\n          { label: \"180°\", value: \"180\" },\n        ],\n        initValue: this.editor.snaps.configuration.angle.toString(),\n        callback: (angle) => this.editor.snaps.configuration.angle = +angle\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Snap\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuDebug(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-debug`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = debugIcon\n\n    const menuItems: TMenuItemBoolean[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-box`,\n        label: \"Show bounding box\",\n        initValue: this.editor.svgDebugger.boundingBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.boundingBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-recognition-box`,\n        label: \"Show recognition box\",\n        initValue: this.editor.svgDebugger.recognitionBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.recognitionBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-item-box`,\n        label: \"Show recognition item box\",\n        initValue: this.editor.svgDebugger.recognitionItemBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.recognitionItemBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-snap-points`,\n        label: \"Show snap points\",\n        initValue: this.editor.svgDebugger.snapPointsVisibility,\n        callback: (debug) => this.editor.svgDebugger.snapPointsVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-vertices`,\n        label: \"Show vertices\",\n        initValue: this.editor.svgDebugger.verticesVisibility,\n        callback: (debug) => this.editor.svgDebugger.verticesVisibility = debug\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Debug\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = downloadIcon\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () =>\n        {\n          this.editor.downloadAsJson()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () =>\n        {\n          this.editor.downloadAsSVG()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () =>\n        {\n          this.editor.downloadAsPNG()\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Export\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected async readFileAsText(file: File): Promise<string>\n  {\n    return new Promise((resolve, reject) =>\n    {\n      const reader = new FileReader()\n      reader.onerror = reject;\n      reader.onload = () => {\n        resolve(reader.result as string)\n      }\n      if (file) {\n        reader.readAsText(file)\n      }\n    })\n  }\n\n  protected createMenuImport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-import`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = uploadIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const importInput = document.createElement(\"input\")\n    importInput.type = \"file\"\n    importInput.accept = \".json\"\n    importInput.multiple = false\n    importInput.addEventListener(\"change\", () => {\n      importBtn.disabled = !importInput.files?.length\n    })\n\n    subMenuWrapper.appendChild(importInput)\n    const importBtn = document.createElement(\"button\")\n    importBtn.classList.add(\"ms-menu-button\")\n    importBtn.innerText = \"Import\"\n    importBtn.disabled = true\n    subMenuWrapper.appendChild(importBtn)\n    importBtn.addEventListener(\"pointerup\", async (e) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (importInput.files?.length) {\n        const fileString = await this.readFileAsText(importInput.files[0])\n        const symbols = JSON.parse(fileString) as PartialDeep<TIISymbol>[]\n        await this.editor.createSymbols(symbols)\n        importInput.value = \"\"\n        importBtn.disabled = true\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Import\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  protected closeAllSubMenu(): void\n  {\n    this.wrapper?.querySelectorAll(\".open\").forEach(e => e.classList.remove(\"open\"))\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.action.enable) {\n      const menuTrigger = document.createElement(\"button\")\n      menuTrigger.id = this.id\n      menuTrigger.classList.add(\"ms-menu-button\", \"square\")\n      menuTrigger.innerHTML = menuIcon\n\n      const subMenuWrapper = document.createElement(\"div\")\n      subMenuWrapper.classList.add(\"ms-menu-colmun\")\n      subMenuWrapper.appendChild(this.createMenuGesture())\n      subMenuWrapper.appendChild(this.createMenuGuide())\n      subMenuWrapper.appendChild(this.createMenuSnap())\n      subMenuWrapper.appendChild(this.createMenuDebug())\n      subMenuWrapper.appendChild(this.createMenuImport())\n      subMenuWrapper.appendChild(this.createMenuExport())\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-left\", \"ms-menu-row\")\n      this.wrapper.appendChild(new IIMenuSub({ trigger: menuTrigger, subMenu: subMenuWrapper, position: \"bottom\" }).element)\n      this.wrapper.appendChild(this.createMenuLanguage())\n      this.wrapper.appendChild(this.createMenuClear())\n      this.wrapper.appendChild(this.createMenuUndo())\n      this.wrapper.appendChild(this.createMenuRedo())\n      this.wrapper.appendChild(this.createMenuConvert())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  update(): void\n  {\n    if (this.menuLanguage) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      this.isMobile ? this.menuLanguage.wrap() : this.menuLanguage.unwrap()\n    }\n    if (this.menuClear) {\n      this.menuClear.disabled = this.editor.history.context.empty\n    }\n    if (this.menuUndo) {\n      this.menuUndo.disabled = !this.editor.history.context.canUndo\n    }\n    if (this.menuRedo) {\n      this.menuRedo.disabled = !this.editor.history.context.canRedo\n    }\n    if (this.menuConvert) {\n      this.menuConvert.disabled = !this.editor.extractStrokesFromSymbols(this.model.symbols).length\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.menuClear = undefined\n      this.menuUndo = undefined\n      this.menuRedo = undefined\n      this.menuConvert = undefined\n    }\n  }\n}\n","import pencilIcon from \"../assets/svg/edit-pencil.svg\"\nimport cursorIcon from \"../assets/svg/frame-select.svg\"\nimport eraseIcon from \"../assets/svg/erase.svg\"\nimport handIcon from \"../assets/svg/drag-hand-gesture.svg\"\nimport rectangleIcon from \"../assets/svg/rectangle.svg\"\nimport rhombusIcon from \"../assets/svg/rhombus.svg\"\nimport circleIcon from \"../assets/svg/circle.svg\"\nimport ellipseIcon from \"../assets/svg/ellipse.svg\"\nimport triangleIcon from \"../assets/svg/triangle.svg\"\nimport lineIcon from \"../assets/svg/linear.svg\"\nimport arrowIcon from \"../assets/svg/linear-arrow.svg\"\nimport doubleArrowIcon from \"../assets/svg/linear-double-arrow.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIMenu } from \"./IIMenu\"\nimport { IIMenuSub } from \"./IIMenuSub\"\nimport { TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuTool extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLDivElement\n  writeBtn?: HTMLButtonElement\n  menuSelect?: HTMLButtonElement\n  menuMove?: HTMLButtonElement\n  menuErase?: HTMLButtonElement\n  menuShape?: HTMLButtonElement\n  subMenuShape?: {\n    rectangle: HTMLButtonElement,\n    circle: HTMLButtonElement,\n    triangle: HTMLButtonElement,\n    ellipse: HTMLButtonElement\n    rhombus: HTMLButtonElement\n  }\n  menuEdge?: HTMLButtonElement\n  subMenuEdge?: {\n    line: HTMLButtonElement,\n    arrow: HTMLButtonElement,\n    doubleArrow: HTMLButtonElement,\n  }\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-tool\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  protected createMenuWrite(): HTMLElement\n  {\n    this.writeBtn = document.createElement(\"button\")\n    this.writeBtn.id = `${this.id}-write-pencil`\n    this.writeBtn.classList.add(\"ms-menu-button\", \"square\")\n    this.writeBtn.innerHTML = pencilIcon\n    this.writeBtn.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.writeBtn!.classList.add(\"active\")\n      this.editor.tool = EditorTool.Write\n      this.editor.writer.tool = EditorWriteTool.Pencil\n    })\n    return this.writeBtn\n  }\n\n  protected createMenuMove(): HTMLElement\n  {\n    this.menuMove = document.createElement(\"button\")\n    this.menuMove.id = `${this.id}-move`\n    this.menuMove.classList.add(\"ms-menu-button\", \"square\")\n    this.menuMove.innerHTML = handIcon\n    this.menuMove.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuMove!.classList.add(\"active\")\n      this.editor.tool = EditorTool.Move\n    })\n    return this.menuMove\n  }\n\n  protected createMenuSelect(): HTMLElement\n  {\n    this.menuSelect = document.createElement(\"button\")\n    this.menuSelect.id = `${this.id}-select`\n    this.menuSelect.classList.add(\"ms-menu-button\", \"square\")\n    this.menuSelect.innerHTML = cursorIcon\n    this.menuSelect.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuSelect!.classList.add(\"active\")\n      this.editor.tool = EditorTool.Select\n    })\n    return this.menuSelect\n  }\n\n  protected createMenuErase(): HTMLElement\n  {\n    this.menuErase = document.createElement(\"button\")\n    this.menuErase.id = `${this.id}-erase`\n    this.menuErase.classList.add(\"ms-menu-button\", \"square\")\n    this.menuErase.innerHTML = eraseIcon\n    this.menuErase.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.menuErase!.classList.add(\"active\")\n      this.editor.tool = EditorTool.Erase\n    })\n    return this.menuErase\n  }\n\n  protected createShapeSubMenu(icon: string, tool: EditorWriteTool): HTMLButtonElement\n  {\n    const subMenuShape = document.createElement(\"button\")\n    subMenuShape.id = `${this.id}-write-shape-${tool}`\n    subMenuShape.classList.add(\"ms-menu-button\", \"square\")\n    subMenuShape.innerHTML = icon\n    subMenuShape.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.editor.tool = EditorTool.Write\n      this.editor.writer.tool = tool\n      subMenuShape.classList.add(\"active\")\n      this.menuShape!.innerHTML = icon\n      this.menuShape!.classList.add(\"active\")\n      const subMenuContent = this.menuShape!.nextSibling\n      if (subMenuContent) {\n        (subMenuContent as HTMLElement).classList.remove(\"open\")\n      }\n    })\n    return subMenuShape\n  }\n\n  protected createMenuShape(): HTMLElement\n  {\n    this.menuShape = document.createElement(\"button\")\n    this.menuShape.id = `${this.id}-write-shape`\n    this.menuShape.classList.add(\"ms-menu-button\", \"square\")\n    this.menuShape.innerHTML = rectangleIcon\n    this.subMenuShape = {\n      circle: this.createShapeSubMenu(circleIcon, EditorWriteTool.Circle),\n      rectangle: this.createShapeSubMenu(rectangleIcon, EditorWriteTool.Rectangle),\n      triangle: this.createShapeSubMenu(triangleIcon, EditorWriteTool.Triangle),\n      ellipse: this.createShapeSubMenu(ellipseIcon, EditorWriteTool.Ellipse),\n      rhombus: this.createShapeSubMenu(rhombusIcon, EditorWriteTool.Rhombus),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-shape-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-shape\")\n    subMenuContent.appendChild(this.subMenuShape.rectangle)\n    subMenuContent.appendChild(this.subMenuShape.circle)\n    subMenuContent.appendChild(this.subMenuShape.ellipse)\n    subMenuContent.appendChild(this.subMenuShape.triangle)\n    subMenuContent.appendChild(this.subMenuShape.rhombus)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuShape,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new IIMenuSub(params).element\n  }\n\n  protected createEdgeSubMenu(square: string, tool: EditorWriteTool): HTMLButtonElement\n  {\n    const subMenuEdge = document.createElement(\"button\")\n    subMenuEdge.id = `${this.id}-write-edge-${tool}`\n    subMenuEdge.classList.add(\"ms-menu-button\", \"square\")\n    subMenuEdge.innerHTML = square\n    subMenuEdge.addEventListener(\"pointerup\", () =>\n    {\n      this.unselectAll()\n      this.editor.tool = EditorTool.Write\n      this.editor.writer.tool = tool\n      subMenuEdge.classList.add(\"active\")\n      this.menuEdge!.innerHTML = square\n      this.menuEdge!.classList.add(\"active\")\n      const subMenuContent = this.menuEdge!.nextSibling\n      if (subMenuContent) {\n        (subMenuContent as HTMLElement).classList.remove(\"open\")\n      }\n    })\n    return subMenuEdge\n  }\n\n  protected createMenuEdge(): HTMLElement\n  {\n    this.menuEdge = document.createElement(\"button\")\n    this.menuEdge.id = `${this.id}-write-edge`\n    this.menuEdge.classList.add(\"ms-menu-button\", \"square\")\n    this.menuEdge.innerHTML = lineIcon\n    this.subMenuEdge = {\n      line: this.createEdgeSubMenu(lineIcon, EditorWriteTool.Line),\n      arrow: this.createEdgeSubMenu(arrowIcon, EditorWriteTool.Arrow),\n      doubleArrow: this.createEdgeSubMenu(doubleArrowIcon, EditorWriteTool.DoubleArrow),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-edge-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-edge\")\n    subMenuContent.appendChild(this.subMenuEdge.line)\n    subMenuContent.appendChild(this.subMenuEdge.arrow)\n    subMenuContent.appendChild(this.subMenuEdge.doubleArrow)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuEdge,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new IIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  update(): void\n  {\n    this.unselectAll()\n    switch (this.editor.tool) {\n      case EditorTool.Erase:\n        this.menuErase?.classList.add(\"active\")\n        break;\n      case EditorTool.Move:\n        this.menuMove?.classList.add(\"active\")\n        break;\n      case EditorTool.Select:\n        this.menuSelect?.classList.add(\"active\")\n        break;\n      case EditorTool.Write:\n        switch (this.editor.writer.tool) {\n          case EditorWriteTool.Circle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.circle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Ellipse:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.ellipse?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Triangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.triangle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Rectangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.rectangle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Line:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.line?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Arrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.arrow?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.DoubleArrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.doubleArrow?.classList.add(\"active\")\n            break;\n          default:\n            this.writeBtn?.classList.add(\"active\")\n            break;\n        }\n        break;\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.tool.enable) {\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-bottom\", \"ms-menu-row\")\n\n      this.wrapper.appendChild(this.createMenuWrite())\n      this.wrapper.appendChild(this.createMenuMove())\n      this.wrapper.appendChild(this.createMenuSelect())\n      this.wrapper.appendChild(this.createMenuErase())\n      this.wrapper.appendChild(this.createMenuEdge())\n      this.wrapper.appendChild(this.createMenuShape())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.writeBtn = undefined\n      this.menuSelect = undefined\n      this.menuMove = undefined\n      this.menuErase = undefined\n      this.menuShape = undefined\n      this.subMenuShape = undefined\n      this.menuEdge = undefined\n      this.subMenuEdge = undefined\n      this.wrapper = undefined\n    }\n  }\n}\n","import styleIcon from \"../assets/svg/palette.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { SymbolType, TIISymbol } from \"../symbol\"\nimport { IIMenu, TMenuItemColorList } from \"./IIMenu\"\nimport { IIMenuSub } from \"./IIMenuSub\"\nimport { TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuStyle extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLDivElement\n  subMenu?: IIMenuSub\n  triggerBtn?: HTMLButtonElement\n  menuColorStroke?: HTMLDivElement\n  menuColorFill?: HTMLDivElement\n  menuThickness?: HTMLDivElement\n  menuFontSize?: HTMLDivElement\n  menuFontWeight?: HTMLDivElement\n  menuStrokeOpacity?: HTMLDivElement\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-style\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.model.symbolsSelected\n  }\n\n  get writeShape(): boolean\n  {\n    return ![EditorWriteTool.Arrow, EditorWriteTool.DoubleArrow, EditorWriteTool.Line, EditorWriteTool.Pencil].includes(this.editor.writer.tool)\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get isMobile(): boolean\n  {\n    return this.editor.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuStroke(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0]?.color ? symbolsStyles[0]?.color : this.editor.penStyle.color as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Colors\",\n      id: `${ this.id }-color`,\n      fill: false,\n      values: this.colors,\n      initValue: color,\n      callback: (color) =>\n      {\n        this.editor.penStyle = { color }\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { color })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorStroke = this.createWrapCollapsible(menuColor, \"Colors\")\n    this.menuColorStroke.id = `${ this.id }-color`\n    return this.menuColorStroke\n  }\n\n  protected createMenuColorFill(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0].color ? symbolsStyles[0].color : this.editor.penStyle.color as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Fill\",\n      id: `${ this.id }-fill`,\n      fill: true,\n      values: this.colors,\n      initValue: color,\n      callback: (fill) =>\n      {\n        this.editor.penStyle = { fill }\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { fill })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorFill = this.createWrapCollapsible(menuColor, \"Fill\")\n    this.menuColorFill.id = `${ this.id }-fill`\n    return this.menuColorFill\n  }\n\n  protected createMenuThickness(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-thickness-list`\n    wrapper.classList.add(\"ms-menu-row\", \"thickness-list\")\n\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqWidth = symbolsStyles.length && symbolsStyles.every(st => st.width === symbolsStyles[0].width)\n    const width = hasUniqWidth ? symbolsStyles[0].width : this.editor.penStyle.width\n\n    this.thicknessList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-thickness-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (width === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        this.editor.penStyle = { width: size.value }\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (this.symbolsSelected.length) {\n          this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { width: size.value })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuThickness = this.createWrapCollapsible(wrapper, \"Thickness\")\n    this.menuThickness.id = `${ this.id }-thickness`\n    return this.menuThickness\n  }\n\n  protected createMenuFontSize(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-size-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-size-list\")\n\n    this.fontSizeList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-size-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (this.editor.configuration.fontStyle.size === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (size.value === \"auto\") {\n          this.editor.configuration.fontStyle.size = \"auto\"\n        }\n        else {\n          const fontSize = (size.value as number)\n          this.editor.configuration.fontStyle.size = fontSize\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractText().length))\n          this.editor.updateTextFontStyle(textSymbols.map(s => s.id), { fontSize: fontSize * this.rowHeight })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontSize = this.createWrapCollapsible(wrapper, \"Font size\")\n    this.menuFontSize.id = `${ this.id }-font-size`\n    return this.menuFontSize\n  }\n\n  protected createMenuFontWeight(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-weight-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-weight-list\")\n\n    this.fontWeightList.forEach((weight) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-weight-${ weight.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"center\")\n      btn.textContent = weight.label\n      if (this.editor.configuration.fontStyle.weight === weight.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        this.editor.configuration.fontStyle.weight = weight.value as \"auto\" | \"normal\" | \"bold\"\n        if (this.editor.configuration.fontStyle.weight !== \"auto\") {\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractText().length))\n          this.editor.updateTextFontStyle(textSymbols.map(s => s.id), { fontWeight: this.editor.configuration.fontStyle.weight })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontWeight = this.createWrapCollapsible(wrapper, \"Font weight\")\n    this.menuFontWeight.id = `${ this.id }-font-weight`\n    return this.menuFontWeight\n  }\n\n  protected createMenuOpacity(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqOpacity = symbolsStyles.length && symbolsStyles.every(st => st.opacity === symbolsStyles[0]?.opacity)\n    const currentOpacity = (hasUniqOpacity && symbolsStyles[0]?.opacity ? symbolsStyles[0]?.opacity : (this.editor.penStyle.opacity || 1)) * 100 as number\n\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-opacity-input-wrapper`\n    const input = document.createElement(\"input\")\n    input.id = `${ this.id }-opacity-input`\n    input.setAttribute(\"name\", `opacity`)\n    input.setAttribute(\"type\", \"range\")\n    input.setAttribute(\"step\", \"1\")\n    input.setAttribute(\"min\", \"1\")\n    input.setAttribute(\"max\", \"100\")\n    wrapper.appendChild(input)\n\n    const output = document.createElement(\"output\")\n    output.setAttribute(\"for\", `opacity`)\n    output.innerHTML = currentOpacity ? `${ currentOpacity }` : \"-\"\n    wrapper.appendChild(output)\n\n    if (currentOpacity) {\n      input.setAttribute(\"value\", currentOpacity.toString())\n    }\n    input.addEventListener(\"input\", (evt) =>\n    {\n      const value = (evt.target as HTMLInputElement).value as unknown as number\n      output.innerHTML = `${ value }%`\n      this.editor.penStyle = { opacity: value / 100 }\n      if (this.symbolsSelected.length) {\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { opacity: value / 100 })\n      }\n    })\n    this.menuStrokeOpacity = this.createWrapCollapsible(wrapper, \"Opacity\")\n    this.menuStrokeOpacity.id = `${ this.id }-opacity`\n    return this.menuStrokeOpacity\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.style.enable) {\n      this.triggerBtn = document.createElement(\"button\")\n      this.triggerBtn.id = this.id\n      this.triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n      this.triggerBtn.innerHTML = styleIcon\n\n      const subMenuContent = document.createElement(\"div\")\n      subMenuContent.classList.add(\"ms-menu-colmun\")\n      subMenuContent.appendChild(this.createMenuStroke())\n      subMenuContent.appendChild(this.createMenuColorFill())\n      subMenuContent.appendChild(this.createMenuThickness())\n      subMenuContent.appendChild(this.createMenuFontSize())\n      subMenuContent.appendChild(this.createMenuFontWeight())\n      subMenuContent.appendChild(this.createMenuOpacity())\n\n      const params: TSubMenuParam = {\n        trigger: this.triggerBtn,\n        subMenu: subMenuContent,\n        position: \"bottom-left\",\n      }\n      this.subMenu = new IIMenuSub(params)\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-right\")\n      this.wrapper.appendChild(this.subMenu.element)\n      layer.appendChild(this.wrapper)\n      this.update()\n    }\n  }\n\n  update(): void\n  {\n    if (this.subMenu) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      this.isMobile ? this.subMenu.wrap() : this.subMenu.unwrap()\n    }\n\n    if (this.editor.tool === EditorTool.Write) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        this.menuColorFill.style.display = this.writeShape ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else if (this.editor.tool === EditorTool.Select) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        const shapeSelected = this.model.symbolsSelected.length && this.model.symbolsSelected.some(s => s.type === SymbolType.Shape)\n        this.menuColorFill.style.display = shapeSelected ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else {\n      this.hide()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.subMenu = undefined\n      this.triggerBtn = undefined\n      this.menuColorStroke = undefined\n      this.menuColorFill = undefined\n      this.menuThickness = undefined\n      this.menuFontSize = undefined\n      this.menuFontWeight = undefined\n      this.menuStrokeOpacity = undefined\n    }\n  }\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\nimport { SELECTION_MARGIN } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { DecoratorKind, IIDecorator, IIRecognizedText, IIStroke, IISymbolGroup, IIText, RecognizedKind, SymbolType, TIISymbol } from \"../symbol\"\nimport { IIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemColorList } from \"./IIMenu\"\nimport { createUUID } from \"../utils\"\nimport { IIMenuSub, TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\n/**\n * @group Menu\n */\nexport class IIMenuContext extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLElement\n  editMenu?: HTMLDivElement\n  editInput?: HTMLInputElement\n  editSaveBtn?: HTMLButtonElement\n  reorderMenu?: HTMLDivElement\n  decoratorMenu?: HTMLDivElement\n  menuExport?: HTMLDivElement\n  duplicateBtn?: HTMLButtonElement\n  groupBtn?: HTMLButtonElement\n  convertBtn?: HTMLButtonElement\n  removeBtn?: HTMLButtonElement\n\n  position: {\n    x: number,\n    y: number,\n    scrollTop: number,\n    scrollLeft: number\n  }\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-context\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.position = { x: 0, y: 0, scrollLeft: 0, scrollTop: 0 }\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.editor.model.symbolsSelected\n  }\n\n  get haveSymbolsSelected(): boolean\n  {\n    return this.symbolsSelected.length > 0\n  }\n\n  get symbolsDecorable(): (IIStroke | IIText | IISymbolGroup | IIRecognizedText)[]\n  {\n    return this.symbolsSelected.filter(s => [SymbolType.Stroke, SymbolType.Text, SymbolType.Group].includes(s.type) || (s.type === SymbolType.Recognized && s.kind === RecognizedKind.Text)) as (IIStroke | IIText | IISymbolGroup | IIRecognizedText)[]\n  }\n\n  get showDecorator(): boolean\n  {\n    return this.symbolsDecorable.length > 0\n  }\n\n  protected createMenuEdit(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-edit-trigger`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Edit\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    this.editInput = document.createElement(\"input\")\n    subMenuWrapper.appendChild(this.editInput)\n    this.editSaveBtn = document.createElement(\"button\")\n    this.editSaveBtn.classList.add(\"ms-menu-button\")\n    this.editSaveBtn.innerText = \"Save\"\n    subMenuWrapper.appendChild(this.editSaveBtn)\n    this.editSaveBtn.addEventListener(\"pointerdown\", async (e) =>\n    {\n      e.stopPropagation()\n      const textSymbol = this.editor.model.symbolsSelected.find(s => s.type === SymbolType.Text) as IIText\n      if (textSymbol) {\n        const firstChar = textSymbol.chars[0]\n        textSymbol.chars = []\n        for (let i = 0; i < this.editInput!.value.length; i++) {\n          textSymbol.chars.push({\n            label: this.editInput!.value.charAt(i),\n            id: createUUID(),\n            color: firstChar.color,\n            fontSize: firstChar.fontSize,\n            fontWeight: firstChar.fontWeight,\n            bounds: firstChar.bounds\n          })\n        }\n        await this.editor.updateSymbol(textSymbol)\n        this.editor.selector.resetSelectedGroup([textSymbol])\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.editMenu = new IIMenuSub(params).element\n\n    return this.editMenu\n  }\n\n  protected createMenuDuplicate(): HTMLElement\n  {\n    this.duplicateBtn = document.createElement(\"button\")\n    this.duplicateBtn.id = `${ this.id }-duplicate`\n    this.duplicateBtn.textContent = \"Duplicate\"\n    this.duplicateBtn.classList.add(\"ms-menu-button\")\n    this.duplicateBtn.addEventListener(\"pointerup\", async () =>\n    {\n      const symbolsToDuplicate = this.symbolsSelected\n\n      const updateDeepIdInGroup = (gr: IISymbolGroup) =>\n      {\n        gr.children.forEach(s =>\n        {\n          s.id = s.id.slice(0, -36) + `-${ createUUID() }`\n          switch (s.type) {\n            case SymbolType.Group:\n              updateDeepIdInGroup(s)\n              break\n            case SymbolType.Recognized:\n              s.strokes.forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n              break\n          }\n        })\n      }\n      const duplicatedSymbols = symbolsToDuplicate.map(s =>\n      {\n        const clone = s.clone()\n        while (this.editor.model.symbols.find(s => s.id === clone.id)) {\n          clone.id = clone.id.slice(0, -36) + `-${ createUUID() }`\n          if (clone.type === SymbolType.Group) {\n            updateDeepIdInGroup(clone)\n          }\n          else if (clone.type === SymbolType.Recognized) {\n            clone.strokes.forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n          }\n        }\n        clone.selected = true\n        this.editor.translator.applyToSymbol(clone, SELECTION_MARGIN, SELECTION_MARGIN)\n        return clone\n      })\n\n      this.editor.unselectAll()\n      await this.editor.addSymbols(duplicatedSymbols)\n      this.editor.selector.drawSelectedGroup(duplicatedSymbols)\n    })\n    return this.duplicateBtn\n  }\n\n  protected createMenuGroup(): HTMLElement\n  {\n    this.groupBtn = document.createElement(\"button\")\n    this.groupBtn.id = `${ this.id }-duplicate`\n    this.groupBtn.textContent = \"Group\"\n    this.groupBtn.classList.add(\"ms-menu-button\")\n    this.groupBtn.addEventListener(\"pointerup\", async () =>\n    {\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        const symbols = this.editor.ungroupSymbol(this.symbolsSelected[0] as IISymbolGroup)\n        this.editor.select(symbols.map(s => s.id))\n      }\n      else {\n        const symbols = this.symbolsSelected.slice()\n        this.editor.unselectAll()\n        const group = this.editor.groupSymbols(symbols)\n        group.selected = true\n        this.editor.select([group.id])\n      }\n    })\n    return this.groupBtn\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.convertBtn = document.createElement(\"button\")\n    this.convertBtn.id = `${ this.id }-convert`\n    this.convertBtn.textContent = \"Convert\"\n    this.convertBtn.classList.add(\"ms-menu-button\")\n    this.convertBtn.addEventListener(\"pointerup\", () => this.editor.convertSymbols(this.symbolsSelected))\n    return this.convertBtn\n  }\n\n  protected createMenuRemove(): HTMLButtonElement\n  {\n    this.removeBtn = document.createElement(\"button\")\n    this.removeBtn.id = `${ this.id }-remove`\n    this.removeBtn.textContent = \"Remove\"\n    this.removeBtn.classList.add(\"ms-menu-button\")\n    this.removeBtn.addEventListener(\"pointerup\", async () =>\n    {\n      this.editor.selector.removeSelectedGroup()\n      await this.editor.removeSymbols(this.symbolsSelected.map(s => s.id))\n    })\n    return this.removeBtn\n  }\n\n  protected createMenuReorder(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-reorder`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Reorder\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-first`,\n        label: \"Bring to front\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"last\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-forward`,\n        label: \"Bring forward\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"forward\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-backward`,\n        label: \"Send backward\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"backward\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-last`,\n        label: \"Send to back\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected.slice().reverse(), \"first\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.reorderMenu = new IIMenuSub(params).element\n    return this.reorderMenu\n  }\n\n  protected createDecoratorSubMenu(label: string, kind: DecoratorKind): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator-${ kind }`\n    trigger.classList.add(\"ms-menu-button\")\n    const labelEL = document.createElement(\"span\")\n    labelEL.innerText = label\n    trigger.appendChild(labelEL)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: (TMenuItemBoolean | TMenuItemColorList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-decorator-${ kind }-enable`,\n        label: \"Enable\",\n        initValue: false,\n        callback: (enable) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            if (enable) {\n              if (!s.decorators.some(d => d.kind === kind)) {\n                s.decorators.push(new IIDecorator(kind, this.editor.penStyle))\n              }\n            }\n            else {\n              const decoIndex = s.decorators.findIndex(d => d.kind === kind)\n              if (decoIndex > -1) {\n                s.decorators.splice(decoIndex, 1)\n              }\n            }\n            this.editor.model.updateSymbol(s)\n            this.editor.renderer.drawSymbol(s)\n          })\n\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n          {\n            (b as HTMLButtonElement).disabled = !enable\n            b.classList.remove(\"active\")\n          })\n          if (enable) {\n            document.querySelector(`#${ this.id }-decorator-${ kind }-color button`)?.classList.add(\"active\")\n          }\n        }\n      },\n      {\n        type: \"colors\",\n        label: \"Colors\",\n        id: `${ this.id }-decorator-${ kind }-color`,\n        fill: false,\n        values: this.colors.filter((_c, i) => !(i % 4)),\n        initValue: this.colors[0],\n        disabled: true,\n        callback: (color) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            const deco = s.decorators.find(d => d.kind === kind)\n            if (deco) {\n              deco.style.color = color\n              this.editor.model.updateSymbol(s)\n              this.editor.renderer.drawSymbol(s)\n            }\n          })\n        },\n      }\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    return this.decoratorMenu = new IIMenuSub(params).element\n  }\n\n  protected createMenuDecorator(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Decorator\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Hightlight\", DecoratorKind.Highlight))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Surround\", DecoratorKind.Surround))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Underline\", DecoratorKind.Underline))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Strikethrough\", DecoratorKind.Strikethrough))\n\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.decoratorMenu = new IIMenuSub(params).element\n    return this.decoratorMenu\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Export\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () => this.editor.downloadAsJson(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () => this.editor.downloadAsSVG(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () => this.editor.downloadAsPNG(this.haveSymbolsSelected)\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.menuExport = new IIMenuSub(params).element\n    return this.menuExport\n  }\n\n  protected createMenuSelectAll(): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.id = `${ this.id }-duplicate`\n    btn.textContent = \"Select all\"\n    btn.classList.add(\"ms-menu-button\")\n    btn.addEventListener(\"pointerup\", async () => this.editor.selectAll())\n    return btn\n  }\n\n  protected updateDecoratorSubMenu(): void\n  {\n    if (this.showDecorator) {\n      this.decoratorMenu?.style.removeProperty(\"display\")\n\n      Object.values(DecoratorKind).forEach(kind =>\n      {\n        const checkbox = document.getElementById(`${ this.id }-decorator-${ kind }-enable`) as HTMLInputElement\n        if (checkbox) {\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(e => e.classList.remove(\"active\"))\n          const decos = this.symbolsDecorable.flatMap(s => s.decorators).filter(d => d.kind === kind)\n\n          if (decos.length && decos.every(d => d.style.color === decos[0].style.color)) {\n            const btnToActivate = document.getElementById(`${ this.id }-decorator-${ kind }-color-${ decos[0].style.color?.replace(\"#\", \"\") }-btn`)\n            btnToActivate?.classList.add(\"active\")\n          }\n\n          if (this.symbolsDecorable.filter(s => s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = true\n\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n            checkbox.indeterminate = false\n          }\n          else if (this.symbolsDecorable.filter(s => !s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = false\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = true\n            })\n            checkbox.indeterminate = false\n          }\n          else {\n            checkbox.setAttribute(\"indeterminate\", \"true\")\n            checkbox.indeterminate = true\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n          }\n        }\n\n      })\n    }\n    else {\n      this.decoratorMenu?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  protected updateGroupMenu(): void\n  {\n    if (this.groupBtn && this.haveSymbolsSelected) {\n      this.groupBtn.style.removeProperty(\"display\")\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        this.groupBtn.textContent = \"UnGroup\"\n      }\n      else {\n        this.groupBtn.textContent = \"Group\"\n      }\n    }\n    else {\n      this.groupBtn?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  update(): void\n  {\n    this.wrapper?.style.setProperty(\"left\", `${ this.position.x - this.position.scrollLeft }px`)\n    this.wrapper?.style.setProperty(\"top\", `${ this.position.y - this.position.scrollTop }px`)\n\n    if (this.haveSymbolsSelected) {\n      const textSymbol = this.editor.model.symbolsSelected.find(s => s.type === SymbolType.Text)\n      if (this.editMenu && this.editInput && this.editor.model.symbolsSelected.length === 1 && textSymbol) {\n        this.editMenu.style.removeProperty(\"display\")\n        this.editInput.value = (textSymbol as IIText).label\n      }\n      else {\n        this.editMenu?.style.setProperty(\"display\", \"none\")\n      }\n\n      if (this.editor.extractStrokesFromSymbols(this.symbolsSelected).length) {\n        this.convertBtn?.style.removeProperty(\"display\")\n      }\n      else {\n        this.convertBtn?.style.setProperty(\"display\", \"none\")\n      }\n\n\n      this.reorderMenu?.style.removeProperty(\"display\")\n      this.duplicateBtn?.style.removeProperty(\"display\")\n      this.removeBtn?.style.removeProperty(\"display\")\n      this.menuExport?.style.removeProperty(\"display\")\n    }\n    else {\n      this.editMenu?.style.setProperty(\"display\", \"none\")\n      this.convertBtn?.style.setProperty(\"display\", \"none\")\n      this.reorderMenu?.style.setProperty(\"display\", \"none\")\n      this.duplicateBtn?.style.setProperty(\"display\", \"none\")\n      this.removeBtn?.style.setProperty(\"display\", \"none\")\n      this.menuExport?.style.setProperty(\"display\", \"none\")\n    }\n    this.updateDecoratorSubMenu()\n    this.updateGroupMenu()\n  }\n\n  render(layer: HTMLElement): void\n  {\n    this.wrapper = document.createElement(\"div\")\n    this.wrapper.id = `${ this.id }-wrapper`\n    this.wrapper.classList.add(\"ms-menu\", \"ms-menu-context\")\n    this.wrapper.appendChild(this.createMenuEdit())\n    this.wrapper.appendChild(this.createMenuDecorator())\n    this.wrapper.appendChild(this.createMenuReorder())\n    this.wrapper.appendChild(this.createMenuExport())\n    this.wrapper.appendChild(this.createMenuConvert())\n    this.wrapper.appendChild(this.createMenuGroup())\n    this.wrapper.appendChild(this.createMenuDuplicate())\n    this.wrapper.appendChild(this.createMenuRemove())\n    this.wrapper.appendChild(this.createMenuSelectAll())\n    this.wrapper.style.setProperty(\"display\", \"none\")\n    layer.appendChild(this.wrapper)\n\n    this.editor.layers.rendering.addEventListener(\"scroll\", () =>\n    {\n      this.position.scrollLeft = this.editor.layers.rendering.scrollLeft || 0\n      this.position.scrollTop = this.editor.layers.rendering.scrollTop || 0\n      this.update()\n    })\n  }\n\n  show(): void\n  {\n    this.update()\n    this.wrapper?.style.setProperty(\"display\", \"block\")\n  }\n\n  hide(): void\n  {\n    this.wrapper?.style.setProperty(\"display\", \"none\")\n  }\n\n  destroy(): void\n  {\n    while (this.wrapper?.lastChild) {\n      this.wrapper.removeChild(this.wrapper.lastChild)\n    }\n    this.wrapper?.remove()\n  }\n}\n","\n/**\n * @group Menu\n */\nexport type TMenuConfiguration = {\n  enable: boolean,\n  style: {\n    enable: boolean,\n  }\n  tool: {\n    enable: boolean,\n  }\n  action: {\n    enable: boolean,\n  }\n  context: {\n    enable: boolean,\n  }\n}\n\n/**\n * @group Menu\n * @source\n */\nexport const DefaultMenuConfiguration: TMenuConfiguration = {\n  enable: true,\n  style: {\n    enable: true\n  },\n  tool: {\n    enable: true\n  },\n  action: {\n    enable: true\n  },\n  context: {\n    enable: true\n  },\n}\n","import style from \"./menu.css\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { IIMenuAction } from \"./IIMenuAction\"\nimport { IIMenuTool } from \"./IIMenuTool\"\nimport { IIMenuContext } from \"./IIMenuContext\"\nimport { IIMenuStyle } from \"./IIMenuStyle\"\n\n/**\n * @group Manager\n */\nexport class IIMenuManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n  editor: InteractiveInkEditor\n  layer?: HTMLElement\n  action: IIMenuAction\n  tool: IIMenuTool\n  context: IIMenuContext\n  style: IIMenuStyle\n\n  constructor(editor: InteractiveInkEditor, custom?: { style?: IIMenuStyle, tool?: IIMenuTool, action?: IIMenuAction, context?: IIMenuContext })\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n\n    if (custom?.style) {\n      const CustomMenuStyle = custom.style as unknown as typeof IIMenuStyle\n      this.style = new CustomMenuStyle(this.editor)\n    }\n    else {\n      this.style = new IIMenuStyle(this.editor)\n    }\n    if (custom?.tool) {\n      const CustomMenuTool = custom.tool as unknown as typeof IIMenuTool\n      this.tool = new CustomMenuTool(this.editor)\n    }\n    else {\n      this.tool = new IIMenuTool(this.editor)\n    }\n    if (custom?.action) {\n      const CustomMenuAction = custom.action as unknown as typeof IIMenuAction\n      this.action = new CustomMenuAction(this.editor)\n    }\n    else {\n      this.action = new IIMenuAction(this.editor)\n    }\n    if (custom?.context) {\n      const CustomMenuAction = custom.context as unknown as typeof IIMenuContext\n      this.context = new CustomMenuAction(this.editor)\n    }\n    else {\n      this.context = new IIMenuContext(this.editor)\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.enable) {\n      this.layer = layer\n\n      const styleElement = document.createElement(\"style\")\n      styleElement.appendChild(document.createTextNode(style as string))\n      this.layer.prepend(styleElement)\n\n      if (this.editor.configuration.menu.action.enable) {\n        this.action.render(this.layer)\n      }\n      if (this.editor.configuration.menu.style.enable) {\n        this.style.render(this.layer)\n      }\n      if (this.editor.configuration.menu.tool.enable) {\n        this.tool.render(this.layer)\n      }\n      if (this.editor.configuration.menu.context.enable) {\n        this.context.render(this.layer)\n      }\n    }\n  }\n\n  update(): void\n  {\n    this.action.update()\n    this.tool.update()\n    this.style.update()\n  }\n\n  show(): void\n  {\n    this.action.show()\n    this.tool.show()\n    this.style.show()\n  }\n\n  hide(): void\n  {\n    this.action.hide()\n    this.tool.hide()\n    this.style.hide()\n  }\n\n  destroy(): void\n  {\n    this.action.destroy()\n    this.tool.destroy()\n    this.style.destroy()\n  }\n}\n","import { PartialDeep } from \"../utils\"\n\n/**\n * @group Snap\n */\nexport type TSnapConfiguration = {\n  guide: boolean\n  symbol: boolean\n  angle: number\n}\n\n/**\n * @group Snap\n * @source\n */\nexport const DefaultSnapConfiguration: TSnapConfiguration = {\n  guide: true,\n  symbol: true,\n  angle: 0\n}\n\n/**\n * @group Snap\n */\nexport class SnapConfiguration implements TSnapConfiguration\n{\n  guide: boolean\n  symbol: boolean\n  angle: number\n\n  constructor(config? : PartialDeep<TSnapConfiguration>)\n  {\n    this.symbol = config?.symbol !== undefined ? config.symbol : DefaultSnapConfiguration.symbol\n    this.guide = config?.guide !== undefined ? config.guide : DefaultSnapConfiguration.guide\n    this.angle = config?.angle !== undefined ? config.angle : DefaultSnapConfiguration.angle\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, TPoint, TSegment } from \"../symbol\"\nimport { IISVGRenderer } from \"../renderer\"\nimport { IISVGRendererConst } from \"../renderer/svg/IISVGRendererConst\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PartialDeep } from \"../utils\"\nimport { SnapConfiguration, TSnapConfiguration } from \"./IISnapConfiguration\"\n\n/**\n * @group Snap\n */\nexport type TSnapNudge = TPoint\n\n/**\n * @group Snap\n */\nexport type TSnapLineInfos = {\n  nudge: TSnapNudge,\n  verticales: TSegment[]\n  horizontales: TSegment[]\n}\n\n/**\n * @group Snap\n */\nexport class IISnapManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n  configuration: SnapConfiguration\n\n  constructor(editor: InteractiveInkEditor, config?: PartialDeep<TSnapConfiguration>)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.configuration = new SnapConfiguration(config)\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): IISVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get selectionSnapPoints(): TPoint[]\n  {\n    return Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.snapPoints)).snapPoints\n  }\n\n  get otherSnapPoints(): TPoint[]\n  {\n    const selectSymbolIds = this.model.symbolsSelected.map(s => s.id)\n    return this.model.symbols.filter(s => !selectSymbolIds.includes(s.id)).flatMap(s => s.snapPoints)\n  }\n\n  get snapThreshold(): number\n  {\n    return this.editor.configuration.rendering.guides.gap / 2\n  }\n\n  protected getNearestVerticalGuide(x: number): number\n  {\n    if (this.renderer.verticalGuides.length) {\n      return this.renderer.verticalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - x) < Math.abs(prev - x) ? curr : prev)\n      })\n    }\n    return x\n  }\n\n  protected getNearestHorizontalGuide(y: number): number\n  {\n    if (this.renderer.horizontalGuides.length) {\n      return this.renderer.horizontalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - y) < Math.abs(prev - y) ? curr : prev)\n      })\n    }\n    return y\n  }\n\n  protected getGuidePointToSnap(point: TPoint): TPoint\n  {\n    return {\n      x: this.getNearestVerticalGuide(point.x),\n      y: this.getNearestHorizontalGuide(point.y)\n    }\n  }\n\n  drawSnapToElementLines(lines: TSegment[]): void\n  {\n    const attrs = {\n      role: \"snap-to-element\",\n      fill: \"transparent\",\n      stroke: \"blue\",\n      \"stroke-width\": \"2\",\n      style: IISVGRendererConst.noSelection,\n      \"marker-start\": `url(#${ IISVGRendererConst.crossMarker })`,\n      \"marker-end\": `url(#${ IISVGRendererConst.crossMarker })`\n    }\n    lines.forEach(seg =>\n    {\n      this.renderer.drawLine(seg.p1, seg.p2, attrs)\n    })\n  }\n\n  clearSnapToElementLines(): void\n  {\n    this.renderer.clearElements({ attrs: { role: \"snap-to-element\" } })\n  }\n\n  protected getSnapLinesInfos(sourcePoints: TPoint[], targetPoints: TPoint[]): TSnapLineInfos\n  {\n    const infos: TSnapLineInfos = {\n      nudge: {\n        x: Infinity,\n        y: Infinity\n      },\n      verticales: [],\n      horizontales: [],\n    }\n    if (!sourcePoints.length || !targetPoints.length) return infos\n\n    sourcePoints.forEach(p1 =>\n    {\n      targetPoints.forEach(p2 =>\n      {\n        if (this.snapThreshold > Math.abs(p2.x - p1.x)) {\n          if (Math.abs(infos.nudge.x) > Math.abs(p2.x - p1.x)) {\n            infos.nudge.x = p2.x - p1.x\n            infos.verticales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.x === p2.x - p1.x) {\n            infos.verticales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n        if (this.snapThreshold > Math.abs(p2.y - p1.y)) {\n          if (Math.abs(infos.nudge.y) > Math.abs(p2.y - p1.y)) {\n            infos.nudge.y = p2.y - p1.y\n            infos.horizontales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.y === p2.y - p1.y) {\n            infos.horizontales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n      })\n    })\n\n    return infos\n  }\n\n  snapResize(point: TPoint, horizontal = true, vertical = true): TPoint\n  {\n    this.clearSnapToElementLines()\n    if (!this.configuration.symbol && !this.configuration.guide) return point\n\n    let localPoint: TPoint = {\n      x: Infinity,\n      y: Infinity\n    }\n    if (this.configuration.guide) {\n      localPoint = this.getGuidePointToSnap(point)\n    }\n    const snapLines: TSegment[] = []\n\n    if (this.configuration.symbol) {\n      const snapLinesInfos = this.getSnapLinesInfos([point], this.otherSnapPoints)\n      if (horizontal && Math.abs(snapLinesInfos.nudge.x) <= Math.abs(point.x - localPoint.x)) {\n        localPoint.x = point.x + snapLinesInfos.nudge.x\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (vertical && Math.abs(snapLinesInfos.nudge.y) <= Math.abs(point.y - localPoint.y)) {\n        localPoint.y = point.y + snapLinesInfos.nudge.y\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n\n    if (localPoint.x === Infinity) localPoint.x = point.x\n    if (localPoint.y === Infinity) localPoint.y = point.y\n\n    snapLines.forEach(s => s.p1 = localPoint)\n    this.drawSnapToElementLines(snapLines)\n    return localPoint\n  }\n\n  snapTranslate(tx: number, ty: number): TSnapNudge\n  {\n    this.clearSnapToElementLines()\n    const nudge: TSnapNudge = { x: tx, y: ty }\n    if (!this.configuration.symbol && !this.configuration.guide) return nudge\n\n    const selectionSymbolPoints = this.selectionSnapPoints.map(p => ({ x: p.x + tx, y: p.y + ty }))\n\n    let lastDeltaX = Infinity\n    let lastDeltaY = Infinity\n\n    if (this.configuration.guide) {\n      selectionSymbolPoints.forEach(p =>\n      {\n        const gridPoint = this.getGuidePointToSnap(p)\n        if (lastDeltaX > Math.abs(gridPoint.x - p.x)) {\n          nudge.x = gridPoint.x - p.x + tx\n          lastDeltaX = Math.abs(gridPoint.x - p.x)\n        }\n        if (lastDeltaY > Math.abs(gridPoint.y - p.y)) {\n          nudge.y = gridPoint.y - p.y + ty\n          lastDeltaY = Math.abs(gridPoint.y - p.y)\n        }\n      })\n    }\n\n    const snapLines: TSegment[] = []\n    if (this.configuration.symbol) {\n      const snapLinesInfos = this.getSnapLinesInfos(selectionSymbolPoints, this.otherSnapPoints)\n      if (lastDeltaX >= Math.abs(snapLinesInfos.nudge.x) && snapLinesInfos.verticales.length) {\n        nudge.x = snapLinesInfos.nudge.x + tx\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (lastDeltaY >= Math.abs(snapLinesInfos.nudge.y) && snapLinesInfos.horizontales.length) {\n        nudge.y = snapLinesInfos.nudge.y + ty\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n    if (snapLines.length) {\n      snapLines.forEach(l =>\n      {\n        l.p1.x += nudge.x - tx\n        l.p1.y += nudge.y - ty\n      })\n      this.drawSnapToElementLines(snapLines)\n    }\n    return nudge\n  }\n\n  snapRotation(angleDegree: number): number\n  {\n    if (this.configuration.angle > 0) {\n      return this.configuration.angle * Math.round(angleDegree / this.configuration.angle)\n    }\n    return angleDegree\n  }\n}\n","import { mergeDeep, PartialDeep } from \"../utils\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultMenuConfiguration, TMenuConfiguration } from \"../menu\"\nimport { DefaultRecognizerWebSocketConfiguration, RecognizerWebSocketConfiguration, TRecognitionWebSocketConfiguration, TRecognizerWebSocketConfiguration, TServerWebsocketConfiguration } from \"../recognizer\"\nimport { DefaultIIRendererConfiguration, TIIRendererConfiguration } from \"../renderer\"\nimport { DefaultGestureConfiguration, TGestureConfiguration } from \"../gesture\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaultSnapConfiguration, SnapConfiguration, TSnapConfiguration } from \"../snap\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkEditorConfiguration = TEditorConfiguration & TRecognizerWebSocketConfiguration & {\n \"undo-redo\": THistoryConfiguration\n  rendering: TIIRendererConfiguration\n  grabber: TGrabberConfiguration\n  menu: TMenuConfiguration\n  penStyle: TStyle,\n  fontStyle: {\n    size: number | \"auto\"\n    weight: \"bold\" | \"normal\" | \"auto\"\n  }\n  gesture: TGestureConfiguration\n  snap: TSnapConfiguration\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInteractiveInkEditorConfiguration: TInteractiveInkEditorConfiguration = {\n  server: DefaultRecognizerWebSocketConfiguration.server,\n  recognition: DefaultRecognizerWebSocketConfiguration.recognition,\n  menu: DefaultMenuConfiguration,\n  rendering: DefaultIIRendererConfiguration,\n  logger: DefaultLoggerConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n\n  penStyle: DefaultStyle,\n  fontStyle: {\n    size: \"auto\",\n    weight: \"auto\",\n  },\n  gesture: DefaultGestureConfiguration,\n  snap: DefaultSnapConfiguration\n}\n\n/**\n * @group Editor\n */\nexport class InteractiveInkEditorConfiguration implements TInteractiveInkEditorConfiguration\n{\n  grabber: TGrabberConfiguration\n  logger: TLoggerConfiguration\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  menu: TMenuConfiguration\n\n  penStyle: TStyle\n  fontStyle: {\n    size: number | \"auto\"\n    weight: \"bold\" | \"normal\" | \"auto\"\n  }\n  gesture: TGestureConfiguration\n  snap: TSnapConfiguration\n\n  constructor(configuration?: PartialDeep<TInteractiveInkEditorConfiguration>)\n  {\n    const { server, recognition } =  new RecognizerWebSocketConfiguration(configuration)\n    this.recognition = recognition\n    this.server = server\n\n    this.grabber = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.grabber, configuration?.grabber)\n    this.logger = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.logger, configuration?.logger)\n    this.rendering = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.rendering, configuration?.rendering)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInteractiveInkEditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.menu = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.menu, configuration?.menu)\n    this.gesture = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.gesture, configuration?.gesture)\n    this.snap = new SnapConfiguration(configuration?.snap)\n\n    this.penStyle = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.penStyle, configuration?.penStyle)\n    this.fontStyle = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.fontStyle, configuration?.fontStyle)\n  }\n}\n","import { EditorTool, SELECTION_MARGIN } from \"../Constants\"\nimport { JIIXEdgeKind, JIIXELementType, JIIXNodeKind, IIModel, TExport, TJIIXStrokeItem } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIDecorator,\n  TIIEdge,\n  IIEdgeArc,\n  IIEdgeLine,\n  IIEdgePolyLine,\n  TIIShape,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIShapePolygon,\n  IIStroke,\n  IIRecognizedText,\n  IISymbolGroup,\n  IIText,\n  ShapeKind,\n  SymbolType,\n  TIISymbol,\n  convertPartialStrokesToOIStrokes,\n  TIIRecognized,\n  IIRecognizedLine,\n  IIRecognizedPolyLine,\n  IIRecognizedArc,\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { IISVGRenderer, SVGBuilder, TIIRendererConfiguration } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport\n{\n  IIConversionManager,\n  IIWriteManager,\n  IISelectionManager,\n  IIResizeManager,\n  IIRotationManager,\n  IITranslateManager,\n  IITextManager,\n  IIEraseManager,\n  IIDebugSVGManager,\n  IIMoveManager,\n} from \"../manager\"\nimport { RecognizedKind, IIRecognizedCircle, IIRecognizedEllipse, IIRecognizedPolygon } from \"../symbol\"\nimport { IIHistoryManager, TIIHistoryBackendChanges, TIIHistoryChanges, THistoryContext } from \"../history\"\nimport { PartialDeep, convertMillimeterToPixel, mergeDeep } from \"../utils\"\nimport { IIMenuAction, IIMenuManager, IIMenuStyle, IIMenuTool } from \"../menu\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InteractiveInkEditorConfiguration, TInteractiveInkEditorConfiguration } from \"./InteractiveInkEditorConfiguration\"\nimport { IIGestureManager } from \"../gesture\"\nimport { IISnapManager } from \"../snap\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkEditorOptions = PartialDeep<EditorOptionsBase &\n  {\n    configuration: TInteractiveInkEditorConfiguration\n  }> &\n  {\n    override?: {\n      recognizer?: RecognizerWebSocket\n      menu?: {\n        style?: IIMenuStyle\n        tool?: IIMenuTool\n        action?: IIMenuAction\n      }\n    }\n  }\n/**\n * @group Editor\n */\nexport class InteractiveInkEditor extends AbstractEditor\n{\n  #configuration: InteractiveInkEditorConfiguration\n  #model: IIModel\n  #tool: EditorTool = EditorTool.Write\n  #layerUITimer?: ReturnType<typeof setTimeout>\n  #recognizeStrokeTimer?: ReturnType<typeof setTimeout>\n\n  renderer: IISVGRenderer\n  recognizer: RecognizerWebSocket\n\n  #penStyle: TStyle\n\n  history: IIHistoryManager\n  writer: IIWriteManager\n  eraser: IIEraseManager\n  gesture: IIGestureManager\n  resizer: IIResizeManager\n  rotator: IIRotationManager\n  translator: IITranslateManager\n  converter: IIConversionManager\n  texter: IITextManager\n  selector: IISelectionManager\n  svgDebugger: IIDebugSVGManager\n  snaps: IISnapManager\n  move: IIMoveManager\n  menu: IIMenuManager\n\n  constructor(rootElement: HTMLElement, options?: TInteractiveInkEditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InteractiveInkEditorConfiguration(options?.configuration)\n    this.#penStyle = Object.assign({}, this.#configuration.penStyle)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options?.override.recognizer as unknown as typeof RecognizerWebSocket\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerWebSocket(this.#configuration)\n    }\n    this.recognizer.event.addErrorListener(this.manageError.bind(this))\n    this.recognizer.event.addExportedListener(this.event.emitExported.bind(this.event))\n    this.recognizer.event.addContentChangedListener(this.onContentChanged.bind(this))\n    this.recognizer.event.addSessionOpenedListener(this.event.emitSessionOpened.bind(this.event))\n    this.recognizer.event.addEndInitialization(this.layers.hideMessageModal.bind(this.layers))\n    this.recognizer.event.addIdleListener(this.updateLayerState.bind(this))\n\n    this.renderer = new IISVGRenderer(this.#configuration.rendering)\n\n    this.history = new IIHistoryManager(this.#configuration[\"undo-redo\"], this.event)\n\n    this.writer = new IIWriteManager(this)\n    this.eraser = new IIEraseManager(this)\n    this.selector = new IISelectionManager(this)\n    this.move = new IIMoveManager(this)\n\n    this.gesture = new IIGestureManager(this, this.#configuration.gesture)\n    this.resizer = new IIResizeManager(this)\n    this.rotator = new IIRotationManager(this)\n    this.translator = new IITranslateManager(this)\n    this.converter = new IIConversionManager(this)\n    this.texter = new IITextManager(this)\n    this.svgDebugger = new IIDebugSVGManager(this)\n    this.snaps = new IISnapManager(this, this.#configuration.snap)\n    this.menu = new IIMenuManager(this, options?.override?.menu)\n\n    this.#model = new IIModel(this.#configuration.rendering.minWidth, this.#configuration.rendering.minHeight, this.configuration.rendering.guides.gap)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.recognizer.initialized.promise\n  }\n\n  //#region Properties\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.menu.tool.update()\n    this.setCursorStyle()\n    this.unselectAll()\n\n    this.eraser.detach()\n    this.selector.detach()\n    this.move.detach()\n    this.writer.detach()\n    switch (this.#tool) {\n      case EditorTool.Erase:\n        this.eraser.attach(this.layers.rendering)\n        break\n      case EditorTool.Select:\n        this.selector.attach(this.layers.rendering)\n        break\n      case EditorTool.Move:\n        this.move.attach(this.layers.rendering)\n        break\n      default:\n        this.writer.attach(this.layers.rendering)\n        break\n    }\n    this.event.emitToolChanged(i)\n  }\n\n  get model(): IIModel\n  {\n    return this.#model\n  }\n\n  get configuration(): InteractiveInkEditorConfiguration\n  {\n    return this.#configuration\n  }\n  set renderingConfiguration(renderingConfiguration: TIIRendererConfiguration)\n  {\n    this.configuration.rendering = mergeDeep(this.configuration.rendering, renderingConfiguration)\n    const height = Math.max(this.renderer.parent.clientHeight, this.configuration.rendering.minHeight)\n    const width = Math.max(this.renderer.parent.clientWidth, this.configuration.rendering.minWidth)\n    this.renderer.resize(height, width)\n    this.model.rowHeight = this.configuration.rendering.guides.gap\n    this.history.stack.forEach(i => i.model.rowHeight = this.model.rowHeight)\n    this.event.emitUIpdated()\n  }\n  //#endregion\n\n  //#region Style\n  get penStyle(): TStyle\n  {\n    return this.#penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TStyle>)\n  {\n    this.logger.info(\"set penStyle\", { penStyle })\n    this.#penStyle = Object.assign({}, this.#penStyle, penStyle)\n  }\n  //#endregion\n\n  protected updateLayerState(idle: boolean): void\n  {\n    this.event.emitIdle(idle)\n    this.layers.updateState(idle)\n  }\n\n  updateLayerUI(timeout: number = 500): void\n  {\n    clearTimeout(this.#layerUITimer)\n    this.#layerUITimer = setTimeout(() =>\n    {\n      this.menu.update()\n      this.svgDebugger.apply()\n      this.waitForIdle()\n      this.event.emitUIpdated()\n    }, timeout)\n  }\n\n  manageError(error: Error): void\n  {\n    this.layers.showMessageError(error)\n    this.event.emitError(error)\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.#tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n      case EditorTool.Select:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.add(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n      case EditorTool.Move:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.add(\"move\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n    }\n  }\n\n  protected async onContentChanged(undoRedoContext: THistoryContext): Promise<void>\n  {\n    clearTimeout(this.#recognizeStrokeTimer)\n    this.#recognizeStrokeTimer = setTimeout(async () =>\n    {\n      await this.synchronizeStrokesWithJIIX()\n      this.updateLayerUI(0)\n      this.event.emitChanged(undoRedoContext)\n    }, 500)\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n      this.tool = EditorTool.Write\n      this.renderer.init(this.layers.rendering)\n      this.menu.render(this.layers.ui.root)\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.model.rowHeight = this.configuration.rendering.guides.gap\n      this.history.init(this.model)\n\n      if(!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n      await this.recognizer.init()\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  async changeLanguage(code: string): Promise<void>\n  {\n    try {\n      this.logger.info(\"changeLanguage\", { code })\n      this.updateLayerState(false)\n      this.configuration.recognition.lang = code\n      await this.recognizer.newSession(this.configuration)\n      this.recognizer.addStrokes(this.extractStrokesFromSymbols(this.model.symbols), false)\n      await this.synchronizeStrokesWithJIIX(true)\n      this.layers.hideLoader()\n      this.event.emitLoaded()\n    }\n    catch (error) {\n      this.logger.error(\"changeLanguage\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  protected buildShape(partialShape: PartialDeep<TIIShape>): TIIShape\n  {\n    switch (partialShape.kind) {\n      case ShapeKind.Circle:\n        return IIShapeCircle.create(partialShape as PartialDeep<IIShapeCircle>)\n      case ShapeKind.Ellipse:\n        return IIShapeEllipse.create(partialShape as PartialDeep<IIShapeEllipse>)\n      case ShapeKind.Polygon:\n        return IIShapePolygon.create(partialShape as PartialDeep<IIShapePolygon>)\n      default:\n        throw new Error(`Unable to create shape, kind: \"${ partialShape.kind }\" is unknown`)\n    }\n  }\n\n  protected buildEdge(partialEdge: PartialDeep<TIIEdge>): TIIEdge\n  {\n    switch (partialEdge.kind) {\n      case EdgeKind.Arc:\n        return IIEdgeArc.create(partialEdge as PartialDeep<IIEdgeArc>)\n      case EdgeKind.Line:\n        return IIEdgeLine.create(partialEdge as PartialDeep<IIEdgeLine>)\n      case EdgeKind.PolyEdge:\n        return IIEdgePolyLine.create(partialEdge as PartialDeep<IIEdgePolyLine>)\n      default:\n        throw new Error(`Unable to create edge, kind: \"${ partialEdge.kind }\" is unknown`)\n    }\n  }\n\n  protected buildRecognized(partialSymbol: PartialDeep<TIIRecognized>): TIIRecognized\n  {\n    switch (partialSymbol.kind) {\n      case RecognizedKind.Text:\n        return IIRecognizedText.create(partialSymbol)\n      case RecognizedKind.Arc:\n        return IIRecognizedArc.create(partialSymbol)\n      case RecognizedKind.Circle:\n        return IIRecognizedCircle.create(partialSymbol)\n      case RecognizedKind.Ellipse:\n        return IIRecognizedEllipse.create(partialSymbol)\n      case RecognizedKind.Polygone:\n        return IIRecognizedPolygon.create(partialSymbol)\n      case RecognizedKind.Line:\n        return IIRecognizedLine.create(partialSymbol)\n      case RecognizedKind.PolyEdge:\n        return IIRecognizedPolyLine.create(partialSymbol)\n      default:\n        throw new Error(`Unable to create recognized, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n    }\n  }\n\n  protected buildGroup(partialGroup: PartialDeep<IISymbolGroup>): IISymbolGroup\n  {\n    if (!partialGroup.children?.length) {\n      throw new Error(`Unable to create group, no children`)\n    }\n\n    const children = partialGroup.children.map(partialSymbol =>\n    {\n      switch (partialSymbol?.type) {\n        case SymbolType.Stroke:\n          return IIStroke.create(partialSymbol as PartialDeep<IIStroke>)\n        case SymbolType.Shape:\n          return this.buildShape(partialSymbol as PartialDeep<TIIShape>)\n        case SymbolType.Edge:\n          return this.buildEdge(partialSymbol as PartialDeep<TIIEdge>)\n        case SymbolType.Text:\n          return IIText.create(partialSymbol as PartialDeep<IIText>)\n        case SymbolType.Group:\n          return this.buildGroup(partialSymbol as PartialDeep<IISymbolGroup>)\n        case SymbolType.Recognized:\n          return this.buildRecognized(partialSymbol as PartialDeep<TIIRecognized>)\n        default:\n          throw new Error(`Unable to create group, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n      }\n    })\n    const group = new IISymbolGroup(children, partialGroup.style)\n    if (partialGroup.id) {\n      group.id = partialGroup.id\n    }\n    if (partialGroup.decorators) {\n      group.decorators = partialGroup.decorators.map(d => new IIDecorator(d!.kind!, d!.style as TStyle))\n    }\n    return group\n  }\n\n  protected buildStroke(partialSymbol: PartialDeep<IIStroke>): IIStroke\n  {\n    return IIStroke.create(partialSymbol as PartialDeep<IIStroke>)\n  }\n\n  protected buildStrokeText(partialSymbol: PartialDeep<IIRecognizedText>): IIRecognizedText\n  {\n    return IIRecognizedText.create(partialSymbol as PartialDeep<IIRecognizedText>)\n  }\n\n  protected buildText(partialSymbol: PartialDeep<IIText>): IIText\n  {\n    return IIText.create(partialSymbol as PartialDeep<IIText>)\n  }\n\n  protected buildSymbol(partialSymbol: PartialDeep<TIISymbol>): TIISymbol\n  {\n    try {\n      switch (partialSymbol.type) {\n        case SymbolType.Stroke:\n          return this.buildStroke(partialSymbol)\n        case SymbolType.Shape:\n          return this.buildShape(partialSymbol)\n        case SymbolType.Edge:\n          return this.buildEdge(partialSymbol)\n        case SymbolType.Text:\n          return this.buildText(partialSymbol)\n        case SymbolType.Group:\n          return this.buildGroup(partialSymbol)\n        case SymbolType.Recognized:\n          return this.buildRecognized(partialSymbol as PartialDeep<TIIRecognized>)\n        default:\n          throw new Error(`Unable to build symbol, type: \"${ partialSymbol.type }\" is unknown`)\n      }\n    }\n    catch (error) {\n      this.logger.error(\"createSymbol\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n  }\n\n  async createSymbol(partialSymbol: PartialDeep<TIISymbol>): Promise<TIISymbol>\n  {\n    try {\n      return await this.addSymbol(this.buildSymbol(partialSymbol))\n    }\n    catch (error) {\n      this.logger.error(\"createSymbol\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  async createSymbols(partialSymbols: PartialDeep<TIISymbol>[]): Promise<TIISymbol[]>\n  {\n    try {\n      const errors: string[] = []\n      const symbols: TIISymbol[] = []\n      partialSymbols.forEach(partialSymbol =>\n      {\n        try {\n          symbols.push(this.buildSymbol(partialSymbol))\n        } catch (error) {\n          errors.push(((error as Error).message || error) as string)\n        }\n      })\n      if (errors.length) {\n        throw new Error(errors.join(\"\\n\"))\n      }\n      return await this.addSymbols(symbols)\n    } catch (error) {\n      this.logger.error(\"createSymbols\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n  }\n\n  /** @hidden */\n  protected updateTextBounds(symbol: TIISymbol): void\n  {\n    if (symbol.type === SymbolType.Text) {\n      this.texter.updateBounds(symbol)\n    }\n    else if (symbol.type === SymbolType.Group) {\n      symbol.extractText().forEach(t => this.texter.updateBounds(t))\n    }\n  }\n\n  /** @hidden */\n  async addSymbol(sym: TIISymbol, addToHistory = true): Promise<TIISymbol>\n  {\n    this.logger.info(\"addSymbol\", { sym })\n    this.updateLayerState(false)\n    this.updateTextBounds(sym)\n    this.model.addSymbol(sym)\n    this.renderer.drawSymbol(sym)\n\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.addStrokes(strokes, false)\n\n    if (addToHistory) {\n      this.history.push(this.model, { added: [sym] })\n    }\n    this.updateLayerUI()\n    return sym\n  }\n\n  /** @hidden */\n  async addSymbols(symList: TIISymbol[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"addSymbol\", { symList })\n    this.updateLayerState(false)\n    symList.forEach(s =>\n    {\n      this.updateTextBounds(s)\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.addStrokes(strokes, false)\n    if (addToHistory) {\n      this.history.push(this.model, { added: symList })\n    }\n    this.updateLayerUI()\n    return symList\n  }\n\n  async updateSymbol(sym: TIISymbol, addToHistory = true): Promise<TIISymbol>\n  {\n    this.logger.info(\"updateSymbol\", { sym })\n    this.updateLayerState(false)\n    this.updateTextBounds(sym)\n    this.model.updateSymbol(sym)\n    this.renderer.drawSymbol(sym)\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: [sym] })\n    }\n    this.updateLayerUI()\n    return sym\n  }\n\n  async updateSymbols(symList: TIISymbol[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"updateSymbol\", { symList })\n    this.updateLayerState(false)\n    symList.forEach(s =>\n    {\n      this.updateTextBounds(s)\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: symList })\n    }\n    this.updateLayerUI()\n    return symList\n  }\n\n  updateSymbolsStyle(symbolIds: string[], style: PartialDeep<TStyle>, addToHistory = true): void\n  {\n    this.logger.info(\"updateSymbolsStyle\", { symbolIds, style })\n    const symbols: TIISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (symbolIds.includes(s.id)) {\n        s.style = Object.assign({}, s.style, style)\n        if (\n          SymbolType.Text === s.type ||\n          SymbolType.Group === s.type ||\n          SymbolType.Recognized === s.type) {\n          s.updateChildrenStyle()\n        }\n        this.renderer.drawSymbol(s)\n        this.model.updateSymbol(s)\n        s.modificationDate = Date.now()\n        symbols.push(s)\n      }\n    })\n    if (symbols.length) {\n      symbols.forEach(s =>\n      {\n        if (s.type === SymbolType.Text) {\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            this.texter.moveTextAfter(s, tx)\n          }\n        }\n      })\n    }\n    if (addToHistory && symbols.length) {\n      this.history.push(this.model, { style: { symbols, style } })\n    }\n  }\n\n  updateTextFontStyle(textIds: string[], { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" | \"auto\" }): void\n  {\n    this.logger.info(\"updateTextFontStyle\", { textIds, fontSize, fontWeight })\n    const symbols: (IIText | IISymbolGroup)[] = []\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (textIds.includes(s.id)) {\n        if (s.type === SymbolType.Text) {\n          s.updateChildrenFont({ fontSize, fontWeight: fontWeight === \"auto\" ? undefined : fontWeight })\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          this.renderer.drawSymbol(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            const symbolsTranslated = this.texter.moveTextAfter(s, tx)\n            if (symbolsTranslated?.length) {\n              translate.push({\n                symbols: symbolsTranslated,\n                tx,\n                ty: 0\n              })\n            }\n          }\n          s.modificationDate = Date.now()\n          symbols.push(s)\n        }\n        else if (s.type === SymbolType.Group) {\n          const textChildren = s.extractText()\n          if (textChildren.length) {\n            textChildren.forEach(text =>\n            {\n              text.updateChildrenFont({ fontSize, fontWeight: fontWeight === \"auto\" ? undefined : fontWeight })\n              const lastWidth = s.bounds.width\n              this.texter.updateBounds(text)\n              const tx = s.bounds.width - lastWidth\n              const symbolsTranslated = this.texter.moveTextAfter(text, tx)\n              if (symbolsTranslated?.length) {\n                translate.push({\n                  symbols: symbolsTranslated,\n                  tx,\n                  ty: 0\n                })\n              }\n            })\n            s.modificationDate = Date.now()\n            this.renderer.drawSymbol(s)\n            symbols.push(s)\n          }\n\n        }\n      }\n    })\n    if (symbols.length) {\n      this.history.push(this.model, { style: { symbols, fontSize }, translate })\n    }\n  }\n\n  async replaceSymbols(oldSymbols: TIISymbol[], newSymbols: TIISymbol[], addToHistory = true): Promise<void>\n  {\n    this.logger.info(\"replaceSymbol\", { oldSymbols, newSymbols })\n    this.updateLayerState(false)\n\n    const oldStrokes = this.extractStrokesFromSymbols(oldSymbols)\n    const newStrokes = this.extractStrokesFromSymbols(newSymbols)\n\n    const symToReplace = oldSymbols.shift()\n\n    if (symToReplace) {\n      oldSymbols.forEach(s =>\n      {\n        this.renderer.removeSymbol(s.id)\n        this.model.removeSymbol(s.id)\n      })\n\n      this.model.replaceSymbol(symToReplace.id, newSymbols)\n      this.renderer.replaceSymbol(symToReplace.id, newSymbols)\n\n\n      if (oldStrokes.length && newStrokes.length) {\n        this.recognizer.replaceStrokes(oldStrokes.map(s => s.id), newStrokes)\n      }\n      else if (oldStrokes.length) {\n        this.recognizer.eraseStrokes(oldStrokes.map(s => s.id))\n      }\n      else {\n        this.recognizer.addStrokes(newStrokes, false)\n      }\n\n      if (addToHistory) {\n        this.history.push(this.model, { replaced: { oldSymbols, newSymbols } })\n      }\n      this.updateLayerUI()\n    }\n  }\n\n  changeOrderSymbol(symbol: TIISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void\n  {\n    this.model.changeOrderSymbol(symbol.id, position)\n    this.renderer.changeOrderSymbol(symbol, position)\n    this.history.push(this.model, { order: { symbols: [symbol], position } })\n  }\n\n  changeOrderSymbols(symbols: TIISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    symbols.forEach(s =>\n    {\n      this.model.changeOrderSymbol(s.id, position)\n      this.renderer.changeOrderSymbol(s, position)\n    })\n    this.history.push(this.model, { order: { symbols, position } })\n  }\n\n  groupSymbols(symbols: TIISymbol[]): IISymbolGroup\n  {\n    const group = this.buildGroup({ children: symbols })\n    symbols.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n    this.model.addSymbol(group)\n    this.history.push(this.model, { group: { symbols } })\n    return group\n  }\n\n  ungroupSymbol(group: IISymbolGroup): TIISymbol[]\n  {\n    group.children.forEach(s => this.renderer.drawSymbol(s))\n    this.renderer.removeSymbol(group.id)\n    this.model.replaceSymbol(group.id, group.children)\n    this.history.push(this.model, { ungroup: { group } })\n    return group.children\n  }\n\n  async synchronizeStrokesWithJIIX(force: boolean = false): Promise<void>\n  {\n    //if there is no stroke, jiix should not have changed\n    const strokes = this.model.symbols.filter(s => s.type === SymbolType.Stroke)\n    if (!force && !strokes.length) {\n      this.event.emitSynchronized()\n      return\n    }\n    await this.export([\"application/vnd.myscript.jiix\"])\n\n    const getSymbolsAndStrokesAssociatedFromJIIXStrokeItems = (items: TJIIXStrokeItem[] = []): { symbols: TIISymbol[], strokes: IIStroke[] } =>\n    {\n      const symbols: TIISymbol[] = []\n      const strokes: IIStroke[] = []\n      const strokeIdsUsed: string[] = []\n      items.forEach(i =>\n      {\n        const strokeId = i[\"full-id\"]!\n        if (strokeIdsUsed.includes(strokeId)) {\n          return\n        }\n        strokeIdsUsed.push(strokeId)\n        const sym = this.model.getRootSymbol(strokeId)\n        if (sym) {\n          switch (sym?.type) {\n            // we do not modify a group created by the user\n            // case SymbolType.Group:\n            //   strokes.push(...sym.extractStrokes())\n            //   break\n            case SymbolType.Recognized:\n              // if it's recognized symbol with same number of strokes\n              // the recognition has been already done\n              // if (sym.strokes.length === items.length) {\n              //   return\n              // }\n              strokes.push(sym.strokes.find(s => s.id === i[\"full-id\"]!)!)\n              break\n            default:\n              strokes.push(sym as IIStroke)\n              break\n          }\n          const symIdx = symbols.findIndex(s => s.id === sym.id)\n          if (symIdx < 0) {\n            symbols.push(sym)\n          }\n          else {\n            symbols[symIdx] = sym\n          }\n        }\n      })\n      return {\n        symbols,\n        strokes\n      }\n    }\n\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    jiix?.elements?.forEach(el =>\n    {\n      switch (el.type) {\n        case JIIXELementType.Text: {\n          el.words?.forEach(w =>\n          {\n            const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(w.items)\n            if (jiixAssociation.strokes.length) {\n              if (jiixAssociation.symbols.length === 1) {\n                const symAsso = jiixAssociation.symbols[0]\n                if (\n                  symAsso.type === SymbolType.Recognized && symAsso.kind === RecognizedKind.Text &&\n                  symAsso.label === w.label &&\n                  symAsso.strokes.length === symAsso.strokes.length\n                ) {\n                  return\n                }\n              }\n              const line = el.lines!.find(l => l[\"first-char\"]! <= w[\"first-char\"]! && l[\"last-char\"]! >= w[\"last-char\"]!)!\n              const recognizedText = new IIRecognizedText(jiixAssociation.strokes, { baseline: convertMillimeterToPixel(line[\"baseline-y\"]), xHeight: convertMillimeterToPixel(line[\"x-height\"]) })\n              recognizedText.label = w.label\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                if (sym.type === SymbolType.Recognized && sym.kind === RecognizedKind.Text) {\n                  sym.decorators.forEach(d =>\n                  {\n                    if (!recognizedText.decorators.some(wd => wd.kind === d.kind)) {\n                      recognizedText.decorators.push(d)\n                    }\n                  })\n                }\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(recognizedText)\n              this.renderer.drawSymbol(recognizedText)\n            }\n          })\n          break\n        }\n        case JIIXELementType.Node: {\n          let symbolRecognized: TIIRecognized | undefined\n          const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(el.items)\n          if (jiixAssociation.strokes.length) {\n            if (jiixAssociation.symbols.length === 1) {\n              const symAsso = jiixAssociation.symbols[0]\n              if (symAsso.type === SymbolType.Recognized &&\n                symAsso.strokes.length === jiixAssociation.strokes.length) {\n                return\n              }\n            }\n            switch (el.kind) {\n              case JIIXNodeKind.Circle: {\n                symbolRecognized = new IIRecognizedCircle(jiixAssociation.strokes)\n                break\n              }\n              case JIIXNodeKind.Ellipse: {\n                symbolRecognized = new IIRecognizedEllipse(jiixAssociation.strokes)\n                break\n              }\n              case JIIXNodeKind.Rectangle:\n              case JIIXNodeKind.Triangle:\n              case JIIXNodeKind.Parallelogram:\n              case JIIXNodeKind.Polygon:\n              case JIIXNodeKind.Rhombus: {\n                symbolRecognized = new IIRecognizedPolygon(jiixAssociation.strokes)\n                break\n              }\n              default:\n                this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized shape symbol, kind unknow: ${ el }`)\n                break\n            }\n            if (symbolRecognized) {\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(symbolRecognized)\n              this.renderer.drawSymbol(symbolRecognized)\n            }\n          }\n          break\n        }\n        case JIIXELementType.Edge: {\n          let symbolRecognized: TIIRecognized | undefined\n          const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(el.kind === JIIXEdgeKind.PolyEdge ? el.edges.flatMap(e => e.items!) : el.items)\n          if (jiixAssociation.strokes.length) {\n            if (jiixAssociation.symbols.length === 1) {\n              const symAsso = jiixAssociation.symbols[0]\n              if (symAsso.type === SymbolType.Recognized &&\n                symAsso.strokes.length === jiixAssociation.strokes.length) {\n                return\n              }\n            }\n            switch (el.kind) {\n              case JIIXEdgeKind.Line: {\n                symbolRecognized = new IIRecognizedLine(jiixAssociation.strokes)\n                break\n              }\n              case JIIXEdgeKind.PolyEdge: {\n                symbolRecognized = new IIRecognizedPolyLine(jiixAssociation.strokes)\n                break\n              }\n              case JIIXEdgeKind.Arc: {\n                symbolRecognized = new IIRecognizedArc(jiixAssociation.strokes)\n                break\n              }\n              default:\n                this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized edge symbol, kind unknow: ${ el }`)\n                break\n            }\n            if (symbolRecognized) {\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(symbolRecognized)\n              this.renderer.drawSymbol(symbolRecognized)\n            }\n          }\n          break\n        }\n        default:\n          this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized symbol, type unknow: ${ el }`)\n          break\n      }\n    })\n    // because model.export is emptied when you change symbols\n    this.model.mergeExport({ \"application/vnd.myscript.jiix\": jiix })\n    this.history.update(this.model)\n    this.event.emitSynchronized()\n  }\n\n  async removeSymbol(id: string, addToHistory = true): Promise<void>\n  {\n    this.logger.info(\"removeSymbol\", { id })\n    const symbol = this.model.getRootSymbol(id)\n    if (symbol) {\n      this.updateLayerState(false)\n      if (symbol.type === SymbolType.Group) {\n        const groupStrokeIds = symbol.extractStrokes().map(s => s.id)\n        symbol.removeChilds([id])\n        if (symbol.children.length) {\n          this.model.updateSymbol(symbol)\n          this.renderer.drawSymbol(symbol)\n          if (groupStrokeIds.includes(id)) {\n            this.recognizer.eraseStrokes([id])\n          }\n        }\n        else {\n          this.recognizer.eraseStrokes(groupStrokeIds)\n          this.model.removeSymbol(symbol.id)\n          this.renderer.removeSymbol(symbol.id)\n        }\n      }\n      else {\n        this.recognizer.eraseStrokes([id])\n        this.model.removeSymbol(symbol.id)\n        this.renderer.removeSymbol(symbol.id)\n      }\n      if (addToHistory) {\n        this.history.push(this.model, { erased: [symbol] })\n      }\n      this.updateLayerUI()\n    }\n    else {\n      this.renderer.removeSymbol(id)\n      this.recognizer.eraseStrokes([id])\n    }\n  }\n\n  async removeSymbols(ids: string[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"removeSymbol\", { ids })\n    const symbolsToRemove: TIISymbol[] = []\n    const symbolsToUpdate: TIISymbol[] = []\n    const strokesIds: string[] = []\n    ids.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym) {\n        /** we remove root element */\n        if (sym.id === id) {\n          symbolsToRemove.push(sym)\n          switch (sym.type) {\n            case SymbolType.Stroke:\n              strokesIds.push(sym.id)\n              break\n            case SymbolType.Recognized:\n              strokesIds.push(...sym.strokes.map(s => s.id))\n              break\n            case SymbolType.Group:\n              strokesIds.push(...sym.extractStrokes().map(s => s.id))\n              break\n          }\n        }\n        else {\n          /** we want to remove child */\n          switch (sym.type) {\n            case SymbolType.Group: {\n              const gr = sym.clone()\n              strokesIds.push(...gr.extractStrokes().map(s => s.id).filter(id => ids.includes(id)))\n              gr.removeChilds(ids)\n              if (gr.children.length) {\n                symbolsToUpdate.push(gr)\n              }\n              else {\n                symbolsToRemove.push(gr)\n              }\n              break\n            }\n            case SymbolType.Recognized: {\n              strokesIds.push(id)\n              const ws = sym.clone()\n              ws.removeStrokes(ids)\n              if (ws.strokes.length) {\n                symbolsToUpdate.push(ws)\n              }\n              else {\n                symbolsToRemove.push(ws)\n              }\n              break\n            }\n          }\n\n        }\n      }\n    })\n    this.recognizer.eraseStrokes(strokesIds)\n    symbolsToRemove.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n\n    symbolsToUpdate.forEach(s =>\n    {\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n\n\n    if (addToHistory) {\n      const changes: TIIHistoryChanges = {}\n      if (symbolsToRemove.length || symbolsToUpdate.length) {\n        if (symbolsToRemove.length) {\n          changes.erased = symbolsToRemove\n        }\n        if (symbolsToUpdate.length) {\n          changes.updated = symbolsToUpdate\n        }\n        this.history.push(this.model, changes)\n        this.updateLayerUI()\n      }\n    }\n    this.updateLayerState(false)\n    return symbolsToRemove\n  }\n\n  select(ids: string[]): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = ids.includes(s.id)\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.updateLayerUI()\n    this.event.emitSelected(this.model.symbolsSelected)\n  }\n\n  selectAll(): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = true\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.updateLayerUI()\n    this.event.emitSelected(this.model.symbolsSelected)\n  }\n\n  unselectAll(): void\n  {\n    if (this.model.symbolsSelected.length) {\n      this.model.symbolsSelected.forEach(s =>\n      {\n        s.selected = false\n        this.renderer.drawSymbol(s)\n      })\n      this.selector.removeSelectedGroup()\n      this.updateLayerUI()\n      this.event.emitSelected(this.model.symbolsSelected)\n    }\n  }\n\n  async importPointEvents(partialStrokes: PartialDeep<IIStroke>[]): Promise<IIModel>\n  {\n    this.logger.info(\"importPointEvents\", { partialStrokes })\n    this.updateLayerState(false)\n    const strokes = convertPartialStrokesToOIStrokes(partialStrokes)\n    strokes.forEach(s =>\n    {\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    this.recognizer.addStrokes(strokes, false)\n    this.history.push(this.model, { added: strokes })\n    this.logger.debug(\"importPointEvents\", this.model)\n    this.updateLayerUI()\n    this.event.emitImported(this.model.exports as TExport)\n    return this.model\n  }\n\n  protected triggerDownload(fileName: string, urlData: string): void\n  {\n    const downloadAnchorNode = document.createElement(\"a\")\n    downloadAnchorNode.setAttribute(\"href\", urlData)\n    downloadAnchorNode.setAttribute(\"download\", fileName)\n    document.body.appendChild(downloadAnchorNode)\n    downloadAnchorNode.click()\n    downloadAnchorNode.remove()\n  }\n\n  getSymbolsBounds(symbols: TIISymbol[], margin: number = SELECTION_MARGIN): Box\n  {\n    const box = Box.createFromBoxes(symbols.map(s => s.bounds))\n    box.x -= margin\n    box.y -= margin\n    box.width += margin * 2\n    box.height += margin * 2\n    return box\n  }\n\n  protected buildBlobFromSymbols(symbols: TIISymbol[], box: Box): Blob\n  {\n    const svgNode = SVGBuilder.createLayer(box)\n    symbols.forEach(s =>\n    {\n      const el = this.renderer.getElementById(s.id)?.cloneNode(true)\n      if (el) {\n        svgNode.appendChild(el)\n      }\n    })\n\n    const svgString = (new XMLSerializer()).serializeToString(svgNode)\n\n    return new Blob([svgString], {\n      type: \"image/svg+xml;charset=utf-8\"\n    })\n  }\n\n  protected getExportName(extension: string): string\n  {\n    const options: Intl.DateTimeFormatOptions = { year: \"numeric\", month: \"numeric\", day: \"numeric\", hour: \"2-digit\", minute: \"2-digit\", second: \"2-digit\" }\n    try {\n      return `iink-ts-${ new Date().toLocaleDateString(navigator.language, options) }.${ extension }`\n    }\n    catch {\n      return `iink-ts-${ new Date().toLocaleDateString(\"en-US\", options) }.${ extension }`\n    }\n  }\n\n  downloadAsSVG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n    const url = URL.createObjectURL(svgBlob)\n    this.triggerDownload(this.getExportName(\"svg\"), url)\n  }\n\n  downloadAsPNG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n\n    const url = URL.createObjectURL(svgBlob)\n    const image = new Image(box.width, box.height)\n    image.src = url\n    image.onload = () =>\n    {\n      const canvas = document.createElement(\"canvas\")\n      canvas.width = image.width\n      canvas.height = image.height\n\n      const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D\n      ctx.drawImage(image, 0, 0)\n      URL.revokeObjectURL(url)\n\n      const imgURI = canvas\n        .toDataURL(\"image/png\")\n        .replace(\"image/png\", \"image/octet-stream\")\n\n      this.triggerDownload(this.getExportName(\"png\"), imgURI)\n    }\n  }\n\n  downloadAsJson(selection = false)\n  {\n    const symbolsToExport = selection ? this.model.symbolsSelected : this.model.symbols\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(symbolsToExport, null, 2))\n    this.triggerDownload(this.getExportName(\"json\"), dataStr)\n  }\n\n  extractStrokesFromSymbols(symbols: TIISymbol[] | undefined): IIStroke[]\n  {\n    if (!symbols?.length) return []\n    const strokes: IIStroke[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break\n        case SymbolType.Recognized:\n          strokes.push(...s.strokes)\n          break\n        case SymbolType.Group:\n          strokes.push(...s.extractStrokes())\n          break\n      }\n    })\n    return strokes\n  }\n\n  extractTextsFromSymbols(symbols: TIISymbol[] | undefined): IIText[]\n  {\n    if (!symbols?.length) return []\n    const texts: IIText[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Text:\n          texts.push(s)\n          break\n        case SymbolType.Group:\n          texts.push(...s.extractText())\n          break\n      }\n    })\n    return texts\n  }\n\n  protected extractBackendChanges(changes: TIIHistoryChanges): TIIHistoryBackendChanges\n  {\n    const backendChanges: TIIHistoryBackendChanges = {}\n    backendChanges.added = this.extractStrokesFromSymbols(changes.added)\n    backendChanges.erased = this.extractStrokesFromSymbols(changes.erased)\n\n    const updated = this.extractStrokesFromSymbols(changes.updated)\n\n    const oldStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.oldSymbols))\n    const newStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.newSymbols))\n    if (oldStrokes.length && newStrokes.length) {\n      backendChanges.replaced = {\n        oldStrokes,\n        newStrokes\n      }\n    }\n    else {\n      backendChanges.added.push(...newStrokes)\n      backendChanges.erased.push(...oldStrokes)\n    }\n\n    if (changes.matrix) {\n      backendChanges.matrix = {\n        strokes: this.extractStrokesFromSymbols(changes.matrix.symbols),\n        matrix: changes.matrix.matrix,\n      }\n    }\n\n    if (changes.translate?.length) {\n      backendChanges.translate = []\n      changes.translate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.translate!.push({\n            strokes,\n            tx: tr.tx,\n            ty: tr.ty\n          })\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      backendChanges.scale = []\n      changes.scale.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.scale!.push({\n            strokes,\n            origin: tr.origin,\n            scaleX: tr.scaleX,\n            scaleY: tr.scaleY\n          })\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      backendChanges.rotate = []\n      changes.rotate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.rotate!.push({\n            strokes,\n            center: tr.center,\n            angle: tr.angle\n          })\n        }\n      })\n    }\n    return backendChanges\n  }\n\n  async undo(): Promise<IIModel>\n  {\n    this.logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.updateLayerState(false)\n      this.unselectAll()\n      const previousStackItem = this.history.undo()\n      const modifications = previousStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = previousStackItem.model.clone()\n      this.logger.debug(\"undo\", { previousStackItem })\n      const actionsToBackend = this.extractBackendChanges(previousStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.undo(actionsToBackend)\n      }\n      this.updateLayerUI()\n    }\n    return this.model\n  }\n\n  async redo(): Promise<IIModel>\n  {\n    this.logger.info(\"redo\")\n\n    if (this.history.context.canRedo) {\n      this.updateLayerState(false)\n      this.unselectAll()\n      const nextStackItem = this.history.redo()\n      const modifications = nextStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = nextStackItem.model.clone()\n      this.logger.debug(\"redo\", { modifications })\n      const actionsToBackend = this.extractBackendChanges(nextStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.redo(actionsToBackend)\n      }\n\n      this.updateLayerUI()\n    }\n    return this.model\n  }\n\n  async export(mimeTypes?: string[]): Promise<IIModel>\n  {\n    try {\n      this.logger.info(\"export\", { mimeTypes })\n      const exports = await this.recognizer.export(mimeTypes)\n      this.model.mergeExport(exports as TExport)\n    }\n    catch (error) {\n      this.logger.error(\"export\", { error })\n      this.manageError(error as Error)\n      throw error\n    }\n    return this.model\n  }\n\n  async convert(): Promise<void>\n  {\n    await this.convertSymbols()\n  }\n\n  async convertSymbols(symbols?: TIISymbol[]): Promise<void>\n  {\n    try {\n      this.updateLayerState(false)\n      await this.converter.apply(symbols)\n      this.event.emitConverted(this.model.converts as TExport)\n    }\n    catch (error) {\n      this.logger.error(\"convert\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    try {\n      this.logger.info(\"resize\", { height, width })\n      const compStyles = window.getComputedStyle(this.layers.root)\n      height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n      width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n\n      this.updateLayerState(false)\n      this.model.height = height\n      this.model.width = width\n      this.renderer.resize(height, width)\n      this.updateLayerUI(50)\n      this.updateLayerState(true)\n    } catch (error) {\n      this.manageError(error as Error)\n    }\n  }\n\n  async clear(): Promise<void>\n  {\n    try {\n      this.logger.info(\"clear\")\n      this.updateLayerState(false)\n      if (this.model.symbols.length) {\n        this.selector.removeSelectedGroup()\n        const erased = this.model.symbols\n        this.renderer.clear()\n        this.model.clear()\n        this.history.push(this.model, { erased })\n        this.recognizer.clear()\n        this.event.emitSelected(this.model.symbolsSelected)\n      }\n      this.updateLayerUI()\n      this.event.emitCleared()\n    } catch (error) {\n      this.manageError(error as Error)\n    }\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.eraser.detach()\n    this.selector.detach()\n    this.move.detach()\n    this.writer.detach()\n\n    this.renderer.destroy()\n    this.menu.destroy()\n    this.recognizer.destroy()\n    this.model.clear()\n    this.history.clear()\n    return Promise.resolve()\n  }\n}\n","/**\n * @group Editor\n * @remarks\n * Configure when the action is triggered.\n *\n * POINTER_UP :   Action is triggered on every PenUP.\n *                This is the recommended mode for CDK V3 WebSocket recognitions.\n *\n * QUIET_PERIOD : Action is triggered after a quiet period in milli-seconds on every pointer up.\n *                The value is set to 1000 for example recognition will be triggered when the user stops writing for 1 seconds.\n *                This is the recommended mode for all REST discoveries.\n *\n * DEMAND :       Action is triggered on external demande\n */\n export type TEditorTriggerConfiguration = {\n  exportContent: \"QUIET_PERIOD\" | \"POINTER_UP\" | \"DEMAND\"\n  exportContentDelay: number\n  resizeTriggerDelay: number\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultEditorTriggerConfiguration: TEditorTriggerConfiguration = {\n  exportContent: \"POINTER_UP\",\n  exportContentDelay: 1000,\n  resizeTriggerDelay: 100\n}\n","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerHTTPV1Configuration, RecognizerHTTPV1Configuration, TRecognitionHTTPV1Configuration, TRecognizerHTTPV1Configuration, TServerHTTPConfiguration } from \"../recognizer\"\nimport { DefaultRendererConfiguration, TRendererConfiguration } from \"../renderer\"\nimport { DefaultTheme, TPenStyle, TTheme } from \"../style\"\nimport { mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaultEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n\n/**\n * @group Editor\n */\nexport type TInkEditorDeprecatedConfiguration = TEditorConfiguration & TRecognizerHTTPV1Configuration & {\n  rendering: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle,\n  penStyleClasses?: string\n  theme: TTheme\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInkEditorDeprecatedConfiguration: TInkEditorDeprecatedConfiguration = {\n  server: DefaultRecognizerHTTPV1Configuration.server,\n  recognition: DefaultRecognizerHTTPV1Configuration.recognition,\n  rendering: DefaultRendererConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaultEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: {},\n  theme: DefaultTheme\n}\n\n/**\n * @group Editor\n */\nexport class InkEditorDeprecatedConfiguration implements TInkEditorDeprecatedConfiguration\n{\n  server: TServerHTTPConfiguration\n  recognition: TRecognitionHTTPV1Configuration\n  rendering: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle\n  penStyleClasses?: string\n  theme: TTheme\n\n  constructor(configuration?: PartialDeep<TInkEditorDeprecatedConfiguration>)\n  {\n    const { server, recognition } = new RecognizerHTTPV1Configuration(configuration)\n    this.server = server\n    this.recognition = recognition\n    this.rendering = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.rendering, configuration?.rendering)\n    this.grabber = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.grabber, configuration?.grabber)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.triggers = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.penStyle, configuration?.penStyle)\n    this.penStyleClasses = configuration?.penStyleClasses || this.penStyleClasses\n    this.theme = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.theme, configuration?.theme)\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { Model, TExport } from \"../model\"\nimport { Stroke, TStroke, TPointer } from \"../symbol\"\nimport { RecognizerHTTPV1, TConverstionState } from \"../recognizer\"\nimport { CanvasRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InkEditorDeprecatedConfiguration, TInkEditorDeprecatedConfiguration } from \"./InkEditorDeprecatedConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInkEditorDeprecatedOptions = PartialDeep<EditorOptionsBase &\n{\n  configuration: TInkEditorDeprecatedConfiguration\n}> &\n{\n  override?: {\n    grabber?: PointerEventGrabber\n    recognizer?: RecognizerHTTPV1\n  }\n}\n\n/**\n * @group Editor\n * @deprecated Use {@link InkEditor} instead.\n */\nexport class InkEditorDeprecated extends AbstractEditor\n{\n  #configuration: InkEditorDeprecatedConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n  #exportTimer?: ReturnType<typeof setTimeout>\n\n  grabber: PointerEventGrabber\n  renderer: CanvasRenderer\n  recognizer: RecognizerHTTPV1\n  history: HistoryManager\n  styleManager: StyleManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInkEditorDeprecatedOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InkEditorDeprecatedConfiguration(options?.configuration)\n    this.styleManager = new StyleManager(options?.configuration?.penStyle, options?.configuration?.theme)\n\n    if (options?.override?.grabber) {\n      const CustomGrabber = options.override.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerHTTPV1\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerHTTPV1(this.#configuration)\n    }\n    this.renderer = new CanvasRenderer(this.#configuration.rendering)\n\n    this.tool = EditorTool.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  protected onPointerDown(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerDown\", { tool: this.tool, info })\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.initCurrentStroke(info.pointer, info.pointerType, style)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerDown\", `onPointerDown tool unknow: \"${ this.tool }\"`)\n        break\n    }\n  }\n\n  protected onPointerMove(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerMove\", { tool: this.tool, info })\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.appendToCurrentStroke(info.pointer)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerMove\", `onPointerMove tool unknow: \"${ this.tool }\"`)\n        break\n    }\n  }\n\n  protected async onPointerUp(info: PointerInfo): Promise<void>\n  {\n    try {\n      this.logger.info(\"onPointerUp\", { tool: this.tool, info })\n      switch (this.tool) {\n        case EditorTool.Erase:\n          this.model.removeStrokesFromPoint(info.pointer)\n          if (this.history.stack.at(-1)?.modificationDate !== this.model.modificationDate) {\n            await this.updateModelRendering()\n          }\n          break\n        case EditorTool.Write:\n          this.model.endCurrentStroke(info.pointer)\n          await this.updateModelRendering()\n          break\n        default:\n          this.logger.warn(\"#onPointerUp\", `onPointerUp tool unknow: \"${ this.tool }\"`)\n          break\n      }\n    } catch (error) {\n      this.layers.showMessageError(error as Error)\n      this.event.emitError(error as Error)\n      throw error\n    }\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return Promise.resolve()\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.setCursorStyle()\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  set penStyle(penStyle: TPenStyle | undefined)\n  {\n    this.logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  set penStyleClasses(penStyleClasses: string | undefined)\n  {\n    this.logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    this.styleManager.setPenStyleClasses(penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n  }\n\n  get configuration(): InkEditorDeprecatedConfiguration\n  {\n    return this.#configuration\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.history.push(this.model)\n      this.layers.rendering.classList.add(this.configuration.recognition.type.toLowerCase().replace(\" \", \"-\"))\n      this.renderer.init(this.layers.rendering, { x: 50, y: 50 })\n      this.grabber.attach(this.layers.rendering)\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    this.renderer.drawPendingStroke(this.model.currentSymbol)\n  }\n\n  async updateModelRendering(): Promise<Model>\n  {\n    this.logger.info(\"updateModelRendering\")\n    this.renderer.drawModel(this.model)\n    const deferred = new DeferredPromise<Model>()\n    this.history.push(this.model)\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      let currentModel = this.model.clone()\n      this.#exportTimer = setTimeout(async () =>\n      {\n        try {\n          currentModel = await this.recognizer.export(currentModel)\n          this.history.updateStack(currentModel)\n          if (this.model.modificationDate === currentModel.modificationDate) {\n            this.model.exports = currentModel.exports\n          }\n          deferred.resolve(this.model)\n        } catch (error) {\n          this.logger.error(\"updateModelRendering\", { error })\n          this.event.emitError(error as Error)\n          deferred.reject(error as Error)\n        }\n      }, this.#configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.#configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve(this.model)\n    }\n    await deferred.promise\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"updateModelRendering\", this.model.exports)\n    return deferred.promise\n  }\n\n  async export(mimeTypes?: string[]): Promise<Model>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    const newModel = await this.recognizer.export(this.model.clone(), mimeTypes)\n    if (this.model.modificationDate === newModel.modificationDate) {\n      this.model.mergeExport(newModel.exports as TExport)\n    }\n    this.history.updateStack(newModel)\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"export\", this.model)\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState, mimeTypes?: string[] }): Promise<Model>\n  {\n    this.logger.info(\"convert\", { params })\n    const newModel = await this.recognizer.convert(this.model, params?.conversionState, params?.mimeTypes)\n    Object.assign(this.#model, newModel)\n    this.event.emitConverted(this.model.converts as TExport)\n    this.logger.debug(\"convert\", this.model)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<Model>\n  {\n    const errors: string[] = []\n    strokes.forEach((s, strokeIndex) =>\n    {\n      let flag = true\n      const stroke = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) stroke.id = s.id\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${ strokeIndex + 1 } has not pointers`)\n        flag = false\n        return\n      }\n      s.pointers?.forEach((pp, pIndex) =>\n      {\n        if (!pp) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no x at pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no y at pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          stroke.pointers.push(pointer)\n        }\n      })\n      if (flag) {\n        this.model.addStroke(stroke)\n      }\n    })\n\n    if (errors.length) {\n      this.event.emitError(new Error(errors.join(\"\\n\")))\n    }\n    try {\n      const newModel = await this.updateModelRendering()\n      Object.assign(this.#model, newModel)\n      this.event.emitImported(this.model.exports as TExport)\n      return this.model\n    } catch (error) {\n      this.event.emitError(error as Error)\n      throw error as Error\n    }\n  }\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    this.renderer.resize(this.model)\n    if (this.model.symbols.length) {\n      clearTimeout(this.#resizeTimer)\n      this.#resizeTimer = setTimeout(async () =>\n      {\n        const resizeModel = await this.recognizer.resize(this.model)\n        deferredResize.resolve(resizeModel)\n      }, this.#configuration.triggers.resizeTriggerDelay)\n    } else {\n      deferredResize.resolve(this.model)\n    }\n    this.#model = await deferredResize.promise\n    this.logger.debug(\"resize\", { model: this.model })\n    this.event.emitExported(this.model.exports as TExport)\n  }\n\n  async undo(): Promise<void>\n  {\n    this.logger.info(\"undo\")\n    this.#model = this.history.undo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"undo\", this.#model)\n  }\n\n  async redo(): Promise<void>\n  {\n    this.logger.info(\"redo\")\n    this.#model = this.history.redo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"redo\", this.#model)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    this.renderer.drawModel(this.model)\n    this.event.emitExported(this.model.exports as TExport)\n    this.event.emitCleared()\n    this.logger.debug(\"clear\", this.model)\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.grabber.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import style from \"./InteractiveInkSSRSmartGuide.css\"\nimport { InteractiveInkSSREditor } from \"../editor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { ExportType, TJIIXExport, TJIIXWord } from \"../model\"\nimport { convertMillimeterToPixel, createUUID } from \"../utils\"\nimport { TMarginConfiguration } from \"../recognizer\"\n\n/**\n * @group InteractiveInkSSRSmartGuide\n */\nexport class InteractiveInkSSRSmartGuide\n{\n  uuid: string\n  #smartGuideElement!: HTMLDivElement\n  #wrapperElement!: HTMLDivElement\n  #prompterContainerElement!: HTMLDivElement\n  #prompterTextElement!: HTMLDivElement\n  #ellipsisElement!: HTMLDivElement\n  #tagElement!: HTMLDivElement\n  #candidatesElement!: HTMLDivElement\n  #menuElement!: HTMLDivElement\n  #convertElement!: HTMLButtonElement\n  #copyElement!: HTMLButtonElement\n  #deleteElement!: HTMLButtonElement\n  #isMenuOpen!: boolean\n  editor: InteractiveInkSSREditor\n  margin: TMarginConfiguration\n  jiix?: TJIIXExport\n  lastWord?: TJIIXWord\n  wordToChange?: TJIIXWord\n  #logger = LoggerManager.getLogger(LoggerCategory.SMARTGUIDE)\n\n  constructor(editor: InteractiveInkSSREditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.uuid = createUUID()\n    this.editor = editor\n    this.margin = {\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0\n    }\n    this.#createRootElement()\n    this.#createWrapperElement()\n    this.#createPrompterContainerElement()\n    this.#createPrompterTextElement()\n    this.#createEllipsisElement()\n    this.#createTagElement()\n    this.#createCandidatesElement()\n    this.#createMoreMenuElement()\n    this.#createConvertElement()\n    this.#createCopyElement()\n    this.#createDeleteElement()\n  }\n\n  #createRootElement(): void\n  {\n    this.#smartGuideElement = document.createElement(\"div\")\n    this.#smartGuideElement.id = `smartguide-${ this.uuid }`\n    this.#smartGuideElement.classList.add(\"smartguide\")\n    this.#smartGuideElement.addEventListener(\"pointerdown\", e => {\n      e.preventDefault()\n      e.stopPropagation()\n    })\n  }\n\n  #createWrapperElement(): void\n  {\n    this.#wrapperElement = document.createElement(\"div\")\n    this.#wrapperElement.id = `smartguide-wrapper-${ this.uuid }`\n    this.#wrapperElement.classList.add(\"smartguide-wrapper\")\n  }\n\n  #createPrompterContainerElement(): void\n  {\n    this.#prompterContainerElement = document.createElement(\"div\")\n    this.#prompterContainerElement.id = `prompter-container-${ this.uuid }`\n    this.#prompterContainerElement.classList.add(\"prompter-container\")\n  }\n\n  #createPrompterTextElement(): void\n  {\n    this.#prompterTextElement = document.createElement(\"div\")\n    this.#prompterTextElement.id = `prompter-text-${ this.uuid }`\n    this.#prompterTextElement.classList.add(\"prompter-text\")\n    this.#prompterTextElement.setAttribute(\"touch-action\", \"none\")\n  }\n\n  #createEllipsisElement(): void\n  {\n    this.#ellipsisElement = document.createElement(\"div\")\n    this.#ellipsisElement.id = `ellipsis-${ this.uuid }`\n    this.#ellipsisElement.classList.add(\"ellipsis\")\n    this.#ellipsisElement.innerHTML = \"...\"\n  }\n\n  #createTagElement(): void\n  {\n    this.#tagElement = document.createElement(\"div\")\n    this.#tagElement.id = `tag-icon-${ this.uuid }`\n    this.#tagElement.classList.add(\"tag-icon\")\n    this.#tagElement.innerHTML = \"&#182;\"\n  }\n\n  #createCandidatesElement(): void\n  {\n    this.#candidatesElement = document.createElement(\"div\")\n    this.#candidatesElement.id = `candidates-${ this.uuid }`\n    this.#candidatesElement.classList.add(\"candidates\")\n  }\n\n  #createMoreMenuElement(): void\n  {\n    this.#menuElement = document.createElement(\"div\")\n    this.#menuElement.id = `more-menu-${ this.uuid }`\n    this.#menuElement.classList.add(\"more-menu\")\n  }\n\n  #createConvertElement(): void\n  {\n    this.#convertElement = document.createElement(\"button\")\n    this.#convertElement.id = `convert-${ this.uuid }`\n    this.#convertElement.classList.add(\"options-label-button\")\n    this.#convertElement.innerHTML = \"Convert\"\n  }\n\n  #createCopyElement(): void\n  {\n    this.#copyElement = document.createElement(\"button\")\n    this.#copyElement.id = `copy-${ this.uuid }`\n    this.#copyElement.classList.add(\"options-label-button\")\n    this.#copyElement.innerHTML = \"Copy\"\n  }\n\n  #createDeleteElement(): void\n  {\n    this.#deleteElement = document.createElement(\"button\")\n    this.#deleteElement.id = `delete-${ this.uuid }`\n    this.#deleteElement.classList.add(\"options-label-button\")\n    this.#deleteElement.innerHTML = \"Delete\"\n  }\n\n  init(domElement: HTMLElement, margin: TMarginConfiguration): void\n  {\n    this.#logger.info(\"init\", { domElement, margin })\n\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    domElement.appendChild(styleElement)\n\n\n    domElement.appendChild(this.#smartGuideElement)\n    this.#smartGuideElement.appendChild(this.#wrapperElement)\n\n    this.#wrapperElement.appendChild(this.#tagElement)\n\n    this.#prompterContainerElement.appendChild(this.#prompterTextElement)\n    this.#wrapperElement.appendChild(this.#prompterContainerElement)\n\n    this.#wrapperElement.appendChild(this.#ellipsisElement)\n\n    this.#menuElement.appendChild(this.#convertElement)\n    this.#menuElement.appendChild(this.#copyElement)\n    this.#menuElement.appendChild(this.#deleteElement)\n    this.#menuElement.classList.add(\"close\")\n    this.#wrapperElement.appendChild(this.#menuElement)\n    this.#isMenuOpen = false\n\n    this.#candidatesElement.style.display = \"none\"\n    this.#wrapperElement.appendChild(this.#candidatesElement)\n    this.margin = margin\n    this.#addListeners()\n\n    this.resize()\n  }\n\n  #showCandidates = (target: HTMLElement) =>\n  {\n    this.#logger.info(\"showCandidates\", { target })\n    const wordId = parseInt(target.id.replace(\"word-\", \"\").replace(this.uuid, \"\"))\n    const words = this.jiix?.words as TJIIXWord[]\n    this.wordToChange = words[wordId]\n    if (this.wordToChange) {\n      this.wordToChange.id = wordId.toString()\n      this.#candidatesElement.innerHTML = \"\"\n      if (this.wordToChange?.candidates) {\n        this.#candidatesElement.style.display = \"flex\"\n        this.wordToChange.candidates.forEach((word, index) =>\n        {\n          if (this.wordToChange?.label === word) {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\" class=\"selected-word\">${ word }</span>`\n          } else {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\">${ word }</span>`\n          }\n        })\n\n        target.appendChild(this.#candidatesElement)\n      }\n    }\n  }\n  #hideCandidates(): void\n  {\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #openMenu(): void\n  {\n    this.#menuElement.classList.add(\"open\")\n    this.#menuElement.classList.remove(\"close\")\n    this.#isMenuOpen = true\n  }\n  #closeMenu(): void\n  {\n    this.#menuElement.classList.add(\"close\")\n    this.#menuElement.classList.remove(\"open\")\n    this.#isMenuOpen = false\n  }\n\n  #onClickEllipsis = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickEllipsis\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    this.#isMenuOpen ? this.#closeMenu() : this.#openMenu()\n    this.#hideCandidates()\n  }\n\n  #onClickConvert = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickConvert\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.editor.convert()\n    this.#closeMenu()\n  }\n\n  #createTextAreaElement(value: string): HTMLTextAreaElement\n  {\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\"\n    const textArea = document.createElement(\"textarea\")\n    textArea.style.fontSize = \"12pt\"\n    textArea.style.display = \"absolute\"\n    textArea.style[isRTL ? \"right\" : \"left\"] = \"-9999px\"\n    const yPosition = window.pageYOffset || document.documentElement.scrollTop\n    textArea.style.top = `${ yPosition }px`\n    textArea.setAttribute(\"readonly\", \"\")\n    textArea.value = value\n    return textArea\n  }\n\n  #selectText(textArea: HTMLTextAreaElement)\n  {\n    if (navigator.userAgent.match(/ipad|iphone/i)) {\n      const range = document.createRange()\n      range.selectNodeContents(textArea)\n      const selection = window.getSelection()\n      if (selection) {\n        selection.removeAllRanges()\n        selection.addRange(range)\n        textArea.setSelectionRange(0, 999999)\n      }\n    } else {\n      textArea.select()\n    }\n  }\n\n  #onClickCopy = async (evt: Event): Promise<void> =>\n  {\n    this.#logger.info(\"onClickCopy\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    try {\n      this.#closeMenu()\n      let message = \"Nothing to copy\"\n      if (this.#prompterTextElement.innerText) {\n        message = `\"${ this.#prompterTextElement.innerText }\" copied to clipboard`\n        const fakeEl = this.#createTextAreaElement(this.#prompterTextElement.innerText)\n        this.#prompterContainerElement.appendChild(fakeEl)\n        this.#selectText(fakeEl)\n        document.execCommand(\"copy\")\n        fakeEl.remove()\n      }\n      this.editor.event.emitNotif({ message, timeout: 1500 })\n    } catch (error) {\n      this.#logger.error(\"onClickCopy\", error)\n      this.editor.event.emitError(error as Error)\n    }\n  }\n\n  #onClickDelete = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickDelete\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.editor.clear()\n    this.#closeMenu()\n  }\n\n  #onClickCandidate = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickCandidate\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    const target = evt.target as HTMLElement\n    const candidate = target.innerText\n    if (this.jiix?.words && candidate !== this.wordToChange?.label && this.wordToChange?.candidates?.includes(candidate)) {\n      this.jiix.words[parseInt(this.wordToChange?.id as string)].label = candidate\n      this.editor.import(new Blob([JSON.stringify(this.jiix)], { type: ExportType.JIIX }), ExportType.JIIX)\n    }\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #onClickPrompter = (evt: Event): void =>\n  {\n    this.#logger.info(\"onClickPrompter\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.#closeMenu()\n    const target = evt.target as HTMLElement\n    if (target.id !== this.#prompterTextElement.id) {\n      this.#showCandidates(target)\n    } else {\n      this.#hideCandidates()\n    }\n  }\n\n  #stopPropagation = (evt: Event) =>\n  {\n    evt.preventDefault()\n    evt.stopPropagation()\n  }\n\n  #onClickOutSide = () =>\n  {\n    this.#hideCandidates()\n    this.#closeMenu()\n  }\n\n  #addListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation.bind(this))\n    this.#ellipsisElement.addEventListener(\"pointerdown\", this.#onClickEllipsis.bind(this))\n    this.#convertElement.addEventListener(\"pointerdown\", this.#onClickConvert.bind(this))\n    this.#copyElement.addEventListener(\"pointerdown\", this.#onClickCopy.bind(this))\n    this.#deleteElement.addEventListener(\"pointerdown\", this.#onClickDelete.bind(this))\n    this.#prompterTextElement.addEventListener(\"pointerdown\", this.#onClickPrompter.bind(this))\n    this.#candidatesElement.addEventListener(\"pointerdown\", this.#onClickCandidate.bind(this))\n    document.addEventListener(\"pointerdown\", this.#onClickOutSide.bind(this))\n  }\n\n  #removeListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation)\n    this.#ellipsisElement.removeEventListener(\"pointerdown\", this.#onClickEllipsis)\n    this.#convertElement.removeEventListener(\"pointerdown\", this.#onClickConvert)\n    this.#copyElement.removeEventListener(\"pointerdown\", this.#onClickCopy)\n    this.#deleteElement.removeEventListener(\"pointerdown\", this.#onClickDelete)\n    this.#prompterTextElement.removeEventListener(\"pointerdown\", this.#onClickPrompter)\n    this.#candidatesElement.removeEventListener(\"pointerdown\", this.#onClickCandidate)\n    document.removeEventListener(\"pointerdown\", this.#onClickOutSide)\n  }\n\n  resize(): void\n  {\n    this.#logger.info(\"resize\")\n    const marginLeft = convertMillimeterToPixel(this.margin.left)\n    const marginRight = convertMillimeterToPixel(this.margin.right)\n    this.#wrapperElement.style.marginLeft = `${ marginLeft }px`\n    this.#wrapperElement.style.marginRight = `${ marginRight }px`\n  }\n\n  update(exports: TJIIXExport): void\n  {\n    this.#logger.info(\"update\", { exports })\n    this.jiix = exports\n    const createWordSpan = (index: number, word?: TJIIXWord) =>\n    {\n      const span = document.createElement(\"span\")\n      span.id = `word-${ index }${ this.uuid }`\n      if (word) {\n        span.textContent = word.label\n      } else {\n        span.innerHTML = \"&nbsp;\"\n      }\n      this.#logger.debug(\"update\", { span })\n      return span\n    }\n\n    const populatePrompter = () =>\n    {\n      this.#logger.info(\"populatePrompter\")\n      this.#prompterTextElement.innerHTML = \"\"\n      if (this.jiix?.words) {\n        const words = this.jiix.words as TJIIXWord[]\n        const myFragment = document.createDocumentFragment()\n        words.forEach((word, index) =>\n        {\n          if (word.label === \" \" || word.label.includes(\"\\n\")) {\n            myFragment.appendChild(createWordSpan(index))\n          } else if (index !== words.length - 1) {\n            myFragment.appendChild(createWordSpan(index, word))\n          } else {\n            this.#prompterTextElement.appendChild(myFragment)\n            if (this.lastWord) {\n              this.lastWord = word\n            }\n            const span = createWordSpan(index, word)\n            // This is used to scroll to last word if last word is modified\n\n            if ((this.lastWord?.candidates !== word.candidates) && (this.lastWord?.label !== word.label)) {\n              this.lastWord = word\n            }\n            if (this.wordToChange?.id === index.toString()) {\n              span.classList.add(\"modified-word\")\n              this.wordToChange = undefined\n            }\n            else {\n              span.classList.add(\"added-word\")\n            }\n            this.#prompterTextElement.appendChild(span)\n            this.#prompterContainerElement.scrollLeft = span.offsetLeft\n            this.#logger.debug(\"update => populatePrompter\", { span, lastWord: this.lastWord })\n          }\n        })\n      }\n    }\n    populatePrompter()\n    if (this.jiix?.words?.length) {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"auto\")\n    }\n    else {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"none\")\n    }\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.#prompterTextElement.innerHTML = \"\"\n    this.#candidatesElement.innerHTML = \"\"\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.#removeListeners()\n    this.#smartGuideElement.remove()\n  }\n}","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerWebSocketSSRConfiguration, TRecognizerWebSocketSSRRecognitionConfiguration, TRecognizerWebSocketSSRConfiguration, RecognizerWebSocketSSRConfiguration, TServerWebsocketConfiguration } from \"../recognizer\"\nimport { DefaultRendererConfiguration, TRendererConfiguration } from \"../renderer\"\nimport { DefaultTheme, TPenStyle, TTheme } from \"../style\"\nimport { mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaultEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkSSREditorConfiguration = TEditorConfiguration & TRecognizerWebSocketSSRConfiguration & {\n  rendering: TRendererConfiguration\n  smartGuide: {\n    enable: boolean\n  },\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle,\n  penStyleClasses?: string\n  theme: TTheme\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInteractiveInkSSREditorConfiguration: TInteractiveInkSSREditorConfiguration = {\n  server: DefaultRecognizerWebSocketSSRConfiguration.server,\n  recognition: DefaultRecognizerWebSocketSSRConfiguration.recognition,\n  rendering: DefaultRendererConfiguration,\n  smartGuide: {\n    enable: true\n  },\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaultEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: {},\n  theme: DefaultTheme\n}\n\n/**\n * @group Editor\n */\nexport class InteractiveInkSSREditorConfiguration implements TInteractiveInkSSREditorConfiguration\n{\n  server: TServerWebsocketConfiguration\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n  rendering: TRendererConfiguration\n  smartGuide: {\n    enable: boolean\n  }\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle\n  penStyleClasses?: string\n  theme: TTheme\n\n  constructor(configuration?: PartialDeep<TInteractiveInkSSREditorConfiguration>)\n  {\n    const { server, recognition } = new RecognizerWebSocketSSRConfiguration(configuration)\n    this.server = server\n    this.recognition = recognition\n\n    this.rendering = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.rendering, configuration?.rendering)\n    this.smartGuide = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.smartGuide, configuration?.smartGuide)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.grabber = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.grabber, configuration?.grabber)\n    this.triggers = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.penStyle, configuration?.penStyle)\n    this.penStyleClasses = configuration?.penStyleClasses || this.penStyleClasses\n    this.theme = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.theme, configuration?.theme)\n\n    if (this.recognition.type !== \"TEXT\") {\n      this.smartGuide.enable = false\n    }\n    if (this.smartGuide.enable && !this.recognition.text.mimeTypes.includes(\"application/vnd.myscript.jiix\")) {\n      this.recognition.text.mimeTypes.push(\"application/vnd.myscript.jiix\")\n    }\n\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TRecognizerWebSocketSSRMessageSVGPatch, RecognizerWebSocketSSR, DefaultMarginConfiguration, TConverstionState, TMarginConfiguration } from \"../recognizer\"\nimport { InteractiveInkSSRSmartGuide } from \"../smartguide\"\nimport { InteractiveInkSSRSVGRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager, THistoryContext } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { Stroke, TStroke, TPointer } from \"../symbol\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InteractiveInkSSREditorConfiguration } from \"./InteractiveInkSSREditorConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkSSREditorOptions = PartialDeep<EditorOptionsBase &\n  {\n    configuration: InteractiveInkSSREditorConfiguration\n  }> &\n  {\n    override?: {\n      grabber?: PointerEventGrabber\n      recognizer?: RecognizerWebSocketSSR\n    }\n  }\n\n/**\n * @group Editor\n */\nexport class InteractiveInkSSREditor extends AbstractEditor\n{\n  #configuration: InteractiveInkSSREditorConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n\n  smartGuide?: InteractiveInkSSRSmartGuide\n  grabber: PointerEventGrabber\n  renderer: InteractiveInkSSRSVGRenderer\n  recognizer: RecognizerWebSocketSSR\n  history: HistoryManager\n  styleManager: StyleManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInteractiveInkSSREditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InteractiveInkSSREditorConfiguration(options?.configuration)\n    this.styleManager = new StyleManager(options?.configuration?.penStyle, options?.configuration?.theme)\n\n    if (options?.override?.grabber) {\n      const CustomGrabber = options.override.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerWebSocketSSR\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerWebSocketSSR(this.#configuration)\n    }\n\n    this.renderer = new InteractiveInkSSRSVGRenderer(this.#configuration.rendering)\n\n    this.tool = EditorTool.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.recognizer.initialized.promise\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.setCursorStyle()\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get configuration(): InteractiveInkSSREditorConfiguration\n  {\n    return this.#configuration\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TPenStyle>)\n  {\n    this.logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n    this.logger.debug(\"setPenStyle\", this.styleManager.penStyle)\n    this.recognizer.setPenStyle(this.styleManager.penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  set penStyleClasses(penClass: string)\n  {\n    this.logger.info(\"setPenStyleClasses\", { penClass })\n    this.styleManager.setPenStyleClasses(penClass)\n    this.logger.debug(\"setPenStyleClasses\", this.styleManager.penStyleClasses)\n    this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n    this.logger.debug(\"setTheme\", this.styleManager.theme)\n    this.recognizer.setTheme(this.styleManager.theme)\n  }\n\n  protected async syncStyle(): Promise<void>\n  {\n    await Promise.all([\n      this.recognizer.setPenStyle(this.styleManager.penStyle),\n      this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses),\n      this.recognizer.setTheme(this.styleManager.theme)\n    ])\n  }\n\n  protected onExport(exports: TExport): void\n  {\n    this.logger.debug(\"onExport\", { exports })\n    if (this.smartGuide && exports?.[\"application/vnd.myscript.jiix\"]) {\n      const jjix = exports[\"application/vnd.myscript.jiix\"] as TJIIXExport\n      this.smartGuide.update(jjix)\n    }\n    this.model.mergeExport(exports)\n    this.event.emitExported(exports)\n  }\n\n  protected onPointerDown(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerDown\", { tool: this.tool, info })\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    this.model.initCurrentStroke(info.pointer, this.tool === EditorTool.Erase ? \"eraser\" : info.pointerType, style)\n    this.drawCurrentStroke()\n  }\n\n  protected onPointerMove(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerMove\", { tool: this.tool, info })\n    this.model.appendToCurrentStroke(info.pointer)\n    this.drawCurrentStroke()\n  }\n\n  protected async onPointerUp(info: PointerInfo): Promise<void>\n  {\n    try {\n      this.logger.info(\"onPointerUp\", { tool: this.tool, info })\n      this.model.endCurrentStroke(info.pointer)\n      await this.synchronizeModelWithBackend()\n    } catch (error) {\n      this.event.emitError(error as Error)\n    }\n  }\n\n  protected onSVGPatch(evt: TRecognizerWebSocketSSRMessageSVGPatch): void\n  {\n    this.logger.info(\"onSVGPatch\", { evt })\n    this.renderer.updatesLayer(evt.layer, evt.updates)\n  }\n\n  protected initializeSmartGuide(): void\n  {\n    this.smartGuide?.destroy()\n    this.logger.info(\"initializeSmartGuide\", { smartGuide: this.configuration.smartGuide })\n    if (this.configuration.smartGuide.enable) {\n      this.smartGuide = new InteractiveInkSSRSmartGuide(this)\n      let margin: TMarginConfiguration = DefaultMarginConfiguration\n      switch (this.configuration.recognition.type) {\n        case \"TEXT\":\n          margin = this.configuration.recognition.text.margin\n          break\n        case \"MATH\":\n          margin = this.configuration.recognition.math.margin\n          break\n      }\n      this.smartGuide.init(this.layers.ui.root, margin)\n    }\n  }\n\n  protected onContetChaned(undoRedoContext: THistoryContext): void\n  {\n    this.history.context = undoRedoContext\n    this.event.emitChanged(undoRedoContext)\n  }\n\n  protected onError(error: Error): void\n  {\n    this.layers.showMessageError(error)\n    this.event.emitError(error)\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.history.push(this.model)\n      this.renderer.init(this.layers.rendering)\n\n      this.grabber.attach(this.layers.rendering)\n      this.grabber.onPointerDown = this.onPointerDown.bind(this)\n      this.grabber.onPointerMove = this.onPointerMove.bind(this)\n      this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n      this.initializeSmartGuide()\n\n      if(!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n      await this.recognizer.init(this.model.height, this.model.width)\n      this.recognizer.event.addExportedListener(this.onExport.bind(this))\n      this.recognizer.event.addSVGPatchListener(this.onSVGPatch.bind(this))\n      this.recognizer.event.addContentChangedListener(this.onContetChaned.bind(this))\n      this.recognizer.event.addIdleListener(this.event.emitIdle.bind(this.event))\n      this.recognizer.event.addErrorListener(this.onError.bind(this))\n\n      await this.syncStyle()\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    const currentSymbol = this.model.currentSymbol as Stroke\n    if (currentSymbol) {\n      this.renderer.drawPendingStroke(currentSymbol)\n    }\n  }\n\n  async synchronizeModelWithBackend(): Promise<Model>\n  {\n    this.logger.info(\"synchronizeModelWithBackend\")\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      const unsentStrokes = this.model.extractUnsentStrokes()\n      this.model.updatePositionSent()\n      this.history.push(this.model)\n      this.renderer.clearErasingStrokes()\n      const exports = await this.recognizer.addStrokes(unsentStrokes)\n      this.model.mergeExport(exports)\n      this.history.updateStack(this.model)\n    }\n    this.logger.debug(\"synchronizeModelWithBackend\", this.model)\n    return this.model\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async export(mimeTypes?: string[]): Promise<Model>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    try {\n      if (this.#configuration.triggers.exportContent === \"DEMAND\") {\n        const unsentStrokes = this.model.extractUnsentStrokes()\n        this.history.push(this.model)\n        this.history.stack.push(this.model.clone())\n        this.model.updatePositionSent()\n        const exports = await this.recognizer.addStrokes(unsentStrokes)\n        this.model.updatePositionReceived()\n        this.model.mergeExport(exports)\n        this.logger.debug(\"export\", this.model)\n      } else {\n        return await this.recognizer.export(this.model, mimeTypes)\n      }\n    } catch (error) {\n      this.logger.error(\"export\", { error })\n      this.event.emitError(error as Error)\n      return Promise.reject(error)\n    }\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState }): Promise<Model>\n  {\n    this.logger.info(\"convert\", { params })\n    this.history.push(this.model)\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.convert(this.model, params?.conversionState)\n    this.logger.debug(\"convert\", this.model)\n    this.history.push(this.model)\n    this.event.emitConverted(this.model.converts as TExport)\n    return this.model\n  }\n\n  async import(data: Blob | string | TJIIXExport, mimeType?: string): Promise<Model>\n  {\n    let blobToImport: Blob\n    if (data instanceof Blob) {\n      blobToImport = data\n    }\n    else if (typeof data === \"string\") {\n      blobToImport = new Blob([data])\n    }\n    else {\n      blobToImport = new Blob([JSON.stringify(data)])\n    }\n    this.logger.info(\"import\", { data, mimeType })\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.import(this.model, blobToImport, mimeType)\n    this.history.push(this.model)\n    this.event.emitImported(this.model.exports as TExport)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<Model>\n  {\n    this.logger.info(\"importPointEvents\", { strokes })\n    const errors: string[] = []\n    const strokesToImport = strokes.map((s, strokeIndex) =>\n    {\n      const str = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) str.id = s.id\n      if (s.pointerType) str.pointerType = s.pointerType\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${ strokeIndex + 1 } has not pointers`)\n      }\n      let flag = true\n      s.pointers?.forEach((pp, pIndex) =>\n      {\n        flag = true\n        if (!pp) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no pointer at ${ pIndex }`)\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no x at pointer at ${ pIndex }`)\n          flag = false\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no y at pointer at ${ pIndex }`)\n          flag = false\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          str.pointers.push(pointer)\n        }\n      })\n      return str\n    })\n    if (errors.length) {\n      this.event.emitError(new Error(errors.join(\"\\n\")))\n    }\n    strokesToImport.map(s => this.model.addStroke(s))\n    const exportPoints = await this.recognizer.importPointEvents(strokesToImport)\n    this.model.mergeExport(exportPoints)\n    this.event.emitImported(this.model.exports as TExport)\n    this.logger.debug(\"importPointEvents\", this.model)\n    return this.model\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    const clonedModel = this.model.clone()\n    this.renderer.resize(clonedModel)\n    clearTimeout(this.#resizeTimer)\n    this.#resizeTimer = setTimeout(async () =>\n    {\n      try {\n        const resizeModel = await this.recognizer.resize(clonedModel)\n        deferredResize.resolve(resizeModel)\n      } catch (error) {\n        this.logger.error(\"resize\", { height, width, error })\n        deferredResize.reject(error as Error)\n      }\n    }, this.#configuration.triggers.resizeTriggerDelay)\n\n    this.#model = await deferredResize.promise\n    this.smartGuide?.resize()\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"resize\", this.model)\n  }\n\n  async undo(): Promise<Model>\n  {\n    this.logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.#model = this.history.undo() as Model\n      return this.recognizer.undo(this.model)\n    }\n    else {\n      throw new Error(\"Undo not allowed\")\n    }\n  }\n\n  async redo(): Promise<Model>\n  {\n    this.logger.info(\"redo\")\n    if (this.history.context.canRedo) {\n      this.#model = this.history.redo() as Model\n      this.logger.debug(\"undo\", this.#model)\n      return this.recognizer.redo(this.model)\n    }\n    else {\n      throw new Error(\"Redo not allowed\")\n    }\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    await this.recognizer.clear(this.model)\n    this.event.emitCleared()\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.grabber.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    this.recognizer.destroy()\n    this.smartGuide?.destroy()\n    return Promise.resolve()\n  }\n}\n","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerHTTPV2Configuration, RecognizerHTTPV2Configuration, TRecognizerHTTPV2Configuration, TRecognizerHTTPV2RecognitionConfiguration, TServerHTTPConfiguration } from \"../recognizer\"\nimport { DefaultRendererConfiguration, TRendererConfiguration } from \"../renderer\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { convertPixelToMillimeter, mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaultEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n\n/**\n * @group Editor\n */\nexport type TInkEditorConfiguration = TEditorConfiguration & TRecognizerHTTPV2Configuration & {\n  renderer: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TStyle\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInkEditorConfiguration: TInkEditorConfiguration = {\n  server: DefaultRecognizerHTTPV2Configuration.server,\n  recognition: DefaultRecognizerHTTPV2Configuration.recognition,\n  renderer: DefaultRendererConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaultEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: DefaultStyle,\n}\n\n/**\n * @group Editor\n */\nexport class InkEditorConfiguration implements TInkEditorConfiguration\n{\n  server: TServerHTTPConfiguration\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n  renderer: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TStyle\n\n  constructor(configuration?: PartialDeep<InkEditorConfiguration>)\n  {\n    const { server, recognition } = new RecognizerHTTPV2Configuration(configuration)\n    this.server = server\n    this.recognition = recognition\n    this.renderer = mergeDeep({}, DefaultInkEditorConfiguration.renderer, configuration?.renderer)\n    this.recognition.text.guides.enable = this.renderer.guides.enable\n    if (this.renderer.guides.enable)\n    {\n      this.recognition.text.guides[\"line-gap-mm\"] = convertPixelToMillimeter(this.renderer.guides.gap)\n    }\n    this.grabber = mergeDeep({}, DefaultInkEditorConfiguration.grabber, configuration?.grabber)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInkEditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.triggers = mergeDeep({}, DefaultInkEditorConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInkEditorConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInkEditorConfiguration.penStyle, configuration?.penStyle)\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { Model, TExport } from \"../model\"\nimport { TStroke, convertPartialStrokesToStrokes } from \"../symbol\"\nimport { RecognizerHTTPV2 } from \"../recognizer\"\nimport { CanvasRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { HistoryManager } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InkEditorConfiguration, TInkEditorConfiguration } from \"./InkEditorConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInkEditorOptions = PartialDeep<EditorOptionsBase &\n{\n  configuration: TInkEditorConfiguration\n}> &\n{\n  override?: {\n    grabber?: PointerEventGrabber\n    recognizer?: RecognizerHTTPV2\n  }\n}\n\n/**\n * @group Editor\n */\nexport class InkEditor extends AbstractEditor {\n  #configuration: InkEditorConfiguration\n  #model: Model\n  #exportTimer?: ReturnType<typeof setTimeout>\n  #penStyle: TStyle\n  grabber: PointerEventGrabber\n  renderer: CanvasRenderer\n  recognizer: RecognizerHTTPV2\n  history: HistoryManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInkEditorOptions) {\n    super(rootElement, options)\n\n    this.#configuration = new InkEditorConfiguration(options?.configuration)\n\n    this.#penStyle = Object.assign({}, this.#configuration.penStyle)\n\n    if (options?.override?.grabber) {\n      const CustomGrabber = options.override.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerHTTPV2\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerHTTPV2(this.#configuration)\n    }\n    this.renderer = new CanvasRenderer(this.#configuration.renderer)\n\n    this.tool = EditorTool.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  protected onPointerDown(info: PointerInfo): void {\n    this.logger.info(\"onPointerDown\", { tool: this.tool, info })\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.initCurrentStroke(info.pointer, info.pointerType, this.penStyle)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerDown\", `onPointerDown tool unknow: \"${this.tool}\"`)\n        break\n    }\n  }\n\n  protected onPointerMove(info: PointerInfo): void {\n    this.logger.info(\"onPointerMove\", { tool: this.tool, info })\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.appendToCurrentStroke(info.pointer)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerMove\", `onPointerMove tool unknow: \"${this.tool}\"`)\n        break\n    }\n  }\n\n  protected async onPointerUp(info: PointerInfo): Promise<void> {\n    this.logger.info(\"onPointerUp\", { tool: this.tool, info })\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.model.removeStrokesFromPoint(info.pointer)\n        if (this.history.stack.at(-1)?.modificationDate !== this.model.modificationDate) {\n          await this.updateModelRendering()\n        }\n        break\n      case EditorTool.Write:\n        this.model.endCurrentStroke(info.pointer)\n        await this.updateModelRendering()\n        break\n      default:\n        this.logger.warn(\"#onPointerUp\", `onPointerUp tool unknow: \"${this.tool}\"`)\n        break\n    }\n  }\n\n  get penStyle(): TStyle\n  {\n    return this.#penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TStyle>)\n  {\n    this.logger.info(\"set penStyle\", { penStyle })\n    this.#penStyle = Object.assign({}, this.#penStyle, penStyle)\n  }\n\n  get initializationPromise(): Promise<void> {\n    return Promise.resolve()\n  }\n\n  get tool(): EditorTool {\n    return this.#tool\n  }\n  set tool(i: EditorTool) {\n    this.#tool = i\n    this.setCursorStyle()\n  }\n\n  protected setCursorStyle(): void {\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n  }\n\n  get model(): Model {\n    return this.#model\n  }\n\n  get configuration(): InkEditorConfiguration {\n    return this.#configuration\n  }\n\n  async initialize(): Promise<void> {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.renderer.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.renderer.minHeight)\n      this.history.push(this.model)\n      this.layers.rendering.classList.add(this.configuration.recognition.type.toLowerCase().replace(\" \", \"-\"))\n      this.renderer.init(this.layers.rendering, this.#configuration.renderer.guides.enable ? { x: this.#configuration.renderer.guides.gap, y: this.#configuration.renderer.guides.gap } : undefined)\n      this.grabber.attach(this.layers.rendering)\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  drawCurrentStroke(): void {\n    this.logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    this.renderer.drawPendingStroke(this.model.currentSymbol)\n  }\n\n  async updateModelRendering(): Promise<Model> {\n    this.logger.info(\"updateModelRendering\")\n    this.renderer.drawModel(this.model)\n    const deferred = new DeferredPromise<Model>()\n    this.history.push(this.model)\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      const currentModel = this.model.clone()\n      this.#exportTimer = setTimeout(async () => {\n        try {\n          currentModel.mergeExport(await this.recognizer.send(currentModel.symbols))\n          this.history.updateStack(currentModel)\n          if (this.model.modificationDate === currentModel.modificationDate) {\n            this.model.exports = currentModel.exports\n          }\n          deferred.resolve(this.model)\n        } catch (error) {\n          this.logger.error(\"updateModelRendering\", { error })\n          this.layers.showMessageError(error as Error)\n          this.event.emitError(error as Error)\n          deferred.reject(error as Error)\n        }\n      }, this.#configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.#configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve(this.model)\n    }\n    await deferred.promise\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"updateModelRendering\", this.model.exports)\n    return deferred.promise\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<Model> {\n    try {\n      convertPartialStrokesToStrokes(strokes)\n        .forEach((stroke) => {\n          this.model.addStroke(stroke)\n        })\n      const newModel = await this.updateModelRendering()\n      Object.assign(this.#model, newModel)\n      this.event.emitImported(this.model.exports as TExport)\n      return this.model\n    } catch (error) {\n      this.layers.showMessageError(error as Error)\n      this.event.emitError(error as Error)\n      throw error as Error\n    }\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void> {\n    this.logger.info(\"resize\", { height, width })\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.renderer.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.renderer.minWidth)\n    this.renderer.resize(this.model)\n    this.logger.debug(\"resize\", { model: this.model })\n    this.event.emitExported(this.model.exports as TExport)\n  }\n\n  async undo(): Promise<void> {\n    this.logger.info(\"undo\")\n    this.#model = this.history.undo() as Model\n    this.renderer.drawModel(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"undo\", this.#model)\n  }\n\n  async redo(): Promise<void> {\n    this.logger.info(\"redo\")\n    this.#model = this.history.redo() as Model\n    this.renderer.drawModel(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"redo\", this.#model)\n  }\n\n  async clear(): Promise<void> {\n    this.logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    this.renderer.drawModel(this.model)\n    this.event.emitExported(this.model.exports as TExport)\n    this.event.emitCleared()\n    this.logger.debug(\"clear\", this.model)\n  }\n\n  async destroy(): Promise<void> {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.grabber.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { EditorType } from \"./AbstractEditor\"\nimport { InteractiveInkEditor, TInteractiveInkEditorOptions } from \"./InteractiveInkEditor\"\nimport { InkEditorDeprecated, TInkEditorDeprecatedOptions } from \"./InkEditorDeprecated\"\nimport { InteractiveInkSSREditor, TInteractiveInkSSREditorOptions } from \"./InteractiveInkSSREditor\"\nimport { InkEditor, TInkEditorOptions } from \"./InkEditor\"\n\n/**\n * @group Editor\n * @hideconstructor\n */\nexport class Editor\n{\n  protected static logger = LoggerManager.getLogger(LoggerCategory.EDITOR)\n  protected static instance: InteractiveInkEditor | InkEditorDeprecated | InteractiveInkSSREditor | InkEditor |undefined\n\n  static async load<T extends EditorType>(rootElement: HTMLElement, type: T, options: T extends \"INTERACTIVEINK\" ? TInteractiveInkEditorOptions : T extends \"INKV1\" ? TInkEditorDeprecatedOptions : TInteractiveInkSSREditorOptions extends \"INKV2\" ? TInkEditorOptions : TInteractiveInkSSREditorOptions):\n    Promise<T extends \"INTERACTIVEINK\" ? InteractiveInkEditor : T extends \"INKV1\" ? InkEditorDeprecated : InteractiveInkSSREditor extends \"INKV2\" ? InkEditor : InteractiveInkSSREditor>\n  {\n    Editor.logger.info(\"load\", { type, options })\n    if (!options) {\n        throw new Error(`Param 'options' missing`)\n    }\n    if (Editor.instance) {\n      await Editor.instance.destroy()\n    }\n\n    switch (type) {\n      case \"INTERACTIVEINK\":\n        Editor.instance = new InteractiveInkEditor(rootElement, options as TInteractiveInkEditorOptions)\n        break\n      case \"INKV1\":\n        Editor.instance = new InkEditorDeprecated(rootElement, options as TInkEditorDeprecatedOptions)\n        break\n      case \"INKV2\":\n        Editor.instance = new InkEditor(rootElement, options as TInkEditorOptions)\n        break;\n      // case \"INTERACTIVEINKSSR\":\n      default:\n        Editor.instance = new InteractiveInkSSREditor(rootElement, options as TInteractiveInkSSREditorOptions)\n        break\n    }\n\n    await Editor.instance.initialize()\n\n    return Editor.instance as T extends \"INTERACTIVEINK\" ? InteractiveInkEditor : T extends \"INKV1\" ? InkEditorDeprecated : InteractiveInkSSREditor extends \"INKV2\" ? InkEditor : InteractiveInkSSREditor\n  }\n\n  static getInstance(): InteractiveInkEditor | InkEditorDeprecated | InteractiveInkSSREditor | InkEditor | undefined\n  {\n    return Editor.instance\n  }\n\n}\n","\n/**\n * @group Recognizer\n */\nexport type TConvertionConfiguration = {\n    force?: {\n        \"on-stylesheet-change\": boolean\n    }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultConvertionConfiguration: TConvertionConfiguration = {\n    force: {\n        \"on-stylesheet-change\": false\n    }\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableFontList(configuration: PartialDeep<{ server: TServerHTTPConfiguration, recognition: { lang: string }}>): Promise<Array<string>>\n{\n  if (!configuration?.server?.scheme && !configuration?.server?.host) {\n    return Promise.reject(\"Failed to get fonts: configuration.server.scheme & configuration.server.host are required!\")\n  }\n  if (!configuration?.recognition?.lang) {\n    return Promise.reject(\"Failed to get fonts: configuration.recognition.lang is required!\")\n  }\n  const serverConfig = configuration.server\n  const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/font/google/language/` + configuration.recognition.lang)\n  const { result } = await response.json()\n  return result.sort()\n}\n"],"names":["EditorTool","EditorWriteTool","SvgElementRole","ResizeDirection","SELECTION_MARGIN","DeferredPromise","promise","resolve","reject","isFullFilled","isPending","constructor","this","Promise","async","v","isValidNumber","x","isNaN","parseFloat","toString","isFinite","isBetween","val","min","max","computeAverage","arr","reduce","p","c","length","computeDistance","p1","p2","distance","Math","hypot","y","computeAngleAxeRadian","begin","end","atan2","scalaire","v1","v2","computeNearestPointOnSegment","seg","vectP1P","vectP1P2","scalaireP1P_P1P2","scalaireP1P2_P1P2","t","convertRadianToDegree","radian","PI","toFixed","convertDegreeToRadian","degree","computeRotatedPoint","point","center","dx","dy","cos","sin","computePointOnEllipse","radiusX","radiusY","phi","theta","cosPhi","sinPhi","M","abs","N","findIntersectionBetween2Segment","seg1","seg2","S1dx","S1dy","S2dx","S2dy","S1S2dx","S1S2dy","ua_t","ub_t","u_b","ua","ub","findIntersectBetweenSegmentAndCircle","r","result","a","pow","b","cc","deter","e","sqrt","u1","u2","push","computeAngleRadian","p1c","p2c","p1p2","acos","getClosestPoints","points1","points2","minDistance","Number","MAX_SAFE_INTEGER","forEach","_p1","_p2","d","getClosestPoint","points","closest","index","i","isPointInsidePolygon","inside","j","isVersionSuperiorOrEqual","source","target","sourceParts","split","targetParts","computeHmac","message","applicationKey","hmacKey","enc","TextEncoder","messageEncoded","encode","keyEncoded","key","crypto","subtle","importKey","name","hash","signature","sign","buffer","Uint8Array","Array","prototype","map","call","padStart","join","convertMillimeterToPixel","mm","convertPixelToMillimeter","px","convertBoundingBoxMillimeterToPixel","box","width","height","createUUID","dt","Date","now","replace","random","floor","mergeDeep","sources","isObject","item","isArray","shift","Object","assign","concat","isDeepEqual","object1","object2","objKeys1","keys","objKeys2","value1","value2","isObjects","object","getAvailableLanguageList","configuration","server","scheme","host","serverConfig","fetch","json","computeLinksPointers","angle","radius","computeMiddlePointer","point1","point2","getApiInfos","response","ok","version","gitCommit","nativeVersion","LoggerLevel","LoggerCategory","Logger","category","level","debug","functionName","data","DEBUG","dataLog","from","console","info","INFO","warn","WARN","error","LoggerManager","static","Map","getLogger","loggerMap","has","set","ERROR","get","setLoggerLevel","config","lc","DefaultLoggerConfiguration","EDITOR","RECOGNIZER","GRABBER","RENDERER","EDITOR_EVENT","MODEL","SYMBOL","SMARTGUIDE","GESTURE","STYLE","HISTORY","TRANSFORMER","CONVERTER","WRITE","SELECTION","SVGDEBUG","MENU","EditorEventName","EditorEvent","EventTarget","logger","abortController","element","super","AbortController","removeAllListeners","abort","emit","type","evt","CustomEvent","bubbles","composed","detail","undefined","dispatchEvent","emitSessionOpened","sessionId","SESSION_OPENED","addSessionOpenedListener","callback","addEventListener","signal","emitLoaded","LOADED","addLoadedListener","emitNotif","notif","NOTIF","addNotifListener","emitError","err","addErrorListener","emitExported","exports","EXPORTED","addExportedListener","emitChanged","undoRedoContext","CHANGED","canClear","empty","addChangedListener","emitIdle","idle","IDLE","addIdleListener","emitCleared","CLEARED","addClearedListener","emitConverted","CONVERTED","addConvertedListener","emitImported","IMPORTED","addImportedListener","emitSelected","symbols","SELECTED","addSelectedListener","emitToolChanged","mode","TOOL_CHANGED","addToolChangedListener","emitUIpdated","UI_UPDATED","addUIpdatedListener","emitSynchronized","SYNCHRONIZED","addSynchronizedListener","emitGestured","gesture","GESTURED","addGesturedListener","ExportType","JIIXELementType","JIIXNodeKind","JIIXEdgeKind","EditorLayer","root","ui","rendering","onCloseModal","rootClassCss","classList","add","createLayerRender","createLayerUI","render","styleElement","document","createElement","appendChild","createTextNode","prepend","createLoader","loaderHTML","style","display","showLoader","loader","hideLoader","createMessageOverlay","overlay","closeMessageModal","modal","contains","hideMessageModal","text","innerText","remove","createMessageModal","closeBtn","bind","createMessage","showMessageInfo","setTimeout","timeout","showMessageError","createBusy","busy","createState","showState","state","hideState","updateState","destroy","lastChild","removeChild","AbstractEditor","layers","event","loggerConfiguration","rootElement","options","override","cssClass","editor","loggerConfig","loadInfo","Box","boundindBox","Error","createFromBoxes","boxes","createFromPoints","getCorners","getCenter","getSides","vertices","isContained","wrapper","containsPoint","child","overlaps","box1","box2","xMin","xMid","xMax","yMin","yMid","yMax","corners","snapPoints","boundaries","DefaultStyle","color","DefaultPenStyle","DefaultTheme","ink","module","o","n","l","m","defineProperty","configurable","enumerable","__esModule","default","hasOwnProperty","s","TypeError","value","Symbol","iterator","toJSON","u","trim","indexOf","substring","_trimSemiColon","toCSS","slice","parser","JsonCSS","StyleHelper","themeToCSS","themeToJSON","theme","penStyleToCSS","penStyle","css","penStyleToJSON","penStyleString","stringToJSON","JSONToString","entries","k","StyleManager","penStyleClasses","currentPenStyle","setTheme","setPenStyleClasses","setPenStyle","structuredClone","penStyleClass","DecoratorKind","SymbolType","EdgeKind","ShapeKind","RecognizedKind","IIDecorator","id","kind","clone","MatrixTransform","xx","yx","xy","yy","tx","ty","identity","applyToPoint","mat","rotation","hypotAc","hypotBd","toCssString","matrix","invert","denom","multiply","translate","rotate","cosAngle","round","sinAngle","scale","IISymbolBase","creationTime","modificationDate","selected","deleting","transform","opacity","edges","isClosed","isIntersected","some","edge","EdgeDecoration","OIEdgeBase","startDecoration","endDecoration","Edge","bounds","bb","e1","e2","isValidPoint","IIEdgeArc","startAngle","sweepAngle","_vertices","Arc","verticesId","computedVertices","nbVertices","angleStep","endAngle","at","create","partial","arc","IIEdgeLine","start","Line","line","IIEdgePolyLine","PolyEdge","polyline","OIShapeBase","Shape","IIShapeCircle","_bounds","Circle","computedBondingBox","firstPoint","perimeter","nbPoint","rad","boundingBox","createBetweenPoints","origin","updateBetweenPoints","circle","IIShapeEllipse","orientation","Ellipse","ellipse","IIShapePolygon","Polygon","polygon","createTriangleBetweenPoints","updateTriangleBetweenPoints","poly","createParallelogramBetweenPoints","updateParallelogramBetweenPoints","createRectangleBetweenPoints","updateRectangleBetweenPoints","createRhombusBetweenPoints","updateRhombusBetweenPoints","IIStroke","pointerType","decorators","pointers","Stroke","strokeToSplit","before","after","substract","stroke","partStroke","lastPointBeforeStroke","closestLastPointBeforeStroke","newStrokes","strokeAfter","firstPointAfterStroke","closestFirstPointStrokeAfter","computePressure","ratio","pressure","filterPointByAcquisitionDelta","lastPointer","delta","addPointer","pointer","formatToSend","errors","flag","pp","pIndex","convertPartialStrokesToOIStrokes","strokes","IIRecognizedBase","Recognized","flatMap","updateChildrenStyle","containsStroke","strokeId","removeStrokes","strokeIds","strokeRemoved","filter","includes","IIRecognizedArc","JSON","parse","stringify","ws","IIRecognizedCircle","IIRecognizedEllipse","IIRecognizedLine","IIRecognizedPolyLine","IIRecognizedPolygon","Polygone","IIRecognizedText","baseline","xHeight","label","lines","Text","IISymbolGroup","children","Group","chars","containsSymbol","containsOnlyStroke","extractText","extractStrokes","removeChilds","symbolIds","group","every","texts","symbolId","symbol","s1","IIText","offsetY","getCharCorners","char","boxBox","updateChildrenFont","fontSize","fontWeight","getCharsOverlaps","charCorners","fill","IIEraser","Eraser","convertPartialStrokesToStrokes","ji","Model","positions","currentSymbol","converts","rowHeight","creationDate","lastSentPosition","lastReceivedPosition","globalDistance","getStrokeFromPoint","_strokeList","strokePointer","addPoint","addStroke","updateStroke","updatedStroke","strokeIndex","findIndex","splice","removeStroke","removeStrokesFromPoint","strokeToRemove","extractUnsentStrokes","initCurrentStroke","dpi","pxWidth","appendToCurrentStroke","endCurrentStroke","updatePositionSent","position","updatePositionReceived","mergeExport","mergeConvert","clonedModel","clear","IIModel","symbolsSelected","symbolsToDelete","selectSymbol","find","unselectSymbol","resetSelection","getRootSymbol","getSymbolRowIndex","getSymbolsByRowOrdered","rows","rowIndex","row","sort","s2","r1","r2","roundToLineGuide","isSymbolAbove","isSymbolInRow","isSymbolBelow","getFirstSymbol","previous","current","getLastSymbol","addSymbol","updateSymbol","updatedSymbol","sIndex","replaceSymbol","changeOrderSymbol","fromIndex","toIndex","sym","removeSymbol","symbolIndex","extractDifferenceSymbols","model","added","removed","DefaultServerHTTPConfiguration","DefaultServerWebsocketConfiguration","websocket","pingEnabled","pingDelay","maxPingLostCount","autoReconnect","maxRetryCount","fileChunkSize","DefaultEraserConfiguration","DefaultDiagramConvertConfiguration","types","DefaultDiagramConfiguration","convert","eraser","mimeTypes","DefaultJiixConfiguration","ids","words","DefaultExportConfiguration","jiix","DefaultMarginConfiguration","top","left","right","bottom","DefaultSolverConfiguration","enable","DefaultMathUndoRedoConfiguration","DefaultMathConfiguration","solver","margin","DefaultRawContentConfiguration","recognition","classification","DefaultDebugConfiguration","DefaultRecognitionRendererConfiguration","DefaultTextGuidesConfiguration","DefaultTextConfiguration","guides","DefaultTextGuidesConfigurationV2","DefaultTexConfigurationV2","DefaultShapeConvertConfiguration","DefaultShapeBeautificationConfiguration","DefaultShapeConfiguration","beautification","RecognizerEventName","RecognizerError","RecognizerEvent","emitStartInitialization","START_INITIALIZATION","addStartInitialization","emitEndtInitialization","END_INITIALIZATION","addEndInitialization","emitContentChanged","CONTENT_CHANGED","addContentChangedListener","emitConnectionClose","code","CONNECTION_CLOSE","addConnectionCloseListener","emitSVGPatch","svgPatch","SVG_PATCH","addSVGPatchListener","DefaulRecognitionHTTPV1ConfigurationConfiguration","export","math","diagram","renderer","lang","DefaultRecognizerHTTPV1Configuration","RecognizerHTTPV1Configuration","Set","RecognizerHTTPV1","url","postConfig","buildData","strokeGroupByPenStyle","groupIndex","sg","isPenStyleEqual","ps1","ps2","strokeGroupsToSend","newGroup","contentType","charAt","toUpperCase","toLowerCase","xDPI","yDPI","strokeGroups","post","mimeType","headers","Headers","append","hmac","reqInit","method","body","request","Request","blob","catch","tryFetch","then","res","UNKNOW","WRONG_CREDENTIALS","CANT_ESTABLISH","getMimeTypes","requestedMimeTypes","conversionState","myModel","dataToConcert","promises","mt","all","String","mimeTypesRequiringExport","resize","DefaultRecognizerHTTPV2RecognitionConfiguration","shape","DefaultRecognizerHTTPV2Configuration","RecognizerHTTPV2Configuration","RecognizerHTTPV2","formatStrokes","scaleX","scaleY","send","TRecognizerWebSocketMessageType","DefaultRecognitionWebSocketConfiguration","gestures","ignoreGestureStrokes","DefaultRecognizerWebSocketConfiguration","RecognizerWebSocketConfiguration","RecognizerWebSocket","socket","pingWorker","pingCount","reconnectionCount","currentPartId","currentErrorCode","addStrokeDeferred","contextlessGestureDeferred","transformStrokeDeferred","eraseStrokeDeferred","replaceStrokeDeferred","exportDeferredMap","closeDeferred","waitForIdleDeferred","undoDeferred","redoDeferred","clearDeferred","initialized","readyState","OPEN","rejectDeferredPending","values","resetAllDeferred","clearSocketListener","removeEventListener","openCallback","closeCallback","messageCallback","reason","GOING_AWAY","PROTOCOL_ERROR","UNSUPPORTED_DATA","ABNORMAL_CLOSURE","INVALID_FRAME_PAYLOAD","POLICY_VIOLATION","MESSAGE_TOO_BIG","INTERNAL_ERROR","SERVICE_RESTART","TRY_AGAIN","BAD_GATEWAY","TLS_HANDSHAKE","terminate","manageHMACChallenge","hmacChallengeMessage","hmacChallenge","initPing","PingWorker","postMessage","onmessage","close","manageAuthenticated","pixelTomm","iinkSessionId","manageSessionDescriptionMessage","sessionDescriptionMessage","manageNewPartMessage","newPartMessage","managePartChangeMessage","partChangeMessage","partId","manageContentChangedMessage","contentChangeMessage","canRedo","canUndo","manageExportMessage","exportMessage","manageWaitForIdle","manageErrorMessage","errorMessage","NO_ACTIVITY","TOO_OLD","NO_SESSION_FOUND","manageGestureDetected","gestureMessage","manageContextlessGesture","websocketMessage","Pong","HMAC_Challenge","Authenticated","SessionDescription","NewPart","PartChanged","ContentChanged","Exported","GestureDetected","ContextlessGesture","Idle","newSession","init","WebSocket","CONNECTING","CLOSING","CLOSED","waitForIdle","buildAddStrokesMessage","processGestures","addStrokes","buildReplaceStrokesMessage","oldStrokeIds","replaceStrokes","buildTransformTranslateMessage","transformationType","transformTranslate","buildTransformRotateMessage","x0","y0","transformRotate","buildTransformScaleMessage","transformScale","buildTransformMatrixMessage","transformMatrix","buildEraseStrokesMessage","eraseStrokes","recognizeGesture","buildUndoRedoChanges","changes","changesMessages","erased","replaced","oldStrokes","tr","undo","actions","redo","DefaultRecognizerWebSocketSSRRecognitionConfiguration","DefaultRecognizerWebSocketSSRConfiguration","RecognizerWebSocketSSRConfiguration","RecognizerWebSocketSSR","viewSizeHeight","viewSizeWidth","connected","ackDeferred","exportDeferred","convertDeferred","importDeferred","resizeDeferred","importPointEventsDeferred","toLocaleLowerCase","infinitePing","params","xDpi","yDpi","manageAckMessage","manageContentPackageDescriptionMessage","manageContentChangeMessage","context","stackIndex","undoStackIndex","possibleUndoCount","manageSVGPatchMessage","svgPatchMessage","styleClasses","localModel","import","chunkSize","importFileId","readBlob","fileReader","FileReader","onloadend","ev","onerror","readAsText","importFileMessage","size","blobPart","fileChuckMessage","lastChunk","importPointEvents","events","myExportConverted","undoExports","redoExports","clearExports","CanvasRendererShape","table","returnedAngle","drawEllipseArc","context2D","shapeEllipse","centerPoint","maxRadius","minRadius","z1","z2","z3","z4","boundariesPoints","save","beginPath","alpha","cosAlpha","sinAlpha","moveTo","lineTo","restore","drawLine","drawArrowHead","headPoint","beta","fillStyle","strokeStyle","drawShapeEllipse","beginDecoration","beginTangentAngle","endTangentAngle","drawShapeLine","shapeLine","lastPoint","draw","lineWidth","CanvasRendererStroke","renderArc","context2d","renderLine","linkPoints1","linkPoints2","renderFinal","linkPoints","newAngle","renderQuadratic","ctrl","linkPoints3","quadraticCurveTo","NUMBER_POINTS","NUMBER_QUADRATICS","secondPoint","beginLine","endLine","beginFinal","endFinal","closePath","CanvasRendererText","string","textLine","drawUnderline","textUnderline","underline","topLeftPoint","firstCharacter","lastCharacter","drawText","font","textHeight","textAlign","justificationType","textBaseline","fillText","drawTextLine","underlineList","CanvasRenderer","strokeRenderer","shapeRenderer","textRenderer","createCanvas","canvas","resizeContent","pixelRatio","window","devicePixelRatio","renderingCanvas","capturingCanvas","domElement","parentNode","minWidth","clientWidth","minHeight","clientHeight","getContext","drawSymbol","guide","setAttribute","backgroundSize","parent","renderingCanvasContext","capturingCanvasContext","drawModel","clearRect","drawPendingStroke","innerHTML","IISVGRendererConst","arrowHeadStartMarker","arrowHeadEndMaker","selectionFilterId","removalFilterId","crossMarker","noSelection","XMLNS","SVGBuilder","createLayer","attrs","svgEl","createElementNS","createFilter","createDefs","createMarker","marker","createComponentTransfert","createDropShadow","deviation","shadow","createTransfertFunctionTable","feFunc","createGroup","groupEl","createLine","lineEl","createCircle","circleEl","createPath","pathEl","createPolygon","polygonEl","createRect","rectEl","createTSpan","tSpanEl","textContent","createForeignObject","node","objEl","createText","textEl","IISVGRendererEdgeUtil","getLinePath","getPolyLinePath","getArcPath","getSVGPath","getSVGElement","pathAttrs","Arrow","IISVGRendererEraserUtil","startPath","strokeWith","acc","shadowBlur","IISVGRendererDecoratorUtil","decorator","Highlight","Surround","Strikethrough","Underline","IISVGRendererShapeUtil","getPolygonePath","getCirclePath","getEllipsePath","IISVGRendererStrokeUtil","getFinalPath","parts","getQuadraticPath","central","STROKE_LENGTH","STROKE_WIDTH","NB_QUADRATICS","beforeLastPoint","strokeGroup","strokeAttrs","deco","IISVGRendererTextUtil","textGroup","textElement","IISVGRendererRecognizedUtil","recognizedSymbol","IISVGRendererGroupUtil","getChildElement","symbolGroup","IISVGRenderer","groupGuidesId","layer","definitionGroup","verticalGuides","horizontalGuides","initLayer","setProperty","createSVGTools","defs","REFX","SIZE","REFY","arrowHeadMarkerAttrs","markerWidth","markerHeight","refX","refY","arrowHeadStart","orient","arrowHeadEnd","crossMarkerAttrs","viewBox","cross","createFilters","filtersGroup","removalFilter","filterUnits","bfeComponentTransfer","bfeFuncA","selectionFilter","drawGuides","getAttribute","offSet","gap","subOffSet","role","Guide","guidesGroup","svgLine","subY","subX","svgPoint","removeGuides","querySelector","oncontextmenu","buildElementFromSymbol","prependElement","el","symbolToMove","moveEl","insertAdjacentElement","nextElementSibling","previousElementSibling","appendElement","removeElement","oldStroke","oldNode","replaceWith","elements","drawCircle","drawRect","drawConnectionBetweenBox","attrsLine","getElementById","getElements","tagName","query","querySelectorAll","clearElements","firstChild","SVGStroker","buildSVGPath","drawStroke","svgElement","svgPathElement","svgPath","InteractiveInkSSRSVGRenderer","stroker","replaceAll","layerName","update","oldLayer","insertAdjacentHTML","svg","pendingStrokesGroup","replaceElement","elementToRemove","parentSelector","parentId","insertBefore","refId","selector","removeAttribute","updateLayer","updatesLayer","updates","clearPendingStroke","pendingStrokeGroup","clearErasingStrokes","erasingStroke","rect","getBoundingClientRect","svgList","DefaultGuidesConfiguration","DefaultRendererConfiguration","DefaultIIRendererConfiguration","IIConversionManager","fontStyle","computeFontSize","buildChar","grid","weight","buildText","word","charSymbols","charFontSize","charStrokes","items","hightlight","strikethrough","surround","convertText","onlyText","jiixWords","jiixChars","textFontSize","isNewLine","currentY","leftX","currentX","texter","getSpaceWidth","wordStrokes","wordSymbol","nbRow","setBounds","buildCircle","cx","cy","buildEllipse","rx","ry","buildRectangle","rectangle","buildPolygon","buildRhombus","buildTriangle","buildParallelogram","convertNode","associatedStroke","uniqStrokes","Rectangle","Triangle","Parallelogram","Rhombus","buildLine","x1","y1","x2","y2","p1Decoration","p2Decoration","buildPolyEdge","unshift","buildArc","convertEdge","apply","removeSelectedGroup","strokesToConvert","extractStrokesFromSymbols","conversionResults","conversion","addSymbols","cs","removeSymbols","history","IIResizeManager","interactElementsGroup","direction","transformOrigin","keepRatio","applyToStroke","applyToShape","applyToEdge","applyOnText","updateBounds","applyOnGroup","applyToSymbol","applyOnRecognizedSymbol","setTransformOrigin","originX","originY","scaleElement","sx","sy","InteractElementsGroup","localPoint","horizontalResize","verticalResize","snaps","snapResize","deltaX","deltaY","continue","clearSnapToElementLines","oldSymbols","strokesFromSymbols","recognizer","svgDebugger","IIRotationManager","angleRad","strokeText","rotateElement","angleDegree","snapRotation","DefaultListenerConfiguration","capture","passive","DefaultGrabberConfiguration","listenerOptions","xyFloatPrecision","timestampFloatPrecision","delayLongTouch","PointerEventGrabber","layerCapture","capturing","prevent","preventDefault","onPointerDown","onPointerMove","onPointerUp","onContextMenu","roundFloat","oneFloat","requestedFloatPrecision","floatPrecision","extractPointer","clientX","clientY","changedTouches","clientLeft","scrollLeft","clientTop","scrollTop","getPointerInfos","isPrimary","button","buttons","pointerDownHandler","pointerInfo","pointerMoveHandler","pointerUpHandler","pointerOutHandler","contextMenuHandler","stopPointerEvent","attach","detach","removeProperty","IISelectionManager","grabber","selectingId","startSelectionPoint","endSelectionPoint","selectedGroup","rotator","translator","resizer","selectionBox","drawSelectingRect","clearSelectingRect","getPoint","createTranslateRect","Translate","boxWithMarge","translateEl","handler","stopPropagation","endHandler","cursor","resetSelectedGroup","hideInteractElements","createRotateGroup","Rotate","attrs1","attrs2","attrs3","createResizeGroup","Resize","P_NW","P_NE","P_SE","P_SW","bindEl","def","lineResize","cornerResize","createInteractElementsGroup","symbolElementMap","surroundGroup","SURROUND_ATTRS","createEdgeResizeGroup","pointIndex","pointEl","createInteractEdgeGroup","drawSelectedGroup","groupBox","getBBox","menu","show","hide","updatedSymbols","found","currentEl","symbolTypesAllowed","parentElement","unselectAll","updateLayerUI","IITextManager","drawSymbolHidden","setCharsBounds","textGroupEl","getNumberOfChars","ext","getExtentOfChar","getElementBoundingBox","markers","clipped","getBoundingBox","charSymbol","textSymbol","moveTextAfter","textsAfter","IITranslateManager","addToHistory","translateElement","nudge","snapTranslate","IIWriteManager","tool","Pencil","detectGesture","currentSymbolOrigin","wt","gestureManager","needContextLessGesture","strokeBoundsWithMargin","getSymbolsBounds","createCurrentSymbol","DoubleArrow","updateCurrentSymbol","updateCurrentSymbolShape","updateCurrentSymbolEdge","localPointer","interactWithBackend","localStroke","gestureFromContextLess","getGestureFromContextLess","pop","localSymbol","IIEraseManager","currentEraser","lastSeg","IIDebugSVGManager","snapPointsVisibility","verticesVisibility","boundingBoxVisibility","recognitionBoxVisibility","recognitionItemBoxVisibility","debugSnapPoints","debugVertices","showBoundingBox","hideBoundingBox","debugRecognitionBox","debugRecognitionItemBox","showSnapPoints","hideSnapPoints","showVertices","hideVertices","drawBoundingBox","symbolAttrs","charAttrs","symEl","ca","sa","debugBoundingBox","drawRecognitionBox","infos","COLOR","recognitionGroup","infosGroup","infoX","infoY","TEXT_HEIGHT","w","infosGroupBox","rectBox","rectTranslate","newRectBox","showRecognitionBox","hideProperties","candidates","inf","clearRecognitionBox","drawRecognitionItemBox","recognitionItemGroup","charX","charY","charsGroup","charsGroupBox","showRecognitionItemBox","clearRecognitionItemBox","IIMoveManager","getInitialHistoryContext","HistoryManager","stack","updateContext","maxStackSize","updateStack","previousModel","nextModel","IIHistoryManager","isChangesEmpty","updated","order","ungroup","stackIdx","reverseChanges","reversedChanges","newSymbols","currentStackItem","previousStackItem","nextStackItem","DefaultHistoryConfiguration","IIMenu","thicknessList","fontSizeList","fontWeightList","colors","createWrapCollapsible","title","head","btn","ArrowDown","content","toggle","createMenuItemBoolean","labelEl","checkbox","disabled","initValue","indeterminate","checked","createMenuItemSelect","select","opt","Option","createMenuItemButton","icon","createMenuItemButtonList","createMenuItemColorList","createColorList","list","colorEl","createMenuItem","SurroundAction","StrikeThroughAction","InsertAction","DefaultGestureConfiguration","Select","strikeThrough","Draw","insert","LineBreak","IIGestureManager","insertAction","surroundAction","strikeThroughAction","gestureAction","strokeSpaceWidth","applySurroundGesture","gestureStroke","symWithDec","highlight","computeScratchOnStrokes","partPointersToRemove","subStrokes","ss","fullStrokeId","strokePartToErase","computeScratchOnText","charsToRemove","cIndex","c1","computeScratchOnSymbol","strokesScratchedResult","childrenNotTouch","results","strokesToConserve","symbolsGroup","textScratchedResult","applyScratch","symbolsToUpdate","symbolsToErase","symbolsToReplace","updateSymbols","replaceSymbols","applyJoinGesture","symbolsAbove","symbolsRow","symbolsBeforeGestureInRow","symbolsOnGestureInRow","symbolsAfterGestureInRow","symbolsBelow","symbolToJoin","childBefore","childAfter","lastSymbBefore","firstSymbolAfter","translateX","lastSymbBeforeClone","firstSymbolAfterClone","symbolsToGroup","strokeTexts","d1","rest","lastSymbolBeforeGesture","firstSymbolAfterGesture","symbolInNextRow","symbolsAfterNextRow","lastSymbolAbove","createStrokesFromGestureSubStroke","strokeOrigin","subStroke","computeSplitStroke","computeSplitStrokeInGroup","newGroups","symbolsBefore","symbolsAfter","strokeIdToSplit","gs","computeChangesOnSplitStroke","symbolToSplit","strokesToSplit","strokesBefore","strokesAfter","computeChangesOnSplitGroup","groupToSplit","groupSymbolsBefore","groupsSymbolsAfter","groupBefore","grouAfter","computeChangesOnSplitStrokeText","strokeTextToSplit","strokeTextBefore","strokeTextAfter","computeChangesOnSplitText","textToSplit","charsBefore","charsAfter","newTexts","textBefore","pointAfter","textAfter","applyInsertGesture","Insert","applyUnderlineGesture","applyStrikeThroughGesture","Erase","updateSymbolsStyle","synchronizeStrokesWithJIIX","gestureType","gestureStrokeId","strokeAfterIds","strokeBeforeIds","symbolsToUnderline","symbolsToStrikeThrough","IIMenuSub","param","trigger","menuTitle","menuTitleElement","subMenu","open","unwrap","wrap","IIMenuAction","menuLanguage","menuClear","menuUndo","menuRedo","menuConvert","guideGaps","isMobile","createMenuClear","createMenuLanguage","triggerBtn","languages","changeLanguage","createMenuUndo","createMenuRedo","createMenuConvert","createMenuGesture","subMenuWrapper","surroundActionValues","strikeThroughActionValues","splitActionValues","writer","Write","createMenuGuide","renderingConfiguration","createMenuSnap","createMenuDebug","menuItems","createMenuExport","downloadAsJson","downloadAsSVG","downloadAsPNG","readFileAsText","file","reader","onload","createMenuImport","importInput","accept","multiple","importBtn","files","fileString","createSymbols","closeAllSubMenu","action","menuTrigger","visibility","IIMenuTool","writeBtn","menuSelect","menuMove","menuErase","menuShape","subMenuShape","menuEdge","subMenuEdge","createMenuWrite","createMenuMove","Move","createMenuSelect","createMenuErase","createShapeSubMenu","subMenuContent","nextSibling","createMenuShape","rectangleIcon","triangle","rhombus","createEdgeSubMenu","square","createMenuEdge","lineIcon","arrow","doubleArrow","IIMenuStyle","menuColorStroke","menuColorFill","menuThickness","menuFontSize","menuFontWeight","menuStrokeOpacity","writeShape","createMenuStroke","symbolsStyles","st","menuColorStrokeDef","menuColor","createMenuColorFill","createMenuThickness","createMenuFontSize","textSymbols","updateTextFontStyle","createMenuFontWeight","createMenuOpacity","currentOpacity","input","output","shapeSelected","IIMenuContext","editMenu","editInput","editSaveBtn","reorderMenu","decoratorMenu","menuExport","duplicateBtn","groupBtn","convertBtn","removeBtn","haveSymbolsSelected","symbolsDecorable","showDecorator","createMenuEdit","firstChar","createMenuDuplicate","symbolsToDuplicate","updateDeepIdInGroup","gr","duplicatedSymbols","createMenuGroup","ungroupSymbol","groupSymbols","convertSymbols","createMenuRemove","createMenuReorder","changeOrderSymbols","reverse","createDecoratorSubMenu","labelEL","decoIndex","_c","createMenuDecorator","createMenuSelectAll","selectAll","updateDecoratorSubMenu","decos","btnToActivate","updateGroupMenu","DefaultMenuConfiguration","IIMenuManager","custom","CustomMenuStyle","CustomMenuTool","CustomMenuAction","DefaultSnapConfiguration","SnapConfiguration","IISnapManager","selectionSnapPoints","otherSnapPoints","selectSymbolIds","snapThreshold","getNearestVerticalGuide","prev","curr","getNearestHorizontalGuide","getGuidePointToSnap","drawSnapToElementLines","getSnapLinesInfos","sourcePoints","targetPoints","Infinity","verticales","horizontales","horizontal","vertical","snapLines","snapLinesInfos","selectionSymbolPoints","lastDeltaX","lastDeltaY","gridPoint","DefaultInteractiveInkEditorConfiguration","snap","InteractiveInkEditorConfiguration","InteractiveInkEditor","layerUITimer","recognizeStrokeTimer","converter","move","CustomRecognizer","manageError","onContentChanged","updateLayerState","initializationPromise","setCursorStyle","clearTimeout","initialize","compStyles","getComputedStyle","parseInt","buildShape","partialShape","buildEdge","partialEdge","buildRecognized","partialSymbol","buildGroup","partialGroup","buildStroke","buildStrokeText","buildSymbol","createSymbol","partialSymbols","updateTextBounds","symList","lastWidth","textIds","symbolsTranslated","textChildren","symToReplace","force","getSymbolsAndStrokesAssociatedFromJIIXStrokeItems","strokeIdsUsed","symIdx","jiixAssociation","symAsso","recognizedText","wd","Node","symbolRecognized","groupStrokeIds","symbolsToRemove","strokesIds","partialStrokes","triggerDownload","fileName","urlData","downloadAnchorNode","click","buildBlobFromSymbols","svgNode","cloneNode","svgString","XMLSerializer","serializeToString","Blob","getExportName","extension","year","month","day","hour","minute","second","toLocaleDateString","navigator","language","selection","svgBlob","URL","createObjectURL","image","Image","src","drawImage","revokeObjectURL","imgURI","toDataURL","symbolsToExport","dataStr","encodeURIComponent","extractTextsFromSymbols","extractBackendChanges","backendChanges","modifications","actionsToBackend","DefaultEditorTriggerConfiguration","exportContent","exportContentDelay","resizeTriggerDelay","DefaultInkEditorDeprecatedConfiguration","triggers","InkEditorDeprecatedConfiguration","InkEditorDeprecated","resizeTimer","exportTimer","styleManager","CustomGrabber","drawCurrentStroke","updateModelRendering","deferred","currentModel","newModel","deferredResize","resizeModel","InteractiveInkSSRSmartGuide","uuid","smartGuideElement","wrapperElement","prompterContainerElement","prompterTextElement","ellipsisElement","tagElement","candidatesElement","menuElement","convertElement","copyElement","deleteElement","isMenuOpen","lastWord","wordToChange","createRootElement","createWrapperElement","createPrompterContainerElement","createPrompterTextElement","createEllipsisElement","createTagElement","createCandidatesElement","createMoreMenuElement","createConvertElement","createCopyElement","createDeleteElement","addListeners","showCandidates","wordId","hideCandidates","openMenu","closeMenu","onClickEllipsis","onClickConvert","createTextAreaElement","isRTL","documentElement","textArea","yPosition","pageYOffset","selectText","userAgent","match","range","createRange","selectNodeContents","getSelection","removeAllRanges","addRange","setSelectionRange","onClickCopy","fakeEl","execCommand","onClickDelete","onClickCandidate","candidate","JIIX","onClickPrompter","onClickOutSide","removeListeners","marginLeft","marginRight","createWordSpan","span","myFragment","createDocumentFragment","offsetLeft","populatePrompter","DefaultInteractiveInkSSREditorConfiguration","smartGuide","InteractiveInkSSREditorConfiguration","InteractiveInkSSREditor","penClass","syncStyle","onExport","jjix","synchronizeModelWithBackend","onSVGPatch","initializeSmartGuide","onContetChaned","onError","unsentStrokes","blobToImport","strokesToImport","str","exportPoints","DefaultInkEditorConfiguration","InkEditorConfiguration","InkEditor","Editor","load","instance","getInstance","computeDistanceBetweenPointAndSegment","createPointsOnSegment","spaceBetweenPoint","spaceWithP1","getAvailableFontList","isPointInsideBox"],"mappings":"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","x_google_ignoreList":[23]}